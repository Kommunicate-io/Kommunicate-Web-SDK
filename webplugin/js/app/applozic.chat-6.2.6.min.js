(function(){var e,t,n,r,o={}.hasOwnProperty,a=[].slice;e={LF:"\n",NULL:"\0"},n=function(){var t;function n(e,t,n){this.command=e,this.headers=null!=t?t:{},this.body=null!=n?n:""}return n.prototype.toString=function(){var t,r,a,s,i;for(r in t=[this.command],(a=!1===this.headers["content-length"])&&delete this.headers["content-length"],i=this.headers)o.call(i,r)&&(s=i[r],t.push(r+":"+s));return this.body&&!a&&t.push("content-length:"+n.sizeOfUTF8(this.body)),t.push(e.LF+this.body),t.join(e.LF)},n.sizeOfUTF8=function(e){return e?encodeURI(e).match(/%..|./g).length:0},t=function(t){var r,o,a,s,i,c,u,l,p,d,f,g,m,y,v,b,S;for(s=t.search(RegExp(""+e.LF+e.LF)),a=(i=t.substring(0,s).split(e.LF)).shift(),c={},g=function(e){return e.replace(/^\s+|\s+$/g,"")},m=0,v=(b=i.reverse()).length;m<v;m++)l=(d=b[m]).indexOf(":"),c[g(d.substring(0,l))]=g(d.substring(l+1));if(r="",f=s+2,c["content-length"])p=parseInt(c["content-length"]),r=(""+t).substring(f,f+p);else for(o=null,u=y=f,S=t.length;(f<=S?y<S:y>S)&&(o=t.charAt(u))!==e.NULL;u=f<=S?++y:--y)r+=o;return new n(a,c,r)},n.unmarshall=function(n){var r;return function(){var o,a,s,i;for(i=[],o=0,a=(s=n.split(RegExp(""+e.NULL+e.LF+"*"))).length;o<a;o++)(null!=(r=s[o])?r.length:void 0)>0&&i.push(t(r));return i}()},n.marshall=function(t,r,o){return new n(t,r,o).toString()+e.NULL},n}(),t=function(){var t;function o(e){this.ws=e,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}return o.prototype.debug=function(e){var t;return"undefined"!=typeof window&&null!==window&&null!=(t=window.console)?t.log(e):void 0},t=function(){return Date.now?Date.now():(new Date).valueOf},o.prototype._transmit=function(e,t,r){var o;for(o=n.marshall(e,t,r),"function"==typeof this.debug&&this.debug(">>> "+o);;){if(!(o.length>this.maxWebSocketFrameSize))return this.ws.send(o);this.ws.send(o.substring(0,this.maxWebSocketFrameSize)),o=o.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining = "+o.length)}},o.prototype._setupHeartbeat=function(n){var o,a,s,i,c,u;if((c=n.version)===r.VERSIONS.V1_1||c===r.VERSIONS.V1_2)return a=(u=function(){var e,t,r,o;for(o=[],e=0,t=(r=n["heart-beat"].split(",")).length;e<t;e++)i=r[e],o.push(parseInt(i));return o}())[0],o=u[1],0!==this.heartbeat.outgoing&&0!==o&&(s=Math.max(this.heartbeat.outgoing,o),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=r.setInterval(s,function(t){return function(){return t.ws.send(e.LF),"function"==typeof t.debug?t.debug(">>> PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==a?(s=Math.max(this.heartbeat.incoming,a),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),this.ponger=r.setInterval(s,function(e){return function(){var n;if((n=t()-e.serverActivity)>2*s)return"function"==typeof e.debug&&e.debug("did not receive server activity for the last "+n+"ms"),e.ws.close()}}(this))):void 0},o.prototype._parseConnect=function(){var e,t,n,r;switch(r={},(e=1<=arguments.length?a.call(arguments,0):[]).length){case 2:r=e[0],t=e[1];break;case 3:e[1]instanceof Function?(r=e[0],t=e[1],n=e[2]):(r.login=e[0],r.passcode=e[1],t=e[2]);break;case 4:r.login=e[0],r.passcode=e[1],t=e[2],n=e[3];break;default:r.login=e[0],r.passcode=e[1],t=e[2],n=e[3],r.host=e[4]}return[r,t,n]},o.prototype.connect=function(){var o,s,i,c;return o=1<=arguments.length?a.call(arguments,0):[],c=this._parseConnect.apply(this,o),i=c[0],this.connectCallback=c[1],s=c[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(r){return function(o){var a,i,c,u,l,p,d,f,g,m,y,v;if(u="undefined"!=typeof ArrayBuffer&&o.data instanceof ArrayBuffer?(a=new Uint8Array(o.data),"function"==typeof r.debug&&r.debug("--- got data length: "+a.length),function(){var e,t,n;for(n=[],e=0,t=a.length;e<t;e++)i=a[e],n.push(String.fromCharCode(i));return n}().join("")):o.data,r.serverActivity=t(),u!==e.LF){for("function"==typeof r.debug&&r.debug("<<< "+u),v=[],g=0,m=(y=n.unmarshall(u)).length;g<m;g++)switch((l=y[g]).command){case"CONNECTED":"function"==typeof r.debug&&r.debug("connected to server "+l.headers.server),r.connected=!0,r._setupHeartbeat(l.headers),v.push("function"==typeof r.connectCallback?r.connectCallback(l):void 0);break;case"MESSAGE":f=l.headers.subscription,(d=r.subscriptions[f]||r.onreceive)?(c=r,p=l.headers["message-id"],l.ack=function(e){return null==e&&(e={}),c.ack(p,f,e)},l.nack=function(e){return null==e&&(e={}),c.nack(p,f,e)},v.push(d(l))):v.push("function"==typeof r.debug?r.debug("Unhandled received MESSAGE: "+l):void 0);break;case"RECEIPT":v.push("function"==typeof r.onreceipt?r.onreceipt(l):void 0);break;case"ERROR":v.push("function"==typeof s?s(l):void 0);break;default:v.push("function"==typeof r.debug?r.debug("Unhandled frame: "+l):void 0)}return v}"function"==typeof r.debug&&r.debug("<<< PONG")}}(this),this.ws.onclose=function(e){return function(){var t;return t="Whoops! Lost connection to "+e.ws.url,"function"==typeof e.debug&&e.debug(t),e._cleanUp(),"function"==typeof s?s(t):void 0}}(this),this.ws.onopen=function(e){return function(){return"function"==typeof e.debug&&e.debug("Web Socket Opened..."),i["accept-version"]=r.VERSIONS.supportedVersions(),i["heart-beat"]=[e.heartbeat.outgoing,e.heartbeat.incoming].join(","),e._transmit("CONNECT",i)}}(this)},o.prototype.disconnect=function(e,t){return null==t&&(t={}),this._transmit("DISCONNECT",t),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof e?e():void 0},o.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&r.clearInterval(this.pinger),this.ponger)return r.clearInterval(this.ponger)},o.prototype.send=function(e,t,n){return null==t&&(t={}),null==n&&(n=""),t.destination=e,this._transmit("SEND",t,n)},o.prototype.subscribe=function(e,t,n){var r;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=e,this.subscriptions[n.id]=t,this._transmit("SUBSCRIBE",n),r=this,{id:n.id,unsubscribe:function(){return r.unsubscribe(n.id)}}},o.prototype.unsubscribe=function(e){return delete this.subscriptions[e],this._transmit("UNSUBSCRIBE",{id:e})},o.prototype.begin=function(e){var t,n;return n=e||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),t=this,{id:n,commit:function(){return t.commit(n)},abort:function(){return t.abort(n)}}},o.prototype.commit=function(e){return this._transmit("COMMIT",{transaction:e})},o.prototype.abort=function(e){return this._transmit("ABORT",{transaction:e})},o.prototype.ack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("ACK",n)},o.prototype.nack=function(e,t,n){return null==n&&(n={}),n["message-id"]=e,n.subscription=t,this._transmit("NACK",n)},o}(),r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(e,n){var o;return null==n&&(n=["v10.stomp","v11.stomp"]),o=new(r.WebSocketClass||WebSocket)(e,n),new t(o)},over:function(e){return new t(e)},Frame:n},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=r),"undefined"!=typeof window&&null!==window?(r.setInterval=function(e,t){return window.setInterval(t,e)},r.clearInterval=function(e){return window.clearInterval(e)},window.Stomp=r):exports||(self.Stomp=r)}).call(this);var MCK_LABELS,MCK_BASE_URL,w=window,d=document,MCK_CURR_LATITIUDE=40.7324319,MCK_CURR_LONGITUDE=-73.82480777777776,ENCRYPTION_IV=null,ENCRYPTION_TYPE=null,mckUtils=new MckUtils,mckDateUtils=new MckDateUtils,mckContactUtils=new MckContactUtils,mckMapUtils=new MckMapUtils;function MckUtils(){var e=this;e.AES256_ENC_TYPE=5;var t=["p","div","pre","form"];e.init=function(){var e=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/v2/tab/initialize.page":"https://apps.applozic.com/v2/tab/initialize.page",t=MCK_CONTEXTPATH?MCK_CONTEXTPATH+"/rest/ws/message/list":"https://apps.applozic.com/rest/ws/message/list";$applozic.ajax({url:e,contentType:"application/json",type:"OPTIONS"}).done((function(e){})),$applozic.ajax({url:t,contentType:"application/json",type:"OPTIONS"}).done((function(e){}))},e.badgeCountOnLaucher=function(e,t){var n=document.getElementById("applozic-badge-count");!0===e&&t>0&&(n.innerHTML=t<99?t:"99+",n.classList.add("mck-badge-count")),!0===e&&0===t&&(n.innerHTML="",n.classList.remove("mck-badge-count"))},e.randomId=function(){return w.Math.random().toString(36).substring(7)},e.textVal=function(e){for(var n=[],r=[],o=function(){n.push(r.join("")),r=[]},a=function(e){if(3===e.nodeType)r.push(e.nodeValue);else if(1===e.nodeType){var n=e.tagName.toLowerCase(),s=-1!==t.indexOf(n);if(s&&r.length&&o(),"img"===n){var i=e.getAttribute("alt")||"";return void(i&&r.push(i))}if("style"===n)return;"br"===n&&o();for(var c=e.childNodes,u=0;u<c.length;u++)a(c[u]);s&&r.length&&o()}},s=e.childNodes,i=0;i<s.length;i++)a(s[i]);return r.length&&o(),n.join("\n")},e.mouseX=function(e){return e.pageX?e.pageX:e.clientX?e.clientX+(d.documentElement.scrollLeft?d.documentElement.scrollLeft:d.body.scrollLeft):null},e.mouseY=function(e){return e.pageY?e.pageY:e.clientY?e.clientY+(d.documentElement.scrollTop?d.documentElement.scrollTop:d.body.scrollTop):null},e.startsWith=function(e,t){if(null===t||void 0===e)return!1;var n=t.length;if(e.length<n)return!1;for(--n;n>=0&&e[n]===t[n];--n)continue;return n<0},e.setEndOfContenteditable=function(e){var t,n;document.createRange?((t=document.createRange()).selectNodeContents(e),t.collapse(!1),(n=window.getSelection()).removeAllRanges(),n.addRange(t)):document.selection&&((t=document.body.createTextRange()).moveToElementText(e),t.collapse(!1),t.select())},e.b64EncodeUnicode=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)})))},e.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(atob(e),(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))},e.checkIfB64Encoded=function(e){return/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)},e.encrypt128=function(e){var t=CryptoJS.enc.Utf8.parse(e.encryptionKey);return CryptoJS.AES.encrypt(e.data,t,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.ZeroPadding}).toString()},e.encrypt256=function(t){var n=CryptoJS.enc.Base64.parse(t.encryptionKey),r=CryptoJS.enc.Latin1.parse(e.getCryptographyUtils().ENCRYPTION_IV);return CryptoJS.AES.encrypt(t.data,n,{iv:r}).ciphertext.toString(CryptoJS.enc.Base64)},e.encrypt=function(t,n){return n?e.isAES256EncryptionType()?e.encrypt256({data:t,encryptionKey:n}):e.encrypt128({data:t,encryptionKey:n}):t},e.decrypt128=function(e){var t=CryptoJS.enc.Utf8.parse(e.encryptionKey),n=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Base64.parse(e.data)});return CryptoJS.AES.decrypt(n,t,{mode:CryptoJS.mode.ECB,padding:CryptoJS.pad.ZeroPadding}).toString(CryptoJS.enc.Utf8).replace(/\\u0000/g,"").replace(/^\s*|\s*[\x00-\x10]*$/g,"")},e.decrypt256=function(t){var n=CryptoJS.enc.Base64.parse(t.encryptionKey),r=CryptoJS.enc.Latin1.parse(e.getCryptographyUtils().ENCRYPTION_IV),o=CryptoJS.lib.CipherParams.create({ciphertext:CryptoJS.enc.Base64.parse(t.data)});return CryptoJS.AES.decrypt(o,n,{iv:r}).toString(CryptoJS.enc.Utf8)},e.decrypt=function(t,n){return n?e.isAES256EncryptionType()?decryptedData=e.decrypt256({data:t,encryptionKey:n}):e.decrypt128({data:t,encryptionKey:n}):t},e.setCryptographyUtils=function(e,t){ENCRYPTION_IV=e,ENCRYPTION_TYPE=t},e.getCryptographyUtils=function(){return{ENCRYPTION_IV:ENCRYPTION_IV,ENCRYPTION_TYPE:ENCRYPTION_TYPE}},e.isAES256EncryptionType=function(){return e.getCryptographyUtils().ENCRYPTION_TYPE===e.AES256_ENC_TYPE},e.ajax=function(t){var n=e.extendObject({},{},t);!t.skipEncryption&&t.encryptionKey&&("post"===n.type.toLowerCase()&&(n.data=encrypt(t.data,t.encryptionKey)),n.success=function(n){var r=e.decrypt(n,t.encryptionKey);mckUtils.isJsonString(r)?t.success(JSON.parse(r)):t.success(r)}),$applozic.ajax(n)},e.isJsonString=function(e){try{JSON.parse(e)}catch(e){return!1}return isNaN(e)},e.extendObject=function(){var t={},n=!1,r=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(n=arguments[0],r++);for(var a=function(r){for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n&&"[object Object]"===Object.prototype.toString.call(r[o])?t[o]=e.extendObject(!0,t[o],r[o]):t[o]=r[o])};r<o;r++){var s=arguments[r];a(s)}return t}}function MckContactUtils(){var e=this;e.getContactId=function(t){var n=t.contactId;return e.formatContactId(n)},e.formatContactId=function(e){return e&&(0===e.indexOf("+")&&(e=e.substring(1)),e=(e=decodeURIComponent(e)).replace(/\%/g,"PERCENTAGE").replace(/\~/g,"TILDE").replace(/\!/g,"EXCLAMATION_MARK").replace(/\*/g,"STAR").replace(/\(/g,"LEFT_PARENTHESIS").replace(/\)/g,"RIGHT_PARENTHESIS").replace(/\-/g,"DASH").replace(/\@/g,"AT").replace(/\./g,"DOT").replace(/\#/g,"HASH").replace(/\|/g,"VBAR").replace(/\+/g,"PLUS").replace(/\;/g,"SCOLON").replace(/\?/g,"QMARK").replace(/\//g,"FORWARDSLASH").trim()),e}}function MckMapUtils(){this.getCurrentLocation=function(e,t){w.navigator.geolocation.getCurrentPosition(e,t)},this.getSelectedLocation=function(){return{lat:MCK_CURR_LATITIUDE,lon:MCK_CURR_LONGITUDE}}}function MckDateUtils(){this.getDate=function(e){var t=new Date(parseInt(e,10)),n=new Date;return n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()?o(t,"h:MM TT",!1):o(t,"mmm d, h:MM TT",!1)},this.getLastSeenAtStatus=function(e){var t=new Date(parseInt(e,10)),n=new Date;if(n.getDate()===t.getDate()&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()){var r=n.getHours()-t.getHours(),a=w.Math.floor((n.getTime()-t.getTime())/6e4);return a<60?a<=1?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS.min+" "+MCK_LABELS.ago:MCK_LABELS["last.seen"]+" "+a+MCK_LABELS.mins+" "+MCK_LABELS.ago:1===r?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS.hour+" "+MCK_LABELS.ago:MCK_LABELS["last.seen"]+" "+r+MCK_LABELS.hours+" "+MCK_LABELS.ago}return n.getDate()-t.getDate()==1&&n.getMonth()===t.getMonth()&&n.getYear()===t.getYear()?MCK_LABELS["last.seen.on"]+" "+MCK_LABELS.yesterday:MCK_LABELS["last.seen.on"]+" "+o(t,"mmm d",!1)},this.convertMilisIntoTime=function(e){parseInt(e%1e3/100);var t=parseInt(e/1e3%60),n=parseInt(e/6e4%60),r=parseInt(e/36e5%24);return r>0?r+" Hr "+n+" Min "+t+" Sec":n>0?n+" Min "+t+" Sec":t+" Sec "};var e,t,n,r,o=(e=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,t=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,n=/[^-+\dA-Z]/g,r=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e},function(a,s,i){var c=o;if(1!==arguments.length||"[object String]"!==Object.prototype.toString.call(a)||/\d/.test(a)||(s=a,a=void 0),a=a?new Date(a):new Date,isNaN(a))throw SyntaxError("invalid date");"UTC:"===(s=String(s)).slice(0,4)&&(s=s.slice(4),i=!0);var u=i?"getUTC":"get",l=a[u+"Date"](),p=a[u+"Day"](),d=a[u+"Month"](),f=a[u+"FullYear"](),g=a[u+"Hours"](),m=a[u+"Minutes"](),y=a[u+"Seconds"](),v=a[u+"Milliseconds"](),b=i?0:a.getTimezoneOffset(),S={d:l,dd:r(l),ddd:c.i18n.dayNames[p],dddd:c.i18n.dayNames[p+7],m:d+1,mm:r(d+1),mmm:c.i18n.monthNames[d],mmmm:c.i18n.monthNames[d+12],yy:String(f).slice(2),yyyy:f,h:g%12||12,hh:r(g%12||12),H:g,HH:r(g),M:m,MM:r(m),s:y,ss:r(y),l:r(v,3),L:r(v>99?w.Math.round(v/10):v),t:g<12?"a":"p",tt:g<12?MCK_LABELS["time.format.am"]||"am":MCK_LABELS["time.format.pm"]||"pm",T:g<12?"A":"P",TT:g<12?MCK_LABELS["time.format.AM"]||"AM":MCK_LABELS["time.format.PM"]||"PM",Z:i?"UTC":(String(a).match(t)||[""]).pop().replace(n,""),o:(b>0?"-":"+")+r(100*w.Math.floor(w.Math.abs(b)/60)+w.Math.abs(b)%60,4),S:["th","st","nd","rd"][l%10>3?0:(l%100-l%10!=10)*l%10]};return s.replace(e,(function(e){return e in S?S[e]:e.slice(1,e.length-1)}))});o.masks={default:"mmm d, yyyy h:MM TT",fullDateFormat:"mmm d, yyyy h:MM TT",onlyDateFormat:"mmm d",onlyTimeFormat:"h:MM TT",mailDateFormat:"mmm d, yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},o.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}!function(e){"use strict";"undefined"==typeof Applozic?e.Applozic=function(){var e={init:function(){}};return e}():console.log("Applozic already defined.")}(window);var ALStorage=function(e){var t,n,r=[],o=[],a=[],s=[],i=new MckUtils,c=applozic._globals.appId,u=(e,t)=>{w.sessionStorage.setItem(e+"-"+c,t)},l=e=>{var t=w.sessionStorage.getItem(e);return t&&(u(e,t),w.sessionStorage.removeItem(e)),w.sessionStorage.getItem(e+"-"+c)},p=e=>{w.sessionStorage.removeItem(e+"-"+c)};return{updateLatestMessage:function(e){var t=[];t.push(e),ALStorage.updateLatestMessageArray(t),ALStorage.updateMckMessageArray(t)},getLatestMessageArray:function(){return ALStorage.isSessionStorageAvailable()?JSON.parse(l("mckLatestMessageArray")):r},getFriendListGroupName:function(){return ALStorage.isSessionStorageAvailable()?l("friendListGroupName"):t},setFriendListGroupName:function(e){ALStorage.isSessionStorageAvailable()?u("friendListGroupName",e):t=e},setFriendListGroupType:function(e){ALStorage.isSessionStorageAvailable()?u("friendListGroupType",e):n=e},getFriendListGroupType:function(){return ALStorage.isSessionStorageAvailable()?l("friendListGroupType"):n},setLatestMessageArray:function(e){ALStorage.isSessionStorageAvailable()?u("mckLatestMessageArray",w.JSON.stringify(e)):r=e},updateLatestMessageArray:function(e){if(ALStorage.isSessionStorageAvailable()){var t=JSON.parse(l("mckLatestMessageArray"));return null!==t?(t=t.concat(e),u("mckLatestMessageArray",w.JSON.stringify(t))):u("mckLatestMessageArray",w.JSON.stringify(e)),e}return r=r.concat(e)},getMckMessageArray:function(){return ALStorage.isSessionStorageAvailable()?JSON.parse(l("mckMessageArray")):o},clearMckMessageArray:function(){ALStorage.isSessionStorageAvailable()?(p("mckMessageArray"),p("mckLatestMessageArray")):(o.length=0,r.length=0)},clearAppHeaders:function(){ALStorage.isSessionStorageAvailable()&&p("chatheaders")},setAppHeaders:function(e){if(ALStorage.isSessionStorageAvailable()){var t=i.b64EncodeUnicode(JSON.stringify(e));u("chatheaders",t)}},getAppHeaders:function(){if(ALStorage.isSessionStorageAvailable()){var e=l("chatheaders");return e=e?JSON.parse(i.checkIfB64Encoded(e)?i.b64DecodeUnicode(e):e):{}}},getMessageByKey:function(e){return a[e]},updateMckMessageArray:function(e){for(var t=0;t<e.length;t++){var n=e[t];a[n.key]=n}if(ALStorage.isSessionStorageAvailable()){var r=JSON.parse(l("mckMessageArray"));return null!==r?(r=r.concat(e),u("mckMessageArray",w.JSON.stringify(r))):u("mckMessageArray",w.JSON.stringify(e)),e}return o=o.concat(e)},getMckContactNameArray:function(){return ALStorage.isSessionStorageAvailable()?JSON.parse(l("mckContactNameArray")):s},setMckContactNameArray:function(e){ALStorage.isSessionStorageAvailable()?u("mckContactNameArray",w.JSON.stringify(e)):s=e},updateMckContactNameArray:function(e){if(ALStorage.isSessionStorageAvailable()){var t=JSON.parse(l("mckContactNameArray"));return null!==t&&(e=e.concat(t)),u("mckContactNameArray",w.JSON.stringify(e)),e}return s=s.concat(e)},clearMckContactNameArray:function(){ALStorage.isSessionStorageAvailable()?p("mckContactNameArray"):s.length=0},clearSessionStorageElements:function(){ALStorage.clearMckMessageArray(),ALStorage.clearAppHeaders(),ALStorage.clearMckContactNameArray()},isSessionStorageAvailable:function(){try{return void 0!==w.sessionStorage}catch(e){return!1}}}}(window);!function(e){"use strict";"undefined"==typeof ALApiService?e.Applozic.ALApiService=function(t){var n={},r="",o=new MckUtils;n.DEFAULT_ENCRYPTED_APP_VERSION=112;var a,s,i,c,u,l,p="https://apps.applozic.com";return n.getFileUrl=function(){return"https://applozic.appspot.com"},n.initServerUrl=function(e){p=e},n.login=function(e){n.connect(e)},n.connect=function(e){var t=e.data.alUser.appVersionCode||n.DEFAULT_ENCRYPTED_APP_VERSION;r=e.data.alUser.applicationId,p=e.data.baseUrl?e.data.baseUrl:"https://apps.applozic.com",l=e.data.alUser.fileupload,e.data.alUser.appVersionCode=t,n.ajax({url:p+"/v2/tab/initialize.page",skipEncryption:!0,type:"post",async:void 0===e.async||e.async,data:JSON.stringify(e.data.alUser),contentType:"application/json",headers:{"Application-Key":r},success:function(o){c=btoa(o.userId+":"+o.deviceKey),s=o.deviceKey,a=e.data.alUser.password,i=e.data.alUser.appModuleName,n.AUTH_TOKEN=o.authToken,n.setAjaxHeaders(c,r,o.deviceKey,e.data.alUser.password,e.data.alUser.appModuleName),n.setEncryptionKeys(o.encryptionKey,o.userEncryptionKey),"object"==typeof o&&(o.appVersionCode=t),e.success&&e.success(o)},error:function(t){e.error&&e.error(t)}})},n.addRequestHeaders=function(e){n.AUTH_TOKEN?e.setRequestHeader("X-Authorization",n.AUTH_TOKEN):(c&&(e.setRequestHeader("Authorization","Basic "+c),e.setRequestHeader("Application-User","Basic "+c)),s&&e.setRequestHeader("Device-Key",s),a&&e.setRequestHeader("Access-Token",a),i&&e.setRequestHeader("App-Module-Name",i),e.setRequestHeader("UserId-Enabled",!0)),e.setRequestHeader("Application-Key",r)},n.getAttachmentHeaders=function(){var e={};return n.AUTH_TOKEN?e["X-Authorization"]=n.AUTH_TOKEN:(e={"UserId-Enabled":!0,Authorization:"Basic "+c,"Application-User":"Basic "+c,"Application-Key":r,"Device-Key":s},a&&(e["Access-Token"]=a)),e},n.getEncryptionKey=function(){return u},n.setEncryptionKeys=function(e,t){u=e,t},n.setAjaxHeaders=function(e,t,n,o,u){r=t,c=e,s=n,a=o,i=u},n.ajax=function(e){var t=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}({},{},e);!e.skipEncryption&&u&&("post"===t.type.toLowerCase()&&(t.data=o.encrypt(e.data,u)),t.success=function(t){var n=o.decrypt(t,u);o.isJsonString(n)?e.success(JSON.parse(n)):e.success(n)});var a,s,i=new XMLHttpRequest,c=!0;(void 0!==t.async||e.async)&&(c=t.async);var l=t.type.toUpperCase();"GET"===l&&void 0!==t.data&&(t.url=t.url+"?"+t.data),i.open(l,t.url,c),"POST"!==l&&"GET"!==l||(s=void 0===t.contentType?"application/x-www-form-urlencoded; charset=UTF-8":t.contentType,i.setRequestHeader("Content-Type",s)),p=p||"https://apps.applozic.com",-1!==t.url.indexOf(p)&&n.addRequestHeaders(i),-1!==t.url.indexOf("applozic.appspot.com")&&i.setRequestHeader("Application-Key",r),void 0===t.data?i.send():i.send(t.data),i.onreadystatechange=function(){if(4===i.readyState)if(200===i.status){var e=i.getResponseHeader("Content-Type");void 0!==e&&"null"!==e&&null!==e||(e=""),a=-1!=e.toLowerCase().indexOf("text/html")?i.responseXML:-1!=e.toLowerCase().indexOf("application/json")?JSON.parse(i.responseText):i.responseText,t.success(a)}else 401==i.status?t.error("UNAUTHORIZED_REQUEST"):t.error(a)}},n.getMessages=function(e){e.data.userId||e.data.groupId?"undefined"===e.data.pageSize&&(e.data.pageSize=30):void 0===e.data.mainPageSize&&(e.data.mainPageSize=60);var t=function(e){var t="";for(var n in e)t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n])+"&";return t.substring(0,t.length-1)}(e.data),r=new Object;n.ajax({url:p+"/rest/ws/message/list?"+t,async:void 0===e.async||e.async,type:"get",success:function(t){r.status="success",r.data=t,e.success&&e.success(r)},error:function(t,n,o){r.status="error",e.error&&e.error(r)}})},n.sendMessage=function(e){n.ajax({type:"POST",url:p+"/rest/ws/message/send",global:!1,data:JSON.stringify(e.data.message),async:void 0===e.async||e.async,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.sendDeliveryUpdate=function(e){n.ajax({url:p+"/rest/ws/message/delivered",data:"key="+e.data.key,global:!1,type:"get",async:void 0===e.async||e.async,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.updateReplyMessage=function(e){n.ajax({url:p+"/rest/ws/message/detail?keys="+e.data.key,type:"get",async:void 0===e.async||e.async,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.createGroup=function(e){n.ajax({url:p+"/rest/ws/group/create",global:!1,data:JSON.stringify(e.data.group),type:"post",async:void 0===e.async||e.async,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.loadGroups=function(e){e.baseUrl&&(p=e.baseUrl),n.ajax({url:p+"/rest/ws/group/list",type:"get",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.getGroupInfo=function(e){var t=e.data.groupId?"?groupId="+e.data.groupId:"?clientGroupId="+e.data.clientGroupId;n.ajax({url:p+"/rest/ws/group/v2/info"+t,type:"get",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.addGroupMember=function(e){n.ajax({url:p+"/rest/ws/group/add/member",type:"POST",data:JSON.stringify(e.data.group),async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.removeGroupMember=function(e){n.ajax({url:p+"/rest/ws/group/remove/member",type:"POST",data:JSON.stringify(e.data),async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.groupUpdate=function(e){n.ajax({url:p+"/rest/ws/group/update",type:"POST",data:JSON.stringify(e.data),async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t,e.data)},error:function(t){e.error&&e.error(t)}})},n.isUserPresentInGroup=function(e){n.ajax({url:p+"/rest/ws/group/check/user?userId="+e.data.userId+"&clientGroupId="+e.data.clientGroupId,type:"get",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.groupUserCount=function(e){n.ajax({url:p+"/rest/ws/group/user/count?clientGroupIds="+e.data.clientGroupId,type:"get",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.getUserDetail=function(e){n.ajax({url:p+"/rest/ws/user/v2/detail",data:JSON.stringify({userIdList:e.data}),type:"POST",async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.updateUserDetail=function(e){n.ajax({url:p+"/rest/ws/user/update",data:JSON.stringify(e.data),type:"POST",async:void 0===e.async||e.async,global:!1,contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.getContactList=function(e){var t=e.baseUrl?e.baseUrl:p;n.ajax({url:t+e.url,type:"GET",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.blockUser=function(e){n.ajax({url:p+"/rest/ws/user/block?userId="+e.data.userId+"&block="+e.data.isBlock,type:"GET",async:void 0===e.async||e.async,global:!1,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.sendConversationCloseUpdate=function(e){var t="id="+e.conversationId;n.ajax({url:p+"/rest/ws/conversation/close",data:t,global:!1,type:"get",success:function(){},error:function(){}})},n.fileUpload=function(e){n.ajax({type:"GET",skipEncryption:!0,url:e.data.url,global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.sendAttachment=function(t){"awsS3Server"===l?e.Applozic.ALApiService.sendAttachmentToAWS(t):"googleCloud"===l?e.Applozic.ALApiService.sendAttachmentToCloud(t):e.Applozic.ALApiService.sendAttachmentToGoogleServer(t)},n.sendAttachmentToGoogleServer=function(e){var t=new XMLHttpRequest;n.ajax({type:"GET",skipEncryption:!0,url:void 0!==e.url?e.url:"https://applozic.appspot.com/rest/ws/aws/file/url",global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(r){t.addEventListener("load",(function(t){var n=JSON.parse(this.responseText),r=e.data.messagePxy;n&&(r.fileMeta=n.fileMeta,Applozic.ALApiService.sendMessage({data:{message:r},success:function(t){e.success&&(t.fileMeta=n.fileMeta,e.success(t))},error:function(t){e.error&&e.error(t)}}))}));var o=new FormData,a=e.data.file;o.append("files[]",a),t.open("POST",r,!0),n.addRequestHeaders(t),t.send(o)},error:function(t){e.error&&e.error(t)}})},n.sendAttachmentToAWS=function(e){var t=new FormData,r=new XMLHttpRequest,o=p+"/rest/ws/upload/image";r.addEventListener("load",(function(t){var n=JSON.parse(this.responseText),r=e.data.messagePxy;n&&(r.fileMeta=n,Applozic.ALApiService.sendMessage({data:{message:r},success:function(t){e.success&&(t.fileMeta=n,e.success(t))},error:function(t){e.error&&e.error(t)}}))})),t.append("file",e.data.file),r.open("post",o,!0),n.addRequestHeaders(r),r.send(t)},n.sendAttachmentToCloud=function(e){var t=new FormData,r=new XMLHttpRequest,o=void 0!==e.cloudUploadUrl?e.cloudUploadUrl:"https://googleupload.applozic.com/files/upload/";r.addEventListener("load",(function(t){var n=JSON.parse(this.responseText),r=e.data.messagePxy;n&&(r.fileMeta=n.fileMeta,Applozic.ALApiService.sendMessage({data:{message:r},success:function(t){e.success&&(e.fileMeta=n.fileMeta,e.success(t))},error:function(t){e.error&&e.error(t)}}))})),t.append("files[]",e.data.file),r.open("post",o,!0),n.addRequestHeaders(r),r.send(t)},n.deleteFileMeta=function(e){n.ajax({url:e.data.url,skipEncryption:!0,type:"post",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},n.conversationReadUpdate=function(e){n.ajax({url:p+"/rest/ws/message/read/conversation",data:e.data,global:!1,type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},n.sendSubscriptionIdToServer=function(e){var t=e.data.subscriptionId;n.ajax({url:p+"/rest/ws/plugin/update/sw/id",skipEncryption:!0,type:"post",data:"registrationId="+t,success:function(e){},error:function(e,t,n){401===e.status&&(ALStorage.clearSessionStorageElements(),console.log("Please reload page."))}})},n.getTopicId=function(e){var t="id="+e.data.conversationId;n.ajax({url:p+"/rest/ws/conversation/topicId?"+t,type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},n.getContactDisplayName=function(e){var t=e.data.userIdArray;if(t.length>0&&t[0]){for(var r="",o=t.filter((function(e,n){return t.indexOf(e)===n})),a=0;a<o.length;a++){var s=o[a];void 0===MCK_CONTACT_NAME_MAP[s]&&(r+="userIds="+encodeURIComponent(s)+"&")}r.lastIndexOf("&")===r.length-1&&(r=r.substring(0,r.length-1)),r&&n.ajax({url:p+"/rest/ws/user/info",data:r,global:!1,type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})}},n.getUserStatus=function(e){n.ajax({url:p+"/rest/ws/user/chat/status",type:"get",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},n.getConversationId=function(e){n.ajax({url:p+"/rest/ws/conversation/id",global:!1,data:w.JSON.stringify(e.data),type:"post",contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.success(t)}})},n}():console.log("ALApiService already defined.")}(window),function(e){"use strict";"undefined"==typeof ALSocket?e.Applozic.ALSocket=function(){var t,n={events:{}},r=null,o=null;n.stompClient=null;var a,s,i="";n.typingSubscriber=null,n.supportChannelSubscriber=null,n.openGroupSubscriber=[];var c=[];n.mck_typing_status=0;var u="",l="socket.applozic.com",p="80";n.MCK_TOKEN,n.USER_DEVICE_KEY,n.USER_ENCRYPTION_KEY,n.ENCRYPTION_KEY,n.APP_VERSION_CODE,n.AUTH_TOKEN;var d=new MckUtils,f=!1;return n.init=function(r,o,a){var s={};r&&(t=r),void 0!==o&&(n.MCK_TOKEN=o.token,n.APP_VERSION_CODE=o.appVersionCode,n.USER_DEVICE_KEY=o.deviceKey,n.ENCRYPTION_KEY=o.encryptionKey,(o.encryptionKey||parseInt(o.appVersionCode)>=e.Applozic.ALApiService.DEFAULT_ENCRYPTED_APP_VERSION)&&(n.USER_ENCRYPTION_KEY=o.userEncryptionKey),l=o.websocketUrl,p=void 0===o.websocketPort?d.startsWith(l,"https")?"15675":"15674":o.websocketPort,n.AUTH_TOKEN=o.authToken,s.socketUserId=o.appId||r,s.socketPassword=o.authToken),n.events=a,void 0!==l&&navigator.onLine&&e.WebSocket&&(l=l.replace("https://",""),u=new WebSocket("wss://"+l+":"+p+"/ws"),n.stompClient=Stomp.over(u),n.stompClient.heartbeat.outgoing=1e4,n.stompClient.heartbeat.incoming=0,n.stompClient.reconnect_delay=3e4,n.stompClient.debug=null,n.stompClient.onclose=function(){n.disconnect()},n.stompClient.connect(s.socketUserId,s.socketPassword,n.onConnect,n.onError,"/"),e.addEventListener("beforeunload",(function(e){var t;e.target.activeElement&&(t=e.target.activeElement.href),t&&0!==t.length||n.disconnect()})))},n.setOnline=function(){void 0!==e.Applozic.ALSocket&&e.Applozic.ALSocket.sendStatus(1)},n.checkConnected=function(e){n.stompClient.connected&&(a&&clearInterval(a),s&&clearInterval(s),a=setInterval((function(){n.connectToSocket(e)}),6e4),s=setInterval((function(){n.sendStatus(1)}),12e4)),n.connectToSocket(e)},n.connectToSocket=function(e){"function"==typeof n.events.connectToSocket&&n.events.connectToSocket(e)},n.stopConnectedCheck=function(){a&&clearInterval(a),s&&clearInterval(s),a="",s="",n.disconnect()},n.disconnect=function(){n.stompClient&&n.stompClient.connected&&(n.sendStatus(0),n.stompClient.disconnect(),"object"==typeof u&&(u.close(),u=""))},n.unsubscibeToTypingChannel=function(){n.stompClient&&n.stompClient.connected&&n.typingSubscriber&&(1===n.mck_typing_status&&n.sendTypingStatus(0,i),n.typingSubscriber.unsubscribe()),n.typingSubscriber=null},n.unsubscibeToNotification=function(){n.stompClient&&n.stompClient.connected&&(r&&r.unsubscribe(),o&&o.unsubscribe()),r=o=null},n.subscibeToTypingChannel=function(e){n.stompClient&&n.stompClient.connected?n.typingSubscriber=n.stompClient.subscribe("/topic/typing-"+t+"-"+e,n.onTypingStatus):n.reconnect()},n.subscribeToSupportChannel=function(){n.stompClient&&n.stompClient.connected?n.supportChannelSubscriber=n.stompClient.subscribe("/topic/support-channel-"+t,n.onUserStatusUpdate):n.reconnect()},n.unsubscribeToSupportChannel=function(){n.stompClient&&n.stompClient.connected&&n.supportChannelSubscriber&&n.supportChannelSubscriber.unsubscribe(),n.supportChannelSubscriber=null},n.subscribeToOpenGroup=function(e){if(console.log("adding subscription"),n.stompClient&&n.stompClient.connected){var r=n.stompClient.subscribe("/topic/group-"+t+"-"+e.contactId,n.onOpenGroupMessage);n.openGroupSubscriber.push(r.id),c[e.contactId]=r.id}else n.reconnect()},n.sendTypingStatus=function(e,r,o,a){if(n.mck_typing_status=r,n.stompClient&&n.stompClient.connected){if(1===e&&1===n.mck_typing_status&&n.stompClient.send("/topic/typing-"+t+"-"+i,{"content-type":"text/plain"},t+","+o+","+e),a){if(a===i&&e===n.mck_typing_status&&1===e)return;i=a,n.stompClient.send("/topic/typing-"+t+"-"+a,{"content-type":"text/plain"},t+","+o+","+e),setTimeout((function(){n.mck_typing_status=0}),6e4)}else 0===e&&n.stompClient.send("/topic/typing-"+t+"-"+i,{"content-type":"text/plain"},t+","+o+","+e);n.mck_typing_status=e}},n.onTypingStatus=function(e){"function"==typeof n.events.onTypingStatus&&n.events.onTypingStatus(e)},n.onUserStatusUpdate=function(e){"function"==typeof n.events.onUserStatusUpdate&&n.events.onUserStatusUpdate(e)},n.reconnect=function(){if(f){f=!1,n.unsubscibeToTypingChannel(),n.unsubscibeToNotification(),n.unsubscribeToSupportChannel(),n.disconnect();var e={};e.token=n.MCK_TOKEN,e.deviceKey=n.USER_DEVICE_KEY,e.userEncryptionKey=n.USER_ENCRYPTION_KEY,e.encryptionKey=n.ENCRYPTION_KEY,e.websocketUrl=l,e.websocketPort=p,e.authToken=n.AUTH_TOKEN,n.init(t,e,n.events)}},n.onError=function(e){console.log("Error in channel notification. "+e),"function"==typeof n.events.onConnectFailed&&setTimeout((function(){n.events.onConnectFailed(e),f=!0}),3e4)},n.sendStatus=function(e){n.stompClient&&n.stompClient.connected&&n.stompClient.send("/topic/status-v2",{"content-type":"text/plain"},n.MCK_TOKEN+","+n.USER_DEVICE_KEY+","+e)},n.sendMessageStatus=function(e,t,r){n.stompClient&&n.stompClient.connected&&n.stompClient.send("/topic/message-status",{"content-type":"text/plain"},r+","+e+","+t)},n.onConnect=function(){f=!0,n.stompClient.connected?((r||o)&&n.unsubscibeToNotification(),n.handleOnConnect()):setTimeout((function(){n.handleOnConnect()}),5e3),"function"==typeof n.events.onConnect&&n.events.onConnect()},n.handleOnConnect=function(){var e="/topic/"+n.MCK_TOKEN,t="/topic/encr-"+n.MCK_TOKEN;r=n.stompClient.subscribe(e,n.onStompMessage),n.USER_ENCRYPTION_KEY&&(o=n.stompClient.subscribe(t,n.onStompMessage)),n.sendStatus(1),n.checkConnected(!0)},n.onOpenGroupMessage=function(e){"function"==typeof n.events.onOpenGroupMessage&&n.events.onOpenGroupMessage(e)},n.onStompMessage=function(e){var t;if(null!=r&&r.id===e.headers.subscription)t=e.body;else if(null!=o&&o.id===e.headers.subscription){var a=d.isAES256EncryptionType()?n.ENCRYPTION_KEY:n.USER_ENCRYPTION_KEY;t=d.decrypt(e.body,a)}n.onMessage(t)},n.onMessage=function(e){if(d.isJsonString(e)){var t=JSON.parse(e),r=t.type;if("function"==typeof n.events.onMessage&&n.events.onMessage(t),"APPLOZIC_04"===r||"MESSAGE_DELIVERED"===r)n.events.onMessageDelivered(t);else if("APPLOZIC_08"===r||"MT_MESSAGE_DELIVERED_READ"===r)n.events.onMessageRead(t);else if("APPLOZIC_05"===r)n.events.onMessageDeleted(t);else if("APPLOZIC_27"===r)n.events.onConversationDeleted(t);else if("APPLOZIC_11"===r)n.events.onUserConnect(t.message);else if("APPLOZIC_12"===r){var o=t.message.split(",")[0],a=t.message.split(",")[1];n.events.onUserDisconnect({userId:o,lastSeenAtTime:a})}else if("APPLOZIC_29"===r)n.events.onConversationReadFromOtherSource(t);else if("APPLOZIC_28"===r)n.events.onConversationRead(t);else if("APPLOZIC_16"===r){var s=t.message.split(":")[0];o=t.message.split(":")[1];n.events.onUserBlocked({status:s,userId:o})}else if("APPLOZIC_17"===r){s=t.message.split(":")[0],o=t.message.split(":")[1];n.events.onUserUnblocked({status:s,userId:o})}else if("APPLOZIC_18"===r)n.events.onUserActivated();else if("APPLOZIC_19"===r)n.events.onUserDeactivated();else if("APPLOZIC_25"===r)n.events.onUserStatusUpdate&&n.events.onUserStatusUpdate();else{var i=t.message;if("APPLOZIC_03"===r)n.events.onMessageSentUpdate({messageKey:i.key});else if("APPLOZIC_01"===r||"MESSAGE_RECEIVED"===r){var c=alMessageService.getMessageFeed(i);n.events.onMessageReceived({message:c})}else if("APPLOZIC_02"===r){c=alMessageService.getMessageFeed(i);n.events.onMessageSent({message:c})}}}},n}():console.log("ALSocket already defined.")}(window);var mckNotificationUtils=new MckNotificationUtils,alNotificationService=new AlNotificationService;function AlNotificationService(){var e,t,n=this;n.init=function(t){e="boolean"==typeof t.swNotification&&t.swNotification,t.contactDisplayImage,t.notificationIconLink,"boolean"==typeof t.desktopNotification&&t.desktopNotification},n.unsubscribeToServiceWorker=function(){t&&navigator.serviceWorker.ready.then((function(e){t.unsubscribe().then((function(e){t=null,console.log("Unsubscribed to notification successfully")}))}))},n.sendSubscriptionIdToServer=function(){if(t){var e=t.endpoint.split("/").slice(-1)[0];e&&window.Applozic.ALApiService.sendSubscriptionIdToServer({data:{subscriptionId:e},success:function(e){},error:function(){}})}},n.subscribeToServiceWorker=function(){e&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",{scope:"./"}),navigator.serviceWorker.ready.then((function(e){e.pushManager.subscribe({userVisibleOnly:!0}).then((function(e){console.log("The reg ID is:: ",e.endpoint.split("/").slice(-1)),t=e,n.sendSubscriptionIdToServer()}))})))}}function MckNotificationUtils(){var e=this,t=window.top,n=["granted","default","denied"],r=function(){var e=!1;try{e=!!(t.Notification||t.webkitNotifications||navigator.mozNotification||t.external&&void 0!==t.external.msIsSiteMode())}catch(e){}return e}(),o=Math.floor(10*Math.random()+1),a=function(){};e.permissionLevel=function(){var e;if(r)return t.Notification&&t.Notification.permissionLevel?e=t.Notification.permissionLevel():t.webkitNotifications&&t.webkitNotifications.checkPermission?e=n[t.webkitNotifications.checkPermission()]:t.Notification&&t.Notification.permission?e=t.Notification.permission:navigator.mozNotification?e="granted":t.external&&void 0!==t.external.msIsSiteMode()&&(e=t.external.msIsSiteMode()?"granted":"default"),e},e.requestPermission=function(e){var n,r=(n=e)&&n.constructor===Function?e:a;t.webkitNotifications&&t.webkitNotifications.checkPermission?t.webkitNotifications.requestPermission(r):t.Notification&&t.Notification.requestPermission&&t.Notification.requestPermission(r)},e.isChrome=function(){return/chrom(e|ium)/.test(t.navigator.userAgent.toLowerCase())},e.getNotification=function(n,r,a,s){var i;if(s&&(s.play(),setTimeout((function(){s.stop()}),1e3)),t.Notification){var c={icon:r,body:a};(i=new t.Notification(n,c)).onclick=function(){t.focus(),this.close()}}else t.webkitNotifications?(i=t.webkitNotifications.createNotification(r,n,a),s&&i.show(),e.isChrome()&&(i.onclick=function(){t.focus(),this.cancel()}),i.show(),setTimeout((function(){i.cancel()}),3e4)):navigator.mozNotification?(i=navigator.mozNotification.createNotification(n,a,r)).show():t.external&&t.external.msIsSiteMode()&&(t.external.msSiteModeClearIconOverlay(),t.external.msSiteModeSetIconOverlay(r,n),t.external.msSiteModeActivate(),i={ieVerification:o+1});return i},e.sendDesktopNotification=function(n,r,o,a){if("granted"!==e.permissionLevel()&&t.Notification.requestPermission(),"granted"===e.permissionLevel()){var s;s=a?e.getNotification(n,r,o,a):e.getNotification(n,r,o);var i=e.getWrapper(s);s&&!s.ieVerification&&s.addEventListener&&s.addEventListener("show",(function(){var e=i;t.setTimeout((function(){e.close()}),3e4)}))}},e.getWrapper=function(e){return{close:function(){e&&(e.close?e.close():e.cancel?e.cancel():t.external&&t.external.msIsSiteMode()&&e.ieVerification===o&&t.external.msSiteModeClearIconOverlay())}}}}var mckGroupUtils=new MckGroupUtils,mckGroupService=new MckGroupService;function MckGroupUtils(){this.GROUP_ROLE_MAP=[0,1,2,3],this.GROUP_TYPE_MAP=[1,2,5,6,7,9,10],this.CONVERSATION_STATUS_MAP=["DEFAULT","NEW","OPEN"],this.ROLE_MAP={0:"User",1:"Admin",2:"Moderator",3:"Member"},this.getDeletedAtTime=function(e){if("object"==typeof MCK_GROUP_MAP[e])return MCK_GROUP_MAP[e].deletedAtTime},this.initGroupTab=function(e,t){if("object"==typeof e){var n=e.users;return void 0===n||n.length<1?"Users List Required":n.length>MCK_GROUP_MAX_SIZE?"Users limit exceeds "+MCK_GROUP_MAX_SIZE+". Max number of users allowed is "+MCK_GROUP_MAX_SIZE+".":e.groupName?void 0===e.type?"Group type required":-1===mckGroupUtils.GROUP_TYPE_MAP.indexOf(e.type)?"Invalid group type":("function"==typeof t&&t(e),"success"):"Group name required"}return"Unsupported format. Please check format"},this.getGroup=function(e){return"object"==typeof MCK_GROUP_MAP[e]?MCK_GROUP_MAP[e]:void 0},this.getGroupByClientGroupId=function(e){return"object"==typeof MCK_CLIENT_GROUP_MAP[e]?MCK_CLIENT_GROUP_MAP[e]:void 0},this.addGroup=function(e){var t=e.name?e.name:e.id,n=[];e&&e.groupUsers&&e.groupUsers.forEach((function(e,t){e.userId&&(n[e.userId]=e)}));var r=void 0!==e.removedMembersId?e.removedMembersId:[],o={contactId:e.id.toString(),htmlId:mckContactUtils.formatContactId(""+e.id),displayName:t,value:e.id.toString(),adminName:e.adminId?e.adminId:e.adminName,type:e.type,members:e.membersId?e.membersId:e.membersName,imageUrl:e.imageUrl,users:n,userCount:e.userCount,removedMembersId:r,clientGroupId:e.clientGroupId,isGroup:!0,deletedAtTime:e.deletedAtTime,metadata:e.metadata};return MCK_GROUP_MAP[e.id]=o,e.clientGroupId&&(MCK_CLIENT_GROUP_MAP[e.clientGroupId]=o),o},this.createGroup=function(e){var t={contactId:e.toString(),htmlId:mckContactUtils.formatContactId(""+e),displayName:e.toString(),value:e.toString(),type:2,adminName:"",imageUrl:"",userCount:"",users:[],removedMembersId:[],clientGroupId:"",isGroup:!0,deletedAtTime:""};return MCK_GROUP_MAP[e]=t,t}}function MckGroupService(){var e,t,n,r,o=this;MCK_GROUP_ARRAY=new Array,o.addGroups=function(e){var t=e.data;MCK_GROUP_ARRAY.length=0,t&&t.forEach((function(e,t){if(void 0!==e.id){e=mckGroupUtils.addGroup(e);MCK_GROUP_ARRAY.push(e)}}))},o.removeGroupMember=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?void 0===e.userId||""===e.userId?void e.callback({status:"error",errorMessage:"UserId required"}):(e.apzCallback=mckGroupLayout.onRemovedGroupMember,mckGroupService.removeGroupMemberFromChat(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"}):"Callback function required"},o.createGroup=function(e,t){if("object"==typeof e){if("function"==typeof e.callback){var n=e.users;return void 0===n||n.length<1?void e.callback({status:"error",errorMessage:"Users list required"}):n.length>r?void e.callback({status:"error",errorMessage:"Users limit exceeds "+r+". Max number of users allowed is "+r+"."}):e.groupName?void 0===e.type||""===e.type?void e.callback({status:"error",errorMessage:"Group type required"}):-1===mckGroupUtils.GROUP_TYPE_MAP.indexOf(e.type)?void e.callback({status:"error",errorMessage:"Invalid group type"}):("function"==typeof t&&t(e),"success"):void e.callback({status:"error",errorMessage:"Group name required"})}return"Callback function required"}return"Unsupported Format. Please check format"},o.init=function(o){e=o.visitor,t=e?"guest":o.userId&&o.userId.toString().trim(),n=o.openGroupSettings,r=o.maxGroupSize},o.getGroupList=function(e){return"function"==typeof e.callback?(e.apzCallback=o.addGroups,o.loadGroups(e),"success"):"Callback Function Required"},o.loadGroups=function(e){var t=new Object;window.Applozic.ALApiService.loadGroups({baseUrl:MCK_BASE_URL,success:function(n){"success"===n.status?(t.status="success",t.data=n.response,e.apzCallback&&e.apzCallback(t)):t.status="error",e.callback&&e.callback(t)},error:function(){console.log("Unable to load groups. Please reload page."),t.status="error",e.callback&&e.callback(t),e.apzCallback&&e.apzCallback(t)}})},o.getGroupFeed=function(e){var t={};if("function"==typeof e.callback||"function"==typeof e.apzCallback){var n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return void("function"==typeof e.callback&&(n.status="error",n.errorMessage="GroupId or Client GroupId Required",e.callback(n)));t.clientGroupId=e.clientGroupId}e.conversationId&&(t.conversationId=e.conversationId),Applozic.ALApiService.getGroupInfo({data:t,success:function(t){if("success"===t.status){var n=t.response;if(n+""=="null"||"object"!=typeof n)t.status="error",t.errorMessage="GroupId not found";else{var r=mckGroupUtils.addGroup(n);t.status="success",t.data=r}}else"error"===t.status&&(t.status="error",t.errorMessage=t.errorResponse[0].description);e.callback&&e.callback(t),e.apzCallback&&("success"===t.status&&(t.data=n),e.apzCallback(t,e))},error:function(){console.log("Unable to load group. Please reload page."),n.status="error",n.errorMessage="Please reload page.",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n,e)}})}},o.removeGroupMemberFromChat=function(e){var t={},n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return n.status="error",n.errorMessage="GroupId or Client GroupId Required",void("function"==typeof e.callback&&e.callback(n));t.clientGroupId=e.clientGroupId}t.userId=e.userId,Applozic.ALApiService.removeGroupMember({data:t,success:function(t){if("success"===t.status){if(e.clientGroupId){var n=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId);"object"==typeof n&&(e.groupId=n.contactId)}t.status="success"}else t.status="error",t.errorMessage=data.errorResponse[0].description;e.callback&&e.callback(t),e.apzCallback&&e.apzCallback(t,e)},error:function(){console.log("Unable to process your request. Please reload page."),n.status="error",n.errorMessage="",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n),e.apzCallback(n)}})},o.addGroupMember=function(e){var t={},n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return void("function"==typeof e.callback&&e.callback(n));t.clientGroupId=e.clientGroupId}t.userId=e.userId,void 0!==e.role&&(t.role=e.role),Applozic.ALApiService.addGroupMember({data:{group:t},success:function(t){if("success"===t.status){if(e.clientGroupId){var r=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId);"object"==typeof r&&(e.groupId=r.contactId)}n.status="success",n.data=t.response}else n.status="error",n.errorMessage=t.errorResponse[0].description;e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n,e)},error:function(){console.log("Unable to process your request. Please reload page."),n.status="error",n.errorMessage="",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n)}})},o.updateGroupInfo=function(e){var t={},n=new Object;if(e.groupId)t.groupId=e.groupId;else{if(!e.clientGroupId)return void("function"==typeof e.callback&&(n.status="error",n.errorMessage="GroupId or Client GroupId Required",e.callback(n)));t.clientGroupId=e.clientGroupId}e.name&&(t.newName=e.name),e.imageUrl&&(t.imageUrl=e.imageUrl),e.users&&e.users.length>0&&(t.users=e.users),Applozic.ALApiService.groupUpdate({data:t,success:function(t,r){if("success"===t.status){if(e.clientGroupId)"object"==typeof(r=mckGroupLayout.getGroupByClientGroupId(e.clientGroupId))&&(e.groupId=r.contactId);n.status="success",n.data=t.response}else n.status="error",n.errorMessage=t.errorResponse[0].description;e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n,{groupId:e.groupId,groupInfo:r,users:e.users})},error:function(){console.log("Unable to process your request. Please reload page."),n.status="error",n.errorMessage="Unable to process your request. Please reload page.",e.callback&&e.callback(n),e.apzCallback&&e.apzCallback(n)}})},o.sendGroupMessage=function(e){if("object"==typeof e){var t=(e=mckUtils.extendObject(!0,{},message_default_options,e)).message;if(!e.groupId&&!e.clientGroupId)return"groupId or clientGroupId required";if(void 0===t||""===t)return"message field required";if(e.type>12)return"invalid message type";t=t&&t.trim();var n={type:e.messageType,contentType:e.type,message:t};if(e.groupId)n.groupId=e.groupId.toString().trim();else if(e.clientGroupId){if(void 0===mckGroupUtils.getGroupByClientGroupId(e.clientGroupId))return"group not found";n.clientGroupId=e.clientGroupId.toString().trim()}return mckMessageService.sendMessage(n),"success"}return"Unsupported format. Please check format"},o.getContactFromGroupOfTwo=function(e,n){for(var r,o=0;o<e.members.length;o++)if(r=""+e.members[o],t!==r)return"function"==typeof n&&n(r),r},o.addGroupFromMessage=function(e,t,n){var r=e.groupId,a=mckGroupUtils.getGroup(""+r);void 0===a&&(a=mckGroupUtils.createGroup(r),o.loadGroups({apzCallback:o.addGroups})),"function"==typeof n&&n(a,e,t)},o.isGroupDeleted=function(e,t){if(t){var n=mckGroupUtils.getDeletedAtTime(e);return void 0!==n&&n>0}return!1},o.loadGroupsCallback=function(e){var t=e.data;MCK_GROUP_ARRAY.length=0,t&&t.groupUsers&&t.groupUsers.forEach((function(e,t){if(void 0!==e.id){e=mckGroupUtils.addGroup(e);MCK_GROUP_ARRAY.push(e)}}))},o.getGroupDisplayName=function(e){if("object"==typeof MCK_GROUP_MAP[e]){var n=MCK_GROUP_MAP[e],r=n.displayName,a=[];if(7===n.type){var s=o.getContactFromGroupOfTwo(n);void 0!==s&&(alUserService.MCK_USER_DETAIL_MAP[s]?alUserService.MCK_USER_DETAIL_MAP[s]&&alUserService.MCK_USER_DETAIL_MAP[s].displayName&&(r=alUserService.MCK_USER_DETAIL_MAP[s].displayName):(a.push(s),window.Applozic.ALApiService.getUserDetail({data:a,success:function(e){e&&e.response&&e.response.length>0&&e.response.forEach((function(e,t){alUserService.MCK_USER_DETAIL_MAP[e.userId]=e,alUserService.MCK_USER_DETAIL_MAP[s]&&alUserService.MCK_USER_DETAIL_MAP[s].displayName&&(r=alUserService.MCK_USER_DETAIL_MAP[s].displayName)}))}})))}if(3===n.type&&-1!==r.indexOf(t)&&(r=r.replace(t,"").replace(":",""),"function"==typeof MCK_GETUSERNAME)){var i=MCK_GETUSERNAME(r);r=i||r}return r||5!==n.type||(r="Broadcast"),r||(r=n.contactId),r}return e},o.getGroupImage=function(e){return e?'<img src="'+e+'"/>':'<img src="'+MCK_BASE_URL+'/resources/sidebox/css/app/images/mck-icon-group.png"/>'},o.getGroupDefaultIcon=function(){return'<div class="mck-group-icon-default"></div>'},o.addMemberToGroup=function(e,t){return"object"==typeof e.members&&(-1===e.members.indexOf(t)&&e.members.push(t),"object"==typeof e.removedMembersId&&-1!==e.removedMembersId.indexOf(t)&&e.removedMembersId.splice(e.removedMembersId.indexOf(t),1),MCK_GROUP_MAP[e.contactId]=e),e},o.removeMemberFromGroup=function(e,t){return"object"!=typeof e.removedMembersId||e.removedMembersId.length<1?(e.removedMembersId=[],e.removedMembersId.push(t)):-1===e.removedMembersId.indexOf(t)&&e.removedMembersId.push(t),MCK_GROUP_MAP[e.contactId]=e,e},o.authenticateGroupUser=function(e){var n=!1;if(!o.isGroupLeft(e)&&e.members.length>0)for(var r=0;r<e.members.length;r++)if(t===""+e.members[r])return n=!0,!0;return n},o.isAppendOpenGroupContextMenu=function(e){return 0!==n.deleteChatAccess&&(!!mckGroupService.authenticateGroupUser(e)&&(e.adminName===t||2===n.deleteChatAccess))},o.isGroupLeft=function(e){var n=!1;return e.removedMembersId&&e.removedMembersId.length>0&&e.removedMembersId.forEach((function(e,r){e===t&&(n=!0)})),n}}var alUserService=new AlUserService;function AlUserService(){var e=this;e.MCK_USER_DETAIL_MAP=[],e.MCK_BLOCKED_TO_MAP=[];new Array;e.updateUserStatus=function(e,t){if("object"==typeof alUserService.MCK_USER_DETAIL_MAP[e.userId]){var n=alUserService.MCK_USER_DETAIL_MAP[e.userId];0===e.status?(n.connected=!1,n.lastSeenAtTime=e.lastSeenAtTime):1===e.status&&(n.connected=!0)}else{var r=new Array;r.push(e.userId),"function"==typeof t&&t(r)}},e.getUserDetail=function(e){return"object"==typeof alUserService.MCK_USER_DETAIL_MAP[e]?alUserService.MCK_USER_DETAIL_MAP[e]:void 0},e.loadUserProfile=function(t){if(void 0!==t){"string"!=typeof t&&(t=String(t));var n=[],r=""+t.split(",")[0];n.push(r),e.loadUserProfiles(n)}},e.loadUserProfiles=function(e,t){"function"==typeof t&&t(e,[])},e.getUserStatus=function(e,t){var n=new Object;window.Applozic.ALApiService.getUserStatus({success:function(r){r.users.length>0&&([],"function"==typeof t&&t(r)),n.status="success",n.data=r,e.callback&&e.callback(n)},error:function(){n.status="error",e.callback&&e.callback(n)}})},e.blockUser=function(e,t,n){if(e&&void 0!==t){var r="userId="+e+"&block="+t;mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:r,encryptionKey:window.Applozic.ALApiService.getEncryptionKey(),success:function(r){"object"==typeof r&&"success"===r.status&&(alUserService.MCK_BLOCKED_TO_MAP[e]=t,"function"==typeof n&&n(e))},error:function(){}})}}}var alFileService=new AlFileService;function AlFileService(){var e,t,n,r,o=this;o.init=function(e){t=e.fileBaseUrl,btoa(e.userId+":"+e.deviceKey),e.deviceKey},o.get=function(t){t.appId,e=t.customUploadUrl,t.fileupload,n=t.mapStaticAPIkey,t.accessToken,t.appModuleName,r=t.genereateCloudFileUrl},o.deleteFileMeta=function(e){window.Applozic.ALApiService.deleteFileMeta({data:{blobKey:e,url:t+"/rest/ws/aws/file/delete?key="+e},success:function(e){console.log(e)},error:function(){}})},o.getFilePreviewPath=function(e){return"object"==typeof e?'<a href="'+t+"/rest/ws/aws/file/"+e.blobKey+'" target="_blank">'+e.name+"</a>":""},o.getFilePreviewSize=function(e){return e?e>1048576?parseInt(e/1048576)+" MB":e>1024?parseInt(e/1024)+" KB":parseInt(e)+" B":""},o.getFileurl=function(n){var r;return"object"==typeof n.fileMeta?n.fileMeta.hasOwnProperty("url")?-1!==n.fileMeta.url.indexOf("www.googleapis.com")?(o.generateCloudUrl(n.fileMeta.blobKey,(function(e){r=e})),r):""+n.fileMeta.url:n.fileMeta.thumbnailUrl==="thumbnail_"+n.fileMeta.name?e+"/files/"+n.fileMeta.name:t+"/rest/ws/aws/file/"+n.fileMeta.blobKey:""},o.generateCloudUrl=function(e,t){var n=r.replace("{key}",e),o=window.Applozic.ALApiService.getAttachmentHeaders();mckUtils.ajax({type:"get",async:!1,skipEncryption:!0,headers:o,url:n,success:function(e){"function"==typeof t&&t(e)},error:function(e){console.log("error while getting token"+e)}})},o.getFilePath=function(t){if(2===t.contentType)try{var r=JSON.parse(t.message);if(r.lat&&r.lon)return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+r.lat+","+r.lon+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+r.lat+","+r.lon+"&maptype=roadmap&markers=color:red|"+r.lat+","+r.lon+"&key="+n+'"/></a>'}catch(e){if(-1!==t.message.indexOf(","))return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+t.message+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+t.message+"&maptype=roadmap&markers=color:red|"+t.message+"&key="+n+'" /></a>'}var a,s;return"object"==typeof t.fileMeta?-1!==t.fileMeta.contentType.indexOf("image")?-1!==t.fileMeta.contentType.indexOf("svg")?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+o.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+o.getFileurl(t)+'" area-hidden="true"></img></a>':5===t.contentType?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+t.fileMeta.blobKey+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.blobKey+'" area-hidden="true"></img></a>':t.fileMeta.hasOwnProperty("url")?-1!==t.fileMeta.url.indexOf("www.googleapis.com")?(o.generateCloudUrl(t.fileMeta.thumbnailBlobKey,(function(e){a=e})),'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="" data-blobKey="'+t.fileMeta.blobKey+'" data-name="'+t.fileMeta.name+'"><img src="'+a+'" area-hidden="true"></img></a>'):'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+o.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.thumbnailUrl+'" area-hidden="true"></img></a>':t.fileMeta.thumbnailUrl==="thumbnail_"+t.fileMeta.name?'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+o.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+e+"/files/thumbnail_"+t.fileMeta.name+'" area-hidden="true"></img></a>':'<a href="#" role="link" target="_self" class="file-preview-link fancybox-media imageview" data-type="'+t.fileMeta.contentType+'" data-url="'+o.getFileurl(t)+'" data-name="'+t.fileMeta.name+'"><img src="'+t.fileMeta.thumbnailUrl+'" area-hidden="true"></img></a>':-1!==t.fileMeta.contentType.indexOf("video")?t.fileMeta.hasOwnProperty("url")&&-1!==t.fileMeta.url.indexOf("www.googleapis.com")?(o.generateCloudUrl(t.fileMeta.blobKey,(function(e){s=e})),'<a href="#" target="_self"><video controls class="mck-video-player" onplay="alFileService.updateAudVidUrl(this);" data-cloud-service="google_cloud" data-blobKey="'+t.fileMeta.blobKey+'"><source src="'+s+'" type="video/mp4"><source src="'+s+'" type="video/ogg"></video>'):'<a href= "#" target="_self"><video controls class="mck-video-player"><source src="'+o.getFileurl(t)+'" type="video/mp4"><source src="'+o.getFileurl(t)+'" type="video/ogg"></video></a>':-1!==t.fileMeta.contentType.indexOf("audio")?t.fileMeta.hasOwnProperty("url")&&-1!==t.fileMeta.url.indexOf("www.googleapis.com")?(o.generateCloudUrl(t.fileMeta.blobKey,(function(e){s=e})),'<a href="#" target="_self"><audio controls class="mck-audio-player" onplay="alFileService.updateAudVidUrl(this);" data-cloud-service="google_cloud" data-blobKey="'+t.fileMeta.blobKey+'"><source src="'+s+'" type="audio/ogg"><source src="'+s+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>'):'<a href="#" target="_self"><audio controls class="mck-audio-player"><source src="'+o.getFileurl(t)+'" type="audio/ogg"><source src="'+o.getFileurl(t)+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>':'<a href="#" role="link" class="file-preview-link" target="_self"></a>':""},o.updateAudVidUrl=function(e){var t=e.dataset.blobkey,n=(new Date).getTime(),r=e.currentSrc;n>=1e3*o.fetchQueryString("Expires",r)&&(o.generateCloudUrl(t,(function(e){getUrl=e})),e.src=getUrl)},this.fetchQueryString=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t);return null==n&&console.log("The parameter is null for the searchedquery"),n[1]},o.getFileAttachment=function(e){if("object"==typeof e.fileMeta)return(-1!==e.fileMeta.contentType.indexOf("image")||-1!==e.fileMeta.contentType.indexOf("audio")||-1!==e.fileMeta.contentType.indexOf("video"))&&e.fileMeta.hasOwnProperty("url")&&-1!==e.fileMeta.url.indexOf("www.googleapis.com")?'<a href="javascript:void(0);" role="link" target="_self"  class="file-preview-link" data-blobKey="'+e.fileMeta.blobKey+'" data-cloud-service="google_cloud"><span class="file-detail mck-image-download"><span class="mck-file-name"><span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+alFileService.getFilePreviewSize(e.fileMeta.size)+"</span></span></a>":'<a href="'+o.getFileurl(e)+'" role="link" target="_self"  class="file-preview-link"><span class="file-detail mck-image-download"><span class="mck-file-name"><span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+alFileService.getFilePreviewSize(e.fileMeta.size)+"</span></span></a>"},o.getFileIcon=function(e){return e.fileMetaKey&&"object"==typeof e.fileMeta?-1!==e.fileMeta.contentType.indexOf("image")?'<span class="mck-icon--camera"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2" fill="rgba(38,50,56,.52)"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg></span>&nbsp;<span>Image</span>':-1!==e.fileMeta.contentType.indexOf("audio")?'<span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;<span>Audio</span>':-1!==e.fileMeta.contentType.indexOf("video")?'<span class="mck-icon--video"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="22" height="22"><path fill="rgba(38,50,56,.52)" d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l2.29 2.29c.63.63 1.71.18 1.71-.71V8.91c0-.89-1.08-1.34-1.71-.71L17 10.5z"/></svg></span>&nbsp;<span class="mck-icon-video-text">Video</span>':'<span class="mck-attachement-icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg></span>&nbsp;<span>File</span>':""},o.downloadfile=function(){var e=o.getFileurl(msg),t=document.createElement("a");t.download=thefilename,t.setAttribute("href",e);var n="data:text/csv;charset=utf-8;base64,"+someb64data;t.href=n,document.body.appendChild(t),t.click(),document.body.removeChild(t)}}!function(e){"use strict";"undefined"==typeof AlCustomService?e.Applozic.AlCustomService=function(){var t={logout:function(){void 0!==e.Applozic.ALSocket&&(e.Applozic.ALApiService.AUTH_TOKEN=null,e.Applozic.ALApiService.setAjaxHeaders("","","","",""),e.Applozic.ALApiService.setEncryptionKeys(null,null),e.Applozic.ALSocket.disconnect(),ALStorage.clearSessionStorageElements())}};return t}():console.log("ALCustomService already defined.")}(window);var alMessageService=new AlMessageService;function AlMessageService(){var e,t,n=this;n.init=function(n){MCK_FILE_URL=n.fileBaseUrl,e=n.visitor,t=e?"guest":n&&n.userId&&n.userId.toString().trim()},n.getConversation=function(e){n.getTopicId({conversationId:e.conversationId},(function(e){mckMessageLayout.populateMessage(e.messageType,e.message,e.notifyUser)}))},n.addMessageToTab=function(e,t,n){var r={to:e.to,groupId:e.groupId,deviceKey:e.deviceKey,contentType:e.contentType,message:e.message,conversationId:e.conversationId,topicId:e.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:e.key,storeOnDevice:!0,sent:!1,read:!0,metadata:e.metadata?e.metadata:""};r.type=e.type?e.type:5,e.fileMeta&&(r.fileMeta=e.fileMeta),"function"==typeof n&&n(r,t)},n.getMessages=function(e){var t={};e.startTime&&(t.endTime=e.startTime),void 0!==e.userId&&""!==e.userId?(e.isGroup?t.groupId=e.userId:t.userId=e.userId,t.pageSize=30,(IS_MCK_TOPIC_HEADER||IS_MCK_TOPIC_BOX)&&e.conversationId&&(t.conversationId=e.conversationId,void 0===MCK_TAB_CONVERSATION_MAP[e.userId]&&(t.conversationReq=!0))):t.mainPageSize=100,window.Applozic.ALApiService.getMessages({data:t,success:e.callback,error:e.callback})},n.getMessageList=function(e,t){var n=e.id,r={},o={};e.startTime&&(r.endTime=e.startTime),void 0!==e.clientGroupId&&""!==e.clientGroupId?(e.pageSize?r.pageSize=e.pageSize:r.pageSize=50,r.clientGroupId=e.clientGroupId,o={clientGroupId:e.clientGroupId}):void 0!==n&&""!==n?(e.pageSize?r.pageSize=e.pageSize:r.pageSize=50,""+e.isGroup=="true"?r.groupId=n:r.userId=n,o={id:n}):(e.mainPageSize?r.mainPageSize=e.pageSize:r.mainPageSize=50,o={id:""}),e.topicId&&(n||e.clientGroupId)&&(e.conversationId&&(r.conversationId=e.conversationId),e.topicId&&(o.topicId=e.topicId)),window.Applozic.ALApiService.getMessages({data:r,success:function(n){var r=n.data;if(o.status="success",void 0===r.message||0===r.message.length)o.messages=[];else{var a=r.message,s=new Array;a.forEach((function(e,n){"function"==typeof t&&t(e)})),o.messages=s}r.groupFeeds.length>0&&(o.id=r.groupFeeds[0].id),e.callback(r)},error:function(t){o.status="error",e.callback(o)}})},n.getReplyMessageByKey=function(e){return void 0===ALStorage.getMessageByKey(e)&&window.Applozic.ALApiService.updateReplyMessage({data:{key:e},async:!1,success:function(e){ALStorage.updateMckMessageArray(e)}}),ALStorage.getMessageByKey(e)},n.getTopicId=function(e,r){if(e.conversationId){var o="id="+e.conversationId;window.Applozic.ALApiService.getTopicId({data:{conversationId:e.conversationId},success:function(a){if("object"==typeof o&&"success"===o.status){var s=o.response;if("object"==typeof s){if(MCK_TOPIC_CONVERSATION_MAP[s.topicId]=[e.conversationId],MCK_CONVERSATION_MAP[e.conversationId]=s,s.topicDetail)try{MCK_TOPIC_DETAIL_MAP[s.topicId]=JSON.parse(s.topicDetail)}catch(e){w.console.log("Incorect Topic Detail!")}if("function"==typeof MCK_PRICE_DETAIL&&e.priceText&&(MCK_PRICE_DETAIL({custId:t,suppId:e.suppId,productId:s.topicId,price:e.priceText}),n.sendConversationCloseUpdate(e.conversationId)),e.messageType&&"object"==typeof e.message){var i=e.message.groupId?e.message.groupId:e.message.to;if(void 0!==MCK_TAB_CONVERSATION_MAP[i]){var c=MCK_TAB_CONVERSATION_MAP[i];c.push(s),MCK_TAB_CONVERSATION_MAP[i]=c}(void 0===e.populate||e.populate)&&"function"==typeof r&&r(e)}"function"==typeof e.callback&&e.callback(s)}}},error:function(){}})}},n.sendConversationCloseUpdate=function(e){if(e){window.Applozic.ALApiService.sendConversationCloseUpdate({conversationId:e,success:function(e){},error:function(){}})}},n.getMessageFeed=function(e){var n={};if(MCK_FILE_URL=window.Applozic.ALApiService.getFileUrl(),n.key=e.key,n.contentType=e.contentType,n.timeStamp=e.createdAtTime,n.message=e.message,n.from=4===e.type?e.to:t,e.groupId?n.to=e.groupId:n.to=5===e.type?e.to:t,n.status="read",n.type=4===e.type?"inbox":"outbox",5===e.type&&(3===e.status?n.status="sent":4===e.status&&(n.status="delivered")),"object"==typeof e.fileMeta){var r=mckUtils.extendObject({},{},e.fileMeta);void 0!==r.url&&""!==r.url||(r.url=MCK_FILE_URL+"/rest/ws/aws/file/"+e.fileMeta.blobKey),delete r.blobKey,n.file=r}return n.source=e.source,n.metadata=e.metadata,n}}