var $applozic = jQuery.noConflict(true);
if (typeof $original !== 'undefined') {
    $ = $original;
    jQuery = $original;
    if (typeof $.fn.template === 'function') {
        $applozic.fn.template = $.fn.template;
        jQuery.fn.template = $.fn.template;
    } else if (typeof $applozic.fn.template === 'function') {
        $.fn.template = $applozic.fn.template;
        jQuery.fn.template = $applozic.fn.template;
    }
}

function MckCallingService(identity, token, callId, toUserDisplayName, isCallHost, callStartTime, mckMessageService, toUserImage, isAudioCall, ringTone) {
    var _this = this;
    var $mckVidImageIcon = $applozic("#mck-vid-icon");
    var $mckSideBox = $applozic("#mck-sidebox");
    _this.callStartTime = callStartTime;
    _this.mckMessageService = mckMessageService;
    _this.identity = identity;
    _this.token = token;
    _this.callId = callId;
    _this.isCallHost = isCallHost;
    _this.toUserImage = toUserImage;
    _this.toUserDisplayName = toUserDisplayName;
    _this.isAudioCall =
        isAudioCall;
    _this.disconectedByHost;
    _this.rejectedByReceiver;
    _this.twilioService;
    console.log("is AudioCall:" + isAudioCall);
    _this.ringTone = ringTone;
    var $mck_msg_to = $applozic("#mck-msg-to");
    var $mck_vid_box = $applozic(".applozic-vid-container");
    var $mck_side_box = $applozic("#mck-sidebox");
    var $mck_video_call_indicator = $applozic("#mck-video-call-indicator");
    var $mck_unmute_icon = $applozic("#mck-unmute-icon");
    var $mck_mute_icon = $applozic("#mck-mute-icon");
    var $mck_mute_btn = $applozic("#mck-microfone-mute-btn");
    $applozic("#mck-microfone-mute-btn").off("click").on("click", function () {
        var toUser = $mck_msg_to.val();
        var room = _this.twilioService.activeRoom;
        if (room) {
            var localMedia = room.localParticipant.media;
            if (localMedia.isMuted) {
                $mck_unmute_icon.addClass("vis").removeClass("n-vis");
                $mck_mute_icon.addClass("n-vis").removeClass("vis");
                $mck_mute_btn.addClass("mck-unmuted").removeClass("mck-muted");
                localMedia.unmute()
            } else {
                $mck_mute_icon.addClass("vis").removeClass("n-vis");
                $mck_unmute_icon.addClass("n-vis").removeClass("vis");
                $mck_mute_btn.addClass("mck-muted").removeClass("mck-unmuted");
                localMedia.mute()
            }
        }
    });
    $applozic("#mck-vid-disconnect").off("click").on("click", function () {
        var toUser = $mck_msg_to.val();
        if (isCallHost) {
            _this.disconectedByHost = true;
            if (_this.twilioService.callReceivedAt) {
                var callDurationInMilis = (new Date).getTime() - _this.twilioService.callReceivedAt.getTime();
                alMessageService.sendVideoCallEndMessage(callId, "CALL_END", 103, false, callDurationInMilis, toUser, function (messagePxy) {
                    mckMessageService.sendMessage(messagePxy)
                })
            } else {
                _this.ringTone.stop();
                alMessageService.sendVideoCallMessage(callId, "CALL_MISSED", 103, false, toUser, function (messagePxy) {
                    mckMessageService.sendMessage(messagePxy)
                })
            }
        }
        _this.twilioService.leaveRoomIfJoined();
        _this.removeTracks(["#mck-vid-media \x3e video", "#mck-vid-media \x3e audio", "#local-media \x3e video", "#local-media \x3e audio"]);
        $mck_vid_box.addClass("n-vis").removeClass("vis");
        $mck_video_call_indicator.addClass("n-vis").removeClass("vis")
    });
    _this.startVideoCall = function () {
        if (!navigator.webkitGetUserMedia && !navigator.mozGetUserMedia) alert("WebRTC is not available in your browser. can not start video call");
        if (!_this.token) {
            alert("missing token.. can not make video call");
            $mck_vid_box.removeClass("vis").addClass("n-vis")
        }
        _this.twilioService = new TwilioService(_this.identity, _this.token, _this.callId, _this.ringTone, _this.isAudioCall, _this.mckMessageService, _this.isCallHost);
        var videoClient = _this.twilioService.InitializeVideoClient();
        if (isCallHost) {
            $mckVidImageIcon.html(toUserImage + "\x3cspan\x3e Calling " + toUserDisplayName + "\x3c/span\x3e");
            $mckVidImageIcon.removeClass("n-vis").addClass("vis");
            setTimeout(function () {
                    if (!_this.twilioService.isCallReceived &&
                        !_this.disconectedByHost && !_this.rejectedByReceiver) {
                        console.log("call is not answered....");
                        _this.ringTone.stop();
                        alMessageService.sendVideoCallMessage(callId, "CALL_MISSED", 103, isAudioCall, toUser, function (messagePxy) {
                            mckMessageService.sendMessage(messagePxy)
                        });
                        alert(toUserDisplayName + " not Available....");
                        _this.twilioService.leaveRoomIfJoined();
                        _this.removeTracks(["#mck-vid-media \x3e video", "#mck-vid-media \x3e audio", "#local-media \x3e video", "#local-media \x3e audio"]);
                        $mck_vid_box.addClass("n-vis").removeClass("vis")
                    }
                },
                7E4)
        }
        window.addEventListener("beforeunload", _this.twilioService.leaveRoomIfJoined);
        _this.twilioService.attachUserMedia(isCallHost, isAudioCall);
        _this.twilioService.joinCall(isAudioCall);
        $mck_vid_box.removeClass("n-vis").addClass("vis");
        $mck_unmute_icon.addClass("vis").removeClass("n-vis");
        $mck_mute_icon.addClass("n-vis").removeClass("vis");
        $mck_mute_btn.addClass("mck-unmuted").removeClass("mck-muted")
    };
    _this.removeTracks = function (selectors) {
        $applozic.each(selectors, function (index, value) {
            $applozic(value).remove()
        })
    }
}

function TwilioService(identity, token, callId, ringTone, isAudioCall, mckMessageService, isCallHost) {
    var _this = this;
    _this.identity = identity;
    _this.token = token;
    _this.callId = callId;
    _this.videoClient;
    _this.activeRoom;
    _this.previewMedia;
    _this.ringTone = ringTone;
    _this.isCallReceived;
    _this.callReceivedAt;
    _this.isAudioCall = isAudioCall;
    _this.mckMessageService = mckMessageService;
    _this.isCallHost = isCallHost;
    var $mck_msg_to = $applozic("#mck-msg-to");
    var $mckVidImageIcon = $applozic("#mck-vid-icon");
    var localMedia = "#local-media";
    var mckVidMedia = "#mck-vid-media";
    var $mcklocalVideo = $applozic("#local-media \x3e video");
    var $mckRemoteVideo = $applozic("#mck-vid-media \x3e video");
    var $localMedia = $applozic("#local-media");
    var $mck_vid_box = $applozic(".applozic-vid-container");
    var $mck_side_box = $applozic("#mck-sidebox");
    var $mck_video_call_indicator = $applozic("#mck-video-call-indicator");
    _this.InitializeVideoClient = function () {
        _this.videoClient = new Twilio.Video.Client(_this.token)
    };
    _this.joinCall = function (isAudioCall) {
        if (_this.videoClient) _this.videoClient.connect({
            to: _this.callId
        }).then(_this.roomJoined,
            function (error) {
                console.log("Could not connect to Twilio: " + error.message)
            })
    };
    _this.attachUserMedia = function (isCallHost, isAudioCall) {
        if (!_this.previewMedia) {
            _this.previewMedia = new Twilio.Video.LocalMedia;
            Twilio.Video.getUserMedia().then(function (mediaStream) {
                _this.previewMedia.addStream(mediaStream);
                if (isCallHost) {
                    _this.previewMedia.attach(mckVidMedia);
                    _this.ringTone.play()
                } else {
                    _this.previewMedia.attach(localMedia);
                    $localMedia.removeClass("n-vis").addClass("vis")
                }
            }, function (error) {
                console.error("Unable to access local media",
                    error);
                console.log("Unable to access Camera and Microphone")
            })
        }
    };
    _this.roomJoined = function (room) {
        console.log("room detail : " + room);
        _this.activeRoom = room;
        if (!_this.previewMedia) room.localParticipant.media.attach(mckVidMedia);
        room.participants.forEach(function (participant) {
            console.log("Already in Room: '" + participant.identity + "'");
            participant.media.attach("#mck-vid-media")
        });
        room.on("participantConnected", function (participant) {
            console.log("participent- " + participant.identity + "connected to the room- " +
                room);
            _this.isCallReceived = true;
            _this.callReceivedAt = new Date;
            console.log("callReceivedAt : " + _this.callReceivedAt);
            _this.ringTone.stop();
            $mckVidImageIcon.addClass("n-vis");
            $applozic("#mck-vid-media \x3e video").remove();
            $applozic("#mck-vid-media \x3e audio").remove();
            room.localParticipant.media.attach(localMedia);
            $localMedia.removeClass("n-vis").addClass("vis");
            participant.media.attach(mckVidMedia)
        });
        room.on("participantDisconnected", function (participant) {
            console.log("Participant '" + participant.identity +
                "' left the room");
            if (_this.isCallHost) {
                var toUser = $mck_msg_to.val();
                var callDurationInMilis = (new Date).getTime();
                _this.callReceivedAt.getTime();
                alMessageService.sendVideoCallEndMessage(callId, "CALL_END", 103, isAudioCall, callDurationInMilis, toUser, function (messagePxy) {
                    mckMessageService.sendMessage(messagePxy)
                })
            }
            participant.media.detach();
            _this.leaveRoomIfJoined();
            $mck_vid_box.addClass("n-vis").removeClass("vis");
            $mck_video_call_indicator.addClass("n-vis").removeClass("vis")
        });
        room.on("disconnected",
            function () {
                console.log("Left");
                room.localParticipant.media.detach();
                room.participants.forEach(function (participant) {
                    participant.media.detach()
                });
                _this.activeRoom = null
            })
    };
    _this.leaveRoomIfJoined = function leaveRoomIfJoined() {
        if (_this.activeRoom) _this.activeRoom.disconnect();
        if (_this.previewMedia) _this.previewMedia.stop()
    }
}! function (t) {
    if ("object" == typeof exports && "undefined" != typeof module) module.exports = t();
    else if ("function" == typeof define && define.amd) define([], t);
    else {
        var e;
        "undefined" != typeof window ? e = window : "undefined" != typeof global ? e = global : "undefined" != typeof self && (e = self), e.SockJS = t()
    }
}(function () {
    var t;
    return function e(t, n, r) {
        function i(s, a) {
            if (!n[s]) {
                if (!t[s]) {
                    var u = "function" == typeof require && require;
                    if (!a && u) return u(s, !0);
                    if (o) return o(s, !0);
                    var c = new Error("Cannot find module '" + s + "'");
                    throw c.code =
                        "MODULE_NOT_FOUND", c;
                }
                var l = n[s] = {
                    exports: {}
                };
                t[s][0].call(l.exports, function (e) {
                    var n = t[s][1][e];
                    return i(n ? n : e)
                }, l, l.exports, e, t, n, r)
            }
            return n[s].exports
        }
        for (var o = "function" == typeof require && require, s = 0; s < r.length; s++) i(r[s]);
        return i
    }({
        1: [function (t, e) {
            (function (n) {
                var r = t("./transport-list");
                e.exports = t("./main")(r), "_sockjs_onload" in n && setTimeout(n._sockjs_onload, 1)
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "./main": 14,
            "./transport-list": 16
        }],
        2: [function (t, e) {
            function n() {
                i.call(this), this.initEvent("close", !1, !1), this.wasClean = !1, this.code = 0, this.reason = ""
            }
            var r = t("inherits"),
                i = t("./event");
            r(n, i), e.exports = n
        }, {
            "./event": 4,
            inherits: 54
        }],
        3: [function (t, e) {
            function n() {
                i.call(this)
            }
            var r = t("inherits"),
                i = t("./eventtarget");
            r(n, i), n.prototype.removeAllListeners = function (t) {
                t ? delete this._listeners[t] : this._listeners = {}
            }, n.prototype.once = function (t, e) {
                function n() {
                    r.removeListener(t, n), i || (i = !0, e.apply(this, arguments))
                }
                var r = this,
                    i = !1;
                this.on(t, n)
            }, n.prototype.emit = function (t) {
                var e = this._listeners[t];
                if (e)
                    for (var n = Array.prototype.slice.call(arguments, 1), r = 0; r < e.length; r++) e[r].apply(this, n)
            }, n.prototype.on = n.prototype.addListener = i.prototype.addEventListener, n.prototype.removeListener = i.prototype.removeEventListener, e.exports.EventEmitter = n
        }, {
            "./eventtarget": 5,
            inherits: 54
        }],
        4: [function (t, e) {
            function n(t) {
                this.type = t
            }
            n.prototype.initEvent = function (t, e, n) {
                return this.type = t, this.bubbles = e, this.cancelable = n, this.timeStamp = +new Date, this
            }, n.prototype.stopPropagation = function () {}, n.prototype.preventDefault = function () {}, n.CAPTURING_PHASE = 1, n.AT_TARGET = 2, n.BUBBLING_PHASE = 3, e.exports = n
        }, {}],
        5: [function (t, e) {
            function n() {
                this._listeners = {}
            }
            n.prototype.addEventListener = function (t, e) {
                t in this._listeners || (this._listeners[t] = []);
                var n = this._listeners[t]; - 1 === n.indexOf(e) && (n = n.concat([e])), this._listeners[t] = n
            }, n.prototype.removeEventListener = function (t, e) {
                var n = this._listeners[t];
                if (n) {
                    var r = n.indexOf(e);
                    return -1 !== r ? void(n.length >
                        1 ? this._listeners[t] = n.slice(0, r).concat(n.slice(r + 1)) : delete this._listeners[t]) : void 0
                }
            }, n.prototype.dispatchEvent = function (t) {
                var e = t.type,
                    n = Array.prototype.slice.call(arguments, 0);
                if (this["on" + e] && this["on" + e].apply(this, n), e in this._listeners)
                    for (var r = this._listeners[e], i = 0; i < r.length; i++) r[i].apply(this, n)
            }, e.exports = n
        }, {}],
        6: [function (t, e) {
            function n(t) {
                i.call(this), this.initEvent("message", !1, !1), this.data = t
            }
            var r = t("inherits"),
                i = t("./event");
            r(n, i), e.exports = n
        }, {
            "./event": 4,
            inherits: 54
        }],
        7: [function (t, e) {
            function n(t) {
                this._transport = t, t.on("message", this._transportMessage.bind(this)), t.on("close", this._transportClose.bind(this))
            }
            var r = t("json3"),
                i = t("./utils/iframe");
            n.prototype._transportClose = function (t, e) {
                i.postMessage("c", r.stringify([t, e]))
            }, n.prototype._transportMessage = function (t) {
                i.postMessage("t", t)
            }, n.prototype._send = function (t) {
                this._transport.send(t)
            }, n.prototype._close = function () {
                this._transport.close(), this._transport.removeAllListeners()
            }, e.exports = n
        }, {
            "./utils/iframe": 47,
            json3: 55
        }],
        8: [function (t, e) {
            var n = t("./utils/url"),
                r = t("./utils/event"),
                i = t("json3"),
                o = t("./facade"),
                s = t("./info-iframe-receiver"),
                a = t("./utils/iframe"),
                u = t("./location");
            e.exports = function (t, e) {
                var c = {};
                e.forEach(function (t) {
                    t.facadeTransport && (c[t.facadeTransport.transportName] = t.facadeTransport)
                }), c[s.transportName] = s;
                var l;
                t.bootstrap_iframe = function () {
                    var e;
                    a.currentWindowId = u.hash.slice(1);
                    var s = function (r) {
                        if (r.source === parent && ("undefined" == typeof l && (l = r.origin), r.origin === l)) {
                            var s;
                            try {
                                s =
                                    i.parse(r.data)
                            } catch (f) {
                                return
                            }
                            if (s.windowId === a.currentWindowId) switch (s.type) {
                                case "s":
                                    var h;
                                    try {
                                        h = i.parse(s.data)
                                    } catch (f) {
                                        break
                                    }
                                    var d = h[0],
                                        p = h[1],
                                        v = h[2],
                                        m = h[3];
                                    if (d !== t.version) throw new Error('Incompatibile SockJS! Main site uses: "' + d + '", the iframe: "' + t.version + '".');
                                    if (!n.isOriginEqual(v, u.href) || !n.isOriginEqual(m, u.href)) throw new Error("Can't connect to different domain from within an iframe. (" + u.href + ", " + v + ", " + m + ")");
                                    e = new o(new c[p](v, m));
                                    break;
                                case "m":
                                    e._send(s.data);
                                    break;
                                case "c":
                                    e &&
                                        e._close(), e = null
                            }
                        }
                    };
                    r.attachEvent("message", s), a.postMessage("s")
                }
            }
        }, {
            "./facade": 7,
            "./info-iframe-receiver": 10,
            "./location": 13,
            "./utils/event": 46,
            "./utils/iframe": 47,
            "./utils/url": 52,
            debug: void 0,
            json3: 55
        }],
        9: [function (t, e) {
            function n(t, e) {
                r.call(this);
                var n = this,
                    i = +new Date;
                this.xo = new e("GET", t), this.xo.once("finish", function (t, e) {
                    var r, a;
                    if (200 === t) {
                        if (a = +new Date - i, e) try {
                            r = o.parse(e)
                        } catch (u) {}
                        s.isObject(r) || (r = {})
                    }
                    n.emit("finish", r, a), n.removeAllListeners()
                })
            }
            var r = t("events").EventEmitter,
                i = t("inherits"),
                o = t("json3"),
                s = t("./utils/object");
            i(n, r), n.prototype.close = function () {
                this.removeAllListeners(), this.xo.close()
            }, e.exports = n
        }, {
            "./utils/object": 49,
            debug: void 0,
            events: 3,
            inherits: 54,
            json3: 55
        }],
        10: [function (t, e) {
            function n(t) {
                var e = this;
                i.call(this), this.ir = new a(t, s), this.ir.once("finish", function (t, n) {
                    e.ir = null, e.emit("message", o.stringify([t, n]))
                })
            }
            var r = t("inherits"),
                i = t("events").EventEmitter,
                o = t("json3"),
                s = t("./transport/sender/xhr-local"),
                a = t("./info-ajax");
            r(n, i), n.transportName =
                "iframe-info-receiver", n.prototype.close = function () {
                    this.ir && (this.ir.close(), this.ir = null), this.removeAllListeners()
                }, e.exports = n
        }, {
            "./info-ajax": 9,
            "./transport/sender/xhr-local": 37,
            events: 3,
            inherits: 54,
            json3: 55
        }],
        11: [function (t, e) {
            (function (n) {
                function r(t, e) {
                    var r = this;
                    i.call(this);
                    var o = function () {
                        var n = r.ifr = new u(c.transportName, e, t);
                        n.once("message", function (t) {
                            if (t) {
                                var e;
                                try {
                                    e = s.parse(t)
                                } catch (n) {
                                    return r.emit("finish"), void r.close()
                                }
                                var i = e[0],
                                    o = e[1];
                                r.emit("finish", i, o)
                            }
                            r.close()
                        }), n.once("close",
                            function () {
                                r.emit("finish"), r.close()
                            })
                    };
                    n.document.body ? o() : a.attachEvent("load", o)
                }
                var i = t("events").EventEmitter,
                    o = t("inherits"),
                    s = t("json3"),
                    a = t("./utils/event"),
                    u = t("./transport/iframe"),
                    c = t("./info-iframe-receiver");
                o(r, i), r.enabled = function () {
                    return u.enabled()
                }, r.prototype.close = function () {
                    this.ifr && this.ifr.close(), this.removeAllListeners(), this.ifr = null
                }, e.exports = r
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "./info-iframe-receiver": 10,
            "./transport/iframe": 22,
            "./utils/event": 46,
            debug: void 0,
            events: 3,
            inherits: 54,
            json3: 55
        }],
        12: [function (t, e) {
            function n(t, e) {
                var n = this;
                r.call(this), setTimeout(function () {
                    n.doXhr(t, e)
                }, 0)
            }
            var r = t("events").EventEmitter,
                i = t("inherits"),
                o = t("./utils/url"),
                s = t("./transport/sender/xdr"),
                a = t("./transport/sender/xhr-cors"),
                u = t("./transport/sender/xhr-local"),
                c = t("./transport/sender/xhr-fake"),
                l = t("./info-iframe"),
                f = t("./info-ajax");
            i(n, r), n._getReceiver = function (t, e, n) {
                return n.sameOrigin ? new f(e, u) : a.enabled ?
                    new f(e, a) : s.enabled && n.sameScheme ? new f(e, s) : l.enabled() ? new l(t, e) : new f(e, c)
            }, n.prototype.doXhr = function (t, e) {
                var r = this,
                    i = o.addPath(t, "/info");
                this.xo = n._getReceiver(t, i, e), this.timeoutRef = setTimeout(function () {
                    r._cleanup(!1), r.emit("finish")
                }, n.timeout), this.xo.once("finish", function (t, e) {
                    r._cleanup(!0), r.emit("finish", t, e)
                })
            }, n.prototype._cleanup = function (t) {
                clearTimeout(this.timeoutRef), this.timeoutRef = null, !t && this.xo && this.xo.close(), this.xo = null
            }, n.prototype.close = function () {
                this.removeAllListeners(),
                    this._cleanup(!1)
            }, n.timeout = 8E3, e.exports = n
        }, {
            "./info-ajax": 9,
            "./info-iframe": 11,
            "./transport/sender/xdr": 34,
            "./transport/sender/xhr-cors": 35,
            "./transport/sender/xhr-fake": 36,
            "./transport/sender/xhr-local": 37,
            "./utils/url": 52,
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        13: [function (t, e) {
            (function (t) {
                e.exports = t.location || {
                    origin: "http://localhost:80",
                    protocol: "http",
                    host: "localhost",
                    port: 80,
                    href: "http://localhost/",
                    hash: ""
                }
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" !=
                typeof window ? window : {})
        }, {}],
        14: [function (t, e) {
            (function (n) {
                function r(t, e, n) {
                    if (!(this instanceof r)) return new r(t, e, n);
                    if (arguments.length < 1) throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");
                    y.call(this), this.readyState = r.CONNECTING, this.extensions = "", this.protocol = "", n = n || {}, n.protocols_whitelist && m.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."), this._transportsWhitelist = n.transports;
                    var i = n.sessionId || 8;
                    if ("function" == typeof i) this._generateSessionId =
                        i;
                    else {
                        if ("number" != typeof i) throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");
                        this._generateSessionId = function () {
                            return c.string(i)
                        }
                    }
                    this._server = n.server || c.numberString(1E3);
                    var o = new s(t);
                    if (!o.host || !o.protocol) throw new SyntaxError("The URL '" + t + "' is invalid");
                    if (o.hash) throw new SyntaxError("The URL must not contain a fragment");
                    if ("http:" !== o.protocol && "https:" !== o.protocol) throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '" +
                        o.protocol + "' is not allowed.");
                    var a = "https:" === o.protocol;
                    if ("https" === g.protocol && !a) throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");
                    e ? Array.isArray(e) || (e = [e]) : e = [];
                    var u = e.sort();
                    u.forEach(function (t, e) {
                        if (!t) throw new SyntaxError("The protocols entry '" + t + "' is invalid.");
                        if (e < u.length - 1 && t === u[e + 1]) throw new SyntaxError("The protocols entry '" + t + "' is duplicated.");
                    });
                    var l = f.getOrigin(g.href);
                    this._origin = l ? l.toLowerCase() :
                        null, o.set("pathname", o.pathname.replace(/\/+$/, "")), this.url = o.href, this._urlInfo = {
                            nullOrigin: !v.hasDomain(),
                            sameOrigin: f.isOriginEqual(this.url, g.href),
                            sameScheme: f.isSchemeEqual(this.url, g.href)
                        }, this._ir = new _(this.url, this._urlInfo), this._ir.once("finish", this._receiveInfo.bind(this))
                }

                function i(t) {
                    return 1E3 === t || t >= 3E3 && 4999 >= t
                }
                t("./shims");
                var o, s = t("url-parse"),
                    a = t("inherits"),
                    u = t("json3"),
                    c = t("./utils/random"),
                    l = t("./utils/escape"),
                    f = t("./utils/url"),
                    h = t("./utils/event"),
                    d = t("./utils/transport"),
                    p = t("./utils/object"),
                    v = t("./utils/browser"),
                    m = t("./utils/log"),
                    b = t("./event/event"),
                    y = t("./event/eventtarget"),
                    g = t("./location"),
                    w = t("./event/close"),
                    x = t("./event/trans-message"),
                    _ = t("./info-receiver");
                a(r, y), r.prototype.close = function (t, e) {
                        if (t && !i(t)) throw new Error("InvalidAccessError: Invalid code");
                        if (e && e.length > 123) throw new SyntaxError("reason argument has an invalid length");
                        if (this.readyState !== r.CLOSING && this.readyState !== r.CLOSED) {
                            var n = !0;
                            this._close(t || 1E3, e || "Normal closure", n)
                        }
                    },
                    r.prototype.send = function (t) {
                        if ("string" != typeof t && (t = "" + t), this.readyState === r.CONNECTING) throw new Error("InvalidStateError: The connection has not been established yet");
                        this.readyState === r.OPEN && this._transport.send(l.quote(t))
                    }, r.version = t("./version"), r.CONNECTING = 0, r.OPEN = 1, r.CLOSING = 2, r.CLOSED = 3, r.prototype._receiveInfo = function (t, e) {
                        if (this._ir = null, !t) return void this._close(1002, "Cannot connect to server");
                        this._rto = this.countRTO(e), this._transUrl = t.base_url ? t.base_url : this.url, t = p.extend(t,
                            this._urlInfo);
                        var n = o.filterToEnabled(this._transportsWhitelist, t);
                        this._transports = n.main, this._connect()
                    }, r.prototype._connect = function () {
                        for (var t = this._transports.shift(); t; t = this._transports.shift()) {
                            if (t.needBody && (!n.document.body || "undefined" != typeof n.document.readyState && "complete" !== n.document.readyState && "interactive" !== n.document.readyState)) return this._transports.unshift(t), void h.attachEvent("load", this._connect.bind(this));
                            var e = this._rto * t.roundTrips || 5E3;
                            this._transportTimeoutId =
                                setTimeout(this._transportTimeout.bind(this), e);
                            var r = f.addPath(this._transUrl, "/" + this._server + "/" + this._generateSessionId()),
                                i = new t(r, this._transUrl);
                            return i.on("message", this._transportMessage.bind(this)), i.once("close", this._transportClose.bind(this)), i.transportName = t.transportName, void(this._transport = i)
                        }
                        this._close(2E3, "All transports failed", !1)
                    }, r.prototype._transportTimeout = function () {
                        this.readyState === r.CONNECTING && this._transportClose(2007, "Transport timed out")
                    }, r.prototype._transportMessage =
                    function (t) {
                        var e, n = this,
                            r = t.slice(0, 1),
                            i = t.slice(1);
                        switch (r) {
                            case "o":
                                return void this._open();
                            case "h":
                                return void this.dispatchEvent(new b("heartbeat"))
                        }
                        if (i) try {
                            e = u.parse(i)
                        } catch (o) {}
                        if ("undefined" != typeof e) switch (r) {
                            case "a":
                                Array.isArray(e) && e.forEach(function (t) {
                                    n.dispatchEvent(new x(t))
                                });
                                break;
                            case "m":
                                this.dispatchEvent(new x(e));
                                break;
                            case "c":
                                Array.isArray(e) && 2 === e.length && this._close(e[0], e[1], !0)
                        }
                    }, r.prototype._transportClose = function (t, e) {
                        return this._transport && (this._transport.removeAllListeners(),
                            this._transport = null, this.transport = null), i(t) || 2E3 === t || this.readyState !== r.CONNECTING ? void this._close(t, e) : void this._connect()
                    }, r.prototype._open = function () {
                        this.readyState === r.CONNECTING ? (this._transportTimeoutId && (clearTimeout(this._transportTimeoutId), this._transportTimeoutId = null), this.readyState = r.OPEN, this.transport = this._transport.transportName, this.dispatchEvent(new b("open"))) : this._close(1006, "Server lost session")
                    }, r.prototype._close = function (t, e, n) {
                        var i = !1;
                        if (this._ir && (i = !0, this._ir.close(),
                                this._ir = null), this._transport && (this._transport.close(), this._transport = null, this.transport = null), this.readyState === r.CLOSED) throw new Error("InvalidStateError: SockJS has already been closed");
                        this.readyState = r.CLOSING, setTimeout(function () {
                            this.readyState = r.CLOSED, i && this.dispatchEvent(new b("error"));
                            var o = new w("close");
                            o.wasClean = n || !1, o.code = t || 1E3, o.reason = e, this.dispatchEvent(o), this.onmessage = this.onclose = this.onerror = null
                        }.bind(this), 0)
                    }, r.prototype.countRTO = function (t) {
                        return t > 100 ? 4 *
                            t : 300 + t
                    }, e.exports = function (e) {
                        return o = d(e), t("./iframe-bootstrap")(r, e), r
                    }
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "./event/close": 2,
            "./event/event": 4,
            "./event/eventtarget": 5,
            "./event/trans-message": 6,
            "./iframe-bootstrap": 8,
            "./info-receiver": 12,
            "./location": 13,
            "./shims": 15,
            "./utils/browser": 44,
            "./utils/escape": 45,
            "./utils/event": 46,
            "./utils/log": 48,
            "./utils/object": 49,
            "./utils/random": 50,
            "./utils/transport": 51,
            "./utils/url": 52,
            "./version": 53,
            debug: void 0,
            inherits: 54,
            json3: 55,
            "url-parse": 56
        }],
        15: [function () {
            function t(t) {
                var e = +t;
                return e !== e ? e = 0 : 0 !== e && e !== 1 / 0 && e !== -(1 / 0) && (e = (e > 0 || -1) * Math.floor(Math.abs(e))), e
            }

            function e(t) {
                return t >>> 0
            }

            function n() {}
            var r, i = Array.prototype,
                o = Object.prototype,
                s = Function.prototype,
                a = String.prototype,
                u = i.slice,
                c = o.toString,
                l = function (t) {
                    return "[object Function]" === o.toString.call(t)
                },
                f = function (t) {
                    return "[object Array]" === c.call(t)
                },
                h = function (t) {
                    return "[object String]" === c.call(t)
                },
                d =
                Object.defineProperty && function () {
                    try {
                        return Object.defineProperty({}, "x", {}), !0
                    } catch (t) {
                        return !1
                    }
                }();
            r = d ? function (t, e, n, r) {
                !r && e in t || Object.defineProperty(t, e, {
                    configurable: !0,
                    enumerable: !1,
                    writable: !0,
                    value: n
                })
            } : function (t, e, n, r) {
                !r && e in t || (t[e] = n)
            };
            var p = function (t, e, n) {
                    for (var i in e) o.hasOwnProperty.call(e, i) && r(t, i, e[i], n)
                },
                v = function (t) {
                    if (null == t) throw new TypeError("can't convert " + t + " to object");
                    return Object(t)
                };
            p(s, {
                bind: function (t) {
                    var e = this;
                    if (!l(e)) throw new TypeError("Function.prototype.bind called on incompatible " +
                        e);
                    for (var r = u.call(arguments, 1), i = function () {
                            if (this instanceof c) {
                                var n = e.apply(this, r.concat(u.call(arguments)));
                                return Object(n) === n ? n : this
                            }
                            return e.apply(t, r.concat(u.call(arguments)))
                        }, o = Math.max(0, e.length - r.length), s = [], a = 0; o > a; a++) s.push("$" + a);
                    var c = Function("binder", "return function (" + s.join(",") + "){ return binder.apply(this, arguments); }")(i);
                    return e.prototype && (n.prototype = e.prototype, c.prototype = new n, n.prototype = null), c
                }
            }), p(Array, {
                isArray: f
            });
            var m = Object("a"),
                b = "a" !== m[0] || !(0 in
                    m),
                y = function (t) {
                    var e = !0,
                        n = !0;
                    return t && (t.call("foo", function (t, n, r) {
                        "object" != typeof r && (e = !1)
                    }), t.call([1], function () {
                        n = "string" == typeof this
                    }, "x")), !!t && e && n
                };
            p(i, {
                forEach: function (t) {
                    var e = v(this),
                        n = b && h(this) ? this.split("") : e,
                        r = arguments[1],
                        i = -1,
                        o = n.length >>> 0;
                    if (!l(t)) throw new TypeError;
                    for (; ++i < o;) i in n && t.call(r, n[i], i, e)
                }
            }, !y(i.forEach));
            var g = Array.prototype.indexOf && -1 !== [0, 1].indexOf(1, 2);
            p(i, {
                indexOf: function (e) {
                    var n = b && h(this) ? this.split("") : v(this),
                        r = n.length >>> 0;
                    if (!r) return -1;
                    var i = 0;
                    for (arguments.length > 1 && (i = t(arguments[1])), i = i >= 0 ? i : Math.max(0, r + i); r > i; i++)
                        if (i in n && n[i] === e) return i;
                    return -1
                }
            }, g);
            var w = a.split;
            2 !== "ab".split(/(?:ab)*/).length || 4 !== ".".split(/(.?)(.?)/).length || "t" === "tesst".split(/(s)*/)[1] || 4 !== "test".split(/(?:)/, -1).length || "".split(/.?/).length || ".".split(/()()/).length > 1 ? ! function () {
                var t = void 0 === /()??/.exec("")[1];
                a.split = function (n, r) {
                    var o = this;
                    if (void 0 === n && 0 === r) return [];
                    if ("[object RegExp]" !== c.call(n)) return w.call(this, n, r);
                    var s, a,
                        u, l, f = [],
                        h = (n.ignoreCase ? "i" : "") + (n.multiline ? "m" : "") + (n.extended ? "x" : "") + (n.sticky ? "y" : ""),
                        d = 0;
                    for (n = new RegExp(n.source, h + "g"), o += "", t || (s = new RegExp("^" + n.source + "$(?!\\s)", h)), r = void 0 === r ? -1 >>> 0 : e(r);
                        (a = n.exec(o)) && (u = a.index + a[0].length, !(u > d && (f.push(o.slice(d, a.index)), !t && a.length > 1 && a[0].replace(s, function () {
                            for (var t = 1; t < arguments.length - 2; t++) void 0 === arguments[t] && (a[t] = void 0)
                        }), a.length > 1 && a.index < o.length && i.push.apply(f, a.slice(1)), l = a[0].length, d = u, f.length >= r)));) n.lastIndex ===
                        a.index && n.lastIndex++;
                    return d === o.length ? (l || !n.test("")) && f.push("") : f.push(o.slice(d)), f.length > r ? f.slice(0, r) : f
                }
            }() : "0".split(void 0, 0).length && (a.split = function (t, e) {
                return void 0 === t && 0 === e ? [] : w.call(this, t, e)
            });
            var x = "\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",
                _ = "\u200b",
                E = "[" + x + "]",
                S = new RegExp("^" + E + E + "*"),
                O = new RegExp(E + E + "*$"),
                T = a.trim && (x.trim() || !_.trim());
            p(a, {
                trim: function () {
                    if (void 0 === this ||
                        null === this) throw new TypeError("can't convert " + this + " to object");
                    return String(this).replace(S, "").replace(O, "")
                }
            }, T);
            var j = a.substr,
                C = "".substr && "b" !== "0b".substr(-1);
            p(a, {
                substr: function (t, e) {
                    return j.call(this, 0 > t && (t = this.length + t) < 0 ? 0 : t, e)
                }
            }, C)
        }, {}],
        16: [function (t, e) {
            e.exports = [t("./transport/websocket"), t("./transport/xhr-streaming"), t("./transport/xdr-streaming"), t("./transport/eventsource"), t("./transport/lib/iframe-wrap")(t("./transport/eventsource")), t("./transport/htmlfile"), t("./transport/lib/iframe-wrap")(t("./transport/htmlfile")),
                t("./transport/xhr-polling"), t("./transport/xdr-polling"), t("./transport/lib/iframe-wrap")(t("./transport/xhr-polling")), t("./transport/jsonp-polling")
            ]
        }, {
            "./transport/eventsource": 20,
            "./transport/htmlfile": 21,
            "./transport/jsonp-polling": 23,
            "./transport/lib/iframe-wrap": 26,
            "./transport/websocket": 38,
            "./transport/xdr-polling": 39,
            "./transport/xdr-streaming": 40,
            "./transport/xhr-polling": 41,
            "./transport/xhr-streaming": 42
        }],
        17: [function (t, e) {
            (function (n) {
                function r(t, e, n, r) {
                    var o = this;
                    i.call(this), setTimeout(function () {
                        o._start(t,
                            e, n, r)
                    }, 0)
                }
                var i = t("events").EventEmitter,
                    o = t("inherits"),
                    s = t("../../utils/event"),
                    a = t("../../utils/url"),
                    u = n.XMLHttpRequest;
                o(r, i), r.prototype._start = function (t, e, n, i) {
                    var o = this;
                    try {
                        this.xhr = new u
                    } catch (c) {}
                    if (!this.xhr) return this.emit("finish", 0, "no xhr support"), void this._cleanup();
                    e = a.addQuery(e, "t\x3d" + +new Date), this.unloadRef = s.unloadAdd(function () {
                        o._cleanup(!0)
                    });
                    try {
                        this.xhr.open(t, e, !0), this.timeout && "timeout" in this.xhr && (this.xhr.timeout = this.timeout, this.xhr.ontimeout = function () {
                            o.emit("finish",
                                0, ""), o._cleanup(!1)
                        })
                    } catch (l) {
                        return this.emit("finish", 0, ""), void this._cleanup(!1)
                    }
                    if (i && i.noCredentials || !r.supportsCORS || (this.xhr.withCredentials = "true"), i && i.headers)
                        for (var f in i.headers) this.xhr.setRequestHeader(f, i.headers[f]);
                    this.xhr.onreadystatechange = function () {
                        if (o.xhr) {
                            var t, e, n = o.xhr;
                            switch (n.readyState) {
                                case 3:
                                    try {
                                        e = n.status, t = n.responseText
                                    } catch (r) {}
                                    1223 === e && (e = 204), 200 === e && t && t.length > 0 && o.emit("chunk", e, t);
                                    break;
                                case 4:
                                    e = n.status, 1223 === e && (e = 204), (12005 === e || 12029 === e) &&
                                        (e = 0), o.emit("finish", e, n.responseText), o._cleanup(!1)
                            }
                        }
                    };
                    try {
                        o.xhr.send(n)
                    } catch (l) {
                        o.emit("finish", 0, ""), o._cleanup(!1)
                    }
                }, r.prototype._cleanup = function (t) {
                    if (this.xhr) {
                        if (this.removeAllListeners(), s.unloadDel(this.unloadRef), this.xhr.onreadystatechange = function () {}, this.xhr.ontimeout && (this.xhr.ontimeout = null), t) try {
                            this.xhr.abort()
                        } catch (e) {}
                        this.unloadRef = this.xhr = null
                    }
                }, r.prototype.close = function () {
                    this._cleanup(!0)
                }, r.enabled = !!u;
                var c = ["Active"].concat("Object").join("X");
                !r.enabled && c in n &&
                    (u = function () {
                        try {
                            return new n[c]("Microsoft.XMLHTTP")
                        } catch (t) {
                            return null
                        }
                    }, r.enabled = !!new u);
                var l = !1;
                try {
                    l = "withCredentials" in new u
                } catch (f) {}
                r.supportsCORS = l, e.exports = r
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "../../utils/event": 46,
            "../../utils/url": 52,
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        18: [function (t, e) {
            (function (t) {
                e.exports = t.EventSource
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self :
                "undefined" != typeof window ? window : {})
        }, {}],
        19: [function (t, e) {
            (function (t) {
                e.exports = t.WebSocket || t.MozWebSocket
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {}],
        20: [function (t, e) {
            function n(t) {
                if (!n.enabled()) throw new Error("Transport created when disabled");
                i.call(this, t, "/eventsource", o, s)
            }
            var r = t("inherits"),
                i = t("./lib/ajax-based"),
                o = t("./receiver/eventsource"),
                s = t("./sender/xhr-cors"),
                a = t("eventsource");
            r(n, i), n.enabled = function () {
                    return !!a
                },
                n.transportName = "eventsource", n.roundTrips = 2, e.exports = n
        }, {
            "./lib/ajax-based": 24,
            "./receiver/eventsource": 29,
            "./sender/xhr-cors": 35,
            eventsource: 18,
            inherits: 54
        }],
        21: [function (t, e) {
                function n(t) {
                    if (!i.enabled) throw new Error("Transport created when disabled");
                    s.call(this, t, "/htmlfile", i, o)
                }
                var r = t("inherits"),
                    i = t("./receiver/htmlfile"),
                    o = t("./sender/xhr-local"),
                    s = t("./lib/ajax-based");
                r(n, s), n.enabled = function (t) {
                    return i.enabled && t.sameOrigin
                }, n.transportName = "htmlfile", n.roundTrips = 2, e.exports = n
            },
            {
                "./lib/ajax-based": 24,
                "./receiver/htmlfile": 30,
                "./sender/xhr-local": 37,
                inherits: 54
            }
        ],
        22: [function (t, e) {
            function n(t, e, r) {
                if (!n.enabled()) throw new Error("Transport created when disabled");
                o.call(this);
                var i = this;
                this.origin = a.getOrigin(r), this.baseUrl = r, this.transUrl = e, this.transport = t, this.windowId = l.string(8);
                var s = a.addPath(r, "/iframe.html") + "#" + this.windowId;
                this.iframeObj = u.createIframe(s, function (t) {
                        i.emit("close", 1006, "Unable to load an iframe (" + t + ")"), i.close()
                    }), this.onmessageCallback =
                    this._message.bind(this), c.attachEvent("message", this.onmessageCallback)
            }
            var r = t("inherits"),
                i = t("json3"),
                o = t("events").EventEmitter,
                s = t("../version"),
                a = t("../utils/url"),
                u = t("../utils/iframe"),
                c = t("../utils/event"),
                l = t("../utils/random");
            r(n, o), n.prototype.close = function () {
                    if (this.removeAllListeners(), this.iframeObj) {
                        c.detachEvent("message", this.onmessageCallback);
                        try {
                            this.postMessage("c")
                        } catch (t) {}
                        this.iframeObj.cleanup(), this.iframeObj = null, this.onmessageCallback = this.iframeObj = null
                    }
                }, n.prototype._message =
                function (t) {
                    if (a.isOriginEqual(t.origin, this.origin)) {
                        var e;
                        try {
                            e = i.parse(t.data)
                        } catch (n) {
                            return
                        }
                        if (e.windowId === this.windowId) switch (e.type) {
                            case "s":
                                this.iframeObj.loaded(), this.postMessage("s", i.stringify([s, this.transport, this.transUrl, this.baseUrl]));
                                break;
                            case "t":
                                this.emit("message", e.data);
                                break;
                            case "c":
                                var r;
                                try {
                                    r = i.parse(e.data)
                                } catch (n) {
                                    return
                                }
                                this.emit("close", r[0], r[1]), this.close()
                        }
                    }
                }, n.prototype.postMessage = function (t, e) {
                    this.iframeObj.post(i.stringify({
                        windowId: this.windowId,
                        type: t,
                        data: e || ""
                    }), this.origin)
                }, n.prototype.send = function (t) {
                    this.postMessage("m", t)
                }, n.enabled = function () {
                    return u.iframeEnabled
                }, n.transportName = "iframe", n.roundTrips = 2, e.exports = n
        }, {
            "../utils/event": 46,
            "../utils/iframe": 47,
            "../utils/random": 50,
            "../utils/url": 52,
            "../version": 53,
            debug: void 0,
            events: 3,
            inherits: 54,
            json3: 55
        }],
        23: [function (t, e) {
            (function (n) {
                function r(t) {
                    if (!r.enabled()) throw new Error("Transport created when disabled");
                    o.call(this, t, "/jsonp", a, s)
                }
                var i = t("inherits"),
                    o = t("./lib/sender-receiver"),
                    s = t("./receiver/jsonp"),
                    a = t("./sender/jsonp");
                i(r, o), r.enabled = function () {
                    return !!n.document
                }, r.transportName = "jsonp-polling", r.roundTrips = 1, r.needBody = !0, e.exports = r
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "./lib/sender-receiver": 28,
            "./receiver/jsonp": 31,
            "./sender/jsonp": 33,
            inherits: 54
        }],
        24: [function (t, e) {
            function n(t) {
                return function (e, n, r) {
                    var i = {};
                    "string" == typeof n && (i.headers = {
                        "Content-type": "text/plain"
                    });
                    var s = o.addPath(e,
                            "/xhr_send"),
                        a = new t("POST", s, n, i);
                    return a.once("finish", function (t) {
                            return a = null, 200 !== t && 204 !== t ? r(new Error("http status " + t)) : void r()
                        }),
                        function () {
                            a.close(), a = null;
                            var t = new Error("Aborted");
                            t.code = 1E3, r(t)
                        }
                }
            }

            function r(t, e, r, i) {
                s.call(this, t, e, n(i), r, i)
            }
            var i = t("inherits"),
                o = t("../../utils/url"),
                s = t("./sender-receiver");
            i(r, s), e.exports = r
        }, {
            "../../utils/url": 52,
            "./sender-receiver": 28,
            debug: void 0,
            inherits: 54
        }],
        25: [function (t, e) {
            function n(t, e) {
                i.call(this), this.sendBuffer = [], this.sender = e,
                    this.url = t
            }
            var r = t("inherits"),
                i = t("events").EventEmitter;
            r(n, i), n.prototype.send = function (t) {
                this.sendBuffer.push(t), this.sendStop || this.sendSchedule()
            }, n.prototype.sendScheduleWait = function () {
                var t, e = this;
                this.sendStop = function () {
                    e.sendStop = null, clearTimeout(t)
                }, t = setTimeout(function () {
                    e.sendStop = null, e.sendSchedule()
                }, 25)
            }, n.prototype.sendSchedule = function () {
                var t = this;
                if (this.sendBuffer.length > 0) {
                    var e = "[" + this.sendBuffer.join(",") + "]";
                    this.sendStop = this.sender(this.url, e, function (e) {
                        t.sendStop =
                            null, e ? (t.emit("close", e.code || 1006, "Sending error: " + e), t._cleanup()) : t.sendScheduleWait()
                    }), this.sendBuffer = []
                }
            }, n.prototype._cleanup = function () {
                this.removeAllListeners()
            }, n.prototype.stop = function () {
                this._cleanup(), this.sendStop && (this.sendStop(), this.sendStop = null)
            }, e.exports = n
        }, {
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        26: [function (t, e) {
            (function (n) {
                var r = t("inherits"),
                    i = t("../iframe"),
                    o = t("../../utils/object");
                e.exports = function (t) {
                    function e(e, n) {
                        i.call(this, t.transportName, e, n)
                    }
                    return r(e, i), e.enabled =
                        function (e, r) {
                            if (!n.document) return !1;
                            var s = o.extend({}, r);
                            return s.sameOrigin = !0, t.enabled(s) && i.enabled()
                        }, e.transportName = "iframe-" + t.transportName, e.needBody = !0, e.roundTrips = i.roundTrips + t.roundTrips - 1, e.facadeTransport = t, e
                }
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "../../utils/object": 49,
            "../iframe": 22,
            inherits: 54
        }],
        27: [function (t, e) {
            function n(t, e, n) {
                i.call(this), this.Receiver = t, this.receiveUrl = e, this.AjaxObject = n, this._scheduleReceiver()
            }
            var r = t("inherits"),
                i = t("events").EventEmitter;
            r(n, i), n.prototype._scheduleReceiver = function () {
                var t = this,
                    e = this.poll = new this.Receiver(this.receiveUrl, this.AjaxObject);
                e.on("message", function (e) {
                    t.emit("message", e)
                }), e.once("close", function (n, r) {
                    t.poll = e = null, t.pollIsClosing || ("network" === r ? t._scheduleReceiver() : (t.emit("close", n || 1006, r), t.removeAllListeners()))
                })
            }, n.prototype.abort = function () {
                this.removeAllListeners(), this.pollIsClosing = !0, this.poll && this.poll.abort()
            }, e.exports = n
        }, {
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        28: [function (t, e) {
            function n(t, e, n, r, a) {
                var u = i.addPath(t, e),
                    c = this;
                o.call(this, t, n), this.poll = new s(r, u, a), this.poll.on("message", function (t) {
                    c.emit("message", t)
                }), this.poll.once("close", function (t, e) {
                    c.poll = null, c.emit("close", t, e), c.close()
                })
            }
            var r = t("inherits"),
                i = t("../../utils/url"),
                o = t("./buffered-sender"),
                s = t("./polling");
            r(n, o), n.prototype.close = function () {
                this.removeAllListeners(), this.poll && (this.poll.abort(), this.poll = null), this.stop()
            }, e.exports = n
        }, {
            "../../utils/url": 52,
            "./buffered-sender": 25,
            "./polling": 27,
            debug: void 0,
            inherits: 54
        }],
        29: [function (t, e) {
            function n(t) {
                i.call(this);
                var e = this,
                    n = this.es = new o(t);
                n.onmessage = function (t) {
                    e.emit("message", decodeURI(t.data))
                }, n.onerror = function (t) {
                    var r = 2 !== n.readyState ? "network" : "permanent";
                    e._cleanup(), e._close(r)
                }
            }
            var r = t("inherits"),
                i = t("events").EventEmitter,
                o = t("eventsource");
            r(n, i), n.prototype.abort = function () {
                this._cleanup(), this._close("user")
            }, n.prototype._cleanup = function () {
                var t = this.es;
                t && (t.onmessage = t.onerror =
                    null, t.close(), this.es = null)
            }, n.prototype._close = function (t) {
                var e = this;
                setTimeout(function () {
                    e.emit("close", null, t), e.removeAllListeners()
                }, 200)
            }, e.exports = n
        }, {
            debug: void 0,
            events: 3,
            eventsource: 18,
            inherits: 54
        }],
        30: [function (t, e) {
            (function (n) {
                function r(t) {
                    a.call(this);
                    var e = this;
                    o.polluteGlobalNamespace(), this.id = "a" + u.string(6), t = s.addQuery(t, "c\x3d" + decodeURIComponent(o.WPrefix + "." + this.id));
                    var i = r.htmlfileEnabled ? o.createHtmlfile : o.createIframe;
                    n[o.WPrefix][this.id] = {
                        start: function () {
                            e.iframeObj.loaded()
                        },
                        message: function (t) {
                            e.emit("message", t)
                        },
                        stop: function () {
                            e._cleanup(), e._close("network")
                        }
                    }, this.iframeObj = i(t, function () {
                        e._cleanup(), e._close("permanent")
                    })
                }
                var i = t("inherits"),
                    o = t("../../utils/iframe"),
                    s = t("../../utils/url"),
                    a = t("events").EventEmitter,
                    u = t("../../utils/random");
                i(r, a), r.prototype.abort = function () {
                    this._cleanup(), this._close("user")
                }, r.prototype._cleanup = function () {
                    this.iframeObj && (this.iframeObj.cleanup(), this.iframeObj = null), delete n[o.WPrefix][this.id]
                }, r.prototype._close = function (t) {
                    this.emit("close",
                        null, t), this.removeAllListeners()
                }, r.htmlfileEnabled = !1;
                var c = ["Active"].concat("Object").join("X");
                if (c in n) try {
                    r.htmlfileEnabled = !!new n[c]("htmlfile")
                } catch (l) {}
                r.enabled = r.htmlfileEnabled || o.iframeEnabled, e.exports = r
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "../../utils/iframe": 47,
            "../../utils/random": 50,
            "../../utils/url": 52,
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        31: [function (t, e) {
            (function (n) {
                function r(t) {
                    var e = this;
                    c.call(this),
                        i.polluteGlobalNamespace(), this.id = "a" + o.string(6);
                    var s = a.addQuery(t, "c\x3d" + encodeURIComponent(i.WPrefix + "." + this.id));
                    n[i.WPrefix][this.id] = this._callback.bind(this), this._createScript(s), this.timeoutId = setTimeout(function () {
                        e._abort(new Error("JSONP script loaded abnormally (timeout)"))
                    }, r.timeout)
                }
                var i = t("../../utils/iframe"),
                    o = t("../../utils/random"),
                    s = t("../../utils/browser"),
                    a = t("../../utils/url"),
                    u = t("inherits"),
                    c = t("events").EventEmitter;
                u(r, c), r.prototype.abort = function () {
                    if (n[i.WPrefix][this.id]) {
                        var t =
                            new Error("JSONP user aborted read");
                        t.code = 1E3, this._abort(t)
                    }
                }, r.timeout = 35E3, r.scriptErrorTimeout = 1E3, r.prototype._callback = function (t) {
                    this._cleanup(), this.aborting || (t && this.emit("message", t), this.emit("close", null, "network"), this.removeAllListeners())
                }, r.prototype._abort = function (t) {
                    this._cleanup(), this.aborting = !0, this.emit("close", t.code, t.message), this.removeAllListeners()
                }, r.prototype._cleanup = function () {
                    if (clearTimeout(this.timeoutId), this.script2 && (this.script2.parentNode.removeChild(this.script2),
                            this.script2 = null), this.script) {
                        var t = this.script;
                        t.parentNode.removeChild(t), t.onreadystatechange = t.onerror = t.onload = t.onclick = null, this.script = null
                    }
                    delete n[i.WPrefix][this.id]
                }, r.prototype._scriptError = function () {
                    var t = this;
                    this.errorTimer || (this.errorTimer = setTimeout(function () {
                        t.loadedOkay || t._abort(new Error("JSONP script loaded abnormally (onerror)"))
                    }, r.scriptErrorTimeout))
                }, r.prototype._createScript = function (t) {
                    var e, r = this,
                        i = this.script = n.document.createElement("script");
                    if (i.id = "a" + o.string(8),
                        i.src = t, i.type = "text/javascript", i.charset = "UTF-8", i.onerror = this._scriptError.bind(this), i.onload = function () {
                            r._abort(new Error("JSONP script loaded abnormally (onload)"))
                        }, i.onreadystatechange = function () {
                            if (/loaded|closed/.test(i.readyState)) {
                                if (i && i.htmlFor && i.onclick) {
                                    r.loadedOkay = !0;
                                    try {
                                        i.onclick()
                                    } catch (t) {}
                                }
                                i && r._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))
                            }
                        }, "undefined" == typeof i.async && n.document.attachEvent)
                        if (s.isOpera()) e = this.script2 = n.document.createElement("script"),
                            e.text = "try{var a \x3d document.getElementById('" + i.id + "'); if(a)a.onerror();}catch(x){};", i.async = e.async = !1;
                        else {
                            try {
                                i.htmlFor = i.id, i.event = "onclick"
                            } catch (a) {}
                            i.async = !0
                        }
                    "undefined" != typeof i.async && (i.async = !0);
                    var u = n.document.getElementsByTagName("head")[0];
                    u.insertBefore(i, u.firstChild), e && u.insertBefore(e, u.firstChild)
                }, e.exports = r
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "../../utils/browser": 44,
            "../../utils/iframe": 47,
            "../../utils/random": 50,
            "../../utils/url": 52,
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        32: [function (t, e) {
            function n(t, e) {
                i.call(this);
                var n = this;
                this.bufferPosition = 0, this.xo = new e("POST", t, null), this.xo.on("chunk", this._chunkHandler.bind(this)), this.xo.once("finish", function (t, e) {
                    n._chunkHandler(t, e), n.xo = null;
                    var r = 200 === t ? "network" : "permanent";
                    n.emit("close", null, r), n._cleanup()
                })
            }
            var r = t("inherits"),
                i = t("events").EventEmitter;
            r(n, i), n.prototype._chunkHandler = function (t, e) {
                if (200 === t && e)
                    for (var n = -1;; this.bufferPosition +=
                        n + 1) {
                        var r = e.slice(this.bufferPosition);
                        if (n = r.indexOf("\n"), -1 === n) break;
                        var i = r.slice(0, n);
                        i && this.emit("message", i)
                    }
            }, n.prototype._cleanup = function () {
                this.removeAllListeners()
            }, n.prototype.abort = function () {
                this.xo && (this.xo.close(), this.emit("close", null, "user"), this.xo = null), this._cleanup()
            }, e.exports = n
        }, {
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        33: [function (t, e) {
            (function (n) {
                function r(t) {
                    try {
                        return n.document.createElement('\x3ciframe name\x3d"' + t + '"\x3e')
                    } catch (e) {
                        var r = n.document.createElement("iframe");
                        return r.name = t, r
                    }
                }

                function i() {
                    o = n.document.createElement("form"), o.style.display = "none", o.style.position = "absolute", o.method = "POST", o.enctype = "application/x-www-form-urlencoded", o.acceptCharset = "UTF-8", s = n.document.createElement("textarea"), s.name = "d", o.appendChild(s), n.document.body.appendChild(o)
                }
                var o, s, a = t("../../utils/random"),
                    u = t("../../utils/url");
                e.exports = function (t, e, n) {
                    o || i();
                    var c = "a" + a.string(8);
                    o.target = c, o.action = u.addQuery(u.addPath(t, "/jsonp_send"), "i\x3d" + c);
                    var l = r(c);
                    l.id = c,
                        l.style.display = "none", o.appendChild(l);
                    try {
                        s.value = e
                    } catch (f) {}
                    o.submit();
                    var h = function (t) {
                        l.onerror && (l.onreadystatechange = l.onerror = l.onload = null, setTimeout(function () {
                            l.parentNode.removeChild(l), l = null
                        }, 500), s.value = "", n(t))
                    };
                    return l.onerror = function () {
                            h()
                        }, l.onload = function () {
                            h()
                        }, l.onreadystatechange = function (t) {
                            "complete" === l.readyState && h()
                        },
                        function () {
                            h(new Error("Aborted"))
                        }
                }
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "../../utils/random": 50,
            "../../utils/url": 52,
            debug: void 0
        }],
        34: [function (t, e) {
            (function (n) {
                function r(t, e, n) {
                    var r = this;
                    i.call(this), setTimeout(function () {
                        r._start(t, e, n)
                    }, 0)
                }
                var i = t("events").EventEmitter,
                    o = t("inherits"),
                    s = t("../../utils/event"),
                    a = t("../../utils/browser"),
                    u = t("../../utils/url");
                o(r, i), r.prototype._start = function (t, e, r) {
                    var i = this,
                        o = new n.XDomainRequest;
                    e = u.addQuery(e, "t\x3d" + +new Date), o.onerror = function () {
                        i._error()
                    }, o.ontimeout = function () {
                        i._error()
                    }, o.onprogress = function () {
                        i.emit("chunk",
                            200, o.responseText)
                    }, o.onload = function () {
                        i.emit("finish", 200, o.responseText), i._cleanup(!1)
                    }, this.xdr = o, this.unloadRef = s.unloadAdd(function () {
                        i._cleanup(!0)
                    });
                    try {
                        this.xdr.open(t, e), this.timeout && (this.xdr.timeout = this.timeout), this.xdr.send(r)
                    } catch (a) {
                        this._error()
                    }
                }, r.prototype._error = function () {
                    this.emit("finish", 0, ""), this._cleanup(!1)
                }, r.prototype._cleanup = function (t) {
                    if (this.xdr) {
                        if (this.removeAllListeners(), s.unloadDel(this.unloadRef), this.xdr.ontimeout = this.xdr.onerror = this.xdr.onprogress =
                            this.xdr.onload = null, t) try {
                            this.xdr.abort()
                        } catch (e) {}
                        this.unloadRef = this.xdr = null
                    }
                }, r.prototype.close = function () {
                    this._cleanup(!0)
                }, r.enabled = !(!n.XDomainRequest || !a.hasDomain()), e.exports = r
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "../../utils/browser": 44,
            "../../utils/event": 46,
            "../../utils/url": 52,
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        35: [function (t, e) {
            function n(t, e, n, r) {
                i.call(this, t, e, n, r)
            }
            var r = t("inherits"),
                i = t("../driver/xhr");
            r(n, i), n.enabled = i.enabled && i.supportsCORS, e.exports = n
        }, {
            "../driver/xhr": 17,
            inherits: 54
        }],
        36: [function (t, e) {
            function n() {
                var t = this;
                r.call(this), this.to = setTimeout(function () {
                    t.emit("finish", 200, "{}")
                }, n.timeout)
            }
            var r = t("events").EventEmitter,
                i = t("inherits");
            i(n, r), n.prototype.close = function () {
                clearTimeout(this.to)
            }, n.timeout = 2E3, e.exports = n
        }, {
            events: 3,
            inherits: 54
        }],
        37: [function (t, e) {
            function n(t, e, n) {
                i.call(this, t, e, n, {
                    noCredentials: !0
                })
            }
            var r = t("inherits"),
                i = t("../driver/xhr");
            r(n, i), n.enabled =
                i.enabled, e.exports = n
        }, {
            "../driver/xhr": 17,
            inherits: 54
        }],
        38: [function (t, e) {
            function n(t) {
                if (!n.enabled()) throw new Error("Transport created when disabled");
                s.call(this);
                var e = this,
                    o = i.addPath(t, "/websocket");
                o = "https" === o.slice(0, 5) ? "wss" + o.slice(5) : "ws" + o.slice(4), this.url = o, this.ws = new a(this.url), this.ws.onmessage = function (t) {
                    e.emit("message", t.data)
                }, this.unloadRef = r.unloadAdd(function () {
                    e.ws.close()
                }), this.ws.onclose = function (t) {
                    e.emit("close", t.code, t.reason), e._cleanup()
                }, this.ws.onerror = function (t) {
                    e.emit("close",
                        1006, "WebSocket connection broken"), e._cleanup()
                }
            }
            var r = t("../utils/event"),
                i = t("../utils/url"),
                o = t("inherits"),
                s = t("events").EventEmitter,
                a = t("./driver/websocket");
            o(n, s), n.prototype.send = function (t) {
                    var e = "[" + t + "]";
                    this.ws.send(e)
                }, n.prototype.close = function () {
                    this.ws && this.ws.close(), this._cleanup()
                }, n.prototype._cleanup = function () {
                    var t = this.ws;
                    t && (t.onmessage = t.onclose = t.onerror = null), r.unloadDel(this.unloadRef), this.unloadRef = this.ws = null, this.removeAllListeners()
                }, n.enabled = function () {
                    return !!a
                },
                n.transportName = "websocket", n.roundTrips = 2, e.exports = n
        }, {
            "../utils/event": 46,
            "../utils/url": 52,
            "./driver/websocket": 19,
            debug: void 0,
            events: 3,
            inherits: 54
        }],
        39: [function (t, e) {
            function n(t) {
                if (!a.enabled) throw new Error("Transport created when disabled");
                i.call(this, t, "/xhr", s, a)
            }
            var r = t("inherits"),
                i = t("./lib/ajax-based"),
                o = t("./xdr-streaming"),
                s = t("./receiver/xhr"),
                a = t("./sender/xdr");
            r(n, i), n.enabled = o.enabled, n.transportName = "xdr-polling", n.roundTrips = 2, e.exports = n
        }, {
            "./lib/ajax-based": 24,
            "./receiver/xhr": 32,
            "./sender/xdr": 34,
            "./xdr-streaming": 40,
            inherits: 54
        }],
        40: [function (t, e) {
            function n(t) {
                if (!s.enabled) throw new Error("Transport created when disabled");
                i.call(this, t, "/xhr_streaming", o, s)
            }
            var r = t("inherits"),
                i = t("./lib/ajax-based"),
                o = t("./receiver/xhr"),
                s = t("./sender/xdr");
            r(n, i), n.enabled = function (t) {
                return t.cookie_needed || t.nullOrigin ? !1 : s.enabled && t.sameScheme
            }, n.transportName = "xdr-streaming", n.roundTrips = 2, e.exports = n
        }, {
            "./lib/ajax-based": 24,
            "./receiver/xhr": 32,
            "./sender/xdr": 34,
            inherits: 54
        }],
        41: [function (t, e) {
            function n(t) {
                if (!a.enabled && !s.enabled) throw new Error("Transport created when disabled");
                i.call(this, t, "/xhr", o, s)
            }
            var r = t("inherits"),
                i = t("./lib/ajax-based"),
                o = t("./receiver/xhr"),
                s = t("./sender/xhr-cors"),
                a = t("./sender/xhr-local");
            r(n, i), n.enabled = function (t) {
                return t.nullOrigin ? !1 : a.enabled && t.sameOrigin ? !0 : s.enabled
            }, n.transportName = "xhr-polling", n.roundTrips = 2, e.exports = n
        }, {
            "./lib/ajax-based": 24,
            "./receiver/xhr": 32,
            "./sender/xhr-cors": 35,
            "./sender/xhr-local": 37,
            inherits: 54
        }],
        42: [function (t, e) {
            (function (n) {
                function r(t) {
                    if (!u.enabled && !a.enabled) throw new Error("Transport created when disabled");
                    o.call(this, t, "/xhr_streaming", s, a)
                }
                var i = t("inherits"),
                    o = t("./lib/ajax-based"),
                    s = t("./receiver/xhr"),
                    a = t("./sender/xhr-cors"),
                    u = t("./sender/xhr-local"),
                    c = t("../utils/browser");
                i(r, o), r.enabled = function (t) {
                    return t.nullOrigin ? !1 : c.isOpera() ? !1 : a.enabled
                }, r.transportName = "xhr-streaming", r.roundTrips = 2, r.needBody = !!n.document, e.exports = r
            }).call(this, "undefined" != typeof global ? global :
                "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "../utils/browser": 44,
            "./lib/ajax-based": 24,
            "./receiver/xhr": 32,
            "./sender/xhr-cors": 35,
            "./sender/xhr-local": 37,
            inherits: 54
        }],
        43: [function (t, e) {
            (function (t) {
                e.exports.randomBytes = t.crypto && t.crypto.getRandomValues ? function (e) {
                    var n = new Uint8Array(e);
                    return t.crypto.getRandomValues(n), n
                } : function (t) {
                    for (var e = new Array(t), n = 0; t > n; n++) e[n] = Math.floor(256 * Math.random());
                    return e
                }
            }).call(this, "undefined" != typeof global ? global : "undefined" !=
                typeof self ? self : "undefined" != typeof window ? window : {})
        }, {}],
        44: [function (t, e) {
            (function (t) {
                e.exports = {
                    isOpera: function () {
                        return t.navigator && /opera/i.test(t.navigator.userAgent)
                    },
                    isKonqueror: function () {
                        return t.navigator && /konqueror/i.test(t.navigator.userAgent)
                    },
                    hasDomain: function () {
                        if (!t.document) return !0;
                        try {
                            return !!t.document.domain
                        } catch (e) {
                            return !1
                        }
                    }
                }
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {}],
        45: [function (t, e) {
            var n,
                r = t("json3"),
                i = /[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
                o = function (t) {
                    var e, n = {},
                        r = [];
                    for (e = 0; 65536 > e; e++) r.push(String.fromCharCode(e));
                    return t.lastIndex = 0, r.join("").replace(t, function (t) {
                        return n[t] = "\\u" + ("0000" + t.charCodeAt(0).toString(16)).slice(-4), ""
                    }), t.lastIndex = 0, n
                };
            e.exports = {
                quote: function (t) {
                    var e = r.stringify(t);
                    return i.lastIndex = 0, i.test(e) ? (n || (n = o(i)), e.replace(i, function (t) {
                        return n[t]
                    })) : e
                }
            }
        }, {
            json3: 55
        }],
        46: [function (t, e) {
            (function (n) {
                var r = t("./random"),
                    i = {},
                    o = !1,
                    s = n.chrome && n.chrome.app && n.chrome.app.runtime;
                e.exports = {
                    attachEvent: function (t,
                        e) {
                        "undefined" != typeof n.addEventListener ? n.addEventListener(t, e, !1) : n.document && n.attachEvent && (n.document.attachEvent("on" + t, e), n.attachEvent("on" + t, e))
                    },
                    detachEvent: function (t, e) {
                        "undefined" != typeof n.addEventListener ? n.removeEventListener(t, e, !1) : n.document && n.detachEvent && (n.document.detachEvent("on" + t, e), n.detachEvent("on" + t, e))
                    },
                    unloadAdd: function (t) {
                        if (s) return null;
                        var e = r.string(8);
                        return i[e] = t, o && setTimeout(this.triggerUnloadCallbacks, 0), e
                    },
                    unloadDel: function (t) {
                        t in i && delete i[t]
                    },
                    triggerUnloadCallbacks: function () {
                        for (var t in i) i[t](),
                            delete i[t]
                    }
                };
                var a = function () {
                    o || (o = !0, e.exports.triggerUnloadCallbacks())
                };
                s || e.exports.attachEvent("unload", a)
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "./random": 50
        }],
        47: [function (t, e) {
            (function (n) {
                var r = t("./event"),
                    i = t("json3"),
                    o = t("./browser");
                e.exports = {
                    WPrefix: "_jp",
                    currentWindowId: null,
                    polluteGlobalNamespace: function () {
                        e.exports.WPrefix in n || (n[e.exports.WPrefix] = {})
                    },
                    postMessage: function (t, r) {
                        n.parent !== n && n.parent.postMessage(i.stringify({
                            windowId: e.exports.currentWindowId,
                            type: t,
                            data: r || ""
                        }), "*")
                    },
                    createIframe: function (t, e) {
                        var i, o, s = n.document.createElement("iframe"),
                            a = function () {
                                clearTimeout(i);
                                try {
                                    s.onload = null
                                } catch (t) {}
                                s.onerror = null
                            },
                            u = function () {
                                s && (a(), setTimeout(function () {
                                    s && s.parentNode.removeChild(s), s = null
                                }, 0), r.unloadDel(o))
                            },
                            c = function (t) {
                                s && (u(), e(t))
                            },
                            l = function (t, e) {
                                try {
                                    setTimeout(function () {
                                        s && s.contentWindow && s.contentWindow.postMessage(t, e)
                                    }, 0)
                                } catch (n) {}
                            };
                        return s.src = t, s.style.display = "none", s.style.position = "absolute", s.onerror = function () {
                                c("onerror")
                            },
                            s.onload = function () {
                                clearTimeout(i), i = setTimeout(function () {
                                    c("onload timeout")
                                }, 2E3)
                            }, n.document.body.appendChild(s), i = setTimeout(function () {
                                c("timeout")
                            }, 15E3), o = r.unloadAdd(u), {
                                post: l,
                                cleanup: u,
                                loaded: a
                            }
                    },
                    createHtmlfile: function (t, i) {
                        var o, s, a, u = ["Active"].concat("Object").join("X"),
                            c = new n[u]("htmlfile"),
                            l = function () {
                                clearTimeout(o), a.onerror = null
                            },
                            f = function () {
                                c && (l(), r.unloadDel(s), a.parentNode.removeChild(a), a = c = null, CollectGarbage())
                            },
                            h = function (t) {
                                c && (f(), i(t))
                            },
                            d = function (t, e) {
                                try {
                                    setTimeout(function () {
                                        a &&
                                            a.contentWindow && a.contentWindow.postMessage(t, e)
                                    }, 0)
                                } catch (n) {}
                            };
                        c.open(), c.write('\x3chtml\x3e\x3cscript\x3edocument.domain\x3d"' + n.document.domain + '";\x3c/script\x3e\x3c/html\x3e'), c.close(), c.parentWindow[e.exports.WPrefix] = n[e.exports.WPrefix];
                        var p = c.createElement("div");
                        return c.body.appendChild(p), a = c.createElement("iframe"), p.appendChild(a), a.src = t, a.onerror = function () {
                            h("onerror")
                        }, o = setTimeout(function () {
                            h("timeout")
                        }, 15E3), s = r.unloadAdd(f), {
                            post: d,
                            cleanup: f,
                            loaded: l
                        }
                    }
                }, e.exports.iframeEnabled = !1, n.document && (e.exports.iframeEnabled = ("function" == typeof n.postMessage || "object" == typeof n.postMessage) && !o.isKonqueror())
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {
            "./browser": 44,
            "./event": 46,
            debug: void 0,
            json3: 55
        }],
        48: [function (t, e) {
            (function (t) {
                var n = {};
                ["log", "debug", "warn"].forEach(function (e) {
                    var r = t.console && t.console[e] && t.console[e].apply;
                    n[e] = r ? function () {
                            return t.console[e].apply(t.console, arguments)
                        } : "log" ===
                        e ? function () {} : n.log
                }), e.exports = n
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {}],
        49: [function (t, e) {
            e.exports = {
                isObject: function (t) {
                    var e = typeof t;
                    return "function" === e || "object" === e && !!t
                },
                extend: function (t) {
                    if (!this.isObject(t)) return t;
                    for (var e, n, r = 1, i = arguments.length; i > r; r++) {
                        e = arguments[r];
                        for (n in e) Object.prototype.hasOwnProperty.call(e, n) && (t[n] = e[n])
                    }
                    return t
                }
            }
        }, {}],
        50: [function (t, e) {
            var n = t("crypto"),
                r = "abcdefghijklmnopqrstuvwxyz012345";
            e.exports = {
                string: function (t) {
                    for (var e = r.length, i = n.randomBytes(t), o = [], s = 0; t > s; s++) o.push(r.substr(i[s] % e, 1));
                    return o.join("")
                },
                number: function (t) {
                    return Math.floor(Math.random() * t)
                },
                numberString: function (t) {
                    var e = ("" + (t - 1)).length,
                        n = (new Array(e + 1)).join("0");
                    return (n + this.number(t)).slice(-e)
                }
            }
        }, {
            crypto: 43
        }],
        51: [function (t, e) {
            e.exports = function (t) {
                return {
                    filterToEnabled: function (e, n) {
                        var r = {
                            main: [],
                            facade: []
                        };
                        return e ? "string" == typeof e && (e = [e]) : e = [], t.forEach(function (t) {
                            t && ("websocket" !== t.transportName ||
                                n.websocket !== !1) && (e.length && -1 === e.indexOf(t.transportName) || t.enabled(n) && (r.main.push(t), t.facadeTransport && r.facade.push(t.facadeTransport)))
                        }), r
                    }
                }
            }
        }, {
            debug: void 0
        }],
        52: [function (t, e) {
            var n = t("url-parse");
            e.exports = {
                getOrigin: function (t) {
                    if (!t) return null;
                    var e = new n(t);
                    if ("file:" === e.protocol) return null;
                    var r = e.port;
                    return r || (r = "https:" === e.protocol ? "443" : "80"), e.protocol + "//" + e.hostname + ":" + r
                },
                isOriginEqual: function (t, e) {
                    var n = this.getOrigin(t) === this.getOrigin(e);
                    return n
                },
                isSchemeEqual: function (t,
                    e) {
                    return t.split(":")[0] === e.split(":")[0]
                },
                addPath: function (t, e) {
                    var n = t.split("?");
                    return n[0] + e + (n[1] ? "?" + n[1] : "")
                },
                addQuery: function (t, e) {
                    return t + (-1 === t.indexOf("?") ? "?" + e : "\x26" + e)
                }
            }
        }, {
            debug: void 0,
            "url-parse": 56
        }],
        53: [function (t, e) {
            e.exports = "1.0.3"
        }, {}],
        54: [function (t, e) {
            e.exports = "function" == typeof Object.create ? function (t, e) {
                t.super_ = e, t.prototype = Object.create(e.prototype, {
                    constructor: {
                        value: t,
                        enumerable: !1,
                        writable: !0,
                        configurable: !0
                    }
                })
            } : function (t, e) {
                t.super_ = e;
                var n = function () {};
                n.prototype =
                    e.prototype, t.prototype = new n, t.prototype.constructor = t
            }
        }, {}],
        55: [function (e, n, r) {
            (function (e) {
                (function () {
                    function i(t, e) {
                        function n(t) {
                            if (n[t] !== m) return n[t];
                            var i;
                            if ("bug-string-char-index" == t) i = "a" != "a" [0];
                            else if ("json" == t) i = n("json-stringify") && n("json-parse");
                            else {
                                var s, a = '{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';
                                if ("json-stringify" == t) {
                                    var u = e.stringify,
                                        l = "function" == typeof u && g;
                                    if (l) {
                                        (s = function () {
                                            return 1
                                        }).toJSON = s;
                                        try {
                                            l = "0" === u(0) && "0" === u(new r) && '""' == u(new o) && u(y) === m &&
                                                u(m) === m && u() === m && "1" === u(s) && "[1]" == u([s]) && "[null]" == u([m]) && "null" == u(null) && "[null,null,null]" == u([m, y, null]) && u({
                                                    a: [s, !0, !1, null, "\x00\b\n\f\r\t"]
                                                }) == a && "1" === u(null, s) && "[\n 1,\n 2\n]" == u([1, 2], null, 1) && '"-271821-04-20T00:00:00.000Z"' == u(new c(-864E13)) && '"+275760-09-13T00:00:00.000Z"' == u(new c(864E13)) && '"-000001-01-01T00:00:00.000Z"' == u(new c(-621987552E5)) && '"1969-12-31T23:59:59.999Z"' == u(new c(-1))
                                        } catch (f) {
                                            l = !1
                                        }
                                    }
                                    i = l
                                }
                                if ("json-parse" == t) {
                                    var h = e.parse;
                                    if ("function" == typeof h) try {
                                        if (0 ===
                                            h("0") && !h(!1)) {
                                            s = h(a);
                                            var d = 5 == s.a.length && 1 === s.a[0];
                                            if (d) {
                                                try {
                                                    d = !h('"\t"')
                                                } catch (f) {}
                                                if (d) try {
                                                    d = 1 !== h("01")
                                                } catch (f) {}
                                                if (d) try {
                                                    d = 1 !== h("1.")
                                                } catch (f) {}
                                            }
                                        }
                                    } catch (f) {
                                        d = !1
                                    }
                                    i = d
                                }
                            }
                            return n[t] = !!i
                        }
                        t || (t = u.Object()), e || (e = u.Object());
                        var r = t.Number || u.Number,
                            o = t.String || u.String,
                            a = t.Object || u.Object,
                            c = t.Date || u.Date,
                            l = t.SyntaxError || u.SyntaxError,
                            f = t.TypeError || u.TypeError,
                            h = t.Math || u.Math,
                            d = t.JSON || u.JSON;
                        "object" == typeof d && d && (e.stringify = d.stringify, e.parse = d.parse);
                        var p, v, m, b = a.prototype,
                            y = b.toString,
                            g = new c(-0xc782b5b800cec);
                        try {
                            g = -109252 == g.getUTCFullYear() && 0 === g.getUTCMonth() && 1 === g.getUTCDate() && 10 == g.getUTCHours() && 37 == g.getUTCMinutes() && 6 == g.getUTCSeconds() && 708 == g.getUTCMilliseconds()
                        } catch (w) {}
                        if (!n("json")) {
                            var x = "[object Function]",
                                _ = "[object Date]",
                                E = "[object Number]",
                                S = "[object String]",
                                O = "[object Array]",
                                T = "[object Boolean]",
                                j = n("bug-string-char-index");
                            if (!g) var C = h.floor,
                                N = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334],
                                A = function (t, e) {
                                    return N[e] + 365 * (t - 1970) + C((t - 1969 + (e = +(e > 1))) /
                                        4) - C((t - 1901 + e) / 100) + C((t - 1601 + e) / 400)
                                };
                            if ((p = b.hasOwnProperty) || (p = function (t) {
                                    var e, n = {};
                                    return (n.__proto__ = null, n.__proto__ = {
                                        toString: 1
                                    }, n).toString != y ? p = function (t) {
                                        var e = this.__proto__,
                                            n = t in (this.__proto__ = null, this);
                                        return this.__proto__ = e, n
                                    } : (e = n.constructor, p = function (t) {
                                        var n = (this.constructor || e).prototype;
                                        return t in this && !(t in n && this[t] === n[t])
                                    }), n = null, p.call(this, t)
                                }), v = function (t, e) {
                                    var n, r, i, o = 0;
                                    (n = function () {
                                        this.valueOf = 0
                                    }).prototype.valueOf = 0, r = new n;
                                    for (i in r) p.call(r, i) &&
                                        o++;
                                    return n = r = null, o ? v = 2 == o ? function (t, e) {
                                        var n, r = {},
                                            i = y.call(t) == x;
                                        for (n in t) i && "prototype" == n || p.call(r, n) || !(r[n] = 1) || !p.call(t, n) || e(n)
                                    } : function (t, e) {
                                        var n, r, i = y.call(t) == x;
                                        for (n in t) i && "prototype" == n || !p.call(t, n) || (r = "constructor" === n) || e(n);
                                        (r || p.call(t, n = "constructor")) && e(n)
                                    } : (r = ["valueOf", "toString", "toLocaleString", "propertyIsEnumerable", "isPrototypeOf", "hasOwnProperty", "constructor"], v = function (t, e) {
                                        var n, i, o = y.call(t) == x,
                                            a = !o && "function" != typeof t.constructor && s[typeof t.hasOwnProperty] &&
                                            t.hasOwnProperty || p;
                                        for (n in t) o && "prototype" == n || !a.call(t, n) || e(n);
                                        for (i = r.length; n = r[--i]; a.call(t, n) && e(n));
                                    }), v(t, e)
                                }, !n("json-stringify")) {
                                var k = {
                                        92: "\\\\",
                                        34: '\\"',
                                        8: "\\b",
                                        12: "\\f",
                                        10: "\\n",
                                        13: "\\r",
                                        9: "\\t"
                                    },
                                    I = "000000",
                                    L = function (t, e) {
                                        return (I + (e || 0)).slice(-t)
                                    },
                                    R = "\\u00",
                                    U = function (t) {
                                        for (var e = '"', n = 0, r = t.length, i = !j || r > 10, o = i && (j ? t.split("") : t); r > n; n++) {
                                            var s = t.charCodeAt(n);
                                            switch (s) {
                                                case 8:
                                                case 9:
                                                case 10:
                                                case 12:
                                                case 13:
                                                case 34:
                                                case 92:
                                                    e += k[s];
                                                    break;
                                                default:
                                                    if (32 > s) {
                                                        e += R + L(2, s.toString(16));
                                                        break
                                                    }
                                                    e += i ? o[n] : t.charAt(n)
                                            }
                                        }
                                        return e + '"'
                                    },
                                    P = function (t, e, n, r, i, o, s) {
                                        var a, u, c, l, h, d, b, g, w, x, j, N, k, I, R, M;
                                        try {
                                            a = e[t]
                                        } catch (W) {}
                                        if ("object" == typeof a && a)
                                            if (u = y.call(a), u != _ || p.call(a, "toJSON")) "function" == typeof a.toJSON && (u != E && u != S && u != O || p.call(a, "toJSON")) && (a = a.toJSON(t));
                                            else if (a > -1 / 0 && 1 / 0 > a) {
                                            if (A) {
                                                for (h = C(a / 864E5), c = C(h / 365.2425) + 1970 - 1; A(c + 1, 0) <= h; c++);
                                                for (l = C((h - A(c, 0)) / 30.42); A(c, l + 1) <= h; l++);
                                                h = 1 + h - A(c, l), d = (a % 864E5 + 864E5) % 864E5, b = C(d / 36E5) % 24, g = C(d / 6E4) % 60, w = C(d / 1E3) % 60, x = d % 1E3
                                            } else c = a.getUTCFullYear(),
                                                l = a.getUTCMonth(), h = a.getUTCDate(), b = a.getUTCHours(), g = a.getUTCMinutes(), w = a.getUTCSeconds(), x = a.getUTCMilliseconds();
                                            a = (0 >= c || c >= 1E4 ? (0 > c ? "-" : "+") + L(6, 0 > c ? -c : c) : L(4, c)) + "-" + L(2, l + 1) + "-" + L(2, h) + "T" + L(2, b) + ":" + L(2, g) + ":" + L(2, w) + "." + L(3, x) + "Z"
                                        } else a = null;
                                        if (n && (a = n.call(e, t, a)), null === a) return "null";
                                        if (u = y.call(a), u == T) return "" + a;
                                        if (u == E) return a > -1 / 0 && 1 / 0 > a ? "" + a : "null";
                                        if (u == S) return U("" + a);
                                        if ("object" == typeof a) {
                                            for (I = s.length; I--;)
                                                if (s[I] === a) throw f();
                                            if (s.push(a), j = [], R = o, o += i, u == O) {
                                                for (k = 0,
                                                    I = a.length; I > k; k++) N = P(k, a, n, r, i, o, s), j.push(N === m ? "null" : N);
                                                M = j.length ? i ? "[\n" + o + j.join(",\n" + o) + "\n" + R + "]" : "[" + j.join(",") + "]" : "[]"
                                            } else v(r || a, function (t) {
                                                var e = P(t, a, n, r, i, o, s);
                                                e !== m && j.push(U(t) + ":" + (i ? " " : "") + e)
                                            }), M = j.length ? i ? "{\n" + o + j.join(",\n" + o) + "\n" + R + "}" : "{" + j.join(",") + "}" : "{}";
                                            return s.pop(), M
                                        }
                                    };
                                e.stringify = function (t, e, n) {
                                    var r, i, o, a;
                                    if (s[typeof e] && e)
                                        if ((a = y.call(e)) == x) i = e;
                                        else if (a == O) {
                                        o = {};
                                        for (var u, c = 0, l = e.length; l > c; u = e[c++], a = y.call(u), (a == S || a == E) && (o[u] = 1));
                                    }
                                    if (n)
                                        if ((a = y.call(n)) ==
                                            E) {
                                            if ((n -= n % 1) > 0)
                                                for (r = "", n > 10 && (n = 10); r.length < n; r += " ");
                                        } else a == S && (r = n.length <= 10 ? n : n.slice(0, 10));
                                    return P("", (u = {}, u[""] = t, u), i, o, r, "", [])
                                }
                            }
                            if (!n("json-parse")) {
                                var M, W, q = o.fromCharCode,
                                    D = {
                                        92: "\\",
                                        34: '"',
                                        47: "/",
                                        98: "\b",
                                        116: "\t",
                                        110: "\n",
                                        102: "\f",
                                        114: "\r"
                                    },
                                    F = function () {
                                        throw M = W = null, l();
                                    },
                                    B = function () {
                                        for (var t, e, n, r, i, o = W, s = o.length; s > M;) switch (i = o.charCodeAt(M)) {
                                            case 9:
                                            case 10:
                                            case 13:
                                            case 32:
                                                M++;
                                                break;
                                            case 123:
                                            case 125:
                                            case 91:
                                            case 93:
                                            case 58:
                                            case 44:
                                                return t = j ? o.charAt(M) : o[M], M++, t;
                                            case 34:
                                                for (t =
                                                    "@", M++; s > M;)
                                                    if (i = o.charCodeAt(M), 32 > i) F();
                                                    else if (92 == i) switch (i = o.charCodeAt(++M)) {
                                                    case 92:
                                                    case 34:
                                                    case 47:
                                                    case 98:
                                                    case 116:
                                                    case 110:
                                                    case 102:
                                                    case 114:
                                                        t += D[i], M++;
                                                        break;
                                                    case 117:
                                                        for (e = ++M, n = M + 4; n > M; M++) i = o.charCodeAt(M), i >= 48 && 57 >= i || i >= 97 && 102 >= i || i >= 65 && 70 >= i || F();
                                                        t += q("0x" + o.slice(e, M));
                                                        break;
                                                    default:
                                                        F()
                                                } else {
                                                    if (34 == i) break;
                                                    for (i = o.charCodeAt(M), e = M; i >= 32 && 92 != i && 34 != i;) i = o.charCodeAt(++M);
                                                    t += o.slice(e, M)
                                                }
                                                if (34 == o.charCodeAt(M)) return M++, t;
                                                F();
                                            default:
                                                if (e = M, 45 == i && (r = !0, i = o.charCodeAt(++M)),
                                                    i >= 48 && 57 >= i) {
                                                    for (48 == i && (i = o.charCodeAt(M + 1), i >= 48 && 57 >= i) && F(), r = !1; s > M && (i = o.charCodeAt(M), i >= 48 && 57 >= i); M++);
                                                    if (46 == o.charCodeAt(M)) {
                                                        for (n = ++M; s > n && (i = o.charCodeAt(n), i >= 48 && 57 >= i); n++);
                                                        n == M && F(), M = n
                                                    }
                                                    if (i = o.charCodeAt(M), 101 == i || 69 == i) {
                                                        for (i = o.charCodeAt(++M), (43 == i || 45 == i) && M++, n = M; s > n && (i = o.charCodeAt(n), i >= 48 && 57 >= i); n++);
                                                        n == M && F(), M = n
                                                    }
                                                    return +o.slice(e, M)
                                                }
                                                if (r && F(), "true" == o.slice(M, M + 4)) return M += 4, !0;
                                                if ("false" == o.slice(M, M + 5)) return M += 5, !1;
                                                if ("null" == o.slice(M, M + 4)) return M += 4, null;
                                                F()
                                        }
                                        return "$"
                                    },
                                    G = function (t) {
                                        var e, n;
                                        if ("$" == t && F(), "string" == typeof t) {
                                            if ("@" == (j ? t.charAt(0) : t[0])) return t.slice(1);
                                            if ("[" == t) {
                                                for (e = []; t = B(), "]" != t; n || (n = !0)) n && ("," == t ? (t = B(), "]" == t && F()) : F()), "," == t && F(), e.push(G(t));
                                                return e
                                            }
                                            if ("{" == t) {
                                                for (e = {}; t = B(), "}" != t; n || (n = !0)) n && ("," == t ? (t = B(), "}" == t && F()) : F()), ("," == t || "string" != typeof t || "@" != (j ? t.charAt(0) : t[0]) || ":" != B()) && F(), e[t.slice(1)] = G(B());
                                                return e
                                            }
                                            F()
                                        }
                                        return t
                                    },
                                    J = function (t, e, n) {
                                        var r = H(t, e, n);
                                        r === m ? delete t[e] : t[e] = r
                                    },
                                    H = function (t, e, n) {
                                        var r, i = t[e];
                                        if ("object" == typeof i && i)
                                            if (y.call(i) == O)
                                                for (r = i.length; r--;) J(i, r, n);
                                            else v(i, function (t) {
                                                J(i, t, n)
                                            });
                                        return n.call(t, e, i)
                                    };
                                e.parse = function (t, e) {
                                    var n, r;
                                    return M = 0, W = "" + t, n = G(B()), "$" != B() && F(), M = W = null, e && y.call(e) == x ? H((r = {}, r[""] = n, r), "", e) : n
                                }
                            }
                        }
                        return e.runInContext = i, e
                    }
                    var o = "function" == typeof t && t.amd,
                        s = {
                            "function": !0,
                            object: !0
                        },
                        a = s[typeof r] && r && !r.nodeType && r,
                        u = s[typeof window] && window || this,
                        c = a && s[typeof n] && n && !n.nodeType && "object" == typeof e && e;
                    if (!c || c.global !== c && c.window !== c && c.self !==
                        c || (u = c), a && !o) i(u, a);
                    else {
                        var l = u.JSON,
                            f = u.JSON3,
                            h = !1,
                            d = i(u, u.JSON3 = {
                                noConflict: function () {
                                    return h || (h = !0, u.JSON = l, u.JSON3 = f, l = f = null), d
                                }
                            });
                        u.JSON = {
                            parse: d.parse,
                            stringify: d.stringify
                        }
                    }
                    o && t(function () {
                        return d
                    })
                }).call(this)
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {})
        }, {}],
        56: [function (t, e) {
            function n(t, e, u) {
                if (!(this instanceof n)) return new n(t, e, u);
                var c, l, f, h, d = s.test(t),
                    p = typeof e,
                    v = this,
                    m = 0;
                for ("object" !== p && "string" !==
                    p && (u = e, e = null), u && "function" != typeof u && (u = o.parse), e = i(e); m < a.length; m++) l = a[m], c = l[0], h = l[1], c !== c ? v[h] = t : "string" == typeof c ? ~(f = t.indexOf(c)) && ("number" == typeof l[2] ? (v[h] = t.slice(0, f), t = t.slice(f + l[2])) : (v[h] = t.slice(f), t = t.slice(0, f))) : (f = c.exec(t)) && (v[h] = f[1], t = t.slice(0, t.length - f[0].length)), v[h] = v[h] || (l[3] || "port" === h && d ? e[h] || "" : ""), l[4] && (v[h] = v[h].toLowerCase());
                u && (v.query = u(v.query)), r(v.port, v.protocol) || (v.host = v.hostname, v.port = ""), v.username = v.password = "", v.auth && (l = v.auth.split(":"),
                    v.username = l[0] || "", v.password = l[1] || ""), v.href = v.toString()
            }
            var r = t("requires-port"),
                i = t("./lolcation"),
                o = t("querystringify"),
                s = /^\/(?!\/)/,
                a = [
                    ["#", "hash"],
                    ["?", "query"],
                    ["//", "protocol", 2, 1, 1],
                    ["/", "pathname"],
                    ["@", "auth", 1],
                    [NaN, "host", void 0, 1, 1],
                    [/:(\d+)$/, "port"],
                    [NaN, "hostname", void 0, 1, 1]
                ];
            n.prototype.set = function (t, e, n) {
                var i = this;
                return "query" === t ? ("string" == typeof e && (e = (n || o.parse)(e)), i[t] = e) : "port" === t ? (i[t] = e, r(e, i.protocol) ? e && (i.host = i.hostname + ":" + e) : (i.host = i.hostname, i[t] = "")) :
                    "hostname" === t ? (i[t] = e, i.port && (e += ":" + i.port), i.host = e) : "host" === t ? (i[t] = e, /:\d+/.test(e) && (e = e.split(":"), i.hostname = e[0], i.port = e[1])) : i[t] = e, i.href = i.toString(), i
            }, n.prototype.toString = function (t) {
                t && "function" == typeof t || (t = o.stringify);
                var e, n = this,
                    r = n.protocol + "//";
                return n.username && (r += n.username, n.password && (r += ":" + n.password), r += "@"), r += n.hostname, n.port && (r += ":" + n.port), r += n.pathname, n.query && (e = "object" == typeof n.query ? t(n.query) : n.query, r += ("?" === e.charAt(0) ? "" : "?") + e), n.hash && (r += n.hash),
                    r
            }, n.qs = o, n.location = i, e.exports = n
        }, {
            "./lolcation": 57,
            querystringify: 58,
            "requires-port": 59
        }],
        57: [function (t, e) {
            (function (n) {
                var r, i = {
                    hash: 1,
                    query: 1
                };
                e.exports = function (e) {
                    e = e || n.location || {}, r = r || t("./");
                    var o, s = {},
                        a = typeof e;
                    if ("blob:" === e.protocol) s = new r(unescape(e.pathname), {});
                    else if ("string" === a) {
                        s = new r(e, {});
                        for (o in i) delete s[o]
                    } else if ("object" === a)
                        for (o in e) o in i || (s[o] = e[o]);
                    return s
                }
            }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ?
                window : {})
        }, {
            "./": 56
        }],
        58: [function (t, e, n) {
            function r(t) {
                for (var e, n = /([^=?&]+)=([^&]*)/g, r = {}; e = n.exec(t); r[decodeURIComponent(e[1])] = decodeURIComponent(e[2]));
                return r
            }

            function i(t, e) {
                e = e || "";
                var n = [];
                "string" != typeof e && (e = "?");
                for (var r in t) o.call(t, r) && n.push(encodeURIComponent(r) + "\x3d" + encodeURIComponent(t[r]));
                return n.length ? e + n.join("\x26") : ""
            }
            var o = Object.prototype.hasOwnProperty;
            n.stringify = i, n.parse = r
        }, {}],
        59: [function (t, e) {
            e.exports = function (t, e) {
                if (e = e.split(":")[0], t = +t, !t) return !1;
                switch (e) {
                    case "http":
                    case "ws":
                        return 80 !== t;
                    case "https":
                    case "wss":
                        return 443 !== t;
                    case "ftp":
                        return 22 !== t;
                    case "gopher":
                        return 70 !== t;
                    case "file":
                        return !1
                }
                return 0 !== t
            }
        }, {}]
    }, {}, [1])(1)
}),
function () {
    var t, e, n, r, i = {}.hasOwnProperty,
        o = [].slice;
    t = {
        LF: "\n",
        NULL: "\x00"
    }, n = function () {
        function e(t, e, n) {
            this.command = t, this.headers = null != e ? e : {}, this.body = null != n ? n : ""
        }
        var n;
        return e.prototype.toString = function () {
                var n, r, o, s, a;
                n = [this.command], o = this.headers["content-length"] === !1 ? !0 : !1, o && delete this.headers["content-length"],
                    a = this.headers;
                for (r in a) i.call(a, r) && (s = a[r], n.push("" + r + ":" + s));
                return this.body && !o && n.push("content-length:" + e.sizeOfUTF8(this.body)), n.push(t.LF + this.body), n.join(t.LF)
            }, e.sizeOfUTF8 = function (t) {
                return t ? encodeURI(t).match(/%..|./g).length : 0
            }, n = function (n) {
                var r, i, o, s, a, u, c, l, f, h, d, p, v, m, b, y, g;
                for (s = n.search(RegExp("" + t.LF + t.LF)), a = n.substring(0, s).split(t.LF), o = a.shift(), u = {}, p = function (t) {
                        return t.replace(/^\s+|\s+$/g, "")
                    }, y = a.reverse(), v = 0, b = y.length; b > v; v++) h = y[v], l = h.indexOf(":"), u[p(h.substring(0,
                    l))] = p(h.substring(l + 1));
                if (r = "", d = s + 2, u["content-length"]) f = parseInt(u["content-length"]), r = ("" + n).substring(d, d + f);
                else
                    for (i = null, c = m = d, g = n.length;
                        (g >= d ? g > m : m > g) && (i = n.charAt(c), i !== t.NULL); c = g >= d ? ++m : --m) r += i;
                return new e(o, u, r)
            }, e.unmarshall = function (e) {
                var r;
                return function () {
                    var i, o, s, a;
                    for (s = e.split(RegExp("" + t.NULL + t.LF + "*")), a = [], i = 0, o = s.length; o > i; i++) r = s[i], (null != r ? r.length : void 0) > 0 && a.push(n(r));
                    return a
                }()
            }, e.marshall = function (n, r, i) {
                var o;
                return o = new e(n, r, i), o.toString() + t.NULL
            },
            e
    }(), e = function () {
        function e(t) {
            this.ws = t, this.ws.binaryType = "arraybuffer", this.counter = 0, this.connected = !1, this.heartbeat = {
                outgoing: 1E4,
                incoming: 1E4
            }, this.maxWebSocketFrameSize = 16384, this.subscriptions = {}
        }
        var i;
        return e.prototype.debug = function (t) {
            var e;
            return "undefined" != typeof window && null !== window ? (null != (e = window.console), void 0) : void 0
        }, i = function () {
            return Date.now ? Date.now() : (new Date).valueOf
        }, e.prototype._transmit = function (t, e, r) {
            var i;
            for (i = n.marshall(t, e, r), "function" == typeof this.debug &&
                this.debug("\x3e\x3e\x3e " + i);;) {
                if (!(i.length > this.maxWebSocketFrameSize)) return this.ws.send(i);
                this.ws.send(i.substring(0, this.maxWebSocketFrameSize)), i = i.substring(this.maxWebSocketFrameSize), "function" == typeof this.debug && this.debug("remaining \x3d " + i.length)
            }
        }, e.prototype._setupHeartbeat = function (e) {
            var n, o, s, a, u, c;
            if ((u = e.version) === r.VERSIONS.V1_1 || u === r.VERSIONS.V1_2) return c = function () {
                    var t, n, r, i;
                    for (r = e["heart-beat"].split(","), i = [], t = 0, n = r.length; n > t; t++) a = r[t], i.push(parseInt(a));
                    return i
                }(),
                o = c[0], n = c[1], 0 !== this.heartbeat.outgoing && 0 !== n && (s = Math.max(this.heartbeat.outgoing, n), "function" == typeof this.debug && this.debug("send PING every " + s + "ms"), this.pinger = r.setInterval(s, function (e) {
                    return function () {
                        return e.ws.send(t.LF), "function" == typeof e.debug ? e.debug("\x3e\x3e\x3e PING") : void 0
                    }
                }(this))), 0 !== this.heartbeat.incoming && 0 !== o ? (s = Math.max(this.heartbeat.incoming, o), "function" == typeof this.debug && this.debug("check PONG every " + s + "ms"), this.ponger = r.setInterval(s, function (t) {
                    return function () {
                        var e;
                        return e = i() - t.serverActivity, e > 2 * s ? ("function" == typeof t.debug && t.debug("did not receive server activity for the last " + e + "ms"), t.ws.close()) : void 0
                    }
                }(this))) : void 0
        }, e.prototype._parseConnect = function () {
            var t, e, n, r;
            switch (t = 1 <= arguments.length ? o.call(arguments, 0) : [], r = {}, t.length) {
                case 2:
                    r = t[0], e = t[1];
                    break;
                case 3:
                    t[1] instanceof Function ? (r = t[0], e = t[1], n = t[2]) : (r.login = t[0], r.passcode = t[1], e = t[2]);
                    break;
                case 4:
                    r.login = t[0], r.passcode = t[1], e = t[2], n = t[3];
                    break;
                default:
                    r.login = t[0], r.passcode = t[1],
                        e = t[2], n = t[3], r.host = t[4]
            }
            return [r, e, n]
        }, e.prototype.connect = function () {
            var e, s, a, u;
            return e = 1 <= arguments.length ? o.call(arguments, 0) : [], u = this._parseConnect.apply(this, e), a = u[0], this.connectCallback = u[1], s = u[2], "function" == typeof this.debug && this.debug("Opening Web Socket..."), this.ws.onmessage = function (e) {
                return function (r) {
                    var o, a, u, c, l, f, h, d, p, v, m, b;
                    if (c = "undefined" != typeof ArrayBuffer && r.data instanceof ArrayBuffer ? (o = new Uint8Array(r.data), "function" == typeof e.debug ? e.debug("--- got data length: " +
                            o.length) : void 0, function () {
                            var t, e, n;
                            for (n = [], t = 0, e = o.length; e > t; t++) a = o[t], n.push(String.fromCharCode(a));
                            return n
                        }().join("")) : r.data, e.serverActivity = i(), c === t.LF) return void("function" == typeof e.debug && e.debug("\x3c\x3c\x3c PONG"));
                    for ("function" == typeof e.debug && e.debug("\x3c\x3c\x3c " + c), m = n.unmarshall(c), b = [], p = 0, v = m.length; v > p; p++) switch (l = m[p], l.command) {
                        case "CONNECTED":
                            "function" == typeof e.debug && e.debug("connected to server " + l.headers.server), e.connected = !0, e._setupHeartbeat(l.headers),
                                b.push("function" == typeof e.connectCallback ? e.connectCallback(l) : void 0);
                            break;
                        case "MESSAGE":
                            d = l.headers.subscription, h = e.subscriptions[d] || e.onreceive, h ? (u = e, f = l.headers["message-id"], l.ack = function (t) {
                                return null == t && (t = {}), u.ack(f, d, t)
                            }, l.nack = function (t) {
                                return null == t && (t = {}), u.nack(f, d, t)
                            }, b.push(h(l))) : b.push("function" == typeof e.debug ? e.debug("Unhandled received MESSAGE: " + l) : void 0);
                            break;
                        case "RECEIPT":
                            b.push("function" == typeof e.onreceipt ? e.onreceipt(l) : void 0);
                            break;
                        case "ERROR":
                            b.push("function" ==
                                typeof s ? s(l) : void 0);
                            break;
                        default:
                            b.push("function" == typeof e.debug ? e.debug("Unhandled frame: " + l) : void 0)
                    }
                    return b
                }
            }(this), this.ws.onclose = function (t) {
                return function () {
                    var e;
                    return e = "Whoops! Lost connection to " + t.ws.url, "function" == typeof t.debug && t.debug(e), t._cleanUp(), "function" == typeof s ? s(e) : void 0
                }
            }(this), this.ws.onopen = function (t) {
                return function () {
                    return "function" == typeof t.debug && t.debug("Web Socket Opened..."), a["accept-version"] = r.VERSIONS.supportedVersions(), a["heart-beat"] = [t.heartbeat.outgoing,
                        t.heartbeat.incoming
                    ].join(","), t._transmit("CONNECT", a)
                }
            }(this)
        }, e.prototype.disconnect = function (t, e) {
            return null == e && (e = {}), this._transmit("DISCONNECT", e), this.ws.onclose = null, this.ws.close(), this._cleanUp(), "function" == typeof t ? t() : void 0
        }, e.prototype._cleanUp = function () {
            return this.connected = !1, this.pinger && r.clearInterval(this.pinger), this.ponger ? r.clearInterval(this.ponger) : void 0
        }, e.prototype.send = function (t, e, n) {
            return null == e && (e = {}), null == n && (n = ""), e.destination = t, this._transmit("SEND",
                e, n)
        }, e.prototype.subscribe = function (t, e, n) {
            var r;
            return null == n && (n = {}), n.id || (n.id = "sub-" + this.counter++), n.destination = t, this.subscriptions[n.id] = e, this._transmit("SUBSCRIBE", n), r = this, {
                id: n.id,
                unsubscribe: function () {
                    return r.unsubscribe(n.id)
                }
            }
        }, e.prototype.unsubscribe = function (t) {
            return delete this.subscriptions[t], this._transmit("UNSUBSCRIBE", {
                id: t
            })
        }, e.prototype.begin = function (t) {
            var e, n;
            return n = t || "tx-" + this.counter++, this._transmit("BEGIN", {
                transaction: n
            }), e = this, {
                id: n,
                commit: function () {
                    return e.commit(n)
                },
                abort: function () {
                    return e.abort(n)
                }
            }
        }, e.prototype.commit = function (t) {
            return this._transmit("COMMIT", {
                transaction: t
            })
        }, e.prototype.abort = function (t) {
            return this._transmit("ABORT", {
                transaction: t
            })
        }, e.prototype.ack = function (t, e, n) {
            return null == n && (n = {}), n["message-id"] = t, n.subscription = e, this._transmit("ACK", n)
        }, e.prototype.nack = function (t, e, n) {
            return null == n && (n = {}), n["message-id"] = t, n.subscription = e, this._transmit("NACK", n)
        }, e
    }(), r = {
        VERSIONS: {
            V1_0: "1.0",
            V1_1: "1.1",
            V1_2: "1.2",
            supportedVersions: function () {
                return "1.1,1.0"
            }
        },
        client: function (t, n) {
            var i, o;
            return null == n && (n = ["v10.stomp", "v11.stomp"]), i = r.WebSocketClass || WebSocket, o = new i(t, n), new e(o)
        },
        over: function (t) {
            return new e(t)
        },
        Frame: n
    }, "undefined" != typeof exports && null !== exports && (exports.Stomp = r), "undefined" != typeof window && null !== window ? (r.setInterval = function (t, e) {
        return window.setInterval(e, t)
    }, r.clearInterval = function (t) {
        return window.clearInterval(t)
    }, window.Stomp = r) : exports || (self.Stomp = r)
}.call(this);
var w = window,
    d = document;
var MCK_LABELS;
var MCK_BASE_URL;
var MCK_CURR_LATITIUDE = 40.7324319;
var MCK_CURR_LONGITUDE = -73.82480777777776;
var mckUtils = new MckUtils;
var mckDateUtils = new MckDateUtils;
var mckContactUtils = new MckContactUtils;
var mckMapUtils = new MckMapUtils;

function MckUtils() {
    var _this = this;
    var TEXT_NODE = 3,
        ELEMENT_NODE = 1,
        TAGS_BLOCK = ["p", "div", "pre", "form"];
    _this.init = function () {
        var initurl = MCK_CONTEXTPATH ? MCK_CONTEXTPATH + "/v2/tab/initialize.page" : "https://apps.applozic.com/v2/tab/initialize.page";
        var messurl = MCK_CONTEXTPATH ? MCK_CONTEXTPATH + "/rest/ws/message/list" : "https://apps.applozic.com/rest/ws/message/list";
        $applozic.ajax({
            url: initurl,
            contentType: "application/json",
            type: "OPTIONS"
        }).done(function (data) {});
        $applozic.ajax({
            url: messurl,
            contentType: "application/json",
            type: "OPTIONS"
        }).done(function (data) {})
    };
    _this.showElement = function (element) {
        if (element) {
            element.classList.remove("n-vis");
            element.classList.add("vis")
        }
    };
    _this.hideElement = function (element) {
        if (element) {
            element.classList.remove("vis");
            element.classList.add("n-vis")
        }
    };
    _this.badgeCountOnLaucher = function(enablebadgecount,totalunreadCount) {
        var element = document.getElementById("applozic-badge-count");
        if(enablebadgecount === true && totalunreadCount > 0){
            if(totalunreadCount < 99){
                element.innerHTML = totalunreadCount;
            }
            else {
                element.innerHTML = "99+";
            }
            element.classList.add("mck-badge-count");
        }
        if(enablebadgecount === true && totalunreadCount === 0){
            element.innerHTML ="";
            element.classList.remove("mck-badge-count");
        }
    };
    _this.randomId = function () {
        return w.Math.random().toString(36).substring(7)
    };
    _this.textVal = function ($element) {
        var lines = [];
        var line = [];
        var flush = function () {
            lines.push(line.join(""));
            line = []
        };
        var sanitizeNode = function (node) {
            if (node.nodeType === TEXT_NODE) line.push(node.nodeValue);
            else if (node.nodeType === ELEMENT_NODE) {
                var tagName = node.tagName.toLowerCase();
                var isBlock = TAGS_BLOCK.indexOf(tagName) !== -1;
                if (isBlock &&
                    line.length) flush();
                if (tagName === "img") {
                    var alt = node.getAttribute("alt") || "";
                    if (alt) line.push(alt);
                    return
                } else if (tagName === "style") return;
                else if (tagName === "br") flush();
                var children = node.childNodes;
                for (var i = 0; i < children.length; i++) sanitizeNode(children[i]);
                if (isBlock && line.length) flush()
            }
        };
        var children = $element.childNodes;
        for (var i = 0; i < children.length; i++) sanitizeNode(children[i]);
        if (line.length) flush();
        return lines.join("\n")
    };
    _this.mouseX = function (evt) {
        if (evt.pageX) return evt.pageX;
        else if (evt.clientX) return evt.clientX +
            (d.documentElement.scrollLeft ? d.documentElement.scrollLeft : d.body.scrollLeft);
        else return null
    };
    _this.mouseY = function (evt) {
        if (evt.pageY) return evt.pageY;
        else if (evt.clientY) return evt.clientY + (d.documentElement.scrollTop ? d.documentElement.scrollTop : d.body.scrollTop);
        else return null
    };
    _this.startsWith = function (matcher, str) {
        if (str === null || typeof matcher === "undefined") return false;
        var i = str.length;
        if (matcher.length < i) return false;
        for (--i; i >= 0 && matcher[i] === str[i]; --i) continue;
        return i < 0
    };
    _this.setEndOfContenteditable =
        function (contentEditableElement) {
            var range, selection;
            if (document.createRange) {
                range = document.createRange();
                range.selectNodeContents(contentEditableElement);
                range.collapse(false);
                selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range)
            } else if (document.selection) {
                range = document.body.createTextRange();
                range.moveToElementText(contentEditableElement);
                range.collapse(false);
                range.select()
            }
        };
    this.encryptionKey = null;
    this.getEncryptionKey = function () {
        return this.encryptionKey
    };
    this.setEncryptionKey = function (key) {
        this.encryptionKey = key
    };
    _this.b64EncodeUnicode = function (str) {
        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, function (match, p1) {
            return String.fromCharCode("0x" + p1)
        }))
    };
    _this.b64DecodeUnicode = function (str) {
        return decodeURIComponent(Array.prototype.map.call(atob(str), function (c) {
            return "%" + ("00" + c.charCodeAt(0).toString(16)).slice(-2)
        }).join(""))
    };
    _this.ajax = function (options) {
        var reqOptions = $applozic.extend({}, {}, options);
        if (this.getEncryptionKey()) {
            var key =
                aesjs.util.convertStringToBytes(this.getEncryptionKey());
            var iv = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
            if (reqOptions.type.toLowerCase() === "post") {
                while (options.data.length % 16 != 0) options.data += " ";
                var aesCtr = new aesjs.ModeOfOperation.ecb(key);
                var bytes = aesjs.util.convertStringToBytes(options.data);
                var encryptedBytes = aesCtr.encrypt(bytes);
                var encryptedStr = String.fromCharCode.apply(null, encryptedBytes);
                reqOptions.data = btoa(encryptedStr)
            }
            reqOptions.success = function (data) {
                var decodedData = atob(data);
                var arr = [];
                for (var i = 0; i < decodedData.length; i++) arr.push(decodedData.charCodeAt(i));
                var aesCtr = new aesjs.ModeOfOperation.ecb(key);
                var decryptedBytes = aesCtr.decrypt(arr);
                var res = aesjs.util.convertBytesToString(decryptedBytes);
                res = res.replace(/\\u0000/g, "").replace(/^\s*|\s*[\x00-\x10]*$/g, "");
                if (_this.isJsonString(res)) options.success(JSON.parse(res));
                else options.success(res)
            }
        }
        $applozic.ajax(reqOptions)
    };
    _this.isJsonString = function (str) {
        try {
            JSON.parse(str)
        } catch (e) {
            return false
        }
        return true
    }
}

function MckContactUtils() {
    var _this = this;
    _this.getContactId = function (contact) {
        var contactId = contact.contactId;
        return _this.formatContactId(contactId)
    };
    _this.formatContactId = function (contactId) {
        if (contactId.indexOf("+") === 0) contactId = contactId.substring(1);
        contactId = decodeURIComponent(contactId);
        return $applozic.trim(contactId.replace(/@/g, "AT").replace(/\./g, "DOT").replace(/\*/g, "STAR").replace(/#/g, "HASH").replace(/\|/g, "VBAR").replace(/\+/g, "PLUS").replace(/;/g, "SCOLON").replace(/\?/g, "QMARK").replace(/,/g,
            "COMMA").replace(/:/g, "COLON"))
    }
}

function MckMapUtils() {
    var _this = this;
    _this.getCurrentLocation = function (succFunc, errFunc) {
        w.navigator.geolocation.getCurrentPosition(succFunc, errFunc)
    };
    _this.getSelectedLocation = function () {
        return {
            lat: MCK_CURR_LATITIUDE,
            lon: MCK_CURR_LONGITUDE
        }
    }
}

function MckDateUtils() {
    var _this = this;
    var fullDateFormat = "mmm d, h:MM TT";
    var onlyDateFormat = "mmm d";
    var onlyTimeFormat = "h:MM TT";
    var months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    _this.getDate = function (createdAtTime) {
        var date = new Date(parseInt(createdAtTime, 10));
        var currentDate = new Date;
        return currentDate.getDate() === date.getDate() && currentDate.getMonth() === date.getMonth() && currentDate.getYear() === date.getYear() ? dateFormat(date, onlyTimeFormat, false) : dateFormat(date,
            fullDateFormat, false)
    };
    _this.getLastSeenAtStatus = function (lastSeenAtTime) {
        var date = new Date(parseInt(lastSeenAtTime, 10));
        var currentDate = new Date;
        if (currentDate.getDate() === date.getDate() && currentDate.getMonth() === date.getMonth() && currentDate.getYear() === date.getYear()) {
            var hoursDiff = currentDate.getHours() - date.getHours();
            var timeDiff = w.Math.floor((currentDate.getTime() - date.getTime()) / 6E4);
            if (timeDiff < 60) return timeDiff <= 1 ? MCK_LABELS["last.seen"] + " 1 " + MCK_LABELS["min"] + " " + MCK_LABELS["ago"] : MCK_LABELS["last.seen"] +
                " " + timeDiff + MCK_LABELS["mins"] + " " + MCK_LABELS["ago"];
            return hoursDiff === 1 ? MCK_LABELS["last.seen"] + " 1 " + MCK_LABELS["hour"] + " " + MCK_LABELS["ago"] : MCK_LABELS["last.seen"] + " " + hoursDiff + MCK_LABELS["hours"] + " " + MCK_LABELS["ago"]
        } else if (currentDate.getDate() - date.getDate() === 1 && currentDate.getMonth() === date.getMonth() && currentDate.getYear() === date.getYear()) return MCK_LABELS["last.seen.on"] + " " + MCK_LABELS["yesterday"];
        else return MCK_LABELS["last.seen.on"] + " " + dateFormat(date, onlyDateFormat, false)
    };
    _this.getTimeOrDate = function (createdAtTime) {
        var timeStamp = new Date(createdAtTime);
        var currentTime = new Date(),
            secondsPast = Math.max(0,(currentTime.getTime() - timeStamp.getTime() ) / 1000);
        if(secondsPast < 60){
            return (parseInt(secondsPast)<=1) ? parseInt(secondsPast) + ' sec ago' : parseInt(secondsPast) + ' secs ago';
        }
        if(secondsPast < 3600){
            return (parseInt(secondsPast/60)<=1) ? parseInt(secondsPast/60)  + ' min ago' : parseInt(secondsPast/60) + ' mins ago';
        }
        if(secondsPast <= 172800){
            return (parseInt(secondsPast/3600)<=1) ? parseInt(secondsPast/3600) + ' hr ago' : parseInt(secondsPast/3600) + ' hrs ago';
        }
        if(secondsPast > 172800){
              day = timeStamp.getDate();
              month = timeStamp.toDateString().match(/ [a-zA-Z]*/)[0].replace(" ","");
              year = timeStamp.getFullYear() == currentTime.getFullYear() ? "" :  " "+timeStamp.getFullYear();
              return day + " " + month + year;
        }
    };
    _this.getSystemDate = function (time) {
        var date = new Date(parseInt(time, 10));
        return dateFormat(date, fullDateFormat,
            false)
    };
    _this.convertMilisIntoTime = function (millisec) {
        var duration;
        var milliseconds = parseInt(millisec % 1E3 / 100),
            seconds = parseInt(millisec / 1E3 % 60),
            minutes = parseInt(millisec / (1E3 * 60) % 60),
            hours = parseInt(millisec / (1E3 * 60 * 60) % 24);
        if (hours > 0) duration = hours + " Hr " + minutes + " Min " + seconds + " Sec";
        else if (minutes > 0) duration = minutes + " Min " + seconds + " Sec";
        else duration = seconds + " Sec ";
        return duration
    };
    var dateFormat = function () {
        var token = /d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,
            timezone =
            /\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,
            timezoneClip = /[^-+\dA-Z]/g,
            pad = function (val, len) {
                val = String(val);
                len = len || 2;
                while (val.length < len) val = "0" + val;
                return val
            };
        return function (date, mask, utc) {
            var dF = dateFormat;
            if (arguments.length === 1 && Object.prototype.toString.call(date) === "[object String]" && !/\d/.test(date)) {
                mask = date;
                date = undefined
            }
            date = date ? new Date(date) : new Date;
            if (isNaN(date)) throw SyntaxError("invalid date");
            mask = String(mask);
            if (mask.slice(0, 4) === "UTC:") {
                mask = mask.slice(4);
                utc = true
            }
            var _ = utc ? "getUTC" : "get",
                d = date[_ + "Date"](),
                D = date[_ + "Day"](),
                m = date[_ + "Month"](),
                y = date[_ + "FullYear"](),
                H = date[_ + "Hours"](),
                M = date[_ + "Minutes"](),
                s = date[_ + "Seconds"](),
                L = date[_ + "Milliseconds"](),
                o = utc ? 0 : date.getTimezoneOffset(),
                flags = {
                    d: d,
                    dd: pad(d),
                    ddd: dF.i18n.dayNames[D],
                    dddd: dF.i18n.dayNames[D + 7],
                    m: m + 1,
                    mm: pad(m + 1),
                    mmm: dF.i18n.monthNames[m],
                    mmmm: dF.i18n.monthNames[m + 12],
                    yy: String(y).slice(2),
                    yyyy: y,
                    h: H % 12 || 12,
                    hh: pad(H % 12 ||
                        12),
                    H: H,
                    HH: pad(H),
                    M: M,
                    MM: pad(M),
                    s: s,
                    ss: pad(s),
                    l: pad(L, 3),
                    L: pad(L > 99 ? w.Math.round(L / 10) : L),
                    t: H < 12 ? "a" : "p",
                    tt: H < 12 ? "am" : "pm",
                    T: H < 12 ? "A" : "P",
                    TT: H < 12 ? "AM" : "PM",
                    Z: utc ? "UTC" : (String(date).match(timezone) || [""]).pop().replace(timezoneClip, ""),
                    o: (o > 0 ? "-" : "+") + pad(w.Math.floor(w.Math.abs(o) / 60) * 100 + w.Math.abs(o) % 60, 4),
                    S: ["th", "st", "nd", "rd"][d % 10 > 3 ? 0 : (d % 100 - d % 10 !== 10) * d % 10]
                };
            return mask.replace(token, function ($0) {
                return $0 in flags ? flags[$0] : $0.slice(1, $0.length - 1)
            })
        }
    }();
    dateFormat.masks = {
        "default": "mmm d, yyyy h:MM TT",
        fullDateFormat: "mmm d, yyyy h:MM TT",
        onlyDateFormat: "mmm d",
        onlyTimeFormat: "h:MM TT",
        mailDateFormat: "mmm d, yyyy",
        mediumDate: "mmm d, yyyy",
        longDate: "mmmm d, yyyy",
        fullDate: "dddd, mmmm d, yyyy",
        shortTime: "h:MM TT",
        mediumTime: "h:MM:ss TT",
        longTime: "h:MM:ss TT Z",
        isoDate: "yyyy-mm-dd",
        isoTime: "HH:MM:ss",
        isoDateTime: "yyyy-mm-dd'T'HH:MM:ss",
        isoUtcDateTime: "UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"
    };
    dateFormat.i18n = {
        dayNames: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat", "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday",
            "Friday", "Saturday"
        ],
        monthNames: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec", "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"]
    }
}(function (window) {
    function define_Applozic() {
        var Applozic = {};
        Applozic.init = function () {};
        return Applozic
    }
    if (typeof Applozic === "undefined") window.Applozic = define_Applozic();
    else console.log("Applozic already defined.")
})(window);
var ALStorage = function (win) {
    var MCK_LATEST_MESSAGE_ARRAY = [];
    var MCK_MESSAGE_ARRAY = [];
    var MCK_MESSAGE_MAP = [];
    var MCK_CONTACT_NAME_ARRAY = [];
    var FRIEND_LIST_GROUP_NAME;
    var FRIEND_LIST_GROUP_TYPE;
    return {
        updateLatestMessage: function (message) {
            var messageArray = [];
            messageArray.push(message);
            ALStorage.updateLatestMessageArray(messageArray);
            ALStorage.updateMckMessageArray(messageArray)
        },
        getLatestMessageArray: function () {
            return typeof w.sessionStorage !== "undefined" ? $applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray")) :
                MCK_LATEST_MESSAGE_ARRAY
        },
        getFriendListGroupName: function () {
            return typeof w.sessionStorage !== "undefined" ? w.sessionStorage.getItem("friendListGroupName") : FRIEND_LIST_GROUP_NAME
        },
        setFriendListGroupName: function (friendListGroupName) {
            if (typeof w.sessionStorage !== "undefined") w.sessionStorage.setItem("friendListGroupName", friendListGroupName);
            else FRIEND_LIST_GROUP_NAME = friendListGroupName
        },
        setFriendListGroupType: function (friendListGroupType) {
            if (typeof w.sessionStorage !== "undefined") w.sessionStorage.setItem("friendListGroupType",
                friendListGroupType);
            else FRIEND_LIST_GROUP_TYPE = friendListGroupType
        },
        getFriendListGroupType: function () {
            return typeof w.sessionStorage !== "undefined" ? w.sessionStorage.getItem("friendListGroupType") : FRIEND_LIST_GROUP_TYPE
        },
        setLatestMessageArray: function (messages) {
            if (typeof w.sessionStorage !== "undefined") w.sessionStorage.setItem("mckLatestMessageArray", w.JSON.stringify(messages));
            else MCK_LATEST_MESSAGE_ARRAY = messages
        },
        updateLatestMessageArray: function (mckMessageArray) {
            if (typeof w.sessionStorage !== "undefined") {
                var mckLocalMessageArray =
                    $applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray"));
                if (mckLocalMessageArray !== null) {
                    mckLocalMessageArray = mckLocalMessageArray.concat(mckMessageArray);
                    w.sessionStorage.setItem("mckLatestMessageArray", w.JSON.stringify(mckLocalMessageArray))
                } else w.sessionStorage.setItem("mckLatestMessageArray", w.JSON.stringify(mckMessageArray));
                return mckMessageArray
            } else {
                MCK_LATEST_MESSAGE_ARRAY = MCK_LATEST_MESSAGE_ARRAY.concat(mckMessageArray);
                return MCK_LATEST_MESSAGE_ARRAY
            }
        },
        getMckMessageArray: function () {
            return typeof w.sessionStorage !==
                "undefined" ? $applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray")) : MCK_MESSAGE_ARRAY
        },
        clearMckMessageArray: function () {
            if (typeof w.sessionStorage !== "undefined") {
                w.sessionStorage.removeItem("mckMessageArray");
                w.sessionStorage.removeItem("mckLatestMessageArray")
            } else {
                MCK_MESSAGE_ARRAY.length = 0;
                MCK_LATEST_MESSAGE_ARRAY.length = 0
            }
        },
        clearAppHeaders: function () {
            if (typeof w.sessionStorage !== "undefined") w.sessionStorage.removeItem("mckAppHeaders")
        },
        setAppHeaders: function (data) {
            if (typeof w.sessionStorage !==
                "undefined") w.sessionStorage.setItem("mckAppHeaders", w.JSON.stringify(data))
        },
        getAppHeaders: function (data) {
            return typeof w.sessionStorage !== "undefined" ? $applozic.parseJSON(w.sessionStorage.getItem("mckAppHeaders")) : {}
        },
        getMessageByKey: function (key) {
            return MCK_MESSAGE_MAP[key]
        },
        updateMckMessageArray: function (mckMessageArray) {
            for (var i = 0; i < mckMessageArray.length; i++) {
                var message = mckMessageArray[i];
                MCK_MESSAGE_MAP[message.key] = message
            }
            if (typeof w.sessionStorage !== "undefined") {
                var mckLocalMessageArray =
                    $applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray"));
                if (mckLocalMessageArray !== null) {
                    mckLocalMessageArray = mckLocalMessageArray.concat(mckMessageArray);
                    w.sessionStorage.setItem("mckMessageArray", w.JSON.stringify(mckLocalMessageArray))
                } else w.sessionStorage.setItem("mckMessageArray", w.JSON.stringify(mckMessageArray));
                return mckMessageArray
            } else {
                MCK_MESSAGE_ARRAY = MCK_MESSAGE_ARRAY.concat(mckMessageArray);
                return MCK_MESSAGE_ARRAY
            }
        },
        getMckContactNameArray: function () {
            return typeof w.sessionStorage !==
                "undefined" ? $applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray")) : MCK_CONTACT_NAME_ARRAY
        },
        setMckContactNameArray: function (mckContactNameArray) {
            if (typeof w.sessionStorage !== "undefined") w.sessionStorage.setItem("mckContactNameArray", w.JSON.stringify(mckContactNameArray));
            else MCK_CONTACT_NAME_ARRAY = mckContactNameArray
        },
        updateMckContactNameArray: function (mckContactNameArray) {
            if (typeof w.sessionStorage !== "undefined") {
                var mckLocalcontactNameArray = $applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray"));
                if (mckLocalcontactNameArray !== null) mckContactNameArray = mckContactNameArray.concat(mckLocalcontactNameArray);
                w.sessionStorage.setItem("mckContactNameArray", w.JSON.stringify(mckContactNameArray));
                return mckContactNameArray
            } else {
                MCK_CONTACT_NAME_ARRAY = MCK_CONTACT_NAME_ARRAY.concat(mckContactNameArray);
                return MCK_CONTACT_NAME_ARRAY
            }
        },
        clearMckContactNameArray: function () {
            if (typeof w.sessionStorage !== "undefined") w.sessionStorage.removeItem("mckContactNameArray");
            else MCK_CONTACT_NAME_ARRAY.length = 0
        }
    }
}(window);
(function (window) {
    function define_ALApiService(getBaseUrl) {
        var ALApiService = {};
        var MCK_APP_ID = "";
        var mckUtils = new MckUtils;
        var MCK_BASE_URL = "https://apps.applozic.com";
        var MCK_FILE_URL = "https://applozic.appspot.com";
        var INITIALIZE_APP_URL = "/v2/tab/initialize.page";
        var MESSAGE_LIST_URL = "/rest/ws/message/list";
        var MESSAGE_SEND_URL = "/rest/ws/message/send";
        var GROUP_CREATE_URL = "/rest/ws/group/create";
        var GROUP_LIST_URL = "/rest/ws/group/list";
        var GROUP_INFO_URL = "/rest/ws/group/v2/info";
        var GROUP_ADD_MEMBER_URL =
            "/rest/ws/group/add/member";
        var GROUP_REMOVE_MEMBER_URL = "/rest/ws/group/remove/member";
        var GROUP_LEFT_URL = "/rest/ws/group/left";
        var GROUP_UPDATE_URL = "/rest/ws/group/update";
        var GROUP_IS_USER_PRESENT_URL = "/rest/ws/group/check/user";
        var GROUP_USER_COUNT_URL = "/rest/ws/group/user/count";
        var FRIEND_LIST_URL = "/rest/ws/group/";
        var GET_USER_DETAIL_URL = "/rest/ws/user/v2/detail";
        var UPDATE_USER_DETAIL_URL = "/rest/ws/user/update";
        var USER_FILTER = "/rest/ws/user/filter";
        var LOGOUT = "/rest/ws/device/logout";
        var USER_FILTER_BY_ROLE =
            "/rest/ws/user/v3/filter";
        var USER_BLOCK_URL = "/rest/ws/user/block";
        var USER_UNBLOCK_URL = "/rest/ws/user/unblock";
        var UPDATE_PASSWORD_URL = "/rest/ws/user/update/password";
        var UPDATE_REPLY_MAP = "/rest/ws/message/detail";
        var MESSAGE_DELETE_URL = "/rest/ws/message/delete";
        var MESSAGE_READ_UPDATE_URL = "/rest/ws/message/read";
        var MESSAGE_DELIVERY_UPDATE_URL = "/rest/ws/message/delivered";
        var CONVERSATION_CLOSE_UPDATE_URL = "/rest/ws/conversation/close";
        var FILE_PREVIEW_URL = "/rest/ws/aws/file";
        var FILE_UPLOAD_URL =
            "/rest/ws/aws/file/url";
        var FILE_AWS_UPLOAD_URL = "/rest/ws/upload/file";
        var FILE_DELETE_URL = "/rest/ws/aws/file/delete";
        var MESSAGE_ADD_INBOX_URL = "/rest/ws/message/add/inbox";
        var CONVERSATION_READ_UPDATE_URL = "/rest/ws/message/read/conversation";
        var CONVERSATION_DELETE_URL = "/rest/ws/message/delete/conversation";
        var ONE_TO_ONE_MUTE_URL = "/rest/ws/user/chat/mute";
        var GROUP_MUTE_URL = "/rest/ws/group/user/update";
        var REGISTER_CLIENT_URL = "/rest/ws/register/client";
        var SYNC_MUTE_USER_URL = "/rest/ws/user/chat/mute/list";
        var TOPIC_ID_URL = "/rest/ws/conversation/topicId";
        var CONTACT_NAME_URL = "/rest/ws/user/info";
        var USER_STATUS_URL = "/rest/ws/user/chat/status";
        var CONVERSATION_FETCH_URL = "/rest/ws/conversation/get";
        var CONVERSATION_ID_URL = "/rest/ws/conversation/id";
        var FILE_AWS_UPLOAD_URL = "/rest/ws/upload/file";
        var ATTACHMENT_UPLOAD_URL = "/rest/ws/upload/image";
        var PUSH_NOTIFICATION_LOGOUT = "/rest/ws/device/logout";
        var MCK_SW_REGISTER_URL = "/rest/ws/plugin/update/sw/id";
        var ACCESS_TOKEN;
        var DEVICE_KEY;
        var APP_MODULE_NAME;
        var AUTH_CODE;

        function getAsUriParameters(data) {
            var url = "";
            for (var prop in data) url += encodeURIComponent(prop) + "\x3d" + encodeURIComponent(data[prop]) + "\x26";
            return url.substring(0, url.length - 1)
        }
        ALApiService.getFileUrl = function () {
            return MCK_FILE_URL
        };
        ALApiService.initServerUrl = function (serverUrl) {
            MCK_BASE_URL = serverUrl
        };
        ALApiService.login = function (options) {
            MCK_APP_ID = options.data.alUser.applicationId;
            MCK_BASE_URL = options.data.baseUrl ? options.data.baseUrl : "https://apps.applozic.com";
            ALApiService.ajax({
                url: MCK_BASE_URL +
                    INITIALIZE_APP_URL,
                skipEncryption: true,
                type: "post",
                async: typeof options.async !== "undefined" ? options.async : true,
                data: JSON.stringify(options.data.alUser),
                contentType: "application/json",
                headers: {
                    "Application-Key": MCK_APP_ID
                },
                success: function (response) {
                    mckUtils.setEncryptionKey(response.encryptionKey);
                    AUTH_CODE = btoa(response.userId + ":" + response.deviceKey);
                    DEVICE_KEY = response.deviceKey;
                    ACCESS_TOKEN = options.data.alUser.password;
                    APP_MODULE_NAME = options.data.alUser.appModuleName;
                    ALApiService.setAjaxHeaders(AUTH_CODE,
                        MCK_APP_ID, response.deviceKey, options.data.alUser.password, options.data.alUser.appModuleName);
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.getAttachmentHeaders = function () {
            var headers = {
                "UserId-Enabled": true,
                "Authorization": "Basic " + AUTH_CODE,
                "Application-Key": MCK_APP_ID,
                "Device-Key": DEVICE_KEY
            };
            if (ACCESS_TOKEN) headers["Access-Token"] = ACCESS_TOKEN;
            return headers
        }, ALApiService.setAjaxHeaders = function (authcode, appId, devKey,
            accToken, modName) {
            MCK_APP_ID = appId;
            AUTH_CODE = authcode;
            DEVICE_KEY = devKey;
            ACCESS_TOKEN = accToken;
            APP_MODULE_NAME = modName
        };
        ALApiService.ajax = function (options) {
            function extend() {
                for (var i = 1; i < arguments.length; i++)
                    for (var key in arguments[i])
                        if (arguments[i].hasOwnProperty(key)) arguments[0][key] = arguments[i][key];
                return arguments[0]
            }
            var reqOptions = extend({}, {}, options);
            if (!(options.skipEncryption === true) && mckUtils.getEncryptionKey()) {
                var key = aesjs.util.convertStringToBytes(mckUtils.getEncryptionKey());
                var iv = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
                if (reqOptions.type.toLowerCase() === "post") {
                    while (options.data.length % 16 != 0) options.data += " ";
                    var aesCtr = new aesjs.ModeOfOperation.ecb(key);
                    var bytes = aesjs.util.convertStringToBytes(options.data);
                    var encryptedBytes = aesCtr.encrypt(bytes);
                    var encryptedStr = String.fromCharCode.apply(null, encryptedBytes);
                    reqOptions.data = btoa(encryptedStr)
                }
                reqOptions.success = function (data) {
                    var decodedData = atob(data);
                    var arr = [];
                    for (var i = 0; i < decodedData.length; i++) arr.push(decodedData.charCodeAt(i));
                    var aesCtr = new aesjs.ModeOfOperation.ecb(key);
                    var decryptedBytes = aesCtr.decrypt(arr);
                    var res = aesjs.util.convertBytesToString(decryptedBytes);
                    res = res.replace(/\\u0000/g, "").replace(/^\s*|\s*[\x00-\x10]*$/g, "");
                    if (mckUtils.isJsonString(res)) options.success(JSON.parse(res));
                    else options.success(res)
                }
            }
            var request = new XMLHttpRequest;
            var responsedata;
            var asyn = true;
            var cttype;
            if (typeof reqOptions.async !== "undefined" || options.async) asyn = reqOptions.async;
            var typ = reqOptions.type.toUpperCase();
            if (typ === "GET" &&
                typeof reqOptions.data !== "undefined") reqOptions.url = reqOptions.url + "?" + reqOptions.data;
            request.open(typ, reqOptions.url, asyn);
            if (typ === "POST" || typ === "GET") {
                if (typeof reqOptions.contentType === "undefined") cttype = "application/x-www-form-urlencoded; charset\x3dUTF-8";
                else cttype = reqOptions.contentType;
                request.setRequestHeader("Content-Type", cttype)
            }
            MCK_BASE_URL = MCK_BASE_URL ? MCK_BASE_URL : "https://apps.applozic.com";
            if (reqOptions.url.indexOf(MCK_BASE_URL) !== -1) {
                request.setRequestHeader("UserId-Enabled",
                    true);
                if (AUTH_CODE) request.setRequestHeader("Authorization", "Basic " + AUTH_CODE);
                request.setRequestHeader("Application-Key", MCK_APP_ID);
                if (DEVICE_KEY) request.setRequestHeader("Device-Key", DEVICE_KEY);
                if (ACCESS_TOKEN) request.setRequestHeader("Access-Token", ACCESS_TOKEN);
                if (APP_MODULE_NAME) request.setRequestHeader("App-Module-Name", APP_MODULE_NAME)
            }
            if (typeof reqOptions.data === "undefined") request.send();
            else request.send(reqOptions.data);
            request.onreadystatechange = function () {
                if (request.readyState === XMLHttpRequest.DONE)
                    if (request.status ===
                        200) {
                        var contType = request.getResponseHeader("Content-Type");
                        if (typeof contType === "undefined" || contType === "null" || contType === null) contType = "";
                        if (contType.toLowerCase().indexOf("text/html") != -1) responsedata = request.responseXML;
                        else if (contType.toLowerCase().indexOf("application/json") != -1) responsedata = JSON.parse(request.responseText);
                        else responsedata = request.responseText;
                        reqOptions.success(responsedata)
                    } else reqOptions.error(responsedata)
            }
        };
        ALApiService.getMessages = function (options) {
            if (options.data.userId ||
                options.data.groupId) {
                if (options.data.pageSize === "undefined") options.data.pageSize = 30
            } else if (typeof options.data.mainPageSize === "undefined") options.data.mainPageSize = 60;
            var data = getAsUriParameters(options.data);
            var response = new Object;
            ALApiService.ajax({
                url: MCK_BASE_URL + MESSAGE_LIST_URL + "?" + data,
                async: typeof options.async !== "undefined" ? options.async : true,
                type: "get",
                success: function (data) {
                    response.status = "success";
                    response.data = data;
                    if (options.success) options.success(response);
                    return
                },
                error: function (xhr,
                    desc, err) {
                    response.status = "error";
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.sendMessage = function (options) {
            ALApiService.ajax({
                type: "POST",
                url: MCK_BASE_URL + MESSAGE_SEND_URL,
                global: false,
                data: JSON.stringify(options.data.message),
                async: typeof options.async !== "undefined" ? options.async : true,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.sendDeliveryUpdate = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + MESSAGE_DELIVERY_UPDATE_URL,
                data: "key\x3d" + options.data.key,
                global: false,
                type: "get",
                async: typeof options.async !== "undefined" ? options.async : true,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.sendReadUpdate = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + MESSAGE_READ_UPDATE_URL,
                data: "key\x3d" + options.data.key,
                global: false,
                type: "get",
                async: typeof options.async !== "undefined" ? options.async : true,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.deleteMessage = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + MESSAGE_DELETE_URL + "?key\x3d" + options.data.key,
                global: false,
                type: "get",
                async: typeof options.async !== "undefined" ? options.async : true,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.updateReplyMessage = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + UPDATE_REPLY_MAP + "?keys\x3d" + options.data.key,
                type: "get",
                async: typeof options.async !== "undefined" ? options.async : true,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.deleteConversation = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + CONVERSATION_DELETE_URL,
                type: "get",
                async: typeof options.async !== "undefined" ?
                    options.async : true,
                global: false,
                data: getAsUriParameters(options.data),
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.createGroup = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_CREATE_URL,
                global: false,
                data: JSON.stringify(options.data.group),
                type: "post",
                async: typeof options.async !== "undefined" ? options.async : true,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.loadGroups = function (options) {
            if (options.baseUrl) MCK_BASE_URL = options.baseUrl;
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_LIST_URL,
                type: "get",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.getGroupInfo = function (options) {
            var groupId = options.data.groupId ?
                "?groupId\x3d" + options.data.groupId : "?clientGroupId\x3d" + options.data.clientGroupId;
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_INFO_URL + groupId,
                type: "get",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.addGroupMember = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_ADD_MEMBER_URL,
                type: "POST",
                data: JSON.stringify(options.data.group),
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.removeGroupMember = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_REMOVE_MEMBER_URL,
                type: "POST",
                data: JSON.stringify(options.data),
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.groupLeave = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_LEFT_URL,
                type: "POST",
                data: JSON.stringify(options.data),
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.groupUpdate = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_UPDATE_URL,
                type: "POST",
                data: JSON.stringify(options.data),
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response, options.data.group)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.isUserPresentInGroup = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_IS_USER_PRESENT_URL +
                    "?userId\x3d" + options.data.userId + "\x26clientGroupId\x3d" + options.data.clientGroupId,
                type: "get",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.groupUserCount = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_USER_COUNT_URL + "?clientGroupIds\x3d" + options.data.clientGroupId,
                type: "get",
                async: typeof options.async !==
                    "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.groupDelete = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_LEFT_URL + "?clientGroupId\x3d" + options.data.clientGroupId,
                type: "GET",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.createUserFriendList = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + FRIEND_LIST_URL + options.data.group.groupName + "/add/",
                type: "POST",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                data: JSON.stringify(options.data.group.groupMemberList),
                contentType: "application/json",
                success: function (response) {
                    if (options.success) {
                        options.success(response);
                        ALStorage.setFriendListGroupName(options.data.group.groupName)
                    }
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.createOpenFriendList = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + FRIEND_LIST_URL + options.data.group.groupName + "/add/members",
                type: "POST",
                data: JSON.stringify(options.data.group),
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) {
                        options.success(response);
                        ALStorage.setFriendListGroupName(options.data.group.groupName);
                        ALStorage.setFriendListGroupType(options.data.group.type)
                    }
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.getFriendList = function (options) {
            var getFriendListUrl = options.data.type !== "null" ? "/get?groupType\x3d9" : "/get";
            options.data.url = options.data.url ? options.data.url : getFriendListUrl;
            ALApiService.ajax({
                url: MCK_BASE_URL + FRIEND_LIST_URL + options.data.groupName + options.data.url,
                type: "GET",
                async: typeof options.data.async !== "undefined" ? options.data.async : true,
                global: false,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.removeUserFromFriendList = function (options) {
            var getFriendListUrl = options.group.type ? "/remove?userId\x3d" + options.group.userId + "\x26groupType\x3d9" : "/remove?userId\x3d" + options.group.userId;
            ALApiService.ajax({
                url: MCK_BASE_URL + FRIEND_LIST_URL + options.group.groupName + getFriendListUrl,
                type: "Post",
                contentType: "application/json",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.deleteFriendList = function (options) {
            var getFriendListUrl = options.group.type ? "/delete?groupType\x3d9" : "/delete";
            ALApiService.ajax({
                url: MCK_BASE_URL + FRIEND_LIST_URL + options.group.groupName + getFriendListUrl,
                type: "GET",
                async: false,
                contentType: "application/json",
                async: typeof options.async !== "undefined" ? options.async : true,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.getUserDetail = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL +
                    GET_USER_DETAIL_URL,
                data: JSON.stringify({
                    userIdList: options.data.userIdList
                }),
                type: "POST",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.updateUserDetail = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + UPDATE_USER_DETAIL_URL,
                data: JSON.stringify(options.data),
                type: "POST",
                async: typeof options.async !==
                    "undefined" ? options.async : true,
                global: false,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.updatePassword = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + UPDATE_PASSWORD_URL + "?oldPassword\x3d" + options.data.oldPassword + "\x26newPassword\x3d" + options.data.newPassword,
                type: "GET",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.getContactList = function (options) {
            var baseurl = options.baseUrl ? options.baseUrl : MCK_BASE_URL;
            ALApiService.ajax({
                url: baseurl + options.url,
                type: "GET",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.userChatMute = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL +
                    ONE_TO_ONE_MUTE_URL + "?userId\x3d" + options.data.userId + "\x26notificationAfterTime\x3d" + options.data.notificationAfterTime,
                type: "post",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.groupMute = function (options) {
            var group = {};
            group.clientGroupId = options.data.clientGroupId;
            group.notificationAfterTime = options.data.notificationAfterTime;
            ALApiService.ajax({
                url: MCK_BASE_URL + GROUP_MUTE_URL,
                type: "post",
                data: JSON.stringify(group),
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.syncMuteUserList = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + SYNC_MUTE_USER_URL,
                type: "get",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.blockUser = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL +
                    USER_BLOCK_URL + "?userId\x3d" + options.data.userId + "\x26block\x3d" + options.data.isBlock,
                type: "GET",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.unBlockUser = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + USER_UNBLOCK_URL + "?userId\x3d" + options.data.userId,
                type: "GET",
                async: typeof options.async !== "undefined" ? options.async : true,
                global: false,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.sendConversationCloseUpdate = function (options) {
            var data = "id\x3d" + options.conversationId;
            ALApiService.ajax({
                url: MCK_BASE_URL + CONVERSATION_CLOSE_UPDATE_URL,
                data: data,
                global: false,
                type: "get",
                success: function () {},
                error: function () {}
            })
        };
        ALApiService.fileUpload = function (options) {
            ALApiService.ajax({
                type: "GET",
                url: options.data.url,
                global: false,
                data: "data\x3d" + (new Date).getTime(),
                crosDomain: true,
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.sendAttachment = function (options) {
            var data = new FormData;
            var xhr = new XMLHttpRequest;
            xhr.addEventListener("load", function (e) {
                var file = this.responseText;
                var message = options.data.messagePxy;
                if (file) {
                    message.fileMeta = JSON.parse(file);
                    Applozic.ALApiService.sendMessage({
                        data: message,
                        success: function (response) {
                            console.log(response)
                        },
                        error: function () {}
                    })
                }
            });
            data.append("file", options.data.file);
            xhr.open("post", MCK_BASE_URL + ATTACHMENT_UPLOAD_URL, true);
            xhr.setRequestHeader("UserId-Enabled", true);
            xhr.setRequestHeader("Authorization", "Basic " + AUTH_CODE);
            xhr.setRequestHeader("Application-Key", MCK_APP_ID);
            xhr.setRequestHeader("Device-Key", DEVICE_KEY);
            if (ACCESS_TOKEN) xhr.setRequestHeader("Access-Token", ACCESS_TOKEN);
            xhr.send(data)
        };
        ALApiService.deleteFileMeta = function (options) {
            ALApiService.ajax({
                url: options.data.url,
                type: "post",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.addMessageInbox = function (options) {
            ALApiService.ajax({
                type: "GET",
                url: MCK_BASE_URL + MESSAGE_ADD_INBOX_URL,
                global: false,
                data: "sender\x3d" + encodeURIComponent(options.data.sender) + "\x26messageContent\x3d" + encodeURIComponent(options.data.messageContent),
                contentType: "text/plain",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.conversationReadUpdate =
            function (options) {
                ALApiService.ajax({
                    url: MCK_BASE_URL + CONVERSATION_READ_UPDATE_URL,
                    data: options.data,
                    global: false,
                    type: "get",
                    success: function (response) {
                        if (options.success) options.success(response)
                    },
                    error: function (response) {
                        if (options.error) options.success(response)
                    }
                })
            };
        ALApiService.sendSubscriptionIdToServer = function (options) {
            var subscriptionId = options.data.subscriptionId;
            ALApiService.ajax({
                url: MCK_BASE_URL + MCK_SW_REGISTER_URL,
                type: "post",
                data: "registrationId\x3d" + subscriptionId,
                success: function (data) {},
                error: function (xhr, desc, err) {
                    if (xhr.status === 401) {
                        sessionStorage.clear();
                        console.log("Please reload page.")
                    }
                }
            })
        };
        ALApiService.getTopicId = function (options) {
            var conversationId = "id\x3d" + options.data.conversationId;
            ALApiService.ajax({
                url: MCK_BASE_URL + TOPIC_ID_URL + "?" + conversationId,
                type: "get",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.success(response)
                }
            })
        };
        ALApiService.getContactDisplayName = function (options) {
            var userIdArray =
                options.data.userIdArray;
            if (userIdArray.length > 0 && userIdArray[0]) {
                var data = "";
                var uniqueUserIdArray = userIdArray.filter(function (item, pos) {
                    return userIdArray.indexOf(item) === pos
                });
                for (var i = 0; i < uniqueUserIdArray.length; i++) {
                    var userId = uniqueUserIdArray[i];
                    if (typeof MCK_CONTACT_NAME_MAP[userId] === "undefined") data += "userIds\x3d" + encodeURIComponent(userId) + "\x26"
                }
                if (data.lastIndexOf("\x26") === data.length - 1) data = data.substring(0, data.length - 1);
                if (data) ALApiService.ajax({
                    url: MCK_BASE_URL + CONTACT_NAME_URL,
                    data: data,
                    global: false,
                    type: "get",
                    success: function (response) {
                        if (options.success) options.success(response)
                    },
                    error: function (response) {
                        if (options.error) options.success(response)
                    }
                })
            }
        };
        ALApiService.getUserStatus = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + USER_STATUS_URL,
                type: "get",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.success(response)
                }
            })
        };
        ALApiService.fetchConversationByTopicId = function (options) {
            var reqdata =
                "topic\x3d" + options.data.topicId;
            if (options.data.tabId) reqdata += "" + options.data.isGroup === "true" ? "\x26groupId\x3d" + options.data.tabId : "\x26userId\x3d" + encodeURIComponent(options.data.tabId);
            else if (options.data.clientGroupId) reqdata += "\x26clientGroupId\x3d" + options.data.clientGroupId;
            else return false;
            if (options.data.pageSize) reqdata += "\x26pageSize\x3d" + options.data.pageSize;
            ALApiService.ajax({
                url: MCK_BASE_URL + CONVERSATION_FETCH_URL,
                data: reqdata,
                type: "get",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.success(response)
                }
            })
        };
        ALApiService.getConversationId = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + CONVERSATION_ID_URL,
                global: false,
                data: w.JSON.stringify(options.data),
                type: "post",
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.success(response)
                }
            })
        };
        ALApiService.registerClientApi = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + REGISTER_CLIENT_URL,
                type: "post",
                data: JSON.stringify(options.data.userPxy),
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.success(response)
                }
            })
        };
        ALApiService.logout = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + LOGOUT,
                type: "post",
                async: typeof options.async !== "undefined" ? options.async : true,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        ALApiService.getUsersByRole = function (options) {
            var data = getAsUriParameters(options.data);
            ALApiService.ajax({
                url: MCK_BASE_URL + USER_FILTER_BY_ROLE + "?" + data,
                global: false,
                type: "get",
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.success(response)
                }
            })
        };
        ALApiService.pushNotificationLogout = function (options) {
            ALApiService.ajax({
                url: MCK_BASE_URL + PUSH_NOTIFICATION_LOGOUT,
                type: "post",
                async: typeof options.async !==
                    "undefined" ? options.async : true,
                contentType: "application/json",
                success: function (response) {
                    if (options.success) options.success(response)
                },
                error: function (response) {
                    if (options.error) options.error(response)
                }
            })
        };
        return ALApiService
    }
    if (typeof ALApiService === "undefined") window.Applozic.ALApiService = define_ALApiService();
    else console.log("ALApiService already defined.")
})(window);
(function (window) {
    function define_ALSocket() {
        var ALSocket = {};
        var MCK_APP_ID;
        ALSocket.events = {};
        var subscriber = null;
        ALSocket.stompClient = null;
        var TYPING_TAB_ID = "";
        ALSocket.typingSubscriber = null;
        var openGroupSubscriber = [];
        var checkConnectedIntervalId;
        var sendConnectedStatusIntervalId;
        var OPEN_GROUP_SUBSCRIBER_MAP;
        ALSocket.mck_typing_status = 0;
        var MCK_TYPING_STATUS;
        var SOCKET = "";
        var MCK_WEBSOCKET_URL = "https://apps.applozic.com";
        var MCK_TOKEN;
        var USER_DEVICE_KEY;
        var mckUtils = new MckUtils;
        ALSocket.init =
            function (appId, data, _events) {
                if (appId) MCK_APP_ID = appId;
                if (typeof data !== "undefined") {
                    MCK_TOKEN = data.token;
                    USER_DEVICE_KEY = data.deviceKey;
                    MCK_WEBSOCKET_URL = data.websocketUrl
                }
                ALSocket.events = _events;
                if (typeof MCK_WEBSOCKET_URL !== "undefined") {
                    var port = !mckUtils.startsWith(MCK_WEBSOCKET_URL, "https") ? "15674" : "15675";
                    if (typeof SockJS === "function") {
                        if (!SOCKET) SOCKET = new SockJS(MCK_WEBSOCKET_URL + ":" + port + "/stomp");
                        ALSocket.stompClient = Stomp.over(SOCKET);
                        ALSocket.stompClient.heartbeat.outgoing = 0;
                        ALSocket.stompClient.heartbeat.incoming =
                            0;
                        ALSocket.stompClient.onclose = function () {
                            ALSocket.disconnect()
                        };
                        ALSocket.stompClient.connect("guest", "guest", ALSocket.onConnect, ALSocket.onError, "/");
                        window.addEventListener("beforeunload", function (e) {
                            var check_url = e.target.activeElement.href;
                            if (!check_url || 0 === check_url.length) ALSocket.disconnect()
                        })
                    }
                }
            };
        ALSocket.checkConnected = function (isFetchMessages) {
            if (ALSocket.stompClient.connected) {
                if (checkConnectedIntervalId) clearInterval(checkConnectedIntervalId);
                if (sendConnectedStatusIntervalId) clearInterval(sendConnectedStatusIntervalId);
                checkConnectedIntervalId = setInterval(function () {
                    ALSocket.connectToSocket(isFetchMessages)
                }, 6E5);
                sendConnectedStatusIntervalId = setInterval(function () {
                    ALSocket.sendStatus(1)
                }, 12E5)
            } else ALSocket.connectToSocket(isFetchMessages)
        };
        ALSocket.connectToSocket = function (isFetchMessages) {
            if (typeof ALSocket.connectToSocket === "function") ALSocket.events.connectToSocket(isFetchMessages)
        };
        ALSocket.stopConnectedCheck = function () {
            if (checkConnectedIntervalId) clearInterval(checkConnectedIntervalId);
            if (sendConnectedStatusIntervalId) clearInterval(sendConnectedStatusIntervalId);
            checkConnectedIntervalId = "";
            sendConnectedStatusIntervalId = "";
            ALSocket.disconnect()
        };
        ALSocket.disconnect = function () {
            if (ALSocket.stompClient && ALSocket.stompClient.connected) {
                ALSocket.sendStatus(0);
                ALSocket.stompClient.disconnect()
            }
        };
        ALSocket.unsubscibeToTypingChannel = function () {
            if (ALSocket.stompClient && ALSocket.stompClient.connected)
                if (ALSocket.typingSubscriber) {
                    if (ALSocket.mck_typing_status === 1) ALSocket.sendTypingStatus(0, TYPING_TAB_ID);
                    ALSocket.typingSubscriber.unsubscribe()
                }
            ALSocket.typingSubscriber =
                null
        };
        ALSocket.unsubscibeToNotification = function () {
            if (ALSocket.stompClient && ALSocket.stompClient.connected)
                if (subscriber) subscriber.unsubscribe();
            subscriber = null
        };
        ALSocket.subscibeToTypingChannel = function (subscribeId) {
            if (ALSocket.stompClient && ALSocket.stompClient.connected) ALSocket.typingSubscriber = ALSocket.stompClient.subscribe("/topic/typing-" + MCK_APP_ID + "-" + subscribeId, ALSocket.onTypingStatus);
            else ALSocket.reconnect()
        };
        ALSocket.subscribeToOpenGroup = function (group) {
            if (ALSocket.stompClient && ALSocket.stompClient.connected) {
                var subs =
                    ALSocket.stompClient.subscribe("/topic/group-" + MCK_APP_ID + "-" + group.contactId, ALSocket.onOpenGroupMessage);
                openGroupSubscriber.push(subs.id);
                OPEN_GROUP_SUBSCRIBER_MAP[group.contactId] = subs.id
            } else ALSocket.reconnect()
        };
        ALSocket.sendTypingStatus = function (status, mck_typing_status, MCK_USER_ID, tabId) {
            ALSocket.mck_typing_status = mck_typing_status;
            if (ALSocket.stompClient && ALSocket.stompClient.connected) {
                if (status === 1 && ALSocket.mck_typing_status === 1) ALSocket.stompClient.send("/topic/typing-" + MCK_APP_ID + "-" +
                    TYPING_TAB_ID, {
                        "content-type": "text/plain"
                    }, MCK_APP_ID + "," + MCK_USER_ID + "," + status);
                if (tabId) {
                    if (tabId === TYPING_TAB_ID && status === ALSocket.mck_typing_status && status === 1) return;
                    TYPING_TAB_ID = tabId;
                    ALSocket.stompClient.send("/topic/typing-" + MCK_APP_ID + "-" + tabId, {
                        "content-type": "text/plain"
                    }, MCK_APP_ID + "," + MCK_USER_ID + "," + status);
                    setTimeout(function () {
                        ALSocket.mck_typing_status = 0
                    }, 6E4)
                } else if (status === 0) ALSocket.stompClient.send("/topic/typing-" + MCK_APP_ID + "-" + TYPING_TAB_ID, {
                        "content-type": "text/plain"
                    },
                    MCK_APP_ID + "," + MCK_USER_ID + "," + status);
                ALSocket.mck_typing_status = status
            }
        };
        ALSocket.onTypingStatus = function (resp) {
            if (typeof ALSocket.events.onTypingStatus === "function") ALSocket.events.onTypingStatus(resp)
        };
        ALSocket.reconnect = function () {
            ALSocket.unsubscibeToTypingChannel();
            ALSocket.unsubscibeToNotification();
            ALSocket.disconnect();
            var data = {};
            data.token = MCK_TOKEN;
            data.deviceKey = USER_DEVICE_KEY;
            data.websocketUrl = MCK_WEBSOCKET_URL;
            ALSocket.init(MCK_APP_ID, data, ALSocket.events)
        };
        ALSocket.onError = function (err) {
            console.log("Error in channel notification. " +
                err);
            if (typeof ALSocket.events.onConnectFailed === "function") ALSocket.events.onConnectFailed()
        };
        ALSocket.sendStatus = function (status) {
            if (ALSocket.stompClient && ALSocket.stompClient.connected) ALSocket.stompClient.send("/topic/status-v2", {
                "content-type": "text/plain"
            }, MCK_TOKEN + "," + USER_DEVICE_KEY + "," + status)
        };
        ALSocket.onConnect = function () {
            if (ALSocket.stompClient.connected) {
                if (subscriber) ALSocket.unsubscibeToNotification();
                subscriber = ALSocket.stompClient.subscribe("/topic/" + MCK_TOKEN, ALSocket.onMessage);
                ALSocket.sendStatus(1);
                ALSocket.checkConnected(true)
            } else setTimeout(function () {
                subscriber = ALSocket.stompClient.subscribe("/topic/" + MCK_TOKEN, ALSocket.onMessage);
                ALSocket.sendStatus(1);
                ALSocket.checkConnected(true)
            }, 5E3);
            if (typeof ALSocket.events.onConnect === "function") ALSocket.events.onConnect()
        };
        ALSocket.onOpenGroupMessage = function (obj) {
            if (typeof ALSocket.events.onOpenGroupMessage === "function") ALSocket.events.onOpenGroupMessage(obj)
        };
        ALSocket.onMessage = function (obj) {
            if (subscriber != null && subscriber.id ===
                obj.headers.subscription) {
                var resp = JSON.parse(obj.body);
                var messageType = resp.type;
                if (typeof ALSocket.events.onMessage === "function") ALSocket.events.onMessage(resp);
                if (messageType === "APPLOZIC_04" || messageType === "MESSAGE_DELIVERED") ALSocket.events.onMessageDelivered(resp);
                else if (messageType === "APPLOZIC_08" || messageType === "MT_MESSAGE_DELIVERED_READ") ALSocket.events.onMessageRead(resp);
                else if (messageType === "APPLOZIC_05") ALSocket.events.onMessageDeleted(resp);
                else if (messageType === "APPLOZIC_27") ALSocket.events.onConversationDeleted(resp);
                else if (messageType === "APPLOZIC_11") ALSocket.events.onUserConnect(resp.message);
                else if (messageType === "APPLOZIC_12") {
                    var lastSeenAtTime = resp.message.split(",")[1];
                    ALSocket.events.onUserDisconnect({
                        "userId": userId,
                        "lastSeenAtTime": lastSeenAtTime
                    })
                } else if (messageType === "APPLOZIC_29") ALSocket.events.onConversationReadFromOtherSource(resp);
                else if (messageType === "APPLOZIC_28") ALSocket.events.onConversationRead(resp);
                else if (messageType === "APPLOZIC_16") {
                    var status = resp.message.split(":")[0];
                    var userId =
                        resp.message.split(":")[1];
                    ALSocket.events.onUserBlocked({
                        "status": status,
                        "userId": userId
                    })
                } else if (messageType === "APPLOZIC_17") {
                    var status = resp.message.split(":")[0];
                    var userId = resp.message.split(":")[1];
                    ALSocket.events.onUserUnblocked({
                        "status": status,
                        "userId": userId
                    })
                } else if (messageType === "APPLOZIC_18") ALSocket.events.onUserActivated();
                else if (messageType === "APPLOZIC_19") ALSocket.events.onUserDeactivated();
                else {
                    var message = resp.message;
                    if (messageType === "APPLOZIC_03") ALSocket.events.onMessageSentUpdate({
                        "messageKey": message.key
                    });
                    else if (messageType === "APPLOZIC_01" || messageType === "MESSAGE_RECEIVED") {
                        var messageFeed = alMessageService.getMessageFeed(message);
                        ALSocket.events.onMessageReceived({
                            "message": messageFeed
                        })
                    } else if (messageType === "APPLOZIC_02") {
                        var messageFeed = alMessageService.getMessageFeed(message);
                        ALSocket.events.onMessageSent({
                            "message": messageFeed
                        })
                    }
                }
            }
        };
        return ALSocket
    }
    if (typeof ALSocket === "undefined") window.Applozic.ALSocket = define_ALSocket();
    else console.log("ALSocket already defined.")
})(window);
var mckNotificationUtils = new MckNotificationUtils;
var alNotificationService = new AlNotificationService;

function AlNotificationService() {
    var _this = this;
    var IS_SW_NOTIFICATION_ENABLED;
    var MCK_GETUSERIMAGE;
    var MCK_NOTIFICATION_ICON_LINK;
    var IS_MCK_NOTIFICATION;
    var MCK_SW_SUBSCRIPTION;
    var MCK_SW_REGISTER_URL = "/rest/ws/plugin/update/sw/id";
    var IS_MCK_TAB_FOCUSED = true;
    _this.init = function (optns) {
        IS_SW_NOTIFICATION_ENABLED = typeof optns.swNotification === "boolean" ? optns.swNotification : false;
        MCK_GETUSERIMAGE = optns.contactDisplayImage;
        MCK_NOTIFICATION_ICON_LINK = optns.notificationIconLink;
        IS_MCK_NOTIFICATION = typeof optns.desktopNotification ===
            "boolean" ? optns.desktopNotification : false
    };
    _this.unsubscribeToServiceWorker = function () {
        if (MCK_SW_SUBSCRIPTION) navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {
            MCK_SW_SUBSCRIPTION.unsubscribe().then(function (successful) {
                MCK_SW_SUBSCRIPTION = null;
                console.log("Unsubscribed to notification successfully")
            })
        })
    };
    _this.sendSubscriptionIdToServer = function () {
        if (MCK_SW_SUBSCRIPTION) {
            var subscriptionId = MCK_SW_SUBSCRIPTION.endpoint.split("/").slice(-1)[0];
            if (subscriptionId) window.Applozic.ALApiService.sendSubscriptionIdToServer({
                data: {
                    "subscriptionId": subscriptionId
                },
                success: function (result) {},
                error: function () {}
            })
        }
    };
    _this.subscribeToServiceWorker = function () {
        if (IS_SW_NOTIFICATION_ENABLED)
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker.register("./service-worker.js", {
                    scope: "./"
                });
                navigator.serviceWorker.ready.then(function (serviceWorkerRegistration) {
                    serviceWorkerRegistration.pushManager.subscribe({
                        userVisibleOnly: true
                    }).then(function (pushSubscription) {
                        console.log("The reg ID is:: ", pushSubscription.endpoint.split("/").slice(-1));
                        MCK_SW_SUBSCRIPTION = pushSubscription;
                        _this.sendSubscriptionIdToServer()
                    })
                })
            }
    }
}

function MckNotificationUtils() {
    var _this = this;
    var PERMISSION_DEFAULT = "default",
        PERMISSION_GRANTED = "granted",
        PERMISSION_DENIED = "denied",
        PERMISSION = [PERMISSION_GRANTED, PERMISSION_DEFAULT, PERMISSION_DENIED],
        isSupported = function () {
            var isSupported = false;
            try {
                isSupported = !!(w.Notification || w.webkitNotifications || navigator.mozNotification || w.external && w.external.msIsSiteMode() !== undefined)
            } catch (e) {}
            return isSupported
        }(),
        isFunction = function (value) {
            return value && value.constructor === Function
        },
        isString = function (value) {
            return value &&
                value.constructor === String
        },
        isObject = function (value) {
            return value && value.constructor === Object
        },
        ieVerification = Math.floor(Math.random() * 10 + 1),
        noop = function () {};
    _this.permissionLevel = function () {
        var permission;
        if (!isSupported) return;
        if (w.Notification && w.Notification.permissionLevel) permission = w.Notification.permissionLevel();
        else if (w.webkitNotifications && w.webkitNotifications.checkPermission) permission = PERMISSION[w.webkitNotifications.checkPermission()];
        else if (w.Notification && w.Notification.permission) permission =
            w.Notification.permission;
        else if (navigator.mozNotification) permission = PERMISSION_GRANTED;
        else if (w.external && w.external.msIsSiteMode() !== undefined) permission = w.external.msIsSiteMode() ? PERMISSION_GRANTED : PERMISSION_DEFAULT;
        return permission
    };
    _this.requestPermission = function (callback) {
        var callbackFunction = isFunction(callback) ? callback : noop;
        if (w.webkitNotifications && w.webkitNotifications.checkPermission) w.webkitNotifications.requestPermission(callbackFunction);
        else if (w.Notification && w.Notification.requestPermission) w.Notification.requestPermission(callbackFunction)
    };
    _this.isChrome = function () {
        return /chrom(e|ium)/.test(w.navigator.userAgent.toLowerCase())
    };
    _this.getNotification = function (displayName, iconLink, msg, notificationsound) {
        if (notificationsound) {
            notificationsound.play();
            setTimeout(function () {
                notificationsound.stop()
            }, 1E3)
        }
        var notification;
        if (w.Notification) {
            var options = {
                icon: iconLink,
                body: msg
            };
            notification = new w.Notification(displayName, options);
            notification.onclick = function () {
                w.focus();
                this.close()
            }
        } else if (w.webkitNotifications) {
            notification = w.webkitNotifications.createNotification(iconLink,
                displayName, msg);
            if (notificationsound) notification.show();
            if (_this.isChrome()) notification.onclick = function () {
                w.focus();
                this.cancel()
            };
            notification.show();
            setTimeout(function () {
                notification.cancel()
            }, 3E4)
        } else if (navigator.mozNotification) {
            notification = navigator.mozNotification.createNotification(displayName, msg, iconLink);
            notification.show()
        } else if (w.external && w.external.msIsSiteMode()) {
            w.external.msSiteModeClearIconOverlay();
            w.external.msSiteModeSetIconOverlay(iconLink, displayName);
            w.external.msSiteModeActivate();
            notification = {
                "ieVerification": ieVerification + 1
            }
        }
        return notification
    };
    _this.sendDesktopNotification = function (displayName, iconLink, msg, notificationsound) {
        if (_this.permissionLevel() !== PERMISSION_GRANTED) w.Notification.requestPermission();
        if (_this.permissionLevel() === PERMISSION_GRANTED) {
            var notification;
            if (notificationsound) notification = _this.getNotification(displayName, iconLink, msg, notificationsound);
            else notification = _this.getNotification(displayName, iconLink, msg);
            var notificationWrapper = _this.getWrapper(notification);
            if (notification && !notification.ieVerification && notification.addEventListener) notification.addEventListener("show", function () {
                var notification = notificationWrapper;
                w.setTimeout(function () {
                    notification.close()
                }, 3E4)
            })
        }
    };
    _this.getWrapper = function (notification) {
        return {
            close: function () {
                if (notification)
                    if (notification.close) notification.close();
                    else if (notification.cancel) notification.cancel();
                else if (w.external && w.external.msIsSiteMode())
                    if (notification.ieVerification === ieVerification) w.external.msSiteModeClearIconOverlay()
            }
        }
    }
}
var mckGroupUtils = new MckGroupUtils;
var mckGroupService = new MckGroupService;

function MckGroupUtils() {
    var _this = this;
    _this.getGroup = function (groupId) {
        if (typeof MCK_GROUP_MAP[groupId] === "object") return MCK_GROUP_MAP[groupId];
        else return
    };
    _this.getGroupByClientGroupId = function (clientGroupId) {
        if (typeof MCK_CLIENT_GROUP_MAP[clientGroupId] === "object") return MCK_CLIENT_GROUP_MAP[clientGroupId];
        else return
    };
    _this.addGroup = function (group) {
        var name = group.name ? group.name : group.id;
        var users = [];
        $applozic.each(group.groupUsers, function (i, user) {
            if (user.userId) users[user.userId] = user
        });
        var removedMembersId = typeof group.removedMembersId !== "undefined" ? group.removedMembersId : [];
        var groupFeed = {
            "contactId": group.id.toString(),
            "htmlId": mckContactUtils.formatContactId("" + group.id),
            "displayName": name,
            "value": group.id.toString(),
            "adminName": group.adminId ? group.adminId : group.adminName,
            "type": group.type,
            "members": group.membersId ? group.membersId : group.membersName,
            "imageUrl": group.imageUrl,
            "users": users,
            "userCount": group.userCount,
            "removedMembersId": removedMembersId,
            "clientGroupId": group.clientGroupId,
            "isGroup": true,
            "deletedAtTime": group.deletedAtTime,
            "metadata": group.metadata
        };
        MCK_GROUP_MAP[group.id] = groupFeed;
        if (group.clientGroupId) MCK_CLIENT_GROUP_MAP[group.clientGroupId] = groupFeed;
        return groupFeed
    };
    _this.createGroup = function (groupId) {
        var group = {
            "contactId": groupId.toString(),
            "htmlId": mckContactUtils.formatContactId("" + groupId),
            "displayName": groupId.toString(),
            "value": groupId.toString(),
            "type": 2,
            "adminName": "",
            "imageUrl": "",
            "userCount": "",
            "users": [],
            "removedMembersId": [],
            "clientGroupId": "",
            "isGroup": true,
            "deletedAtTime": ""
        };
        MCK_GROUP_MAP[groupId] = group;
        return group
    }
}

function MckGroupService() {
    var _this = this;
    var IS_MCK_VISITOR;
    var MCK_USER_ID;
    var MCK_OPEN_GROUP_SETTINGS;
    var MCK_LAST_SEEN_AT_MAP = [];
    var MCK_BLOCKED_TO_MAP = [];
    var GROUP_LIST_URL = "/rest/ws/group/list";
    var GROUP_FEED_URL = "/rest/ws/group/info";
    var GROUP_LEAVE_URL = "/rest/ws/group/left";
    var GROUP_UPDATE_INFO_URL = "/rest/ws/group/update";
    var GROUP_ADD_MEMBER_URL = "/rest/ws/group/add/member";
    var GROUP_REMOVE_MEMBER_URL = "/rest/ws/group/remove/member";
    MCK_GROUP_ARRAY = new Array;
    _this.init = function (optns) {
        IS_MCK_VISITOR =
            optns.visitor;
        MCK_USER_ID = IS_MCK_VISITOR ? "guest" : $applozic.trim(optns.userId);
        MCK_OPEN_GROUP_SETTINGS = optns.openGroupSettings
    };
    _this.loadGroups = function (params) {
        var response = new Object;
        window.Applozic.ALApiService.loadGroups({
            baseUrl: MCK_BASE_URL,
            success: function (data) {
                if (data.status === "success") {
                    response.status = "success";
                    response.data = data.response;
                    if (params.apzCallback) params.apzCallback(response)
                } else response.status = "error";
                if (params.callback) params.callback(response)
            },
            error: function () {
                console.log("Unable to load groups. Please reload page.");
                response.status = "error";
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response)
            }
        })
    };
    _this.getGroupFeed = function (params) {
        var group = {};
        if (typeof params.callback === "function" || typeof params.apzCallback === "function") var response = new Object;
        else return;
        if (params.groupId) group.groupId = params.groupId;
        else if (params.clientGroupId) group.clientGroupId = params.clientGroupId;
        else {
            if (typeof params.callback === "function") {
                response.status = "error";
                response.errorMessage = "GroupId or Client GroupId Required";
                params.callback(response)
            }
            return
        }
        if (params.conversationId) group.conversationId = params.conversationId;
        Applozic.ALApiService.getGroupInfo({
            data: group,
            success: function (response) {
                if (response.status === "success") {
                    var groupFeed = response.response;
                    if (groupFeed + "" === "null" || typeof groupFeed !== "object") {
                        response.status = "error";
                        response.errorMessage = "GroupId not found"
                    } else {
                        var group = mckGroupUtils.addGroup(groupFeed);
                        response.status = "success";
                        response.data = group
                    }
                } else if (data.status === "error") {
                    response.status =
                        "error";
                    response.errorMessage = data.errorResponse[0].description
                }
                if (params.callback) params.callback(response);
                if (params.apzCallback) {
                    if (response.status === "success") response.data = groupFeed;
                    params.apzCallback(response, params)
                }
            },
            error: function () {
                console.log("Unable to load group. Please reload page.");
                response.status = "error";
                response.errorMessage = "Please reload page.";
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response, params)
            }
        })
    };
    _this.leaveGroup = function (params) {
        var group = {};
        var response = new Object;
        if (params.groupId) group.groupId = params.groupId;
        else if (params.clientGroupId) group.clientGroupId = params.clientGroupId;
        else {
            response.status = "error";
            response.errorMessage = "GroupId or Client GroupId Required";
            if (params.callback) params.callback(response);
            return
        }
        Applozic.ALApiService.groupLeave({
            data: group,
            success: function (data) {
                if (data.status === "success") {
                    if (params.clientGroupId) {
                        var groupInfo = mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);
                        if (typeof groupInfo ===
                            "object") params.groupInfo = groupInfo.contactId
                    }
                    response.status = "success";
                    response.data = {
                        groupId: params.groupId
                    }
                } else {
                    response.status = "error";
                    response.errorMessage = data.errorResponse[0].description
                }
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response, {
                    groupId: params.groupId
                })
            },
            error: function () {
                console.log("Unable to process your request. Please reload page.");
                response.status = "error";
                response.errorMessage = "";
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response)
            }
        })
    };
    _this.removeGroupMemberFromChat = function (params) {
        var group = {};
        var response = new Object;
        if (params.groupId) group.groupId = params.groupId;
        else if (params.clientGroupId) group.clientGroupId = params.clientGroupId;
        else {
            response.status = "error";
            response.errorMessage = "GroupId or Client GroupId Required";
            if (typeof params.callback === "function") params.callback(response);
            return
        }
        group.userId = params.userId;
        Applozic.ALApiService.removeGroupMember({
            data: group,
            success: function (response) {
                if (response.status === "success") {
                    if (params.clientGroupId) {
                        var group =
                            mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);
                        if (typeof group === "object") params.groupId = group.contactId
                    }
                    response.status = "success"
                } else {
                    response.status = "error";
                    response.errorMessage = data.errorResponse[0].description
                }
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response, params)
            },
            error: function () {
                console.log("Unable to process your request. Please reload page.");
                response.status = "error";
                response.errorMessage = "";
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response);
                params.apzCallback(response)
            }
        })
    };
    _this.addGroupMember = function (params) {
        var group = {};
        var response = new Object;
        if (params.groupId) group.groupId = params.groupId;
        else if (params.clientGroupId) group.clientGroupId = params.clientGroupId;
        else {
            if (typeof params.callback === "function") params.callback(response);
            return
        }
        group.userId = params.userId;
        if (typeof params.role !== "undefined") group.role = params.role;
        Applozic.ALApiService.addGroupMember({
            data: {
                group: group
            },
            success: function (data) {
                if (data.status ===
                    "success") {
                    if (params.clientGroupId) {
                        var group = mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);
                        if (typeof group === "object") params.groupId = group.contactId
                    }
                    response.status = "success";
                    response.data = data.response
                } else {
                    response.status = "error";
                    response.errorMessage = data.errorResponse[0].description
                }
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response, params)
            },
            error: function () {
                console.log("Unable to process your request. Please reload page.");
                response.status =
                    "error";
                response.errorMessage = "";
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response)
            }
        })
    };
    _this.updateGroupInfo = function (params) {
        var group = {};
        var response = new Object;
        if (params.groupId) group.groupId = params.groupId;
        else if (params.clientGroupId) group.clientGroupId = params.clientGroupId;
        else {
            if (typeof params.callback === "function") {
                response.status = "error";
                response.errorMessage = "GroupId or Client GroupId Required";
                params.callback(response)
            }
            return
        }
        if (params.name) group.newName =
            params.name;
        if (params.imageUrl) group.imageUrl = params.imageUrl;
        if (params.users && params.users.length > 0) group.users = params.users;
        Applozic.ALApiService.groupUpdate({
            data: group,
            success: function (data, group) {
                if (data.status === "success") {
                    if (params.clientGroupId) {
                        var group = mckGroupLayout.getGroupByClientGroupId(params.clientGroupId);
                        if (typeof group === "object") params.groupId = group.contactId
                    }
                    response.status = "success";
                    response.data = data.response
                } else {
                    response.status = "error";
                    response.errorMessage = data.errorResponse[0].description
                }
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response, {
                    groupId: params.groupId,
                    groupInfo: group
                })
            },
            error: function () {
                console.log("Unable to process your request. Please reload page.");
                response.status = "error";
                response.errorMessage = "Unable to process your request. Please reload page.";
                if (params.callback) params.callback(response);
                if (params.apzCallback) params.apzCallback(response)
            }
        })
    };
    _this.sendGroupMessage = function (params) {
        if (typeof params === "object") {
            params = $applozic.extend(true, {}, message_default_options,
                params);
            var message = params.message;
            if (!params.groupId && !params.clientGroupId) return "groupId or clientGroupId required";
            if (typeof message === "undefined" || message === "") return "message field required";
            if (params.type > 12) return "invalid message type";
            message = $applozic.trim(message);
            var messagePxy = {
                "type": params.messageType,
                "contentType": params.type,
                "message": message
            };
            if (params.groupId) messagePxy.groupId = $applozic.trim(params.groupId);
            else if (params.clientGroupId) {
                var group = mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);
                if (typeof group === "undefined") return "group not found";
                messagePxy.clientGroupId = $applozic.trim(params.clientGroupId)
            }
            mckMessageService.sendMessage(messagePxy);
            return "success"
        } else return "Unsupported format. Please check format"
    };
    _this.getContactFromGroupOfTwo = function (group, callback) {
        var user;
        for (var i = 0; i < group.members.length; i++) {
            user = "" + group.members[i];
            if (MCK_USER_ID === user) continue;
            if (typeof callback === "function") callback(user)
        }
    };
    _this.addGroupFromMessage = function (message, update, callback) {
        var groupId =
            message.groupId;
        var group = mckGroupUtils.getGroup("" + groupId);
        if (typeof group === "undefined") {
            group = mckGroupUtils.createGroup(groupId);
            mckGroupService.loadGroups({
                apzCallback: mckGroupLayout.loadGroups
            })
        }
        if (typeof callback === "function") callback(group, message, update)
    };
    _this.isGroupDeleted = function (tabId, isGroup) {
        if (isGroup) {
            var deletedAtTime = mckGroupLayout.getDeletedAtTime(tabId);
            return typeof deletedAtTime !== "undefined" && deletedAtTime > 0
        }
        return false
    };
    _this.loadGroupsCallback = function (response) {
        var groups =
            response.data;
        MCK_GROUP_ARRAY.length = 0;
        $applozic.each(groups, function (i, group) {
            if (typeof group.id !== "undefined") {
                var group = mckGroupUtils.addGroup(group);
                MCK_GROUP_ARRAY.push(group)
            }
        })
    };
    _this.getGroupDisplayName = function (groupId) {
        if (typeof MCK_GROUP_MAP[groupId] === "object") {
            var group = MCK_GROUP_MAP[groupId];
            var displayName = group["displayName"];
            if (group.type === 7) {
                var contact = _this.getContactFromGroupOfTwo(group);
                if (typeof contact !== "undefined") displayName = mckMessageLayout.getTabDisplayName(contact.contactId,
                    false)
            }
            if (group.type === 3)
                if (displayName.indexOf(MCK_USER_ID) !== -1) {
                    displayName = displayName.replace(MCK_USER_ID, "").replace(":", "");
                    if (typeof MCK_GETUSERNAME === "function") {
                        var name = MCK_GETUSERNAME(displayName);
                        displayName = name ? name : displayName
                    }
                }
            if (!displayName && group.type === 5) displayName = "Broadcast";
            if (!displayName) displayName = group.contactId;
            return displayName
        } else return groupId
    };
    _this.getGroupImage = function (imageSrc) {
        return imageSrc ? '\x3cimg src\x3d"' + imageSrc + '"/\x3e' : '\x3cimg src\x3d"' + MCK_BASE_URL +
            '/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'
    };
    _this.getGroupDefaultIcon = function () {
        return '\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'
    };
    _this.addMemberToGroup = function (group, userId) {
        if (typeof group.members === "object") {
            if (group.members.indexOf(userId) === -1) group.members.push(userId);
            if (typeof group.removedMembersId === "object" && group.removedMembersId.indexOf(userId) !== -1) group.removedMembersId.splice(group.removedMembersId.indexOf(userId), 1);
            MCK_GROUP_MAP[group.contactId] =
                group
        }
        return group
    };
    _this.removeMemberFromGroup = function (group, userId) {
        if (typeof group.removedMembersId !== "object" || group.removedMembersId.length < 1) {
            group.removedMembersId = [];
            group.removedMembersId.push(userId)
        } else if (group.removedMembersId.indexOf(userId) === -1) group.removedMembersId.push(userId);
        MCK_GROUP_MAP[group.contactId] = group;
        return group
    };
    _this.authenticateGroupUser = function (group) {
        var isGroupLeft = mckGroupService.isGroupLeft(group);
        var isGroupMemeber = false;
        if (!isGroupLeft && group.members.length >
            0)
            for (var i = 0; i < group.members.length; i++)
                if (MCK_USER_ID === "" + group.members[i]) {
                    isGroupMemeber = true;
                    return true
                }
        return isGroupMemeber
    };
    _this.isAppendOpenGroupContextMenu = function (group) {
        if (MCK_OPEN_GROUP_SETTINGS.deleteChatAccess === 0) return false;
        var isGroupMember = mckGroupService.authenticateGroupUser(group);
        if (!isGroupMember) return false;
        if (group.adminName === MCK_USER_ID) return true;
        if (MCK_OPEN_GROUP_SETTINGS.deleteChatAccess === 2) return true;
        return false
    };
    _this.isGroupLeft = function (group) {
        var isGroupLeft =
            false;
        if (group.removedMembersId && group.removedMembersId.length > 0) $applozic.each(group.removedMembersId, function (i, removedMemberId) {
            if (removedMemberId === MCK_USER_ID) isGroupLeft = true
        });
        return isGroupLeft
    }
}
var alUserService = new AlUserService;

function AlUserService() {
    var _this = this;
    _this.MCK_USER_DETAIL_MAP = [];
    _this.MCK_BLOCKED_TO_MAP = [];
    var MCK_GROUP_MEMBER_SEARCH_ARRAY = new Array;
    var USER_BLOCK_URL = "/rest/ws/user/block";
    var USER_DETAIL_URL = "/rest/ws/user/v2/detail";
    var USER_STATUS_URL = "/rest/ws/user/chat/status";
    _this.updateUserStatus = function (params, callback) {
        if (typeof alUserService.MCK_USER_DETAIL_MAP[params.userId] === "object") {
            var userDetail = alUserService.MCK_USER_DETAIL_MAP[params.userId];
            if (params.status === 0) {
                userDetail.connected =
                    false;
                userDetail.lastSeenAtTime = params.lastSeenAtTime
            } else if (params.status === 1) userDetail.connected = true
        } else {
            var userIdArray = new Array;
            userIdArray.push(params.userId);
            if (typeof callback === "function") callback(userIdArray)
        }
    };
    _this.getUserDetail = function (userId) {
        if (typeof alUserService.MCK_USER_DETAIL_MAP[userId] === "object") return alUserService.MCK_USER_DETAIL_MAP[userId];
        else return
    };
    _this.checkUserConnectedStatus = function (callback) {
        var userIdArray = new Array;
        var otherUserIdArray = new Array;
        $applozic(".mck-user-ol-status").each(function () {
            var tabId =
                $applozic(this).data("mck-id");
            if (typeof tabId !== "undefined" && tabId !== "") {
                userIdArray.push(tabId);
                var htmlId = mckContactUtils.formatContactId("" + tabId);
                $applozic(this).addClass(htmlId);
                $applozic(this).next().addClass(htmlId)
            }
        });
        if (userIdArray.length > 0) {
            $applozic.each(userIdArray, function (i, userId) {
                if (typeof alUserService.MCK_USER_DETAIL_MAP[userId] === "undefined") otherUserIdArray.push(userId)
            });
            if (typeof callback === "function") callback(otherUserIdArray)
        }
    };
    _this.loadUserProfile = function (userId) {
        if (typeof userId !==
            "undefined") {
            var userIdArray = [];
            var memberId = "" + userId.split(",")[0];
            userIdArray.push(memberId);
            _this.loadUserProfiles(userIdArray)
        }
    };
    _this.loadUserProfiles = function (userIds, callback) {
        var userIdArray = [];
        if (typeof callback === "function") callback(userIds, userIdArray)
    };
    _this.getUserStatus = function (params, callback) {
        var response = new Object;
        window.Applozic.ALApiService.getUserStatus({
            success: function (data) {
                if (data.users.length > 0) {
                    MCK_GROUP_MEMBER_SEARCH_ARRAY = [];
                    if (typeof callback === "function") callback(data)
                }
                response.status =
                    "success";
                response.data = data;
                if (params.callback) params.callback(response);
                return
            },
            error: function () {
                response.status = "error";
                if (params.callback) params.callback(response)
            }
        })
    };
    _this.blockUser = function (userId, isBlock, callback) {
        if (!userId || typeof isBlock === "undefined") return;
        var data = "userId\x3d" + userId + "\x26block\x3d" + isBlock;
        mckUtils.ajax({
            url: MCK_BASE_URL + USER_BLOCK_URL,
            type: "get",
            data: data,
            success: function (data) {
                if (typeof data === "object")
                    if (data.status === "success") {
                        alUserService.MCK_BLOCKED_TO_MAP[userId] =
                            isBlock;
                        if (typeof callback === "function") callback(userId)
                    }
            },
            error: function () {}
        })
    }
}
var alFileService = new AlFileService;

function AlFileService() {
    var _this = this;
    var ONE_KB = 1024;
    var ONE_MB = 1048576;
    var UPLOAD_VIA = ["CREATE", "UPDATE"];
    var FILE_PREVIEW_URL = "/rest/ws/aws/file/";
    var FILE_UPLOAD_URL = "/rest/ws/aws/file/url";
    var FILE_AWS_UPLOAD_URL = "/rest/ws/upload/file";
    var FILE_DELETE_URL = "/rest/ws/aws/file/delete";
    var CLOUD_HOST_URL = "www.googleapis.com";
    var MCK_STORAGE_URL;
    var MCK_FILE_URL;
    var MCK_MAP_STATIC_API_KEY;
    var MCK_CUSTOM_UPLOAD_SETTINGS;
    var MCK_APP_ID;
    var AUTH_CODE;
    var USER_DEVICE_KEY;
    var MCK_ACCESS_TOKEN;
    var MCK_APP_MODULE_NAME;
    var MCK_GENERATE_CLOUD_FILE_URL;
    _this.init = function (optns) {
        MCK_FILE_URL = optns.fileBaseUrl;
        AUTH_CODE = btoa(optns.userId + ":" + optns.deviceKey);
        USER_DEVICE_KEY = optns.deviceKey
    };
    _this.get = function (optns) {
        MCK_APP_ID = optns.appId;
        MCK_STORAGE_URL = optns.customUploadUrl;
        MCK_CUSTOM_UPLOAD_SETTINGS = optns.fileupload;
        MCK_MAP_STATIC_API_KEY = optns.mapStaticAPIkey;
        MCK_ACCESS_TOKEN = optns.accessToken;
        MCK_APP_MODULE_NAME = optns.appModuleName;
        MCK_GENERATE_CLOUD_FILE_URL = optns.genereateCloudFileUrl
    };
    _this.deleteFileMeta =
        function (blobKey) {
            window.Applozic.ALApiService.deleteFileMeta({
                data: {
                    blobKey: blobKey,
                    url: MCK_FILE_URL + FILE_DELETE_URL + "?key\x3d" + blobKey
                },
                success: function (response) {
                    console.log(response)
                },
                error: function () {}
            })
        };
    _this.getFilePreviewPath = function (fileMeta) {
        return typeof fileMeta === "object" ? '\x3ca href\x3d"' + MCK_FILE_URL + FILE_PREVIEW_URL + fileMeta.blobKey + '" target\x3d"_blank"\x3e' + fileMeta.name + "\x3c/a\x3e" : ""
    };
    _this.getFilePreviewSize = function (fileSize) {
        if (fileSize)
            if (fileSize > ONE_MB) return "(" + parseInt(fileSize /
                ONE_MB) + " MB)";
            else if (fileSize > ONE_KB) return "(" + parseInt(fileSize / ONE_KB) + " KB)";
        else return "(" + parseInt(fileSize) + " B)";
        return ""
    };
    _this.getFileurl = function (msg) {
        if (typeof msg.fileMeta === "object")
            if (msg.fileMeta.hasOwnProperty("url"))
                if (msg.fileMeta.url.indexOf(CLOUD_HOST_URL) !== -1) {
                    var fileUrl;
                    _this.generateCloudUrl(msg.fileMeta.blobKey, function (result) {
                        fileUrl = result
                    });
                    return fileUrl
                } else return "" + msg.fileMeta.url;
        else if (msg.fileMeta.thumbnailUrl === "thumbnail_" + msg.fileMeta.name) return MCK_STORAGE_URL +
            "/files/" + msg.fileMeta.name;
        else return MCK_FILE_URL + FILE_PREVIEW_URL + msg.fileMeta.blobKey;
        return ""
    };
    _this.generateCloudUrl = function (key, callback) {
        var url = MCK_GENERATE_CLOUD_FILE_URL.replace("{key}", key);
        var headers = window.Applozic.ALApiService.getAttachmentHeaders();
        mckUtils.ajax({
            type: "get",
            async: false,
            headers: headers,
            url: url,
            success: function (result) {
                if (typeof callback === "function") callback(result)
            },
            error: function (result) {
                console.log("error while getting token" + result)
            }
        })
    };
    _this.getFilePath = function (msg) {
        if (msg.contentType ===
            2) try {
            var geoLoc = $applozic.parseJSON(msg.message);
            if (geoLoc.lat && geoLoc.lon) return '\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:' + geoLoc.lat + "," + geoLoc.lon + '" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d' + geoLoc.lat + "," + geoLoc.lon + "\x26maptype\x3droadmap\x26markers\x3dcolor:red|" + geoLoc.lat + "," + geoLoc.lon + "\x26key\x3d" + MCK_MAP_STATIC_API_KEY + '"/\x3e\x3c/a\x3e'
        } catch (ex) {
            if (msg.message.indexOf(",") !==
                -1) return '\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:' + msg.message + '" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d' + msg.message + "\x26maptype\x3droadmap\x26markers\x3dcolor:red|" + msg.message + "\x26key\x3d" + MCK_MAP_STATIC_API_KEY + '" /\x3e\x3c/a\x3e'
        }
        if (typeof msg.fileMeta === "object")
            if (msg.fileMeta.contentType.indexOf("image") !== -1)
                if (msg.fileMeta.contentType.indexOf("svg") !== -1) return '\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"' +
                    msg.fileMeta.contentType + '" data-url\x3d"' + _this.getFileurl(msg) + '" data-name\x3d"' + msg.fileMeta.name + '"\x3e\x3cimg src\x3d"' + _this.getFileurl(msg) + '" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';
                else if (msg.contentType === 5) return '\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"' + msg.fileMeta.contentType + '" data-url\x3d"' + msg.fileMeta.blobKey + '" data-name\x3d"' + msg.fileMeta.name + '"\x3e\x3cimg src\x3d"' + msg.fileMeta.blobKey +
            '" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';
        else if (msg.fileMeta.hasOwnProperty("url"))
            if (msg.fileMeta.url.indexOf(CLOUD_HOST_URL) !== -1) {
                var thumbnailUrl;
                _this.generateCloudUrl(msg.fileMeta.thumbnailBlobKey, function (result) {
                    thumbnailUrl = result
                });
                return '\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"' + msg.fileMeta.contentType + '" data-url\x3d"" data-blobKey\x3d"' + msg.fileMeta.blobKey + '" data-name\x3d"' + msg.fileMeta.name +
                    '"\x3e\x3cimg src\x3d"' + thumbnailUrl + '" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e'
            } else return '\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"' + msg.fileMeta.contentType + '" data-url\x3d"' + _this.getFileurl(msg) + '" data-name\x3d"' + msg.fileMeta.name + '"\x3e\x3cimg src\x3d"' + msg.fileMeta.thumbnailUrl + '" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';
        else if (msg.fileMeta.thumbnailUrl === "thumbnail_" + msg.fileMeta.name) return '\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"' +
            msg.fileMeta.contentType + '" data-url\x3d"' + _this.getFileurl(msg) + '" data-name\x3d"' + msg.fileMeta.name + '"\x3e\x3cimg src\x3d"' + MCK_STORAGE_URL + "/files/thumbnail_" + msg.fileMeta.name + '" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';
        else return '\x3ca href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"' + msg.fileMeta.contentType + '" data-url\x3d"' + _this.getFileurl(msg) + '" data-name\x3d"' + msg.fileMeta.name + '"\x3e\x3cimg src\x3d"' + msg.fileMeta.thumbnailUrl +
            '" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e';
        else if (msg.fileMeta.contentType.indexOf("video") !== -1)
            if (msg.fileMeta.hasOwnProperty("url") && msg.fileMeta.url.indexOf(CLOUD_HOST_URL) !== -1) {
                var getUrl;
                _this.generateCloudUrl(msg.fileMeta.blobKey, function (result) {
                    getUrl = result
                });
                return '\x3ca href\x3d"#" target\x3d"_self"\x3e\x3cvideo controls class\x3d"mck-video-player" onplay\x3d"alFileService.updateAudVidUrl(this);" data-cloud-service\x3d"google_cloud" data-blobKey\x3d"' + msg.fileMeta.blobKey + '"\x3e' +
                    '\x3csource src\x3d"' + getUrl + '" type\x3d"video/mp4"\x3e' + '\x3csource src\x3d"' + getUrl + '" type\x3d"video/ogg"\x3e\x3c/video\x3e'
            } else return '\x3ca href\x3d "#" target\x3d"_self"\x3e\x3cvideo controls class\x3d"mck-video-player"\x3e' + '\x3csource src\x3d"' + _this.getFileurl(msg) + '" type\x3d"video/mp4"\x3e' + '\x3csource src\x3d"' + _this.getFileurl(msg) + '" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e';
        else if (msg.fileMeta.contentType.indexOf("audio") !== -1)
            if (msg.fileMeta.hasOwnProperty("url") && msg.fileMeta.url.indexOf(CLOUD_HOST_URL) !==
                -1) {
                var getUrl;
                _this.generateCloudUrl(msg.fileMeta.blobKey, function (result) {
                    getUrl = result
                });
                return '\x3ca href\x3d"#" target\x3d"_self"\x3e\x3caudio controls class\x3d"mck-audio-player" onplay\x3d"alFileService.updateAudVidUrl(this);" data-cloud-service\x3d"google_cloud" data-blobKey\x3d"' + msg.fileMeta.blobKey + '"\x3e' + '\x3csource src\x3d"' + getUrl + '" type\x3d"audio/ogg"\x3e' + '\x3csource src\x3d"' + getUrl + '" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e' + '\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e'
            } else return '\x3ca href\x3d"#" target\x3d"_self"\x3e\x3caudio controls class\x3d"mck-audio-player"\x3e' +
                '\x3csource src\x3d"' + _this.getFileurl(msg) + '" type\x3d"audio/ogg"\x3e' + '\x3csource src\x3d"' + _this.getFileurl(msg) + '" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e' + '\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e';
        else return '\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e';
        return ""
    };
    _this.updateAudVidUrl = function (element) {
        var keygen = element.dataset.blobkey;
        var time = (new Date).getTime();
        var currentSrc = element.currentSrc;
        var expiry = _this.fetchQueryString("Expires",
            currentSrc);
        if (time >= expiry * 1E3) {
            _this.generateCloudUrl(keygen, function (result) {
                getUrl = result
            });
            element.src = getUrl
        }
    };
    this.fetchQueryString = function (regKey, href) {
        regKey = regKey.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
        var regexValue = new RegExp("[\\?\x26]" + regKey + "\x3d([^\x26#]*)");
        var result = regexValue.exec(href);
        if (result == null) console.log("The parameter is null for the searchedquery");
        return result[1]
    };
    _this.getFileAttachment = function (msg) {
        if (typeof msg.fileMeta === "object") {
            if (msg.fileMeta.contentType.indexOf("image") !==
                -1 || msg.fileMeta.contentType.indexOf("audio") !== -1 || msg.fileMeta.contentType.indexOf("video") !== -1)
                if (msg.fileMeta.hasOwnProperty("url") && msg.fileMeta.url.indexOf(CLOUD_HOST_URL) !== -1) return '\x3ca href\x3d"javascript:void(0);" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link" data-blobKey\x3d"' + msg.fileMeta.blobKey + '" data-cloud-service\x3d"google_cloud"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-attachement-icon"\x3e<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg>\x3c/span\x3e' + msg.fileMeta.name + '\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e' + alFileService.getFilePreviewSize(msg.fileMeta.size) + "\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e";
                else return '\x3ca href\x3d"' + _this.getFileurl(msg) + '" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-attachement-icon"\x3e<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg>\x3c/span\x3e' + msg.fileMeta.name + '\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e' + alFileService.getFilePreviewSize(msg.fileMeta.size) + "\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e";
                else return '\x3ca href\x3d"' + _this.getFileurl(msg) + '" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-attachement-icon"\x3e<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg>\x3c/span\x3e' + msg.fileMeta.name + '\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e' + alFileService.getFilePreviewSize(msg.fileMeta.size) + "\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e";
            return ""
        }
    };
    _this.getFileIcon = function (msg) {
        if (msg.fileMetaKey && typeof msg.fileMeta === "object")
            if (msg.fileMeta.contentType.indexOf("image") !== -1) return '\x3cspan class\x3d"mck-icon--camera"\x3e<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2" fill="rgba(38,50,56,.52)"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg>\x3c/span\x3e\x3cspan\x3eImage\x3c/span\x3e';
            else if (msg.fileMeta.contentType.indexOf("audio") !== -1) return '\x3cspan class\x3d"mck-attachement-icon"\x3e<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg>\x3c/span\x3e\x3cspan\x3eAudio\x3c/span\x3e';
            else if (msg.fileMeta.contentType.indexOf("video") !== -1) return '\x3cspan class\x3d"mck-icon--camera"\x3e<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l2.29 2.29c.63.63 1.71.18 1.71-.71V8.91c0-.89-1.08-1.34-1.71-.71L17 10.5z"/></svg>\x3c/span\x3e\x3cspan\x3eVideo\x3c/span\x3e';
            else return '\x3cspan class\x3d"mck-attachement-icon"\x3e<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="20" height="20"><g data-name="Group 122"><path fill="none" d="M0 0h24v24H0z" data-name="Rectangle 1"/><path d="M19.00483767 16.29529691l-11.90272845-.0417193a4.358 4.358 0 0 1-4.32607928-4.32607929A4.259 4.259 0 0 1 7.0483691 7.65515915l10.48639356.03394113v.70710678L7.07241074 8.3382243a3.61826547 3.61826547 0 1 0 .00141421 7.2365308l11.89990002.03889087a2.647 2.647 0 0 0 2.68700577-2.68700576 2.688 2.688 0 0 0-2.70680476-2.70680476l-10.15476048-.0615183a1.774 1.774 0 0 0-1.75998878 1.75998879 1.8 1.8 0 0 0 1.76776695 1.76776695l8.82681395.02899138v.70710678l-8.81832866-.02333453a2.491 2.491 0 0 1-2.47840927-2.47840926 2.46 2.46 0 0 1 2.46426713-2.46426714l10.18375186.0311127a3.462 3.462 0 0 1 3.4400745 3.4400745 3.424 3.424 0 0 1-3.4202755 3.3679496z" data-name="Path 1"/></g></svg>\x3c/span\x3e\x3cspan\x3eFile\x3c/span\x3e';
        else return ""
    };
    _this.downloadfile = function () {
        var url = _this.getFileurl(msg);
        var link = document.createElement("a");
        link.download = thefilename;
        link.setAttribute("href", url);
        var uri = "data:text/csv;charset\x3dutf-8;base64," + someb64data;
        link.href = uri;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link)
    }
}
var alMessageService = new AlMessageService;

function AlMessageService() {
    var _this = this;
    var IS_MCK_VISITOR;
    var MCK_USER_ID;
    var MCK_FILE_URL;
    var TOPIC_ID_URL = "/rest/ws/conversation/topicId";
    var CONVERSATION_ID_URL = "/rest/ws/conversation/id";
    var CONVERSATION_FETCH_URL = "/rest/ws/conversation/get";
    var MESSAGE_ADD_INBOX_URL = "/rest/ws/message/add/inbox";
    var CONVERSATION_CLOSE_UPDATE_URL = "/rest/ws/conversation/close";
    var CONVERSATION_DELETE_URL = "/rest/ws/message/delete/conversation";
    var CONVERSATION_READ_UPDATE_URL = "/rest/ws/message/read/conversation";
    var offlineblk = '\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';
    var refreshIntervalId;
    _this.init = function (optns) {
        MCK_FILE_URL = optns.fileBaseUrl;
        IS_MCK_VISITOR = optns.visitor;
        MCK_USER_ID = IS_MCK_VISITOR ? "guest" : $applozic.trim(optns.userId)
    };
    _this.addMessageToTab = function (messagePxy, contact, callback) {
        var message = {
            "to": messagePxy.to,
            "groupId": messagePxy.groupId,
            "deviceKey": messagePxy.deviceKey,
            "contentType": messagePxy.contentType,
            "message": messagePxy.message,
            "conversationId": messagePxy.conversationId,
            "topicId": messagePxy.topicId,
            "sendToDevice": true,
            "createdAtTime": (new Date).getTime(),
            "key": messagePxy.key,
            "storeOnDevice": true,
            "sent": false,
            "read": true,
            "metadata": messagePxy.metadata ? messagePxy.metadata : ""
        };
        message.type = messagePxy.type ? messagePxy.type : 5;
        if (messagePxy.fileMeta) message.fileMeta = messagePxy.fileMeta;
        if (typeof callback ===
            "function") callback(message, contact)
    };
    _this.getMessages = function (params) {
        var data = {};
        if (params.startTime) data.endTime = params.startTime;
        if (typeof params.userId !== "undefined" && params.userId !== "") {
            if (params.isGroup) data.groupId = params.userId;
            else data.userId = params.userId;
            data.pageSize = 30;
            if ((IS_MCK_TOPIC_HEADER || IS_MCK_TOPIC_BOX) && params.conversationId) {
                data.conversationId = params.conversationId;
                if (typeof MCK_TAB_CONVERSATION_MAP[params.userId] === "undefined") data.conversationReq = true
            }
        } else data.mainPageSize =
            100;
        window.Applozic.ALApiService.getMessages({
            data: data,
            success: params.callback,
            error: params.callback
        })
    };
    _this.getMessageList = function (params, callback) {
        var tabId = params.id;
        var data = {};
        var resp = {};
        if (params.startTime) data.endTime = params.startTime;
        if (typeof params.clientGroupId !== "undefined" && params.clientGroupId !== "") {
            if (params.pageSize) data.pageSize = params.pageSize;
            else data.pageSize = 50;
            data.clientGroupId = params.clientGroupId;
            resp = {
                "clientGroupId": params.clientGroupId
            }
        } else if (typeof tabId !== "undefined" &&
            tabId !== "") {
            if (params.pageSize) data.pageSize = params.pageSize;
            else data.pageSize = 50;
            if ("" + params.isGroup === "true") data.groupId = tabId;
            else data.userId = tabId;
            resp = {
                "id": tabId
            }
        } else {
            if (params.mainPageSize) data.mainPageSize = params.pageSize;
            else data.mainPageSize = 50;
            resp = {
                "id": ""
            }
        }
        if (params.topicId && (tabId || params.clientGroupId)) {
            if (params.conversationId) data.conversationId = params.conversationId;
            if (params.topicId) resp["topicId"] = params.topicId
        }
        window.Applozic.ALApiService.getMessages({
            data: data,
            success: function (response) {
                var data =
                    response.data;
                resp.status = "success";
                if (typeof data.message === "undefined" || data.message.length === 0) resp.messages = [];
                else {
                    var messages = data.message;
                    var messageFeeds = new Array;
                    $applozic.each(messages, function (i, message) {
                        if (typeof callback === "function") callback(message)
                    });
                    resp.messages = messageFeeds
                }
                if (data.groupFeeds.length > 0) resp.id = data.groupFeeds[0].id;
                params.callback(data)
            },
            error: function (error) {
                resp.status = "error";
                params.callback(resp)
            }
        })
    };
    _this.getReplyMessageByKey = function (msgkey) {
        var replyMsg =
            ALStorage.getMessageByKey(msgkey);
        if (typeof replyMsg === "undefined") window.Applozic.ALApiService.updateReplyMessage({
            data: {
                key: msgkey
            },
            async: false,
            success: function (data) {
                ALStorage.updateMckMessageArray(data)
            }
        });
        return ALStorage.getMessageByKey(msgkey)
    };
    _this.sendDeliveryUpdate = function (message) {
        window.Applozic.ALApiService.sendDeliveryUpdate({
            data: {
                key: message.pairedMessageKey
            },
            success: function () {},
            error: function () {}
        })
    };
    _this.sendReadUpdate = function (key) {
        if (typeof key !== "undefined" && key !== "") window.Applozic.ALApiService.sendReadUpdate({
            data: {
                key: key
            },
            success: function () {},
            error: function () {}
        })
    };
    _this.fetchConversationByTopicId = function (data, callback) {
        window.Applozic.ALApiService.fetchConversationByTopicId({
            data: data,
            success: function (data) {
                if (typeof data === "object" && data.status === "success") {
                    var conversationList = data.response;
                    if (conversationList.length > 0) $applozic.each(conversationList, function (i, conversationPxy) {
                        MCK_CONVERSATION_MAP[conversationPxy.id] = conversationPxy;
                        MCK_TOPIC_CONVERSATION_MAP[conversationPxy.topicId] = [conversationPxy.id];
                        if (conversationPxy.topicDetail) try {
                            MCK_TOPIC_DETAIL_MAP[conversationPxy.topicId] =
                                $applozic.parseJSON(conversationPxy.topicDetail)
                        } catch (ex) {
                            w.console.log("Incorect Topic Detail!")
                        }
                        if (params.tabId && typeof MCK_TAB_CONVERSATION_MAP[params.tabId] !== "undefined") {
                            var tabConvArray = MCK_TAB_CONVERSATION_MAP[params.tabId];
                            tabConvArray.push(conversationPxy);
                            MCK_TAB_CONVERSATION_MAP[params.tabId] = tabConvArray
                        }
                    });
                    if (params.isExtMessageList)
                        if (conversationList.length > 0) {
                            params.conversationId = conversationList[0].id;
                            params.pageSize = 50;
                            if (typeof callback === "function") callback(params)
                        } else if (typeof params.callback ===
                        "function") {
                        var resp = {};
                        if (params.tabId) {
                            resp.id = params.tabId;
                            resp.isGroup = params.isGroup
                        } else if (params.clientGroupId) resp.clientGroupId = params.clientGroupId;
                        resp.topicId = params.topicId;
                        resp.status = "success";
                        resp.messages = [];
                        params.callback(resp)
                    }
                } else if (params.isExtMessageList && typeof params.callback === "function") {
                    var resp = {};
                    if (params.tabId) resp.id = params.tabId;
                    else if (params.clientGroupId) resp.clientGroupId = params.clientGroupId;
                    resp.topicId = params.topicId;
                    resp.status = "error";
                    resp.errorMessage =
                        "Unable to process request. Please try again.";
                    params.callback(resp)
                }
            },
            error: function () {
                if (typeof params.callback === "function") {
                    var resp = {};
                    if (params.tabId) resp.id = params.tabId;
                    else if (params.clientGroupId) resp.clientGroupId = params.clientGroupId;
                    resp.topicId = params.topicId;
                    resp.status = "error";
                    resp.errorMessage = "Unable to process request. Please try again.";
                    params.callback(resp)
                }
            }
        })
    };
    _this.getTopicId = function (params, callback) {
        if (params.conversationId) {
            var data = "id\x3d" + params.conversationId;
            window.Applozic.ALApiService.getTopicId({
                data: {
                    "conversationId": params.conversationId
                },
                success: function (result) {
                    if (typeof data === "object" && data.status === "success") {
                        var conversationPxy = data.response;
                        if (typeof conversationPxy === "object") {
                            MCK_TOPIC_CONVERSATION_MAP[conversationPxy.topicId] = [params.conversationId];
                            MCK_CONVERSATION_MAP[params.conversationId] = conversationPxy;
                            if (conversationPxy.topicDetail) try {
                                MCK_TOPIC_DETAIL_MAP[conversationPxy.topicId] = $applozic.parseJSON(conversationPxy.topicDetail)
                            } catch (ex) {
                                w.console.log("Incorect Topic Detail!")
                            }
                            if (typeof MCK_PRICE_DETAIL === "function" &&
                                params.priceText) {
                                MCK_PRICE_DETAIL({
                                    "custId": MCK_USER_ID,
                                    "suppId": params.suppId,
                                    "productId": conversationPxy.topicId,
                                    "price": params.priceText
                                });
                                _this.sendConversationCloseUpdate(params.conversationId)
                            }
                            if (params.messageType && typeof params.message === "object") {
                                var tabId = params.message.groupId ? params.message.groupId : params.message.to;
                                if (typeof MCK_TAB_CONVERSATION_MAP[tabId] !== "undefined") {
                                    var tabConvArray = MCK_TAB_CONVERSATION_MAP[tabId];
                                    tabConvArray.push(conversationPxy);
                                    MCK_TAB_CONVERSATION_MAP[tabId] =
                                        tabConvArray
                                }
                                if (typeof params.populate !== "undefined" ? params.populate : true)
                                    if (typeof callback === "function") callback(params)
                            }
                            if (typeof params.callback === "function") params.callback(conversationPxy)
                        }
                    }
                },
                error: function () {}
            })
        }
    };
    _this.sendConversationCloseUpdate = function (conversationId) {
        if (conversationId) {
            var data = "id\x3d" + conversationId;
            window.Applozic.ALApiService.sendConversationCloseUpdate({
                conversationId: conversationId,
                success: function (result) {},
                error: function () {}
            })
        }
    };
    _this.dispatchMessage = function (params) {
        if (params.messagePxy ===
            "object") {
            var messagePxy = params.messagePxy;
            if (params.topicId) {
                var topicDetail = MCK_TOPIC_DETAIL_MAP[params.topicId];
                if (typeof topicDetail === "object" && topicDetail.title !== "undefined") {
                    if (!messagePxy.message) messagePxy.message = $applozic.trim(topicDetail.title);
                    if (params.conversationId) messagePxy.conversationId = params.conversationId;
                    else if (params.topicId) {
                        var conversationPxy = {
                            "topicId": params.topicId
                        };
                        if (typeof topicDetail === "object") conversationPxy.topicDetail = w.JSON.stringify(topicDetail);
                        messagePxy.conversationPxy =
                            conversationPxy
                    }
                }
                if (!messagePxy.message && topicDetail.link) {
                    var fileMeta = {
                        "blobKey": $applozic.trim(topicDetail.link),
                        "contentType": "image/png"
                    };
                    messagePxy.fileMeta = fileMeta;
                    messagePxy.contentType = 5;
                    FILE_META = [];
                    FILE_META.push(fileMeta)
                }
            }
            if (params.isGroup) messagePxy.groupId = params.tabId;
            else messagePxy.to = params.tabId;
            mckMessageService.sendMessage(messagePxy)
        }
    };
    _this.sendVideoCallMessage = function (callId, msgType, contentType, audioOnly, toUser, callback) {
        var message = msgType == "CALL_MISSED" ? "Missed Call" :
            msgType == "CALL_REJECTED" ? "Call Rejected" : "";
        if (message == "" || message == undefined) message = "video message";
        var metadata = {
            "MSG_TYPE": msgType,
            "CALL_ID": callId,
            "CALL_AUDIO_ONLY": audioOnly
        };
        var messagePxy = {
            "to": toUser,
            "type": 5,
            "contentType": contentType,
            "message": message,
            "metadata": metadata,
            "senderName": MCK_USER_ID
        };
        callback(messagePxy);
        return messagePxy
    };
    _this.sendVideoCallEndMessage = function (callId, msgType, contentType, audioOnly, callDuration, toUser, callback) {
        var callDurationStr = "";
        if (callDuration) callDurationStr =
            mckDateUtils.convertMilisIntoTime(callDuration);
        var message = msgType == "CALL_MISSED" ? "Missed Call" : msgType == "CALL_REJECTED" ? "Call Rejected" : msgType == "CALL_END" ? "Call End \n Duration: " + callDurationStr : "video message";
        if (message == "" || message == undefined) message = "video message";
        var metadata = {
            "MSG_TYPE": msgType,
            "CALL_ID": callId,
            "CALL_AUDIO_ONLY": audioOnly,
            "CALL_DURATION": callDuration
        };
        var messagePxy = {
            "to": toUser,
            "type": 5,
            "contentType": contentType,
            "message": message,
            "metadata": metadata
        };
        callback(messagePxy);
        return messagePxy
    };
    _this.getMessageFeed = function (message) {
        var messageFeed = {};
        MCK_FILE_URL = window.Applozic.ALApiService.getFileUrl();
        messageFeed.key = message.key;
        messageFeed.timeStamp = message.createdAtTime;
        messageFeed.message = message.message;
        messageFeed.from = message.type === 4 ? message.to : MCK_USER_ID;
        if (message.groupId) messageFeed.to = message.groupId;
        else messageFeed.to = message.type === 5 ? message.to : MCK_USER_ID;
        messageFeed.status = "read";
        messageFeed.type = message.type === 4 ? "inbox" : "outbox";
        if (message.type ===
            5)
            if (message.status === 3) messageFeed.status = "sent";
            else if (message.status === 4) messageFeed.status = "delivered";
        if (typeof message.fileMeta === "object") {
            var file = Object.assign({}, message.fileMeta);
            if (typeof file.url === "undefined" || file.url === "") file.url = MCK_FILE_URL + "/rest/ws/aws/file/" + message.fileMeta.blobKey;
            delete file.blobKey;
            messageFeed.file = file
        }
        messageFeed.source = message.source;
        messageFeed.metadata = message.metadata;
        return messageFeed
    }
};
!function(e){"undefined"==typeof KMCommonUtils?e.KMCommonUtils={ajax:function(e){var t,a=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}({},{},e),s=new XMLHttpRequest,o=!0;(void 0!==a.async||e.async)&&(o=a.async),"GET"===(e=a.type.toUpperCase())&&void 0!==a.data&&(a.url=a.url+"?"+a.data),s.open(e,a.url,o),"POST"!==e&&"GET"!==e||(o=void 0===a.contentType?"application/x-www-form-urlencoded; charset=UTF-8":a.contentType,s.setRequestHeader("Content-Type",o)),void 0===a.data?s.send():s.send(a.data),s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE)if(200===s.status){var e=s.getResponseHeader("Content-Type");void 0!==e&&"null"!==e&&null!==e||(e=""),t=-1!=e.toLowerCase().indexOf("text/html")?s.responseXML:-1!=e.toLowerCase().indexOf("application/json")?JSON.parse(s.responseText):s.responseText,a.success(t)}else a.error(t)}}}:console.log("KMCommonUtils already defined.")}(window),function(e){"undefined"==typeof Helpdocs?e.Helpdocs={getArticles:function(e){var t="https://api.helpdocs.io/v1/article?key="+e.data.helpdocsAccessKey;e.data.query&&(t="https://api.helpdocs.io/v1/search?key="+e.data.helpdocsAccessKey+"&query="+e.data.query);var a={};KMCommonUtils.ajax({url:t,async:void 0===e.async||e.async,type:"get",success:function(t){a.status="success",a.data=t,e.success&&e.success(a)},error:function(t,s,o){a.status="error",e.error&&e.error(a)}})},getArticle:function(e){var t={};KMCommonUtils.ajax({url:"https://api.helpdocs.io/v1/article/"+e.data.articleId+"?key="+e.data.helpdocsAccessKey,async:void 0===e.async||e.async,type:"get",success:function(a){t.status="success",t.data=a,e.success&&e.success(t)},error:function(a,s,o){t.status="error",e.error&&e.error(t)}})}}:console.log("Helpdocs already defined.")}(window),function(e){var t,a;"undefined"==typeof KommunicateKB?e.KommunicateKB=(a="https://api.kommunicate.io",(t={}).init=function(e){a=e},t.getArticles=function(e){try{var a=[];t.getFaqs({data:e.data,success:function(t){for(var s=0;s<t.data.length;s++){var o=t.data[s];a.push({articleId:o.id,title:o.name,description:o.content,status:o.status,body:o.content,source:"KOMMUNICATE"})}e.data.helpdocsAccessKey?Helpdocs.getArticles({data:e.data,success:function(t){t=t.data;for(var s=0;s<t.articles.length;s++){var o=t.articles[s];!0===o.is_published&&a.push({articleId:o.article_id,title:o.title,description:o.description,body:o.description,url:o.url,source:"HELPDOCS"})}e.success&&((t={status:"success"}).data=a,e.success(t))},error:function(t){a.length&&e.success?((t={status:"success"}).data=a,e.success(t)):e.error&&e.error(t)}}):e.success&&((t={status:"success"}).data=a,e.success(t))},error:function(t){"function"==typeof e.error&&e.error(t)}})}catch(t){e.error(t)}},t.getArticle=function(e){"HELPDOCS"==e.data.source?Helpdocs.getArticle({data:e.data,success:function(t){if(t={articleId:(t=t.data.article).article_id,title:t.title,description:t.description,body:t.body,url:t.url,source:"HELPDOCS"},e.success){var a={status:"success"};a.data=t,e.success(a)}},error:function(t){e.error(t)}}):t.getFaq({data:e.data,success:function(t){if(t={articleId:(t=t.data.data[0]).id,title:t.name,description:t.content,body:t.content,status:t.status,source:"KOMMUNICATE"},e.success){var a={status:"success"};a.data=t,e.success(a)}},error:function(t){e.error(t)}})},t.getFaqs=function(e){var t=a+"/kb/search?appId=:appId".replace(":appId",e.data.appId);e.data.query&&(t=t+"&query="+e.data.query);var s={};KMCommonUtils.ajax({url:t,async:void 0===e.async||e.async,type:"get",success:function(t){s.status="success",s.data=t.data,e.success&&e.success(s)},error:function(t,a,o){s.status="error",e.error&&e.error(s)}})},t.getFaq=function(e){var t={},s=a+"/kb/search?appId=:appId".replace(":appId",e.data.appId);e.data&&e.data.articleId&&(s+="&articleId="+e.data.articleId),KMCommonUtils.ajax({url:s,async:void 0===e.async||e.async,type:"get",success:function(a){t.status="success",t.data=a,e.success&&e.success(t)},error:function(a,s,o){t.status="error",e.error&&e.error(t)}})},t):console.log("KommunicateKB already defined.")}(window),Kommunicate="undefined"==typeof Kommunicate?{}:Kommunicate,Kommunicate.defaultLabels={"input.message":"Type your message...","conversations.title":"Conversations","start.new":"Start New Conversation","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online",offline:"Offline","clear.messages":"Clear Messages",delete:"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files & Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",hour:" hour",min:" min",yesterday:"yesterday",hours:" hours",mins:" mins","user.delete":"This user has been deleted",ago:"ago",admin:"Admin",user:"User",moderator:"Moderator",member:"Member",public:"Public",private:"Private",open:"Open",you:"You",away:"Away","closed.conversation.message":"This conversation has been marked as resolved. If you have other queries, just send a message here or start a new conversation.","search.faq":"Search in FAQs...","looking.for.something.else":"Looking for something else?","talk.to.agent":"Talk to an agent","how.to.reachout":"How may we reach you?","email.error.alert":"It seems you have entered an invalid email","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""},"lead.collection":{email:"Email",name:"Name",phone:"Contact Number",heading:"Before starting, we just need a few details so that we may serve you better",submit:"Start Conversation"}},Kommunicate.client={getGroupDetailByType:function(e,t){var a="type="+e.type+"&startIndex="+e.startIndex+"&limit="+e.limit;$applozic.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:a,contentType:"application/json",success:function(e){t(null,e)},error:function(e){t(e)}})},createConversation:function(e,t){var a=$applozic.extend(Kommunicate.getSettings("KM_CHAT_CONTEXT"),e.metadata?e.metadata.KM_CHAT_CONTEXT:{});$applozic.fn.applozic("createGroup",{groupName:e.groupName,type:e.type,admin:e.agentId,users:e.users,clientGroupId:e.clientGroupId,isMessage:e.isMessage,isInternal:e.isInternal,metadata:{CREATE_GROUP_MESSAGE:"",REMOVE_MEMBER_MESSAGE:"",ADD_MEMBER_MESSAGE:"",JOIN_MEMBER_MESSAGE:"",GROUP_NAME_CHANGE_MESSAGE:"",GROUP_ICON_CHANGE_MESSAGE:"",GROUP_LEFT_MESSAGE:"",CONVERSATION_STATUS:0,DELETED_GROUP_MESSAGE:"",GROUP_USER_ROLE_UPDATED_MESSAGE:"",GROUP_META_DATA_UPDATED_MESSAGE:"",CONVERSATION_ASSIGNEE:e.assignee||e.agentId,KM_CONVERSATION_TITLE:e.groupName,HIDE:"true",SKIP_ROUTING:e.skipRouting?e.skipRouting:"false",KM_CHAT_CONTEXT:JSON.stringify(a)},callback:function(e){console.log("response",e),"success"===e.status&&e.data.clientGroupId&&("function"==typeof t&&t(e.data.value),KommunicateUI.hideFaq(),KommunicateUI.showClosedConversationBanner(!1))}})},getThirdPartySettings:function(e,t){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/integration/settings/"+e.appId+"?type="+e.type,type:"get",contentType:"application/json",success:function(e){t(null,e)},error:function(e){t(e)}})}},Kommunicate="undefined"==typeof Kommunicate?{}:Kommunicate,Kommunicate.conversationHelper={status:{INITIAL:-1,OPEN:0,PROGRESS:1,CLOSED:2,SPAM:3,DUPLICATE:4,ARCHIVE:5,UNRESPONDED:6},isConversationClosed:function(e){if(void 0!==e)return e.metadata&&e.metadata.CONVERSATION_STATUS==Kommunicate.conversationHelper.status.CLOSED}},Kommunicate="undefined"==typeof Kommunicate?{}:Kommunicate,Kommunicate.conversation={STATUS:Kommunicate.conversationHelper.status,processConversationOpenedFromList:function(e,t){if(t)console.log("Error received. can not post process the conversation ",t);else{var a=e&&e.groupFeeds[0];Kommunicate.conversationHelper.isConversationClosed(a)&&KommunicateUI.showClosedConversationBanner()}}};var KOMMUNICATE_VERSION="v2";$applozic.extend(!0,Kommunicate,{getBaseUrl:function(){return KM_PLUGIN_SETTINGS.kommunicateApiUrl},setDefaultAgent:function(e){throw new Error("not implemented")},getConversationOfParticipent:function(e,t){if("function"!=typeof t)throw new Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");$applozic.ajax({url:Kommunicate.getBaseUrl()+"/conversations/participent/"+e.userId,type:"get",success:function(e){t(null,e)},error:function(e){t(e)}})},startConversation:function(e,t){(e="object"==typeof e?e:{}).agentId||e.agentIds||(e.agentId=KommunicateUtils.getDataFromKmSession("appOptions").agentId);var a=[{userId:"bot",groupRole:2}];if(e.agentIds)for(var s=0;s<e.agentIds.length;s++)a.push({userId:e.agentIds[s],groupRole:1});else a.push({userId:e.agentId,groupRole:1});if(e.botIds)for(s=0;s<e.botIds.length;s++)a.push({userId:e.botIds[s],groupRole:2});var o=e.conversationTitle||e.groupName||kommunicate._globals.conversationTitle||kommunicate._globals.groupName||kommunicate._globals.agentId,n=e.assignee||e.agentId,i={groupName:o,type:10,agentId:e.agentId,assignee:n,users:a,clientGroupId:e.clientGroupId,isMessage:e.isMessage,isInternal:e.isInternal,skipRouting:e.skipRouting,metadata:"object"==typeof e.metadata&&typeof e.metadata.KM_CHAT_CONTEXT==object?e.metadata.KM_CHAT_CONTEXT:{}};Kommunicate.client.createConversation(i,t)},openConversationList:function(){window.$applozic.fn.applozic("loadTab",""),KommunicateUI.showChat(),KommunicateUI.hideFaq()},openConversation:function(e){window.$applozic.fn.applozic("loadGroupTab",e),KommunicateUI.hideFaq()},openDirectConversation:function(e){window.$applozic.fn.applozic("loadTab",e),KommunicateUI.showChat(),KommunicateUI.hideFaq()},loadConversation:function(e,t){var a=(e.agentIds||[]).sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0});console.log("agent list ",a);var s=e.botIds||[];if(a.length<1){var o={code:"INVALID_PARAMETERS",message:"required parameter agentIds is missing."};return"function"==typeof t?t(o):console.log("required parameter agentIds is missing.")}var n=kommunicate._globals.userId||KommunicateUtils.getCookie(KommunicateConstants.COOKIES.KOMMUNICATE_LOGGED_IN_ID),i=a.join("_"),r=s.join("_"),c=encodeURIComponent(r?[i,n,r].join("_"):[i,n].join("_"));if(c.length>256){o={code:"MEMBER_LIMIT_EXCEEDS",message:"try adding fewer members"};return"function"==typeof t?t(o):console.log("member limit exceeds. try adding fewer members")}mckGroupService.getGroupFeed({clientGroupId:c,apzCallback:function(e){if("error"==e.status&&"AL-G-01"==e.code){var o=a.map(function(e){return{userId:e,groupRole:1}});o.push({userId:"bot",groupRole:2}),o.push(s.map(function(e){return{userId:e,groupRole:2}}));var n={groupName:kommunicate._globals.conversationTitle||kommunicate._globals.groupName||kommunicate._globals.agentId,type:10,agentId:o[0].userId,users:o,clientGroupId:decodeURIComponent(c)};Kommunicate.client.createConversation(n,function(e){if(t)return t(null,e)})}else if("success"==e.status){var i=e.data.id;return $applozic.fn.applozic("loadGroupTab",i),t(null,e)}}})},createGroupName:function(e){return e.sort().join().replace(/,/g,"_").substring(0,250)},openLastConversation:function(e){var t=e,a=[],s=[];if(s.push(e.agentId),s.push(kommunicate._globals.userId),a.push({userId:e.agentId,groupRole:1}),a.push({userId:"bot",groupRole:2}),e.botIds){console.log(e.botIds);for(var o=0;o<e.botIds.length;o++)a.push({userId:e.botIds[o],groupRole:2}),s.push(e.botIds[o])}var n=Kommunicate.createGroupName(s),i={};i.groupName=n,i.callback=function(e){e.data.groups.length>0?(console.log("already have a group"),Kommunicate.openConversation(e.data.groups[0].id)):(console.log("new user"),Kommunicate.startConversation(t,function(e){}))},window.$applozic.fn.applozic("getGroupListByFilter",i)},createNewConversation:function(e,t){if("function"!=typeof t)throw new Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");let a={groupId:e.groupId,participantUserId:e.participantUserId,createdBy:e.participantUserId,defaultAgentId:e.defaultAgentId,applicationId:e.applicationId};$applozic.ajax({url:Kommunicate.getBaseUrl()+"/conversations",type:"post",data:JSON.stringify(a),contentType:"application/json",success:function(e){console.log("conversation started successfully"),t(null,e)},error:function(e){console.log("err while starting Conversation"),t(e)}})},logout:function(){void 0!==window.$applozic&&void 0!==window.$applozic.fn&&void 0!==window.$applozic.fn.applozic&&window.$applozic.fn.applozic("logout")},launchConversation:function(){window.$applozic.fn.applozic("mckLaunchSideboxChat")},triggerEvent:function(e,t){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/events?type="+e,type:"post",data:JSON.stringify({conversationId:t.groupId,applicationId:t.applicationId}),contentType:"application/json",success:function(e){console.log("conversation triggering event")},error:function(e){console.log("err while starting Conversation")}})},updateUser:function(e){var t={data:e};window.$applozic.fn.applozic("updateUser",t)},getAwayMessage:function(e,t){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/"+e.applicationId+"/awaymessage?conversationId="+e.conversationId,type:"get",contentType:"application/json",success:function(e){"function"==typeof t&&t(null,e)},error:function(e){console.log("err while fetching away message"),"function"==typeof t&&t(e)}})},updateUserIdentity:function(e){window.$applozic.fn.applozic("updateUserIdentity",{newUserId:e,callback:function(t){KommunicateUtils.setCookie({name:KommunicateConstants.COOKIES.KOMMUNICATE_LOGGED_IN_ID,value:e,expiresInDays:30}),"success"==t&&window.$applozic.fn.applozic("reInitialize",{userId:e})}})},isRichTextMessage:function(e){return e&&300==e.contentType},appendEmailToIframe:function(e){if((Kommunicate.isRichTextMessage(e.metadata)||3==e.contentType)&&7===e.source){var t="km-iframe-"+e.groupId,a=document.getElementById(t),s=a.contentDocument||a.contentWindow.document;s.open(),s.write(e.message),s.close();for(var o=s.getElementsByTagName("a"),n=0;n<o.length;n++)o[n].setAttribute("target","_blank")}},isAttachment:function(e){return"object"==typeof e.fileMeta&&e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.ATTACHMENT||e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.LOCATION},getContainerTypeForRichMessage:function(e){var t=e.metadata,a="km-slick-container ";if(t.templateId==KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.CARD_CAROUSEL&&t.payload&&t.payload.length>1&&(a+="km-slider-multiple-cards-container"),t.templateId)switch(t.templateId){case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.HOTEL_BOOKING_CARD:case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.ROOM_DETAIL:case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.CARD_CAROUSEL:return a;case"6":return"km-border-less-container";default:return"km-fixed-container"}else if(e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.TEXT_HTML&&e.source==KommunicateConstants.MESSAGE_SOURCE.MAIL_INTERCEPTOR)return"km-fixed-container"},processPaymentRequest:function(e){},sendMessage:function(e){var t=$applozic("#mck-message-cell .mck-message-inner"),a=$applozic("#mck-msg-to");!0===t.data("isgroup")?e.groupId=a.val():e.to=a.val(),$applozic.fn.applozic("sendGroupMessage",e)},getRichTextMessageTemplate:function(e){var t=e.metadata;if(!t.templateId)return e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.TEXT_HTML&&e.source==KommunicateConstants.MESSAGE_SOURCE.MAIL_INTERCEPTOR?Kommunicate.markup.getHtmlMessageMarkups(e):"";switch(t.templateId){case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.ROOM_COUNT:return Kommunicate.markup.getHotelRoomPaxInfoTemplate();case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.HOTEL_BOOKING_CARD:return Kommunicate.markup.getHotelCardContainerTemplate(JSON.parse(t.hotelList||"[]"),t.sessionId);case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.LINK_BUTTON:return Kommunicate.markup.buttonContainerTemplate(t);case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.PASSENGER_DETAIL:return Kommunicate.markup.getPassangerDetail(t);case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.ROOM_DETAIL:return Kommunicate.markup.getRoomDetailsContainerTemplate(JSON.parse(t.hotelRoomDetail||"[]"),t.sessionId);case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.QUICK_REPLY:return Kommunicate.markup.quickRepliesContainerTemplate(t,KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.QUICK_REPLY);case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.LIST:return Kommunicate.markup.getListContainerMarkup(t);case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.DIALOG_BOX:return Kommunicate.markup.getDialogboxContainer(t);case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.IMAGE:return Kommunicate.markup.getImageContainer(t);case KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.CARD_CAROUSEL:return Kommunicate.markup.getCarouselMarkup(t);default:return""}},updateSettings:function(e){let t=typeof e;if("object"!=t)throw new error("update settings expects an object, found "+t);var a=KommunicateUtils.getDataFromKmSession("settings");for(var s in a=a?JSON.parse(a):{},e)a[s]=e[s];KommunicateUtils.storeDataIntoKmSession("settings",JSON.stringify(a))},getSettings:function(e){return KommunicateUtils.getSettings(e)},setDefaultIframeConfigForOpenChat:function(){var e=parent.document.getElementById("kommunicate-widget-iframe");e.style.width="390px",e.style.height="600px",e.classList.add("kommunicate-iframe-enable-media-query")},customizeWidgetCss:function(e){var t=document.createElement("style");t.type="text/css",t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)}}),Kommunicate.markup={getSingleRoomPaxInfo:function(e){return'<div class = "km-single-pax-info">\n    <div class="km-room-title-text">ROOM '+(e=e||"1")+'</div>\n    <div class="km-room-selector">\n        <div>Guest :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>\n        <div id= "">\n            <input class ="km-decrement-guest-count" type="button" value="-" data-type="guest">\n            <input type="number" min="1" max="5" value="1" class="km-room-number-field" maxlength="1" disabled>\n            <input class ="km-increment-guest-count" type="button" value="+" data-type="guest">\n        </div>\n    </div>\n    <div class="km-person-selector n-vis">\n        <div class="km-children-text-lable">Children :<span>(1-12 yrs)</span></div>\n        <div>\n            <input class ="km-decrement-guest-count" type="button" value="-" data-type="children">\n            <input type="number" min="0" max="2" value="0" class="km-person-number-field" maxlength="1" disabled >\n            <input class ="km-increment-guest-count" type="button" value="+" data-type="children">\n        </div> \n    </div>\n</div>'},getHotelCardTemplate:function(e,t){var a={star1:"km-star-empty",star2:"km-star-empty",star3:"km-star-empty",star4:"km-star-empty",star5:"km-star-empty"};if(e.StarRating)for(var s=0;s<e.StarRating;s++)a["star"+(s+1)]="km-star-filled";var o=("INR"==e.Price.CurrencyCode?"&#x20B9;":e.Price.CurrencyCode)+" "+Math.ceil(1*e.Price.OfferedPrice);return'\n    <div class="km-single-card-message">\n        <div class="km-card-message-header">\n            <div class="km-card-message-image-continer"><img class ="km-card-message-img" src ='+e.HotelPicture+' />\n                    <div class="km-card-message-image-price-container">'+o+'</div>\n            </div>\n        </div>\n        <div class="km-card-message-body">\n            <h1 class="km-card-message-body-title">'+e.HotelName+'</h1>\n            <div class="km-card-message-body-ratings">\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star1+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star2+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star3+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star4+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star5+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n            </div>\n            <div class="km-card-message-body-address">\n                <span class="km-card-message-body-address-icon">\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24">\n                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                    </svg>\n                </span>'+e.HotelAddress+'\n            </div>\n        </div>\n        <div class="km-card-message-footer">\n            <button class="km-card-message-footer-button" data-resultindex= '+e.ResultIndex+" data-sessionid= "+t+" data-name= "+e.HotelName.replace(" ","_")+" > Get Room Details</button>\n        </div>\n    </div>"},getRoomDetailTemplate:function(e,t){let a="undefined"==e.NoOfGuest?1:e.NoOfGuest,s=e.DayRates.Amount?e.DayRates.Amount:e.Price.RoomPrice;return'<div class="km-single-card-message">\n                <div class="message received km-blocked-room">\n                    <div class="km-blocked-room-details">\n                    <div class="km-card-message-image-continer"><img class ="km-card-message-img" src='+e.HotelPicture+" alt="+e.HotelName+'></div>\n                        <div class="km-blocked-room-text-container">\n                            <div class="km-blocked-room-room-type">\n                                <span>Room Type: </span> <span> '+e.RoomTypeName+'</span>\n                            </div>\n                            <div class="km-blocked-room-guests">\n                                <span>Guests:</span><span>'+a+' </span>\n                            </div>\n                            <div class="km-blocked-room-price">\n                                <p>Price:<br><span>(Per Room Per Night)</span></p>\n\n                                <span>'+("INR"==e.Price.CurrencyCode?"&#x20B9;":e.Price.CurrencyCode)+" "+Math.ceil(s)+'</span>\n\n                            </div>\n                            <div class="km-blocked-room-sub-total">\n                                <p>Total:<br><span>(1 Room for '+e.NoOfNights+" Nights)</span></p>\n                                <span> "+("INR"==e.Price.CurrencyCode?"&#x20B9;":e.Price.CurrencyCode)+" "+Math.ceil(e.Price.RoomPrice)+' </span>\n                            </div>\n                        </div>\n                        <div class="km-blocked-room-button-container">\n                            <button class="km-block-room-button" data-sessionId= '+t+" data-roomIndex="+e.RoomIndex+" data-NoOfRooms="+e.NoOfRooms+" data-NoOfNights="+e.NoOfNights+" data-HotelName= "+e.HotelName.replace(" ","_")+" data-HotelResultIndex= "+e.HotelResultIndex+" >Book</button>\n                        </div>\n                    </div>\n                </div>\n            </div>"},getButtonTemplate:function(e,t,a){return"link"==e.type?'<button title= "'+e.replyText+'" class= "km-cta-button km-link-button km-custom-widget-text-color km-undecorated-link '+a+'  " data-url="'+e.url+'" data-target="'+Kommunicate.markup.getLinkTarget(e)+'" ">'+e.name+"</button>":'<button title= "'+e.replyText+'" data-buttontype="submit" data-requesttype= "'+t+'" class="km-cta-button km-custom-widget-text-color  '+a+' ">'+e.name+"</button>"},getQuickRepliesTemplate:function(){return'<div class="km-cta-multi-button-container">\n            {{#payload}}\n                 <button title=\'{{message}}\' class="km-quick-replies km-custom-widget-text-color {{buttonClass}} " data-metadata = "{{replyMetadata}}">{{title}}</button>\n            {{/payload}}\n            </div>'},getPassangerDetail:function(e){return e.sessionId||console.log("sessionId not present in message.."),'  <div class="km-guest-details-container km-rich-text-default-container">\n                <div class="km-guest-detail-form">\n                    <div class= "km-select-title">    \n                        <select name="title" class="km-title-select">\n                            <option value="0" disabled selected>Title *</option>\n                            <option value="Mr.">Mr.</option>\n                            <option value="Ms.">Ms.</option>\n                            <option value="Mrs.">Mrs.</option>\n                        </select>\n                    </div>\n                    <input type="number" name="age"  class="km-input km-age-input n-vis" placeholder="Age *" min="0" max="150">\n                    <input type="text" name="first-name"  class="km-input first-name-input km-pxinfo-btn-left" placeholder="First Name *"  required>\n                    <input type="text" name="middle-name"  class="km-input middle-name-input n-vis" placeholder="Middle Name (optional) ">\n                    <input type="text" name="last-name"  class="km-input last-name-input km-pxinfo-btn-left" placeholder="Last Name *"  required>\n                    <input type="email" name="email"  class="km-input e-mail-input km-pxinfo-btn-left" placeholder="Email Id *" required>\n                    <input type="text" name="contact-no"  class="km-input number-input km-pxinfo-btn-left" placeholder="Contact Number *" required >\n                    <div class= "km-mandatory-field-error n-vis"><span> All fields are mandatory.</span></div>\n                </div>\n                <div class="km-guest-button-container">\n                    <button class="km-add-more-rooms km-submit-person-detail" data-sessionid= '+e.sessionId+">Submit</button>\n                </div>\n            </div>\n            "},getListMarkup:function(){return'<div class="km-message km-received km-chat-faq-list km-list-container" style="">\n     <div class="km-faq-list--container"  >\n             <div class="km-faq-list--header">\n                     {{{headerImgSrc}}}\n                     <div class="km-faq-list--header_text-container">\n                                     {{{headerText}}}\n                         </div>\n         </div>\n         <div class="km-faq-list--body">\n             <div class="km-faq-list--body_list-container">\n                 <ul class="km-faq-list--body_list {{elementClass}}">\n                     {{#elements}}\n                     <li class ={{hadlerClass}} data-type="{{dataType}}" data-metadata = "{{replyMetadata}}" data-reply = "{{dataReply}}" data-articleid= "{{dataArticleId}}" data-source="{{source}}"> <a href={{href}} target="_blank" class="km-undecorated-link km-custom-widget-text-color" >\n                             <div class="km-faq-list--body_img">\n                                     {{{imgSrc}}}\n                             </div>\n                         <div class="km-faq-list--body_que-ans">\n                                 <p class="km-faq-list--body_que km-custom-widget-text-color">\n                                     {{title}}\n                                 </p>\n                                 <p class="km-faq-list--body_ans">\n                                     \n                                 \n                                 {{{description}}}\n                                 </p>\n                             </div>\n                         </a>\n                     </li>\n                     {{/elements}}\n                 \n                 </ul>\n             </div>\n         </div>\n         <div class="km-faq-list--footer">\n                 <div class="km-faq-list--footer_button-container">\n                         {{#buttons}}\n                         <button class="{{buttonClass}} km-cta-button km-custom-widget-border-color km-custom-widget-text-color km-add-more-rooms {{hadlerClass}}" data-type ="{{dataType}}" data-metadata = "{{replyMetadata}}" data-url={{href}} data-target={{target}} data-reply="{{dataReply}}">{{name}}</button>\n                         {{/buttons}}\n                     \n             </div>\n         </div>\n     </div>'},getDialogboxTemplate:function(){return'<div class="km-message km-received km-faq-answer">\n     <div class="km-faq-answer--container">\n         <div class="km-faq-answer--body">\n             <div class="km-faq-answer--body_container">\n                 <p class="km-faq-answer--body_que">{{title}}</p>\n                 <p class="km-faq-answer--body_ans"> {{{description}}} </p>\n             </div>\n         </div>\n         <div class="km-faq-answer--footer">\n             <div class="km-faq-answer--footer_button-text-container">\n                 <p>{{buttonLabel}}</p>\n                 {{#buttons}}\n                 <button class="km-faq-dialog-button km-quick-replies km-cta-button km-add-more-rooms" data-reply="{{name}}" data-metadata ="{{replyMetadata}}">{{name}}</button>\n                {{/buttons}}\n             </div>\n         </div>\n     </div>\n </div>'},getImageTemplate:function(){return'<div>\n    {{#payload}}\n    <div class="km-image-template">\n       <img class="km-template-img" src="{{url}}"></img>\n       <div class="km-template-image-caption-wrapper">\n           <p class="km-template-img-caption">{{caption}}</p>\n       </div>\n   </div>\n   {{/payload}}\n   </div>'},getCarouselTemplate:function(){return'<div class="mck-msg-box-rich-text-container km-card-message-container  km-div-slider">\n            {{#payload}}\n            <div class="km-carousel-card-template">\n            <div class="km-carousel-card-header {{carouselHeaderClass}}">{{{header}}}</div>\n            <div class="km-carousel-card-content-wrapper {{carouselInfoWrapperClass}}">{{{info}}}</div>\n            <div class="km-carousel-card-footer">{{{footer}}}</div>\n            </div>\n            {{/payload}}\n        </div>'},getButtonListTemplate:function(){return'{{#buttons}}<button class="km-carousel-card-button {{{class}}}">{{action.payload.title}}</button>{{/buttons}}'},getCardHeaderTemplate:function(){return'<img class="{{headerImageClass}}" src="{{imgSrc}}"></img>\n            <div class="{{headerOverlayTextClass}}">{{overlayText}}</div>'},getCardInfoTemplate:function(){return'<div class="km-carousel-card-title-wrapper">\n                <div class="km-carousel-card-title">{{title}}</div>\n                <div class="km-carousel-card-title-extension">{{titleExt}}</div>\n            </div>\n            <div class="km-carousel-card-sub-title">{{subtitle}}</div>\n            <div class="{{cardDescriptionClass}}"><div class="km-carousel-card-description">{{description}}</div></div>'}},Kommunicate.markup.buttonContainerTemplate=function(e){var t='<div class="km-cta-multi-button-container">',a=JSON.parse(e.payload),s=a?JSON.parse(e.formData||"{}"):"",o="km-add-more-rooms ";o+=1==a.length?"km-cta-button-1 km-custom-widget-border-color":2==a.length?"km-cta-button-2 km-custom-widget-border-color":"km-cta-button-many km-custom-widget-border-color";for(var n=e.requestType,i=0;i<a.length;i++)t+=Kommunicate.markup.getButtonTemplate(a[i],n,o);return s&&(t+=Kommunicate.markup.getFormMarkup(e)),t+="</div>"},Kommunicate.markup.getFormMarkup=function(e){var t=JSON.parse(e.payload)?JSON.parse(e.formData||"{}"):"",a="";if(t){for(var s in a+="<form method ='post'  target='_blank' class= 'km-btn-hidden-form' action ="+e.formAction+">",t)t.hasOwnProperty(s)&&(a+='<input type="hidden" name ="'+s+'" value="'+t[s]+'" />');return a+="</form>"}},Kommunicate.markup.quickRepliesContainerTemplate=function(e,t){var a=JSON.parse(e.payload);var s={[KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.QUICK_REPLY]:"km-quick-rpy-btn km-custom-widget-border-color ",[KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.CARD_CAROUSEL]:"km-carousel-card-button km-carousel-card-quick-rpy-button "}[t];t==KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.QUICK_REPLY&&(s+=1==a.length?"km-cta-button-1":2==a.length?"km-cta-button-2":"km-cta-button-many");for(var o=0;o<a.length;o++)a[o].replyMetadata="object"==typeof a[o].replyMetadata?JSON.stringify(a[o].replyMetadata):a[o].replyMetadata,a[o].buttonClass=s;return Mustache.to_html(Kommunicate.markup.getQuickRepliesTemplate(),{payload:a})},Kommunicate.markup.getHotelRoomPaxInfoTemplate=function(e){return'<div class = "km-rich-text-default-container">\n            <div class="km-room-person-selector-container">'+Kommunicate.markup.getSingleRoomPaxInfo(e)+'</div>\n            <hr>\n            <div class="km-add-room-button-container">\n                <button  class="km-add-more-rooms km-btn-add-more-rooms" data-roomcount=1>ADD ROOM</button>\n                <button class=" km-add-more-rooms km-done-button">DONE</button>\n            </div>\n        </div>'},Kommunicate.markup.getHotelCardContainerTemplate=function(e,t){for(var a="",s=0;s<e.length;s++)a+=Kommunicate.markup.getHotelCardTemplate(e[s],t);return'<div class="km-card-message-container  km-div-slider">'+a+"</div>"},Kommunicate.markup.getRoomDetailsContainerTemplate=function(e,t){let a=e.HotelRoomsDetails;for(var s="",o=0;o<a.length;o++)s+=Kommunicate.markup.getRoomDetailTemplate(a[o],t);return'<div class="km-card-room-detail-container  km-div-slider">'+s+"</div>"},Kommunicate.markup.getListContainerMarkup=function(e){const t={link:"km-link-button",submit:""};if(e&&e.payload){var a=JSON.parse(e.payload);return a.headerImgSrc&&(a.headerImgSrc='<div class="km-faq-list--header_text-img"><img src= "'+a.headerImgSrc+'"  alt = "image" /></div>'),a.headerText&&(a.headerText='<p class="km-faq-list--header_text">'+a.headerText+"</p>"),a.elements&&a.elements.length?(a.elementClass="vis",a.elements=a.elements.map(function(e){return e.imgSrc&&(e.imgSrc='<img src ="'+e.imgSrc+'" />'),e.action&&e.action.replyMetadata&&(e.replyMetadata="object"==typeof e.action.replyMetadata?JSON.stringify(e.action.replyMetadata):e.action.replyMetadata),e.action&&"link"==e.action.type?e.href=e.action.url:(e.href="javascript:void(0)",e.hadlerClass="km-list-item-handler"),e.action&&(e.dataType=e.action.type||"",e.dataReply=e.action.text||e.title||""),e.dataArticleId=e.articleId||"",e.dataSource=e.source||"",e})):a.elementClass="n-vis",a.buttons&&a.buttons.length&&(a.buttons=a.buttons.map(function(e){return e.target=Kommunicate.markup.getLinkTarget(e.action),e.buttonClass=t[e.action.type],e.action&&e.action.replyMetadata&&(e.replyMetadata="object"==typeof e.action.replyMetadata?JSON.stringify(e.action.replyMetadata):e.action.replyMetadata),e.action&&"quick_reply"!=e.action.type&&"submit"!=e.action.type?e.href=e.action.url:(e.href="javascript:void(0)",e.hadlerClass="km-list-button-item-handler"),e.dataType=e.action?e.action.type:"",e.dataReply=e.action&&e.action.text?e.action.text:e.name||"",e})),Mustache.to_html(Kommunicate.markup.getListMarkup(),a)}return""},Kommunicate.markup.getDialogboxContainer=function(e){if(e&&e.payload){var t=JSON.parse(e.payload);return t.buttons.length>0&&t.buttons.forEach(function(e){e.replyMetadata="object"==typeof e.replyMetadata?JSON.stringify(e.replyMetadata):e.replyMetadata}),Mustache.to_html(Kommunicate.markup.getDialogboxTemplate(),t)}return""},Kommunicate.markup.getImageContainer=function(e){if(e&&e.payload){let t="string"==typeof e.payload?JSON.parse(e.payload):{};return e.payload=t,Mustache.to_html(Kommunicate.markup.getImageTemplate(),e)}return""},Kommunicate.markup.getHtmlMessageMarkups=function(e){return e&&e.source==KommunicateConstants.MESSAGE_SOURCE.MAIL_INTERCEPTOR?"<iframe class='km-mail-fixed-view' id="+("km-iframe-"+e.groupId)+" ></iframe>":""},Kommunicate.markup.getCarouselMarkup=function(e){var t,a,s,o,n=[],i={},r=function(e){for(var t,a="",s=0;s<e.length;s++)if("quickReply"==e[s].action.type)e[s].action.payload=JSON.stringify([e[s].action.payload]),a=a.concat(Kommunicate.markup.quickRepliesContainerTemplate(e[s].action,KommunicateConstants.ACTIONABLE_MESSAGE_TEMPLATE.CARD_CAROUSEL));else if("link"==e[s].action.type||"submit"==e[s].action.type){t=e[s].action.payload.requestType?e[s].action.payload.requestType:"",e[s].action.payload.type=e[s].action.type,e[s].action.payload.buttonClass="km-carousel-card-button",e[s].action.payload.name=e[s].name,a=a.concat(Kommunicate.markup.getButtonTemplate(e[s].action.payload,t,"km-carousel-card-button"));let o=e[s].action.payload.formData;e[s].action.payload.formAction&&(e[s].action.formAction=e[s].action.payload.formAction),e[s].action.payload=JSON.stringify([e[s].action.payload]),o&&(e[s].action.formData=JSON.stringify(o)),o&&(a=a.concat(Kommunicate.markup.getFormMarkup(e[s].action)))}return a};if(e&&e.payload){let d="string"==typeof e.payload?JSON.parse(e.payload):[];e.payload=d;for(var c=0;c<d.length;c++){var l=d[c];l.header&&(t=l.header.overlayText?l.header.imgSrc?"km-carousel-card-overlay-text ":"km-carousel-card-overlay-text  km-carousel-card-overlay-text-without-img":"n-vis"),s=l.header?l.header.imgSrc?"":"km-carousel-card-header-without-img":"n-vis",o=l.header?"":"km-carousel-card-info-wrapper-without-header",o=l.buttons?o.concat(" km-carousel-card-info-wrapper-with-buttons"):"",l.header&&(a=l.header.imgSrc?"km-carousel-card-img":"n-vis"),l.header&&(l.header.headerOverlayTextClass=t),l.header&&(l.header.headerImageClass=a),l.cardDescriptionClass=l.description?"km-carousel-card-description-wrapper":"n-vis",i.carouselHeaderClass=s,i.carouselInfoWrapperClass=o,l.header&&(i.header=Kommunicate.markup.cardHeader(l.header)),i.info=Kommunicate.markup.cardInfo(l),l.buttons&&(i.footer=r(l.buttons)),n.push(Object.assign({},i))}}let d={payload:n};return Mustache.to_html(Kommunicate.markup.getCarouselTemplate(),d)},Kommunicate.markup.cardHeader=function(e){return Mustache.to_html(Kommunicate.markup.getCardHeaderTemplate(),e)},Kommunicate.markup.cardInfo=function(e){return Mustache.to_html(Kommunicate.markup.getCardInfoTemplate(),e)},Kommunicate.markup.getLinkTarget=function(e){return e.openLinkInNewTab=!(void 0!==e.openLinkInNewTab&&!e.openLinkInNewTab)||e.openLinkInNewTab,e.openLinkInNewTab?"_blank":"_parent"},Kommunicate.messageTemplate={getAttachmentTemplate:function(){return'<div class="mck-file-text mck-attachment {{attachmentClass}} notranslate mck-attachment-{{key}}" data-groupId="{{groupId}}" data-filemetakey="{{fileMetaKey}}" data-stopupload="{{fileMeta.stopUpload}}" data-filename="{{fileMeta.name}}" data-thumbnailUrl="{{fileMeta.thumbnailUrl}}"  data-filetype="{{fileMeta.contentType}}" data-fileurl="{{fileUrl}" data-filesize="{{fileMeta.size}}+" data-msgkey ="{{key}}"><div>{{{fileExpr}}}</div><div class="{{attachmentDownloadClass}}">{{{downloadMediaUrlExpr}}}</div></div>'},getProgressMeter:function(e){return'<div class="km-progress-meter-container km-progress-meter-back-drop progress-meter-{{key}}"><svg class="km-progress-svg" xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 107 105"><g class="km-progress-icons"><circle class="km-progress-meter" cx="54" cy="54" r="45" stroke-width="10" /><circle class="km-progress-value" cx="54" cy="54" r="45" stroke-width="5" /><path class="km-progress-stop-upload-icon km-progress-stop-upload-icon-{{key}} vis" d="M51.5,47.9L32.3,28.7c-1.3-1.3-2.3-1.3-3.6,0c-1.3,1.3-0.3,3.3,1,4.6c0,0,0,0,0,0l19.1,19.1   c0.8,0.8,0.8,2.2,0,3.1L29.7,74.7c-1.3,1.3-2.4,3.4-1,4.6c1.8,1.5,2.7,0.6,3.6,0c0,0,1-1,1-1l19.1-19.1c0.8-0.8,2.6-1,3.4-0.1   l19.8,20.3c1.3,1.3,2.3,1.3,3.6,0c1.3-1.3,0.3-3.3-1-4.6L59.1,55.5c-0.8-0.8-0.8-2.2,0-3.1l19.1-19.1c1.3-1.3,2.3-3.3,1-4.6   c-1.3-1.3-3.3-0.3-4.6,1L56.4,48C55.5,48.9,52.3,48.7,51.5,47.9L51.5,47.9z" fill="#FFF" data-name="Path 1"/><path class="km-progress-upload-icon km-progress-upload-icon-{{key}} n-vis" d="M52.246 21.547L30.00689 43.78339a3.2 3.2 0 0 0-.03927 4.4858l.03047.03155a3.2 3.2 0 0 0 4.56449.03994L51.286 31.619v53.712a3.2 3.2 0 0 0 3.2 3.2 3.2 3.2 0 0 0 3.2-3.2V31.619l16.72045 16.72131a3.2 3.2 0 0 0 4.56467-.03976l.03029-.03136a3.2 3.2 0 0 0-.03927-4.4858L56.723 21.547l-.06168-.05724a3.2 3.2 0 0 0-4.3542.00048z" fill="#FFF"/></g></svg></div>'},getAttachmentContanier:function(e,t,a,s){return e.downloadMediaUrlExpr=a,e.fileExpr=t,e.fileUrl=s,"object"==typeof e.fileMeta&&(e.attachmentClass=1!=e.fileMeta.contentType.indexOf("image/")||-1!=e.fileMeta.contentType.indexOf("audio/")||1!=e.fileMeta.contentType.indexOf("video/")?"":"mck-msg-box",e.attachmentDownloadClass=-1!=e.fileMeta.contentType.indexOf("image/")?"n-vis":"vis"),Mustache.to_html(Kommunicate.messageTemplate.getAttachmentTemplate(),e)},getProgressMeterContanier:function(e){let t={key:e};return Mustache.to_html(Kommunicate.messageTemplate.getProgressMeter(),t)}},Kommunicate.initilizeEventListners=function(){w.addEventListener("online",function(){Kommunicate.internetStatus=!0}),w.addEventListener("offline",function(){Kommunicate.internetStatus=!1})},Kommunicate.attachmentService={getFileMeta:function(e,t,a){let s={groupId:t,contentType:1,type:5,message:""};var o=new FileReader;o.onload=function(e){return function(t){document.createElement("span").innerHTML=['<img class="thumb" src="',t.target.result,'" title="',escape(e.name),'"/>'].join("")}},o.onloadend=function(){FILE_META=[],FILE_META.push({thumbnailUrl:o.result,contentType:e.type,isUploaded:!1,contentType:e.type,stopUpload:!1}),"function"!=typeof a||a(FILE_META,s,e)},o.readAsDataURL(e)},uploadAttachment:function(e,t,a){data={params:e,messagePxy:t},$applozic.fn.applozic("uploadAttachemnt",data)}};var MCK_TRIGGER_MSG_NOTIFICATION_PARAM,MCK_MAINTAIN_ACTIVE_CONVERSATION_STATE,MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[],MCK_EVENT_HISTORY=[],KM_PROGRESS_METER_RADIUS=54,KM_PROGRESS_METER_CIRCUMFERENCE=2*Math.PI*KM_PROGRESS_METER_RADIUS,count=0,isFirstLaunch=!0,KM_PENDING_ATTACHMENT_FILE=new Map;!function(t,a,s){"use strict";a.applozic||(a.applozic=a.applozic?a.applozic:{},t.extend(!0,a.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var o={baseUrl:"https://chat.kommunicate.io",fileBaseUrl:"https://applozic.appspot.com",customFileUrl:"https://googleupload.applozic.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",launcher:"applozic-launcher",emojilibrary:!1,userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,unreadCountOnchatLauncher:!0,openConversationOnNewMessage:!1,groupUserCount:!1,desktopNotification:!0,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,groupName:"Conversations",agentId:"",agentName:"",msgTriggerTimeout:0,labels:Kommunicate.defaultLabels,useBranding:!0,openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},n={messageType:5,type:0};t.fn.applozic=function(i,r,c){var l=t("#mck-sidebox");"object"===t.type(i)&&(KommunicateUtils.storeDataIntoKmSession("appOptions",i),(i=t.extend(!0,{},o,i)).conversationTitle=i.conversationTitle||i.groupName,i.accessToken=i.password||i.accessToken);var d=void 0;if(void 0!==l.data("applozic_instance"))if(d=l.data("applozic_instance"),"string"===t.type(i))switch(i){case"reInitialize":return d.reInit(r);case"loadConvTab":d.loadConvTab(r);break;case"loadTab":d.loadTab(r,c);break;case"uploadFile":d.uploadFile(r);break;case"uploadAttachemnt":d.uploadAttachemnt(r);break;case"loadTabView":d.loadTabView(r);break;case"loadChat":d.loadChat(r);break;case"loadContextualTab":return d.loadTabWithTopic(r);case"audioAttach":d.audioAttach(r);break;case"addWelcomeMessage":d.addWelcomeMessage(r);break;case"loadContacts":d.loadContacts(r);break;case"sendMessage":return d.sendMessage(r);case"sendGroupMessage":return d.sendGroupMessage(r);case"createGroup":return d.createGroup(r);case"loadBroadcastTab":case"initBroadcastTab":return r.groupName=r.groupName?r.groupName:"Broadcast",r.type=5,d.initGroupTab(r);case"initGroupTab":return d.initGroupTab(r);case"loadGroupTab":return d.loadGroupTab(r,c);case"loadGroupTabByClientGroupId":return d.loadGroupTabByClientGroupId(r);case"setOffline":case"setOnline":return d.setOffline(),"success";case"logout":return d.logout(),"success";case"reset":d.reset(r);break;case"getUserDetail":return d.getUserStatus(r),"success";case"getGroupList":return d.getGroupList(r),"success";case"leaveGroup":return d.leaveGroup(r);case"addGroupMember":return d.addGroupMember(r);case"removeGroupMember":return d.removeGroupMember(r);case"updateGroupInfo":return d.updateGroupInfo(r);case"getMessages":d.getMessages(r);break;case"messageList":return d.getMessageList(r);case"getMessageListByTopicId":return d.getMessageListByTopicId(r);case"getTotalUnreadCount":return d.getTotalUnreadCount();case"subscribeToEvents":return d.subscribeToEvents(r);case"getConversation":return d.getConversation(r);case"loadConversationWithAgent":return d.loadConversationWithAgent(r);case"updateUserIdentity":return d.updateUserIdentity(r);case"updateUser":return d.updateUser(r);case"getGroupListByFilter":return d.getGroupListByFilter(r);case"updateMessageMetadata":return d.updateMessageMetadata(r);case"mckLaunchSideboxChat":return d.mckLaunchSideboxChat();case"triggerMsgNotification":return d.triggerMsgNotification();case"openChat":return d.openChat(r);case"submitMessage":return d.submitMessage(r)}else"object"===t.type(i)&&d.reInit(i);else if("object"===t.type(i))if(i.userId&&i.appId&&""!==t.trim(i.userId)&&""!==t.trim(i.appId))if(void 0!==l.data("applozic_instance"))(d=l.data("applozic_instance")).reInit(i);else{if(void 0!==i.ojq?($=i.ojq,jQuery=i.ojq):($=t,jQuery=t),"function"==typeof i.obsm)$.fn.modal=i.obsm,jQuery.fn.modal=i.obsm;else if("function"==typeof t.fn.modal){var m=t.fn.modal.noConflict();$.fn.modal=m,jQuery.fn.modal=m}else if("function"==typeof $.fn.modal){m=$.fn.modal.noConflict();$.fn.modal=m,jQuery.fn.modal=m}"function"==typeof i.omckm?t.fn.mckModal=i.omckm:"function"==typeof t.fn.mckModal?t.fn.mckModal=t.fn.mckModal.noConflict():"function"==typeof $.fn.mckModal&&(t.fn.mckModal=$.fn.mckModal.noConflict()),"function"==typeof $.fn.linkify?(t.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"==typeof t.fn.linkify&&($.fn.linkify=t.fn.linkify,jQuery.fn.linkify=t.fn.linkify),"function"==typeof $.fn.emojiarea?t.fn.emojiarea=$.fn.emojiarea:"function"==typeof t.fn.emojiarea&&($.fn.emojiarea=t.fn.emojiarea,jQuery.fn.emojiarea=t.fn.emojiarea),"function"==typeof $.fn.locationpicker?t.fn.locationpicker=$.fn.locationpicker:"function"==typeof t.fn.locationpicker&&($.fn.locationpicker=t.fn.locationpicker,jQuery.fn.locationpicker=t.fn.locationpicker);var u=new function(i){var r,c,l=this,d=!0;MCK_GROUP_MAP=[];var m,u,p=[],v=!0,g=[],f=0;MCK_CLIENT_GROUP_MAP=[];var k=!1,C=[],h=[],b=90,y=[],I=[],M=[],E=[],T=!0,S=0,A=(i.customerCreatedAt,i.openConversationOnNewMessage),L=i.KM_VER?i.KM_VER:"";"v2"===L&&(parent.KommunicateGlobal=window),"v2"===L&&(parent.Kommunicate=window.Kommunicate);var x=i.widgetSettings,_=i.emojilibrary,w=i.mode;MCK_LABELS=i.labels,MCK_BASE_URL=i.baseUrl;var K=i.customFileUrl,U=i.customUploadUrl,N=i.appId,G=[],O=[0,1,2,3],R=[1,2,5,6,10],D=[],B=!1,z=i.launcher,P=i.visitor,F=i.userName,$=i.locShare,q=i.video,H=i.fileBaseUrl,j=i.onInit,V=i.onTopicDetails,Y=[0,1,2],J=i.onClose,W=i.displayText,Z=i.password||i.accessToken,Q=i.readConversation,X=i.maxGroupSize,ee=i.onTabClicked,te=i.contactNumber,ae=i.maxAttachmentSize,se=i.appModuleName,oe=i.getTopicDetail,ne=i.contactDisplayName,ie=i.validateMessage,re=i.finalPriceResponse,ce=i.contactDisplayImage,le=i.priceWidget,de=i.openGroupSettings,me=i.offlineMessageDetail,ue=(i.initAutoSuggestions,i.authenticationTypeId),pe=i.getConversationDetail,ve=i.notificationIconLink,ge=i.mapStaticAPIkey,fe=i.unreadCountOnchatLauncher,ke=i.chatLauncherHtml,Ce=i.fileupload,he=i.notificationSoundLink?i.notificationSoundLink:Kommunicate.getBaseUrl()+"/plugin/audio/notification_tone.mp3",be=P?"guest":t.trim(i.userId),ye=$?i.googleApiKey:"NO_ACCESS",Ie=void 0===i.source?1:i.source,Me="boolean"==typeof i.topicBox&&i.topicBox,Ee="boolean"==typeof i.olStatus&&i.olStatus,Te="boolean"!=typeof i.messageBubbleAvator||i.messageBubbleAvator,Se="boolean"==typeof i.showOfflineMessage&&i.showOfflineMessage,Ae="boolean"==typeof i.hideGroupSubtitle&&i.hideGroupSubtitle,Le=void 0===i.defaultMessageMetaData?{}:i.defaultMessageMetaData,xe="boolean"==typeof i.groupUserCount&&i.groupUserCount,_e="boolean"==typeof i.checkUserBusyWithStatus&&i.checkUserBusyWithStatus,we="boolean"==typeof i.resetUserStatus&&i.resetUserStatus,Ke="boolean"==typeof i.topicHeader&&i.topicHeader,Ue=(i.supportId&&i.supportId,"boolean"==typeof i.loadOwnContacts&&i.loadOwnContacts),Ne="boolean"!=typeof i.desktopNotification||i.desktopNotification,Ge="boolean"!=typeof i.notification||i.notification,Oe=("boolean"==typeof i.swNotification&&i.swNotification,"boolean"!=typeof i.autoTypeSearchEnabled||i.autoTypeSearchEnabled),Re="boolean"==typeof i.launchOnNewMessage&&i.launchOnNewMessage,De="boolean"==typeof i.launchOnUnreadMessage&&i.launchOnUnreadMessage,Be="number"==typeof i.userTypeId&&i.userTypeId,ze=["DEFAULT","NEW","OPEN"],Pe=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],Fe="number"==typeof i.msgTriggerTimeout?i.msgTriggerTimeout:0;MCK_MAINTAIN_ACTIVE_CONVERSATION_STATE="boolean"==typeof i.automaticChatOpenOnNavigation&&i.automaticChatOpenOnNavigation;var $e,qe=new Object,He=new Array,je=new Array,Ve=new Object,Ye=new Array,Je=new Array,We=new Array,Ze=new Array,Qe=new function(){var e,o,n=this,i=!1,l=t("#mck-file-menu"),p=t("#mck-message-cell .mck-message-inner"),g=(t("#mck-tab-individual"),b);n.getLauncherHtml=function(e){var t=ut.customSideboxWidget(),a='<div id="launcher-svg-container" class="vis" style ="white-space: nowrap;">\n                '+ke+"\n                </div>";return e?'<a href="#" target="_self">'+(ke?a:t)+"</a>":'<div id="mck-sidebox-launcher" class="mck-sidebox-launcher launchershadow"><a href="#" target="_self" class="applozic-launcher">'+(ke?a:t)+'<div id="launcher-agent-img-container" class="n-vis"></div></a><div id="applozic-badge-count" class="applozic-badge-count"></div><div id="mck-msg-preview-visual-indicator" class="mck-msg-preview-visual-indicator-container n-vis"><div class="mck-close-btn-container"><div class="mck-close-btn"><span class="mck-close-icon-svg"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"><g fill="none" fill-rule="evenodd" stroke="#FFF" stroke-linecap="round"><path d="M1.0262069.0262069l7.9475862 7.9475862M8.9737931.0262069L1.0262069 7.9737931"/></g></svg></span><span class="mck-close-text">Close</span></div></div><div class="mck-msg-preview-visual-indicator-text  applozic-launcher"></div></div></div><div id="mck-msg-preview" class="mck-msg-preview applozic-launcher"><div class="mck-row"><div class="blk-lg-3 mck-preview-icon"></div><div class="blk-lg-9"><div class="mck-row mck-truncate mck-preview-content"><strong class="mck-preview-cont-name"></strong></div><div class="mck-row mck-preview-content"><div class="mck-preview-msg-content"></div><div class="mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"></div></div></div></div><div id="mck-msg-preview-btns" class="n-vis"><button id="mck-vid-call-accept">Accept</button><button id="mck-vid-call-reject">reject</div></div>'},n.initializeApp=function(e,a){i=a;var s={applicationId:e.appId,userId:be};null!==F&&(s.displayName=e.userName),null!==e.email&&(s.email=e.email),null!==te&&(s.contactNumber=e.contactNumber),e.imageLink&&(s.imageLink=e.imageLink),e.appModuleName&&(s.appModuleName=e.appModuleName),Z&&(s.password=Z),-1===Y.indexOf(ue)&&(ue=0),we&&(s.resetUserStatus=!0),"number"==typeof Be&&(s.userTypeId=Be),e.metadata&&(s.metadata=e.metadata),s.enableEncryption=!0,s.appVersionCode=108,s.deviceType=0,s.authenticationTypeId=ue,s.chatNotificationMailSent=!0,c="",m="",KommunicateUtils.getCookie(KommunicateConstants.COOKIES.IS_USER_ID_FOR_LEAD_COLLECTION)&&!JSON.parse(KommunicateUtils.getCookie(KommunicateConstants.COOKIES.IS_USER_ID_FOR_LEAD_COLLECTION))&&Mt&&0!==Mt.length&&(ALStorage.clearMckMessageArray(),ALStorage.clearMckContactNameArray(),ALStorage.clearAppHeaders());var o=n.validateAppSession(s);if(o)q&&Ct.InitilizeVideoClient(be,m);else if(Array.isArray(Mt)&&0!==Mt.length||0!==Et.length){if(t("#km-userId").val(be),KommunicateUtils.getCookie(KommunicateConstants.COOKIES.KOMMUNICATE_LOGGED_IN_ID)&&KommunicateUtils.getCookie(KommunicateConstants.COOKIES.IS_USER_ID_FOR_LEAD_COLLECTION)&&JSON.parse(KommunicateUtils.getCookie(KommunicateConstants.COOKIES.IS_USER_ID_FOR_LEAD_COLLECTION))){var r=KommunicateUtils.getCookie(KommunicateConstants.COOKIES.KOMMUNICATE_LOGGED_IN_ID),l={userId:r,applicationId:N,onInit:MckMessageServices.loadChat,baseUrl:MCK_BASE_URL,locShare:$,googleApiKey:ye,chatNotificationMailSent:!0};return d=!1,Qe.initialize(l),!1}var u=document.getElementById("km-anonymous-chat-launcher"),p=document.getElementById("km-chat-login-modal");"v2"===L&&(u.style.right="10px",u.style.bottom="10px"),t("#km-anonymous-chat-launcher").append(Qe.getLauncherHtml(!0)),n.addLeadCollectionInputDiv(),n.setLeadCollectionLabels(),p.style.visibility="visible",p.style.display="none",u.classList.remove("n-vis"),u.classList.add("vis"),document.getElementById("km-modal-close").addEventListener("click",function(e){if(e.preventDefault(),"v2"===L){var t=parent.document.getElementById("kommunicate-widget-iframe");t.style.boxShadow="none"}p.style.display="none",u.classList.remove("n-vis"),u.classList.add("vis")}),u.addEventListener("click",function(e){if(e.preventDefault(),"v2"===L){Kommunicate.setDefaultIframeConfigForOpenChat(),u.style.right="10px",u.style.bottom="10px",p.classList.add("km-iframe-sidebox-border-radius");var t=parent.document.getElementById("kommunicate-widget-iframe");t.style.boxShadow="0 1.5rem 2rem rgba(0,0,0,.3)"}p.style.display="block",u.classList.remove("vis"),u.classList.add("n-vis")}),document.getElementById("km-tab-title").innerHTML=e.conversationTitle,t("#km-form-chat-login .km-form-group input").hasClass("n-vis")&&t("#km-form-chat-login .km-form-group .km-form-control.n-vis").prop("required",null)}else n.initialize(s)},n.initialize=function(e){window.Applozic.ALApiService.login({data:{alUser:e,baseUrl:MCK_BASE_URL},success:function(a){q&&Ct.InitilizeVideoClient(a.userId,a.deviceKey),"kommunicate"==window.applozic.PRODUCT_ID&&t("#km-chat-login-modal").css("display","none"),ALStorage.clearMckMessageArray(),ALStorage.clearMckContactNameArray(),"INVALID_PASSWORD"!==a?"INVALID_APPID"!==a?"error"!==a&&"USER_NOT_FOUND"!==a?"APPMODULE_NOT_FOUND"!==a?"object"==typeof a&&null!==a&&a.token?(a.appId=e.applicationId,Z&&(a.accessToken=Z),n.onInitApp(a)):"function"==typeof j&&j({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"}):"function"==typeof j&&j({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"function"==typeof j&&j({status:"error",errorMessage:"USER NOT FOUND"}):"function"==typeof j&&j({status:"error",errorMessage:"INVALID APPLICATION ID"}):"function"==typeof j&&j({status:"error",errorMessage:"INVALID PASSWORD"})},error:function(){ALStorage.clearMckMessageArray(),"function"==typeof j&&j({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})},n.onInitApp=function(e){var s=t("#mck-sidebox");n.appendLauncher(),n.setLabels(),"v2"===L&&n.configureIframe(),t(".applozic-launcher").each(function(){t(this).hasClass("mck-msg-preview")||t(this).show()}),r=e.token,Xe.setEncryptionKey(e.encryptionKey),be=e.userId,e.countryCode,m=e.deviceKey,u=e.websocketUrl,b=e.websocketIdleTimeLimit,e.timeZoneOffset,H=e.fileBaseUrl,B=e.deactivated,c=btoa(e.userId+":"+e.deviceKey),window.Applozic.ALApiService.setAjaxHeaders(c,N,m,Z,se),S=e.totalUnreadCount,Xe.badgeCountOnLaucher(fe,S),e.connectedClientCount,P||"guest"===be||"0"===be||"C0"===be||(i?Lt.reconnect():Lt.init()),it.createContactWithDetail({userId:be,displayName:e.displayName,photoLink:e.imageLink}),t.ajaxPrefilter(function(e){e.beforeSend||-1===e.url.indexOf(MCK_BASE_URL)||(e.beforeSend=function(e){n.setHeaders(e)})});var o=pt.showPoweredBy(e);if(o){var l="https://www.kommunicate.io/?utm_source="+a.location.href+"&utm_medium=webplugin&utm_campaign=poweredby";t(".mck-running-on a").attr("href",l),t(".mck-running-on").removeClass("n-vis").addClass("vis")}var p=ALStorage.getMckContactNameArray();if(null!==p&&p.length>0)for(var v=0;v<p.length;v++){var g=p[v];null!==g&&(Ye[g[0]]=g[1])}ft.checkUserConnectedStatus(function(e){e.length>0?ct.getUsersDetail(e,{setStatus:!0}):tt.updateUserConnectedStatus()}),"function"==typeof j&&j("success",e),Qe.tabFocused(),a.addEventListener("online",function(){console.log("online"),Lt.reconnect()}),a.addEventListener("offline",function(){console.log("offline")}),kt.length>0&&S>0&&kt.html(S),De&&rt.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0}),mt.init(e),gt.subscribeToServiceWorker(),ALStorage.setAppHeaders(e),at.loadGroups({apzCallback:ot.loadGroups}),Mt&&0!==Mt.length||Et&&0!==Et.length?d&&t.fn.applozic("mckLaunchSideboxChat"):(t.fn.applozic("triggerMsgNotification"),"block"===s.css("display")&&clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM)),Kommunicate.postPluginInitialization(null,e),KommunicateUtils.triggerCustomEvent("kmInitilized",{detail:e,bubbles:!0,cancelable:!0});var f=document.getElementById("km-chat-login-modal");f.style.visibility="hidden"},n.validateAppSession=function(e){ot.init(),it.init();var t=ALStorage.getAppHeaders();return!(!t||!t.userId)&&(e.applicationId===t.appId&&e.userId===t.userId&&e.password===Z?(d=!(0!==Mt),n.onInitApp(t),!0):(ALStorage.clearAppHeaders(),!1))},n.setHeaders=function(e){e.setRequestHeader("UserId-Enabled",!0),c&&e.setRequestHeader("Authorization","Basic "+c),e.setRequestHeader("Application-Key",N),m&&e.setRequestHeader("Device-Key",m),Z&&e.setRequestHeader("Access-Token",Z),se&&e.setRequestHeader("App-Module-Name",se)},n.configureIframe=function(){document.getElementById("mck-sidebox-launcher").style.right="10px",document.getElementById("mck-sidebox-launcher").style.bottom="10px",document.getElementById("mck-sidebox").classList.add("km-iframe-sidebox-border-radius");var e=document.getElementById("applozic-badge-count");e.classList.add("km-iframe-badge-count");var t=parent.document.getElementById("kommunicate-widget-iframe"),a=t.contentDocument,s=a.getElementById("mck-sidebox-launcher");s.addEventListener("click",function(){t.style.width="390px",t.style.height="600px",t.classList.add("kommunicate-iframe-enable-media-query")});var o=a.getElementById("km-chat-widget-close-button");o.addEventListener("click",function(){t.style.width="75px",t.style.height="75px",t.style.boxShadow="none",t.classList.remove("kommunicate-iframe-enable-media-query")});var n=parent.window.matchMedia("(max-width: 600px)");n.addListener(function(){n.matches?document.getElementById("mck-sidebox").classList.remove("km-iframe-sidebox-border-radius"):document.getElementById("mck-sidebox").classList.add("km-iframe-sidebox-border-radius")})},n.getPreLeadDataForAskUserDetail=function(){var e=MCK_LABELS["lead.collection"],t={email:"email",phone:"number"},a=Et;if(Mt&&0===a.length)for(var s=0;s<Mt.length;s++){var o={};o.field=Mt[s],o.type=t[Mt[s]]||"text",o.placeholder=e[Mt[s]]||"",o.required=!0,Et.push(o)}},n.addLeadCollectionInputDiv=function(){Mt&&n.getPreLeadDataForAskUserDetail();for(var e=0;e<Et.length;e++){var a=Et[e],s=document.createElement("div");s.setAttribute("class","km-form-group km-form-group-container");var o=document.createElement("input");o.setAttribute("id","km-"+a.field),o.setAttribute("type",a.type||"text"),o.setAttribute("name","km-"+a.field),a.required&&o.setAttribute("required",a.required),o.setAttribute("placeholder",a.placeholder||""),o.setAttribute("class","km-form-control km-input-width vis"),t(".km-last-child").prepend(s),t(s).append(o)}},n.setLeadCollectionLabels=function(){var e=MCK_LABELS["lead.collection"];document.getElementById("km-submit-chat-login").innerHTML=e.submit,document.getElementById("km-lead-collection-heading").innerHTML=e.heading},n.setLabels=function(){t("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]),t("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]),t("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]),t("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]),t("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]),t("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]),t("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]),t("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]),t("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]),t("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]),t("#mck-msg-error").html(MCK_LABELS["group.deleted"]),t("#mck-gc-title-label").html(MCK_LABELS["group.title"]),t("#mck-gc-type-label").html(MCK_LABELS["group.type"]),t("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]),t("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]),t("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]),t("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]),t("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]),t("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]),t("#mck-typing-label").html(MCK_LABELS.typing),t("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]),t("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),t("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]),t("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]),t("#mck-file-up-label").html(MCK_LABELS["file.attachment"]),t("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]),t(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]),t("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]),t("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close),t("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send),t("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]),t("#mck-btn-smiley").attr("title",MCK_LABELS.smiley),t("#mck-group-name-save").attr("title",MCK_LABELS.save),t("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save),t("#mck-group-name-edit").attr("title",MCK_LABELS.edit),document.getElementById("mck-text-box").dataset.text=MCK_LABELS["input.message"],document.getElementById("km-faq-search-input").setAttribute("placeholder",MCK_LABELS["search.faq"]),document.getElementById("mck-no-faq-found").innerHTML=MCK_LABELS["looking.for.something.else"],document.getElementById("talk-to-human-link").innerHTML=MCK_LABELS["talk.to.agent"],document.getElementById("mck-collect-email").innerHTML=MCK_LABELS["how.to.reachout"],document.getElementById("mck-email-error-alert").innerHTML=MCK_LABELS["email.error.alert"]},t(s).on("click",".fancybox-kommunicate",function(e){e.preventDefault();var a=t(this),s=a.data("type");if(-1!==s.indexOf("video")){var o,n=a.find(".mck-video-box").html();a.fancybox({content:n,title:a.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){(o=t(".fancybox-inner").find("video").get(0)).load(),o.play()}})}else{var i=a.data("url"),r=a.data("name"),c=parent.document.getElementById("km-fullscreen-image-modal"),l=parent.document.getElementById("km-fullscreen-image-modal-content"),d=parent.document.getElementById("km-fullscreen-image-modal-caption");c.style.display="block",l.src=i,d.innerHTML=r||""}}),parent.document.getElementById("km-fullscreen-image-modal-close").onclick=function(){parent.document.getElementById("km-fullscreen-image-modal").style.display="none"},t(a).on("resize",function(){if("block"===l.css("display")&&et.fileMenuReposition(),0===p.find(".mck-contact-list").length){var e=p.get(0).scrollHeight;p.height()<e&&p.animate({scrollTop:p.prop("scrollHeight")},0)}}),n.appendLauncher=function(){t("#mck-sidebox-launcher").remove(),t("body").append(n.getLauncherHtml()),lt.init()},n.tabFocused=function(){var e="hidden";function t(t){var s={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};t=t||a.event,(T=t.type in s?s[t.type]:!this[e])?(g<1&&v&&Lt.checkConnected(!0),n.stopIdleTimeCounter()):(1===f&&Lt.sendTypingStatus(0),n.manageIdleTime())}e in s?s.addEventListener("visibilitychange",t):("mozHidden"===e)in s?s.addEventListener("mozvisibilitychange",t):("webkitHidden"===e)in s?s.addEventListener("webkitvisibilitychange",t):("msHidden"===e)in s?s.addEventListener("msvisibilitychange",t):"onfocusin"in s?s.onfocusin=s.onfocusout=t:a.onpageshow=a.onpagehide=a.onfocus=a.onblur=t,void 0!==s[e]&&t({type:s[e]?"blur":"focus"})},n.manageIdleTime=function(){g=b,e&&clearInterval(e),e=setInterval(function(){--g<0&&(g=0,Lt.stopConnectedCheck(),clearInterval(e),e="")},6e4)},n.stopIdleTimeCounter=function(){g=b,e&&clearInterval(e),e=""},n.manageOfflineMessageTime=function(e){if("object"!=typeof me||isNaN(me.timeout))a.console.log("Offline message timeout required.");else{if(1===me.type){if(!me.userIds||0===me.userIds.length)return void a.console.log("Offline message userIds required.");if(-1===me.userIds.indexOf(e))return}o&&clearInterval(o),o=setTimeout(function(){clearInterval(o),o="",it.showOfflineMessage()},5e3*parseInt(me.timeout))}},n.stopOfflineMessageCounter=function(){o&&clearInterval(o),o=""}},Xe=new MckUtils,et=new function(){var e=this,s="",o="",n=!1,i=t("#mck-my-loc"),r=t("#mck-loc-box"),c=t("#mck-loc-lat"),l=t("#mck-loc-lon"),d=t("#mck-btn-loc"),m=t("#mck-sidebox-ft"),u=t("#mck-file-menu"),p=t("#mck-btn-attach"),v=t("#mck-map-content"),g=t("#mck-loc-address");e.init=function(){$&&a.google&&"object"==typeof a.google.maps&&(s=new a.google.maps.Geocoder,p.on("click",function(){e.fileMenuToggle()}),d.on("click",function(t){t.preventDefault(),n?r.mckModal():(mckMapUtils.getCurrentLocation(e.onGetCurrLocation,e.onErrorCurrLocation),n=!0)})),i.on("click",function(){mckMapUtils.getCurrentLocation(e.onGetMyCurrLocation,e.onErrorMyCurrLocation)})},e.fileMenuReposition=function(){var e=m.offset();e.bottom=a.innerHeight-e.top,u.css({bottom:e.bottom>51?e.bottom:51,right:0})},e.fileMenuToggle=function(){p.hasClass("on")?(p.removeClass("on"),u.hide()):(e.fileMenuReposition(),p.addClass("on"),u.show())},e.onGetCurrLocation=function(t){MCK_CURR_LATITIUDE=t.coords.latitude,MCK_CURR_LONGITUDE=t.coords.longitude,e.openMapBox()},e.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=46.15242437752303,MCK_CURR_LONGITUDE=2.7470703125,e.openMapBox()},e.onErrorMyCurrLocation=function(e){alert("Unable to retrieve your location. ERROR("+e.code+"): "+e.message)},e.onGetMyCurrLocation=function(e){if(MCK_CURR_LATITIUDE=e.coords.latitude,MCK_CURR_LONGITUDE=e.coords.longitude,c.val(MCK_CURR_LATITIUDE),l.val(MCK_CURR_LONGITUDE),c.trigger("change"),l.trigger("change"),o)g.val(o);else if(s){var t={lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE};s.geocode({location:t},function(e,t){"OK"===t&&e[1]&&(o=e[1].formatted_address)})}},e.openMapBox=function(){v.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:c,longitudeInput:l,locationNameInput:g},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(e){MCK_CURR_LATITIUDE=e.latitude,MCK_CURR_LONGITUDE=e.longitude}}),r.on("shown.bs.mck-box",function(){v.locationpicker("autosize")}),r.mckModal()}},tt=new function(){var e=t("#mck-msg-form"),s=t("#mck-msg-error"),o=t("#mck-tab-title"),n=t("#mck-tab-status"),i=t(".mck-typing-box"),r=t("#mck-block-button"),c=t("#mck-message-cell .mck-message-inner");this.updateUserConnectedStatus=function(){t(".mck-user-ol-status").each(function(){var e=t(this),a=e.data("mck-id");if(a){var s=y[a];void 0!==ft.MCK_USER_DETAIL_MAP[a]&&s.connected?(e.removeClass("n-vis").addClass("vis"),e.next().html("("+MCK_LABELS.online+")")):(e.removeClass("vis").addClass("n-vis"),e.next().html("(Offline)"))}})},this.lastSeenOfGroupOfTwo=function(e){if(a.MCK_OL_MAP[e])n.attr("title",MCK_LABELS.online).html(MCK_LABELS.online);else if(M[e]){var t=mckDateUtils.getLastSeenAtStatus(M[e]);n.html(t),n.attr("title",t),o.addClass("mck-tab-title-w-status")}},this.toggleBlockUser=function(t,l){if(l)s.html(MCK_LABELS.blocked),s.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),e.removeClass("vis").addClass("n-vis"),o.removeClass("mck-tab-title-w-status"),n.removeClass("vis").addClass("n-vis"),i.removeClass("vis").addClass("n-vis"),c.data("blocked",!0),r.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"]);else if(s.html(""),s.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),e.removeClass("n-vis").addClass("vis"),c.data("blocked",!1),r.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),!h[t]&&(a.MCK_OL_MAP[t]||M[t])){if(a.MCK_OL_MAP[t])n.attr("title",MCK_LABELS.online).html(MCK_LABELS.online);else if(M[t]){var d=mckDateUtils.getLastSeenAtStatus(M[t]);n.html(d),n.attr("title",d)}o.addClass("mck-tab-title-w-status")}}},at=(new function(){var e=t("#mck-msg-to"),s=(t("#mck-btn-loc"),t("#mck-loc-box")),o=t("#mck-msg-sbmt"),n=t("#mck-msg-error"),i=t("#mck-loc-submit"),r=t("#mck-msg-response"),c=t("#mck_response_text"),l=t("#mck-message-cell .mck-message-inner");i.on("click",function(){var t={type:5,contentType:2,message:a.JSON.stringify(mckMapUtils.getSelectedLocation())},i=l.data("mck-conversationid"),d=l.data("mck-topicid");if(i)t.conversationId=i;else if(d){var m={topicId:d},u=I[d];"object"==typeof u&&(m.topicDetail=a.JSON.stringify(u)),t.conversationPxy=m}!0===l.data("isgroup")?t.groupId=e.val():t.to=e.val(),o.attr("disabled",!0),n.removeClass("vis").addClass("n-vis"),n.html(""),c.html(""),r.removeClass("vis").addClass("n-vis"),rt.sendMessage(t),s.mckModal("hide")})},new MckGroupService),st=new MckGroupUtils,ot=new function(){var e=this,o={0:MCK_LABELS.user,1:MCK_LABELS.admin,2:MCK_LABELS.moderator,3:MCK_LABELS.member},n=document.getElementById("mck-group-create-type");n.options[n.options.length]=new Option(MCK_LABELS.public,"1"),n.options[n.options.length]=new Option(MCK_LABELS.private,"2"),n.options[n.options.length]=new Option(MCK_LABELS.open,"6");var i=t("#mck-msg-form"),r=t("#mck-msg-error"),c=t("#mck-tab-title"),l=t("#mck-tab-status"),d=t("#mck-no-gsm-text"),m=t("#mck-gms-loading"),u=t("#mck-contact-loading"),p=(t("#mck-tab-menu-box"),t("#mck-search-loading"),t("#mck-group-info-tab")),v=t("#mck-sidebox-search"),g=(t("#mck-group-name-box"),t("#mck-group-back-link")),f=t("#mck-group-name-edit"),k=t("#mck-group-name-save"),h=t("#mck-sidebox-content"),b=t("#mck-tab-option-panel"),y=t("#mck-btn-group-create"),T=t("#mck-group-create-tab"),S=t("#mck-contacts-content"),A=t("#mck-btn-group-update"),L=t("#mck-group-create-type"),x=t("#mck-group-icon-upload"),_=t("#mck-group-icon-change"),w=t("#mck-group-member-list"),K=t("#mck-group-update-panel"),U=t(".mck-tab-message-option"),N=t("#mck-group-create-title"),O=t(".mck-group-menu-options"),B=t("#mck-group-member-search"),z=t("#mck-btn-group-icon-save"),P=(t("#mck-group-info-icon-box"),t(".mck-group-admin-options")),F=t("#mck-group-add-member-box"),$=t("#mck-message-cell .mck-message-inner"),q=t("#mck-group-name-sec .mck-group-title"),H=(t("#mck-group-create-icon-box"),t("#mck-group-info-icon-loading")),j=t("#mck-gm-search-box"),V=(t("#mck-group-member-search-list"),t("#mck-group-create-icon-loading")),Y=t("#mck-group-info-icon-box .mck-group-icon"),J=t("#mck-group-create-icon-box .mck-group-icon"),W=t("#mck-group-create-icon-box .mck-overlay-box"),Z=t("#mck-gc-overlay-label");t(".mck-group-name-box div[contenteditable]").keypress(function(a){return!!(8===a.which||37===a.keyCode||38===a.keyCode||39===a.keyCode||40===a.keyCode||a.ctrlKey&&97===a.which)||(13!==a.keyCode||a.shiftKey||a.ctrlKey?30>this.innerHTML.length:!!t(a.target).hasClass("mck-group-create-title")&&(e.submitCreateGroup(),!1))}).on("paste",function(e){var t=this;setTimeout(function(){var e=t.innerText.length;return e>30&&(t.innerHTML=t.innerText.substring(0,30),Xe.setEndOfContenteditable(t)),!1},"fast")}).on("drop",function(e){e.preventDefault(),e.stopPropagation()}),t(s).on("click",".mck-btn-change-role",function(e){e.preventDefault();var a=t(this).parents(".mck-li-group-member").find(".mck-group-change-role-box"),s=t(this).parents(".mck-li-group-member").data("role");a.find("select").val(s),a.removeClass("n-vis").addClass("vis"),K.removeClass("n-vis").addClass("vis")}),A.on("click",function(){var e=[];if(t(".mck-group-change-role-box.vis").each(function(a,s){var o=t(this),n=parseInt(o.find("select").val()),i=o.parents(".mck-li-group-member").data("role");if(n!==i){var r={userId:o.parents(".mck-li-group-member").data("mck-id"),role:n};e.push(r)}}),e.length>0){var a=$.data("mck-id"),s=$.data("isgroup");if(a&&s){A.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]);var o={groupId:a,users:e,apzCallback:ot.onUpdateGroupInfo};at.updateGroupInfo(o)}}}),t("#mck-group-info-icon-box .mck-overlay").on("click",function(e){_.trigger("click")}),t("#mck-group-create-icon-box .mck-overlay").on("click",function(e){x.trigger("click")}),t(s).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){t(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var e=t(this);0===e.find(".mck-group-icon-default").length&&e.find(".mck-overlay-box").addClass("n-vis")}),t(s).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){t(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",function(){t(this).find(".mck-overlay-box").addClass("n-vis")}),f.on("click",function(){q.attr("contenteditable",!0).focus(),Xe.setEndOfContenteditable(q[0]),k.removeClass("n-vis").addClass("vis"),f.removeClass("vis").addClass("n-vis")}),k.on("click",function(){var e=t.trim(q.text());if(e.length>0){var a=$.data("mck-id"),s=$.data("isgroup");if(a&&s){f.removeClass("n-vis").addClass("vis"),k.removeClass("vis").addClass("n-vis"),q.attr("contenteditable",!1);var o={groupId:a,name:e,apzCallback:ot.onUpdateGroupInfo};at.updateGroupInfo(o)}}else q.addClass("mck-req-border")}),z.on("click",function(){var e=Y.data("iconurl");if(e){var t=$.data("mck-id"),a=$.data("isgroup");if(t&&a){setTimeout(function(){z.removeClass("vis").addClass("n-vis")},1e3),Y.data("iconurl","");var s={groupId:t,imageUrl:e,apzCallback:ot.onUpdateGroupInfo};at.updateGroupInfo(s)}}else q.addClass("mck-req-border")}),y.on("click",function(){e.submitCreateGroup()}),e.init=function(){t.template("groupMemberTemplate",'<li id="li-gm-${contHtmlExpr}" class="${contIdExpr} mck-li-group-member" data-mck-id="${contIdExpr}" data-role="${roleVal}" data-alpha="${contFirstAlphaExpr}"><div class="mck-row mck-group-member-info" title="${contNameExpr}"><div class="blk-lg-3">{{html contImgExpr}}</div><div class="blk-lg-9"><div class="mck-row"><div class="blk-lg-8 mck-cont-name mck-truncate"><strong>${contNameExpr}</strong></div><div class="blk-lg-4 mck-group-admin-text move-right vis"><span>${roleExpr}</span></div></div><div class="mck-row"><div class="blk-lg-8 mck-truncate mck-last-seen-status" title="${contLastSeenExpr}">${contLastSeenExpr}</div><div class="blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"><div class="mck-menu-box n-vis"><div class="mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle="mckdropdown" aria-expanded="true"><span class="mck-caret"></span></div><ul id="mck-group-admin-menu" class="mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role="menu"><li><a href="#" target="_self"  class="mck-btn-remove-member menu-item" title="${removeMemberLabel}">${removeMemberLabel}</a></li><li><a href="#" target="_self"  class="mck-btn-change-role menu-item" title="${changeRoleLabel}">${changeRoleLabel}</a></li></ul></div></div></div><div id="mck-group-change-role-box" class="mck-row mck-group-change-role-box n-vis"><div class="blk-lg-4"><div class="mck-label">Select role </div></div><div class="blk-lg-8 move-right"><select id="mck-change-role-type" class="mck-select"><option value="0">User</option><option value="1">Admin</option><option value="2">Moderator</option><option value="3" selected>Member</option></select></div></div></div></div></li>'),t.template("groupMemberSearchTemplate",'<li id="li-${contHtmlExpr}" class="${contIdExpr} mck-li-group-member" data-mck-id="${contIdExpr}"><a class="mck-add-to-group" href="#" data-mck-id="${contIdExpr}"><div class="mck-row" title="${contNameExpr}"><div class="blk-lg-3">{{html contImgExpr}}</div><div class="blk-lg-9"><div class="mck-row"><div class="blk-lg-12 mck-cont-name mck-truncate"><strong>${contNameExpr}</strong></div></div><div class="mck-row"><div class="blk-lg-12 mck-truncate mck-last-seen-status" title="${contLastSeenExpr}">${contLastSeenExpr}</div></div></div></div></a></li>')},e.submitCreateGroup=function(){var e=t.trim(N.text()),a=L.val(),s=J.data("iconurl");if(e.length>0){var o={groupName:e};a&&(a=parseInt(a),-1!==R.indexOf(a)&&(o.type=a)),s&&(o.groupIcon=s),J.data("iconurl",""),o.isInternal=!0,y.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),rt.getGroup(o)}else N.addClass("mck-req-border")},e.loadGroups=function(e){var a=e.data;He.length=0,t.each(a,function(e,t){if(void 0!==t.id){var t=st.addGroup(t);He.push(t)}})},e.getDeletedAtTime=function(e){if("object"==typeof MCK_GROUP_MAP[e]){var t=MCK_GROUP_MAP[e];return t.deletedAtTime}},e.validateOpenGroupUser=function(e){if(6===e.type){var t=at.authenticateGroupUser(e);if(!t){if(de.disableChatForNonGroupMember){var a=de.defaultChatDisabledMessage;a||(a="Chat disabled"),r.html(a),r.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),i.removeClass("vis").addClass("n-vis"),c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis")}O.removeClass("vis").addClass("n-vis"),U.removeClass("vis").addClass("n-vis"),b.removeClass("vis").addClass("n-vis"),void 0===G[e.contactId]&&Lt.subscribeToOpenGroup(e)}return e.adminName===be?0===de.deleteChatAccess&&U.removeClass("vis").addClass("n-vis"):(de.allowInfoAccessGroupMembers||O.removeClass("vis").addClass("n-vis"),2!==de.deleteChatAccess&&U.removeClass("vis").addClass("n-vis"),de.allowInfoAccessGroupMembers||2===de.deleteChatAccess||b.removeClass("vis").addClass("n-vis")),!1}return!0},e.addGroupStatus=function(t){var a=e.isGroupLeft(t);if(6!==t.type&&(a||Ae))a&&ot.onGroupLeft("",{groupId:t.contactId}),c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis");else if(t.members.length>0){for(var s="",o=!1,n=t.members.length<=30?t.members.length:25,i=0;i<n;i++)if(be!==""+t.members[i]&&-1===t.removedMembersId.indexOf(t.members[i])){var r=it.fetchContact(""+t.members[i]),d=it.getTabDisplayName(r.contactId,!1);s+=" "+d+","}else o=!0;(5!==t.type&&6!==t.type||o&&5!==t.type)&&(s+=" You"),t.members.length>30&&(s+=" and "+(t.members.length-25)+" more"),s=s.replace(/,\s*$/,""),l.html(s),l.attr("title",s),c.addClass("mck-tab-title-w-status"),O.removeClass("n-vis").addClass("vis")}else c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis");7===t.type&&(l.html(""),O.removeClass("vis").addClass("n-vis"))},e.disableGroupTab=function(){r.html(MCK_LABELS["group.chat.disabled"]),r.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),i.removeClass("vis").addClass("n-vis"),c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis")},e.isGroupLeft=function(e){var a=!1;return e.removedMembersId&&e.removedMembersId.length>0&&t.each(e.removedMembersId,function(e,t){t===be&&(a=!0)}),a},e.onGroupLeft=function(t,a){if(u.removeClass("vis").addClass("n-vis"),"object"!=typeof t||"error"!==t.status){var s=a.groupId;if(p.hasClass("vis")){var o=p.data("mck-id");s===o&&g.trigger("click")}else if(h.hasClass("vis")){var n=$.data("mck-id"),i=$.data("isgroup");n===s.toString()&&i&&(O.removeClass("vis").addClass("n-vis"),e.disableGroupTab())}}else alert("Unable to process your request. "+t.errorMessage)},e.onAddedGroupMember=function(a,s){if(u.removeClass("vis").addClass("n-vis"),"object"!=typeof a||"error"!==a.status){var o=s.groupId,n=s.userId,i="";if(o?i=st.getGroup(o):s.clientGroupId&&(i=st.getGroupByClientGroupId(s.clientGroupId)),"object"==typeof i){if(i=at.addMemberToGroup(i,n),p.hasClass("vis")){var r=p.data("mck-id");if(o===r){var c=it.fetchContact(""+n);0===t("#li-gm-"+c.htmlId).length&&e.addGroupMember(i,c),e.sortGroupMemberHtmlList(),e.enableGroupAdminMenuToggle()}}else if(h.hasClass("vis")){var l=$.data("mck-id"),d=$.data("isgroup");l===o.toString()&&d&&e.addGroupStatus(i)}}else at.getGroupFeed({groupId:o,clientGroupId:s.clientGroupId,apzCallback:ot.onGroupFeed})}else alert("Unable to process your request. "+a.errorMessage)},e.onRemovedGroupMember=function(a,s){if(u.removeClass("vis").addClass("n-vis"),"object"!=typeof a||"error"!==a.status){var o=s.groupId,n=s.userId,i="";if(o?i=st.getGroup(o):s.clientGroupId&&(i=st.getGroupByClientGroupId(s.clientGroupId)),"object"==typeof i){if(i=at.removeMemberFromGroup(i,n),p.hasClass("vis")){var r=p.data("mck-id");if(o===r){var c=it.fetchContact(""+n),l=t("#li-gm-"+c.htmlId);l.length>0&&l.remove()}}else if(h.hasClass("vis")){var d=$.data("mck-id"),m=$.data("isgroup");d===o.toString()&&m&&e.addGroupStatus(i)}}else at.getGroupFeed({groupId:o,clientGroupId:s.clientGroupId,apzCallback:ot.onGroupFeed})}else alert("Unable to process your request. "+a.errorMessage)},e.onGroupFeed=function(a,s){if(u.removeClass("vis").addClass("n-vis"),"success"===a.status){var o=a.data,n=o.conversationPxy,c=st.getGroup(o.id);o.deletedAtTime&&(r.html(MCK_LABELS["group.deleted"]),r.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),i.removeClass("vis").addClass("n-vis"));var l=new Array;"object"==typeof n&&(E[n.id]=n,D[n.topicId]=[n.id],n.topicDetail&&(I[n.topicId]=t.parseJSON(n.topicDetail)),l.push(n)),l.length>0&&(Ze[s.groupId]=l),ft.loadUserProfiles(o.membersId,function(e,a){t.each(e,function(e,t){void 0===it.getContact(t)&&a.push(t)}),ct.getUsersDetail(a,{async:!1})}),s.isMessage&&"object"==typeof s.message&&it.populateMessage(s.messageType,s.message,s.notifyUser),s.isReloadTab&&e.reloadGroupTab(c)}},e.onUpdateGroupInfo=function(a,s){if(u.removeClass("vis").addClass("n-vis"),A.attr("disabled",!1).html("Update"),K.removeClass("vis").addClass("n-vis"),"object"!=typeof a||"error"!==a.status){var o=s.groupId,n=s.groupInfo,i=st.getGroup(o);if("object"==typeof i){if(n.imageUrl&&(i.imageUrl=n.imageUrl),n.newName&&(i.displayName=n.newName),n.metadata&&(i.metadata=n.metadata),n.users&&n.users.length>0&&t.each(n.users,function(e,t){t.userId&&(i.users[t.userId]=t)}),p.hasClass("vis"))n.imageUrl&&Y.html(at.getGroupImage(i.imageUrl)),q.html(i.displayName),n.users&&n.users.length>0&&(w.html(""),e.addMembersToGroupInfoList(i),i.adminName===be?F.removeClass("n-vis").addClass("vis"):F.removeClass("vis").addClass("n-vis"));else if(h.hasClass("vis")){var r=$.data("mck-id"),l=$.data("isgroup");r===o.toString()&&l?c.html(i.displayName):t("#li-group-"+i.htmlId).length>0&&(t("#li-group-"+i.htmlId+" .mck-cont-name strong").html(i.displayName),n.imageUrl&&t("#li-group-"+i.htmlId+" .blk-lg-3").html("<img src=' "+i.imageUrl+"'>"))}MCK_GROUP_MAP[i.contactId]=i}}else alert("Unable to process your request. "+a.errorMessage)},e.getGroupFeedFromMessage=function(e){var t=e.message;if(t){if(e.groupId=t.groupId,e.isMessage=!0,t.conversationId){var a=E[t.conversationId];"object"==typeof a&&"object"==typeof I[a.topicId]||(e.conversationId=t.conversationId)}e.apzCallback=ot.onGroupFeed,at.getGroupFeed(e)}},e.reloadGroupTab=function(t){var a=$.data("mck-id"),s=$.data("isgroup");a===t.contactId.toString()&&s&&e.addGroupStatus(t)},e.loadGroupTab=function(e){if("error"===e.status)alert("Unable to process your request. "+e.errorMessage);else{var a=e.data;it.loadTab({tabId:a.contactId,isGroup:!0}),t("#mck-search").val("")}},e.addMembersToGroupInfoList=function(a){var s=a.members;s.sort(),w.html(""),t.each(s,function(s,o){if(o){var n=it.fetchContact(""+o);0===t("#li-gm-"+n.htmlId).length&&e.addGroupMember(a,n)}}),e.sortGroupMemberHtmlList(),e.enableGroupAdminMenuToggle()},e.enableGroupAdminMenuToggle=function(){t(".mck-group-member-info").bind("mouseenter",function(){t(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",function(){t(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})},e.addGroupMember=function(e,s){var n="n-vis",i="n-vis",r=e.users[s.contactId],c=MCK_LABELS.member,l=3;r&&void 0!==r.role&&(l=r.role,c=o[r.role]);var d=it.getTabDisplayName(s.contactId,!1);s.contactId===e.adminName&&(n="vis"),e.adminName===be&&(i="vis"),s.contactId===be&&(d=MCK_LABELS.you,i="n-vis");var m=it.getContactImageLink(s,d),u="";C[s.contactId]||(a.MCK_OL_MAP[s.contactId]?u=MCK_LABELS.online:M[s.contactId]&&(u=mckDateUtils.getLastSeenAtStatus(M[s.contactId])));var p=[{roleExpr:c,roleVal:l,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:s.htmlId,contIdExpr:s.contactId,contImgExpr:m,contLastSeenExpr:u,contNameExpr:d,contFirstAlphaExpr:d.charAt(0).toUpperCase(),isAdminExpr:n,enableAdminMenuExpr:i}];t.tmpl("groupMemberTemplate",p).appendTo("#mck-group-member-list")},e.addMembersToGroupSearchList=function(){var a=$.data("mck-id"),s=$.data("isgroup");if(s){var o=st.getGroup(a),n=We,i=[],r=ALStorage.getFriendListGroupName(),c=ALStorage.getFriendListGroupType();r&&c&&(n=ct.getFriendList(r,c)),r&&!c&&(n=ct.getFriendList(r)),(n=n.filter(function(e,t){return n.indexOf(e)===t})).sort();var l=o.members;t.each(n,function(t,a){if(a){if("object"==typeof a&&a.contactId)var a=it.fetchContact(""+a.contactId);else var a=it.fetchContact(""+a);(-1===l.indexOf(a.contactId)||-1!==l.indexOf(a.contactId)&&-1!==o.removedMembersId.indexOf(a.contactId))&&(e.addGroupSearchMember(a),i.push(a))}}),e.enableGroupAdminMenuToggle(),i.length>0?d.removeClass("vis").addClass("n-vis"):d.removeClass("n-vis").addClass("vis"),it.initAutoSuggest({contactsArray:i,$searchId:B,isContactSearch:!1})}m.removeClass("vis").addClass("n-vis")},e.addGroupSearchMember=function(e){var s=it.getTabDisplayName(e.contactId,!1),o=it.getContactImageLink(e,s),n="user-"+e.htmlId,i="";C[e.contactId]||(a.MCK_OL_MAP[e.contactId]?i=MCK_LABELS.online:M[e.contactId]&&(i=mckDateUtils.getLastSeenAtStatus(M[e.contactId])));var r=[{contHtmlExpr:n,contIdExpr:e.contactId,contImgExpr:o,contLastSeenExpr:i,contNameExpr:s}];t.tmpl("groupMemberSearchTemplate",r).appendTo("#mck-group-member-search-list")},e.loadCreateGroupTab=function(){S.removeClass("vis").addClass("n-vis"),h.removeClass("vis").addClass("n-vis"),v.removeClass("vis").addClass("n-vis"),p.removeClass("vis").addClass("n-vis"),V.removeClass("vis").addClass("n-vis"),J.data("iconurl",""),N.html(""),W.removeClass("n-vis"),Z.html(MCK_LABELS["add.group.icon"]),J.html(at.getGroupDefaultIcon()),T.removeClass("n-vis").addClass("vis")},e.loadGroupInfo=function(t){if(t.groupId){q.attr("contenteditable",!1),k.removeClass("vis").addClass("n-vis"),f.removeClass("n-vis").addClass("vis"),S.removeClass("vis").addClass("n-vis"),v.removeClass("vis").addClass("n-vis"),K.removeClass("vis").addClass("n-vis"),T.removeClass("vis").addClass("n-vis"),z.removeClass("vis").addClass("n-vis"),H.removeClass("vis").addClass("n-vis"),p.data("mck-id",t.groupId),Y.data("iconurl",""),t.conversationId&&p.data("mck-conversation-id",t.conversationId),w.html("");var a=st.getGroup(t.groupId);"object"==typeof a?(Y.html(at.getGroupImage(a.imageUrl)),q.html(a.displayName),e.addMembersToGroupInfoList(a),a.adminName===be?F.removeClass("n-vis").addClass("vis"):F.removeClass("vis").addClass("n-vis")):at.getGroupFeed({groupId:t.groupId,apzCallback:ot.onGroupFeed})}},e.sortGroupMemberHtmlList=function(){t("#mck-group-member-list .mck-li-group-member").sort(function(e,t){return e.dataset.alpha>t.dataset.alpha}).appendTo("#mck-group-member-list")},e.addGroupMemberFromSearch=function(e){var t=p.data("mck-id");if(void 0!==t&&void 0!==e){var a=st.getGroup(t);"object"==typeof a&&be===a.adminName?(ft.loadUserProfile(e),at.addGroupMember({groupId:t,userId:e,apzCallback:ot.onAddedGroupMember})):P.removeClass("vis").addClass("n-vis")}j.mckModal("hide")}},nt=new function(){var e=this,a=["CREATE","UPDATE"],o=t("#mck-file-box"),n=t(".mck-overlay"),i=t("#mck-msg-sbmt"),r=t("#mck-text-box"),l=t("#mck-file-input"),d=t("#mck-autosuggest-search-input"),u=t(".mck-overlay-box"),v=t(".mck-file-upload"),g=t("#mck-group-icon-upload"),f=t("#mck-group-icon-change"),k=t("#mck-group-info-icon-box"),C=t("#mck-btn-group-icon-save"),h=t("#mck-message-cell .mck-message-inner"),b=t("#mck-group-create-icon-box"),y=t("#mck-group-info-icon-loading"),I=t("#mck-group-create-icon-loading"),M=t("#mck-group-info-icon-box .mck-group-icon"),E=t("#mck-group-create-icon-box .mck-group-icon"),T=t("#mck-gc-overlay-label");e.init=function(){t.template("fileboxTemplate",'<div id="mck-filebox-${fileIdExpr}" class="mck-file-box ${fileIdExpr}"><div class="mck-file-expr"><span class="mck-file-content blk-lg-8"><span class="mck-file-lb">{{html fileNameExpr}}</span>&nbsp;<span class="mck-file-sz">${fileSizeExpr}</span></span><span class="km-progress km-progress-striped active blk-lg-3" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><span class="km-progress-bar km-progress-bar-success km-bar" stye></span></span><span class="move-right"><button type="button" class="mck-attach-icon mck-box-close mck-remove-file" data-dismiss="div" aria-hidden="true">x</button></span></div></div>'),Kommunicate.attachEvents(t),v.on("click",function(e){e.preventDefault(),l.trigger("click")}),g.on("change",function(){var s=t(this)[0].files[0];return e.uplaodFileToAWS(s,a[0]),!1}),f.on("change",function(){var s=t(this)[0].files[0];return e.uplaodFileToAWS(s,a[1]),!1}),l.on("change",function(){var e=t(this)[0].files[0],a=h.data("mck-id");if(-1!=e.type.indexOf("image/"))Kommunicate.attachmentService.getFileMeta(e,a,function(e,t,a){p=e,rt.sendMessage(t,a,function(e){t.key=e.key;var s={};s.file=a,s.name=a.name,Kommunicate.attachmentService.uploadAttachment(s,t,Ce)})});else{var s={};s.file=e,s.name=e.name,Kommunicate.attachmentService.uploadAttachment(s,null,Ce)}}),t(s).on("click",".mck-remove-file",function(){var e=t(this).parents(".mck-file-box"),a=e.data("mckfile");e.remove(),i.attr("disabled",!1),0===o.find(".mck-file-box").length&&(o.removeClass("vis").addClass("n-vis"),r.attr("required","")),"object"==typeof a&&(mt.deleteFileMeta(a.blobKey),t.each(p,function(e,t){void 0!==t&&t.blobKey===a.blobKey&&p.splice(e,1)}))}),d.on("keydown input",function(t){r.text(d.val()),13===t.which&&(r.submit(),t.preventDefault()),e.resizeTextarea(this),"KM_AUTO_SUGGEST"!=d.data("origin")&&""!=d.data("source-url")&&it.populateAutoSuggest({sourceUrl:d.data("source-url"),method:d.data("method"),headers:d.data("headers")})})},e.resizeTextarea=function(e){var a=e.offsetHeight-e.clientHeight;t(e).css("height","auto").css("height",e.scrollHeight+a)},e.audioRecoder=function(t){"awsS3Server"===Ce?e.uploadAttachment2AWS(t):"googleCloud"===Ce?e.customFileUpload(t):e.uploadFile(t)},e.customFileUpload=function(e,a){var s=e.file,n=!1,l=new FormData,d=[];if(void 0!==s){if(t(".mck-file-box").length>4&&d.push("Can't upload more than 5 files at a time"),s.size>1048576*ae&&d.push("file size can not be more than "+ae+" MB"),!(d.length>0)){var u=Xe.randomId(),g=[{fileIdExpr:u,fileName:e.name,fileNameExpr:'<a href="#" target="_self" >'+e.name+"</a>",fileSizeExpr:mt.getFilePreviewSize(s.size)}];t.tmpl("fileboxTemplate",g).appendTo("#mck-file-box");var f=t(".mck-file-box."+u),k=t(".mck-file-box."+u+" .mck-file-lb"),C=t(".mck-file-box."+u+" .km-progress .km-bar"),b=t(".mck-file-box."+u+" .km-progress"),y=t(".mck-file-box."+u+" .mck-remove-file");if(C.css("width","0%"),a&&Kommunicate.attachmentEventHandler.progressMeter(0,a.key),b.removeClass("n-vis").addClass("vis"),y.attr("disabled",!0),v.attr("disabled",!0),KommunicateUI.hideFileBox(s,o,v),e.name===t(".mck-file-box."+u+" .mck-file-lb a").html()){var I=h.data("mck-id"),M=e.name+s.size;qe[M]=I,i.attr("disabled",!0),l.append("files[]",s);var E=new XMLHttpRequest;(E.upload||E).addEventListener("progress",function(e){var t=parseInt(e.loaded/e.total*100,10);C.css("width",t+"%"),a&&Kommunicate.attachmentEventHandler.progressMeter(t,a.key)}),E.addEventListener("load",function(e){var s=t.parseJSON(this.responseText);if("object"==typeof s){var o=s.fileMeta;if(a){a.fileMeta=o;var c={tabId:a.groupId};return n=KommunicateUI.getAttachmentStopUploadStatus(a.key),KommunicateUI.updateAttachmentTemplate(o,a.key),!n&&rt.submitMessage(a,c),void KommunicateUI.updateImageAttachmentPreview(o,a.key)}var l="object"==typeof o?'<a href="'+o.url+'" target="_blank">'+o.name+"</a>":"",d=o.name,m=o.size,u=h.data("mck-id"),g=d+m,C=qe[g];return I!==u?(it.updateDraftMessage(C,o),void delete qe[g]):(y.attr("disabled",!1),v.attr("disabled",!1),i.attr("disabled",!1),delete qe[g],k.html(l),b.removeClass("vis").addClass("n-vis"),t(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),p.push(o),f.data("mckfile",o),v.children("input").val(""),!1)}y.attr("disabled",!1),i.attr("disabled",!1),y.trigger("click")});var T=K+"/files/upload/";E.open("post",T,!0),E.setRequestHeader("UserId-Enabled",!0),E.setRequestHeader("Authorization","Basic "+c),E.setRequestHeader("Application-Key",N),E.setRequestHeader("Device-Key",m),Z&&E.setRequestHeader("Access-Token",Z),E.send(l)}return!1}alert(d.toString())}},e.uploadAttachemnt=function(t,a){"awsS3Server"===Ce?e.uploadAttachment2AWS(t,a):"googleCloud"===Ce?e.customFileUpload(t,a):e.uploadFile(t,a)},e.uploadFile=function(e,a){var s=e.file,n=new Object,c=!1,l=[];if(void 0!==s){if(t(".mck-file-box").length>4&&l.push("Can't upload more than 5 files at a time"),s.size>1048576*ae&&l.push("file size can not be more than "+ae+" MB"),!(l.length>0)){var d=Xe.randomId(),m=[{fileIdExpr:d,fileName:e.name,fileNameExpr:'<a href="#" target="_self" >'+e.name+"</a>",fileSizeExpr:mt.getFilePreviewSize(s.size)}];t.tmpl("fileboxTemplate",m).appendTo("#mck-file-box");var u=t(".mck-file-box."+d),g=t(".mck-file-box."+d+" .mck-file-lb"),f=t(".mck-file-box."+d+" .km-progress .km-bar"),k=t(".mck-file-box."+d+" .km-progress"),C=t(".mck-file-box."+d+" .mck-remove-file");if(f.css("width","0%"),a&&Kommunicate.attachmentEventHandler.progressMeter(0,a.key),k.removeClass("n-vis").addClass("vis"),C.attr("disabled",!0),v.attr("disabled",!0),KommunicateUI.hideFileBox(s,o,v),e.name===t(".mck-file-box."+d+" .mck-file-lb a").html()){var b=h.data("mck-id"),y=e.name+s.size;qe[y]=b,i.attr("disabled",!0),n.files=[],n.files.push(s);var I=new XMLHttpRequest;(I.upload||I).addEventListener("progress",function(e){var t=parseInt(e.loaded/e.total*100,10);f.css("width",t+"%"),a&&Kommunicate.attachmentEventHandler.progressMeter(t,a.key)}),I.addEventListener("load",function(e){var s=t.parseJSON(this.responseText);if("object"==typeof s.fileMeta){var o=s.fileMeta;if(a){a.fileMeta=o;var n={tabId:a.groupId};return c=KommunicateUI.getAttachmentStopUploadStatus(a.key),KommunicateUI.updateAttachmentTemplate(o,a.key),!c&&rt.submitMessage(a,n),void KommunicateUI.updateImageAttachmentPreview(o,a.key)}var l=mt.getFilePreviewPath(o);o.url=H+"/rest/ws/aws/file/"+o.blobKey;var d=o.name,m=o.size,f=h.data("mck-id"),y=d+m,I=qe[y];return b!==f?(it.updateDraftMessage(I,o),void delete qe[y]):(C.attr("disabled",!1),v.attr("disabled",!1),i.attr("disabled",!1),delete qe[y],g.html(l),k.removeClass("vis").addClass("n-vis"),t(".mck-file-box .km-progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),p.push(o),u.data("mckfile",o),v.children("input").val(""),!1)}C.attr("disabled",!1),i.attr("disabled",!1),C.trigger("click")}),t.ajax({type:"GET",url:H+"/rest/ws/aws/file/url",global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(e){var t=new FormData;t.append("files[]",s),I.open("POST",e,!0),I.send(t)},error:function(){}})}return!1}alert(l.toString())}},e.uploadAttachment2AWS=function(e,a){var s=e.file,n=new FormData,l=[],d=!1;if(void 0!==s){if(t(".mck-file-box").length>4&&l.push("Can't upload more than 5 files at a time"),s.size>1048576*ae&&l.push("file size can not be more than "+ae+" MB"),!(l.length>0)){var u=Xe.randomId(),g=[{fileIdExpr:u,fileName:e.name,fileNameExpr:'<a href="#" target="_self" >'+e.name+"</a>",fileSizeExpr:mt.getFilePreviewSize(s.size)}];t.tmpl("fileboxTemplate",g).appendTo("#mck-file-box");var f=t(".mck-file-box."+u),k=t(".mck-file-box."+u+" .mck-file-lb"),C=t(".mck-file-box."+u+" .km-progress .km-bar"),b=t(".mck-file-box."+u+" .km-progress"),y=t(".mck-file-box."+u+" .mck-remove-file");if(C.css("width","0%"),a&&Kommunicate.attachmentEventHandler.progressMeter(0,a.key),b.removeClass("n-vis").addClass("vis"),y.attr("disabled",!0),v.attr("disabled",!0),KommunicateUI.hideFileBox(s,o,v),e.name===t(".mck-file-box."+u+" .mck-file-lb a").html()){var I=h.data("mck-id"),M=e.name+s.size;qe[M]=I,i.attr("disabled",!0),n.append("file",s);var E=new XMLHttpRequest;(E.upload||E).addEventListener("progress",function(e){var t=parseInt(e.loaded/e.total*100,10);C.css("width",t+"%"),a&&Kommunicate.attachmentEventHandler.progressMeter(t,a.key)}),E.addEventListener("load",function(e){var s=t.parseJSON(this.responseText);if("object"==typeof s){var o=s;if(a){a.fileMeta=o;var n={tabId:a.groupId};return d=KommunicateUI.getAttachmentStopUploadStatus(a.key),KommunicateUI.updateAttachmentTemplate(o,a.key),!d&&rt.submitMessage(a,n),void KommunicateUI.updateImageAttachmentPreview(o,a.key)}var c="object"==typeof o?'<a href="'+o.url+'" target="_blank">'+o.name+"</a>":"",l=o.name,m=o.size,u=h.data("mck-id"),g=l+m,C=qe[g];return I!==u?(it.updateDraftMessage(C,o),void delete qe[g]):(y.attr("disabled",!1),v.attr("disabled",!1),i.attr("disabled",!1),delete qe[g],k.html(c),b.removeClass("vis").addClass("n-vis"),t(".mck-file-box .km-progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),p.push(o),f.data("mckfile",o),v.children("input").val(""),!1)}y.attr("disabled",!1),i.attr("disabled",!1),y.trigger("click")});var T=MCK_BASE_URL+"/rest/ws/upload/image";E.open("post",T,!0),E.setRequestHeader("UserId-Enabled",!0),E.setRequestHeader("Authorization","Basic "+c),E.setRequestHeader("Application-Key",N),E.setRequestHeader("Device-Key",m),Z&&E.setRequestHeader("Access-Token",Z),E.send(n)}return!1}alert(l.toString())}},e.uplaodFileToAWS=function(e,t){var s=new FormData,o=[];if(void 0!==e)if(-1===e.type.indexOf("image")&&o.push("Please upload image file."),o.length>0)alert(o.toString());else{n.attr("disabled",!0),a[0]===t?(b.find(".mck-overlay-box").removeClass("n-vis"),b.removeClass("mck-hover-on"),I.removeClass("n-vis").addClass("vis")):(k.find(".mck-overlay-box").removeClass("n-vis"),k.removeClass("mck-hover-on"),y.removeClass("n-vis").addClass("vis"));var i=new XMLHttpRequest;i.addEventListener("load",function(e){var s=this.responseText;return s&&(a[0]===t?(E.html('<img src="'+s+'"/>'),E.data("iconurl",s),T.html(MCK_LABELS["change.group.icon"]),I.removeClass("vis").addClass("n-vis"),b.addClass("mck-hover-on")):(M.html('<img src="'+s+'"/>'),M.data("iconurl",s),y.removeClass("vis").addClass("n-vis"),k.addClass("mck-hover-on"),setTimeout(function(){C.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){u.addClass("n-vis")},1500)),n.attr("disabled",!1),a[0]===t?g.val(""):f.val(""),!1}),s.append("file",e),i.open("post",MCK_BASE_URL+"/rest/ws/upload/file",!0),i.setRequestHeader("UserId-Enabled",!0),i.setRequestHeader("Authorization","Basic "+c),i.setRequestHeader("Application-Key",N),i.setRequestHeader("Device-Key",m),Z&&i.setRequestHeader("Access-Token",Z),i.send(s)}},e.addFileBox=function(e){var a=Xe.randomId(),s="";"object"==typeof e.fileMeta&&(a=e.fileMeta.createdAtTime,s=e.fileMeta.name);var o=[{fileNameExpr:e.filelb,fileSizeExpr:e.filesize,fileIdExpr:a,fileName:s}];t.tmpl("fileboxTemplate",o).appendTo("#mck-file-box");var n=t(".mck-file-box."+a),c=n.find(".mck-remove-file"),l=n.find(".progress");"object"==typeof e.fileMeta?(n.data("mckblob",e.fileMeta.blobKey),r.removeAttr("required"),i.attr("disabled",!1),c.attr("disabled",!1),l.removeClass("vis").addClass("n-vis"),p.push(e.fileMeta)):(i.attr("disabled",!0),c.attr("disabled",!0),l.removeClass("n-vis").addClass("vis"))}},it=new function(){var o=this,n="",i=t("#mck-search"),r=t("#mck-msg-to"),c=t(".mck-file-lb"),l=t(".mck-file-sz"),d=t("#mck-sidebox"),m=t("#mck-file-box"),u=t("#mck-msg-sbmt"),v=t("#mck-msg-form"),f=t("#mck-text-box"),b=t("#mck-msg-error"),y=(t("#mck-show-more"),t("#mck-tab-title")),T=t("#mck-tab-status"),A=t("#mck-message-cell"),_=t(".mck-typing-box"),K=(t("#mck-no-messages"),t("#mck-product-box")),N=t(".mck-product-icon"),G=t(".mck-product-title"),O=t(".mck-product-subtitle"),R=t("#mck-product-box .mck-caret"),D=t(".mck-product-rt-up .mck-product-key"),P=t("#mck-contact-search-input-box"),F=t(".mck-product-rt-up .mck-product-value"),j=t(".mck-product-rt-down .mck-product-key"),Y=t(".mck-product-rt-down .mck-product-value"),J=(t("#li-mck-group-info"),t("#li-mck-leave-group"),t("#mck-group-info-tab")),Z=t("#mck-group-search-tab"),X=t("#mck-no-search-groups"),te=t("#mck-group-create-tab"),ae=t("#mck-group-search-list"),se=(t("#mck-group-search-tabview"),t(".mck-group-menu-options")),oe=t(".mck-videocall-btn"),ie=t("#mck-group-search-input"),re=t("#mck-group-search-input-box"),de=t("#mck-contact-search-list"),ue=t("#mck-contacts-content"),pe=t("#mck-contact-search-tab"),ve=(t("#mck-contact-search-tabview"),t("#mck-contact-search-input")),ke=t("#mck-autosuggest-search-input"),Ce=t("#mck-autosuggest-metadata"),he=(t("#mck-search-list"),t("#mck-no-search-contacts")),ye=t("#mck-search-tab-box li a"),Ie=t("#mck-search-tabview-box"),Ae=t("#mck-sidebox-search"),Le=t("#mck-contact-loading"),_e=t("#mck-typing-label"),we=t("#mck-price-widget"),Ne=t("#mck-msg-response"),Ge=t("#mck_response_text"),Be=t("#li-mck-block-user"),ze=t("#li-mck-video-call"),Pe=t("#mck-search-loading"),Fe=t("#mck-tab-individual"),$e=t("#mck-attachfile-box"),qe=t("#mck-location-sharing-box"),et=t("#mck-sidebox-content"),ut=t("#mck-tab-option-panel"),pt=t("#mck-tab-conversation"),vt=t("#mck-conversation-header"),gt=(t("#mck-no-conversations"),t("#mck-conversation-list")),Ct=t(".mck-tab-message-option"),ht=t(".mck-box-ft .mck-box-form"),bt=t("#mck-btn-clear-messages"),yt=t("#mck-offline-message-box"),It=t("#mck-message-cell .mck-message-inner"),Mt=(t("#mck-msg-new"),new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi));o.init=function(){t.template("convTemplate",'<li id="li-${convIdExpr}" class="${convIdExpr}"><a class="${mckLauncherExpr}" href="#" data-mck-conversationid="${convIdExpr}" data-mck-id="${tabIdExpr}" data-isgroup="${isGroupExpr}" data-mck-topicid="${topicIdExpr}" data-isconvtab="true"><div class="mck-row mck-truncate" title="${convTitleExpr}">${convTitleExpr}</div></a></li>'),t.template("messageTemplate",'<div name="message" data-msgdelivered="${msgDeliveredExpr}" data-msgsent="${msgSentExpr}" data-msgtype="${msgTypeExpr}" data-msgtime="${msgCreatedAtTime}"data-msgcontent="${replyIdExpr}" data-msgkey="${msgKeyExpr}" data-contact="${toExpr}" class="mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"><div class="mck-clear"><div class="${nameTextExpr} ${showNameExpr} mck-conversation-name"><span class="mck-ol-status ${contOlExpr}"><span class="mck-ol-icon" title="${onlineLabel}"></span>&nbsp;</span>${msgNameExpr}</div><div class="blk-lg-12"><div class="mck-msg-avator blk-lg-3">{{html msgImgExpr}}</div><div class ="km-conversation-container-right"><div class="mck-msg-box ${msgClassExpr}" style= "background-color: ${msgBoxColor}"><div class="move-right mck-msg-text"></div><div class="mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"><div class="mck-msgto">${msgReplyTo} </div></div><div class="mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"><div class="mck-msgreply-border ${textreplyVisExpr}">${msgReply}</div><div class="mck-msgreply-border ${msgpreviewvisExpr}">{{html msgPreview}}</div></div><div class="mck-msg-text mck-msg-content notranslate"></div></div><div class="km-msg-box-attachment ${attachmentBoxExpr} ">{{html attachmentTemplate}}<div class="km-msg-box-progressMeter ${progressMeterClassExpr} ">{{html progressMeter}}</div></div><div class="mck-msg-box-rich-text-container notranslate ${kmRichTextMarkupVisibility} ${containerType}"><div class="email-message-indicator ${emailMsgIndicatorExpr}"><span><svg xmlns="http://www.w3.org/2000/svg" width="12" height="11" viewBox="0 0 12 11"><path fill="#BCBABA" fill-rule="nonzero" d="M12 3.64244378L7.82144281 0v2.08065889h-.0112584c-1.2252898.0458706-2.30872368.23590597-3.23022417.58877205-1.03614858.39436807-1.89047392.92952513-2.56710409 1.60169828-.53552482.53356847-.95771502 1.14100649-1.27501442 1.8173497-.08349984.17792235-.16437271.35624185-.23304899.54349718-.32987128.89954044-.56029331 1.87632619-.49311816 2.87991943C.02781163 9.76011309.1572833 10.5.30795828 10.5c0 0 .18801538-1.03695368.94795775-2.22482365.23267371-.36259621.50437656-.70533502.81698495-1.02186205l.0350887.03038182v-.06533086c.19420749-.19301397.40079923-.37828356.63497407-.54588006.63272238-.45433742 1.40748832-.8141536 2.32279668-1.0796471.74962217-.21763716 1.60432278-.34412883 2.54909064-.39019801h.20809286l-.00150112 2.08085746L12 3.64244378z"/></svg></span><span>via email</span></div>{{html kmRichTextMarkup}}</div><div class="${msgFloatExpr}-muted mck-text-light mck-text-xs mck-t-xs ${timeStampExpr} vis"><span class="mck-created-at-time notranslate">${createdAtTimeExpr}</span> <span class="mck-message-status notranslate"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17.06103 10.90199" width="24" height="24" class="${statusIconExpr} mck-message-status notranslate"><path fill="#859479" d="M16.89436.53548l-.57-.444a.434.434 0 0 0-.609.076l-6.39 8.2a.38.38 0 0 1-.577.039l-.427-.388a.381.381 0 0 0-.578.038l-.451.576a.5.5 0 0 0 .043.645l1.575 1.51a.38.38 0 0 0 .577-.039l7.483-9.6a.436.436 0 0 0-.076-.609z" class="mck-delivery-report--delivered-read"></path><path fill="#859479" d="M12.00236.53548l-.57-.444a.434.434 0 0 0-.609.076l-6.39 8.2a.38.38 0 0 1-.577.039l-2.614-2.558a.435.435 0 0 0-.614.007l-.505.516a.435.435 0 0 0 .007.614l3.887 3.8a.38.38 0 0 0 .577-.039l7.483-9.6A.435.435 0 0 0 12.00109.536l-.00073-.00052z"  class="mck-delivery-report--sent"></path><path fill="#859479" d="M9.75 7.713H8.244V5.359a.5.5 0 0 0-.5-.5H7.65a.5.5 0 0 0-.5.5v2.947a.5.5 0 0 0 .5.5h.094l.003-.001.003.002h2a.5.5 0 0 0 .5-.5v-.094a.5.5 0 0 0-.5-.5zm0-5.263h-3.5c-1.82 0-3.3 1.48-3.3 3.3v3.5c0 1.82 1.48 3.3 3.3 3.3h3.5c1.82 0 3.3-1.48 3.3-3.3v-3.5c0-1.82-1.48-3.3-3.3-3.3zm2 6.8a2 2 0 0 1-2 2h-3.5a2 2 0 0 1-2-2v-3.5a2 2 0 0 1 2-2h3.5a2 2 0 0 1 2 2v3.5z" class="mck-delivery-report--pending"></path></svg><p class="mck-sending-failed">Sending failed</p></span></div></div></div></div><div class="n-vis mck-context-menu"><ul><li><a class="mck-message-forward ${msgForwardVisibleExpr}">${msgForwardExpr}</a></li><li><a class="mck-message-delete">${msgDeleteExpr}</a></li><li><a class="mck-message-reply">${msgReplyExpr}</a></li></ul></div></div>'),t.template("contactTemplate",'<li id="li-${contHtmlExpr}" class="${contIdExpr}" data-msg-time="${msgCreatedAtTimeExpr}"><a class="${mckLauncherExpr}" href="#" data-mck-conversationid="${conversationExpr}" data-mck-id="${contIdExpr}" data-isgroup="${contTabExpr}"><div class="mck-row" title="${contNameExpr}"><div class="mck-conversation-topic mck-truncate ${contHeaderExpr}">${titleExpr}</div><div class="blk-lg-3">{{html contImgExpr}}<div class="mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"><span class="mck-unread-count-text">{{html contUnreadCount}}</span></div></div><div class="blk-lg-9"><div class="mck-row"><div class="blk-lg-8 mck-cont-name mck-truncate"><div class="mck-ol-status ${contOlExpr}"><span class="mck-ol-icon" title="${onlineLabel}"></span>&nbsp;</div><strong class="mck-truncate">${contNameExpr}</strong></div><div class="mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4">${msgCreatedDateExpr}</div></div><div class="mck-row"><div class="mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"></div></div></div></div></a></li>'),t.template("searchContactbox",'<li id="li-${contHtmlExpr}" class="${contIdExpr}"><a class="applozic-launcher" href="#" data-mck-id="${contIdExpr}" data-isgroup="${contTabExpr}"><div class="mck-row" title="${contNameExpr}"><div class="blk-lg-3">{{html contImgExpr}}</div><div class="blk-lg-9"><div class="mck-row"><div class="blk-lg-12 mck-cont-name mck-truncate"><strong>${contNameExpr}</strong><div class="move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}">${groupUserCountExpr}</div></div><div class="blk-lg-12 mck-text-muted">${contLastSeenExpr}</div></div></div></div></a></li>')},o.openConversation=function(){"none"===d.css("display")&&(t(".mckModal").mckModal("hide"),d.mckModal()),r.focus()},o.initEmojis=function(){try{t("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(e){n||(n=setTimeout(function(){o.initEmojis()},3e4))}},o.handleLoadTab=function(){if("v2"===L){var e=parent.document.getElementById("kommunicate-widget-iframe");e.style.boxShadow="0 1.5rem 2rem rgba(0,0,0,.3)",Kommunicate.setDefaultIframeConfigForOpenChat()}},o.loadTab=function(e,s){o.handleLoadTab(),clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM),MCK_MAINTAIN_ACTIVE_CONVERSATION_STATE&&e.isGroup&&e.tabId&&KommunicateUtils.setItemToLocalStorage("mckActiveConversationInfo",{groupId:e.tabId});var n=It.data("mck-id");if(n)if(f.html().length>1||m.hasClass("vis")){var i=f.html(),c={text:i,files:[]};m.hasClass("vis")&&t(".mck-file-box").each(function(){var e=t(this),a={filelb:e.find(".mck-file-lb").html(),filesize:e.find(".mck-file-sz").html()},s=e.data("mckfile");"object"==typeof s&&(a.fileMeta=s),c.files.push(a)}),Ve[n]=c}else delete Ve[n];if(k=!0,o.clearMessageField(!1),o.addDraftMessage(e.tabId),b.html(""),b.removeClass("vis").addClass("n-vis"),Ge.html(""),Ne.removeClass("vis").addClass("n-vis"),v[0].reset(),v.removeClass("n-vis").addClass("vis"),It.html(""),b.removeClass("mck-no-mb"),ue.removeClass("n-vis").addClass("vis"),ht.removeClass("vis").addClass("n-vis"),t("#mck-sidebox-ft").removeClass("vis").addClass("n-vis"),Ae.removeClass("vis").addClass("n-vis"),J.removeClass("vis").addClass("n-vis"),te.removeClass("vis").addClass("n-vis"),et.removeClass("n-vis").addClass("vis"),K.removeClass("vis").addClass("n-vis"),vt.addClass("n-vis"),Le.removeClass("vis").addClass("n-vis"),It.removeClass("mck-group-inner"),T.removeClass("vis").addClass("n-vis"),y.removeClass("mck-tab-title-w-status"),y.removeClass("mck-tab-title-w-typing"),_.removeClass("vis").addClass("n-vis"),_e.html(MCK_LABELS.typing),It.data("isgroup",e.isGroup),It.data("datetime",""),e.tabId){if(r.val(e.tabId),It.data("mck-id",e.tabId),It.data("mck-conversationid",e.conversationId),It.data("mck-topicid",e.topicId),ut.data("tabId",e.tabId),ut.removeClass("n-vis").addClass("vis"),ue.removeClass("vis").addClass("n-vis"),ht.removeClass("n-vis").addClass("vis"),t("#mck-sidebox-ft").removeClass("n-vis").addClass("vis"),bt.removeClass("n-vis").addClass("vis"),se.removeClass("vis").addClass("n-vis"),e.isGroup?(It.addClass("mck-group-inner"),Be.removeClass("vis").addClass("n-vis"),ze.removeClass("vis").addClass("n-vis"),oe.removeClass("vis").addClass("n-vis"),KommunicateUI.activateTypingField()):(Be.removeClass("n-vis").addClass("vis"),ze.removeClass("n-vis").addClass("vis"),q&&oe.removeClass("n-vis").addClass("vis")),!e.topicId&&e.conversationId){var l=E[e.conversationId];"object"==typeof l&&(e.topicId=l.topicId)}if(e.topicId){var d=I[e.topicId];"object"==typeof d&&(Ke?(It.data("mck-title",d.title),vt.html(d.title),vt.removeClass("n-vis")):Me&&(o.setProductProperties(d,e.topicId),R.addClass("n-vis"),K.addClass("mck-product-box-wc"),gt.addClass("n-vis"),K.removeClass("n-vis").addClass("vis")))}$&&a.google&&"object"==typeof a.google.maps?($e.removeClass("vis").addClass("n-vis"),qe.removeClass("n-vis").addClass("vis")):(qe.removeClass("vis").addClass("n-vis"),$e.removeClass("n-vis").addClass("vis")),o.isGroupDeleted(e.tabId,e.isGroup)&&(b.html(MCK_LABELS["group.deleted"]),b.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),v.removeClass("vis").addClass("n-vis")),pt.removeClass("vis").addClass("n-vis"),Ie.removeClass("vis").addClass("n-vis"),Fe.removeClass("n-vis").addClass("vis"),"support"===w&&t(".mck-tab-link").removeClass("vis").addClass("n-vis"),le&&(we.removeClass("n-vis").addClass("vis"),It.addClass("mck-msg-w-panel")),B&&(b.html("Deactivated"),b.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),v.removeClass("vis").addClass("n-vis"));var u=e.isGroup?e.tabId:be;Lt.subscibeToTypingChannel(u,e.isGroup),"function"==typeof ee&&ee({tabId:e.tabId,isGroup:e.isGroup})}else{e.tabId="",Se&&it.hideOfflineMessage(),Fe.removeClass("vis").addClass("n-vis"),pt.removeClass("n-vis").addClass("vis"),Ie.removeClass("n-vis").addClass("vis"),K.removeClass("vis").addClass("n-vis"),It.data("mck-id",""),It.data("mck-conversationid",""),It.data("mck-topicid",""),we.removeClass("vis").addClass("n-vis"),It.removeClass("mck-msg-w-panel"),ut.removeClass("vis").addClass("n-vis"),bt.removeClass("vis").addClass("n-vis"),r.val("");var p=ALStorage.getLatestMessageArray();if(Lt.unsubscibeToTypingChannel(),null!==p&&p.length>0)return e.isReload=!0,it.addContactsFromMessageList({message:p},e),o.openConversation(),void(k=!1)}rt.loadMessageList(e,s),o.openConversation()},o.setProductProperties=function(e,t){G.html(e.title),N.html(o.getTopicLink(e.link));var a=e.subtitle?e.subtitle:"";O.html(a);var s=e.key1?e.key1:"",n=e.value1?":"+e.value1:"";D.html(s),F.html(n);var i=e.key2?e.key2:"",r=e.value2?":"+e.value2:"";j.html(i),Y.html(r),"function"==typeof V&&(e.topicId=t,V(e))},o.getTopicLink=function(e){return e?'<img src="'+e+'">':'<span class="mck-icon-no-image"></span>'},o.processMessageList=function(e,a,s){var n,i=It.children("div[name='message']:first"),r=It.data("mck-id"),c=It.data("isgroup"),l=c?st.getGroup(r):it.fetchContact(r);if(void 0===e.message.length){var d=[];d.push(e.message),ALStorage.updateMckMessageArray(d),o.addMessage(e.message,l,!1,!1,s),n=e.createdAtTime}else ALStorage.updateMckMessageArray(e.message),t.each(e.message,function(e,t){void 0!==t.to&&(o.addMessage(t,l,!1,!1,s),Kommunicate.appendEmailToIframe(t),n=t.createdAtTime)});ut.data("datetime",n),!a&&i.length>0?It.scrollTop(i.offset().top-It.offset().top+It.scrollTop()):a&&It.animate({scrollTop:It.prop("scrollHeight")},"slow")},o.closeConversation=function(e){if("function"==typeof W){var t=W();if("object"==typeof t)var a="BUSY_WITH_OTHER"===e?t.onBusyWithOtherUser:t.onConversationClose}a||(a="Chat disabled with user"),b.html(a),b.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),v.removeClass("vis").addClass("n-vis")},o.addTooltip=function(e){t("."+e+" .mck-pending-icon").attr("title","pending"),t("."+e+" .mck-btn-trash").attr("title","delete"),t("."+e+" .mck-sent-icon").attr("title","sent"),t("."+e+" .mck-btn-forward").attr("title","forward message"),t("."+e+" .mck-delivered-icon").attr("title","delivered"),t("."+e+" .mck-read-icon").attr("title","delivered and read"),t("."+e+" .msgtype-outbox-cr").attr("title","sent via Carrier"),t("."+e+" .msgtype-outbox-mck").attr("title","sent"),t("."+e+" .msgtype-inbox-cr").attr("title","received via Carrier"),t("."+e+" .msgtype-inbox-mck").attr("title","recieved")},o.fetchContact=function(e){var t=o.getContact(e);return void 0===t&&(t=o.createContact(e)),t},o.getContact=function(e){return"object"==typeof g[e]?g[e]:void 0},o.getContactDisplayName=function(e){if("string"==typeof Ye[e])return Ye[e];if(void 0===Ye[e]){var t=ft.MCK_USER_DETAIL_MAP[e];return void 0!==t?t.displayName:void 0}},o.sendUserEmail=function(){if(document.getElementById("input-for-email").value.length>1){var e=document.getElementById("input-for-email").value;ct.updateUser({data:{email:e},success:function(e){console.log("email updated successfully !"),t("#input-for-email").after("<div style='width: 100px; margin: auto;'><span>Email Sent</span></div>"),t("#input-for-email").remove(),t("#send-email-button").remove()},error:function(e){}})}else alert("No email")},o.updateMetadata=function(e,t){var s=a.JSON.stringify({key:e,metadata:t});Xe.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",global:!1,data:s,contentType:"application/json",success:function(e){console.log("metadata cleared successfully !")}})},o.addMessage=function(e,n,i,r,c){var l="",d="",m="",u="vis",p="n-vis",v="",g="n-vis",k="n-vis",C="vis",h="n-vis",b="n-vis";if("object"==typeof e.metadata&&void 0!==e.metadata.AL_REPLY&&(l=e.metadata.AL_REPLY,void 0!==(d=dt.getReplyMessageByKey(l))&&((n.isGroup&&d||!n.isGroup&&void 0===d.fileMeta)&&(g="vis"),v=5===d.type?"You":it.getTabDisplayName(d.to,!1),"object"!=typeof d.fileMeta&&2!==d.contentType||(m=o.getImageForReplyMessage(d),u="n-vis",p="vis",g="n-vis"))),6!==e.type&&7!==e.type&&!(e.metadata&&"HIDDEN"===e.metadata.category||102===e.contentType||e.metadata&&(e.metadata.KM_ASSIGN||e.metadata.KM_STATUS)||10===e.contentType&&e.metadata&&"true"===e.metadata.hide||t("#mck-message-cell ."+e.key).length>0)){e.source==KommunicateConstants.MESSAGE_SOURCE.MAIL_INTERCEPTOR&&(k="vis",t(".email-conversation-indicator").addClass("vis").removeClass("n-vis")),e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.ATTACHMENT||e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.LOCATION?(C="n-vis",h="n-vis",b="vis"):C=e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.TEXT_HTML&&e.source==KommunicateConstants.MESSAGE_SOURCE.MAIL_INTERCEPTOR||e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.DEFAULT&&"string"!=typeof e.message?"n-vis":"vis";var y="mck-msg-right",M="",T="mck-pending-icon",S="mck-timestamp-"+e.key;0!==e.type&&4!==e.type&&6!==e.type||(y="mck-msg-left"),4!==e.contentType&&10!==e.contentType&&103!==e.contentType||(y="mck-msg-center"),"mck-msg-right"===y&&x&&x.primaryColor&&(M=x.primaryColor),T=o.getStatusIconName(e);var A=e.key,L="'"+e.deviceKey+"','"+e.to+"','"+e.to+"','"+A+"'",_="",w="",K="",U="n-vis",N="";if(ft.loadUserProfile(e.to),!e.groupId||4===e.contentType||7===n.type||0!==e.type&&4!==e.type&&6!==e.type||(_=o.getTabDisplayName(e.to,!1),U="vis",K=o.getNameTextClassByAlphabet(_)),Te){N="mck-msg-avator-bubble";var G="",O=_;"mck-msg-right"===y?(G=it.fetchContact(be),O=o.getTabDisplayName(G.displayName,!1)):"mck-msg-left"===y&&(G=e.groupId?it.fetchContact(e.to):n),G&&(w=o.getContactImageLink(G,O))}e.groupId&&10===e.contentType&&(_="",w="",K="");var R="n-vis",D="",B="",z=e.message;"object"==typeof e.fileMeta&&(D=e.fileMeta.name,B=e.fileMeta.size),"object"==typeof e.fileMeta&&(e.fileMeta.contentType.indexOf("audio")||e.fileMeta.contentType.indexOf("image")||e.fileMeta.contentType.indexOf("video"))&&(R="vis");var P="n-vis";Ee&&a.MCK_OL_MAP[e.to]&&10!==e.contentType&&(P="vis");var F=Kommunicate.isRichTextMessage(e.metadata)||3==e.contentType,$=F?"vis":"n-vis",q=F?Kommunicate.getRichTextMessageTemplate(e):"",H=Kommunicate.getContainerTypeForRichMessage(e),j=Kommunicate.isAttachment(e),V=j?Kommunicate.messageTemplate.getAttachmentContanier(e,it.getFilePath(e),mt.getFileAttachment(e),mt.getFileurl(e)):"";if(e.contentType==KommunicateConstants.MESSAGE_CONTENT_TYPE.ATTACHMENT){var h=j?"n-vis":"vis";b=j?"vis":"n-vis";var Y=!j||e.fileMeta.url||e.fileMeta.blobKey?"":Kommunicate.messageTemplate.getProgressMeterContanier(e.key)}var J=[{msgReply:d?d.message+"\n":"",msgReplyTo:d?v+"\n":"",msgReplyDivExpr:d?"vis":"n-vis",msgReplyToVisibleExpr:g,msgPreview:m?o.getImageForReplyMessage(d):"",msgpreviewvisExpr:p,textreplyVisExpr:u,msgKeyExpr:e.key,msgDeliveredExpr:e.delivered,msgSentExpr:e.sent,msgCreatedAtTime:e.createdAtTime,msgTypeExpr:e.type,msgDeleteExpr:MCK_LABELS.delete,msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"kommunicate"==window.applozic.PRODUCT_ID?"n-vis":"vis",msgSourceExpr:e.source,statusIconExpr:T,contactExpr:"vis",toExpr:e.to||be,msgAvatorClassExpr:N,showNameExpr:U,msgNameExpr:_,msgImgExpr:w,nameTextExpr:K,msgFloatExpr:y,timeStampExpr:S,replyIdExpr:A,createdAtTimeExpr:mckDateUtils.getDate(e.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:L,downloadMediaUrlExpr:mt.getFileAttachment(e),msgClassExpr:C,msgBoxColor:M,progressMeterClassExpr:h,attachmentBoxExpr:b,msgExpr:z,selfDestructTimeExpr:e.timeToLive,fileMetaKeyExpr:e.fileMetaKey,downloadIconVisibleExpr:R,fileExpr:it.getFilePath(e),fileUrlExpr:mt.getFileurl(e),fileNameExpr:D,fileSizeExpr:B,contOlExpr:P,kmRichTextMarkupVisibility:$,kmRichTextMarkup:q,containerType:H,emailMsgIndicatorExpr:k,attachmentTemplate:V,progressMeter:Y}];if(i?t.tmpl("messageTemplate",J).appendTo("#mck-message-cell .mck-message-inner"):t.tmpl("messageTemplate",J).prependTo("#mck-message-cell .mck-message-inner"),(!e.metadata.obsolete||"true"!=e.metadata.obsolete)&&e.metadata.KM_AUTO_SUGGESTION){var W={};try{W=JSON.parse(e.metadata.KM_AUTO_SUGGESTION)}catch(e){console.error("suggestionList should be an array")}ke.addClass("mck-text-box").removeClass("n-vis"),f.removeClass("mck-text-box").addClass("n-vis"),ke.attr("placeholder",W.placeholder?W.placeholder:""),ke.data("prev-msgkey",e.key),nt.resizeTextarea(ke[0]),W.source.constructor==Array?(ke.data("origin","KM_AUTO_SUGGEST"),W.source.length&&it.populateAutoSuggest({source:W.source})):"object"==typeof W.source&&(ke.data("source-url",W.source.url),ke.data("method",W.source.method?W.source.method:"get"),ke.data("headers",W.source.headers?W.source.headers:{}))}if(23===e.contentType){if("BUTTON"===e.metadata.msg_type){var Z=[];if(e.metadata.payload){if(!(Z=t.parseJSON(e.metadata.payload))[0].hidden)var Q="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>"+Z[0].title+"</button></div>";if(Z.length>1)for(var X=1;X<Z.length;X++)Z[X].hidden||(Q+="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>"+Z[X].title+"</button></div>");t("div[data-msgkey='"+e.key+"'] .blk-lg-12").after(Q)}else{console.log("msg.contentType === 23 && metadata.msg_type === BUTTON");var Q="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>Button</button></div>";t("div[data-msgkey='"+e.key+"'] .blk-lg-12").after(Q)}}if("INPUT"===e.metadata.msg_type&&"false"===e.metadata.hidden){console.log("msg.contentType === 23 && metadata.msg_type === INPUT");var Q="<div style='float: left; margin: 13px; width: 100%'><input id='input-for-email' type='text' style='background-color: #FFF;width: 60%;height:35px;' placeholder='Enter your email...'/>";Q+="<button id='send-email-button' style='height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'>Submit</button></div>",t("div[data-msgkey='"+e.key+"'] .blk-lg-12").after(Q),t("#send-email-button").click(function(){document.getElementById("input-for-email").value.length>1&&(o.sendUserEmail(),o.updateMetadata(e.key,{hidden:"true"}))})}if("LIST"===e.metadata.msg_type){var Z=[];if(e.metadata.payload){Z=t.parseJSON(e.metadata.payload),console.log("msg.contentType === 23 && metadata.msg_type === LIST");var Q="";if(Z[0].hidden||("button"===Z[0].type.toLowerCase()?Q="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>"+Z[0].title+"</button></div>":"input"===Z[0].type.toLowerCase()&&(Q="<div style='float: left; margin: 13px; width: 100%'><input type='text' style='background-color: #FFF;width: 60%;height:35px;' placeholder='Enter your email...'/>",Q+="<button style='height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'>"+Z[0].title+"</button></div>")),Z.length>1)for(var X=1;X<Z.length;X++)Z[X].hidden||("button"===Z[X].type.toLowerCase()?Q+="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>"+Z[X].title+"</button></div>":"input"===Z[X].type.toLowerCase()&&(Q+="<div style='float: left; margin: 13px; width: 100%'><input type='text' style='background-color: #FFF;width: 60%;height:35px;' placeholder='Enter your email...'/>",Q+="<button style='height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'>"+Z[X].title+"</button></div>"));t("div[data-msgkey='"+e.key+"'] .blk-lg-12").after(Q)}}}var ee="";if(e.message){var te=e.message.replace(/\n/g,"<br/>");null!==a.emoji&&void 0!==a.emoji?(ee=a.emoji.replace_unified(te),ee=a.emoji.replace_colons(ee)):ee=te}if(e.conversationId){var ae=E[e.conversationId];if("object"!=typeof ae&&dt.getTopicId({conversationId:e.conversationId},function(e){it.populateMessage(e.messageType,e.message,e.notifyUser)}),i&&(It.data("mck-conversationid",e.conversationId),ae)){var se=I[ae.topicId];"object"==typeof se&&(Me?o.setProductProperties(se,ae.topicId):Ke&&vt.html(se.title))}}if(4===e.contentType){var oe=ee;ee="Final agreed price: "+ee,le||(ee+='<br/><button class="mck-accept" data-mck-topic-price="'+oe+'" data-mck-conversationid="'+e.conversationId+'">Accept</button>')}var ne=t("."+A+" .mck-msg-content");if(-1===ee.indexOf("emoji-inner")&&0===e.contentType)for(var ie=ee.split("<br/>"),X=0;X<ie.length;X++){if(""===ie[X])var re=s.createElement("BR");else{var re=s.createElement("div");re.appendChild(s.createTextNode(ie[X])),ie[X]&&ie[X].match(Mt)&&(re=t(re).linkify({target:"_blank"}))}ne.append(re)}else ne.html(ee),ne.linkify({target:"_blank"});if(F&&Kommunicate.richMsgEventHandler.initializeSlick(t("div[data-msgkey='"+e.key+"'] .km-div-slider")),e.fileMeta&&(t("."+A+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===ne.html()&&ne.removeClass("vis").addClass("n-vis")),2===e.contentType&&(ne.removeClass("vis").addClass("n-vis"),t("."+A+" .mck-file-text").removeClass("n-vis").addClass("vis")),r&&It.animate({scrollTop:It.prop("scrollHeight")},"slow"),Ct.hasClass("n-vis"))if(e.groupId){var ce=st.getGroup(e.groupId);6!==ce.type&&Ct.removeClass("n-vis").addClass("vis")}else Ct.removeClass("n-vis").addClass("vis");o.addTooltip(e.key),4!==e.contentType&&10!==e.contentType&&c&&o.messageContextMenu(e.key),e.groupId&&10===e.contentType&&i&&at.getGroupFeed({groupId:e.groupId,isReloadTab:!0,apzCallback:ot.onGroupFeed}),4===e.source&&t(".mck-msg-box-rich-text-container .km-faq-answer--body_ans").linkify({target:"_blank"})}},o.addContactForSearchList=function(e,s){var n=e.userCount,i=e.isGroup,r=o.getTabDisplayName(e.contactId,i),c=o.getContactImageLink(e,r),l=(i?e.contactId:e.contactId,i?"gs-group-"+e.htmlId:"cs-user-"+e.htmlId),d="",m=i&&xe;t("#li-"+l+" .mck-group-count-text").html(n),i||C[e.contactId]||(a.MCK_OL_MAP[e.contactId]?d=MCK_LABELS.online:M[e.contactId]&&(d=mckDateUtils.getLastSeenAtStatus(M[e.contactId])));var u=[{contHtmlExpr:l,contIdExpr:e.contactId,contTabExpr:e.isGroup,contImgExpr:c,contLastSeenExpr:d,contNameExpr:r,groupUserCountExpr:e.userCount,displayGroupUserCountExpr:m?"vis":"n-vis"}];t.tmpl("searchContactbox",u).prependTo("#"+s)},o.getFilePath=function(e){if(2===e.contentType)try{var a=t.parseJSON(e.message);if(a.lat&&a.lon)return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+a.lat+","+a.lon+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+a.lat+","+a.lon+"&maptype=roadmap&markers=color:red|"+a.lat+","+a.lon+"&key="+ge+'"/></a>'}catch(t){if(-1!==e.message.indexOf(","))return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+e.message+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+e.message+"&maptype=roadmap&markers=color:red|"+e.message+"&key="+ge+'" /></a>'}return"object"==typeof e.fileMeta?-1!==e.fileMeta.contentType.indexOf("image")?-1!==e.fileMeta.contentType.indexOf("svg")?'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox-kommunicate" data-type="'+e.fileMeta.contentType+'" data-url="'+mt.getFileurl(e)+'" data-name="'+e.fileMeta.name+'"><img src="'+H+"/rest/ws/aws/file/"+e.fileMeta.blobKey+'" area-hidden="true"></img></a>':5===e.contentType?'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox-kommunicate" data-type="'+e.fileMeta.contentType+'" data-url="'+e.fileMeta.blobKey+'" data-name="'+e.fileMeta.name+'"><img src="'+e.fileMeta.blobKey+'" area-hidden="true"></img></a>':e.fileMeta.hasOwnProperty("url")?e.fileMeta.hasOwnProperty("thumbnailBlobKey")?'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox-kommunicate" data-type="'+e.fileMeta.contentType+'" data-url="'+o.cloudupdate(e.fileMeta.BlobKey)+'" data-name="'+e.fileMeta.name+'"><img src="'+o.cloudupdate(e.fileMeta.thumbnailBlobKey)+'" area-hidden="true" ></img></a>':'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox-kommunicate" data-type="'+e.fileMeta.contentType+'" data-url="'+mt.getFileurl(e)+'" data-name="'+e.fileMeta.name+'"><img src="'+e.fileMeta.thumbnailUrl+'" area-hidden="true" ></img></a>':e.fileMeta.thumbnailUrl==="thumbnail_"+e.fileMeta.name?'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox-kommunicate" data-type="'+e.fileMeta.contentType+'" data-url="'+mt.getFileurl(e)+'" data-name="'+e.fileMeta.name+'"><img src="'+U+"/files/thumbnail_"+e.fileMeta.name+'" area-hidden="true" ></img></a>':'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox-kommunicate" data-type="'+e.fileMeta.contentType+'" data-url="'+mt.getFileurl(e)+'" data-name="'+e.fileMeta.name+'"><img src="'+e.fileMeta.thumbnailUrl+'" area-hidden="true" ></img></a>':-1!==e.fileMeta.contentType.indexOf("video")?'<a href= "#" target="_self"  ><video controls class="mck-video-player"><source src="'+mt.getFileurl(e)+'" type="video/mp4"><source src="'+mt.getFileurl(e)+'" type="video/ogg"></video></a>':-1!==e.fileMeta.contentType.indexOf("audio")?'<a href="#" target="_self" ><audio controls class="mck-audio-player"><source src="'+mt.getFileurl(e)+'" type="audio/ogg"><source src="'+mt.getFileurl(e)+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>':'<a href="#" role="link" class="file-preview-link" target="_blank"></a>':""},o.getImageForMessagePreview=function(e){if("object"==typeof e.fileMeta)return-1!==e.fileMeta.contentType.indexOf("image")?'<span>photo</span> <img src="'+H+"/rest/ws/aws/file/"+e.fileMeta.blobKey+'" class="mck-image-reply move-right"/>':-1!==e.fileMeta.contentType.indexOf("audio")?'<span>audio</span><span class="mck-file-detail move-right"><span class="mck-file-name"><span class="mck-icon-attachment"></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+mt.getFilePreviewSize(e.fileMeta.size)+"</span></span>":'<span class="mck-file-detail move-right"><span class="mck-file-name"><span class="mck-icon-attachment"></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+mt.getFilePreviewSize(e.fileMeta.size)+"</span></span>";if(2===e.contentType){var a=t.parseJSON(e.message);return'<span>location</span><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+a.lat+","+a.lon+"&maptype=roadmap&markers=color:red|"+a.lat+","+a.lon+'" class="mck-image-reply move-right"/>'}},o.getImageForReplyMessage=function(e){var a=it.getTabDisplayName(e.to,!1);if("object"==typeof e.fileMeta)return-1!==e.fileMeta.contentType.indexOf("image")?'<div><div class="mck-imagereply mck-margin"><div class="mck-msgto">'+a+'</div><div><span class="mck-icon-camera mck-camera"></span><span>Photo</span></div></div><div class="mck-imagereply"><img src="'+mt.getFileurl(e)+'" class="mck-image-reply mck-msg-text mck-msg-content"/></div></div>':-1!==e.fileMeta.contentType.indexOf("audio")?'<div class="mck-attachmentmsgto">'+a+'</div><span class="mck-file-detail mck-msg-text mck-msg-content"><span class="mck-file-name"><span class="mck-icon-attachment"></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+mt.getFilePreviewSize(e.fileMeta.size)+"</span></span>":'<div class="mck-attachmentmsgto">'+a+'</div><span class="mck-file-detail"><span class="mck-file-name"><span class="mck-icon-attachment"></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+mt.getFilePreviewSize(e.fileMeta.size)+"</span></span>";if(2===e.contentType){var s=t.parseJSON(e.message);return'<div><div class="mck-imagereply mck-margin"><div class="mck-msgto">'+a+'</div><span class="mck-icon-marker mck-location-icon"></span><span>Location</span></div><div class="mck-imagereply"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+s.lat+","+s.lon+"&maptype=roadmap&markers=color:red|"+s.lat+","+s.lon+'" class="mck-image-reply mck-msg-text "/></div></div>'}},o.getImageUrlForGroupType=function(e,t){return e.imageUrl?'<img src="'+e.imageUrl+'"/>':o.getContactImageByAlphabet(t)},o.getContactImageLink=function(e,t){var a="";if(e.isGroup||e.photoSrc||e.photoData||e.photoLink||!ft.MCK_USER_DETAIL_MAP[e.contactId].imageLink||(e.photoSrc=ft.MCK_USER_DETAIL_MAP[e.contactId].imageLink),e.members&&10==e.type)a=o.getImageUrlForGroupType(e,t);else if(e.isGroup&&7!==e.type)a=at.getGroupImage(e.imageUrl);else{if(e.isGroup&&7===e.type&&e.members.length>1&&at.getContactFromGroupOfTwo(e,function(t){e=it.fetchContact(t)}),"function"==typeof ce){var s=ce(e.contactId);s&&void 0!==s&&(a='<img src="'+s+'"/>')}a||(e.photoSrc?a='<img src="'+e.photoSrc+'"/>':e.photoData?a='<img src="data:image/jpeg;base64,'+e.photoData+'"/>':e.photoLink?a='<img src="'+MCK_BASE_URL+"/contact.image?photoLink="+e.photoLink+'"/>':"bot"==e.contactId?a='<img src="https://api.kommunicate.io/img/logo02.svg"/>':(t||(t=e.displayName),a=o.getContactImageByAlphabet(t)))}return a},o.getContactImageByAlphabet=function(e){if(void 0===e||""===e)return'<div class="mck-alpha-contact-image mck-alpha-user"><span class="mck-icon-user"></span></div>';var t=e.charAt(0);return t.match(/^[a-zA-Z0-9]+$/)?'<div class="mck-videocall-image alpha_'+(t=t.toUpperCase())+'"><span class="mck-contact-icon">'+t+"</span></div>":'<div class="mck-videocall-image alpha_user"><span class="mck-icon-user"></span></div>'},o.getNameTextClassByAlphabet=function(e){if(void 0===e||""===e)return"mck-text-user";var t=(e=e.toString()).charAt(0);return t.match(/^[a-zA-Z0-9]+$/)?"mck-text-"+(t=t.toLowerCase()):"mck-text-user"},o.addContactsFromMessageList=function(e,a){var s;if(e+""!="null"){if(0==It.has(t("#mck-contact-list")).length&&It.html('<ul id="mck-contact-list" class="mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"></ul>'),void 0===e.message.length?(e.message.groupId?at.addGroupFromMessage(e.message,!1,function(e,t,a){o.updateRecentConversationList(e,t,a)}):o.addContactsFromMessage(e.message),s=e.message.createdAtTime):t.each(e.message,function(e,t){void 0!==t.to&&(t.groupId?at.addGroupFromMessage(t,!0,function(e,t,a){o.updateRecentConversationList(e,t,a)}):o.addContactsFromMessage(t,!0),s=t.createdAtTime)}),It.data("datetime",s),a.isReload){var n="";if(a.lastActiveTabId){var i=a.isLastActiveTabGroup?"group-"+a.lastActiveTabId:"user-"+mckContactUtils.formatContactId(a.lastActiveTabId);n=t("#li-"+i)}n.length>0?It.animate({scrollTop:n.offset().top-It.offset().top+It.scrollTop()},"fast"):It.animate({scrollTop:0},0)}}else s=""},o.addGroupFromMessageList=function(e,a){e+""!="null"&&(a&&It.html('<ul id="mck-group-list" class="mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"></ul>'),void 0===e.message.length?at.addGroupFromMessage(e.message,!1,function(e,t,a){o.updateRecentConversationList(e,t,a)}):t.each(e.message,function(e,t){void 0!==t.to&&at.addGroupFromMessage(t,!0,function(e,t,a){o.updateRecentConversationList(e,t,a)})}))},o.createContact=function(e){var t=o.getContactDisplayName(e);void 0===t&&(t=e);var a={contactId:e,htmlId:mckContactUtils.formatContactId(e),displayName:t,name:t+" <"+e+"> [Main]",value:e,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return g[e]=a,a},o.createContactWithDetail=function(e){var t=e.displayName,a=e.userId;t||(t=o.getContactDisplayName(a)),void 0===t?t=a:Ye[a]=t;var s=e.photoLink?e.photoLink:"";s||(s=e.imageLink?e.imageLink:"");var n=e.imageData?e.imageData:"",i={contactId:a,htmlId:mckContactUtils.formatContactId(a),displayName:t,name:t+" <"+a+"> [Main]",value:a,photoLink:"",photoSrc:s,photoData:n,email:"",unsaved:!0,isGroup:!1,roleType:e.roleType};return g[a]=i,i},o.updateContactDetail=function(e,t){var a=t.displayName,s=t.userId;e.displayName&&e.displayName!==e.contactId||(a||(a=o.getContactDisplayName(s)),void 0===a?a=s:Ye[s]=a,e.displayName=a);var n=t.photoLink;n||(n=t.imageLink?t.imageLink:""),n&&!e.photoSrc&&(e.photoSrc=n);var i=t.imageData?t.imageData:"";return i&&!e.photoData&&(e.photoData=i),t.roleType&&(e.roleType=t.roleType),g[s]=e,e},o.addContactsFromMessage=function(e,t){var a=o.getUserIdFromMessage(e);if(a.length>0&&a[0])for(var s=0;s<a.length;s++){var n=o.fetchContact(""+a[s]);o.updateRecentConversationList(n,e,t)}},o.updateRecentConversationList=function(e,a,s){if(!a||!a.metadata||!a.metadata.KM_ASSIGN&&!a.metadata.KM_STATUS){var n="mck-contact-list",i=e.isGroup?"group-"+e.htmlId:"user-"+e.htmlId;if(t("#"+n+" #li-"+i).length>0){var r=t("#"+n+" #li-"+e.htmlId+" .mck-cont-msg-wrapper");(r.is(":empty")||s)&&void 0!==a&&o.updateContact(e,a,n)}else o.addContact(e,n,a)}},o.addContactsToSearchList=function(){var e=[],a=[];if(t.each(je,function(e,t){a.push(t.contactId)}),"undefined"!=typeof contactList){var s={async:!1};s.userIds=contactList,ct.getUsersDetail(s.userIds,s),a=contactList}var n=a.filter(function(e,t){return a.indexOf(e)===t});n.sort(),Pe.removeClass("vis").addClass("n-vis"),n.length>0?t.each(n,function(a,s){if(s){var n=o.fetchContact(""+s);e.push(n),0===t("#li-cs-user-"+n.htmlId).length&&o.addContactForSearchList(n,"mck-contact-search-list")}}):he.removeClass("n-vis").addClass("vis"),o.initAutoSuggest({contactsArray:e,$searchId:ve,isContactSearch:!0})},o.populateAutoSuggest=function(t){ke.mcktypeahead({order:"desc",hint:!1,minLength:3,wrapper:".mck-sidebox",backdropOnFocus:!0,menu:'<ul class="mcktypeahead mck-auto-suggest-menu mck-dropup-menu"></ul>',show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({left:t.left}),this.$menu.show(),this.shown=!0,this},source:t&&t.source?o.processAutosuggestData(t.source):function(e,a){Xe.ajax({url:t.sourceUrl+e,type:t.method,header:t.headers,success:function(e){var t=o.processAutosuggestData(e.data);a(t)}})},items:8,updater:function(e){var t=JSON.parse(e);return 0!=Object.keys(t.metadata).length&&Ce.val(JSON.stringify(t.metadata)),f.text(t.displayMessage),t.displayMessage},matcher:function(e){var t=new RegExp(this.query,"i");return t.test(e.searchKey)},highlighter:function(e){var t=JSON.parse(e.toString());return t.displayMessage}})},o.processAutosuggestData=function(e){var t=new Array;return e.map(function(e){var a="string"==typeof e?{searchKey:e,message:e,metadata:{}}:e,s={searchKey:a.searchKey,toString:function(){var e={displayMessage:a.message,metadata:a.metadata?a.metadata:{}};return JSON.stringify(e)},toLowerCase:function(){return a.searchKey.toLowerCase()},indexOf:function(e){return String.prototype.indexOf.apply(a.searchKey,arguments)},replace:function(e){var t=a.searchKey;return String.prototype.replace.apply('<div style="padding: 10px; font-size: 1.5em;">'+t+"</div>",arguments)}};t.push(s)}),t},o.initAutoSuggest=function(e){for(var a,s=e.contactsArray,n=e.$searchId,i=[],r={},c=[],l=0;l<s.length;l++){var d=s[l];d.displayName=o.getTabDisplayName(d.contactId,d.isGroup),a=d.displayName?t.trim(d.displayName):t.trim(d.contactId),(!0===MCK_SELF_CHAT_DISABLE&&d.contactId!==be||!0!==MCK_SELF_CHAT_DISABLE)&&(r[a]=d,i.push(a),c.push(a))}var m=function(e){var t=r[e],a=t.displayName.split(" "),s=a.length,o=a[0],n="",i="";2===s?i=a[1]:s>=3&&(i=a[s-1],n=a[s-2]);var c=new RegExp(this.query,"i");return c.test(t.displayName)||c.test(t.contactId)||c.test(n)||c.test(i)||c.test(t.email)||c.test(o+" "+i)},u=function(e){var t=r[e];return t.displayName},p=function(a){var s=r[a];e.isContactSearch?(it.loadTab({tabId:s.contactId,isGroup:s.isGroup}),ht.removeClass("n-vis").addClass("vis"),t("#mck-sidebox-ft").removeClass("n-vis").addClass("n-vis")):ot.addGroupMemberFromSearch(s.contactId)};if(n.hasClass("mck-typeahead"))return n.mcktypeahead().data("mcktypeahead").source=i,n.mcktypeahead().data("mcktypeahead").matcher=m,n.mcktypeahead().data("mcktypeahead").highlighter=u,void(n.mcktypeahead().data("mcktypeahead").updater=p);n.addClass("mck-typeahead"),n.mcktypeahead({source:i,matcher:m,highlighter:u,updater:p})},o.initSearchAutoType=function(){Oe&&(ve.keypress(function(e){if(13===e.which){var t=ve.val();t&&(!0===MCK_SELF_CHAT_DISABLE&&t!==be||!0!==MCK_SELF_CHAT_DISABLE)&&(t=void 0!==t&&""!==t?t.toString():"")&&(it.loadTab({tabId:t,isGroup:!1,isSearch:!0}),ht.removeClass("n-vis").addClass("vis")),ve.val("")}}),ie.keypress(function(e){if(13===e.which)return!0}),t(s).on("click",".mck-group-search-link",function(e){return e.preventDefault(),!0}),t(s).on("click",".mck-contact-search-link",function(e){e.preventDefault();var a=ve.val();""!==a&&(!0===MCK_SELF_CHAT_DISABLE&&a!==be||!0!==MCK_SELF_CHAT_DISABLE)&&(it.loadTab({tabId:a,isGroup:!1,isSearch:!0}),ht.removeClass("n-vis").addClass("vis"),t("#mck-sidebox-ft").removeClass("n-vis").addClass("vis")),ve.val("")}))},o.removeContact=function(e){var a=e.isGroup?"group-"+e.htmlId:"user-"+e.htmlId;t("#li-"+a).remove()},o.updateContact=function(e,a,s){var n=e.isGroup?"group-"+e.htmlId:"user-"+e.htmlId,i=t("#li-"+n),r=i.data("msg-time");if((!a.metadata||!a.metadata.action)&&a&&a.createdAtTime>r){var c=a.groupId?"group_"+e.contactId:"user_"+e.contactId,l=o.getUnreadCount(c),d=o.getMessageTextForContactPreview(a,e);if(void 0===d)return;t("#li-"+n+" .mck-cont-msg-date").html(void 0===a.createdAtTime?"":mckDateUtils.getTimeOrDate(a?a.createdAtTime:"",!0));var m=t("#li-"+n+" .mck-cont-msg-wrapper");if(m.html(""),"object"==typeof d?m.append(d):m.html(d),a.conversationId){var u=a.conversationId,p=E[u];if("object"==typeof p){var v=p.topicId;if(v&&Ke){var g=I[v];"object"==typeof g&&t("#li-"+n+" .mck-conversation-topic").html(g.title)}}t("#li-"+n+" a").data("mck-conversationid",u)}l>0&&(t("#li-"+n+" .mck-unread-count-text").html(l),t("#li-"+n+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));var f=t("#"+s+" li:nth-child(1)").data("msg-time");i.data("msg-time",a.createdAtTime),(void 0===f||(a?a.createdAtTime:"")>=f)&&0!==t("#mck-contact-list li").index(i)&&t("#"+s+" li:nth-child(1)").before(i)}},o.clearContactMessageData=function(e,a){var s=mckContactUtils.formatContactId(e),o=a?"group-"+s:"user-"+s;t("#li-"+o+" .mck-cont-msg-date").html(""),t("#li-"+o+" .mck-cont-msg-wrapper").html("")},o.addContact=function(e,s,n){var i=o.getMessageTextForContactPreview(n,e),r=e.userCount,c="",l=!1;if(void 0!==n){if(n.conversationId){c=n.conversationId;var d=E[c]}n.groupId&&(l=!0)}var m=o.getTabDisplayName(e.contactId,l),u=o.getContactImageLink(e,m),p=!1,v=l?"group_"+e.contactId:"user_"+e.contactId,g=o.getUnreadCount(v),f=g>0&&"mck-search-list"!==s?"vis":"n-vis",k="n-vis",b=l?"group-"+e.htmlId:"user-"+e.htmlId,y=l&&xe;if(t("#li-"+b+" .mck-group-count-text").html(r),t("#li-"+b+" .mck-group-count-box").removeClass("n-vis").addClass("vis"),l||C[e.contactId]||h[e.contactId]||!Ee||!a.MCK_OL_MAP[e.contactId]||(k="vis",p=!0),7===e.type&&e.members.length>1){var M,T=st.getGroup(n.groupId);at.getContactFromGroupOfTwo(T,function(e){M=it.fetchContact(e)}),l&&Ee&&a.MCK_OL_MAP[M.contactId]&&(k="vis",p=!0)}var S="n-vis";if("object"==typeof d&&Ke){var A=I[d.topicId];if("object"==typeof A){S="vis";var L=A.title}}var b=l?"group-"+e.htmlId:"user-"+e.htmlId,x=[{contHtmlExpr:b,contIdExpr:e.contactId,contTabExpr:l,msgCreatedAtTimeExpr:n?n.createdAtTime:"",mckLauncherExpr:z,contImgExpr:u,contOlExpr:k,onlineLabel:MCK_LABELS.online,contUnreadExpr:f,contUnreadCount:g,contNameExpr:m,conversationExpr:c,contHeaderExpr:S,titleExpr:L,groupUserCountExpr:l?e.userCount:"",displayGroupUserCountExpr:y?"vis":"n-vis",msgCreatedDateExpr:n?mckDateUtils.getTimeOrDate(n.createdAtTime,!0):""}],_=t("#"+s+" li:nth-child(1)").data("msg-time");void 0===_||(n?n.createdAtTime:"")>=_||-1!==s.indexOf("search")&&p?t.tmpl("contactTemplate",x).prependTo("#"+s):t.tmpl("contactTemplate",x).appendTo("#"+s);var w=t("#li-"+b+" .msgTextExpr");"object"==typeof i?w.append(i):w.html(i),void 0===i&&w.html("")},o.addContactsToContactSearchList=function(){he.removeClass("vis").addClass("n-vis"),X.removeClass("vis").addClass("n-vis"),pe.hasClass("active")||(ye.removeClass("active"),pe.addClass("active")),ae.removeClass("vis").addClass("n-vis"),de.removeClass("n-vis").addClass("vis"),re.removeClass("vis").addClass("n-vis"),P.removeClass("n-vis").addClass("vis"),de.html(""),ue.removeClass("vis").addClass("n-vis"),et.removeClass("vis").addClass("n-vis"),J.removeClass("vis").addClass("n-vis"),te.removeClass("vis").addClass("n-vis"),Ae.removeClass("n-vis").addClass("vis"),Pe.removeClass("n-vis").addClass("vis"),0!==je.length?it.addContactsToSearchList():Ue?(Pe.removeClass("vis").addClass("n-vis"),he.removeClass("n-vis").addClass("vis")):ct.loadContacts(),ve.focus()},o.addGroupsToGroupSearchList=function(){var e=[],a=[];if(he.removeClass("vis").addClass("n-vis"),X.removeClass("vis").addClass("n-vis"),Z.hasClass("active")||(ye.removeClass("active"),Z.addClass("active")),de.removeClass("vis").addClass("n-vis"),ae.removeClass("n-vis").addClass("vis"),P.removeClass("vis").addClass("n-vis"),re.removeClass("n-vis").addClass("vis"),ae.html(""),ue.removeClass("vis").addClass("n-vis"),et.removeClass("vis").addClass("n-vis"),J.removeClass("vis").addClass("n-vis"),te.removeClass("vis").addClass("n-vis"),Ae.removeClass("n-vis").addClass("vis"),Pe.removeClass("n-vis").addClass("vis"),He.length>0){t.each(He,function(e,t){a.push(t.contactId)});var s=a.filter(function(e,t){return a.indexOf(e)===t});s.sort(),t.each(s,function(a,s){if(s){var n=st.getGroup(""+s);e.push(n),0===t("#li-gs-group-"+n.htmlId).length&&o.addContactForSearchList(n,"mck-group-search-list")}})}else X.removeClass("n-vis").addClass("vis");o.initAutoSuggest({contactsArray:e,$searchId:ie,isContactSearch:!0}),Pe.removeClass("vis").addClass("n-vis")},o.addConversationMenu=function(e,a){var s=It.data("mck-id");if(gt.html(""),e===s){var o=Ze[e];if(void 0===o||0===o.length||1===o.length)return R.addClass("n-vis"),K.addClass("mck-product-box-wc"),void gt.addClass("n-vis");gt.removeClass("n-vis"),R.removeClass("n-vis"),K.removeClass("mck-product-box-wc"),t.each(o,function(s,o){if(0===t("#mck-conversation-list #li-"+o.id).length){var n="";if(o.topicDetail){var i=t.parseJSON(o.topicDetail);n="object"==typeof i?i.title:o.topicDetail}n||(n=o.topicId);var r=[{convIdExpr:o.id,tabIdExpr:e,isGroupExpr:a,topicIdExpr:o.topicId,convTitleExpr:n,mckLauncherExpr:z}];t.tmpl("convTemplate",r).appendTo(gt)}}),t("#mck-conversation-list li").length<2&&(R.addClass("n-vis"),K.addClass("mck-product-box-wc"),gt.addClass("n-vis"))}},o.loadContacts=function(e){e+""!="null"&&void 0!==e&&void 0!==e.contacts&&0!==e.contacts.length&&(je.length=0,We.length=0,t.each(e.contacts,function(e,t){if(void 0!==t.userId){var a=o.getContact(""+t.userId);a=void 0===a?o.createContactWithDetail(t):o.updateContactDetail(a,t),je.push(a),We.push(a.contactId)}}))},o.loadContactsForContactList=function(e){var t=e.startIndex?e.startIndex:"0",s=e.pageSize?e.pageSize:"50",o=MCK_BASE_URL+"/rest/ws/user/filter?startIndex="+t+"&pageSize="+s+"&orderBy=1";Xe.ajax({url:o,type:"get",global:!1,success:function(e){console.log(e)},error:function(){a.console.log("Unable to load contacts. Please reload page.")}})},o.getStatusIcon=function(e){return'<span class="'+o.getStatusIconName(e)+" move-right "+e.key+'_status status-icon"></span>'},o.getStatusIconName=function(e){return Kommunicate.internetStatus||1!==e.contentType?7===e.type||6===e.type||4===e.type||0===e.type?"":5===e.status?"mck-read-icon":4===e.status?"mck-delivered-icon":3===e.type||5===e.type||1===e.type&&(0===e.source||1===e.source)?"mck-sent-icon":"":"mck-failed-text"},o.clearMessageField=function(e){f.html(""),u.attr("disabled",!1),m.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required","").html(""),e?f.focus().select():(i.blur(),f.blur())},o.addDraftMessage=function(e){if(p=[],e&&"object"==typeof Ve[e]){var a=Ve[e];f.html(a.text),a.files.length>0&&(t.each(a.files,function(e,t){nt.addFileBox(t)}),c.html(a.filelb),l.html(a.filesize),m.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))}else p=[]},o.showOfflineMessage=function(){"object"==typeof me&&me.innerHTML?(yt.html(me.innerHTML),yt.removeClass("n-vis").addClass("vis")):a.console.log("Offline message innerHTML required.")},o.hideOfflineMessage=function(){Qe.stopOfflineMessageCounter(),yt.removeClass("vis").addClass("n-vis")},o.removeConversationThread=function(e,a){ALStorage.clearMckMessageArray();var s=a?st.getGroup(e):it.getContact(e),o=It.data("mck-id"),n=It.data("isgroup");if(void 0===o||""===o){var i=void 0!==s?s.htmlId:mckContactUtils.formatContactId(e),r=a?"group-"+i:"user-"+i;t("#li-"+r).remove()}else o===e&&n===a&&(ut.data("datetime",""),A.removeClass("n-vis").addClass("vis"),Ct.removeClass("vis").addClass("n-vis"))},o.removedDeletedMessage=function(e,a,s){ALStorage.clearMckMessageArray();var o=t("."+e);if(o.length>0)o.remove(),It.is(":empty")&&(A.removeClass("n-vis").addClass("vis"),Ct.removeClass("vis").addClass("n-vis"));else if(void 0!==a){var n=t("#mck-contact-list").length;n>0&&dt.updateContactList(a,s)}},o.getMessageTextForContactPreview=function(e,t){var o="";if(void 0!==e){if(e.message){if("true"===e.metadata.hide)return;if(e.metadata&&(e.metadata.KM_ASSIGN||e.metadata.KM_STATUS))return;if(2===e.contentType)o='<span class="mck-icon--location"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg></span><span>Location</span>';else if(3===e.contentType&&7===e.source){var n=e.message,i=n.match(/<b>(.*?)<\/b>/g).map(function(e){return e.replace(/<\/?b>/g,"")}),r='<span class="mck-icon--email"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-.4 4.25l-6.54 4.09c-.65.41-1.47.41-2.12 0L4.4 8.25c-.25-.16-.4-.43-.4-.72 0-.67.73-1.07 1.3-.72L12 11l6.7-4.19c.57-.35 1.3.05 1.3.72 0 .29-.15.56-.4.72z" fill="rgba(38,50,56,.52)"/></svg>';o=i?r+i[0]:r+"</span><span>Email</span>"}else{var c=e.message;if(Xe.startsWith(c,"<img"))return'<span class="mck-icon--camera"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2" fill="rgba(38,50,56,.52)"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg></span><span>image</span>';if(null!==a.emoji&&void 0!==a.emoji?(o=a.emoji.replace_unified(c),o=-1!==(o=a.emoji.replace_colons(o)).indexOf("</span>")?o.substring(0,o.lastIndexOf("</span>")):o):o=c,!t.isGroup&&-1===o.indexOf("emoji-inner")&&0===e.contentType){var l=s.createElement("p");l.appendChild(s.createTextNode(o)),o=l}}}else e.fileMetaKey&&"object"==typeof e.fileMeta?o=mt.getFileIcon(e):e.metadata&&e.metadata.messagePreview&&(o=e.metadata.messagePreview);if(t.isGroup&&3!==t.type&&7!==t.type&&10!==t.type){var d=e.to.split(",")[0]===be?"Me":it.getTabDisplayName(e.to.split(",")[0],!1);if(10!==e.contentType&&(o=d+": "+o),-1===o.indexOf("emoji-inner")&&e&&e.message&&0===e.contentType){var l=s.createElement("p");l.appendChild(s.createTextNode(o)),o=l}}}return o},o.getTextForMessagePreview=function(e,a){var o="";if(void 0!==e){if(2===e.contentType)o="Shared location";else if(e.message){var n=e.message;if(Xe.startsWith(n,"<img"))o="Image attachment";else{var i=s.createElement("div");i.innerHTML=n,n=t.trim(Xe.textVal(i)),o=n.substring(0,50)}}else e.fileMetaKey&&"object"==typeof e.fileMeta&&(o=-1!==e.fileMeta.contentType.indexOf("image")?"Image attachment":"File attachment");if(a.isGroup&&3!==a.type&&7!==a.type){var r=e.to.split(",")[0]===be?"Me":it.getTabDisplayName(e.to.split(",")[0],!1);o=r+": "+o}}return o},o.getUserIdFromMessage=function(e){var t=e.to;return t.lastIndexOf(",")===t.length-1&&(t=t.substring(0,t.length-1)),t.split(",")},o.getUserIdArrayFromMessageList=function(e){var a=new Array;return void 0===e.length?a.concat(o.getUserIdFromMessage(e)):t.each(e,function(e,t){void 0!==t.to&&(a=a.concat(o.getUserIdFromMessage(t)))}),a},o.messageContextMenu=function(e){var s=t("."+e+" .mck-msg-box");s.addEventListener?s.addEventListener("contextmenu",function(e){e.preventDefault()},!1):s.bind("contextmenu",function(s){s.preventDefault(),t(".mck-context-menu").removeClass("vis").addClass("n-vis"),t("."+e+" .mck-context-menu").removeClass("n-vis").addClass("vis"),a.event.returnValue=!1})},o.isValidMetaData=function(e){return!e.metadata||"HIDDEN"!==e.metadata.category&&"true"!=e.metadata.hide&&"false"!=e.metadata.show&&!e.metadata.KM_ASSIGN&&!e.metadata.KM_STATUS},o.updateDraftMessage=function(e,a){if("object"==typeof a){var s={text:"",files:[]},o={fileMeta:a,filelb:mt.getFilePreviewPath(a),filesize:mt.getFilePreviewSize(a.size)};void 0!==e&&"object"==typeof Ve[e]&&(s=Ve[e],t.each(s.files,function(e,t){t.filelb===o.filelb&&s.files.splice(e,1)})),s.files.push(o)}Ve[e]=s},o.updateUnreadCount=function(e,t,a){var s=o.getUnreadCount(e);Je[e]=t,(a||kt.length>0)&&((S+=t-s)<0&&(S=0),S>0?kt.html(S):kt.html("")),a&&Xe.badgeCountOnLaucher(fe,S)},o.incrementUnreadCount=function(e){S+=1,Je[e]=void 0===Je[e]?1:Je[e]+1,kt.length>0&&kt.html(S),Xe.badgeCountOnLaucher(fe,S)},o.getUnreadCount=function(e){return void 0===Je[e]?(Je[e]=0,0):Je[e]},o.isGroupDeleted=function(e,t){if(t){var a=ot.getDeletedAtTime(e);return void 0!==a&&a>0}return!1},o.getTabDisplayName=function(e,t,a){var s="";if(t)return at.getGroupDisplayName(e);"function"==typeof ne&&(s=ne(e)),void 0!==a&&a&&(s=a,Ye[e]=a),s||(s=o.getContactDisplayName(e));var n=o.fetchContact(""+e);return s?(n.displayName=s,g[n.contactId]=n):void 0!==n.displayName&&(s=n.displayName),s||(s=e),s},o.populateMessage=function(e,a,s){var n=mckDateUtils.convertMilisIntoTime(a.metadata.CALL_DURATION);ft.loadUserProfile(a.to),t(".km-typing-wrapper").remove(),103==a.contentType&&(4==a.type&&"CALL_REJECTED"==a.metadata.MSG_TYPE?a.message="you rejected a Video call from "+a.to:5==a.type&&"CALL_REJECTED"==a.metadata.MSG_TYPE?a.message=a.to+"rejected a Video call from you":4==a.type&&"CALL_END"==a.metadata.MSG_TYPE?a.message="you were in a call with "+a.to+"\n call duration : "+n:5==a.type&&"CALL_END"==a.metadata.MSG_TYPE?a.message="you were in a call with "+a.to+"\n call duration : "+n:4==a.type&&"CALL_MISSED"==a.metadata.MSG_TYPE?a.message="you missed a Video call from "+a.to:5==a.type&&"CALL_MISSED"==a.metadata.MSG_TYPE&&(a.message=a.to+"missed a Video call from you"));var i=It.data("mck-id"),r=it.isValidMetaData(a),c=a.groupId?st.getGroup(a.groupId):it.getContact(a.to);if(void 0===i||""===i){var l=t("#mck-contact-list").length;if(l>0&&r){var d="object"==typeof a.metadata&&(void 0===a.metadata.KM_ASSIGN||void 0===a.metadata.KM_STATUS);a.groupId?at.addGroupFromMessage(a,d,function(e,t,a){o.updateRecentConversationList(e,t,a)}):it.addContactsFromMessage(a,!0)}else it.addContactsFromMessageList({message:[a]},"");if("APPLOZIC_01"===e||"MESSAGE_RECEIVED"===e){if(void 0===c&&(c=a.groupId?st.createGroup(a.groupId):it.createContact(a.to)),Re)return void it.loadTab({tabId:c.contactId,isGroup:c.isGroup,conversationId:a.conversationId});var m=a.groupId?"group_"+c.contactId:"user_"+c.contactId;r&&(10!==a.contentType&&102!==a.contentType&&it.incrementUnreadCount(m),"block"!==document.getElementById("mck-sidebox").style.display&&lt.notifyUser(a));var u=a.groupId?"group-"+c.htmlId:"user-"+c.htmlId;t("#li-"+u+" .mck-unread-count-text").html(it.getUnreadCount(m)),it.getUnreadCount(m)>0&&t("#li-"+u+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"),dt.sendDeliveryUpdate(a)}}else if(void 0===c&&(c=a.groupId?st.createGroup(a.groupId):it.createContact(a.to)),"APPLOZIC_01"===e||"MESSAGE_RECEIVED"===e){if(void 0!==c){var p=It.data("isgroup");if((void 0===a.oldKey||0===t("."+a.oldKey).length)&&0===t("."+a.key).length||10===a.contentType){if(void 0===i||i!=c.contactId||p!==c.isGroup||J.hasClass("vis")){if(Re)return void it.loadTab({tabId:c.contactId,isGroup:c.isGroup,conversationId:a.conversationId});if(r&&10!==a.contentType&&102!==a.contentType){var m=a.groupId?"group_"+c.contactId:"user_"+c.contactId;it.incrementUnreadCount(m)}dt.sendDeliveryUpdate(a)}else{var v=!0;if(p&&6===c.type&&(v=at.isAppendOpenGroupContextMenu(c)),a.conversationId&&(Ke||Me)){var g=It.data("mck-conversationid");if(g&&g.toString()===a.conversationId.toString())a.metadata&&"HIDDEN"===a.metadata.category||it.addMessage(a,c,!0,!0,v),dt.sendReadUpdate(a.pairedMessageKey);else if(Re)return void it.loadTab({tabId:c.contactId,isGroup:c.isGroup,conversationId:a.conversationId})}else{if(7===c.type){var f,k=st.getGroup(a.groupId);at.getContactFromGroupOfTwo(k,function(e){f=it.fetchContact(e)}),tt.lastSeenOfGroupOfTwo(f.contactId),it.addMessage(a,c,!0,!0,v)}(!a.metadata||"HIDDEN"!==a.metadata.category&&"true"!==a.metadata.hide&&7!==c.type)&&(it.addMessage(a,c,!0,!0,v),it.messageClubbing(!1)),dt.sendReadUpdate(a.pairedMessageKey)}a.groupId||(t("#mck-tab-status").html(MCK_LABELS.online),ft.updateUserStatus({userId:a.to,status:1},function(e){ct.getUsersDetail(e,{})}))}s&&6!==c.type&&"block"!==document.getElementById("mck-sidebox").style.display&&lt.notifyUser(a)}}}else if("APPLOZIC_02"===e&&102==!a.contentType&&((void 0===a.oldKey||0===t("."+a.oldKey).length)&&0===t("."+a.key).length||10===a.contentType))if(l>0)it.addContactsFromMessage(a,!0);else if(void 0!==c){var p=It.data("isgroup");if(void 0!==i&&i===c.contactId&&p===c.isGroup){var v=!0;p&&6===c.type&&(v=at.isAppendOpenGroupContextMenu(c)),a.metadata&&"HIDDEN"===a.metadata.category||it.addMessage(a,c,!0,!0,v),3===a.type&&(t("."+a.key+" .mck-message-status").removeClass("mck-pending-icon").addClass("mck-sent-icon"),it.addTooltip(a.key))}}Le.removeClass("vis").addClass("n-vis")},o.getMessageFeed=function(e){var a={};if(a.key=e.key,a.timeStamp=e.createdAtTime,a.message=e.message,a.from=4===e.type?e.to:be,e.groupId?a.to=e.groupId:a.to=5===e.type?e.to:be,a.status="read",a.type=4===e.type?"inbox":"outbox",5===e.type&&(3===e.status?a.status="sent":4===e.status&&(a.status="delivered")),"object"==typeof e.fileMeta){var s=t.extend({},e.fileMeta);void 0!==s.url&&""!==s.url||(s.url=H+"/rest/ws/aws/file/"+e.fileMeta.blobKey),delete s.blobKey,a.file=s}return a.source=e.source,a.metadata=e.metadata,a},o.updateUnreadCountonChatIcon=function(e){if(De&&e.length>0){var a=null,s=0;e.length>0&&(t.each(e,function(e,t){t.unreadCount>0&&null!==a||t.unreadCount>0&&(a=t.userId,s=t.unreadCount)}),S>0&&"none"===d.css("display")&&(null!==a&&s===S?it.loadTab({tabId:a,isGroup:!1}):it.loadTab({tabId:"",isGroup:!1})))}},o.loadMessageListOnUserDetailFetch=function(e){Le.removeClass("vis").addClass("n-vis");var a=It.data("mck-id"),s=It.data("isgroup");if(void 0===a||e.tabId===a&&""+s==""+e.isGroup){var o=st.getGroup(e.tabId);ot.addGroupStatus(o);var n=6!==o.type,n=!0;6===o.type&&(ot.validateOpenGroupUser(o),n=at.isAppendOpenGroupContextMenu(o)),e.isMessages?(it.processMessageList(e.messageData,!0,n),6!==o.type&&Ct.removeClass("n-vis").addClass("vis"),"function"==typeof Q&&Q(e.tabId)):0===t("#mck-message-cell .mck-message-inner div[name='message']").length&&Ct.removeClass("vis").addClass("n-vis")}},o.messageClubbing=function(e){var a=t('#mck-message-cell .mck-message-inner div[name="message"]'),s=a.length;if(s>1&&!e){var o=a[s-1].getAttribute("data-msgtime")-a[s-2].getAttribute("data-msgtime");a[s-2].getAttribute("data-contact")==a[s-1].getAttribute("data-contact")&&o<KommunicateConstants.MESSAGE_CLUBBING.TIME_FRAME&&(a[s-2].classList.add("km-clubbing-first"),a[s-1].classList.add("km-clubbing-last"))}else t.each(a,function(e,t){var s=a[e].nextSibling&&a[e].nextSibling.getAttribute("data-msgtime")-a[e].getAttribute("data-msgtime");a[e].nextSibling&&a[e].nextSibling.getAttribute("data-contact")==a[e].getAttribute("data-contact")&&s<KommunicateConstants.MESSAGE_CLUBBING.TIME_FRAME&&(a[e].classList.add("km-clubbing-first"),a[e].nextSibling.classList.add("km-clubbing-last"))})}},rt=new function(){var e,o=this,n=t("#mck-search"),i=t("#mck-msg-to"),r=t("#mck-msg-new"),l=(t("#mck-audio"),t("#mck-mike-btn"),t("#mck-sidebox")),d=t("#mck-file-box"),u=t("#mck-text-box"),v=t("#mck-msg-form"),g=t("#mck-msg-sbmt"),b=t("#mck-new-group"),y=t("#mck-tab-title"),T=t("#mck-msg-error"),S=t("#mck-btn-attach"),A=t("#mck-tab-status"),L=t("#mck-message-cell"),x=t(".mck-typing-box"),w=t("#mck-gms-loading"),K=t("#mck-group-title"),U=t("#mck-contact-loading"),G=(t("#mck-no-messages"),t(".mck-group-search")),R=(t(".mck-city-search"),t("#mck-msg-response")),P=t("#mck-msg-form #mck-file-input"),F=t("#mck-block-button"),q=t("#li-mck-block-user"),H=t("#li-mck-group-info"),j=t("#li-mck-video-call"),V=t("#mck_response_text"),Y=t(".mck-contact-search"),W=t("#mck-group-info-tab"),X=t("#mck-price-text-box"),ee=(t("#mck-sidebox-search"),t("#mck-group-info-btn")),W=t("#mck-group-info-tab"),te=t("#mck-btn-group-exit"),ae=t("#mck-group-back-link"),se=t("#mck-btn-leave-group"),ne=t(".mck-sidebox-content"),ce=(t("#mck-no-more-messages"),t("#mck-btn-group-create")),le=(t("#mck-group-create-tab"),t("#mck-group-add-member")),de=(t("#mck-contacts-content"),t("#mck-tab-option-panel")),me=(t("#mck-no-conversations"),t("#mck-group-create-title")),ue=t(".mck-group-menu-options"),ve=t(".mck-tab-message-option"),ge=t(".mck-group-admin-options"),fe=t("#mck-group-member-search"),Ce=t("#mck-autosuggest-search-input"),he=t("#mck-autosuggest-metadata"),Ee=t("#mck-message-cell .mck-message-inner"),Te=(t("#mck-search-cell .mck-message-inner"),t("#mck-no-more-conversations"),t("#mck-gm-search-box")),Ae=t("#mck-group-member-search-list"),xe=t("#mck-no-gsm-text"),we=t("#mck-minutes"),Ne=t("#mck-seconds");o.checkArray=function(e){if(e&&!1===Array.isArray(e))throw new Error("askUserDetails should be an array");return e},o.getUserMetadata=function(){var e=["name","email","phone"],a={};return Et.filter(function(s){-1===e.indexOf(s.field)&&(a[s.field]=t("#km-"+s.field).val())}),a},o.createNewConversation=function(e,t){Kommunicate.startConversation(e,t)},o.loadConversationWithAgents=function(e,a){"kommunicate"==window.applozic.PRODUCT_ID&&se.removeClass("vis").addClass("n-vis");Kommunicate.client.getGroupDetailByType({type:10,startIndex:0,limit:10},function(e,s){if(e)console.log("error while fetching group detail by type",e);else if(0==s.response.length)rt.createNewConversation({groupName:Tt,agentId:St,botIds:At},function(e){a()});else if(1==s.response.length){var o=s.response[0].id;t.fn.applozic("loadGroupTab",o,a)}else Fe>0&&ALStorage.clearMckMessageArray(),t.fn.applozic("loadTab",null,a)})},o.timer=function(){var t=0,a=this;e=setInterval(function(){++t,Ne.html(a.pad(t%60)),we.html(a.pad(parseInt(t/60)))},1e3),a.pad=function(e){var t=e+"";return t.length<2?"0"+t:t}},o.stoptimer=function(){Ne.html("0"),we.html("0"),clearInterval(e)},t(s).on("click",".mck-message-delete",function(){o.deleteMessage(t(this).parents(".mck-m-b").data("msgkey"))}),t(s).on("click",".mck-message-reply",function(){o.replyMessage(t(this).parents(".mck-m-b").data("msgkey"))}),t(s).on("click",".mck-message-forward",function(){r.data("forwardMessageKey",t(this).parents(".mck-m-b").data("msgkey")),r.trigger("click")}),t(".mck-minimize-icon").click(function(){t(".mck-box-md,.mck-box-ft").animate({height:"toggle"}),ne.hasClass("minimized")?(ne.css("height","100%"),ne.removeClass("minimized")):(ne.css("height","0%"),ne.addClass("minimized"))}),o.init=function(){var e=document.getElementById("mck-text-box");t.template("oflTemplate",'<div id="mck-ofl-blk" class="mck-m-b"><div class="mck-clear"><div class="blk-lg-12 mck-text-light mck-text-muted mck-test-center">${userIdExpr} is offline now</div></div></div>'),ALStorage.clearMckMessageArray(),t(s).on("click","."+z,function(){t(this).hasClass("mck-msg-preview")&&t(this).hide(),clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM)}),it.initSearchAutoType(),Y.click(function(){rt.createNewConversation({groupName:Tt,agentId:St,botIds:At},function(e){}),t("#mck-msg-new").attr("disabled",!0),clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM)}),t(s).on("click","#mck-sidebox-launcher",function(){document.getElementById("launcher-agent-img-container").classList.add("n-vis"),document.getElementById("launcher-agent-img-container").classList.remove("vis"),void 0!==ke?document.getElementById("mck-sidebox-launcher").childNodes[0].childNodes[0].classList.remove("n-vis"):document.getElementById("launcher-svg-container").classList.remove("n-vis")}),t(s).on("click","#talk-to-human-link",function(){""===t("#km-faq-search-input").val()?(rt.createNewConversation({groupName:Tt,agentId:St,botIds:At},function(e){}),KommunicateUI.showChat()):rt.createNewConversation({groupName:Tt,agentId:St,botIds:At},function(e){KommunicateUI.sendFaqQueryAsMsg(e),KommunicateUI.showChat()}),t("#mck-contact-list").removeClass("vis").addClass("n-vis")}),G.click(function(){it.addGroupsToGroupSearchList()}),o.showSendButton=function(){pt.modifyClassList({id:["send-button-wrapper"]},"vis","n-vis"),pt.modifyClassList({id:["mck-file-up","mck-btn-loc","mck-btn-smiley-box"]},"n-vis","vis"),!$&&pt.modifyClassList({id:["mck-file-up2"]},"n-vis","vis")},o.hideSendButton=function(){pt.modifyClassList({id:["send-button-wrapper"]},"n-vis","vis"),pt.modifyClassList({id:["mck-file-up"]},"vis","n-vis"),$?pt.modifyClassList({id:["mck-btn-loc"]},"vis","n-vis"):pt.modifyClassList({id:["mck-file-up2"]},"vis","n-vis"),_&&pt.modifyClassList({id:["mck-btn-smiley-box"]},"vis","n-vis")},e.addEventListener("keyup",function(){""!=e.textContent&&e.textContent.replace(/\s/g,"").length?o.showSendButton():o.hideSendButton()}),u.keydown(function(e){if(u.hasClass("mck-text-req")&&u.removeClass("mck-text-req"),13===e.keyCode&&(e.shiftKey||e.ctrlKey)){if(e.preventDefault(),a.getSelection){var t=a.getSelection(),o=t.getRangeAt(0),n=s.createElement("br"),i=s.createTextNode("");return o.deleteContents(),o.insertNode(n),o.collapse(!1),o.insertNode(i),o.selectNodeContents(i),t.removeAllRanges(),t.addRange(o),u.animate({scrollTop:u.prop("scrollHeight")},0),!1}}else 13===e.keyCode?(e.preventDefault(),1===f&&Lt.sendTypingStatus(0,Ee.data("mck-id")),g.is(":disabled")&&d.hasClass("vis")?alert("Please wait file is uploading."):v.submit(),it.messageClubbing(!1)):0===f&&Lt.sendTypingStatus(1,Ee.data("mck-id"))}),t(s).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&rt.deleteConversation()}),t(s).on("click",".applozic-tm-launcher",function(e){e.preventDefault();var a=t(this).data("mck-id");a=void 0!==a&&""!==a?a.toString():"";var s=t(this).data("mck-name");s=void 0!==s&&""!==s?s.toString():"";var o=t(this).data("mck-supportid");o=void 0!==o&&""!==o?o.toString():"";var n=t(this).data("mck-topicid");n=void 0!==n&&""!==n?n.toString():"";var i=t(this).data("mck-msg");if(i=void 0!==i&&""!==i?i.toString():"","function"==typeof oe&&n){var r=oe(n);"object"==typeof r&&"undefined"!==r.title&&(I[n]=r)}var c={topicId:n,tabId:a,userName:s,isMessage:!0},l={type:5,contentType:0,message:i};c.messagePxy=l,o?(c.isGroup=!0,c.supportId=o,rt.getConversationId(c)):(c.isGroup=!1,it.loadTab(c,dt.dispatchMessage))}),t(s).on("click",".applozic-wt-launcher",function(e){e.preventDefault();var a=t(this).data("mck-id");a=void 0!==a&&""!==a?a.toString():"";var s=t(this).data("mck-name");s=void 0!==s&&""!==s?s.toString():"";var o=t(this).data("mck-topicid");o=void 0!==o&&""!==o?o.toString():"";var n=t(this).data("mck-topic-status");if(n=n?-1===ze.indexOf(n)?ze[0]:n.toString():ze[0],"function"==typeof oe){var i=oe(o);"object"==typeof i&&"undefined"!==i.title&&(I[o]=i)}rt.getConversationId({tabId:a,isGroup:!1,userName:s,topicId:o,topicStatus:n,isMessage:!1})}),t(s).on("click",".applozic-ct-launcher",function(e){e.preventDefault();var a=t(this).data("mck-id");a=void 0!==a&&""!==a?a.toString():"";var s=t(this).data("mck-name");s=void 0!==s&&""!==s?s.toString():"";var o=t(this).data("mck-topicid");o=void 0!==o&&""!==o?o.toString():"";var n=t(this).data("mck-topic-status");n=n?-1===ze.indexOf(n)?ze[0]:n.toString():ze[0];var i={tabId:a,isGroup:!1,userName:s,topicId:o,topicStatus:n,isMessage:!1};if("function"==typeof pe){var r=pe(o);"object"==typeof r&&(r.topicDetail&&"object"==typeof r.topicDetail&&"undefined"!==r.topicDetail.title&&(I[o]=r.topicDetail),r.fallBackTemplatesList&&r.fallBackTemplatesList.length>0&&(i.fallBackTemplatesList=r.fallBackTemplatesList))}rt.getConversationId(i)}),t(s).on("click","."+z+", .mck-contact-list ."+z,function(e){e.preventDefault(),!isFirstLaunch&&t("#mck-tab-individual .mck-tab-link.mck-back-btn-container").addClass("vis-table").removeClass("n-vis"),t("#mck-tab-individual .mck-name-status-container.mck-box-title").removeClass("padding"),count++;var a=t(this),s=this,o=a.data("mck-id");count>1&&"object"!=typeof MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-1]&&MCK_EVENT_HISTORY.push(s),o?a.parents(".mck-search-list").length?(n.bind("blur"),setTimeout(function(){rt.openChat(s)},600)):rt.openChat(s):(t.fn.applozic("mckLaunchSideboxChat"),clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM))}),t("#km-form-chat-login").submit(function(e){var a=t("#km-submit-chat-login"),s=t("#km-error-chat-login"),o=t("#km-userId").val(),n=t("#km-email").val(),i=t("#km-name").val(),c=t("#km-phone").val();c&&(o=c),n&&(o=n,KommunicateUtils.setCookie({name:KommunicateConstants.COOKIES.KOMMUNICATE_LOGGED_IN_ID,value:n,expiresInDays:30}),KommunicateUtils.setCookie({name:KommunicateConstants.COOKIES.IS_USER_ID_FOR_LEAD_COLLECTION,value:!0,expiresInDays:30}));var l=rt.getUserMetadata();s.removeClass("show").addClass("hide"),s.html("");var d={userId:o,applicationId:N,onInit:r,baseUrl:MCK_BASE_URL,locShare:$,metadata:l,googleApiKey:ye,chatNotificationMailSent:!0};return n&&(d.email=n),i&&(d.displayName=i),c&&(d.contactNumber=c),a.attr("disabled",!0),a.html("Initiating chat..."),Qe.initialize(d),!1});var r=function(){"kommunicate"===window.applozic.PRODUCT_ID&&se.removeClass("vis").addClass("n-vis"),rt.loadConversationWithAgents({groupName:Tt,agentId:St,botIds:At})};t(".km-login-model-close").on("click",function(e){t("#km-chat-login-modal").css("display","none")}),t(s).on("click",".mck-conversation-tab-link",function(e){e.preventDefault();t(this);var a=Ee.data("mck-id"),s=Ee.data("isgroup");KommunicateUI.hideAwayMessage(),KommunicateUI.hideLeadCollectionTemplate(),KommunicateUI.showClosedConversationBanner(!1),it.loadTab({tabId:"",isGroup:!1,lastActiveTabId:a,isLastActiveTabGroup:s})}),t(s).on("click",".mck-close-sidebox",function(e){e.preventDefault(),MCK_MAINTAIN_ACTIVE_CONVERSATION_STATE&&KommunicateUtils.removeItemFromLocalStorage("mckActiveConversationInfo"),KommunicateUI.hideAwayMessage(),KommunicateUI.hideLeadCollectionTemplate(),KommunicateUI.showClosedConversationBanner(!1),l.mckModal("hide"),t("#mck-sidebox-launcher").removeClass("n-vis").addClass("vis"),document.getElementById("launcher-agent-img-container").classList.contains("vis")?(document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.add("n-vis"),document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.remove("vis")):(document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.add("vis"),document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.remove("n-vis"));var a=Ee.data("mck-conversationid");if(Ee.data("mck-id",""),Ee.data("mck-topicid",""),Ee.data("mck-name",""),Ee.data("mck-conversationid",""),a){var s=E[a];if("object"==typeof s){var o=s.topicId;"function"==typeof J&&J(be,o)}}Lt.unsubscibeToTypingChannel()}),t(s).on("click",".mck-price-submit",function(e){e.preventDefault(),o.sendPriceMessage()}),X.keydown(function(e){13===e.keyCode&&o.sendPriceMessage()}),Ee.bind("scroll",function(){if(Ee.find(".mck-contact-list").length>0){if(Ee.scrollTop()+Ee.innerHeight()>=Ee[0].scrollHeight){var e=Ee.data("datetime");e>0&&!k&&rt.loadMessageList({tabId:"",isGroup:!1,startTime:e})}}else if(0===Ee.scrollTop()){var t=Ee.data("mck-id");if(void 0===t||""===t)return;var a=Ee.data("isgroup"),s=Ee.data("mck-conversationid");s=s?s.toString():"";var e=de.data("datetime");e>0&&!k&&rt.loadMessageList({tabId:t,isGroup:a,conversationId:s,startTime:e})}}),X.on("click",function(e){e.preventDefault(),X.removeClass("mck-text-req")}),F.on("click",function(e){e.preventDefault();var t=Ee.data("mck-id"),a=Ee.data("isgroup"),s=!Ee.data("blocked");if(a)return q.removeClass("vis").addClass("n-vis"),void j.removeClass("vis").addClass("n-vis");var o=s?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"];confirm(o)&&ft.blockUser(t,s,function(e){tt.toggleBlockUser(e,s)})}),se.on("click",function(e){e.preventDefault();var t=Ee.data("mck-id"),a=Ee.data("isgroup");a?confirm(MCK_LABELS["exit.group.alert"])&&at.leaveGroup({apzCallback:ot.onGroupLeft,groupId:t}):ue.removeClass("vis").addClass("n-vis")}),t(s).on("click",".mck-add-to-group",function(e){e.preventDefault();var a=t(this).data("mck-id");void 0!==a&&ot.addGroupMemberFromSearch(a),Te.mckModal("hide")}),t(s).on("click",".mck-btn-remove-member",function(e){e.stopPropagation();var a=t(this).parents(".mck-li-group-member").data("mck-id"),s=W.data("mck-id");if(void 0!==s&&void 0!==a){var o=st.getGroup(s);"object"==typeof o&&be===o.adminName?confirm(MCK_LABELS["remove.member.alert"])&&at.removeGroupMember({groupId:s,userId:a,apzCallback:ot.onRemovedGroupMember}):ge.removeClass("vis").addClass("n-vis")}}),te.on("click",function(e){e.preventDefault();var t=W.data("mck-id");t?confirm(MCK_LABELS["exit.group.alert"])&&at.leaveGroup({groupId:t,apzCallback:ot.onGroupLeft}):it.loadTab({tabId:"",isGroup:!1})}),ee.on("click",function(e){e.preventDefault();var t=Ee.data("mck-id"),a=Ee.data("isgroup");if(a){var s={groupId:t},o=Ee.data("mck-conversationid");o&&(s.conversationId=o),ot.loadGroupInfo(s)}else ue.removeClass("vis").addClass("n-vis")}),b.on("click",function(e){e.preventDefault(),ot.loadCreateGroupTab()}),ae.on("click",function(e){e.preventDefault();var t=W.data("mck-id"),a=W.data("mck-conversation-id");if(t){var s={tabId:t,isGroup:!0};a&&(s.conversationId=a),it.loadTab(s)}else it.loadTab({tabId:"",isGroup:!1})}),le.on("click",function(e){e.preventDefault();var a=W.data("mck-id");if(a){var s=st.getGroup(a);if(!s||s.adminName!==be)return void ge.removeClass("vis").addClass("n-vis");Ae.html(""),Te.mckModal(),w.removeClass("n-vis").addClass("vis"),We.length>0?ot.addMembersToGroupSearchList():Ue?je.length>0?(t.each(je,function(e,t){We.push(t.contactId)}),ot.addMembersToGroupSearchList()):(w.removeClass("vis").addClass("n-vis"),xe.removeClass("n-vis").addClass("vis")):ct.loadContacts()}}),fe.keypress(function(e){if(13===e.which){var t=fe.val();return""!==t&&ot.addGroupMemberFromSearch(t),fe.val(""),!0}}),t(s).on("click",".mck-group-member-search-link",function(e){e.preventDefault();var t=fe.val();""!==t&&ot.addGroupMemberFromSearch(t),fe.val("")}),t(s).on("click",".mck-show-more",function(e){e.preventDefault();var a=t(this),s=a.data("tabId"),o=Ee.data("isgroup"),n=Ee.data("mck-conversationid");n=n?n.toString():"";var i=a.data("datetime");rt.loadMessageList({tabId:s,isGroup:o,conversationId:n,startTime:i})}),t(s).on("click",".mck-accept",function(e){var a=t(this).data("mck-conversationid"),s=t(this).data("mck-topic-price");if("function"==typeof re&&s&&a){var o=E[a],n=i.val(),r=at.getGroupDisplayName(n);"object"==typeof o?(re({custId:be,suppId:r,productId:o.topicId,price:s}),dt.sendConversationCloseUpdate(a)):dt.getTopicId({conversationId:a,suppId:r,priceText:s},function(e){it.populateMessage(e.messageType,e.message,e.notifyUser)})}}),v.submit(function(){1===f&&Lt.sendTypingStatus(0,Ee.data("mck-id"));var e=t.trim(Xe.textVal(u[0]));if(d.hasClass("n-vis")&&p.length>0&&(p=[]),0===e.length&&0===p.length)return u.addClass("mck-text-req"),!1;if("function"==typeof ie&&!ie(e))return!1;var s={type:5,contentType:0,message:e},n=Ee.data("mck-conversationid"),r=Ee.data("mck-topicid");if(n)s.conversationId=n;else if(r){var c={topicId:r},l=I[r];"object"==typeof l&&(c.topicDetail=a.JSON.stringify(l)),s.conversationPxy=c}var m=he.val();m&&""!=m&&(s.metadata={suggestMessageMetadata:m},he.val("")),""!=Ce.data("prev-msgkey")&&void 0!==Ce.data("prev-msgkey")&&(rt.updateMessageMetadata({key:Ce.data("prev-msgkey"),metadata:{obsolete:!0}}),Ce.data("prev-msgkey","")),Ce.hasClass("mck-text-box")&&(Ce.addClass("n-vis").removeClass("mck-text-box").val(""),u.removeClass("n-vis").addClass("mck-text-box"),Ce.data("source-url",""),t(".mck-dropup-menu").hide()),!0===Ee.data("isgroup")?s.groupId=i.val():s.to=i.val(),g.attr("disabled",!0),T.removeClass("vis").addClass("n-vis"),T.html(""),V.html(""),R.removeClass("vis").addClass("n-vis");let v=t("[data-msgtype=5]").length;if(1==v&&(KommunicateUI.leadCollectionEnabledOnAwayMessage&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId||KommunicateUI.welcomeMessageEnabled&&KommunicateUI.leadCollectionEnabledOnWelcomeMessage&&KommunicateUI.anonymousUser)){var k=KommunicateUI.validateEmail(s.message);if(!k)return!1}return o.hideSendButton(),o.sendMessage(s),!1}),P.on("click",function(){t(this).val(""),T.removeClass("vis").addClass("n-vis"),R.removeClass("vis").addClass("n-vis")}),t(s).bind("click",function(e){t(".mck-context-menu").removeClass("vis").addClass("n-vis"),!S.hasClass("on")||t(e.target).hasClass("mck-icon-upload")||t(e.target).hasClass("mck-btn-attach")||et.fileMenuToggle(),u.removeClass("mck-text-req"),s.activeElement&&s.activeElement!==u&&1===f&&Lt.sendTypingStatus(0,Ee.data("mck-id")),s.activeElement&&"mck-group-name-save"!==s.activeElement.id&&K.removeClass("mck-req-border"),s.activeElement&&"mck-btn-group-create"!==s.activeElement.id&&me.removeClass("mck-req-border"),t(".mcktypeahead.mck-dropdown-menu").hide()}),t(".mck-tabview-item").click(function(){t(".mck-tabview-item").removeClass("active"),t(this).addClass("active")})},t(".mck-sidebox").on("click","#mck-mike-btn",function(){t(this).removeClass("vis").addClass("n-vis"),t(".mck-stop-btn").addClass("vis").removeClass("n-vis"),Fr.voice.record(!1,function(){t("#mck-audio").removeClass("n-vis").addClass("vis"),rt.timer()})}),t(".mck-sidebox").on("click","#mck-stop-recording",function(){t("#mck-mike-btn").addClass("vis").removeClass("n-vis"),t(".mck-stop-btn").addClass("n-vis").removeClass("vis"),t("#mck-audio").removeClass("vis").addClass("n-vis"),rt.stoptimer(),Fr.voice.export(function(e){var a={};a.file=e,a.name="blob",t.fn.applozic("audioAttach",a)},"blob"),Fr.voice.stop()}),o.openChat=function(e,a){var s=t(e),o=s.data("mck-id");o=void 0!==o&&""!==o?o.toString():"";var i=s.data("mck-name");i=void 0!==i&&""!==i?i.toString():"";var r=s.data("mck-topicid");r=void 0!==r&&""!==r?r.toString():"";var c=!0===s.data("isgroup"),l=s.data("mck-conversationid");if(l=void 0!==l&&""!==l?l.toString():"",r&&!l){var d=t(elem).data("mck-topic-status");d=d?-1===ze.indexOf(d)?ze[0]:d.toString():ze[0],rt.getConversationId({tabId:o,isGroup:c,userName:i,topicId:r,topicStatus:d,isMessage:!1})}else it.loadTab({tabId:o,isGroup:c,userName:i,conversationId:l,topicId:r},a);n.val("")},o.sendMessage=function(e,a,s){var n,i;if(Kommunicate.internetStatus&&void 0!==t("#mck-message-cell .mck-message-inner div[name='message']:last-child").data("msgkey")&&(n=t("#mck-message-cell .mck-message-inner div[name='message']:last-child").data("msgkey"),i=dt.getReplyMessageByKey(n)),"object"==typeof e){if(e.to&&ft.MCK_USER_DETAIL_MAP[e.to]&&(ft.MCK_USER_DETAIL_MAP[e.to].deletedAtTime||!0===yt))return T.html(MCK_LABELS["user.delete"]).removeClass("n-vis").addClass("vis"),t("#mck-tab-status").removeClass("vis").addClass("n-vis"),v.removeClass("vis").addClass("n-vis"),void q.removeClass("vis").addClass("n-vis");var r=e.metadata?e.metadata:{},c=t("#mck-text-box").data("AL_REPLY");if(void 0===c||""===c||e.forward||(r.AL_REPLY=c),e.metadata=r,void 0!==e.message&&0!==e.message.length||0!==p.length){if(i&&(!i.metadata.altype||0!==i.type&&4!==i.type&&6!==i.type||(r.altype=i.metadata.altype)),e.conversationId){var l=E[e.conversationId];if("undefined"!==l&&l.closed)return it.closeConversation(),void g.attr("disabled",!1)}var d=Ee.data("blocked");if(d&&!e.groupId)return tt.toggleBlockUser(k,!0),void g.attr("disabled",!1);var m="";if(e.groupId?void 0===(m=st.getGroup(e.groupId))&&(m=st.createGroup(e.groupId)):m=e.clientGroupId?st.getGroupByClientGroupId(e.clientGroupId):it.fetchContact(e.to),t("#mck-message-cell .mck-no-data-text").length>0&&t(".mck-no-data-text").remove(),e.message&&0===p.length){var f=ve.hasClass("n-vis"),k=Ee.data("mck-id"),C=Xe.randomId();e.key=C,12!==e.contentType&&k&&k.toString()===m.contactId&&102!==e.contentType&&dt.addMessageToTab(e,m,function(e,t){it.addMessage(e,t,!0,!0,!1)});var h={tabId:m.contactId,isTopPanelAdded:f};o.submitMessage(e,h)}else if(!e.message||0===p.length||1!==e.contentType&&2!==e.contentType)p.length>0&&t.each(p,function(n,i){var r=ve.hasClass("n-vis"),c=Ee.data("mck-id"),l=Xe.randomId();e.key=l,e.fileMeta=i,e.contentType=1,12!==e.contentType&&c&&c.toString()===m.contactId&&dt.addMessageToTab(e,m,function(e,t){it.addMessage(e,t,!0,!0,!1)});var d={tabId:m.contactId,isTopPanelAdded:r},u=KommunicateUI.getAttachmentStopUploadStatus(e.key);if(!Kommunicate.internetStatus||u)return KM_PENDING_ATTACHMENT_FILE[e.key]=a,KommunicateUI.displayUploadIconForAttachment(e.key,!1),void KommunicateUI.updateAttachmentStopUploadStatus(e.key,!0);p&&-1!=p[0].contentType.indexOf("image/")?(t(".mck-timestamp-"+e.key).removeClass("vis").addClass("n-vis"),KommunicateUI.displayProgressMeter(e.key),KommunicateUI.updateAttachmentTemplate(e,e.key),"function"==typeof s&&s(e)):o.submitMessage(e,d)});else{var f=ve.hasClass("n-vis"),k=Ee.data("mck-id"),C=Xe.randomId();e.key=C;var b={};e.groupId?b.groupId=e.groupId:b.to=e.to,b.type=e.type,b.key=Xe.randomId(),b.message=e.message,b.contentType=e.contentType,e.contentType=1,e.fileMeta=p[0],e.message="",12!==e.contentType&&k&&k.toString()===m.contactId&&(dt.addMessageToTab(e,m,function(e,t){it.addMessage(e,t,!0,!0,!1)}),dt.addMessageToTab(b,m,function(e,t){it.addMessage(e,t,!0,!0,!1)}));var h={tabId:m.contactId,isTopPanelAdded:f};o.submitMessage(e,h),o.submitMessage(b,h)}u.removeClass("mck-text-req"),g.attr("disabled",!1),t("."+C+" .mck-message-status").removeClass("mck-sent-icon").addClass("mck-pending-icon"),it.addTooltip(C),it.clearMessageField(!0),p=[],delete Ve[m.contactId]}else u.addClass("mck-text-req")}},o.sendForwardMessage=function(e){var t=ALStorage.getMessageByKey(e);if(void 0!==t){t.fileMeta&&p.push(t.fileMeta);var s={type:5,contentType:t.contentType,message:t.message,forward:"forward"};t.metadata&&(t.metadata.AL_REPLY&&(t.metadata.AL_REPLY=""),s.metadata=t.metadata);var n=Ee.data("mck-conversationid"),r=Ee.data("mck-topicid");if(n)s.conversationId=n;else if(r){var c={topicId:r},l=I[r];"object"==typeof l&&(c.topicDetail=a.JSON.stringify(l)),s.conversationPxy=c}!0===Ee.data("isgroup")?s.groupId=i.val():s.to=i.val(),o.sendMessage(s)}},o.sendWelcomeMessage=function(e){var t=Xe.randomId(),a=Ee.data("mck-id"),s=Ee.data("isgroup"),o={key:t,type:4,contentType:0,to:e.sender,message:e.messageContent};if(a&&a.toString()===e.sender&&!s){var n=it.fetchContact(a);dt.addMessageToTab(o,n,function(e,t){it.addMessage(e,t,!0,!0,!1)})}Xe.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender="+encodeURIComponent(e.sender)+"&messageContent="+encodeURIComponent(e.messageContent),contentType:"text/plain",success:function(t){e.callback&&e.callback(t)}})},o.getChatContext=function(e){var a=e&&e.metadata&&"object"==typeof e.metadata.KM_CHAT_CONTEXT?e.metadata.KM_CHAT_CONTEXT:{},s=KommunicateUtils.getSettings("KM_CHAT_CONTEXT");return s="object"==typeof s?s:{},Le="object"==typeof Le?Le:{},t.extend(Le,s,a)},o.submitMessage=function(e,s){var n=e.key,i=e.metadata?e.metadata:{};_e&&(i=t.extend(e.metadata,{userStatus:4}));var r=t("#mck-text-box").data("AL_REPLY");void 0===r||""===r||e.forward||(i.AL_REPLY=r,t("#mck-text-box").data("AL_REPLY","")),e.source=Ie;var c=t("#mck-message-cell .mck-message-inner div[name='message']."+n);t.extend(i,{KM_CHAT_CONTEXT:JSON.stringify(o.getChatContext(e))}),e.metadata=i,Xe.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:a.JSON.stringify(e),contentType:"application/json",success:function(a){e&&"object"==typeof e.fileMeta&&-1!=e.fileMeta.contentType.indexOf("image/")&&(t(".mck-timestamp-"+e.key).removeClass("n-vis").addClass("vis"),KommunicateUI.updateAttachmentStopUploadStatus(e.key,!1));var o=Ee.data("mck-id");if("object"==typeof a){KommunicateUI.deleteProgressMeter(e.key,!0);var i=a.messageKey;if(o&&o.toString()===s.tabId){var r=a.conversationId;Ee.data("mck-conversationid",r),c.removeClass(n).addClass(i),c.data("msgkey",i),t("."+i+" .mck-message-status").removeClass("mck-pending-icon").addClass("mck-sent-icon").attr("title","sent"),it.addTooltip(i),s.isTopPanelAdded&&de.data("datetime",a.createdAt);var l=!0;if(e.groupId){var d=st.getGroup(e.groupId);6===d.type&&(l=!1)}l&&it.messageContextMenu(i)}if(e.conversationPxy){var m=e.conversationPxy;e.topicId&&(D[e.topicId]=[r]),E[r]=m}}else"CONVERSATION_CLOSED"===a||"BUSY_WITH_OTHER"===a?(g.attr("disabled",!1),it.closeConversation(a),c.remove(),s.isTopPanelAdded&&ve.removeClass("vis").addClass("n-vis")):"error"===a&&(g.attr("disabled",!1),T.html("Unable to process your request. Please try again"),T.removeClass("n-vis").addClass("vis"),c.remove(),s.isTopPanelAdded&&ve.removeClass("vis").addClass("n-vis"));let u=t("[data-msgtype=5]").length;1==u&&(KommunicateUI.leadCollectionEnabledOnAwayMessage&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId||KommunicateUI.welcomeMessageEnabled&&KommunicateUI.leadCollectionEnabledOnWelcomeMessage&&KommunicateUI.anonymousUser)&&KommunicateUI.displayLeadCollectionTemplate(null),u>1&&t("#mck-email-collection-box").removeClass("vis").addClass("n-vis");var p=it.getTabDisplayName(o,!1);if(!ft.MCK_USER_DETAIL_MAP[o]&&o!==p){ct.updateDisplayName(o,p);var v={userId:o,userName:p};ft.MCK_USER_DETAIL_MAP[v.userId]=v}},error:function(){T.html("Unable to process your request. Please try again."),T.removeClass("n-vis").addClass("vis"),c&&c.remove(),s.isTopPanelAdded&&ve.removeClass("vis").addClass("n-vis")}}),t("#mck-reply-to-div").removeClass("vis").addClass("n-vis")},o.updateMessageMetadata=function(e){e.metadata||e.messageKey?Xe.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",global:!1,data:a.JSON.stringify(e),contentType:"application/json",success:function(e){console.log("metadata updated: ",e)},error:function(){}}):console.log("empty metadata")},o.downloadImage=function(e){window.open(e,"_blank")},o.replyMessage=function(e){var a="",s=(Ee.data("mck-id"),dt.getReplyMessageByKey(e));u.focus().select(),t("#mck-reply-to-div").removeClass("n-vis").addClass("vis"),a=5===s.type?"You":it.getTabDisplayName(s.to,!1),t("#mck-reply-to").html(a),"object"==typeof s.fileMeta||2===s.contentType?t("#mck-reply-msg").html(it.getImageForMessagePreview(s)):t("#mck-reply-msg").html(s.message),t("#mck-text-box").data("AL_REPLY",e)},t("#close").click(function(){t("#mck-reply-to-div").removeClass("vis").addClass("n-vis"),t("#mck-text-box").data("AL_REPLY","")}),o.deleteMessage=function(e){var s=Ee.data("mck-id");void 0!==s&&Xe.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key="+e,type:"get",success:function(o){if("success"===o){var n=Ee.data("mck-id");n===s&&(t("."+e).remove(),Ee.is(":empty")&&ve.removeClass("vis").addClass("n-vis")),ALStorage.clearMckMessageArray()}else a.console.log("Unable to delete message. Please reload page.")}})},o.deleteConversation=function(){var e=Ee.data("mck-id"),t=Ee.data("isgroup"),a=Ee.data("mck-conversationid");if(void 0!==e){var s={};t?s.groupId=e:s.userId=e,a&&(s.conversationId=a),k=!0,window.Applozic.ALApiService.deleteConversation({data:s,success:function(){var t=Ee.data("mck-id");t===e&&(Ee.html(""),de.data("datetime",""),L.removeClass("n-vis").addClass("vis"),ve.removeClass("vis").addClass("n-vis"),k=!1)},error:function(){}})}},o.populateAwayStatusAndMessage=function(e,t,a,s){"AGENTS_ONLINE"===s.code?KommunicateUI.setAvailabilityStatus("online"):"SUCCESS"!==s.code||t||KommunicateUI.setAvailabilityStatus("away"),KommunicateUI.populateAwayMessage(a,s),KommunicateUI.updateLeadCollectionStatus(a,s,e.message)},o.loadMessageList=function(e,s){var n=!1,i=!1,c="",l=!1;void 0!==e.tabId&&""!==e.tabId?(c=e.isGroup?"&groupId="+e.tabId:"&userId="+encodeURIComponent(e.tabId),n=!0,e.startTime&&(c+="&endTime="+e.startTime),c+="&pageSize=30",(Ke||Me)&&e.conversationId&&(c+="&conversationId="+e.conversationId,void 0===Ze[e.tabId]?(i=!0,c+="&conversationReq=true"):it.addConversationMenu(e.tabId,e.isGroup))):(k=!0,e.startTime&&(c+="&endTime="+e.startTime),c+="&mainPageSize=60"),e.startTime||Ee.html(""),U.removeClass("n-vis").addClass("vis"),Xe.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex=0"+c,type:"get",global:!1,success:function(c){var d=!0;if(e.isGroup){Kommunicate.conversation.processConversationOpenedFromList(c);var m=c.groupFeeds[0]&&c.groupFeeds[0].metadata.CONVERSATION_ASSIGNEE,u=c.userDetails.filter(function(e){return e.userId==m})[0];u&&u.roleType!==KommunicateConstants.APPLOZIC_USER_ROLE_TYPE.BOT&&Kommunicate.getAwayMessage({applicationId:N,conversationId:e.tabId},function(e,t){o.populateAwayStatusAndMessage(c,l,e,t)})}var p=Ee.data("mck-id"),v=Ee.data("isgroup");if(e.isGroup&&!e.startTime||U.removeClass("vis").addClass("n-vis"),k=!1,(void 0===p||e.tabId===p&&""+v==""+e.isGroup)&&(c+""!="null"&&void 0!==c.message&&0!==c.message.length||(d=!1,n?e.startTime?de.data("datetime",""):e.isGroup||0!==t("#mck-message-cell .mck-message-inner div[name='message']").length||ve.removeClass("vis").addClass("n-vis"):(e.startTime,Ee.data("datetime",""))),c+""!="null"&&"error"!==c.status)){if(n){if(d&&(e.startTime>0?it.processMessageList(c,!1,!0):e.isGroup||(it.processMessageList(c,!0,!0),ve.removeClass("n-vis").addClass("vis"))),!e.startTime>0&&!e.isGroup&&"function"==typeof Q&&Q(e.tabId),c.userDetails.length>0&&t.each(c.userDetails,function(t,s){if(ft.MCK_USER_DETAIL_MAP[s.userId]=s,!e.isGroup&&(s.connected?a.MCK_OL_MAP[s.userId]=!0:(a.MCK_OL_MAP[s.userId]=!1,void 0!==s.lastSeenAtTime&&(M[s.userId]=s.lastSeenAtTime)),B||e.isGroup||(s.blockedByThis?(C[s.userId]=!0,tt.toggleBlockUser(e.tabId,!0)):s.blockedByOther?(h[s.userId]=!0,y.removeClass("mck-tab-title-w-status"),A.removeClass("vis").addClass("n-vis"),x.removeClass("vis").addClass("n-vis"),Ee.data("blocked",!1)):tt.toggleBlockUser(e.tabId,!1)),s.userName&&!e.startTime)){var o=it.getTabDisplayName(e.tabId,e.isGroup,s.userName);y.html(o),y.attr("title",o)}}),!Se||e.isGroup||e.startTime||a.MCK_OL_MAP[e.tabId]||Qe.manageOfflineMessageTime(e.tabId),c.conversationPxys.length>0){var g=new Array;t.each(c.conversationPxys,function(e,s){if("object"==typeof s&&(g.push(s),E[s.id]=s,D[s.topicId]=[s.id],s.topicDetail))try{I[s.topicId]=t.parseJSON(s.topicDetail)}catch(e){a.console.log("Incorect Topic Detail!")}}),i&&(Ze[e.tabId]=g,it.addConversationMenu(e.tabId,e.isGroup))}if(e.conversationId){var f=E[e.conversationId];"object"==typeof f&&f.closed&&it.closeConversation()}e.startTime||(e.isGroup?(ot.addGroupStatus(st.getGroup(e.tabId)),it.updateUnreadCount("group_"+e.tabId,0,!0)):it.updateUnreadCount("user_"+e.tabId,0,!0)),c.groupFeeds.length>0&&t.each(c.groupFeeds,function(a,s){var o=st.addGroup(s);if(!e.startTime){var n=s.membersId,i=[];if(t.each(n,function(e,t){void 0===it.getContact(t)&&i.push(t)}),i.length>0)e.isMessages=d,e.messageData=c,e.isLoadMessageList=!0,ct.getUsersDetail(i,e);else{ot.addGroupStatus(o);var r,l=!0;7===o.type&&(H.removeClass("vis").addClass("n-vis"),at.getContactFromGroupOfTwo(o,function(e){r=it.fetchContact(e)}),tt.lastSeenOfGroupOfTwo(r.contactId)),"kommunicate"==window.applozic.PRODUCT_ID&&(3!==o.users[be].role&&2!==o.users[be].role&&0!==o.users[be].role||H.removeClass("vis").addClass("n-vis")),6===o.type&&(ot.validateOpenGroupUser(o),l=at.isAppendOpenGroupContextMenu(o)),U.removeClass("vis").addClass("n-vis"),d?(it.processMessageList(c,!0,l),6!==o.type&&ve.removeClass("n-vis").addClass("vis")):0===t("#mck-message-cell .mck-message-inner div[name='message']").length&&ve.removeClass("vis").addClass("n-vis"),"function"==typeof Q&&Q(e.tabId)}}})}else e.startTime||(a.MCK_OL_MAP=[]),c.userDetails.length>0&&t.each(c.userDetails,function(e,t){ft.MCK_USER_DETAIL_MAP[t.userId]=t,t.connected?a.MCK_OL_MAP[t.userId]=!0:(a.MCK_OL_MAP[t.userId]=!1,void 0!==t.lastSeenAtTime&&(M[t.userId]=t.lastSeenAtTime)),it.updateUnreadCount("user_"+t.userId,t.unreadCount,!1);var s=it.getContact(""+t.userId);void 0===s?it.createContactWithDetail(t):it.updateContactDetail(s,t)}),c.groupFeeds.length>0&&t.each(c.groupFeeds,function(e,t){it.updateUnreadCount("group_"+t.id,t.unreadCount,!1),st.addGroup(t)}),c.blockedUserPxyList.blockedToUserList.length>0&&t.each(c.blockedUserPxyList.blockedToUserList,function(e,t){t.userBlocked&&(C[t.blockedTo]=!0)}),c.blockedUserPxyList.blockedByUserList.length>0&&t.each(c.blockedUserPxyList.blockedByUserList,function(e,t){t.userBlocked&&(h[t.blockedBy]=!0)}),c.conversationPxys.length>0&&t.each(c.conversationPxys,function(e,s){if(E[s.id]=s,D[s.topicId]=[s.id],s.topicDetail)try{I[s.topicId]=t.parseJSON(s.topicDetail)}catch(e){a.console.log("Incorect Topic Detail!")}}),d?(e.startTime?e.startTime&&(e.isReload=!1,n||ALStorage.updateLatestMessageArray(c.message)):(e.isReload=!0,n||ALStorage.setLatestMessageArray(c.message)),n&&ALStorage.updateMckMessageArray(c.message),it.addContactsFromMessageList(c,e)):Ee.data("datetime",""),e.isLaunch&&it.updateUnreadCountonChatIcon(c.userDetails);var b,T,S;if(c.userDetails.length>0&&c.groupFeeds.length>0)S=void 0!==e.groupName?e.groupName:it.getTabDisplayName(e.tabId,e.isGroup,e.userName),b=c.groupFeeds[0].metadata.CONVERSATION_ASSIGNEE,y.html(S),y.attr("title",S),t.each(c.userDetails,function(e,t){if(t.userId==b||t.displayName==b)return T=t,!1}),t(".mck-agent-image-container").removeClass("n-vis").addClass("vis"),t(".mck-agent-status-text").removeClass("n-vis").addClass("vis"),void 0!==T&&void 0!==T.imageLink?t(".mck-agent-image-container img").attr("src",T.imageLink):t(".mck-agent-image-container img").attr("src",KommunicateConstants.DEFAULT_PROFILE_IMAGE.URL),void 0!==T&&T.roleType===KommunicateConstants.APPLOZIC_USER_ROLE_TYPE.BOT?KommunicateUI.setAvailabilityStatus("online"):void 0!==T&&T.roleType===KommunicateConstants.APPLOZIC_USER_ROLE_TYPE.APPLICATION_WEB_ADMIN&&(void 0!==T&&1==T.connected?KommunicateUI.setAvailabilityStatus("online"):(KommunicateUI.setAvailabilityStatus("offline"),l=!0))}var L=r.data("forwardMessageKey");void 0!==L&&(rt.sendForwardMessage(L),r.data("forwardMessageKey","")),"function"==typeof s&&s(c),it.messageClubbing(!0)},error:function(e,t,o){401===e.status&&(sessionStorage.clear(),console.log("Please reload page.")),k=!1,U.removeClass("vis").addClass("n-vis"),a.console.log("Unable to load messages. Please reload page."),"function"==typeof s&&s(null,o)}})},o.updateContactList=function(e,t){var a={};t?a.groupId=e:a.userId=e,a.pageSize=1,window.Applozic.ALApiService.getMessages({data:a,success:function(a){var s=a.data;if(s+""=="null"||void 0===s.message||0===s.message.length)it.clearContactMessageData(e,t);else{var n=s.message[0];void 0!==n&&(n.groupId?at.addGroupFromMessage(n,!0,function(e,t,a){o.updateRecentConversationList(e,t,a)}):it.addContactsFromMessage(n,!0))}},error:function(a){it.clearContactMessageData(e,t)}})},o.conversationReadUpdate=function(e){var t=e.tabId,a=e.isGroup?"group_"+t:"user_"+t;if(t&&it.getUnreadCount(a)>0){var s=""+e.isGroup=="true"?"groupId="+t:"userId="+t;window.Applozic.ALApiService.conversationReadUpdate({data:s,success:function(e){it.updateUnreadCount(a,0,!0)},error:function(){}})}},o.getConversationId=function(e){if(!e.isGroup&&!e.isMessage&&e.topicStatus!==ze[1]){var s=D[e.topicId];if(s&&"object"==typeof(n=E[s])){if(Ee.data("mck-conversationid",n.id),e.conversationId=n.id,void 0!==Ze[e.tabId]){var o=Ze[e.tabId];o.push(n),Ze[e.tabId]=o}return void it.loadTab(e)}}if(e.topicId){var n={topicId:e.topicId,userId:e.tabId,status:e.topicStatus};e.isGroup?n.groupId=e.groupId:n.userId=e.tabId;var i=I[e.topicId];"object"==typeof i&&(n.topicDetail=a.JSON.stringify(i)),e.fallBackTemplatesList&&e.fallBackTemplatesList.length>0&&(n.fallBackTemplatesList=e.fallBackTemplatesList),window.Applozic.ALApiService.getConversationId({data:n,success:function(s){if("object"==typeof s&&"success"===s.status){var o=s.response;if("object"==typeof o&&"undefined"!==o.conversationPxy){var n=o.conversationPxy;if(E[n.id]=n,D[n.topicId]=[n.id],n.topicDetail)try{I[n.topicId]=t.parseJSON(n.topicDetail)}catch(e){a.console.log("Incorect Topic Detail!")}if(Ee.data("mck-conversationid",n.id),e.conversationId=n.id,void 0!==Ze[e.tabId]){var i=Ze[e.tabId];i.push(n),Ze[e.tabId]=i}if(e.isGroup){var r=st.addGroup(o);e.tabId=r.contactId}e.isMessage&&n.created?it.loadTab(e,dt.dispatchMessage):it.loadTab(e)}}},error:function(){}})}},o.sendPriceMessage=function(){var e=X.val();if(""!==e){e=t.trim(e);var a=i.val(),s=Ee.data("mck-conversationid",s),n={type:5,contentType:4,message:e};if(!0===Ee.data("isgroup")?n.groupId=a:n.to=a,Ee.data("mck-conversationid")){var s=Ee.data("mck-conversationid");n.conversationId=s;var r=E[s];"object"!==r?dt.getTopicId({conversationId:s,suppId:a,priceText:e},function(e){it.populateMessage(e.messageType,e.message,e.notifyUser)}):"function"==typeof re&&re({custId:be,suppId:a,productId:r.topicId,price:e}),X.val("")}o.sendMessage(n)}else X.addClass("mck-text-req")},o.getGroup=function(e){var s=[];t.each(e.users,function(e,t){void 0!==t.userId&&(void 0!==t.groupRole&&-1===O.indexOf(t.groupRole)||s.push(t))});var o={groupName:t.trim(e.groupName),users:s,type:e.type};e.admin&&(o.admin=e.admin),e.clientGroupId&&(o.clientGroupId=e.clientGroupId),e.groupIcon&&(o.imageUrl=e.groupIcon),o.metadata=e.metadata?e.metadata:MCK_LABELS["group.metadata"];var n=new Object;let i={"UserId-Enabled":!0,Authorization:"Basic "+c,"Application-Key":N,"Device-Key":m,"Access-Token":Z};Xe.ajax({url:MCK_BASE_URL+"/rest/ws/group/v2.1/create",global:!1,data:a.JSON.stringify(o),type:"post",headers:i,contentType:"application/json",success:function(s){if(e.isInternal&&ce.attr("disabled",!1).html(MCK_LABELS["create.group.title"]),"object"==typeof s&&"success"===s.status){var o=s.response;if("object"==typeof o){var i=st.addGroup(o);o.users.length>0&&t.each(o.users,function(e,t){ft.MCK_USER_DETAIL_MAP[t.userId]=t,t.connected?a.MCK_OL_MAP[t.userId]=!0:(a.MCK_OL_MAP[t.userId]=!1,void 0!==t.lastSeenAtTime&&(M[t.userId]=t.lastSeenAtTime)),it.updateUnreadCount("user_"+t.userId,t.unreadCount,!1);var s=it.getContact(""+t.userId);void 0===s?it.createContactWithDetail(t):it.updateContactDetail(s,t)}),e.tabId=i.contactId,e.isGroup=!0,e.isMessage?it.loadTab(e,dt.dispatchMessage):e.isInternal?(Ee.data("mck-id",i.contactId),Ee.data("isgroup",!0),ot.loadGroupInfo({groupId:i.contactId})):it.loadTab(e),"function"==typeof e.callback&&(n.updated=!!s.updated&&s.updated,n.status="success",n.data=i,e.callback(n))}}else"error"===s.status&&"function"==typeof e.callback&&(n.status="error",n.errorMessage=s.errorResponse[0].description,e.callback(n))},error:function(){e.isInternal&&ce.attr("disabled",!1).html(MCK_LABELS["create.group.title"]),"function"==typeof e.callback&&(n.status="error",n.errorMessage="Unable to process request.",e.callback(n))}})}},ct=new function(){t("#mck-search-list");var e=t("#mck-sidebox-search"),s=t("#mck-search-loading");t("#mck-search-cell .mck-message-inner"),t("#mck-message-cell .mck-message-inner"),t(".mck-tab-message-option"),t("#mck-contact-loading");this.getContactDisplayName=function(e){var t=[];window.Applozic.ALApiService.getContactDisplayName({data:{userIdArray:e},success:function(e){for(var a in e)if(e.hasOwnProperty(a)){t.push([a,e[a]]),Ye[a]=e[a];var s=it.fetchContact(a);s.displayName=e[a]}ALStorage.updateMckContactNameArray(t)},error:function(){}})},this.loadContacts=function(){var o=[];window.Applozic.ALApiService.getContactList({url:"/rest/ws/user/v3/filter?startIndex=0&pageSize=50&orderBy=1",baseUrl:MCK_BASE_URL,success:function(s){if(e.hasClass("vis"))return"object"==typeof s&&s.users.length>0&&(t.each(s.users,function(e,t){if(void 0!==t.userId){var s=it.getContact(""+t.userId);s=void 0===s?it.createContactWithDetail(t):it.updateContactDetail(s,t),je.push(s),o.push([t.userId,s.displayName]),t.connected?a.MCK_OL_MAP[t.userId]=!0:(a.MCK_OL_MAP[t.userId]=!1,void 0!==t.lastSeenAtTime&&(M[t.userId]=t.lastSeenAtTime))}}),ct.getUsersDetail(contactNameArray,{async:!1}),o.length>0&&ALStorage.updateMckContactNameArray(o)),it.addContactsToSearchList(),void ot.addMembersToGroupSearchList()},error:function(){s.removeClass("vis").addClass("n-vis"),a.console.log("Unable to load contacts. Please reload page.")}})},this.getUsersDetail=function(e,s){if(!(void 0===e||e.length<1)){for(var o=void 0===s.cached||s.cached,n=[],i=e.filter(function(t,a){return e.indexOf(t)===a}),r=0;r<i.length;r++){var c=i[r];o&&void 0!==ft.MCK_USER_DETAIL_MAP[c]||n.push(c)}if(0!==n.length){var l=new Object;window.Applozic.ALApiService.getUserDetail({data:{userIdList:n},success:function(e){"success"===e.status&&e.response.length>0&&t.each(e.response,function(e,t){ft.MCK_USER_DETAIL_MAP[t.userId]=t,a.MCK_OL_MAP[t.userId]=t.connected;var s=it.getContact(""+t.userId);s=void 0===s?it.createContactWithDetail(t):it.updateContactDetail(s,t)}),s.setStatus?tt.updateUserConnectedStatus():s.message?it.populateMessage(s.messageType,s.message,s.notifyUser):s.isLoadMessageList&&it.loadMessageListOnUserDetailFetch(s),l.status="success",l.data=e,s.callback&&s.callback(l)},error:function(){s.setStatus?tt.updateUserConnectedStatus():s.message?it.populateMessage(s.messageType,s.message,s.notifyUser):s.isLoadMessageList&&it.loadMessageListOnUserDetailFetch(s),l.status="error",s.callback&&s.callback(l)}})}else s.setStatus?tt.updateUserConnectedStatus():s.message?it.populateMessage(s.messageType,s.message,s.notifyUser):s.isLoadMessageList&&it.loadMessageListOnUserDetailFetch(s)}},this.updateUserIdentity=function(e){if(null!==e.newUserId&&""!==e.newUserId){var t="newUserId="+encodeURIComponent(e.newUserId);Xe.ajax({url:MCK_BASE_URL+"/rest/ws/user/change/identifier",type:"get",data:t,contentType:"application/json",success:function(t){"object"==typeof t&&"success"===t.status&&e.callback&&e.callback(t)},error:function(t){e.callback&&e.callback({response:"error"})}})}},this.updateUser=function(e){Xe.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/user/update",data:a.JSON.stringify(e.data),contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},this.updateDisplayName=function(e,a){if(""!==e&&""!==a){var s="userId="+e+"&displayName="+a;t.ajax({url:MCK_BASE_URL+"/rest/ws/user/name",type:"get",data:s,success:function(e){if("object"==typeof e&&"success"===e.status)return"success"},error:function(){}})}}},lt=new function(){var e,a,o,n,i=this;i.init=function(){t("#mck-sidebox"),a=t("#mck-group-info-tab"),t("#mck-sidebox-launcher"),e=t("#mck-message-cell .mck-message-inner"),o=t("#mck-msg-preview-visual-indicator"),n=t("#mck-msg-preview-visual-indicator .mck-msg-preview-visual-indicator-text")},i.notifyUser=function(e){if(!1!==e.alert&&7!==e.type&&!1!==e.metadata.alert){var t=e.groupId?st.getGroup(""+e.groupId):it.fetchContact(""+e.to.split(",")[0]),a=!1;e.groupId&&(a=!0),ft.loadUserProfile(e.to);var s=it.getTabDisplayName(t.contactId,a),o=ht;if(i.showNewMessageNotification(e,t,s),"v2"===L&&!A&&i.handleIframeNotification(),Ne&&!T){var n=ve,r=it.getTextForMessagePreview(e,t);if("function"==typeof ce&&!t.isGroup){var c=ce(t.contactId);c&&void 0!==c&&(n=c)}o?vt.sendDesktopNotification(s,n,r,o):vt.sendDesktopNotification(s,n,r)}}},i.handleIframeNotification=function(){var e=parent.document.getElementById("kommunicate-widget-iframe");e.style.width="390px",e.style.height="100px"},i.showNewMessageNotification=function(i,r,c){if(Ge&&102!==i.contentType&&!i.metadata.KM_ASSIGN&&!i.metadata.KM_STATUS){var l=e.data("mck-id"),d=e.data("isgroup");if(l===r.contactId&&d===r.isGroup&&!a.hasClass("vis")){if(!i.conversationId||!Ke&&!Me)return;var m=e.data("mck-conversationid");if((m=void 0!==m&&""!==m?m.toString():"")===i.conversationId.toString())return}n.data("isgroup",r.isGroup);var u=i.conversationId?i.conversationId:"";n.data("mck-conversationid",u);var p=it.getContactImageLink(r,c);if(i.message){var v=it.getMessageTextForContactPreview(i,r);n.html(""),n.removeClass("mck-flexi"),"object"==typeof v?n.append(v):n.html(v),o.removeClass("n-vis").addClass("vis")}else n.html("");if(i.fileMetaKey)n.html(mt.getFileIcon(i)),o.removeClass("n-vis").addClass("vis"),n.addClass("mck-flexi");else if(2===i.contentType){for(;"."===v[v.length-1];)v=v.slice(0,-1);n.html(v),o.removeClass("n-vis").addClass("vis"),n.addClass("mck-flexi")}-1!=!p.indexOf("/avatars/default.png")?(t("#launcher-agent-img-container").html(p),t("#launcher-agent-img-container").addClass("vis").removeClass("n-vis"),t("#launcher-svg-container").addClass("n-vis").removeClass("vis")):(t("#launcher-agent-img-container").html("").addClass("n-vis").removeClass("vis"),t("#launcher-svg-container").addClass("vis").removeClass("n-vis")),void 0!==ke&&document.getElementById("mck-sidebox-launcher").childNodes[0].childNodes[0].classList.add("n-vis"),n.data("mck-id",r.contactId),Lt.onNotificationEvent(i),t(s).on("click","#mck-msg-preview-visual-indicator .mck-close-btn, #mck-msg-preview-visual-indicator .mck-msg-preview-visual-indicator-text",function(){o.removeClass("vis").addClass("n-vis"),n.html("")})}}},dt=new AlMessageService,mt=new AlFileService,ut=new KmCustomTheme,pt=new KommunicateCommonFunction,vt=new MckNotificationUtils,gt=new AlNotificationService,ft=new AlUserService,kt=t(".chat-launcher-icon"),Ct=new function(){var e,a=this;a.token=null,a.Identity=null,a.outgoingCallServices=null,a.incomingCallServices=null;var s=t(".mck-videocall-btn"),o=t(".applozic-vid-container"),n=t("#mck-sidebox"),i=t("#mck-video-call-indicator"),r=t("#mck-video-box");a.hideVideoBox=function(){o.addClass("n-vis").removeClass("vis"),n.addClass("vis").removeClass("n-vis"),i.addClass("n-vis").removeClass("vis")},a.init=function(){r.mckModal(),bt.loop=!0,a.token=null!==ALStorage.getAppHeaders()?ALStorage.getAppHeaders().videoToken:void 0,a.ringToneForHost=$e.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",bt),t("#mck-btn-video-call").on("click",function(s){if(a.token){var o=$mck_msg_to.val(),n=be+(new Date).getTime().toString()+Math.random().toString(36).slice(2),i=dt.sendVideoCallMessage(n,"CALL_DIALED",102,!1,o,function(e){rt.sendMessage(e)}),r=it.fetchContact(i.to),c=it.getTabDisplayName(r.contactId,!1),l=it.getContactImageLink(r,c),d=new Date,m=be;a.outgoingCallServices=new MckCallingService(m,Ct.token,n,c,!0,d,rt,l,!1,a.ringToneForHost),a.outgoingCallServices.startVideoCall(),t("#mck-btn-video-call").data("isCallHost",!0),t("#mck-btn-video-call").data("callStartTime",d)}else"INSUFFICIENT_FUNDS"===e?alert("Video calling is not available at the moment. For details, contact support."):alert("missing token... please refresh page..")}),t("#mck-vid-receive-btn").on("click",function(e){console.log("call received"),t("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),s.removeClass("vis").addClass("n-vis");var a=t("#mck-video-call-indicator").data("call-id"),o=t("#mck-video-call-indicator").data("isAudioCall");t("#mck-video-call-indicator").data("callReceived",!0),t("#mck-video-call-indicator").addClass("n-vis"),Ct.callReceived(a,o)}),t("#mck-vid-reject-btn").on("click",function(e){console.log("call rejected");var a=t("#mck-video-call-indicator").data("call-id"),s=t("#mck-video-call-indicator").data("isAudioCall");Ct.callRejected(a,s),t("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})},a.InitilizeVideoClient=function(s,o){a.Identity=s,t.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:s,device:o},success:function(t){if(null!=t&&""!=t){a.token=t.token;var s=ALStorage.getAppHeaders();s.videoToken=t.token,ALStorage.setAppHeaders(s)}t.hasOwnProperty("errorResponse")&&(e=t.errorResponse[0].description)},error:function(e){console.log("error while getting token"+e)}})},a.callReceived=function(e,t){var s=$mck_msg_to.val();console.log("_this.callReceived"),It&&It.stop();dt.sendVideoCallMessage(e,"CALL_ANSWERED",102,t,s,function(e){rt.sendMessage(e)});a.incomingCallServices=new MckCallingService(a.Identity,a.token,e,null,!1,null,rt,null,t),a.incomingCallServices.startVideoCall()},a.callRejected=function(e,t){It&&It.stop();dt.sendVideoCallMessage(e,"CALL_REJECTED",102,t,toUser,function(e){rt.sendMessage(e)})}},ht=null,bt={},yt=!1,It=null,Mt=rt.checkArray(i.askUserDetails),Et=i.preLeadCollection?i.preLeadCollection:[],Tt=i.conversationTitle,St=i.agentId,At=i.botIds;i.agentName,"boolean"!=typeof i.useBranding||i.useBranding;a.MCK_OL_MAP=new Array,l.submitMessage=function(e){rt.submitMessage(e.messagePxy,e.optns)},l.mckLaunchSideboxChat=function(){t("#mck-sidebox-launcher").removeClass("vis").addClass("n-vis"),KommunicateUI.showChat(),t("#mck-away-msg-box").removeClass("vis").addClass("n-vis"),rt.loadConversationWithAgents({groupName:Tt,agentId:St,botIds:At},function(e){console.log("conversation created successfully"),KommunicateUI.activateTypingField()}),t("#mck-msg-preview-visual-indicator").hasClass("vis")&&t("#mck-msg-preview-visual-indicator").removeClass("vis").addClass("n-vis")},l.openChat=function(e){rt.openChat(e)},l.events={onConnectFailed:function(){console.log("onconnect failed"),navigator.onLine&&Lt.reconnect()},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){},onMessageNotification:function(e){}},l.loadConversationWithAgent=function(e){if(!e||!e.agentId)throw new Error("params are empty");console.log("setting default agent inside Applozic"),rt.loadConversationWithAgents(e)};var Lt=new function(e){var s,o,n=this,i=e.events,c=null,l=null,d="",p=null,v=[],g="",k=t("#mck-sidebox"),b=t("#mck-tab-title"),y=t(".mck-typing-box"),T=t("#mck-tab-status"),S=(t("#mck-offline-message-box"),t("#mck-typing-label")),A=t("#mck-message-cell .mck-message-inner"),L=t(".mck-message-inner");n.init=function(){if(void 0!==u){var e=Xe.startsWith(u,"https")?"15675":"15674";"function"==typeof a.SockJS&&(g||(g=new SockJS(u+":"+e+"/stomp")),(l=a.Stomp.over(g)).heartbeat.outgoing=0,l.heartbeat.incoming=0,l.onclose=function(){n.disconnect()},l.connect("guest","guest",n.onConnect,n.onError,"/"),a.addEventListener("beforeunload",function(e){n.disconnect()}))}},n.checkConnected=function(e){l.connected&&(s&&clearInterval(s),o&&clearInterval(o),s=setInterval(function(){n.connectToSocket(e)},6e5),o=setInterval(function(){n.sendStatus(1)},12e5)),n.connectToSocket(e)},n.connectToSocket=function(e){if(e&&"block"===k.css("display")){var t=A.data("mck-id");if(t){var a=A.data("isgroup"),s=A.data("mck-conversationid"),o=A.data("mck-topicid");ALStorage.clearMckMessageArray(),it.loadTab({tabId:t,isGroup:a,conversationId:s,topicId:o})}else ALStorage.clearMckMessageArray(),it.loadTab({tabId:"",isGroup:!1})}l.connected||n.init()},n.stopConnectedCheck=function(){s&&clearInterval(s),o&&clearInterval(o),s="",o="",n.disconnect()},n.disconnect=function(){console.log("socket disconnect",new Date),clearInterval(void 0),l&&(n.sendStatus(0),l.connected&&l.disconnect(),"object"==typeof g&&(g.close(),g=""))},n.unsubscibeToTypingChannel=function(){l&&l.connected&&p&&(1===f&&n.sendTypingStatus(0,d),p.unsubscribe()),p=null},n.unsubscibeToNotification=function(){l&&l.connected&&c&&c.unsubscribe(),c=null},n.subscibeToTypingChannel=function(e,t){var a=t?e:be;l&&l.connected?p=l.subscribe("/topic/typing-"+N+"-"+a,n.onTypingStatus):n.reconnect()},n.subscribeToOpenGroup=function(e){if(l&&l.connected){var t=l.subscribe("/topic/group-"+N+"-"+e.contactId,n.onOpenGroupMessage);v.push(t.id),G[e.contactId]=t.id}else n.reconnect()},n.sendTypingStatus=function(e,t){if(l&&l.connected){if(1===e&&1===f&&l.send("/topic/typing-"+N+"-"+d,{"content-type":"text/plain"},N+","+be+","+e),t){if(t===d&&e===f&&1===e)return;d=t,l.send("/topic/typing-"+N+"-"+t,{"content-type":"text/plain"},N+","+be+","+e),setTimeout(function(){f=0},6e4)}else 0===e&&l.send("/topic/typing-"+N+"-"+d,{"content-type":"text/plain"},N+","+be+","+e);f=e}},n.onTypingStatus=function(e){if(null!=p&&p.id===e.headers.subscription){var a=e.body,s=a.split(",")[1],o=Number(a.split(",")[2]),n=e.headers.destination.substring(e.headers.destination.lastIndexOf("-")+1,e.headers.destination.length),i=A.data("mck-id"),r=A.data("isgroup"),c=st.getGroup(i);if(!C[s]&&!h[s])if(1===o){if(!(be===s&&r||i!==s&&i!=n)){var r=A.data("isgroup");if(r){if(s!==be){if(at.authenticateGroupUser(c)||6===c.type&&!de.disableChatForNonGroupMember){b.addClass("mck-tab-title-w-typing"),T.removeClass("vis").addClass("n-vis");var l=it.getTabDisplayName(s,!1);l=l.split(" ")[0],S.html(l+" "+MCK_LABELS["is.typing"])}7===c.type&&(b.addClass("mck-tab-title-w-typing"),S.html(MCK_LABELS["is.typing"]),T.html(""))}}else b.addClass("mck-tab-title-w-typing"),T.removeClass("vis").addClass("n-vis");t(".km-typing-wrapper").remove(),L.append('<div class="km-typing-wrapper"><div class="km-typing-indicator"></div><div class="km-typing-indicator"></div><div class="km-typing-indicator"></div></div>'),L.animate({scrollTop:L.prop("scrollHeight")},0),setTimeout(function(){b.removeClass("mck-tab-title-w-typing"),t(".km-typing-wrapper").remove(),b.hasClass(void 0===c||7!=c.type),S.html(MCK_LABELS.typing)},1e4)}}else b.removeClass("mck-tab-title-w-typing"),y.removeClass("vis").addClass("n-vis"),t(".km-typing-wrapper").remove(),b.hasClass("mck-tab-title-w-status")&&(void 0===c||c.type),S.html(MCK_LABELS.typing)}},n.reconnect=function(){console.log("socket trying to reconnect",new Date),n.unsubscibeToTypingChannel(),n.unsubscibeToNotification(),n.disconnect(),n.init()},n.onNotificationEvent=function(e){i.onMessageNotification(e)},n.onError=function(e){a.console.log("Error in channel notification. "+e),setTimeout(function(){i.onConnectFailed()},3e4)},n.sendStatus=function(e){l&&l.connected&&l.send("/topic/status-v2",{"content-type":"text/plain"},r+","+m+","+e)},n.onConnect=function(){console.log("inside onconnect"),l.connected?(c&&n.unsubscibeToNotification(),c=l.subscribe("/topic/"+r,n.onMessage),n.sendStatus(1),n.checkConnected(!0)):setTimeout(function(){c=l.subscribe("/topic/"+r,n.onMessage),n.sendStatus(1),n.checkConnected(!0)},5e3),i.onConnect()},n.onOpenGroupMessage=function(e){if(-1!==v.indexOf(e.headers.subscription)){var a=t.parseJSON(e.body),s=a.type,o=a.message;if("APPLOZIC_03"===s)ALStorage.updateLatestMessage(o),0!==o.type&&4!==o.type&&(t("."+o.key+" .mck-message-status").removeClass("mck-pending-icon").addClass("mck-sent-icon").attr("title","sent"),it.addTooltip(o.key)),i.onMessageSentUpdate({messageKey:o.key});else if("APPLOZIC_01"===s||"APPLOZIC_02"===s||"MESSAGE_RECEIVED"===s){ALStorage.updateLatestMessage(o);var n=o.groupId?st.getGroup(o.groupId):it.getContact(o.to);t("#mck-sidebox-content"),A.data("mck-id");if("APPLOZIC_01"===s||"MESSAGE_RECEIVED"===s){var r=it.getMessageFeed(o);i.onMessageReceived({message:r})}else if("APPLOZIC_02"===s){var r=it.getMessageFeed(o);i.onMessageSent({message:r})}if(o.conversationId){var c=E[o.conversationId];!Ke&&!Me||"object"==typeof c&&"object"==typeof I[c.topicId]||dt.getTopicId({conversationId:o.conversationId,messageType:s,message:o,notifyUser:a.notifyUser,async:!1,populate:!1},function(e){it.populateMessage(e.messageType,e.message,e.notifyUser)})}if(void 0===n){var l={message:o,messageType:s,notifyUser:a.notifyUser};if(o.groupId)ot.getGroupFeedFromMessage(l);else{var d=[];d.push(o.to),ct.getUsersDetail(d,l)}return}it.populateMessage(s,o,a.notifyUser)}}},n.onMessage=function(e){if(null!=c&&c.id===e.headers.subscription){var s=t.parseJSON(e.body),o=s.type;if("APPLOZIC_04"===o||"MESSAGE_DELIVERED"===o)t("."+s.message.split(",")[0]+" .mck-message-status").removeClass("mck-pending-icon").removeClass("mck-sent-icon").addClass("mck-delivered-icon").attr("title","delivered"),it.addTooltip(s.message.split(",")[0]),i.onMessageDelivered({messageKey:s.message.split(",")[0]});else if("APPLOZIC_08"===o||"MT_MESSAGE_DELIVERED_READ"===o)t("."+s.message.split(",")[0]+" .mck-message-status").removeClass("mck-pending-icon").removeClass("mck-sent-icon").removeClass("mck-delivered-icon").addClass("mck-read-icon"),it.addTooltip(s.message.split(",")[0]),i.onMessageRead({messageKey:s.message.split(",")[0]});else if("APPLOZIC_05"===o){var n=s.message.split(",")[0],r=s.message.split(",")[1],l="1"===s.message.split(",")[2];it.removedDeletedMessage(n,r,l);var d={messageKey:s.message.split(",")[0]};l?d.groupId=r:d.userKey=r,i.onMessageDeleted(d)}else if("APPLOZIC_27"===o){var m=s.message.split(",")[0],u=s.message.split(",")[1];if(void 0!==m){it.removeConversationThread(m,!1),it.updateUnreadCount("user_"+m,0,!0);var p={userId:m};u&&(p.topicId=u),i.onConversationDeleted(p)}}else if("APPLOZIC_11"===o){var m=s.message,v=it.fetchContact(m),r=A.data("mck-id");if(!C[m]&&!h[m]){if(r!==v.contactId||A.data("isgroup")){var g=mckContactUtils.formatContactId(m);t("#li-user-"+g+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else t("#mck-tab-status").html(MCK_LABELS.online),Se&&it.hideOfflineMessage();t(".mck-user-ol-status."+g).removeClass("n-vis").addClass("vis"),t(".mck-user-ol-status."+g).next().html("("+MCK_LABELS.online+")"),a.MCK_OL_MAP[m]=!0,ft.updateUserStatus({userId:s.message,status:1},function(e){ct.getUsersDetail(e,{})})}i.onUserConnect({userId:s.message})}else if("APPLOZIC_12"===o){var m=s.message.split(",")[0],f=s.message.split(",")[1],v=it.fetchContact(m);if(a.MCK_OL_MAP[m]=!1,f&&(M[m]=f),!C[m]&&!h[m]){var r=A.data("mck-id");r!==v.contactId||A.data("isgroup")||(t("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(f)),Se&&Qe.manageOfflineMessageTime(r)),t(".mck-user-ol-status."+v.htmlId).removeClass("vis").addClass("n-vis"),t(".mck-user-ol-status."+v.htmlId).next().html("(Offline)"),t("#li-user-"+g+" .mck-ol-status").removeClass("vis").addClass("n-vis"),ft.updateUserStatus({userId:m,status:0,lastSeenAtTime:f},function(e){ct.getUsersDetail(e,{})})}i.onUserDisconnect({userId:m,lastSeenAtTime:f})}else if("APPLOZIC_29"===o){var m=s.message.split(",")[0],u=s.message.split(",")[1],v=it.fetchContact(m);it.updateUnreadCount("user_"+v.contactId,0,!0);var r=A.data("mck-id");void 0!==r&&""!==r||(t("#li-user-"+v.htmlId+" .mck-unread-count-text").html(it.getUnreadCount("user_"+v.contactId)),t("#li-user-"+v.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis"));var p={userId:m};u&&(p.topicId=u),i.onConversationReadFromOtherSource(p)}else if("APPLOZIC_28"===o){var m=s.message.split(",")[0],u=s.message.split(",")[1],r=A.data("mck-id");if(r===m){t(".mck-msg-right .mck-message-status").removeClass("mck-pending-icon").removeClass("mck-sent-icon").removeClass("mck-delivered-icon").addClass("mck-read-icon"),t(".mck-msg-right .mck-delivered-icon").attr("title","delivered and read");var v=it.getContact(m);if(void 0===v){var k=[];k.push(m),ct.getUsersDetail(k,{})}}var p={userId:m};u&&(p.topicId=u),i.onConversationRead(p)}else if("APPLOZIC_16"===o){var S=s.message.split(":")[0],m=s.message.split(":")[1],v=it.fetchContact(m),r=A.data("mck-id");r===v.contactId?S===Pe[0]?(C[v.contactId]=!0,tt.toggleBlockUser(r,!0)):(h[v.contactId]=!0,b.removeClass("mck-tab-title-w-status"),T.removeClass("vis").addClass("n-vis"),y.removeClass("vis").addClass("n-vis")):t("#li-user-"+v.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),i.onUserBlocked({status:S,userId:m})}else if("APPLOZIC_17"===o){var S=s.message.split(":")[0],m=s.message.split(":")[1],v=it.fetchContact(m),r=A.data("mck-id");r===v.contactId?S===Pe[2]?(C[v.contactId]=!1,tt.toggleBlockUser(r,!1)):(a.MCK_OL_MAP[r]||M[r])&&(h[v.contactId]=!1,C[r]||(a.MCK_OL_MAP[r]?T.html(MCK_LABELS.online):M[r]&&T.html(mckDateUtils.getLastSeenAtStatus(M[r])),b.addClass("mck-tab-title-w-status"))):a.MCK_OL_MAP[r]&&t("#li-user-"+v.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis"),i.onUserUnblocked({status:S,userId:m})}else if("APPLOZIC_18"===o)B=!1,i.onUserActivated();else if("APPLOZIC_19"===o)B=!0,i.onUserDeactivated();else{var L=s.message;if("APPLOZIC_03"===o)ALStorage.updateLatestMessage(L),0!==L.type&&4!==L.type&&(t("."+L.key+" .mck-message-status").removeClass("mck-pending-icon").addClass("mck-sent-icon"),it.addTooltip(L.key)),i.onMessageSentUpdate({messageKey:L.key});else if("APPLOZIC_01"===o||"APPLOZIC_02"===o||"MESSAGE_RECEIVED"===o){ALStorage.updateLatestMessage(L);var v=L.groupId?st.getGroup(L.groupId):it.getContact(L.to),r=(t("#mck-sidebox-content"),A.data("mck-id"));if("APPLOZIC_01"===o||"MESSAGE_RECEIVED"===o){var x=it.getMessageFeed(L);i.onMessageReceived({message:x})}else if("APPLOZIC_02"===o){var x=it.getMessageFeed(L);i.onMessageSent({message:x})}if(L.conversationId){var _=E[L.conversationId];!Ke&&!Me||"object"==typeof _&&"object"==typeof I[_.topicId]||dt.getTopicId({conversationId:L.conversationId,messageType:o,message:L,notifyUser:s.notifyUser,async:!1,populate:!1},function(e){it.populateMessage(e.messageType,e.message,e.notifyUser)})}if(void 0===v){var w={message:L,messageType:o,notifyUser:s.notifyUser};if(L.groupId)ot.getGroupFeedFromMessage(w);else{var k=[];k.push(L.to),ct.getUsersDetail(k,w)}return}if(102==L.contentType&&q)if(s.notifyUser=!1,4==L.type&&"CALL_DIALED"==L.metadata.MSG_TYPE){var v=it.fetchContact(L.to),K=it.getTabDisplayName(v.contactId,!1),U=it.getContactImageLink(v,K);t("#mck-video-call-indicator").data("call-id",L.metadata.CALL_ID),t("#mck-video-call-indicator").data("isAudioCall",L.metadata.CALL_AUDIO_ONLY),t("#mck-video-call-indicator-txt").html(K+" calling..."),t("#mck-video-call-icon").html(U),t("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),It.play(),setTimeout(function(){var e=t("#mck-video-call-indicator").data("callReceived");e||(console.log("call is not answered"),It.stop(),t("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6e4)}else if(4==L.type&&"CALL_REJECTED"==L.metadata.MSG_TYPE&&t("#mck-btn-video-call").data("isCallHost")){var N=$mck_msg_to.val();dt.sendVideoCallMessage(L.metadata.CALL_ID,"CALL_REJECTED",103,!1,N,function(e){rt.sendMessage(e)}),Ct.ringToneForHost.stop(),Ct.outgoingCallServices.twilioService.leaveRoomIfJoined(),Ct.hideVideoBox(),Ct.outgoingCallServices&&(Ct.outgoingCallServices.rejectedByReceiver=!0)}if(103==L.contentType)4==L.type&&"CALL_MISSED"==L.metadata.MSG_TYPE&&(t("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),It&&It.stop());else{var w={};w.messageType=o,w.message=L,w.notifyUser=s.notifyUser,L.to&&ct.getUsersDetail([L.to],w)}}}}}}(l);l.getOptions=function(){return i},l.init=function(){window.Applozic.ALApiService.initServerUrl(MCK_BASE_URL),mt.get(i),dt.init(i),ut.init(i),pt.init(i),gt.init(i),it.init(),bt.loop=!1,he&&($e=new RingToneService,ht=$e.loadRingTone(he,bt)),rt.init(),nt.init(),ot.init(),Qe.initializeApp(i,!1),lt.init(),et.init(),_&&(document.getElementById("mck-btn-smiley-box").classList.remove("n-vis"),it.initEmojis()),q&&(bt.loop=!0,$e=new RingToneService,It=$e.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",bt),Ct.init()),"v2"===L&&"file:"==window.frameElement.getAttribute("data-protocol")&&pt.modifyClassList({id:["km-local-file-system-warning"]},"vis","n-vis")},l.reInit=function(e){KommunicateUtils.storeDataIntoKmSession("appOptions",e),"object"===t.type(e)&&(e=t.extend(!0,{},o,e),i.conversationTitle=i.conversationTitle||i.groupName,i.accessToken=i.password||i.accessToken,t.fn.applozic("reset",e),e.userId&&e.appId&&""!==t.trim(e.userId)&&""!==t.trim(e.appId)?(Qe.initializeApp(e,!0),i=e):a.console("Oops! looks like incorrect application id or user Id."))},l.loadTabView=function(e){void 0===e.isGroup&&(e.isGroup=!1),it.loadTab(e),t("#mck-search").val("")},l.loadTab=function(e,a){it.loadTab({tabId:e,isGroup:!1},a),t("#mck-search").val("")},l.loadChat=function(e){if(!(void 0!==e.userId&&""!==e.userId||void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId))return"UserId or groupId or clientGroupId required";var a={tabId:e.userId,isGroup:!1},a={};if(e.userId&&(a.tabId=userId,a.isGroup=!1),e.displayName&&(a.userName=e.displayName),e.convId&&(a.conversationId=e.convId),e.groupId||e.clientGroupId)if(a.isGroup=!0,e.clientGroupId){a.clientGroupId=e.clientGroupId;var s=st.getGroupByClientGroupId(e.clientGroupId);if("object"!=typeof s)return at.getGroupFeed({clientGroupId:a.clientGroupId,apzCallback:ot.onGroupFeed,callback:ot.loadGroupTab}),void t("#mck-search").val("");a.tabId=s.contactId}else{var s=st.getGroup(e.groupId);if("object"!=typeof s)return at.getGroupFeed({groupId:e.groupId,apzCallback:ot.onGroupFeed,callback:ot.loadGroupTab}),void t("#mck-search").val("");a.tabId=e.groupId}it.loadTab(a),t("#mck-search").val("")},l.uploadFile=function(e){nt.uploadFile(e)},l.uploadAttachemnt=function(e){nt.uploadAttachemnt(e.params,e.messagePxy)},l.audioAttach=function(e){nt.audioRecoder(e)},l.loadGroupTab=function(e,a){if(void 0===e||""===e)return"GroupId required";var s=st.getGroup(e);"object"==typeof s?(it.loadTab({tabId:e,isGroup:!0},a),t("#mck-search").val("")):at.getGroupFeed({groupId:e,apzCallback:ot.onGroupFeed,callback:ot.loadGroupTab})},l.loadGroupTabByClientGroupId=function(e){if(void 0===e.clientGroupId||""===e.clientGroupId)return"Client Group Id Required";var a=st.getGroupByClientGroupId(e.clientGroupId);"object"==typeof a?(it.loadTab({tabId:a.contactId,isGroup:!0}),t("#mck-search").val("")):at.getGroupFeed({clientGroupId:e.clientGroupId,apzCallback:ot.onGroupFeed,callback:ot.loadGroupTab})},l.loadConvTab=function(e){"object"==typeof e&&e.userId&&e.convId&&it.loadTab({tabId:e.userId,conversationId:e.convId,isGroup:!1})},l.loadTabWithTopic=function(e){if("object"==typeof e&&(e.userId||e.groupId)&&e.topicId){var t={tabId:e.userId,topicId:e.topicId};if(e.userName&&(t.userName=e.userName),e.topicStatus?t.topicStatus=-1===ze.indexOf(e.topicStatus)?ze[0]:e.topicStatus.toString():t.topicStatus=ze[0],"function"==typeof oe||e.topicDetail){var a=e.topicDetail?e.topicDetail:oe(e.topicId);"object"==typeof a&&"undefined"!==a.title&&(I[e.topicId]=a)}if(e.message){var s={type:5,contentType:0,message:message};t.messagePxy=s,t.isMessage=!0}else t.isMessage=!1;e.supportId?(t.isGroup=!0,t.supportId=supportId):(t.isGroup=!1,t.userId=e.userId),rt.getConversationId(t)}else{if(!e.userId||!e.groupId)return"UserId required";if(!e.topicId)return"TopicId required"}},l.loadContacts=function(e){it.loadContacts(e)},l.loadContactsForContactList=function(e){it.loadContactsForContactList(e)},l.setOffline=function(){void 0!==Lt&&Lt.sendStatus(0)},l.reset=function(e){a.sessionStorage.clear(),r="",c="",p=[],MCK_GROUP_MAP=[],v=!0,g=[],m="",w=e.mode,"",C=[],h=[],k=!1,b=90,N=e.appId,M=[],E=[],I=[],MCK_CLIENT_GROUP_MAP=[],T=!0,MCK_LABELS=e.labels,S=0,MCK_BASE_URL=e.baseUrl,Ce=e.fileupload,K=e.customFileUrl,qe=new Object,He=new Array,z=e.launcher,0,G=[],F=e.userName,P=e.visitor,D=[],je=new Array,Ve=new Object,H=e.fileBaseUrl,$=e.locShare,q=i.video,j=e.onInit,V=e.onTopicDetails,Ye=new Array,Je=new Array,J=e.onClose,Z=e.password||e.accessToken,W=e.displayText,Q=e.readConversation,X=e.maxGroupSize,Ze=new Array,ee=e.onTabClicked,te=e.contactNumber,se=e.appModuleName,oe=e.getTopicDetail,ae=e.maxAttachmentSize,ie=e.validateMessage,ne=e.contactDisplayName,We=new Array,re=e.finalPriceResponse,ce=e.contactDisplayImage,le=e.priceWidget,de=i.openGroupSettings,me=e.offlineMessageDetail,e.initAutoSuggestions,pe=e.getConversationDetail,ue=e.authenticationTypeId,be=P?"guest":t.trim(e.userId),ye=$?e.googleApiKey:"NO_ACCESS",Ee="boolean"==typeof e.olStatus&&e.olStatus,Me="boolean"==typeof e.topicBox&&e.topicBox,Se="boolean"==typeof e.showOfflineMessage&&e.showOfflineMessage,Ke="boolean"==typeof e.topicHeader&&e.topicHeader,Ge="boolean"!=typeof e.notification||e.notification,"boolean"==typeof e.swNotification&&e.swNotification,e.supportId?'data-mck-id="'+e.supportId+'"':"",Ae="boolean"==typeof e.hideGroupSubtitle&&e.hideGroupSubtitle,Le=void 0===e.defaultMessageMetaData?{}:e.defaultMessageMetaData,xe="boolean"==typeof e.groupUserCount&&e.groupUserCount,Ne="boolean"==typeof e.desktopNotification&&e.desktopNotification,Ue="boolean"==typeof e.loadOwnContacts&&e.loadOwnContacts,Te="boolean"==typeof e.messageBubbleAvator&&e.messageBubbleAvator,we="boolean"==typeof i.resetUserStatus&&i.resetUserStatus,Re="boolean"==typeof e.launchOnNewMessage&&e.launchOnNewMessage,Oe="boolean"!=typeof e.autoTypeSearchEnabled||e.autoTypeSearchEnabled,_e="boolean"==typeof e.checkUserBusyWithStatus&&e.checkUserBusyWithStatus,De="boolean"==typeof e.launchOnUnreadMessage&&e.launchOnUnreadMessage,Mt=i.askUserDetails},l.logout=function(){void 0!==Lt&&(Lt.disconnect(),ALStorage.clearMckMessageArray(),KommunicateUtils.removeItemFromLocalStorage("kommunicate"),window.Applozic.ALApiService.setAjaxHeaders("","","","",""),ALStorage.clearMckMessageArray(),ALStorage.clearMckContactNameArray(),ALStorage.clearAppHeaders(),t.fn.applozic("reset",i),KommunicateUtils.deleteCookie(KommunicateConstants.COOKIES.KOMMUNICATE_LOGGED_IN_USERNAME),KommunicateUtils.deleteCookie(KommunicateConstants.COOKIES.KOMMUNICATE_LOGGED_IN_ID),t("#mck-sidebox").hide(),t("#mck-sidebox-launcher").hide(),parent.document.getElementById("kommunicate-widget-iframe")&&(parent.document.getElementById("kommunicate-widget-iframe").style.display="none")),v=!1},l.setOnline=function(){void 0!==Lt&&Lt.sendStatus(1)},l.getUserStatus=function(e){"function"==typeof e.callback&&(void 0!==e.userIds?ct.getUsersDetail(e.userIds,e):ft.getUserStatus(e,function(e){t.each(e.users,function(e,t){var a=it.getContact(""+t.userId);a=void 0===a?it.createContactWithDetail(t):it.updateContactDetail(a,t),We.push(a.contactId)})}))},l.getGroupList=function(e){return"function"==typeof e.callback?(e.apzCallback=ot.loadGroups,at.loadGroups(e),"success"):"Callback Function Required"},l.leaveGroup=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?(e.apzCallback=ot.onGroupLeft,at.leaveGroup(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"}):"Callback Function Required"},l.addGroupMember=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?void 0===e.userId||""===e.userId?void e.callback({status:"error",errorMessage:"UserId required"}):void 0!==e.role&&-1===O.indexOf(e.role)?void e.callback({status:"error",errorMessage:"Incorrect member role"}):(ft.loadUserProfile(e.userId),e.apzCallback=ot.onAddedGroupMember,at.addGroupMember(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"}):"Callback function required"},l.removeGroupMember=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?void 0===e.userId||""===e.userId?void e.callback({status:"error",errorMessage:"UserId required"}):(e.apzCallback=ot.onRemovedGroupMember,at.removeGroupMemberFromChat(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"}):"Callback function required"},l.updateGroupInfo=function(e){if("object"!=typeof e)return"Unsupported format. Please check format";if("function"==typeof e.callback){if(!(void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId))return void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});if(!(void 0!==e.name&&""!==e.name||void 0!==e.imageUrl&&""!==e.imageUrl||e.users&&0!==e.users.length))return void e.callback({status:"error",errorMessage:"Group properties required"});if(e.users&&e.users.length>0){var a=[];if(t.each(e.users,function(e,t){t.userId&&void 0!==t.role&&-1!==O.indexOf(t.role)&&a.push(t)}),0===a.length)return void e.callback({status:"error",errorMessage:"Incorrect users detail"})}var a=[];return t(".mck-group-change-role-box.vis").each(function(e,s){var o=t(this),n=parseInt(o.find("select").val()),i=o.parents(".mck-li-group-member").data("role");if(n!==i){var r={userId:o.parents(".mck-li-group-member").data("mck-id"),role:n};a.push(r)}}),e.apzCallback=ot.onUpdateGroupInfo,at.updateGroupInfo(e),"success"}return"Callback function required"},l.getMessages=function(e){"function"==typeof e.callback&&dt.getMessages(e)},l.getMessageList=function(e){return void 0!==e&&"function"==typeof e.callback?(dt.getMessageList(e,function(e){if(void 0!==e.to||void 0!==e.groupId){var t=it.getMessageFeed(e);messageFeeds.push(t)}}),"success"):"Callback function required"},l.getMessageListByTopicId=function(e){if("object"!=typeof e)return"Unsupported format. Please check format";if("function"==typeof e.callback){if(!(void 0!==e.id&&""!==e.id||void 0!==e.clientGroupId&&""!==e.clientGroupId))return void e.callback({status:"error",errorMessage:"Id or clientGroupId required"});if(e.id&&"boolean"!=typeof e.isGroup)return void e.callback({status:"error",errorMessage:"IsGroup parameter required"});if(!e.topicId)return void e.callback("TopicId required");e.id&&(e.tabId=e.id),e.topicStatus=ze[0];var t=D[e.topicId];return t&&"object"==typeof E[t]?(e.conversationId=t,dt.getMessageList(e,function(e){if(void 0!==e.to||void 0!==e.groupId){var t=it.getMessageFeed(e);messageFeeds.push(t)}})):(e.isExtMessageList=!0,e.pageSize=1,dt.fetchConversationByTopicId(e,function(e){rt.getMessageList(e)})),"success"}return"Callback function required."},l.sendMessage=function(e){if("object"==typeof e){var a=(e=t.extend(!0,{},n,e)).message;if(!e.to)return"To field required";if(void 0===a||""===a)return"Message field required";if(e.type>12)return"Invalid message type";a=t.trim(a);var s={to:t.trim(e.to),type:e.messageType,contentType:e.type,message:a,metadata:e.metadata};return rt.sendMessage(s),"success"}return"Unsupported format. Please check format"},l.updateUserIdentity=function(e){ct.updateUserIdentity(e)},l.updateUser=function(e){ct.updateUser(e)},l.getGroupListByFilter=function(e){at.getGroupByFilter(e)},l.updateMessageMetadata=function(e){rt.updateMessageMetadata(e)},l.sendGroupMessage=function(e){if("object"==typeof e){var a=(e=t.extend(!0,{},n,e)).message;if(!e.groupId&&!e.clientGroupId)return"groupId or clientGroupId required";if(void 0===a||""===a)return"message field required";if(e.type>12)return"invalid message type";a=t.trim(a);var s={type:e.messageType,contentType:e.type,message:a,metadata:e.metadata||{}};if(e.groupId)s.groupId=t.trim(e.groupId);else if(e.clientGroupId){var o=st.getGroupByClientGroupId(e.clientGroupId);if(void 0===o)return"group not found";s.clientGroupId=t.trim(e.clientGroupId)}return rt.sendMessage(s),"success"}return"Unsupported format. Please check format"},l.addWelcomeMessage=function(e){return"object"!=typeof e?"Unsupported format. Please check format":void 0===e.sender||""===e.sender?"Sender Field Required":void 0===e.messageContent||""===e.messageContent?"Message Content Required":void rt.sendWelcomeMessage(e)},l.createGroup=function(e){if("object"==typeof e){if("function"==typeof e.callback){var t=e.users;return void 0===t||t.length<1?void e.callback({status:"error",errorMessage:"Users list required"}):t.length>X?void e.callback({status:"error",errorMessage:"Users limit exceeds "+X+". Max number of users allowed is "+X+"."}):e.groupName?void 0===e.type||""===e.type?void e.callback({status:"error",errorMessage:"Group type required"}):-1===R.indexOf(e.type)?void e.callback({status:"error",errorMessage:"Invalid group type"}):(rt.getGroup(e),"success"):void e.callback({status:"error",errorMessage:"Group name required"})}return"Callback function required"}return"Unsupported Format. Please check format"},l.triggerMsgNotification=function(){0!=Fe&&(MCK_TRIGGER_MSG_NOTIFICATION_PARAM=setTimeout(function(){l.getLatestConversationForMsgTriggetTimerout()},Fe))},l.getLatestConversationForMsgTriggetTimerout=function(){rt.loadMessageList({tabId:"",isGroup:!1},function(e){if(e&&e.groupFeeds&&0!==e.groupFeeds.length&&e.message&&0!==e.message.length){var t=e.groupFeeds[0].id,a=e.message.filter(function(e){return e.groupId==t})[0];a.type!==KommunicateConstants.MESSAGE_TYPE.SENT&&lt.notifyUser(a)}else Kommunicate.startConversation({groupName:Tt,agentId:St,botIds:At,isMessage:!1,isInternal:!0})})},l.initGroupTab=function(e){if("object"==typeof e){var t=e.users;return void 0===t||t.length<1?"Users List Required":t.length>X?"Users limit exceeds "+X+". Max number of users allowed is "+X+".":e.groupName?void 0===e.type?"Group type required":-1===R.indexOf(e.type)?"Invalid group type":(rt.getGroup(e),"success"):"Group name required"}return"Unsupported format. Please check format"},l.getTotalUnreadCount=function(){return S},l.subscribeToEvents=function(e){"object"==typeof e&&("function"==typeof e.onConnectFailed&&(l.events.onConnectFailed=e.onConnectFailed),"function"==typeof e.onConnect&&(l.events.onConnect=e.onConnect),"function"==typeof e.onMessageDelivered&&(l.events.onMessageDelivered=e.onMessageDelivered),"function"==typeof e.onMessageRead&&(l.events.onMessageRead=e.onMessageRead),"function"==typeof e.onMessageDeleted&&(l.events.onMessageDeleted=e.onMessageDeleted),"function"==typeof e.onConversationDeleted&&(l.events.onConversationDeleted=e.onConversationDeleted),"function"==typeof e.onUserConnect&&(l.events.onUserConnect=e.onUserConnect),"function"==typeof e.onUserDisconnect&&(l.events.onUserDisconnect=e.onUserDisconnect),"function"==typeof e.onConversationReadFromOtherSource&&(l.events.onConversationReadFromOtherSource=e.onConversationReadFromOtherSource),"function"==typeof e.onConversationRead&&(l.events.onConversationRead=e.onConversationRead),"function"==typeof e.onMessageReceived&&(l.events.onMessageReceived=e.onMessageReceived),"function"==typeof e.onMessageSentUpdate&&(l.events.onMessageSentUpdate=e.onMessageSentUpdate),"function"==typeof e.onMessageSent&&(l.events.onMessageSent=e.onMessageSent),"function"==typeof e.onUserBlocked&&(l.events.onUserBlocked=e.onUserBlocked),"function"==typeof e.onUserUnblocked&&(l.events.onUserUnblocked=e.onUserUnblocked),"function"==typeof e.onUserActivated&&(l.events.onUserActivated=e.onUserActivated),"function"==typeof e.onMessageNotification&&(l.events.onMessageNotification=e.onMessageNotification),"function"==typeof e.onUserDeactivated&&(l.events.onUserDeactivated=e.onUserDeactivated))},l.getConversation=function(e){dt.getTopicId({conversationId:e.conversationId},function(e){it.populateMessage(e.messageType,e.message,e.notifyUser)})}}(i);l.data("applozic_instance",u),u.init()}else alert("Oops! looks like incorrect application id or user Id.")},t.fn.applozic.defaults=o}($applozic,window,document);var kmCustomTheme=new KmCustomTheme;function KmCustomTheme(){var e,t=this;t.init=function(a){(e=a.widgetSettings)&&t.changeColorTheme()},t.KmCustomImageIcon=function(e){return"<img src="+e+"></img>"},t.createCustomClasses=function(e){var t=document.createElement("style");t.type="text/css",t.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(t)},t.customSideboxWidget=function(){var a="#5553B7";if(e){var s=".km-custom-widget-background-color { background: "+(a=e&&e.primaryColor?e.primaryColor:"#5553B7")+" !important;} .km-custom-widget-border-color { border-color: "+a+" !important;} .km-custom-widget-text-color { color: "+a+" !important;} .km-custom-widget-fill { fill: "+a+" !important;} ";t.createCustomClasses(s)}else{var o=".km-chat-widget-background-color { background: "+a+" !important}";t.createCustomClasses(o)}return'<div id="launcher-svg-container" class="km-chat-icon-sidebox km-custom-widget-background-color km-chat-widget-background-color">'+t.returnCustomWidget()+"</div>"},t.returnCustomWidget=function(){return e?"image"===e.iconIndex?t.KmCustomImageIcon(e.widgetImageLink):KommunicateConstants.CUSTOM_WIDGETS_SVG[e.iconIndex]:KommunicateConstants.CUSTOM_WIDGETS_SVG[1]},t.changeColorTheme=function(){for(var t=document.getElementsByClassName("mck-box-top"),a=0;a<t.length;a++)t[a].style.backgroundColor=e.primaryColor}}function KommunicateCommonFunction(){var e,t,a,s=this;s.init=function(s){e=s.customerCreatedAt,t="boolean"!=typeof s.useBranding||s.useBranding,a=s.widgetSettings},s.isStartupPlan=function(e){return e&&e.pricingPackage&&e.pricingPackage===KommunicateConstants.PRICING_PACKAGE.STARTUP},s.isKommunicatePlanExpired=function(e){return s.getDaysCount()>31&&s.isStartupPlan(e)},s.getDaysCount=function(){var t=new Date,a=new Date(e),s=t.getTime()-a.getTime();return Math.ceil(s/864e5)},s.showPoweredBy=function(e){var o=s.isKommunicatePlanExpired(e);return!!t&&(!!o||(a&&void 0!==a.showPoweredBy?a.showPoweredBy:!e||!e.pricingPackage||e.pricingPackage!=KommunicateConstants.PRICING_PACKAGE.ENTERPRISE_MONTHLY&&e.pricingPackage!=KommunicateConstants.PRICING_PACKAGE.ENTERPRISE_YEARLY))},s.classListChanger=function(e,t,a){t&&e.classList.add(t),a&&e.classList.remove(a)},s.modifyClassList=function(e,t,a){var o=e.id,n=e.class,i=[];o&&o.forEach(function(e){document.getElementById(e)&&i.push(document.getElementById(e))}),n&&n.forEach(function(e){for(var t=document.getElementsByClassName(e),a=0;a<=t.length-1;a++)t&&i.push(t[a])}),i.forEach(function(e){s.classListChanger(e,t,a)})}}const mck_actionable_message_plugin_svgs={arrow:{left:'<svg xmlns="http://www.w3.org/2000/svg" width="10" height="11" viewBox="0 0 10 19"><path fill="#5B5959" fill-rule="evenodd" d="M9.076 18.266c.21.2.544.2.753 0a.53.53 0 0 0 0-.753L1.524 9.208 9.829.903a.53.53 0 0 0 0-.752.546.546 0 0 0-.753 0L.026 9.208l9.05 9.058z"/></svg>'}};Kommunicate.attachEvents=function(e){e("#mck-message-cell").on("click",".km-increment-guest-count",Kommunicate.richMsgEventHandler.incrementGuestCount),e("#mck-message-cell").on("click",".km-decrement-guest-count",Kommunicate.richMsgEventHandler.decrementGuestCount),e("#mck-message-cell").on("click",".km-btn-add-more-rooms",Kommunicate.richMsgEventHandler.addMoreRoom),e("#mck-message-cell").on("click",".km-done-button",Kommunicate.richMsgEventHandler.processSelectedRoom),e("#mck-message-cell").on("click",".km-card-message-footer-button",Kommunicate.richMsgEventHandler.processHotelBookClick),e("#mck-message-cell").on("click",".km-cta-button",Kommunicate.richMsgEventHandler.handlleRichButtonClick),e("#mck-message-cell").on("click",".km-submit-person-detail",Kommunicate.richMsgEventHandler.handlleSubmitPersonDetail),e("#mck-message-cell").on("click",".km-block-room-button",Kommunicate.richMsgEventHandler.processBookRoomClick),e("#mck-message-cell").on("click",".km-quick-replies",Kommunicate.richMsgEventHandler.processQuickReplies),e("#mck-message-cell").on("click",".km-list-item-handler",Kommunicate.richMsgEventHandler.processClickOnListItem),e("#mck-message-cell").on("click",".km-list-button-item-handler",Kommunicate.richMsgEventHandler.processClickOnButtonItem),e("#mck-message-cell").on("click",".km-faq-dialog-button",Kommunicate.richMsgEventHandler.processClickOnDialogButton),e("#mck-message-cell").on("click",".km-progress-meter-container",Kommunicate.attachmentEventHandler.manageUploadAttachment),e("#mck-message-cell").on("click",".km-link-button",Kommunicate.richMsgEventHandler.handleLinkButtonClick)},Kommunicate.attachmentEventHandler={manageUploadAttachment:function(e){var t=$applozic(e.target).closest(".km-msg-box-attachment").find(".km-progress-stop-upload-icon").hasClass("n-vis"),a=$applozic(e.target).closest(".km-msg-box-attachment").find(".km-progress-upload-icon").hasClass("n-vis"),s=$applozic(e.target).closest(".km-msg-box-attachment").children();let o=s[0].dataset.msgkey;var n=$applozic(e.target).closest(".mck-clear").find(".mck-msg-right-muted");if(Kommunicate.internetStatus)if(!t&&a)KommunicateUI.updateAttachmentStopUploadStatus(o,!0),Kommunicate.attachmentEventHandler.progressMeter(100,o),$applozic(".km-progress-stop-upload-icon-"+o).removeClass("vis").addClass("n-vis"),$applozic(".km-progress-upload-icon-"+o).removeClass("n-vis").addClass("vis"),Kommunicate.attachmentEventHandler.progressMeter(100,o),$applozic(".mck-timestamp-"+o).removeClass("n-vis").addClass("vis"),n[0].querySelector(".mck-sending-failed").style.display="block";else{KommunicateUI.updateAttachmentStopUploadStatus(o,!1);let t=s[0].dataset.filemetakey,a=s[0].dataset.filename,i=s[0].dataset.filesize,r=s[0].dataset.fileurl,c=s[0].dataset.filetype,l=s[0].dataset.groupid,d=s[0].dataset.thumbnailurl;if(i&&r&&t&&a&&c){messagePxy={contentType:1,groupId:l,fileMeta:{blobKey:t,url:r,contentType:c,size:i,key:t,thumbnailUrl:r,name:a},message:"",type:5,metadata:{},key:o};let s={messagePxy:messagePxy,optns:{tabId:l}};$applozic.fn.applozic("submitMessage",s),$applozic(e.target).closest(".km-msg-box-progressMeter").children().removeClass("km-progress-meter-back-drop"),$applozic(e.target).closest(".km-msg-box-progressMeter").addClass("n-vis"),$applozic(".mck-timestamp-"+o).removeClass("n-vis").addClass("vis"),n[0].querySelector(".mck-sending-failed").style.display="none"}else if(d&&l&&o){messagePxy={contentType:1,groupId:l,key:o,fileMeta:{thumbnailUrl:d,contentType:1,isUploaded:!1},message:"",type:5,metadata:{}};let t=KM_PENDING_ATTACHMENT_FILE[o];params={params:{file:t,name:t.name},messagePxy:messagePxy},$applozic.fn.applozic("uploadAttachemnt",params),$applozic(".mck-timestamp-"+o).removeClass("n-vis").addClass("vis"),n[0].querySelector(".mck-sending-failed").style.display="none",delete KM_PENDING_ATTACHMENT_FILE[o],$applozic(e.target).closest(".km-msg-box-progressMeter").children().removeClass("km-progress-meter-back-drop")}}else KommunicateUI.displayUploadIconForAttachment(o,!1),KommunicateUI.updateAttachmentStopUploadStatus(o,!0)},progressMeter:function(e,t){document.getElementById("km-progress-meter-input");let a=".progress-meter-"+t+" .km-progress-value";KommunicateUI.getAttachmentStopUploadStatus(t)&&(e=100);var s=document.querySelector(a);if(s){s.style.strokeDasharray=KM_PROGRESS_METER_CIRCUMFERENCE;var o=KM_PROGRESS_METER_CIRCUMFERENCE*(1-e/100);s.style.strokeDashoffset=o}}},Kommunicate.richMsgEventHandler={initializeSlick:function(e){if(e.length>0)tns({container:e[0],edgePadding:60,items:1,slideBy:"page",loop:!1,controlsText:[mck_actionable_message_plugin_svgs.arrow.left,mck_actionable_message_plugin_svgs.arrow.left],mouseDrag:!0,arrowKeys:!0,onInit:function(){console.log("tiny-slider initilized")}})},decrementGuestCount:function(e){var t=e.target||e.srcElement,a=t.dataset.type;"guest"==a?t.parentElement.getElementsByClassName("km-room-number-field")[0].stepDown():"children"==a&&t.parentElement.getElementsByClassName("km-person-number-field")[0].stepDown()},incrementGuestCount:function(e){var t=e.target||e.srcElement,a=t.dataset.type;"guest"==a?t.parentElement.getElementsByClassName("km-room-number-field")[0].stepUp():"children"==a&&t.parentElement.getElementsByClassName("km-person-number-field")[0].stepUp()},decrementPersonCount:function(){document.getElementById("km-person-number-field").stepDown()},incrementPersonCount:function(){document.getElementById("km-person-number-field").stepUp()},addMoreRoom:function(e){var t=e.target.parentElement.parentElement.parentElement,a=Number(e.target.dataset.roomcount)+1;e.target.setAttribute("data-roomcount",a);var s=document.createElement("div");s.innerHTML=Kommunicate.markup.getSingleRoomPaxInfo(a),t.getElementsByClassName("km-room-person-selector-container")[0].appendChild(s)},processSelectedRoom:function(e){for(var t=[],a=$(e.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-room-number-field"),s=$(e.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-person-number-field"),o="",n=0;n<a.length;n++){let e=s[n].value,i=Array(1*e).fill(10);t.push({NoOfAdults:a[n].value,NoOfChild:e,ChildAge:i}),o+="Room "+(n+1)+" Guest "+a[n].value+"\n"}var i={message:o,metadata:{isRoomGuestJSON:!0,roomGuestJson:JSON.stringify(t),guestTypeId:"ADULTS"}};Kommunicate.sendMessage(i)},processHotelBookClick:function(e){var t=e.target||e.srcElement,a=t.dataset.sessionid,s=t.dataset.resultindex,o={message:"Get room detail of "+t.dataset.name.replace("_"," "),metadata:{hotelSelected:!0,sessionId:a,resultIndex:s,skipDialogflow:!0}};Kommunicate.sendMessage(o)},processBookRoomClick:function(e){var t=e.target||e.srcElement,a=t.dataset.sessionid,s=t.dataset.roomindex,o=t.dataset.noofrooms,n="undefined"==t.dataset.hotelname?"":t.dataset.hotelname,i=t.dataset.hotelresultindex,r={message:"Book "+n.replace("_"," "),metadata:{sessionId:a,RoomIndex:s,NoOfRooms:o,blockHotelRoom:!0,skipDialogflow:!0,HotelResultIndex:i}},c=$applozic("#mck-message-cell .mck-message-inner"),l=$applozic("#mck-msg-to");!0===c.data("isgroup")?r.groupId=l.val():r.to=l.val(),$applozic.fn.applozic("sendGroupMessage",r)},handlleRichButtonClick:function(e){var t=e.target||e.srcElement,a=t.dataset.requesttype,s=t.title||t.innerHTML,o=t.dataset.buttontype,n={},i=t.parentElement.getElementsByClassName("km-btn-hidden-form")[0];if("submit"==o){if("json"==a){for(var r=i.getElementsByTagName("input"),c=0;c<r.length;c++)n[r[c].name]=r[c].value;window.Applozic.ALApiService.ajax({url:i.action,async:!1,type:"post",data:JSON.stringify(n),contentType:"application/json",success:function(e){},error:function(e,t,a){console.log("error while sending data ",a)}})}else i.submit();if(s){var l={message:s};Kommunicate.sendMessage(l)}}},handlleSubmitPersonDetail:function(e){var t=$applozic(e.target).closest(".km-guest-details-container").find(".km-title-select option:selected").text(),a=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.km-age-input"),s=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.first-name-input"),o=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.middle-name-input"),n=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.last-name-input"),i=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.e-mail-input"),r=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.number-input");if(""!=s[0].value&&""!=n[0].value&&""!=i[0].value&&""!=r[0].value){var c={Title:"title"===t?"":t,Age:a[0].value,FirstName:s[0].value,MiddleName:o[0].value,LastName:n[0].value,EmailId:i[0].value,PhoneNo:r[0].value},l=(e.target||e.srcElement).dataset.sessionid,d={message:c.Title+" "+c.FirstName+" "+c.LastName+"\n"+c.EmailId+"\n"+c.PhoneNo,metadata:{sessionId:l,guestDetail:!0,skipDialogflow:!0,personInfo:JSON.stringify(c)}};Kommunicate.sendMessage(d),console.log("passenger detail submitted")}else $applozic(e.target).closest(".km-guest-details-container").find(".km-mandatory-field-error").removeClass("n-vis").addClass("vis")},processQuickReplies:function(e){var t=e.target.title,a={};try{a=JSON.parse(e.target.dataset.metadata)}catch(e){}var s={message:t,metadata:a};Kommunicate.sendMessage(s)},processClickOnListItem:function(e){var t=e.currentTarget,a=t.dataset.reply,s=t.dataset.type,o=t.dataset.articleid,n=t.dataset.source,i={};try{i=JSON.parse(t.dataset.metadata)}catch(e){}if(i.KM_FAQ_ID=o,i.source=n,s&&"quick_reply"==s){var r={message:a,metadata:i};Kommunicate.sendMessage(r)}},processClickOnButtonItem:function(e){var t=e.currentTarget,a=t.dataset.reply,s=t.dataset.type;if(s&&"quick_reply"==s){var o={message:a,metadata:{KM_BUTTON_CLICKED:!0}};Kommunicate.sendMessage(o)}},processClickOnDialogButton:function(e){var t=e.currentTarget,a=t.dataset.reply,s={};try{s=JSON.parse(t.dataset.metadata)}catch(e){}s.skipBot=void 0===s.skipBot||s.skipBot;var o={message:a,metadata:s};Kommunicate.sendMessage(o)},handleLinkButtonClick:function(e){window.open(e.target.dataset.url,e.target.dataset.target)}};var kommunicateCommonFunction=new KommunicateCommonFunction;function RingToneService(){this.loadRingTone=function(e,t){return new Howl({src:[e],loop:t.loop})}}KommunicateUI={awayMessageInfo:{},awayMessageScroll:!0,leadCollectionEnabledOnAwayMessage:!1,welcomeMessageEnabled:!1,leadCollectionEnabledOnWelcomeMessage:!1,anonymousUser:!1,faqSVGImage:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><circle class="km-custom-widget-fill" cx="12" cy="12" r="12" fill="#5553B7" fill-rule="nonzero" opacity=".654"/><g transform="translate(6.545 5.818)"><polygon fill="#FFF" points=".033 2.236 .033 12.057 10.732 12.057 10.732 .02 3.324 .02"/><rect class="km-custom-widget-fill" width="6.433" height="1" x="2.144" y="5.468" fill="#5553B7" fill-rule="nonzero" opacity=".65" rx=".5"/><rect class="km-custom-widget-fill" width="4.289" height="1" x="2.144" y="8.095" fill="#5553B7" fill-rule="nonzero" opacity=".65" rx=".5"/><polygon class="km-custom-widget-fill" fill="#5553B7" points="2.656 .563 3.384 2.487 1.162 3.439" opacity=".65" transform="rotate(26 2.273 2.001)"/></g></g></svg>',CONSTS:{},updateLeadCollectionStatus:function(e,t,a){KommunicateUI.awayMessageInfo={},e||"SUCCESS"!=t.code&&"AGENTS_ONLINE"!=t.code||(KommunicateUI.leadCollectionEnabledOnAwayMessage=t.data.collectEmailOnAwayMessage,"AGENTS_ONLINE"!=t.code&&t.data.messageList.length>0&&(KommunicateUI.awayMessageInfo.eventId=t.data.messageList[0].eventId,KommunicateUI.awayMessageInfo.isEnabled=!0),KommunicateUI.leadCollectionEnabledOnWelcomeMessage=t.data.collectEmailOnWelcomeMessage,KommunicateUI.welcomeMessageEnabled=t.data.welcomeMessageEnabled,KommunicateUI.anonymousUser=t.data.anonymousUser,KommunicateUI.displayLeadCollectionTemplate(a))},populateAwayMessage:function(e,t){var a=$applozic("#mck-tab-individual").hasClass("n-vis"),s=$applozic("#mck-conversation-status-box").hasClass("vis");!e&&"SUCCESS"==t.code&&t.data.messageList.length>0&&!a&&!s?(awayMessage=t.data.messageList[0].message,$applozic("#mck-away-msg").html(awayMessage),$applozic("#mck-away-msg-box").removeClass("n-vis").addClass("vis")):$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis");var o=document.querySelectorAll(".mck-message-inner.mck-group-inner")[0];KommunicateUI.awayMessageScroll&&o&&(o.scrollTop=o.scrollHeight,KommunicateUI.awayMessageScroll=!1)},showAwayMessage:function(){var e=$applozic("#mck-tab-individual").hasClass("n-vis");KommunicateUI.awayMessageInfo&&KommunicateUI.awayMessageInfo.isEnabled&&!e&&($applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-away-msg-box").removeClass("n-vis").addClass("vis"))},hideAwayMessage:function(){$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis")},displayLeadCollectionTemplate:function(e){if(e&&e.length){let a=0;for(var t=0;t<e.length&&(5!=e[t].type||2!=++a);t++);1==a?(KommunicateUI.leadCollectionEnabledOnAwayMessage&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId||KommunicateUI.welcomeMessageEnabled&&KommunicateUI.leadCollectionEnabledOnWelcomeMessage&&KommunicateUI.anonymousUser)&&(this.populateLeadCollectionTemplate(),this.hideAwayMessage()):this.hideLeadCollectionTemplate()}else null==e&&(this.populateLeadCollectionTemplate(),this.hideAwayMessage())},displayProgressMeter:function(e,t){$applozic(".progress-meter-"+e).removeClass("n-vis").addClass("vis"),$applozic(".mck-attachment-"+e).next().removeClass("n-vis").addClass("vis"),$applozic(".mck-attachment-"+e+" .mck-image-download").addClass("n-vis")},deleteProgressMeter:function(e,t){$applozic(".progress-meter-"+e).remove(),t&&$applozic(".mck-attachment-"+e).next().removeClass("vis").addClass("n-vis")},displayUploadIconForAttachment:function(e,t){$applozic(".progress-meter-"+e+" .km-progress-upload-icon").removeClass("n-vis").addClass("vis"),$applozic(".progress-meter-"+e+" .km-progress-stop-upload-icon").removeClass("vis").addClass("n-vis"),Kommunicate.attachmentEventHandler.progressMeter(100,e),!t&&$applozic(".mck-attachment-"+e).next().removeClass("n-vis").addClass("vis")},updateImageAttachmentPreview:function(e,t){let a=$applozic(".mck-attachment-"+t)[0].dataset.thumbnailurl;$applozic(".mck-attachment-"+t+" .file-preview-link").attr("data-url",a)},hideFileBox:function(e,t,a){-1!=e.type.indexOf("image/")?(t.removeClass("vis").addClass("n-vis"),a.attr("disabled",!1)):t.removeClass("n-vis").addClass("vis")},updateAttachmentTemplate:function(e,t){let a=document.querySelector(".mck-message-inner.mck-group-inner").querySelector(".mck-attachment-"+t);a.setAttribute("data-filemetakey",e.blobKey),a.setAttribute("data-filename",e.name),a.setAttribute("data-fileurl",e.thumbnailUrl||e.fileMeta.thumbnailUrl),a.setAttribute("data-filesize",e.size),a.setAttribute("data-filetype",e.contentType||e.fileMeta.contentType)},updateAttachmentStopUploadStatus:function(e,t){document.querySelector(".mck-message-inner.mck-group-inner").querySelector(".mck-attachment-"+e).setAttribute("data-stopupload",t)},getAttachmentStopUploadStatus:function(e){var t=$applozic(".mck-attachment-"+e).attr("data-stopupload");return t="true"==t},populateLeadCollectionTemplate:function(){KommunicateUI.hideAwayMessage(),$applozic("#mck-email-collection-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-btn-attach-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-text-box").blur(),$applozic("#mck-text-box").attr("data-text","Your email ID")},hideLeadCollectionTemplate:function(){$applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-email-error-alert-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-btn-attach-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-text-box").attr("data-text",MCK_LABELS["input.message"])},validateEmail:function(e){return e.match(/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/)?($applozic("#mck-email-error-alert-box").removeClass("vis").addClass("n-vis"),this.hideLeadCollectionTemplate(),window.$applozic.fn.applozic("updateUser",{data:{email:e}}),!0):($applozic("#mck-email-error-alert-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis"),!1)},faqEvents:function(e,t){var a;$applozic(d).on("click","#mck-msg-preview, #mck-msg-preview-visual-indicator .mck-msg-preview-visual-indicator-text",function(){KommunicateUI.showChat()}),$applozic(d).on("click",".km-faq-list",function(){$applozic("#km-faqanswer").empty(),"km-faq-answer-list"!==MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-1]&&MCK_EVENT_HISTORY.push("km-faq-answer-list");var a=$(this).attr("data-articleid"),s=$(this).attr("data-source");KommunicateKB.getArticle({data:{appId:e.appId,articleId:a,source:s,helpdocsAccessKey:t},success:function(e){0==$applozic("#km-faqanswer .km-faqanswer-list").length&&($applozic("#km-faqanswer").append('<div class="km-faqanswer-list km-faqanswerscroll ql-snow"><div class="km-faqquestion">'+e.data.title+'</div> <div class="km-faqanchor km-faqanswer ql-editor">'+e.data.body+"</div></div>"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-individual").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-conversation").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer .km-faqanswer").linkify({target:"_blank"}))},error:function(){}}),$applozic(".km-contact-input-container").removeClass("vis").addClass("n-vis")}),$applozic(d).on("click","#km-faq",function(){MCK_MAINTAIN_ACTIVE_CONVERSATION_STATE&&KommunicateUtils.removeItemFromLocalStorage("mckActiveConversationInfo"),KommunicateUI.showHeader(),KommunicateUI.awayMessageScroll=!0,"km-faq-list"!==MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-1]&&MCK_EVENT_HISTORY.push("km-faq-list"),$applozic("#km-contact-search-input-box").removeClass("n-vis").addClass("vis"),$applozic("#km-faq").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"),$applozic(".faq-common").removeClass("n-vis").addClass("vis"),$applozic(".mck-conversation ").removeClass("vis").addClass("n-vis"),$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis"),$applozic(".mck-conversation-back-btn").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-title").html("FAQ").removeClass("n-vis").addClass("vis"),$applozic("#mck-away-msg-box").addClass("n-vis").removeClass("vis"),$applozic("#mck-sidebox-ft").addClass("n-vis").removeClass("vis"),$applozic("#mck-contacts-content").addClass("n-vis").removeClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),$applozic(".km-contact-input-container").removeClass("n-vis").addClass("vis"),$applozic(".mck-agent-image-container").removeClass("vis").addClass("n-vis"),$applozic(".mck-agent-status-text").removeClass("vis").addClass("n-vis"),$applozic("#mck-tab-individual .mck-tab-link.mck-back-btn-container").removeClass("n-vis").addClass("vis-table"),$applozic("#mck-tab-individual .mck-name-status-container.mck-box-title").removeClass("padding")}),$applozic(d).on("click","#km-faqanswer a",function(e){e.preventDefault(),window.open(e.target.href)}),$applozic("#km-faq-search-input").keyup(function(s){s.target.value.length>0?$applozic(".km-clear-faq-search-icon").addClass("vis").removeClass("n-vis"):$applozic(".km-clear-faq-search-icon").addClass("n-vis").removeClass("vis"),clearTimeout(a),a=setTimeout(function(){KommunicateKB.getArticles({data:{appId:e.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:t},success:function(e){e.data&&0===e.data.length&&$applozic(".km-no-results-found-container").hasClass("n-vis")?($applozic(".km-no-results-found-container").addClass("vis").removeClass("n-vis"),$applozic(".km-talk-to-human-div p").text("We are here to help."),$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis")):($applozic(".km-no-results-found-container").addClass("n-vis").removeClass("vis"),$applozic(".km-talk-to-human-div p").text(MCK_LABELS["looking.for.something.else"]),$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis")),$applozic("#km-faq-list-container").empty(),$applozic.each(e.data,function(e,t){$applozic("#km-faq-list-container").append('<li class="km-faq-list" data-source="'+t.source+'" data-articleId="'+t.articleId+'"><a class="km-faqdisplay"> <div class="km-faqimage">'+KommunicateUI.faqSVGImage+'</div><div class="km-faqanchor">'+t.title+"</div></a></li>")})},error:function(){}})},500),32!=s.which&&13!=s.which||KommunicateKB.getArticles({data:{appId:e.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:t},success:function(e){e.data&&0===e.data.length&&$applozic(".km-no-results-found-container").hasClass("n-vis")?($applozic(".km-no-results-found-container").addClass("vis").removeClass("n-vis"),$applozic(".km-talk-to-human-div p").text("We are here to help. "),$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis")):($applozic(".km-no-results-found-container").addClass("n-vis").removeClass("vis"),$applozic(".km-talk-to-human-div p").text(MCK_LABELS["looking.for.something.else"]),$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis")),$applozic("#km-faq-list-container").empty(),$applozic.each(e.data,function(e,t){$applozic("#km-faq-list-container").append('<li class="km-faq-list" data-source="'+t.source+'" data-articleId="'+t.articleId+'"><a class="km-faqdisplay"> <div class="km-faqimage">'+KommunicateUI.faqSVGImage+'</div> <div class="km-faqanchor ">'+t.title+"</div></a></li>")})},error:function(){}})}),$applozic(d).on("click",".km-clear-faq-search-icon",function(){$applozic("#km-faq-search-input").val(""),$applozic(".km-clear-faq-search-icon").addClass("n-vis").removeClass("vis");var e=jQuery.Event("keyup");e.which=13,$applozic("#km-faq-search-input").trigger(e)}),$applozic(d).on("click","#mck-conversation-back-btn",function(){if($applozic(".km-contact-input-container").removeClass("vis").addClass("n-vis"),MCK_MAINTAIN_ACTIVE_CONVERSATION_STATE&&KommunicateUtils.removeItemFromLocalStorage("mckActiveConversationInfo"),KommunicateUI.awayMessageScroll=!0,KommunicateUI.hideAwayMessage(),KommunicateUI.hideLeadCollectionTemplate(),MCK_EVENT_HISTORY.length>=2){if("km-faq-list"==MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-2])return KommunicateUI.showHeader(),$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic("#km-contact-search-input-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),$applozic(".km-contact-input-container").removeClass("n-vis").addClass("vis"),void MCK_EVENT_HISTORY.splice(MCK_EVENT_HISTORY.length-1,1);if("object"==typeof MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-2]){$applozic(".mck-conversation ").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-conversation").removeClass("n-vis").addClass("vis"),$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic(".km-talk-to-human-div").addClass("n-vis").removeClass("vis"),$applozic(".mck-agent-image-container").removeClass("n-vis").addClass("vis"),$applozic(".mck-agent-status-text").removeClass("n-vis").addClass("vis");let e=MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-2];return $applozic.fn.applozic("openChat",e),MCK_MAINTAIN_ACTIVE_CONVERSATION_STATE&&KommunicateUtils.setItemToLocalStorage("mckActiveConversationInfo",{groupId:e.dataset.mckId}),MCK_EVENT_HISTORY.splice(MCK_EVENT_HISTORY.length-1,1),void KommunicateUI.activateTypingField()}return $applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),MCK_EVENT_HISTORY.splice(MCK_EVENT_HISTORY.length-1,1),void(MCK_EVENT_HISTORY.length=0)}return $applozic(".mck-conversation ").removeClass("n-vis").addClass("vis"),$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic(".km-talk-to-human-div").addClass("n-vis").removeClass("vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),document.getElementById("mck-tab-title").textContent="",void(MCK_EVENT_HISTORY.length=0)})},hideFaq:function(){$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic(".km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#mck-msg-new").attr("disabled",!1)},hideMessagePreview:function(){$applozic("#mck-msg-preview-visual-indicator").removeClass("vis").addClass("n-vis"),$applozic("#mck-msg-preview-visual-indicator .mck-msg-preview-visual-indicator-text").html("")},showChat:function(){$applozic(".faq-common").removeClass("vis").addClass("n-vis"),$applozic(".mck-conversation").removeClass("n-vis").addClass("vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),0===$applozic("#mck-message-cell .mck-message-inner div[name='message']").length&&1==isFirstLaunch?($applozic("#mck-tab-individual .mck-tab-link.mck-back-btn-container").addClass("n-vis"),$applozic("#mck-tab-individual .mck-name-status-container.mck-box-title").addClass("padding"),isFirstLaunch=!1):($applozic("#mck-tab-individual .mck-tab-link.mck-back-btn-container").removeClass("n-vis"),$applozic("#mck-tab-individual .mck-name-status-container.mck-box-title").removeClass("padding"))},showHeader:function(){$applozic("#mck-tab-individual").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-conversation").removeClass("vis").addClass("n-vis"),$applozic("#mck-msg-new").attr("disabled",!1)},sendFaqQueryAsMsg:function(e){var t=$applozic("#km-faq-search-input").val();if(""!==t){var a={groupId:e,type:5,contentType:0,message:'Hi, I have a query regarding \n"'+t+'"\n\n Can you help me out?'};$applozic.fn.applozic("sendGroupMessage",a)}},activateTypingField:function(){$applozic("#mck-text-box").focus()},setAvailabilityStatus:function(e){$applozic(".mck-agent-image-container .mck-agent-status-indicator").removeClass("mck-status--online").removeClass("mck-status--offline").removeClass("mck-status--away").addClass("mck-status--"+e),$applozic("#mck-agent-status-text").text(MCK_LABELS[e]).addClass("vis").removeClass("n-vis")},showClosedConversationBanner:function(e){var t=MCK_LABELS["closed.conversation.message"],a=document.getElementById("mck-conversation-status-box");e?(a&&(a.innerHTML=t),kommunicateCommonFunction.modifyClassList({id:["mck-sidebox-ft"]},"mck-closed-conv-banner"),kommunicateCommonFunction.modifyClassList({id:["mck-conversation-status-box"]},"vis","n-vis")):(kommunicateCommonFunction.modifyClassList({id:["mck-sidebox-ft"]},"","mck-closed-conv-banner"),kommunicateCommonFunction.modifyClassList({id:["mck-conversation-status-box"]},"n-vis","vis"))}},Kommunicate.ApplozicEvents={onMessageNotification:function(e){Kommunicate.KmEventHandler.notificationEvent(e)},onMessageReceived:function(e){var t=e&&e.message,a=t.metadata&&"HIDDEN"!=t.metadata.category&&"true"!=t.metadata.hide;t.metadata&&!a||KommunicateUI.hideAwayMessage()},onMessageSent:function(e){KommunicateUI.showClosedConversationBanner(!1)}},Kommunicate.KmEventHandler={openChatOnNotification:function(e){"block"!==document.getElementById("mck-sidebox").style.display&&(e&&e.groupId?(document.getElementById("launcher-agent-img-container").classList.remove("vis"),document.getElementById("launcher-agent-img-container").classList.add("n-vis"),document.getElementById("launcher-svg-container").classList.remove("n-vis"),document.getElementById("launcher-svg-container").classList.add("vis"),window.Kommunicate.openConversation(e.groupId)):window.Kommunicate.openDirectConversation(e.to),KommunicateUI.hideMessagePreview())},notificationEvent:function(e){KommunicateUtils.getDataFromKmSession("appOptions").openConversationOnNewMessage?Kommunicate.KmEventHandler.openChatOnNotification(e):document.getElementById("launcher-agent-img-container").classList.contains("vis")&&(document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.add("n-vis"),document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.remove("vis"))}},Kommunicate.postPluginInitialization=function(e,t){Kommunicate.initilizeEventListners(),$applozic.fn.applozic("subscribeToEvents",Kommunicate.ApplozicEvents),KommunicateKB.init(Kommunicate.getBaseUrl());var a=KommunicateUtils.getDataFromKmSession("HELPDOCS_KEY");null==a||""==a?Kommunicate.client.getThirdPartySettings({appId:t.appId,type:1},function(e,s){if(e)console.log("err : ",e);else if(s&&"SUCCESS"==s.code){var o=s.message.filter(function(e){return e.type==KommunicateConstants.THIRD_PARTY_APPLICATION.HELPDOCS})[0];o?(a=o.accessKey,KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY",o.accessKey)):KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY","null"),Kommunicate.helpdocsInitialization(t,a)}}):Kommunicate.helpdocsInitialization(t,a),MCK_MAINTAIN_ACTIVE_CONVERSATION_STATE&&Kommunicate.getActiveConversation()&&Kommunicate.openConversation(Kommunicate.getActiveConversation().groupId)},Kommunicate.helpdocsInitialization=function(e,t){"null"==t&&(t=null),KommunicateKB.getArticles({data:{appId:e.appId,query:"",helpdocsAccessKey:t},success:function(a){a.data&&a.data.length>0&&$applozic(".km-kb-container").hasClass("n-vis")&&$applozic(".km-kb-container").removeClass("n-vis").addClass("vis"),$applozic.each(a.data,function(e,t){$applozic("#km-faq-list-container").append('<li class="km-faq-list" data-source="'+t.source+'" data-articleId="'+t.articleId+'"><a class="km-faqdisplay"><div class="km-faqimage"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><circle class="km-custom-widget-fill" cx="12" cy="12" r="12" fill="#5553B7" fill-rule="nonzero" opacity=".654"/><g transform="translate(6.545 5.818)"><polygon fill="#FFF" points=".033 2.236 .033 12.057 10.732 12.057 10.732 .02 3.324 .02"/><rect class="km-custom-widget-fill" width="6.433" height="1" x="2.144" y="5.468" fill="#5553B7" fill-rule="nonzero" opacity=".65" rx=".5"/><rect class="km-custom-widget-fill" width="4.289" height="1" x="2.144" y="8.095" fill="#5553B7" fill-rule="nonzero" opacity=".65" rx=".5"/><polygon class="km-custom-widget-fill" fill="#5553B7" points="2.656 .563 3.384 2.487 1.162 3.439" opacity=".65" transform="rotate(26 2.273 2.001)"/></g></g></svg></div> <div class="km-faqanchor">'+t.title+"</div></a></li>")}),KommunicateUI.faqEvents(e,t)},error:function(){}})},Kommunicate.getActiveConversation=function(){return KommunicateUtils.getItemFromLocalStorage("mckActiveConversationInfo")};
