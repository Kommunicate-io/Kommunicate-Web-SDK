var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,f,c){a instanceof String&&(a=String(a));for(var n=a.length,r=0;r<n;r++){var u=a[r];if(f.call(c,u,r,a))return{i:r,v:u}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,c){a!=Array.prototype&&a!=Object.prototype&&(a[f]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,f,c,n){if(f){c=$jscomp.global;a=a.split(".");for(n=0;n<a.length-1;n++){var r=a[n];r in c||(c[r]={});c=c[r]}a=a[a.length-1];n=c[a];f=f(n);f!=n&&null!=f&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var f=0;return $jscomp.iteratorPrototype(function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,f){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,n={next:function(){if(c<a.length){var r=c++;return{value:f(r,a[r]),done:!1}}n.next=function(){return{done:!0,value:void 0}};return n.next()}};n[Symbol.iterator]=function(){return n};return n};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.checkStringArgs=function(a,f,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var f=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var r=f.length,u=a.length;c=Math.max(0,Math.min(c|0,f.length));for(var g=0;g<u&&c<r;)if(f[c++]!=a[g++])return!1;return g>=u}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,n){var f=this.length||0;0>c&&(c=Math.max(0,f+c));if(null==n||n>f)n=f;n=Number(n);0>n&&(n=Math.max(0,f+n));for(c=Number(c||0);c<n;c++)this[c]=a;return this}},"es6","es3");
(function(a){function f(){return{ajax:function(a){var f=function(){for(var a=1;a<arguments.length;a++)for(var f in arguments[a])arguments[a].hasOwnProperty(f)&&(arguments[0][f]=arguments[a][f]);return arguments[0]}({},{},a),c=new XMLHttpRequest,u,g=!0;if("undefined"!==typeof f.async||a.async)g=f.async;a=f.type.toUpperCase();"GET"===a&&"undefined"!==typeof f.data&&(f.url=f.url+"?"+f.data);c.open(a,f.url,g);if("POST"===a||"GET"===a)g="undefined"===typeof f.contentType?"application/x-www-form-urlencoded; charset\x3dUTF-8":
f.contentType,c.setRequestHeader("Content-Type",g);"undefined"===typeof f.data?c.send():c.send(f.data);c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(200===c.status){var a=c.getResponseHeader("Content-Type");if("undefined"===typeof a||"null"===a||null===a)a="";u=-1!=a.toLowerCase().indexOf("text/html")?c.responseXML:-1!=a.toLowerCase().indexOf("application/json")?JSON.parse(c.responseText):c.responseText;f.success(u)}else f.error(u)}}}}"undefined"===typeof KMCommonUtils?
a.KMCommonUtils=f():console.log("KMCommonUtils already defined.")})(window);
(function(a){function f(){return{getArticles:function(a){var f="https://api.helpdocs.io/v1/article?key\x3d"+a.data.helpdocsAccessKey;a.data.query&&(f="https://api.helpdocs.io/v1/search?key\x3d"+a.data.helpdocsAccessKey+"\x26query\x3d"+a.data.query);var c={};KMCommonUtils.ajax({url:f,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(f){c.status="success";c.data=f;a.success&&a.success(c)},error:function(f,g,k){c.status="error";a.error&&a.error(c)}})},getArticle:function(a){var f=
{};KMCommonUtils.ajax({url:"https://api.helpdocs.io/v1/article/"+a.data.articleId+"?key\x3d"+a.data.helpdocsAccessKey,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(c){f.status="success";f.data=c;a.success&&a.success(f)},error:function(c,n,g){f.status="error";a.error&&a.error(f)}})}}}"undefined"===typeof Helpdocs?a.Helpdocs=f():console.log("Helpdocs already defined.")})(window);
(function(a){function f(){var a={},f="https://api.kommunicate.io";a.init=function(a){f=a};a.getArticles=function(f){try{var c=[];a.getFaqs({data:f.data,success:function(a){for(var g=0;g<a.data.length;g++){var n=a.data[g];c.push({articleId:n.id,title:n.name,description:n.content,status:n.status,body:n.content,source:"KOMMUNICATE"})}f.data.helpdocsAccessKey?Helpdocs.getArticles({data:f.data,success:function(a){a=a.data;for(var g=0;g<a.articles.length;g++){var k=a.articles[g];!0===k.is_published&&c.push({articleId:k.article_id,
title:k.title,description:k.description,body:k.description,url:k.url,source:"HELPDOCS"})}f.success&&(a={status:"success"},a.data=c,f.success(a))},error:function(a){c.length&&f.success?(a={status:"success"},a.data=c,f.success(a)):f.error&&f.error(a)}}):f.success&&(a={status:"success"},a.data=c,f.success(a))},error:function(a){"function"===typeof f.error&&f.err(a)}})}catch(g){f.error(g)}};a.getArticle=function(f){"HELPDOCS"==f.data.source?Helpdocs.getArticle({data:f.data,success:function(a){a=a.data.article;
a={articleId:a.article_id,title:a.title,description:a.description,body:a.body,url:a.url,source:"HELPDOCS"};if(f.success){var c={status:"success"};c.data=a;f.success(c)}},error:function(a){f.error(a)}}):a.getFaq({data:f.data,success:function(a){a=a.data.data[0];a={articleId:a.id,title:a.name,description:a.content,body:a.content,status:a.status,source:"KOMMUNICATE"};if(f.success){var c={status:"success"};c.data=a;f.success(c)}},error:function(a){f.error(a)}})};a.getFaqs=function(a){var c=f+"/kb/search?appId\x3d:appId".replace(":appId",
a.data.appId);a.data.query&&(c=c+"\x26query\x3d"+a.data.query);var g={};KMCommonUtils.ajax({url:c,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(f){g.status="success";g.data=f.data;a.success&&a.success(g)},error:function(f,c,n){g.status="error";a.error&&a.error(g)}})};a.getFaq=function(a){var c={},g=f+"/kb/search?appId\x3d:appId".replace(":appId",a.data.appId);a.data&&a.data.articleId&&(g+="\x26articleId\x3d"+a.data.articleId);KMCommonUtils.ajax({url:g,async:"undefined"!==
typeof a.async?a.async:!0,type:"get",success:function(f){c.status="success";c.data=f;a.success&&a.success(c)},error:function(f,g,n){c.status="error";a.error&&a.error(c)}})};return a}"undefined"===typeof KommunicateKB?a.KommunicateKB=f():console.log("KommunicateKB already defined.")})(window);
Kommunicate.client={getGroupDetailByType:function(a,f){$applozic.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:"type\x3d"+a.type+"\x26startIndex\x3d"+a.startIndex+"\x26limit\x3d"+a.limit,contentType:"application/json",success:function(a){f(null,a)},error:function(a){f(a)}})},createConversation:function(a,f){$applozic.fn.applozic("createGroup",{groupName:a.groupName,type:a.type,admin:a.agentId,users:a.users,clientGroupId:a.clientGroupId,metadata:{CREATE_GROUP_MESSAGE:"",REMOVE_MEMBER_MESSAGE:"",
ADD_MEMBER_MESSAGE:"",JOIN_MEMBER_MESSAGE:"",GROUP_NAME_CHANGE_MESSAGE:"",GROUP_ICON_CHANGE_MESSAGE:"",GROUP_LEFT_MESSAGE:"",CONVERSATION_STATUS:0,DELETED_GROUP_MESSAGE:"",GROUP_USER_ROLE_UPDATED_MESSAGE:"",GROUP_META_DATA_UPDATED_MESSAGE:"",CONVERSATION_ASSIGNEE:a.assignee||a.agentId,KM_CONVERSATION_TITLE:a.groupName,HIDE:"true"},callback:function(a){console.log("response",a);"success"===a.status&&a.data.clientGroupId&&("function"==typeof f&&f(a.data.value),KommunicateUI.hideFaq())}})},getThirdPartySettings:function(a,
f){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/integration/settings/"+a.appId+"?type\x3d"+a.type,type:"get",contentType:"application/json",success:function(a){f(null,a)},error:function(a){f(a)}})}};
$applozic.extend(!0,Kommunicate,{getBaseUrl:function(){switch(MCK_BASE_URL){case "https://apps-test.applozic.com/":case "https://apps-test.applozic.com":return"https://api-test.kommunicate.io";default:return"https://api.kommunicate.io"}},setDefaultAgent:function(a){throw Error("not implemented");},getConversationOfParticipent:function(a,f){if("function"!==typeof f)throw Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");$applozic.ajax({url:Kommunicate.getBaseUrl()+
"/conversations/participent/"+a.userId,type:"get",success:function(a){f(null,a)},error:function(a){f(a)}})},startConversation:function(a,f){a.agentId||(a.agentId=KommunicateUtils.getDataFromKmSession("appOptions").agentId);var c=[{userId:a.agentId,groupRole:1},{userId:"bot",groupRole:2}];if(a.botIds)for(var n=0;n<a.botIds.length;n++)c.push({userId:a.botIds[n],groupRole:2});Kommunicate.client.createConversation({groupName:a.conversationTitle||a.groupName||kommunicate._globals.conversationTitle||kommunicate._globals.groupName||
kommunicate._globals.agentId,type:10,agentId:a.agentId,assignee:a.assignee||a.agentId,users:c,clientGroupId:a.clientGroupId},f)},openConversationList:function(){window.$applozic.fn.applozic("loadTab","");KommunicateUI.showChat();KommunicateUI.hideFaq()},openConversation:function(a){window.$applozic.fn.applozic("loadGroupTab",a);KommunicateUI.hideFaq()},openDirectConversation:function(a){window.$applozic.fn.applozic("loadTab",a);KommunicateUI.showChat();KommunicateUI.hideFaq()},loadConversation:function(a,
f){var c=(a.agentIds||[]).sort(function(a,f){return a.toLowerCase()<f.toLowerCase()?-1:a.toLowerCase()>f.toLowerCase()?1:0});console.log("agent list ",c);var n=a.botIds||[];if(1>c.length)return a={code:"INVALID_PARAMETERS",message:"required parameter agentIds is missing."},"function"==typeof f?f(a):console.log("required parameter agentIds is missing.");a=kommunicate._globals.userId||KommunicateUtils.getCookie("kommunicate-id");var r=c.join("_"),u=n.join("_"),g=encodeURIComponent(u?[r,a,u].join("_"):
[r,a].join("_"));if(256<g.length)return a={code:"MEMBER_LIMIT_EXCEEDS",message:"try adding fewer members"},"function"==typeof f?f(a):console.log("member limit exceeds. try adding fewer members");mckGroupService.getGroupFeed({clientGroupId:g,apzCallback:function(a){if("error"==a.status&&"AL-G-01"==a.code)a=c.map(function(a){return{userId:a,groupRole:1}}),a.push({userId:"bot",groupRole:2}),a.push(n.map(function(a){return{userId:a,groupRole:2}})),a={groupName:kommunicate._globals.conversationTitle||
kommunicate._globals.groupName||kommunicate._globals.agentId,type:10,agentId:a[0].userId,users:a,clientGroupId:decodeURIComponent(g)},Kommunicate.client.createConversation(a,function(a){if(f)return f(null,a)});else if("success"==a.status)return $applozic.fn.applozic("loadGroupTab",a.data.id),f(null,a)}})},createGroupName:function(a){return a.sort().join().replace(/,/g,"_").substring(0,250)},openLastConversation:function(a){var f=[],c=[];c.push(a.agentId);c.push(kommunicate._globals.userId);f.push({userId:a.agentId,
groupRole:1});f.push({userId:"bot",groupRole:2});if(a.botIds){console.log(a.botIds);for(var n=0;n<a.botIds.length;n++)f.push({userId:a.botIds[n],groupRole:2}),c.push(a.botIds[n])}f=Kommunicate.createGroupName(c);c={};c.groupName=f;c.callback=function(f){0<f.data.groups.length?(console.log("already have a group"),Kommunicate.openConversation(f.data.groups[0].id)):(console.log("new user"),Kommunicate.startConversation(a,function(a){}))};window.$applozic.fn.applozic("getGroupListByFilter",c)},createNewConversation:function(a,
f){if("function"!==typeof f)throw Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");a={groupId:a.groupId,participantUserId:a.participantUserId,createdBy:a.participantUserId,defaultAgentId:a.defaultAgentId,applicationId:a.applicationId};$applozic.ajax({url:Kommunicate.getBaseUrl()+"/conversations",type:"post",data:JSON.stringify(a),contentType:"application/json",success:function(a){console.log("conversation started successfully");f(null,a)},error:function(a){console.log("err while starting Conversation");
f(a)}})},logout:function(a,f){"undefined"!==typeof window.$kmApplozic&&"undefined"!==typeof window.$kmApplozic.fn&&"undefined"!==typeof window.$kmApplozic.fn.applozic&&window.$kmApplozic.fn.applozic("getLoggedInUser")&&window.$kmApplozic.fn.applozic("logout");"undefined"!==typeof window.$applozic&&"undefined"!==typeof window.$applozic.fn&&"undefined"!==typeof window.$applozic.fn.applozic&&window.$applozic.fn.applozic("getLoggedInUser")&&window.$applozic.fn.applozic("logout");sessionStorage.clear();
localStorage.clear()},launchConversation:function(){window.$applozic.fn.applozic("mckLaunchSideboxChat")},triggerEvent:function(a,f){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/events?type\x3d"+a,type:"post",data:JSON.stringify({conversationId:f.groupId,applicationId:f.applicationId}),contentType:"application/json",success:function(a){console.log("conversation triggering event")},error:function(a){console.log("err while starting Conversation")}})},updateUser:function(a){window.$applozic.fn.applozic("updateUser",
{data:a})},getAwayMessage:function(a,f){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/"+a.applicationId+"/awaymessage?conversationId\x3d"+a.conversationId,type:"get",contentType:"application/json",success:function(a){"function"==typeof f?f(null,a):""},error:function(a){console.log("err while fetching away message");"function"==typeof f?f(a):""}})},updateUserIdentity:function(a){window.$applozic.fn.applozic("updateUserIdentity",{newUserId:a,callback:function(f){KommunicateUtils.setCookie("kommunicate-id",
a);"success"==f&&window.$applozic.fn.applozic("reInitialize",{userId:a})}})},isRichTextMessage:function(a){return a&&300==a.contentType},getConatainerTypeForRichMessage:function(a){if(a)switch(a.templateId){case "2":case "4":return"km-slick-container";case "6":return"km-border-less-container";default:return"km-fixed-container"}},processPaymentRequest:function(a){},sendMessage:function(a){var f=$applozic("#mck-message-cell .mck-message-inner"),c=$applozic("#mck-msg-to");!0===f.data("isgroup")?a.groupId=
c.val():a.to=c.val();f=Kommunicate.getSettings("KM_CHAT_CONTEXT");c=a.metadata||{};f&&(c={KM_CHAT_CONTEXT:f});a.metadata=c;$applozic.fn.applozic("sendGroupMessage",a)},getRichTextMessageTemplate:function(a){if(a)switch(a.templateId){case "1":return Kommunicate.markup.getHotelRoomPaxInfoTemplate();case "2":return Kommunicate.markup.getHotelCardContainerTemplate(JSON.parse(a.hotelList||"[]"),a.sessionId);case "3":return Kommunicate.markup.buttonContainerTemplate(a);case "5":return Kommunicate.markup.getPassangerDetail(a);
case "4":return Kommunicate.markup.getRoomDetailsContainerTemplate(JSON.parse(a.hotelRoomDetail||"[]"),a.sessionId);case "6":return Kommunicate.markup.quickRepliesContainerTemplate(a);case "7":return Kommunicate.markup.getListContainerMarkup(a);case "8":return Kommunicate.markup.getDialogboxContainer(a);default:return""}else return""},updateSettings:function(a){var f=KommunicateUtils.getDataFromKmSession("settings");f=f?JSON.parse(f):{};for(var c in a)f[c]=a[c];KommunicateUtils.storeDataIntoKmSession("settings",
JSON.stringify(f))},getSettings:function(a){var f=KommunicateUtils.getDataFromKmSession("settings");f=f?JSON.parse(f):null;return a&&f?f[a]:f?f:""}});
Kommunicate.markup={getSingleRoomPaxInfo:function(a){return'\x3cdiv class \x3d "km-single-pax-info"\x3e\n    \x3cdiv class\x3d"km-room-title-text"\x3eROOM '+(a||"1")+'\x3c/div\x3e\n    \x3cdiv class\x3d"km-room-selector"\x3e\n        \x3cdiv\x3eGuest :\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/div\x3e\n        \x3cdiv id\x3d ""\x3e\n            \x3cinput class \x3d"km-decrement-guest-count" type\x3d"button" value\x3d"-" data-type\x3d"guest"\x3e\n            \x3cinput type\x3d"number" min\x3d"1" max\x3d"5" value\x3d"1" class\x3d"km-room-number-field" maxlength\x3d"1" disabled\x3e\n            \x3cinput class \x3d"km-increment-guest-count" type\x3d"button" value\x3d"+" data-type\x3d"guest"\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"km-person-selector n-vis"\x3e\n        \x3cdiv class\x3d"km-children-text-lable"\x3eChildren :\x3cspan\x3e(1-12 yrs)\x3c/span\x3e\x3c/div\x3e\n        \x3cdiv\x3e\n            \x3cinput class \x3d"km-decrement-guest-count" type\x3d"button" value\x3d"-" data-type\x3d"children"\x3e\n            \x3cinput type\x3d"number" min\x3d"0" max\x3d"2" value\x3d"0" class\x3d"km-person-number-field" maxlength\x3d"1" disabled \x3e\n            \x3cinput class \x3d"km-increment-guest-count" type\x3d"button" value\x3d"+" data-type\x3d"children"\x3e\n        \x3c/div\x3e \n    \x3c/div\x3e\n\x3c/div\x3e'},getHotelCardTemplate:function(a,
f){var c={star1:"km-star-empty",star2:"km-star-empty",star3:"km-star-empty",star4:"km-star-empty",star5:"km-star-empty"};if(a.StarRating)for(var n=0;n<a.StarRating;n++)c["star"+(n+1)]="km-star-filled";return'\n    \x3cdiv class\x3d"km-single-card-message"\x3e\n        \x3cdiv class\x3d"km-card-message-header"\x3e\n            \x3cdiv class\x3d"km-card-message-image-continer"\x3e\x3cimg class \x3d"km-card-message-img" src \x3d'+a.HotelPicture+' /\x3e\n                    \x3cdiv class\x3d"km-card-message-image-price-container"\x3e'+
(("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(1*a.Price.OfferedPrice))+'\x3c/div\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"km-card-message-body"\x3e\n            \x3ch1 class\x3d"km-card-message-body-title"\x3e'+a.HotelName+'\x3c/h1\x3e\n            \x3cdiv class\x3d"km-card-message-body-ratings"\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
c.star1+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+c.star2+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
c.star3+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+c.star4+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
c.star5+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"km-card-message-body-address"\x3e\n                \x3cspan class\x3d"km-card-message-body-address-icon"\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24"\x3e\n                        \x3cpath d\x3d"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e'+
a.HotelAddress+'\n            \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"km-card-message-footer"\x3e\n            \x3cbutton class\x3d"km-card-message-footer-button" data-resultindex\x3d '+a.ResultIndex+" data-sessionid\x3d "+f+" data-name\x3d "+a.HotelName.replace(" ","_")+" \x3e Get Room Details\x3c/button\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e"},getRoomDetailTemplate:function(a,f){return'\x3cdiv class\x3d"km-single-card-message"\x3e\n                \x3cdiv class\x3d"message received km-blocked-room"\x3e\n                    \x3cdiv class\x3d"km-blocked-room-details"\x3e\n                    \x3cdiv class\x3d"km-card-message-image-continer"\x3e\x3cimg class \x3d"km-card-message-img" src\x3d'+
a.HotelPicture+" alt\x3d"+a.HotelName+'\x3e\x3c/div\x3e\n                        \x3cdiv class\x3d"km-blocked-room-text-container"\x3e\n                            \x3cdiv class\x3d"km-blocked-room-room-type"\x3e\n                                \x3cspan\x3eRoom Type: \x3c/span\x3e \x3cspan\x3e '+a.RoomTypeName+'\x3c/span\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-guests"\x3e\n                                \x3cspan\x3eGuests:\x3c/span\x3e\x3cspan\x3e'+
("undefined"==a.NoOfGuest?1:a.NoOfGuest)+' \x3c/span\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-price"\x3e\n                                \x3cp\x3ePrice:\x3cbr\x3e\x3cspan\x3e(Per Room Per Night)\x3c/span\x3e\x3c/p\x3e\n\n                                \x3cspan\x3e'+("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(a.DayRates.Amount?a.DayRates.Amount:a.Price.RoomPrice)+'\x3c/span\x3e\n\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-sub-total"\x3e\n                                \x3cp\x3eTotal:\x3cbr\x3e\x3cspan\x3e(1 Room for '+
a.NoOfNights+" Nights)\x3c/span\x3e\x3c/p\x3e\n                                \x3cspan\x3e "+("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(a.Price.RoomPrice)+' \x3c/span\x3e\n                            \x3c/div\x3e\n                        \x3c/div\x3e\n                        \x3cdiv class\x3d"km-blocked-room-button-container"\x3e\n                            \x3cbutton class\x3d"km-block-room-button" data-sessionId\x3d '+f+" data-roomIndex\x3d"+a.RoomIndex+" data-NoOfRooms\x3d"+
a.NoOfRooms+" data-NoOfNights\x3d"+a.NoOfNights+" data-HotelName\x3d "+a.HotelName.replace(" ","_")+" data-HotelResultIndex\x3d "+a.HotelResultIndex+" \x3eBook\x3c/button\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e"},getButtonTemplate:function(a,f){return"link"==a.type?'\x3cbutton data-eventhandlerid\x3d"'+a.handlerId+'" class\x3d"km-cta-button km-add-more-rooms km-undecorated-link '+f+'"\x3e\x3ca href \x3d"'+
a.url+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e\x3c/button\x3e":'\x3cbutton data-eventhandlerid\x3d"'+a.handlerId+'" class\x3d"km-cta-button km-add-more-rooms '+f+'"\x3e'+a.name+"\x3c/button\x3e"},getQuickRepliesTemplate:function(a,f){return'\x3cbutton title\x3d"'+a.message+'" class\x3d"km-cta-button km-add-more-rooms km-quick-replies '+f+'"\x3e'+a.title+"\x3c/button\x3e"},getPassangerDetail:function(a){a.sessionId||console.log("sessionId not present in message..");return'  \x3cdiv class\x3d"km-guest-details-container km-rich-text-default-container"\x3e\n                \x3cdiv class\x3d"km-guest-detail-form"\x3e\n                    \x3cdiv class\x3d "km-select-title"\x3e    \n                        \x3cselect name\x3d"title" class\x3d"km-title-select"\x3e\n                            \x3coption value\x3d"0" disabled selected\x3eTitle *\x3c/option\x3e\n                            \x3coption value\x3d"Mr."\x3eMr.\x3c/option\x3e\n                            \x3coption value\x3d"Ms."\x3eMs.\x3c/option\x3e\n                            \x3coption value\x3d"Mrs."\x3eMrs.\x3c/option\x3e\n                        \x3c/select\x3e\n                    \x3c/div\x3e\n                    \x3cinput type\x3d"number" name\x3d"age"  class\x3d"km-input km-age-input n-vis" placeholder\x3d"Age *" min\x3d"0" max\x3d"150"\x3e\n                    \x3cinput type\x3d"text" name\x3d"first-name"  class\x3d"km-input first-name-input km-pxinfo-btn-left" placeholder\x3d"First Name *"  required\x3e\n                    \x3cinput type\x3d"text" name\x3d"middle-name"  class\x3d"km-input middle-name-input n-vis" placeholder\x3d"Middle Name (optional) "\x3e\n                    \x3cinput type\x3d"text" name\x3d"last-name"  class\x3d"km-input last-name-input km-pxinfo-btn-left" placeholder\x3d"Last Name *"  required\x3e\n                    \x3cinput type\x3d"email" name\x3d"email"  class\x3d"km-input e-mail-input km-pxinfo-btn-left" placeholder\x3d"Email Id *" required\x3e\n                    \x3cinput type\x3d"text" name\x3d"contact-no"  class\x3d"km-input number-input km-pxinfo-btn-left" placeholder\x3d"Contact Number *" required \x3e\n                    \x3cdiv class\x3d "km-mandatory-field-error n-vis"\x3e\x3cspan\x3e All fields are mandatory.\x3c/span\x3e\x3c/div\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"km-guest-button-container"\x3e\n                    \x3cbutton class\x3d"km-add-more-rooms km-submit-person-detail" data-sessionid\x3d '+
a.sessionId+"\x3eSubmit\x3c/button\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e\n            "},getListMarkup:function(){return'\x3cdiv class\x3d"km-message km-received km-chat-faq-list" style\x3d""\x3e\n     \x3cdiv class\x3d"km-faq-list--container"  \x3e\n             \x3cdiv class\x3d"km-faq-list--header"\x3e\n                     {{{headerImgSrc}}}\n                     \x3cdiv class\x3d"km-faq-list--header_text-container"\x3e\n                                     {{{headerText}}}\n                         \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-list--body"\x3e\n             \x3cdiv class\x3d"km-faq-list--body_list-container"\x3e\n                 \x3cul class\x3d"km-faq-list--body_list {{elementClass}}"\x3e\n                     {{#elements}}\n                     \x3cli class \x3d{{hadlerClass}} data-type\x3d"{{dataType}}" data-reply \x3d "{{dataReply}}" data-articleid\x3d "{{dataArticleId}}" data-source\x3d"{{source}}"\x3e \x3ca href\x3d{{href}} target\x3d"_blank" class\x3d"km-undecorated-link" \x3e\n                             \x3cdiv class\x3d"km-faq-list--body_img"\x3e\n                                     {{{imgSrc}}}\n                             \x3c/div\x3e\n                         \x3cdiv class\x3d"km-faq-list--body_que-ans"\x3e\n                                 \x3cp class\x3d"km-faq-list--body_que"\x3e\n                                     {{title}}\n                                 \x3c/p\x3e\n                                 \x3cp class\x3d"km-faq-list--body_ans"\x3e\n                                     {{description}}\n                                 \x3c/p\x3e\n                             \x3c/div\x3e\n                         \x3c/a\x3e\n                     \x3c/li\x3e\n                     {{/elements}}\n                 \n                 \x3c/ul\x3e\n             \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-list--footer"\x3e\n                 \x3cdiv class\x3d"km-faq-list--footer_button-container"\x3e\n                         {{#buttons}}\n                         \x3cbutton class\x3d"km-cta-button km-add-more-rooms {{hadlerClass}}" data-type \x3d"{{dataType}}" data-reply\x3d"{{dataReply}}"\x3e\x3ca class \x3d"km-undecorated-link" href \x3d"{{href}}" target\x3d"_blank"\x3e{{name}}\x3c/a\x3e\x3c/button\x3e\n                         {{/buttons}}\n                     \n             \x3c/div\x3e\n         \x3c/div\x3e\n     \x3c/div\x3e'},
getDialogboxTemplate:function(){return'\x3cdiv class\x3d"km-message km-received km-faq-answer"\x3e\n     \x3cdiv class\x3d"km-faq-answer--container"\x3e\n         \x3cdiv class\x3d"km-faq-answer--body"\x3e\n             \x3cdiv class\x3d"km-faq-answer--body_container"\x3e\n                 \x3cp class\x3d"km-faq-answer--body_que"\x3e{{title}}\x3c/p\x3e\n                 \x3cp class\x3d"km-faq-answer--body_ans"\x3e {{{description}}} \x3c/p\x3e\n             \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-answer--footer"\x3e\n             \x3cdiv class\x3d"km-faq-answer--footer_button-text-container"\x3e\n                 \x3cp\x3e{{buttonLabel}}\x3c/p\x3e\n                 {{#buttons}}\n                 \x3cbutton class\x3d"km-faq-dialog-button km-quick-replies km-cta-button km-add-more-rooms" data-reply\x3d"{{name}}"\x3e{{name}}\x3c/button\x3e\n                {{/buttons}}\n             \x3c/div\x3e\n         \x3c/div\x3e\n     \x3c/div\x3e\n \x3c/div\x3e'}};
Kommunicate.markup.buttonContainerTemplate=function(a){for(var f='\x3cdiv class\x3d"km-cta-multi-button-container"\x3e',c=JSON.parse(a.payload),n=c?JSON.parse(a.formData||"{}"):"",r=1==c.length?"km-cta-button-1":2==c.length?"km-cta-button-2":"km-cta-button-many",u=0;u<c.length;u++)f+=Kommunicate.markup.getButtonTemplate(c[u],r);if(n){f+="\x3cform method \x3d'post'  target\x3d'_blank' class\x3d km-btn-hidden-form action \x3d"+a.formAction+"\x3e";for(var g in n)n.hasOwnProperty(g)&&(f+='\x3cinput type\x3d"hidden" name \x3d"'+
g+'" value\x3d"'+n[g]+'" /\x3e');f+="\x3c/form\x3e"}return f+"\x3c/div\x3e"};Kommunicate.markup.quickRepliesContainerTemplate=function(a){var f='\x3cdiv class\x3d"km-cta-multi-button-container"\x3e';a=JSON.parse(a.payload);for(var c=1==a.length?"km-cta-button-1":2==a.length?"km-cta-button-2":"km-cta-button-many",n=0;n<a.length;n++)f+=Kommunicate.markup.getQuickRepliesTemplate(a[n],c);return f+"\x3c/div\x3e"};
Kommunicate.markup.getHotelRoomPaxInfoTemplate=function(a){return'\x3cdiv class \x3d "km-rich-text-default-container"\x3e\n            \x3cdiv class\x3d"km-room-person-selector-container"\x3e'+Kommunicate.markup.getSingleRoomPaxInfo(a)+'\x3c/div\x3e\n            \x3chr\x3e\n            \x3cdiv class\x3d"km-add-room-button-container"\x3e\n                \x3cbutton  class\x3d"km-add-more-rooms km-btn-add-more-rooms" data-roomcount\x3d1\x3eADD ROOM\x3c/button\x3e\n                \x3cbutton class\x3d" km-add-more-rooms km-done-button"\x3eDONE\x3c/button\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e'};
Kommunicate.markup.getHotelCardContainerTemplate=function(a,f){for(var c="",n=0;n<a.length;n++)c+=Kommunicate.markup.getHotelCardTemplate(a[n],f);return'\x3cdiv class\x3d"km-card-message-container  km-div-slider"\x3e'+c+"\x3c/div\x3e"};Kommunicate.markup.getRoomDetailsContainerTemplate=function(a,f){a=a.HotelRoomsDetails;for(var c="",n=0;n<a.length;n++)c+=Kommunicate.markup.getRoomDetailTemplate(a[n],f);return'\x3cdiv class\x3d"km-card-room-detail-container  km-div-slider"\x3e'+c+"\x3c/div\x3e"};
Kommunicate.markup.getListContainerMarkup=function(a){return a&&a.payload?(a=JSON.parse(a.payload),a.headerImgSrc&&(a.headerImgSrc='\x3cdiv class\x3d"km-faq-list--header_text-img"\x3e\x3cimg src\x3d "'+a.headerImgSrc+'"  alt \x3d "image" /\x3e\x3c/div\x3e'),a.headerText&&(a.headerText='\x3cp class\x3d"km-faq-list--header_text"\x3e'+a.headerText+"\x3c/p\x3e"),a.elements&&a.elements.length?(a.elementClass="vis",a.elements=a.elements.map(function(a){a.imgSrc&&(a.imgSrc='\x3cimg src \x3d"'+a.imgSrc+'" /\x3e');
a.action&&"link"==a.action.type?a.href=a.action.url:(a.href="javascript:void(0)",a.hadlerClass="km-list-item-handler");a.action&&(a.dataType=a.action.type||"",a.dataReply=a.action.text||a.title||"");a.dataArticleId=a.articleId||"";a.dataSource=a.source||"";return a})):a.elementClass="n-vis",a.buttons&&a.buttons.length&&(a.buttons=a.buttons.map(function(a){a.action&&"quick_reply"!=a.action.type&&"submit"!=a.action.type?a.href=a.action.url:(a.href="javascript:void(0)",a.hadlerClass="km-list-button-item-handler");
a.dataType=a.action.type||"";a.dataReply=a.action.text||a.name||"";return a})),Mustache.to_html(Kommunicate.markup.getListMarkup(),a)):""};Kommunicate.markup.getDialogboxContainer=function(a){return a&&a.payload?(a=JSON.parse(a.payload),Mustache.to_html(Kommunicate.markup.getDialogboxTemplate(),a)):""};var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(a,f,c){function n(g){var k=this,n,p;MCK_GROUP_MAP=[];var U=[],ha,wb,Gb=!0,Ja=[],qa=0;MCK_CLIENT_GROUP_MAP=[];var Ka=!1,ta=[],La=[],Ma=90,za=[],aa=[],ba=[],ca=[],Hb=!0,K=0,zc=g.emojilibrary,Ib=g.mode;MCK_LABELS=g.labels;MCK_BASE_URL=g.baseUrl;var cc=g.customFileUrl,Ac=g.customUploadUrl,Y=g.appId,Jb=[],Kb=[0,1,2,3],Lb=[1,2,5,6,10],Aa=[],qb=!1,lb=g.launcher,xb=g.visitor,dc=g.userName,mb=g.locShare,Ya=g.video,Ra=g.fileBaseUrl,S=g.onInit,Mb=g.onTopicDetails,Bc=[0,1,2],Nb=g.onClose,Ob=g.displayText,
ia=g.password||g.accessToken,ib=g.readConversation,ra=g.maxGroupSize,Pb=g.onTabClicked,ec=g.contactNumber,Ba=g.maxAttachmentSize,yb=g.appModuleName,Ca=g.getTopicDetail,Qb=g.contactDisplayName,Rb=g.validateMessage,Za=g.finalPriceResponse,$a=g.contactDisplayImage,Sb=g.priceWidget,ua=g.openGroupSettings,va=g.offlineMessageDetail,zb=g.authenticationTypeId,Tb=g.getConversationDetail,Cc=g.notificationIconLink,fc=g.mapStaticAPIkey,Ub=g.unreadCountOnchatLauncher,gc=g.chatLauncherHtml,Na=g.fileupload,hc=g.notificationSoundLink?
g.notificationSoundLink:Kommunicate.getBaseUrl()+"/plugin/audio/notification_tone.mp3",A=xb?"guest":a.trim(g.userId),ic=mb?g.googleApiKey:"NO_ACCESS",Dc="undefined"===typeof g.source?1:g.source,ab="boolean"===typeof g.topicBox?g.topicBox:!1,Ab="boolean"===typeof g.olStatus?g.olStatus:!1,jc="boolean"===typeof g.messageBubbleAvator?g.messageBubbleAvator:!0,rb="boolean"===typeof g.showOfflineMessage?g.showOfflineMessage:!1,kc="boolean"===typeof g.hideGroupSubtitle?g.hideGroupSubtitle:!1,lc="undefined"===
typeof g.defaultMessageMetaData?{}:g.defaultMessageMetaData,Vb="boolean"===typeof g.groupUserCount?g.groupUserCount:!1,mc="boolean"===typeof g.checkUserBusyWithStatus?g.checkUserBusyWithStatus:!1,nc="boolean"===typeof g.resetUserStatus?g.resetUserStatus:!1,Oa="boolean"===typeof g.topicHeader?g.topicHeader:!1,oc=g.supportId?'data-mck-id\x3d"'+g.supportId+'"':"",Wb="boolean"===typeof g.loadOwnContacts?g.loadOwnContacts:!1,pc="boolean"===typeof g.desktopNotification?g.desktopNotification:!0,qc="boolean"===
typeof g.notification?g.notification:!0,rc="boolean"===typeof g.autoTypeSearchEnabled?g.autoTypeSearchEnabled:!0,Bb="boolean"===typeof g.launchOnNewMessage?g.launchOnNewMessage:!1,Xb="boolean"===typeof g.launchOnUnreadMessage?g.launchOnUnreadMessage:!1,sc="number"===typeof g.userTypeId?g.userTypeId:!1,X=["DEFAULT","NEW","OPEN"],tc=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],ja={},bb=[],cb=[],Sa={},Da=[],wa=[],db=[],Ha=[],jb=new function(){var b=this,g=!1,B,k,ea=a("#mck-file-menu"),sb=
a("#mck-message-cell .mck-message-inner");a("#mck-tab-individual");var E=Ma;b.getLauncherHtml=function(){return gc?'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher launchershadow"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher"\x3e'+gc+"\x3c/a\x3e\x3c/div\x3e":'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher mck-button-launcher" '+("support"===Ib?oc:"")+'\x3e\x3cdiv\x3e\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" xmlns:xlink\x3d"http://www.w3.org/1999/xlink" version\x3d"1.1" id\x3d"Layer_1" x\x3d"0px" y\x3d"0px" viewBox\x3d"0 0 500 500" width\x3d"56" height\x3d"56" style\x3d"enable-background:new 0 0 500 500;" xml:space\x3d"preserve"\x3e\n              \x3cstyle type\x3d"text/css"\x3e\n                  .km-launcher-logo-0{fill:url(#km-launcher-logo-gradient-1);}\n                  .km-launcher-logo-1{fill:#FFFFFF;}\n              \x3c/style\x3e\n              \x3cg\x3e\n                  \x3clinearGradient id\x3d"km-launcher-logo-gradient-1" gradientUnits\x3d"userSpaceOnUse" x1\x3d"3.367313e-08" y1\x3d"250" x2\x3d"500" y2\x3d"250"\x3e\n                      \x3cstop offset\x3d"0" style\x3d"stop-color:#3A3C80"/\x3e\n                      \x3cstop offset\x3d"0.1658" style\x3d"stop-color:#4B4C93"/\x3e\n                      \x3cstop offset\x3d"0.3516" style\x3d"stop-color:#5858A2"/\x3e\n                      \x3cstop offset\x3d"0.5063" style\x3d"stop-color:#5C5CA7"/\x3e\n                      \x3cstop offset\x3d"0.6795" style\x3d"stop-color:#53549D"/\x3e\n                      \x3cstop offset\x3d"0.9706" style\x3d"stop-color:#3D3E83"/\x3e\n                      \x3cstop offset\x3d"1" style\x3d"stop-color:#3A3C80"/\x3e\n                  \x3c/linearGradient\x3e\n                  \x3ccircle class\x3d"km-launcher-logo-0" cx\x3d"250" cy\x3d"250" r\x3d"250"/\x3e\n                  \x3cg\x3e\n                      \x3cpath class\x3d"km-launcher-logo-1" d\x3d"M377.5,379.6V237.1c0-51.4-41.7-93.1-93.1-93.1h-84.7c-51.4,0-93.1,41.7-93.1,93.1    c0,51.4,41.7,93.1,93.1,93.1h91.7c0,0,7.4,0.4,11.9,2.1c4.3,1.6,9.1,5.3,9.1,5.3l56.7,46.7c0,0,5.2,4.4,7,3.5    C377.9,386.9,377.5,379.6,377.5,379.6z M202.2,256.2c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-40    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V256.2z M254.1,275c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-77.8    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V275z M306,256.2c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-40    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V256.2z"/\x3e\n                  \x3c/g\x3e\n              \x3c/g\x3e\n              \x3c/svg\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
b.initializeApp=function(f,c){g=c;c={applicationId:f.appId,userId:A};null!==dc&&(c.displayName=f.userName);null!==f.email&&(c.email=f.email);null!==ec&&(c.contactNumber=f.contactNumber);f.imageLink&&(c.imageLink=f.imageLink);f.appModuleName&&(c.appModuleName=f.appModuleName);ia&&(c.password=f.accessToken);-1===Bc.indexOf(zb)&&(zb=0);nc&&(c.resetUserStatus=!0);"number"==typeof sc&&(c.userTypeId=sc);f.metadata&&(c.metadata=f.metadata);c.enableEncryption=!0;c.appVersionCode=108;c.authenticationTypeId=
zb;c.chatNotificationMailSent=!0;ha=p="";if(b.validateAppSession(c))Ya&&ka.InitilizeVideoClient(A,ha);else if(f={name:"km-userName",email:"km-email",phone:"km-contact"},Yb||0===Ea.length)b.initialize(c);else{a("#km-userId").val(A);if(0<Ea.length)for(c=0;c<Ea.length;c++)a("#"+f[Ea[c]]).removeClass("n-vis").addClass("vis"),a("#"+f[Ea[c]]).prop("required",!0);a("#km-chat-login-modal").css("display","block")}};b.initialize=function(f){window.Applozic.ALApiService.login({data:{alUser:f,baseUrl:MCK_BASE_URL},
success:function(c){Ya&&ka.InitilizeVideoClient(c.userId,c.deviceKey);"kommunicate"==window.applozic.PRODUCT_ID&&a("#km-chat-login-modal").css("display","none");ALStorage.clearMckMessageArray();ALStorage.clearMckContactNameArray();"INVALID_PASSWORD"===c?"function"===typeof S&&S({status:"error",errorMessage:"INVALID PASSWORD"}):"INVALID_APPID"===c?"function"===typeof S&&S({status:"error",errorMessage:"INVALID APPLICATION ID"}):"error"===c||"USER_NOT_FOUND"===c?"function"===typeof S&&S({status:"error",
errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===c?"function"===typeof S&&S({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof c&&null!==c&&c.token?(c.appId=f.applicationId,ia&&(c.accessToken=f.password),b.onInitApp(c)):"function"===typeof S&&S({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})},error:function(){ALStorage.clearMckMessageArray();"function"===typeof S&&S({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})};b.onInitApp=function(c){b.appendLauncher();
b.setLabels();a(".applozic-launcher").each(function(){a(this).hasClass("mck-msg-preview")||a(this).show()});n=c.token;M.setEncryptionKey(c.encryptionKey);A=c.userId;ha=c.deviceKey;wb=c.websocketUrl;Ma=c.websocketIdleTimeLimit;Ra=c.fileBaseUrl;qb=c.deactivated;p=btoa(c.userId+":"+c.deviceKey);window.Applozic.ALApiService.setAjaxHeaders(p,Y,ha,ia,yb);K=c.totalUnreadCount;M.badgeCountOnLaucher(Ub,K);xb||"guest"===A||"0"===A||"C0"===A||(g?Q.reconnect():Q.init());m.createContactWithDetail({userId:A,displayName:c.displayName,
photoLink:c.imageLink});a.ajaxPrefilter(function(a){a.beforeSend||-1===a.url.indexOf(MCK_BASE_URL)||(a.beforeSend=function(a){b.setHeaders(a)})});if(c.betaPackage){var l="https://www.kommunicate.io/?utm_source\x3d"+f.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";a(".mck-running-on a").attr("href",l);a(".mck-running-on").removeClass("n-vis").addClass("vis")}l=ALStorage.getMckContactNameArray();if(null!==l&&0<l.length)for(var k=0;k<l.length;k++){var B=l[k];null!==B&&(Da[B[0]]=
B[1])}xa.checkUserConnectedStatus(function(a){0<a.length?da.getUsersDetail(a,{setStatus:!0}):Fa.updateUserConnectedStatus()});"function"===typeof S&&S("success",c);jb.tabFocused();0<Ua.length&&0<K&&Ua.html(K);Xb&&y.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});G.init(c);da.loadContacts();uc.subscribeToServiceWorker();ALStorage.setAppHeaders(c);w.loadGroups({apzCallback:v.loadGroups});Yb||a.fn.applozic("mckLaunchSideboxChat");Kommunicate.postPluginInitialization(null,c);KommunicateUtils.triggerCustomEvent("kmInitilized",
{detail:c,bubbles:!0,cancelable:!0})};b.validateAppSession=function(a){v.init();m.init();var f=ALStorage.getAppHeaders();if(f&&f.userId){if(a.applicationId===f.appId&&a.userId===f.userId&&a.password===f.accessToken)return b.onInitApp(f),!0;ALStorage.clearAppHeaders()}return!1};b.setHeaders=function(a){a.setRequestHeader("UserId-Enabled",!0);p&&a.setRequestHeader("Authorization","Basic "+p);a.setRequestHeader("Application-Key",Y);ha&&a.setRequestHeader("Device-Key",ha);ia&&a.setRequestHeader("Access-Token",
ia);yb&&a.setRequestHeader("App-Module-Name",yb)};b.setLabels=function(){a("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);a("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]);a("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]);a("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",
MCK_LABELS["search.groups"]);a("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]);a("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]);a("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);a("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);a("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]);
a("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);a("#mck-msg-error").html(MCK_LABELS["group.deleted"]);a("#mck-gc-title-label").html(MCK_LABELS["group.title"]);a("#mck-gc-type-label").html(MCK_LABELS["group.type"]);a("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);a("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);a("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",
MCK_LABELS["members.title"]);a("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]);a("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);a("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);a("#mck-typing-label").html(MCK_LABELS.typing);a("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",
MCK_LABELS["clear.messages"]);a("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);a("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]);a("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);a("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);a("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);a(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);
a("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);a("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close);a("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send);a("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);a("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);a("#mck-group-name-save").attr("title",MCK_LABELS.save);a("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);a("#mck-group-name-edit").attr("title",
MCK_LABELS.edit)};a(c).on("click",".fancybox",function(b){b=a(this);if(-1!==b.data("type").indexOf("video")){var f=b.find(".mck-video-box").html(),c;b.fancybox({content:f,title:b.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){c=a(".fancybox-inner").find("video").get(0);c.load();c.play()}})}else b=b.data("url"),a(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:b,type:"image"})});
a(f).on("resize",function(){"block"===ea.css("display")&&Zb.fileMenuReposition();if(0===sb.find(".mck-contact-list").length){var a=sb.get(0).scrollHeight;sb.height()<a&&sb.animate({scrollTop:sb.prop("scrollHeight")},0)}});b.appendLauncher=function(){a("#mck-sidebox-launcher").remove();a("body").append(b.getLauncherHtml());Cb.init()};b.tabFocused=function(){function a(a){var c={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};a=a||f.event;(Hb=a.type in c?c[a.type]:this.hidden?!1:!0)?
(1>E&&Gb&&Q.checkConnected(!0),b.stopIdleTimeCounter()):(1===qa&&Q.sendTypingStatus(0),b.manageIdleTime())}"hidden"in c?c.addEventListener("visibilitychange",a):!1 in c?c.addEventListener("mozvisibilitychange",a):!1 in c?c.addEventListener("webkitvisibilitychange",a):!1 in c?c.addEventListener("msvisibilitychange",a):"onfocusin"in c?c.onfocusin=c.onfocusout=a:f.onpageshow=f.onpagehide=f.onfocus=f.onblur=a;void 0!==c.hidden&&a({type:c.hidden?"blur":"focus"})};b.manageIdleTime=function(){E=Ma;B&&clearInterval(B);
B=setInterval(function(){0>--E&&(E=0,Q.stopConnectedCheck(),clearInterval(B),B="")},6E4)};b.stopIdleTimeCounter=function(){E=Ma;B&&clearInterval(B);B=""};b.manageOfflineMessageTime=function(a){if("object"!==typeof va||isNaN(va.timeout))f.console.log("Offline message timeout required.");else{if(1===va.type){if(!va.userIds||0===va.userIds.length){f.console.log("Offline message userIds required.");return}if(-1===va.userIds.indexOf(a))return}k&&clearInterval(k);k=setTimeout(function(){clearInterval(k);
k="";m.showOfflineMessage()},5E3*parseInt(va.timeout))}};b.stopOfflineMessageCounter=function(){k&&clearInterval(k);k=""}},M=new MckUtils,Zb=new function(){var b=this,c="",m="",g=!1,k=a("#mck-my-loc"),n=a("#mck-loc-box"),E=a("#mck-loc-lat"),T=a("#mck-loc-lon"),V=a("#mck-btn-loc"),x=a("#mck-sidebox-ft"),F=a("#mck-file-menu"),p=a("#mck-btn-attach"),r=a("#mck-map-content"),v=a("#mck-loc-address");b.init=function(){mb&&f.google&&"object"===typeof f.google.maps&&(c=new f.google.maps.Geocoder,p.on("click",
function(){b.fileMenuToggle()}),V.on("click",function(){g?n.mckModal():(mckMapUtils.getCurrentLocation(b.onGetCurrLocation,b.onErrorCurrLocation),g=!0)}));k.on("click",function(){mckMapUtils.getCurrentLocation(b.onGetMyCurrLocation,b.onErrorMyCurrLocation)})};b.fileMenuReposition=function(){var a=x.offset();a.bottom=f.innerHeight-a.top;F.css({bottom:51<a.bottom?a.bottom:51,right:0})};b.fileMenuToggle=function(){p.hasClass("on")?(p.removeClass("on"),F.hide()):(b.fileMenuReposition(),p.addClass("on"),
F.show())};b.onGetCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;b.openMapBox()};b.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;b.openMapBox()};b.onErrorMyCurrLocation=function(a){alert("Unable to retrieve your location. ERROR("+a.code+"): "+a.message)};b.onGetMyCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;E.val(MCK_CURR_LATITIUDE);T.val(MCK_CURR_LONGITUDE);
E.trigger("change");T.trigger("change");m?v.val(m):c&&c.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(a,b){"OK"===b&&a[1]&&(m=a[1].formatted_address)})};b.openMapBox=function(){r.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:E,longitudeInput:T,locationNameInput:v},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(a){MCK_CURR_LATITIUDE=a.latitude;MCK_CURR_LONGITUDE=
a.longitude}});n.on("shown.bs.mck-box",function(){r.locationpicker("autosize")});n.mckModal()}},Fa=new function(){var b=a("#mck-msg-form"),c=a("#mck-msg-error"),m=a("#mck-tab-title"),g=a("#mck-tab-status"),k=a(".mck-typing-box"),n=a("#mck-block-button"),p=a("#mck-message-cell .mck-message-inner");this.updateUserConnectedStatus=function(){a(".mck-user-ol-status").each(function(){var b=a(this),f=b.data("mck-id");if(f){var c=za[f];"undefined"!==typeof za[f]&&c.connected?(b.removeClass("n-vis").addClass("vis"),
b.next().html("("+MCK_LABELS.online+")")):(b.removeClass("vis").addClass("n-vis"),b.next().html("(Offline)"))}})};this.lastSeenOfGroupOfTwo=function(a){f.MCK_OL_MAP[a]?(g.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),g.removeClass("n-vis").addClass("vis")):ba[a]&&(a=mckDateUtils.getLastSeenAtStatus(ba[a]),g.html(a),g.attr("title",a),m.addClass("mck-tab-title-w-status"),g.removeClass("n-vis").addClass("vis"))};this.toggleBlockUser=function(a,l){l?(c.html(MCK_LABELS.blocked),c.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),
b.removeClass("vis").addClass("n-vis"),m.removeClass("mck-tab-title-w-status"),g.removeClass("vis").addClass("n-vis"),k.removeClass("vis").addClass("n-vis"),p.data("blocked",!0),n.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"])):(c.html(""),c.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),b.removeClass("n-vis").addClass("vis"),p.data("blocked",!1),n.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),La[a]||!f.MCK_OL_MAP[a]&&!ba[a]||(f.MCK_OL_MAP[a]?
g.attr("title",MCK_LABELS.online).html(MCK_LABELS.online):ba[a]&&(a=mckDateUtils.getLastSeenAtStatus(ba[a]),g.html(a),g.attr("title",a)),m.addClass("mck-tab-title-w-status"),g.removeClass("n-vis").addClass("vis")))}};new function(){var b=a("#mck-msg-to");a("#mck-btn-loc");var c=a("#mck-loc-box"),g=a("#mck-msg-sbmt"),m=a("#mck-msg-error"),k=a("#mck-loc-submit"),n=a("#mck-msg-response"),p=a("#mck_response_text"),T=a("#mck-message-cell .mck-message-inner");k.on("click",function(){var a={type:5,contentType:2,
message:f.JSON.stringify(mckMapUtils.getSelectedLocation())},l=T.data("mck-conversationid"),k=T.data("mck-topicid");l?a.conversationId=l:k&&(l={topicId:k},k=aa[k],"object"===typeof k&&(l.topicDetail=f.JSON.stringify(k)),a.conversationPxy=l);!0===T.data("isgroup")?a.groupId=b.val():a.to=b.val();g.attr("disabled",!0);m.removeClass("vis").addClass("n-vis");m.html("");p.html("");n.removeClass("vis").addClass("n-vis");y.sendMessage(a);c.mckModal("hide")})};var w=new MckGroupService,C=new MckGroupUtils,
v=new function(){var b=this,g={0:MCK_LABELS.user,1:MCK_LABELS.admin,2:MCK_LABELS.moderator,3:MCK_LABELS.member},k=document.getElementById("mck-group-create-type");k.options[k.options.length]=new Option(MCK_LABELS["public"],"1");k.options[k.options.length]=new Option(MCK_LABELS["private"],"2");k.options[k.options.length]=new Option(MCK_LABELS.open,"6");var n=a("#mck-msg-form"),ea=a("#mck-msg-error"),p=a("#mck-tab-title"),E=a("#mck-tab-status"),T=a("#mck-no-gsm-text"),V=a("#mck-gms-loading"),x=a("#mck-contact-loading");
a("#mck-tab-menu-box");a("#mck-search-loading");var F=a("#mck-group-info-tab"),r=a("#mck-sidebox-search");a("#mck-group-name-box");var Ec=a("#mck-group-back-link"),u=a("#mck-group-name-edit"),I=a("#mck-group-name-save"),G=a("#mck-sidebox-content"),N=a("#mck-tab-option-panel"),O=a("#mck-btn-group-create"),oa=a("#mck-group-create-tab"),L=a("#mck-contacts-content"),ya=a("#mck-btn-group-update"),P=a("#mck-group-create-type"),nb=a("#mck-group-icon-upload"),ob=a("#mck-group-icon-change"),$b=a("#mck-group-member-list"),
U=a("#mck-group-update-panel"),K=a(".mck-tab-message-option"),Y=a("#mck-group-create-title"),la=a(".mck-group-menu-options"),Ga=a("#mck-group-member-search"),ac=a("#mck-btn-group-icon-save");a("#mck-group-info-icon-box");var Fc=a(".mck-group-admin-options"),Db=a("#mck-group-add-member-box"),W=a("#mck-message-cell .mck-message-inner"),fa=a("#mck-group-name-sec .mck-group-title");a("#mck-group-create-icon-box");var Gc=a("#mck-group-info-icon-loading"),S=a("#mck-gm-search-box");a("#mck-group-member-search-list");
var X=a("#mck-group-create-icon-loading"),pa=a("#mck-group-info-icon-box .mck-group-icon"),ma=a("#mck-group-create-icon-box .mck-group-icon"),na=a("#mck-group-create-icon-box .mck-overlay-box"),ia=a("#mck-gc-overlay-label");a(".mck-group-name-box div[contenteditable]").keypress(function(f){if(8===f.which||37===f.keyCode||38===f.keyCode||39===f.keyCode||40===f.keyCode||f.ctrlKey&&97===f.which)return!0;if(13!==f.keyCode||f.shiftKey||f.ctrlKey)return 30>this.innerHTML.length;a(f.target).hasClass("mck-group-create-title")&&
b.submitCreateGroup();return!1}).on("paste",function(a){var b=this;setTimeout(function(){30<b.innerText.length&&(b.innerHTML=b.innerText.substring(0,30),M.setEndOfContenteditable(b));return!1},"fast")}).on("drop",function(a){a.preventDefault();a.stopPropagation()});a(c).on("click",".mck-btn-change-role",function(b){b.preventDefault();b=a(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var f=a(this).parents(".mck-li-group-member").data("role");b.find("select").val(f);b.removeClass("n-vis").addClass("vis");
U.removeClass("n-vis").addClass("vis")});ya.on("click",function(){var b=[];a(".mck-group-change-role-box.vis").each(function(f,c){f=a(this);c=parseInt(f.find("select").val());var g=f.parents(".mck-li-group-member").data("role");c!==g&&(f={userId:f.parents(".mck-li-group-member").data("mck-id"),role:c},b.push(f))});if(0<b.length){var f=W.data("mck-id"),c=W.data("isgroup");f&&c&&(ya.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),w.updateGroupInfo({groupId:f,users:b,apzCallback:v.onUpdateGroupInfo}))}});
a("#mck-group-info-icon-box .mck-overlay").on("click",function(a){ob.trigger("click")});a("#mck-group-create-icon-box .mck-overlay").on("click",function(a){nb.trigger("click")});a(c).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var b=a(this);0===b.find(".mck-group-icon-default").length&&b.find(".mck-overlay-box").addClass("n-vis")});a(c).on("mouseenter",
".mck-group-info-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").addClass("n-vis")});u.on("click",function(){fa.attr("contenteditable",!0).focus();M.setEndOfContenteditable(fa[0]);I.removeClass("n-vis").addClass("vis");u.removeClass("vis").addClass("n-vis")});I.on("click",function(){var b=a.trim(fa.text());if(0<b.length){var f=W.data("mck-id"),c=W.data("isgroup");
f&&c&&(u.removeClass("n-vis").addClass("vis"),I.removeClass("vis").addClass("n-vis"),fa.attr("contenteditable",!1),w.updateGroupInfo({groupId:f,name:b,apzCallback:v.onUpdateGroupInfo}))}else fa.addClass("mck-req-border")});ac.on("click",function(){var a=pa.data("iconurl");if(a){var b=W.data("mck-id"),f=W.data("isgroup");b&&f&&(setTimeout(function(){ac.removeClass("vis").addClass("n-vis")},1E3),pa.data("iconurl",""),w.updateGroupInfo({groupId:b,imageUrl:a,apzCallback:v.onUpdateGroupInfo}))}else fa.addClass("mck-req-border")});
O.on("click",function(){b.submitCreateGroup()});b.init=function(){a.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
a.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e')};
b.submitCreateGroup=function(){var b=a.trim(Y.text()),f=P.val(),c=ma.data("iconurl");0<b.length?(b={groupName:b},f&&(f=parseInt(f),-1!==Lb.indexOf(f)&&(b.type=f)),c&&(b.groupIcon=c),ma.data("iconurl",""),b.isInternal=!0,O.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),y.getGroup(b)):Y.addClass("mck-req-border")};b.loadGroups=function(b){b=b.data;bb.length=0;a.each(b,function(a,b){"undefined"!==typeof b.id&&(b=C.addGroup(b),bb.push(b))})};b.getDeletedAtTime=function(a){if("object"===typeof MCK_GROUP_MAP[a])return MCK_GROUP_MAP[a].deletedAtTime};
b.validateOpenGroupUser=function(a){if(6===a.type){if(!w.authenticateGroupUser(a)){if(ua.disableChatForNonGroupMember){var b=ua.defaultChatDisabledMessage;b||(b="Chat disabled");ea.html(b);ea.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");n.removeClass("vis").addClass("n-vis");p.removeClass("mck-tab-title-w-status");E.removeClass("vis").addClass("n-vis")}la.removeClass("vis").addClass("n-vis");K.removeClass("vis").addClass("n-vis");N.removeClass("vis").addClass("n-vis");"undefined"===
typeof Jb[a.contactId]&&Q.subscribeToOpenGroup(a)}a.adminName===A?0===ua.deleteChatAccess&&K.removeClass("vis").addClass("n-vis"):(ua.allowInfoAccessGroupMembers||la.removeClass("vis").addClass("n-vis"),2!==ua.deleteChatAccess&&K.removeClass("vis").addClass("n-vis"),ua.allowInfoAccessGroupMembers||2===ua.deleteChatAccess||N.removeClass("vis").addClass("n-vis"));return!1}return!0};b.addGroupStatus=function(a){var f=b.isGroupLeft(a);if(6!==a.type&&(f||kc)){if(f)v.onGroupLeft("",{groupId:a.contactId});
p.removeClass("mck-tab-title-w-status");E.removeClass("vis").addClass("n-vis")}else if(0<a.members.length){f="";for(var c=!1,g=30>=a.members.length?a.members.length:25,k=0;k<g;k++)if(A===""+a.members[k]||-1!==a.removedMembersId.indexOf(a.members[k]))c=!0;else{var l=m.fetchContact(""+a.members[k]);l=m.getTabDisplayName(l.contactId,!1);f+=" "+l+","}if(5!==a.type&&6!==a.type||c&&5!==a.type)f+=" You";30<a.members.length&&(f+=" and "+(a.members.length-25)+" more");f=f.replace(/,\s*$/,"");E.html(f);E.attr("title",
f);E.removeClass("n-vis").addClass("vis");p.addClass("mck-tab-title-w-status");la.removeClass("n-vis").addClass("vis")}else p.removeClass("mck-tab-title-w-status"),E.removeClass("vis").addClass("n-vis");7===a.type&&(E.html(""),la.removeClass("vis").addClass("n-vis"))};b.disableGroupTab=function(){ea.html(MCK_LABELS["group.chat.disabled"]);ea.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");n.removeClass("vis").addClass("n-vis");p.removeClass("mck-tab-title-w-status");E.removeClass("vis").addClass("n-vis")};
b.isGroupLeft=function(b){var f=!1;b.removedMembersId&&0<b.removedMembersId.length&&a.each(b.removedMembersId,function(a,b){b===A&&(f=!0)});return f};b.onGroupLeft=function(a,f){x.removeClass("vis").addClass("n-vis");if("object"===typeof a&&"error"===a.status)alert("Unable to process your request. "+a.errorMessage);else if(a=f.groupId,F.hasClass("vis"))f=F.data("mck-id"),a===f&&Ec.trigger("click");else if(G.hasClass("vis")){f=W.data("mck-id");var c=W.data("isgroup");f===a.toString()&&c&&(la.removeClass("vis").addClass("n-vis"),
b.disableGroupTab())}};b.onAddedGroupMember=function(f,c){x.removeClass("vis").addClass("n-vis");if("object"===typeof f&&"error"===f.status)alert("Unable to process your request. "+f.errorMessage);else{var g=c.groupId,k=c.userId;f="";g?f=C.getGroup(g):c.clientGroupId&&(f=C.getGroupByClientGroupId(c.clientGroupId));"object"===typeof f?(f=w.addMemberToGroup(f,k),F.hasClass("vis")?(c=F.data("mck-id"),g===c&&(g=m.fetchContact(""+k),0===a("#li-gm-"+g.htmlId).length&&b.addGroupMember(f,g),b.sortGroupMemberHtmlList(),
b.enableGroupAdminMenuToggle())):G.hasClass("vis")&&(c=W.data("mck-id"),k=W.data("isgroup"),c===g.toString()&&k&&b.addGroupStatus(f))):w.getGroupFeed({groupId:g,clientGroupId:c.clientGroupId,apzCallback:v.onGroupFeed})}};b.onRemovedGroupMember=function(f,c){x.removeClass("vis").addClass("n-vis");if("object"===typeof f&&"error"===f.status)alert("Unable to process your request. "+f.errorMessage);else{f=c.groupId;var g=c.userId,k="";f?k=C.getGroup(f):c.clientGroupId&&(k=C.getGroupByClientGroupId(c.clientGroupId));
"object"===typeof k?(k=w.removeMemberFromGroup(k,g),F.hasClass("vis")?(k=F.data("mck-id"),f===k&&(f=m.fetchContact(""+g),f=a("#li-gm-"+f.htmlId),0<f.length&&f.remove())):G.hasClass("vis")&&(c=W.data("mck-id"),g=W.data("isgroup"),c===f.toString()&&g&&b.addGroupStatus(k))):w.getGroupFeed({groupId:f,clientGroupId:c.clientGroupId,apzCallback:v.onGroupFeed})}};b.onGroupFeed=function(f,c){x.removeClass("vis").addClass("n-vis");if("success"===f.status){f=f.data;var g=f.conversationPxy,k=C.getGroup(f.id);
f.deletedAtTime&&(ea.html(MCK_LABELS["group.deleted"]),ea.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),n.removeClass("vis").addClass("n-vis"));var l=[];"object"===typeof g&&(ca[g.id]=g,Aa[g.topicId]=[g.id],g.topicDetail&&(aa[g.topicId]=a.parseJSON(g.topicDetail)),l.push(g));0<l.length&&(Ha[c.groupId]=l);xa.loadUserProfiles(f.membersId,function(b,f){a.each(b,function(a,b){"undefined"===typeof m.getContact(b)&&f.push(b)});da.getUsersDetail(f,{async:!1})});c.isMessage&&"object"===typeof c.message&&
m.populateMessage(c.messageType,c.message,c.notifyUser);c.isReloadTab&&b.reloadGroupTab(k)}};b.onUpdateGroupInfo=function(f,c){x.removeClass("vis").addClass("n-vis");ya.attr("disabled",!1).html("Update");U.removeClass("vis").addClass("n-vis");if("object"===typeof f&&"error"===f.status)alert("Unable to process your request. "+f.errorMessage);else{f=c.groupId;c=c.groupInfo;var g=C.getGroup(f);if("object"===typeof g){c.imageUrl&&(g.imageUrl=c.imageUrl);c.newName&&(g.displayName=c.newName);c.metadata&&
(g.metadata=c.metadata);c.users&&0<c.users.length&&a.each(c.users,function(a,b){b.userId&&(g.users[b.userId]=b)});if(F.hasClass("vis"))c.imageUrl&&pa.html(w.getGroupImage(g.imageUrl)),fa.html(g.displayName),c.users&&0<c.users.length&&($b.html(""),b.addMembersToGroupInfoList(g),g.adminName===A?Db.removeClass("n-vis").addClass("vis"):Db.removeClass("vis").addClass("n-vis"));else if(G.hasClass("vis")){var m=W.data("mck-id"),k=W.data("isgroup");m===f.toString()&&k?p.html(g.displayName):0<a("#li-group-"+
g.htmlId).length&&(a("#li-group-"+g.htmlId+" .mck-cont-name strong").html(g.displayName),c.imageUrl&&a("#li-group-"+g.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+g.imageUrl+"'\x3e"))}MCK_GROUP_MAP[g.contactId]=g}}};b.getGroupFeedFromMessage=function(a){var b=a.message;if(b){a.groupId=b.groupId;a.isMessage=!0;if(b.conversationId){var f=ca[b.conversationId];if("object"!==typeof f||"object"!==typeof aa[f.topicId])a.conversationId=b.conversationId}a.apzCallback=v.onGroupFeed;w.getGroupFeed(a)}};b.reloadGroupTab=
function(a){var f=W.data("mck-id"),c=W.data("isgroup");f===a.contactId.toString()&&c&&b.addGroupStatus(a)};b.loadGroupTab=function(b){"error"===b.status?alert("Unable to process your request. "+b.errorMessage):(m.loadTab({tabId:b.data.contactId,isGroup:!0}),a("#mck-search").val(""))};b.addMembersToGroupInfoList=function(f){var c=f.members;c.sort();$b.html("");a.each(c,function(c,g){g&&(c=m.fetchContact(""+g),0===a("#li-gm-"+c.htmlId).length&&b.addGroupMember(f,c))});b.sortGroupMemberHtmlList();b.enableGroupAdminMenuToggle()};
b.enableGroupAdminMenuToggle=function(){a(".mck-group-member-info").bind("mouseenter",function(){a(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",function(){a(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};b.addGroupMember=function(b,c){var k="n-vis",l="n-vis",P=b.users[c.contactId],O=MCK_LABELS.member,n=3;P&&"undefined"!==typeof P.role&&(n=P.role,O=g[P.role]);P=m.getTabDisplayName(c.contactId,!1);c.contactId===b.adminName&&(k="vis");b.adminName===A&&(l=
"vis");c.contactId===A&&(P=MCK_LABELS.you,l="n-vis");b=m.getContactImageLink(c,P);var B="";ta[c.contactId]||(f.MCK_OL_MAP[c.contactId]?B=MCK_LABELS.online:ba[c.contactId]&&(B=mckDateUtils.getLastSeenAtStatus(ba[c.contactId])));c=[{roleExpr:O,roleVal:n,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:c.htmlId,contIdExpr:c.contactId,contImgExpr:b,contLastSeenExpr:B,contNameExpr:P,contFirstAlphaExpr:P.charAt(0).toUpperCase(),isAdminExpr:k,enableAdminMenuExpr:l}];
a.tmpl("groupMemberTemplate",c).appendTo("#mck-group-member-list")};b.addMembersToGroupSearchList=function(){var f=W.data("mck-id");if(W.data("isgroup")){var c=C.getGroup(f),g=db,k=[];f=ALStorage.getFriendListGroupName();var l=ALStorage.getFriendListGroupType();f&&l&&(g=da.getFriendList(f,l));f&&!l&&(g=da.getFriendList(f));g=g.filter(function(a,b){return g.indexOf(a)===b});g.sort();var P=c.members;a.each(g,function(a,f){f&&(f="object"===typeof f&&f.contactId?m.fetchContact(""+f.contactId):m.fetchContact(""+
f),-1===P.indexOf(f.contactId)||-1!==P.indexOf(f.contactId)&&-1!==c.removedMembersId.indexOf(f.contactId))&&(b.addGroupSearchMember(f),k.push(f))});b.enableGroupAdminMenuToggle();0<k.length?T.removeClass("vis").addClass("n-vis"):T.removeClass("n-vis").addClass("vis");m.initAutoSuggest({contactsArray:k,$searchId:Ga,isContactSearch:!1})}V.removeClass("vis").addClass("n-vis")};b.addGroupSearchMember=function(b){var c=m.getTabDisplayName(b.contactId,!1),g=m.getContactImageLink(b,c),k="user-"+b.htmlId,
l="";ta[b.contactId]||(f.MCK_OL_MAP[b.contactId]?l=MCK_LABELS.online:ba[b.contactId]&&(l=mckDateUtils.getLastSeenAtStatus(ba[b.contactId])));a.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:k,contIdExpr:b.contactId,contImgExpr:g,contLastSeenExpr:l,contNameExpr:c}]).appendTo("#mck-group-member-search-list")};b.loadCreateGroupTab=function(){L.removeClass("vis").addClass("n-vis");G.removeClass("vis").addClass("n-vis");r.removeClass("vis").addClass("n-vis");F.removeClass("vis").addClass("n-vis");X.removeClass("vis").addClass("n-vis");
ma.data("iconurl","");Y.html("");na.removeClass("n-vis");ia.html(MCK_LABELS["add.group.icon"]);ma.html(w.getGroupDefaultIcon());oa.removeClass("n-vis").addClass("vis")};b.loadGroupInfo=function(a){if(a.groupId){fa.attr("contenteditable",!1);I.removeClass("vis").addClass("n-vis");u.removeClass("n-vis").addClass("vis");L.removeClass("vis").addClass("n-vis");G.removeClass("vis").addClass("n-vis");r.removeClass("vis").addClass("n-vis");U.removeClass("vis").addClass("n-vis");oa.removeClass("vis").addClass("n-vis");
ac.removeClass("vis").addClass("n-vis");Gc.removeClass("vis").addClass("n-vis");F.removeClass("n-vis").addClass("vis");F.data("mck-id",a.groupId);pa.data("iconurl","");a.conversationId&&F.data("mck-conversation-id",a.conversationId);$b.html("");var f=C.getGroup(a.groupId);"object"===typeof f?(pa.html(w.getGroupImage(f.imageUrl)),fa.html(f.displayName),b.addMembersToGroupInfoList(f),f.adminName===A?Db.removeClass("n-vis").addClass("vis"):Db.removeClass("vis").addClass("n-vis")):w.getGroupFeed({groupId:a.groupId,
apzCallback:v.onGroupFeed})}};b.sortGroupMemberHtmlList=function(){a("#mck-group-member-list .mck-li-group-member").sort(function(a,b){return a.dataset.alpha>b.dataset.alpha}).appendTo("#mck-group-member-list")};b.addGroupMemberFromSearch=function(a){var b=F.data("mck-id");if("undefined"!==typeof b&&"undefined"!==typeof a){var f=C.getGroup(b);"object"===typeof f&&A===f.adminName?(xa.loadUserProfile(a),w.addGroupMember({groupId:b,userId:a,apzCallback:v.onAddedGroupMember})):Fc.removeClass("vis").addClass("n-vis")}S.mckModal("hide")}},
Eb=new function(){var b=this,f=["CREATE","UPDATE"],g=a("#mck-file-box"),k=a(".mck-overlay"),n=a("#mck-msg-sbmt"),r=a("#mck-text-box"),E=a("#mck-file-input"),T=a("#mck-autosuggest-search-input"),V=a(".mck-overlay-box"),x=a(".mck-file-upload"),F=a("#mck-group-icon-upload"),v=a("#mck-group-icon-change"),w=a("#mck-group-info-icon-box"),A=a("#mck-btn-group-icon-save"),y=a("#mck-message-cell .mck-message-inner"),C=a("#mck-group-create-icon-box"),u=a("#mck-group-info-icon-loading"),O=a("#mck-group-create-icon-loading"),
oa=a("#mck-group-info-icon-box .mck-group-icon"),L=a("#mck-group-create-icon-box .mck-group-icon"),ya=a("#mck-gc-overlay-label");b.init=function(){a.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"km-progress km-progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"km-progress-bar km-progress-bar-success km-bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-attach-icon mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
Kommunicate.attachEvents(a);x.on("click",function(){E.trigger("click")});F.on("change",function(){var c=a(this)[0].files[0];b.uplaodFileToAWS(c,f[0]);return!1});v.on("change",function(){var c=a(this)[0].files[0];b.uplaodFileToAWS(c,f[1]);return!1});E.on("change",function(){var f=a(this)[0].files[0],c={};c.file=f;c.name=f.name;"awsS3Server"===Na?b.uploadAttachment2AWS(c):"googleCloud"===Na?b.customFileUpload(c):b.uploadFile(c)});a(c).on("click",".mck-remove-file",function(){var b=a(this).parents(".mck-file-box"),
f=b.data("mckfile");b.remove();n.attr("disabled",!1);0===g.find(".mck-file-box").length&&(g.removeClass("vis").addClass("n-vis"),r.attr("required",""));"object"===typeof f&&(G.deleteFileMeta(f.blobKey),a.each(U,function(a,b){"undefined"!==typeof b&&b.blobKey===f.blobKey&&U.splice(a,1)}))});T.on("input",function(a){a.preventDefault();r.text(T.val());"KM_AUTO_SUGGEST"!=T.data("origin")&&""!=T.data("source-url")&&m.populateAutoSuggest({sourceUrl:T.data("source-url"),method:T.data("method"),headers:T.data("headers")})})};
b.audioRecoder=function(a){"awsS3Server"===Na?b.uploadAttachment2AWS(a):"googleCloud"===Na?b.customFileUpload(a):b.uploadFile(a)};b.customFileUpload=function(b){var f=b.file,c=new FormData,k=[];if("undefined"!==typeof f)if(4<a(".mck-file-box").length&&k.push("Can't upload more than 5 files at a time"),f.size>1048576*Ba&&k.push("file size can not be more than "+Ba+" MB"),0<k.length)alert(k.toString());else{k=M.randomId();var l=[{fileIdExpr:k,fileName:b.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+
b.name+"\x3c/a\x3e",fileSizeExpr:G.getFilePreviewSize(f.size)}];a.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var O=a(".mck-file-box."+k),P=a(".mck-file-box."+k+" .mck-file-lb"),B=a(".mck-file-box."+k+" .km-progress .km-bar"),L=a(".mck-file-box."+k+" .km-progress"),Z=a(".mck-file-box."+k+" .mck-remove-file");B.css("width","0%");L.removeClass("n-vis").addClass("vis");Z.attr("disabled",!0);x.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");if(b.name===a(".mck-file-box."+k+" .mck-file-lb a").html()){var ea=
y.data("mck-id");ja[b.name+f.size]=ea;n.attr("disabled",!0);c.append("files[]",f);b=new XMLHttpRequest;(b.upload||b).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);B.css("width",a+"%")});b.addEventListener("load",function(b){b=a.parseJSON(this.responseText);if("object"===typeof b){b=b.fileMeta;var f="object"===typeof b?'\x3ca href\x3d"'+b.url+'" target\x3d"_blank"\x3e'+b.name+"\x3c/a\x3e":"",c=b.name,g=b.size,k=y.data("mck-id");c+=g;g=ja[c];if(ea!==k)m.updateDraftMessage(g,
b),delete ja[c];else return Z.attr("disabled",!1),x.attr("disabled",!1),n.attr("disabled",!1),delete ja[c],P.html(f),L.removeClass("vis").addClass("n-vis"),a(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),U.push(b),O.data("mckfile",b),x.children("input").val(""),!1}else Z.attr("disabled",!1),n.attr("disabled",!1),Z.trigger("click")});b.open("post",cc+"/files/upload/",!0);b.setRequestHeader("UserId-Enabled",!0);b.setRequestHeader("Authorization","Basic "+p);
b.setRequestHeader("Application-Key",Y);b.setRequestHeader("Device-Key",ha);ia&&b.setRequestHeader("Access-Token",ia);b.send(c)}return!1}};b.uploadFile=function(b){var f=b.file,c=[];if("undefined"!==typeof f)if(4<a(".mck-file-box").length&&c.push("Can't upload more than 5 files at a time"),f.size>1048576*Ba&&c.push("file size can not be more than "+Ba+" MB"),0<c.length)alert(c.toString());else{c=M.randomId();var k=[{fileIdExpr:c,fileName:b.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+
b.name+"\x3c/a\x3e",fileSizeExpr:G.getFilePreviewSize(f.size)}];a.tmpl("fileboxTemplate",k).appendTo("#mck-file-box");var l=a(".mck-file-box."+c),O=a(".mck-file-box."+c+" .mck-file-lb"),B=a(".mck-file-box."+c+" .km-progress .km-bar"),P=a(".mck-file-box."+c+" .km-progress"),L=a(".mck-file-box."+c+" .mck-remove-file");B.css("width","0%");P.removeClass("n-vis").addClass("vis");L.attr("disabled",!0);x.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");if(b.name===a(".mck-file-box."+c+" .mck-file-lb a").html()){var Z=
y.data("mck-id");ja[b.name+f.size]=Z;n.attr("disabled",!0);b=[];b.push(f);var p=new XMLHttpRequest;(p.upload||p).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);B.css("width",a+"%")});p.addEventListener("load",function(b){b=a.parseJSON(this.responseText);if("object"===typeof b.fileMeta){b=b.fileMeta;var f=G.getFilePreviewPath(b),c=b.name,g=b.size,k=y.data("mck-id");c+=g;g=ja[c];if(Z!==k)m.updateDraftMessage(g,b),delete ja[c];else return L.attr("disabled",!1),x.attr("disabled",
!1),n.attr("disabled",!1),delete ja[c],O.html(f),P.removeClass("vis").addClass("n-vis"),a(".mck-file-box .km-progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),U.push(b),l.data("mckfile",b),x.children("input").val(""),!1}else L.attr("disabled",!1),n.attr("disabled",!1),L.trigger("click")});a.ajax({type:"GET",url:Ra+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=new FormData;b.append("files[]",f);p.open("POST",a,
!0);p.send(b)},error:function(){}})}return!1}};b.uploadAttachment2AWS=function(b){var f=b.file,c=new FormData,k=[];if("undefined"!==typeof f)if(4<a(".mck-file-box").length&&k.push("Can't upload more than 5 files at a time"),f.size>1048576*Ba&&k.push("file size can not be more than "+Ba+" MB"),0<k.length)alert(k.toString());else{k=M.randomId();var l=[{fileIdExpr:k,fileName:b.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+b.name+"\x3c/a\x3e",fileSizeExpr:G.getFilePreviewSize(f.size)}];
a.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var O=a(".mck-file-box."+k),B=a(".mck-file-box."+k+" .mck-file-lb"),L=a(".mck-file-box."+k+" .km-progress .km-bar"),P=a(".mck-file-box."+k+" .km-progress"),Z=a(".mck-file-box."+k+" .mck-remove-file");L.css("width","0%");P.removeClass("n-vis").addClass("vis");Z.attr("disabled",!0);x.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");if(b.name===a(".mck-file-box."+k+" .mck-file-lb a").html()){var ea=y.data("mck-id");ja[b.name+f.size]=ea;
n.attr("disabled",!0);c.append("file",f);b=new XMLHttpRequest;(b.upload||b).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);L.css("width",a+"%")});b.addEventListener("load",function(b){b=a.parseJSON(this.responseText);if("object"===typeof b){var f="object"===typeof b?'\x3ca href\x3d"'+b.url+'" target\x3d"_blank"\x3e'+b.name+"\x3c/a\x3e":"",c=b.name,g=b.size,k=y.data("mck-id");c+=g;g=ja[c];if(ea!==k)m.updateDraftMessage(g,b),delete ja[c];else return Z.attr("disabled",!1),
x.attr("disabled",!1),n.attr("disabled",!1),delete ja[c],B.html(f),P.removeClass("vis").addClass("n-vis"),a(".mck-file-box .km-progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),U.push(b),O.data("mckfile",b),x.children("input").val(""),!1}else Z.attr("disabled",!1),n.attr("disabled",!1),Z.trigger("click")});b.open("post",MCK_BASE_URL+"/rest/ws/upload/image",!0);b.setRequestHeader("UserId-Enabled",!0);b.setRequestHeader("Authorization","Basic "+p);b.setRequestHeader("Application-Key",
Y);b.setRequestHeader("Device-Key",ha);ia&&b.setRequestHeader("Access-Token",ia);b.send(c)}return!1}};b.uplaodFileToAWS=function(a,b){var c=new FormData,g=[];"undefined"!==typeof a&&(-1===a.type.indexOf("image")&&g.push("Please upload image file."),0<g.length?alert(g.toString()):(k.attr("disabled",!0),f[0]===b?(C.find(".mck-overlay-box").removeClass("n-vis"),C.removeClass("mck-hover-on"),O.removeClass("n-vis").addClass("vis")):(w.find(".mck-overlay-box").removeClass("n-vis"),w.removeClass("mck-hover-on"),
u.removeClass("n-vis").addClass("vis")),g=new XMLHttpRequest,g.addEventListener("load",function(a){if(a=this.responseText)f[0]===b?(L.html('\x3cimg src\x3d"'+a+'"/\x3e'),L.data("iconurl",a),ya.html(MCK_LABELS["change.group.icon"]),O.removeClass("vis").addClass("n-vis"),C.addClass("mck-hover-on")):(oa.html('\x3cimg src\x3d"'+a+'"/\x3e'),oa.data("iconurl",a),u.removeClass("vis").addClass("n-vis"),w.addClass("mck-hover-on"),setTimeout(function(){A.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){V.addClass("n-vis")},
1500);k.attr("disabled",!1);f[0]===b?F.val(""):v.val("");return!1}),c.append("file",a),g.open("post",MCK_BASE_URL+"/rest/ws/upload/file",!0),g.setRequestHeader("UserId-Enabled",!0),g.setRequestHeader("Authorization","Basic "+p),g.setRequestHeader("Application-Key",Y),g.setRequestHeader("Device-Key",ha),ia&&g.setRequestHeader("Access-Token",ia),g.send(c)))};b.addFileBox=function(b){var f=M.randomId(),c="";"object"===typeof b.fileMeta&&(f=b.fileMeta.createdAtTime,c=b.fileMeta.name);a.tmpl("fileboxTemplate",
[{fileNameExpr:b.filelb,fileSizeExpr:b.filesize,fileIdExpr:f,fileName:c}]).appendTo("#mck-file-box");f=a(".mck-file-box."+f);c=f.find(".mck-remove-file");var g=f.find(".progress");"object"===typeof b.fileMeta?(f.data("mckblob",b.fileMeta.blobKey),r.removeAttr("required"),n.attr("disabled",!1),c.attr("disabled",!1),g.removeClass("vis").addClass("n-vis"),U.push(b.fileMeta)):(n.attr("disabled",!0),c.attr("disabled",!0),g.removeClass("n-vis").addClass("vis"))}},m=new function(){var b=this,g="",k=a("#mck-search"),
n=a("#mck-msg-to"),p=a(".mck-file-lb"),r=a(".mck-file-sz"),E=a("#mck-sidebox"),T=a("#mck-file-box"),V=a("#mck-msg-sbmt"),x=a("#mck-msg-form"),F=a("#mck-text-box"),Ta=a("#mck-msg-error");a("#mck-show-more");var u=a("#mck-tab-title"),Y=a("#mck-tab-status"),S=a("#mck-message-cell"),X=a(".mck-typing-box");a("#mck-no-messages");var N=a("#mck-product-box"),O=a(".mck-product-icon"),oa=a(".mck-product-title"),L=a(".mck-product-subtitle"),ya=a("#mck-product-box .mck-caret"),P=a(".mck-product-rt-up .mck-product-key"),
nb=a("#mck-contact-search-input-box"),ob=a(".mck-product-rt-up .mck-product-value"),ia=a(".mck-product-rt-down .mck-product-key"),ja=a(".mck-product-rt-down .mck-product-value");a("#li-mck-group-info");a("#li-mck-leave-group");var ha=a("#mck-group-info-tab"),ka=a("#mck-group-search-tab"),la=a("#mck-no-search-groups"),Ga=a("#mck-group-create-tab"),qa=a("#mck-group-search-list");a("#mck-group-search-tabview");var ua=a(".mck-group-menu-options"),sa=a(".mck-videocall-btn"),W=a("#mck-group-search-input"),
fa=a("#mck-group-search-input-box"),Aa=a("#mck-contact-search-list"),ra=a("#mck-contacts-content"),Ba=a("#mck-contact-search-tab");a("#mck-contact-search-tabview");var pa=a("#mck-contact-search-input"),ma=a("#mck-autosuggest-search-input"),na=a("#mck-autosuggest-metadata");a("#mck-search-list");var Ca=a("#mck-no-search-contacts"),eb=a("#mck-search-tab-box li a"),Pa=a("#mck-search-tabview-box"),Ea=a("#mck-sidebox-search"),q=a("#mck-contact-loading"),gb=a("#mck-typing-label"),Xa=a("#mck-price-widget"),
hb=a("#mck-msg-response"),Ia=a("#mck_response_text"),Ma=a("#li-mck-block-user"),Za=a("#li-mck-video-call"),t=a("#mck-search-loading"),H=a("#mck-tab-individual"),R=a("#mck-attachfile-box"),Va=a("#mck-attachmenu-box"),fb=a("#mck-sidebox-content"),Qa=a("#mck-tab-option-panel"),bc=a("#mck-tab-conversation"),Fb=a("#mck-conversation-header");a("#mck-no-conversations");var pb=a("#mck-conversation-list"),kb=a(".mck-tab-message-option"),tb=a(".mck-box-ft .mck-box-form"),vc=a("#mck-btn-clear-messages"),ub=
a("#mck-offline-message-box"),D=a("#mck-message-cell .mck-message-inner");a("#mck-msg-new");var Na=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);b.init=function(){a.template("convTemplate",'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"${nameTextExpr} ${showNameExpr} mck-conversation-name"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class \x3d"km-conversation-container-right"\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d"move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}"data-filename\x3d"${fileNameExpr}" data-fileurl\x3d"${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box-rich-text-container ${kmRichTextMarkupVisibility} ${containerType}"\x3e{{html kmRichTextMarkup}}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward ${msgForwardVisibleExpr}"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
a.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e')};
b.openConversation=function(){"none"===E.css("display")&&(a(".mckModal").mckModal("hide"),E.mckModal());n.focus()};b.initEmojis=function(){try{a("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(h){g||(g=setTimeout(function(){b.initEmojis()},3E4))}};b.loadTab=function(h,c){var J=D.data("mck-id");if(J)if(1<F.html().length||T.hasClass("vis")){var g={text:F.html(),files:[]};T.hasClass("vis")&&a(".mck-file-box").each(function(){var b=a(this),h={filelb:b.find(".mck-file-lb").html(),
filesize:b.find(".mck-file-sz").html()};b=b.data("mckfile");"object"===typeof b&&(h.fileMeta=b);g.files.push(h)});Sa[J]=g}else delete Sa[J];Ka=!0;b.clearMessageField(!1);b.addDraftMessage(h.tabId);Ta.html("");Ta.removeClass("vis").addClass("n-vis");Ia.html("");hb.removeClass("vis").addClass("n-vis");x[0].reset();x.removeClass("n-vis").addClass("vis");D.html("");Ta.removeClass("mck-no-mb");ra.removeClass("n-vis").addClass("vis");tb.removeClass("vis").addClass("n-vis");a("#mck-sidebox-ft").removeClass("vis").addClass("n-vis");
Ea.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");Ga.removeClass("vis").addClass("n-vis");fb.removeClass("n-vis").addClass("vis");N.removeClass("vis").addClass("n-vis");Fb.addClass("n-vis");q.removeClass("vis").addClass("n-vis");D.removeClass("mck-group-inner");Y.removeClass("vis").addClass("n-vis");u.removeClass("mck-tab-title-w-status");u.removeClass("mck-tab-title-w-typing");X.removeClass("vis").addClass("n-vis");gb.html(MCK_LABELS.typing);D.data("isgroup",h.isGroup);
D.data("datetime","");if(h.tabId)n.val(h.tabId),D.data("mck-id",h.tabId),D.data("mck-conversationid",h.conversationId),D.data("mck-topicid",h.topicId),Qa.data("tabId",h.tabId),Qa.removeClass("n-vis").addClass("vis"),ra.removeClass("vis").addClass("n-vis"),tb.removeClass("n-vis").addClass("vis"),a("#mck-sidebox-ft").removeClass("n-vis").addClass("vis"),vc.removeClass("n-vis").addClass("vis"),ua.removeClass("vis").addClass("n-vis"),h.isGroup?(D.addClass("mck-group-inner"),Ma.removeClass("vis").addClass("n-vis"),
Za.removeClass("vis").addClass("n-vis"),sa.removeClass("vis").addClass("n-vis")):(Ma.removeClass("n-vis").addClass("vis"),Za.removeClass("n-vis").addClass("vis"),Ya&&sa.removeClass("n-vis").addClass("vis")),!h.topicId&&h.conversationId&&(J=ca[h.conversationId],"object"===typeof J&&(h.topicId=J.topicId)),h.topicId&&(J=aa[h.topicId],"object"===typeof J&&(Oa?(D.data("mck-title",J.title),Fb.html(J.title),Fb.removeClass("n-vis")):ab&&(b.setProductProperties(J,h.topicId),ya.addClass("n-vis"),N.addClass("mck-product-box-wc"),
pb.addClass("n-vis"),N.removeClass("n-vis").addClass("vis")))),mb&&f.google&&"object"===typeof f.google.maps?(R.removeClass("vis").addClass("n-vis"),Va.removeClass("n-vis").addClass("vis")):(Va.removeClass("vis").addClass("n-vis"),R.removeClass("n-vis").addClass("vis")),J=b.getTabDisplayName(h.tabId,h.isGroup,h.userName),b.isGroupDeleted(h.tabId,h.isGroup)&&(Ta.html(MCK_LABELS["group.deleted"]),Ta.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),x.removeClass("vis").addClass("n-vis")),u.html(J),
u.attr("title",J),bc.removeClass("vis").addClass("n-vis"),Pa.removeClass("vis").addClass("n-vis"),H.removeClass("n-vis").addClass("vis"),"support"===Ib&&a(".mck-tab-link").removeClass("vis").addClass("n-vis"),Sb&&(Xa.removeClass("n-vis").addClass("vis"),D.addClass("mck-msg-w-panel")),qb&&(Ta.html("Deactivated"),Ta.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),x.removeClass("vis").addClass("n-vis")),Q.subscibeToTypingChannel(h.isGroup?h.tabId:A),"function"===typeof Pb&&Pb({tabId:h.tabId,
isGroup:h.isGroup});else if(h.tabId="",rb&&m.hideOfflineMessage(),H.removeClass("vis").addClass("n-vis"),bc.removeClass("n-vis").addClass("vis"),Pa.removeClass("n-vis").addClass("vis"),N.removeClass("vis").addClass("n-vis"),D.data("mck-id",""),D.data("mck-conversationid",""),D.data("mck-topicid",""),Xa.removeClass("vis").addClass("n-vis"),D.removeClass("mck-msg-w-panel"),Qa.removeClass("vis").addClass("n-vis"),vc.removeClass("vis").addClass("n-vis"),n.val(""),J=ALStorage.getLatestMessageArray(),Q.unsubscibeToTypingChannel(),
null!==J&&0<J.length){h.isReload=!0;m.addContactsFromMessageList({message:J},h);b.openConversation();Ka=!1;return}y.loadMessageList(h,c);b.openConversation()};b.setProductProperties=function(a,f){oa.html(a.title);O.html(b.getTopicLink(a.link));L.html(a.subtitle?a.subtitle:"");var h=a.value1?":"+a.value1:"";P.html(a.key1?a.key1:"");ob.html(h);h=a.value2?":"+a.value2:"";ia.html(a.key2?a.key2:"");ja.html(h);"function"===typeof Mb&&(a.topicId=f,Mb(a))};b.getTopicLink=function(a){return a?'\x3cimg src\x3d"'+
a+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};b.processMessageList=function(h,f,c){var J=D.children("div[name\x3d'message']:first"),g=D.data("mck-id"),H=D.data("isgroup")?C.getGroup(g):m.fetchContact(g);if("undefined"===typeof h.message.length){g=[];g.push(h.message);ALStorage.updateMckMessageArray(g);b.addMessage(h.message,H,!1,!1,c);var t=h.createdAtTime}else ALStorage.updateMckMessageArray(h.message),a.each(h.message,function(a,h){"undefined"!==typeof h.to&&(b.addMessage(h,
H,!1,!1,c),t=h.createdAtTime)});Qa.data("datetime",t);!f&&0<J.length?D.scrollTop(J.offset().top-D.offset().top+D.scrollTop()):f&&D.animate({scrollTop:D.prop("scrollHeight")},"fast")};b.closeConversation=function(a){var b;if("function"===typeof Ob){var h=Ob();"object"===typeof h&&(b="BUSY_WITH_OTHER"===a?h.onBusyWithOtherUser:h.onConversationClose)}b||(b="Chat disabled with user");Ta.html(b);Ta.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");x.removeClass("vis").addClass("n-vis")};b.addTooltip=
function(b){a("."+b+" .mck-icon-time").attr("title","pending");a("."+b+" .mck-btn-trash").attr("title","delete");a("."+b+" .mck-icon-sent").attr("title","sent");a("."+b+" .mck-btn-forward").attr("title","forward message");a("."+b+" .mck-icon-delivered").attr("title","delivered");a("."+b+" .mck-icon-read").attr("title","delivered and read");a("."+b+" .msgtype-outbox-cr").attr("title","sent via Carrier");a("."+b+" .msgtype-outbox-mck").attr("title","sent");a("."+b+" .msgtype-inbox-cr").attr("title",
"received via Carrier");a("."+b+" .msgtype-inbox-mck").attr("title","recieved")};b.fetchContact=function(a){var h=b.getContact(a);"undefined"===typeof h&&(h=b.createContact(a));return h};b.getContact=function(a){if("object"===typeof Ja[a])return Ja[a]};b.getContactDisplayName=function(a){if("string"===typeof Da[a])return Da[a];if("undefined"===typeof Da[a]&&(a=za[a],"undefined"!==typeof a))return a.displayName};b.sendUserEmail=function(){if(1<document.getElementById("input-for-email").value.length){var b=
document.getElementById("input-for-email").value;da.updateUser({data:{email:b},success:function(b){console.log("email updated successfully !");a("#input-for-email").after("\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cspan\x3eEmail Sent\x3c/span\x3e\x3c/div\x3e");a("#input-for-email").remove();a("#send-email-button").remove()},error:function(a){}})}else alert("No email")};b.updateMetadata=function(a,b){a=f.JSON.stringify({key:a,metadata:b});M.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",
global:!1,data:a,contentType:"application/json",success:function(a){console.log("metadata cleared successfully !")}})};b.addMessage=function(h,J,g,H,t){var k,Wa="",R="",l="";var z="vis";var n="n-vis",Va="",O="n-vis";if("object"===typeof h.metadata&&"undefined"!==typeof h.metadata.AL_REPLY&&(Wa=h.metadata.AL_REPLY,R=I.getReplyMessageByKey(Wa),"undefined"!==typeof R)){if(J.isGroup&&R||!J.isGroup&&"undefined"===typeof R.fileMeta)O="vis";Va=5===R.type?"You":m.getTabDisplayName(R.to,!1);if("object"===
typeof R.fileMeta||2===R.contentType)l=b.getImageForReplyMessage(R),z="n-vis",n="vis",O="n-vis"}if(6!==h.type&&7!==h.type&&!(h.metadata&&"HIDDEN"===h.metadata.category||102===h.contentType||h.metadata&&(h.metadata.KM_ASSIGN||h.metadata.KM_STATUS)||10===h.contentType&&h.metadata&&"true"===h.metadata.hide||0<a("#mck-message-cell ."+h.key).length)){var B=h.message||h.fileMeta?"vis":"n-vis",L="mck-msg-right",fb="mck-icon-time";if(0===h.type||4===h.type||6===h.type)L="mck-msg-left";if(4===h.contentType||
10===h.contentType||103===h.contentType)L="mck-msg-center";fb=b.getStatusIconName(h);Wa=h.key;var Qa="'"+h.deviceKey+"','"+h.to+"','"+h.to+"','"+Wa+"'",Z="",P="",p="",ea="n-vis",wc="";xa.loadUserProfile(h.to);!h.groupId||4===h.contentType||7===J.type||0!==h.type&&4!==h.type&&6!==h.type||(Z=b.getTabDisplayName(h.to,!1),ea="vis",p=b.getNameTextClassByAlphabet(Z));if(jc){wc="mck-msg-avator-bubble";var x="",q=Z;"mck-msg-right"===L?(x=m.fetchContact(A),q=b.getTabDisplayName(x.displayName,!1)):"mck-msg-left"===
L&&(x=h.groupId?m.fetchContact(h.to):J);x&&(P=b.getContactImageLink(x,q))}h.groupId&&10===h.contentType&&(p=P=Z="");x="n-vis";var oa=q="",r=h.message;"object"===typeof h.fileMeta&&(q=h.fileMeta.name,oa=h.fileMeta.size);"object"===typeof h.fileMeta&&(h.fileMeta.contentType.indexOf("audio")||h.fileMeta.contentType.indexOf("image")||h.fileMeta.contentType.indexOf("video"))&&(x="vis");var V="n-vis";Ab&&f.MCK_OL_MAP[h.to]&&10!==h.contentType&&(V="vis");J=Kommunicate.isRichTextMessage(h.metadata);l=[{msgReply:R?
R.message+"\n":"",msgReplyTo:R?Va+"\n":"",msgReplyDivExpr:R?"vis":"n-vis",msgReplyToVisibleExpr:O,msgPreview:l?b.getImageForReplyMessage(R):"",msgpreviewvisExpr:n,textreplyVisExpr:z,msgKeyExpr:h.key,msgDeliveredExpr:h.delivered,msgSentExpr:h.sent,msgCreatedAtTime:h.createdAtTime,msgTypeExpr:h.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"kommunicate"==window.applozic.PRODUCT_ID?"n-vis":"vis",msgSourceExpr:h.source,statusIconExpr:fb,
contactExpr:"vis",toExpr:h.to,msgAvatorClassExpr:wc,showNameExpr:ea,msgNameExpr:Z,msgImgExpr:P,nameTextExpr:p,msgFloatExpr:L,replyIdExpr:Wa,createdAtTimeExpr:mckDateUtils.getDate(h.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:Qa,downloadMediaUrlExpr:G.getFileAttachment(h),msgClassExpr:B,msgExpr:r,selfDestructTimeExpr:h.timeToLive,fileMetaKeyExpr:h.fileMetaKey,downloadIconVisibleExpr:x,fileExpr:m.getFilePath(h),fileUrlExpr:G.getFileurl(h),fileNameExpr:q,fileSizeExpr:oa,contOlExpr:V,
kmRichTextMarkupVisibility:J?"vis":"n-vis",kmRichTextMarkup:J?Kommunicate.getRichTextMessageTemplate(h.metadata):"",containerType:Kommunicate.getConatainerTypeForRichMessage(h.metadata)}];g?a.tmpl("messageTemplate",l).appendTo("#mck-message-cell .mck-message-inner"):a.tmpl("messageTemplate",l).prependTo("#mck-message-cell .mck-message-inner");if((!h.metadata.obsolete||"true"!=h.metadata.obsolete)&&h.metadata.KM_AUTO_SUGGESTION){l={};try{l=JSON.parse(h.metadata.KM_AUTO_SUGGESTION)}catch(Ic){console.error("suggestionList should be an array")}ma.addClass("mck-text-box").removeClass("n-vis");
F.removeClass("mck-text-box").addClass("n-vis");ma.attr("placeholder",l.placeholder?l.placeholder:"");ma.data("prev-msgkey",h.key);l.source.constructor==Array?(ma.data("origin","KM_AUTO_SUGGEST"),l.source.length&&m.populateAutoSuggest({source:l.source})):"object"===typeof l.source&&(ma.data("source-url",l.source.url),ma.data("method",l.source.method?l.source.method:"get"),ma.data("headers",l.source.headers?l.source.headers:{}))}if(23===h.contentType){if("BUTTON"===h.metadata.msg_type){z=[];if(h.metadata.payload){if(z=
a.parseJSON(h.metadata.payload),z[0].hidden||(k="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+z[0].title+"\x3c/button\x3e\x3c/div\x3e"),1<z.length)for(l=1;l<z.length;l++)z[l].hidden||(k+="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+z[l].title+
"\x3c/button\x3e\x3c/div\x3e")}else console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d BUTTON"),k="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3eButton\x3c/button\x3e\x3c/div\x3e";a("div[data-msgkey\x3d'"+h.key+"'] .blk-lg-12").after(k)}"INPUT"===h.metadata.msg_type&&"false"===h.metadata.hidden&&(console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d INPUT"),
k="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput id\x3d'input-for-email' type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e\x3cbutton id\x3d'send-email-button' style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3eSubmit\x3c/button\x3e\x3c/div\x3e",a("div[data-msgkey\x3d'"+h.key+"'] .blk-lg-12").after(k),a("#send-email-button").click(function(){1<document.getElementById("input-for-email").value.length&&
(b.sendUserEmail(),b.updateMetadata(h.key,{hidden:"true"}))}));if("LIST"===h.metadata.msg_type&&(z=[],h.metadata.payload)){z=a.parseJSON(h.metadata.payload);console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d LIST");k="";z[0].hidden||("button"===z[0].type.toLowerCase()?k="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+z[0].title+"\x3c/button\x3e\x3c/div\x3e":
"input"===z[0].type.toLowerCase()&&(k="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e"+("\x3cbutton style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3e"+z[0].title+"\x3c/button\x3e\x3c/div\x3e")));if(1<z.length)for(l=1;l<z.length;l++)z[l].hidden||("button"===z[l].type.toLowerCase()?k+="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+
z[l].title+"\x3c/button\x3e\x3c/div\x3e":"input"===z[l].type.toLowerCase()&&(k+="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e",k+="\x3cbutton style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3e"+z[l].title+"\x3c/button\x3e\x3c/div\x3e"));a("div[data-msgkey\x3d'"+h.key+"'] .blk-lg-12").after(k)}}k="";h.message&&
(k=h.message.replace(/\n/g,"\x3cbr/\x3e"),null!==f.emoji&&"undefined"!==typeof f.emoji&&(k=f.emoji.replace_unified(k),k=f.emoji.replace_colons(k)));h.conversationId&&(l=ca[h.conversationId],"object"!==typeof l&&I.getTopicId({conversationId:h.conversationId},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)}),g&&(D.data("mck-conversationid",h.conversationId),l&&(z=aa[l.topicId],"object"===typeof z&&(ab?b.setProductProperties(z,l.topicId):Oa&&Fb.html(z.title)))));4===h.contentType&&
(l=k,k="Final agreed price: "+k,Sb||(k+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+l+'" data-mck-conversationid\x3d"'+h.conversationId+'"\x3eAccept\x3c/button\x3e'));z=a("."+Wa+" .mck-msg-content");if(-1===k.indexOf("emoji-inner")&&0===h.contentType)for(n=k.split("\x3cbr/\x3e"),l=0;l<n.length;l++)""===n[l]?k=c.createElement("BR"):(k=c.createElement("div"),k.appendChild(c.createTextNode(n[l])),n[l]&&n[l].match(Na)&&(k=a(k).linkify({target:"_blank"}))),z.append(k);else z.html(k),
z.linkify({target:"_blank"});J&&Kommunicate.richMsgEventHandler.initializeSlick(a("div[data-msgkey\x3d'"+h.key+"'] .km-div-slider"));h.fileMeta&&(a("."+Wa+" .mck-file-text a:first").trigger("click"),a("."+Wa+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===z.html()&&z.removeClass("vis").addClass("n-vis"));2===h.contentType&&(z.removeClass("vis").addClass("n-vis"),a("."+Wa+" .mck-file-text").removeClass("n-vis").addClass("vis"));H&&D.animate({scrollTop:D.prop("scrollHeight")},"fast");kb.hasClass("n-vis")&&
(h.groupId?6!==C.getGroup(h.groupId).type&&kb.removeClass("n-vis").addClass("vis"):kb.removeClass("n-vis").addClass("vis"));b.addTooltip(h.key);4!==h.contentType&&10!==h.contentType&&t&&b.messageContextMenu(h.key);h.groupId&&10===h.contentType&&g&&w.getGroupFeed({groupId:h.groupId,isReloadTab:!0,apzCallback:v.onGroupFeed})}};b.addContactForSearchList=function(h,c){var J=h.userCount,g=h.isGroup,H=b.getTabDisplayName(h.contactId,g),t=b.getContactImageLink(h,H),k=g?"gs-group-"+h.htmlId:"cs-user-"+h.htmlId,
l="",m=g&&Vb;a("#li-"+k+" .mck-group-count-text").html(J);g||ta[h.contactId]||(f.MCK_OL_MAP[h.contactId]?l=MCK_LABELS.online:ba[h.contactId]&&(l=mckDateUtils.getLastSeenAtStatus(ba[h.contactId])));a.tmpl("searchContactbox",[{contHtmlExpr:k,contIdExpr:h.contactId,contTabExpr:h.isGroup,contImgExpr:t,contLastSeenExpr:l,contNameExpr:H,groupUserCountExpr:h.userCount,displayGroupUserCountExpr:m?"vis":"n-vis"}]).prependTo("#"+c)};b.getFilePath=function(h){if(2===h.contentType)try{var f=a.parseJSON(h.message);
if(f.lat&&f.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+f.lat+","+f.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+f.lat+","+f.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+f.lat+","+f.lon+"\x26key\x3d"+fc+'"/\x3e\x3c/a\x3e'}catch(z){if(-1!==h.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+h.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
h.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+h.message+"\x26key\x3d"+fc+'" /\x3e\x3c/a\x3e'}return"object"===typeof h.fileMeta?-1!==h.fileMeta.contentType.indexOf("image")?-1!==h.fileMeta.contentType.indexOf("svg")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+h.fileMeta.contentType+'" data-url\x3d"'+G.getFileurl(h)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+Ra+"/rest/ws/aws/file/"+h.fileMeta.blobKey+
'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':5===h.contentType?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+h.fileMeta.contentType+'" data-url\x3d"'+h.fileMeta.blobKey+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+h.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':h.fileMeta.hasOwnProperty("url")?h.fileMeta.hasOwnProperty("thumbnailBlobKey")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
h.fileMeta.contentType+'" data-url\x3d"'+b.cloudupdate(h.fileMeta.BlobKey)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+b.cloudupdate(h.fileMeta.thumbnailBlobKey)+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+h.fileMeta.contentType+'" data-url\x3d"'+G.getFileurl(h)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+h.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':
h.fileMeta.thumbnailUrl==="thumbnail_"+h.fileMeta.name?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+h.fileMeta.contentType+'" data-url\x3d"'+G.getFileurl(h)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+Ac+"/files/thumbnail_"+h.fileMeta.name+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
h.fileMeta.contentType+'" data-url\x3d"'+G.getFileurl(h)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+h.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':-1!==h.fileMeta.contentType.indexOf("video")?'\x3ca href\x3d "#" target\x3d"_self"  \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+G.getFileurl(h)+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+G.getFileurl(h)+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e':-1!==h.fileMeta.contentType.indexOf("audio")?
'\x3ca href\x3d"#" target\x3d"_self" \x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+G.getFileurl(h)+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+G.getFileurl(h)+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e':""};b.getImageForMessagePreview=function(b){if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")?
'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+Ra+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" class\x3d"mck-image-reply move-right"/\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+G.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":
'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+G.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===b.contentType)return b=a.parseJSON(b.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+b.lat+","+
b.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.lat+","+b.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};b.getImageForReplyMessage=function(b){var h=m.getTabDisplayName(b.to,!1);if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+h+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+
G.getFileurl(b)+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+h+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+G.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":
'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+h+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+G.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===b.contentType)return b=a.parseJSON(b.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+h+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
b.lat+","+b.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.lat+","+b.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};b.getImageUrlForGroupType=function(a,f){return a.imageUrl?'\x3cimg src\x3d"'+a.imageUrl+'"/\x3e':b.getContactImageByAlphabet(f)};b.getContactImageLink=function(a,f){var h="";if(a.members&&10==a.type)h=b.getImageUrlForGroupType(a,f);else if(a.isGroup&&7!==a.type)h=w.getGroupImage(a.imageUrl);else{a.isGroup&&7===a.type&&1<a.members.length&&w.getContactFromGroupOfTwo(a,
function(b){a=m.fetchContact(b)});if("function"===typeof $a){var c=$a(a.contactId);c&&"undefined"!==typeof c&&(h='\x3cimg src\x3d"'+c+'"/\x3e')}h||(a.photoSrc?h='\x3cimg src\x3d"'+a.photoSrc+'"/\x3e':a.photoData?h='\x3cimg src\x3d"data:image/jpeg;base64,'+a.photoData+'"/\x3e':a.photoLink?h='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+a.photoLink+'"/\x3e':"bot"==a.contactId?h='\x3cimg src\x3d"https://api.kommunicate.io/img/logo02.svg"/\x3e':(f||(f=a.displayName),h=b.getContactImageByAlphabet(f)))}return h};
b.getContactImageByAlphabet=function(a){if("undefined"===typeof a||""===a)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';a=a.charAt(0);return a.match(/^[a-zA-Z0-9]+$/)?(a=a.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+a+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+a+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};
b.getNameTextClassByAlphabet=function(a){if("undefined"===typeof a||""===a)return"mck-text-user";a=a.toString();a=a.charAt(0);return a.match(/^[a-zA-Z0-9]+$/)?(a=a.toLowerCase(),"mck-text-"+a):"mck-text-user"};b.addContactsFromMessageList=function(f,c){if("null"===f+"")var h="";else 0==D.has(a("#mck-contact-list")).length&&D.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof f.message.length?(f.message.groupId?
w.addGroupFromMessage(f.message,!1,function(a,f,h){b.updateRecentConversationList(a,f,h)}):b.addContactsFromMessage(f.message),h=f.message.createdAtTime):a.each(f.message,function(a,f){"undefined"!==typeof f.to&&(f.groupId?w.addGroupFromMessage(f,!0,function(a,f,h){b.updateRecentConversationList(a,f,h)}):b.addContactsFromMessage(f,!0),h=f.createdAtTime)}),D.data("datetime",h),c.isReload&&(f="",c.lastActiveTabId&&(c=c.isLastActiveTabGroup?"group-"+c.lastActiveTabId:"user-"+mckContactUtils.formatContactId(c.lastActiveTabId),
f=a("#li-"+c)),0<f.length?D.animate({scrollTop:f.offset().top-D.offset().top+D.scrollTop()},"fast"):D.animate({scrollTop:0},0))};b.addGroupFromMessageList=function(f,c){"null"!==f+""&&(c&&D.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof f.message.length?w.addGroupFromMessage(f.message,!1,function(a,f,h){b.updateRecentConversationList(a,f,h)}):a.each(f.message,function(a,f){"undefined"!==typeof f.to&&w.addGroupFromMessage(f,
!0,function(a,f,h){b.updateRecentConversationList(a,f,h)})}))};b.createContact=function(a){var f=b.getContactDisplayName(a);"undefined"===typeof f&&(f=a);f={contactId:a,htmlId:mckContactUtils.formatContactId(a),displayName:f,name:f+" \x3c"+a+"\x3e [Main]",value:a,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return Ja[a]=f};b.createContactWithDetail=function(a){var f=a.displayName,h=a.userId;f||(f=b.getContactDisplayName(h));"undefined"===typeof f?f=h:Da[h]=f;var c=a.photoLink?
a.photoLink:"";c||(c=a.imageLink?a.imageLink:"");var g=a.imageData?a.imageData:"";a={contactId:h,htmlId:mckContactUtils.formatContactId(h),displayName:f,name:f+" \x3c"+h+"\x3e [Main]",value:h,photoLink:"",photoSrc:c,photoData:g,email:"",unsaved:!0,isGroup:!1,roleType:a.roleType};return Ja[h]=a};b.updateContactDetail=function(a,f){var h=f.displayName,c=f.userId;a.displayName&&a.displayName!==a.contactId||(h||(h=b.getContactDisplayName(c)),"undefined"===typeof h?h=c:Da[c]=h,a.displayName=h);(h=f.photoLink)||
(h=f.imageLink?f.imageLink:"");h&&!a.photoSrc&&(a.photoSrc=h);(h=f.imageData?f.imageData:"")&&!a.photoData&&(a.photoData=h);f.roleType&&(a.roleType=f.roleType);return Ja[c]=a};b.addContactsFromMessage=function(a,f){var h=b.getUserIdFromMessage(a);if(0<h.length&&h[0])for(var c=0;c<h.length;c++){var g=b.fetchContact(""+h[c]);b.updateRecentConversationList(g,a,f)}};b.updateRecentConversationList=function(f,c,g){0<a("#mck-contact-list #li-"+(f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId)).length?(a("#mck-contact-list #li-"+
f.htmlId+" .mck-cont-msg-wrapper").is(":empty")||g)&&void 0!==c&&b.updateContact(f,c,"mck-contact-list"):b.addContact(f,"mck-contact-list",c)};b.addContactsToSearchList=function(){var f=[],c=[];a.each(cb,function(a,b){c.push(b.contactId)});if("undefined"!==typeof contactList){var g={async:!1};g.userIds=contactList;da.getUsersDetail(g.userIds,g);c=contactList}g=c.filter(function(a,b){return c.indexOf(a)===b});g.sort();t.removeClass("vis").addClass("n-vis");0<g.length?a.each(g,function(h,c){c&&(h=b.fetchContact(""+
c),f.push(h),0===a("#li-cs-user-"+h.htmlId).length&&b.addContactForSearchList(h,"mck-contact-search-list"))}):Ca.removeClass("n-vis").addClass("vis");b.initAutoSuggest({contactsArray:f,$searchId:pa,isContactSearch:!0})};b.populateAutoSuggest=function(a){ma.mcktypeahead({order:"desc",hint:!1,minLength:3,wrapper:".mck-sidebox",backdropOnFocus:!0,menu:'\x3cul class\x3d"mcktypeahead mck-auto-suggest-menu mck-dropup-menu"\x3e\x3c/ul\x3e',show:function(){var a=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});
return this.$menu.css({left:a.left}),this.$menu.show(),this.shown=!0,this},source:a&&a.source?b.processAutosuggestData(a.source):function(f,h){M.ajax({url:a.sourceUrl+f,type:a.method,header:a.headers,success:function(a){a=b.processAutosuggestData(a.data);h(a)}})},items:8,updater:function(a){a=JSON.parse(a);0!=Object.keys(a.metadata).length&&na.val(JSON.stringify(a.metadata));F.text(a.displayMessage);return a.displayMessage},matcher:function(a){return(new RegExp(this.query,"i")).test(a.searchKey)},
highlighter:function(a){return JSON.parse(a.toString()).displayMessage}})};b.processAutosuggestData=function(a){var b=[];a.map(function(a){var f="string"===typeof a?{searchKey:a,message:a,metadata:{}}:a;b.push({searchKey:f.searchKey,toString:function(){return JSON.stringify({displayMessage:f.message,metadata:f.metadata?f.metadata:{}})},toLowerCase:function(){return f.searchKey.toLowerCase()},indexOf:function(a){return String.prototype.indexOf.apply(f.searchKey,arguments)},replace:function(a){return String.prototype.replace.apply('\x3cdiv style\x3d"padding: 10px; font-size: 1.5em;"\x3e'+
f.searchKey+"\x3c/div\x3e",arguments)}})});return b};b.initAutoSuggest=function(f){for(var h=f.contactsArray,c=f.$searchId,g=[],H,t={},k=[],l=0;l<h.length;l++){var R=h[l];R.displayName=b.getTabDisplayName(R.contactId,R.isGroup);H=R.displayName?a.trim(R.displayName):a.trim(R.contactId);if(!0===MCK_SELF_CHAT_DISABLE&&R.contactId!==A||!0!==MCK_SELF_CHAT_DISABLE)t[H]=R,g.push(H),k.push(H)}h=function(a){a=t[a];var b=a.displayName.split(" "),f=b.length,h=b[0],c="",g="";2===f?g=b[1]:3<=f&&(g=b[f-1],c=b[f-
2]);b=new RegExp(this.query,"i");return b.test(a.displayName)||b.test(a.contactId)||b.test(c)||b.test(g)||b.test(a.email)||b.test(h+" "+g)};H=function(a){return t[a].displayName};k=function(b){b=t[b];f.isContactSearch?(m.loadTab({tabId:b.contactId,isGroup:b.isGroup}),tb.removeClass("n-vis").addClass("vis"),a("#mck-sidebox-ft").removeClass("n-vis").addClass("n-vis")):v.addGroupMemberFromSearch(b.contactId)};c.hasClass("mck-typeahead")?(c.mcktypeahead().data("mcktypeahead").source=g,c.mcktypeahead().data("mcktypeahead").matcher=
h,c.mcktypeahead().data("mcktypeahead").highlighter=H,c.mcktypeahead().data("mcktypeahead").updater=k):(c.addClass("mck-typeahead"),c.mcktypeahead({source:g,matcher:h,highlighter:H,updater:k}))};b.initSearchAutoType=function(){rc&&(pa.keypress(function(a){13===a.which&&((a=pa.val())&&(!0===MCK_SELF_CHAT_DISABLE&&a!==A||!0!==MCK_SELF_CHAT_DISABLE)&&(a="undefined"!==typeof a&&""!==a?a.toString():"")&&(m.loadTab({tabId:a,isGroup:!1,isSearch:!0}),tb.removeClass("n-vis").addClass("vis")),pa.val(""))}),
W.keypress(function(a){if(13===a.which)return!0}),a(c).on("click",".mck-group-search-link",function(a){a.preventDefault();return!0}),a(c).on("click",".mck-contact-search-link",function(b){b.preventDefault();b=pa.val();""!==b&&(!0===MCK_SELF_CHAT_DISABLE&&b!==A||!0!==MCK_SELF_CHAT_DISABLE)&&(m.loadTab({tabId:b,isGroup:!1,isSearch:!0}),tb.removeClass("n-vis").addClass("vis"),a("#mck-sidebox-ft").removeClass("n-vis").addClass("vis"));pa.val("")}))};b.removeContact=function(b){a("#li-"+(b.isGroup?"group-"+
b.htmlId:"user-"+b.htmlId)).remove()};b.updateContact=function(f,c,g){var h=f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId,H=a("#li-"+h),t=H.data("msg-time");if((!c.metadata||!c.metadata.action)&&c&&c.createdAtTime>t){t=b.getUnreadCount(c.groupId?"group_"+f.contactId:"user_"+f.contactId);f=b.getMessageTextForContactPreview(c,f,200);a("#li-"+h+" .mck-cont-msg-date").html("undefined"===typeof c.createdAtTime?"":mckDateUtils.getTimeOrDate(c?c.createdAtTime:"",!0));var k=a("#li-"+h+" .mck-cont-msg-wrapper");
k.html("");"object"===typeof f?k.append(f):k.html(f);c.conversationId&&(f=c.conversationId,k=ca[f],"object"===typeof k&&(k=k.topicId)&&Oa&&(k=aa[k],"object"===typeof k&&a("#li-"+h+" .mck-conversation-topic").html(k.title)),a("#li-"+h+" a").data("mck-conversationid",f));0<t&&(a("#li-"+h+" .mck-unread-count-text").html(t),a("#li-"+h+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));h=a("#"+g+" li:nth-child(1)").data("msg-time");H.data("msg-time",c.createdAtTime);("undefined"===typeof h||
(c?c.createdAtTime:"")>=h)&&0!==a("#mck-contact-list li").index(H)&&a("#"+g+" li:nth-child(1)").before(H)}};b.clearContactMessageData=function(b,f){b=mckContactUtils.formatContactId(b);f=f?"group-"+b:"user-"+b;a("#li-"+f+" .mck-cont-msg-date").html("");a("#li-"+f+" .mck-cont-msg-wrapper").html("")};b.addContact=function(h,c,g){var H=b.getMessageTextForContactPreview(g,h,100),k=h.userCount,t="",l=!1;if("undefined"!==typeof g){if(g.conversationId){t=g.conversationId;var J=ca[t]}g.groupId&&(l=!0)}var R=
b.getTabDisplayName(h.contactId,l),n=b.getContactImageLink(h,R),Va=!1,O=b.getUnreadCount(l?"group_"+h.contactId:"user_"+h.contactId),B=0<O&&"mck-search-list"!==c?"vis":"n-vis",L="n-vis",z=l?"group-"+h.htmlId:"user-"+h.htmlId,fb=l&&Vb;a("#li-"+z+" .mck-group-count-text").html(k);a("#li-"+z+" .mck-group-count-box").removeClass("n-vis").addClass("vis");l||ta[h.contactId]||La[h.contactId]||!Ab||!f.MCK_OL_MAP[h.contactId]||(L="vis",Va=!0);if(7===h.type&&1<h.members.length){var Qa;z=C.getGroup(g.groupId);
w.getContactFromGroupOfTwo(z,function(a){Qa=m.fetchContact(a)});l&&Ab&&f.MCK_OL_MAP[Qa.contactId]&&(L="vis",Va=!0)}k="n-vis";if("object"===typeof J&&Oa&&(z=aa[J.topicId],"object"===typeof z)){k="vis";var Z=z.title}z=l?"group-"+h.htmlId:"user-"+h.htmlId;h=[{contHtmlExpr:z,contIdExpr:h.contactId,contTabExpr:l,msgCreatedAtTimeExpr:g?g.createdAtTime:"",mckLauncherExpr:lb,contImgExpr:n,contOlExpr:L,onlineLabel:MCK_LABELS.online,contUnreadExpr:B,contUnreadCount:O,contNameExpr:R,conversationExpr:t,contHeaderExpr:k,
titleExpr:Z,groupUserCountExpr:l?h.userCount:"",displayGroupUserCountExpr:fb?"vis":"n-vis",msgCreatedDateExpr:g?mckDateUtils.getTimeOrDate(g.createdAtTime,!0):""}];Z=a("#"+c+" li:nth-child(1)").data("msg-time");"undefined"===typeof Z||(g?g.createdAtTime:"")>=Z||-1!==c.indexOf("search")&&Va?a.tmpl("contactTemplate",h).prependTo("#"+c):a.tmpl("contactTemplate",h).appendTo("#"+c);c=a("#li-"+z+" .msgTextExpr");"object"===typeof H?c.append(H):c.html(H)};b.addContactsToContactSearchList=function(){Ca.removeClass("vis").addClass("n-vis");
la.removeClass("vis").addClass("n-vis");Ba.hasClass("active")||(eb.removeClass("active"),Ba.addClass("active"));qa.removeClass("vis").addClass("n-vis");Aa.removeClass("n-vis").addClass("vis");fa.removeClass("vis").addClass("n-vis");nb.removeClass("n-vis").addClass("vis");Aa.html("");ra.removeClass("vis").addClass("n-vis");fb.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");Ga.removeClass("vis").addClass("n-vis");Ea.removeClass("n-vis").addClass("vis");t.removeClass("n-vis").addClass("vis");
0!==cb.length?m.addContactsToSearchList():Wb?(t.removeClass("vis").addClass("n-vis"),Ca.removeClass("n-vis").addClass("vis")):da.loadContacts();pa.focus()};b.addGroupsToGroupSearchList=function(){var f=[],c=[];Ca.removeClass("vis").addClass("n-vis");la.removeClass("vis").addClass("n-vis");ka.hasClass("active")||(eb.removeClass("active"),ka.addClass("active"));Aa.removeClass("vis").addClass("n-vis");qa.removeClass("n-vis").addClass("vis");nb.removeClass("vis").addClass("n-vis");fa.removeClass("n-vis").addClass("vis");
qa.html("");ra.removeClass("vis").addClass("n-vis");fb.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");Ga.removeClass("vis").addClass("n-vis");Ea.removeClass("n-vis").addClass("vis");t.removeClass("n-vis").addClass("vis");if(0<bb.length){a.each(bb,function(a,b){c.push(b.contactId)});var g=c.filter(function(a,b){return c.indexOf(a)===b});g.sort();a.each(g,function(c,h){h&&(c=C.getGroup(""+h),f.push(c),0===a("#li-gs-group-"+c.htmlId).length&&b.addContactForSearchList(c,
"mck-group-search-list"))})}else la.removeClass("n-vis").addClass("vis");b.initAutoSuggest({contactsArray:f,$searchId:W,isContactSearch:!0});t.removeClass("vis").addClass("n-vis")};b.addConversationMenu=function(b,f){var c=D.data("mck-id");pb.html("");b===c&&(c=Ha[b],"undefined"===typeof c||0===c.length||1===c.length?(ya.addClass("n-vis"),N.addClass("mck-product-box-wc"),pb.addClass("n-vis")):(pb.removeClass("n-vis"),ya.removeClass("n-vis"),N.removeClass("mck-product-box-wc"),a.each(c,function(c,
h){0===a("#mck-conversation-list #li-"+h.id).length&&(c="",h.topicDetail&&(c=a.parseJSON(h.topicDetail),c="object"===typeof c?c.title:h.topicDetail),c||(c=h.topicId),a.tmpl("convTemplate",[{convIdExpr:h.id,tabIdExpr:b,isGroupExpr:f,topicIdExpr:h.topicId,convTitleExpr:c,mckLauncherExpr:lb}]).appendTo(pb))}),2>a("#mck-conversation-list li").length&&(ya.addClass("n-vis"),N.addClass("mck-product-box-wc"),pb.addClass("n-vis"))))};b.loadContacts=function(f){"null"!==f+""&&"undefined"!==typeof f&&"undefined"!==
typeof f.contacts&&0!==f.contacts.length&&(cb.length=0,db.length=0,a.each(f.contacts,function(a,f){"undefined"!==typeof f.userId&&(a=b.getContact(""+f.userId),a="undefined"===typeof a?b.createContactWithDetail(f):b.updateContactDetail(a,f),cb.push(a),db.push(a.contactId))}))};b.loadContactsForContactList=function(a){M.ajax({url:MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d"+(a.startIndex?a.startIndex:"0")+"\x26pageSize\x3d"+(a.pageSize?a.pageSize:"50")+"\x26orderBy\x3d1",type:"get",global:!1,
success:function(a){console.log(a)},error:function(){f.console.log("Unable to load contacts. Please reload page.")}})};b.getStatusIcon=function(a){return'\x3cspan class\x3d"'+b.getStatusIconName(a)+" move-right "+a.key+'_status status-icon"\x3e\x3c/span\x3e'};b.getStatusIconName=function(a){return 7===a.type||6===a.type||4===a.type||0===a.type?"":5===a.status?"mck-icon-read":4===a.status?"mck-icon-delivered":3===a.type||5===a.type||1===a.type&&(0===a.source||1===a.source)?"mck-icon-sent":""};b.clearMessageField=
function(a){F.html("");V.attr("disabled",!1);T.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required","").html("");a?F.focus().select():(k.blur(),F.blur())};b.addDraftMessage=function(b){U=[];b&&"object"===typeof Sa[b]?(b=Sa[b],F.html(b.text),0<b.files.length&&(a.each(b.files,function(a,b){Eb.addFileBox(b)}),p.html(b.filelb),r.html(b.filesize),T.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):U=[]};b.showOfflineMessage=function(){"object"===
typeof va&&va.innerHTML?(ub.html(va.innerHTML),ub.removeClass("n-vis").addClass("vis")):f.console.log("Offline message innerHTML required.")};b.hideOfflineMessage=function(){jb.stopOfflineMessageCounter();ub.removeClass("vis").addClass("n-vis")};b.removeConversationThread=function(b,f){ALStorage.clearMckMessageArray();var c=f?C.getGroup(b):m.getContact(b),h=D.data("mck-id"),g=D.data("isgroup");"undefined"===typeof h||""===h?(b="undefined"!==typeof c?c.htmlId:mckContactUtils.formatContactId(b),a("#li-"+
(f?"group-"+b:"user-"+b)).remove()):h===b&&g===f&&(Qa.data("datetime",""),S.removeClass("n-vis").addClass("vis"),kb.removeClass("vis").addClass("n-vis"))};b.removedDeletedMessage=function(b,f,c){ALStorage.clearMckMessageArray();b=a("."+b);0<b.length?(b.remove(),D.is(":empty")&&(S.removeClass("n-vis").addClass("vis"),kb.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof f&&0<a("#mck-contact-list").length&&I.updateContactList(f,c)};b.getMessageTextForContactPreview=function(a,b,g){var h="";
if("undefined"!==typeof a){if(a.message){if("true"===a.metadata.hide||a.metadata&&(a.metadata.KM_ASSIGN||a.metadata.KM_STATUS))return;if(2===a.contentType)h='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';else{h=a.message;if(M.startsWith(h,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';null!==f.emoji&&"undefined"!==typeof f.emoji&&(h=f.emoji.replace_unified(h),h=f.emoji.replace_colons(h),h=-1!==h.indexOf("\x3c/span\x3e")?h.substring(0,
h.lastIndexOf("\x3c/span\x3e")):h.substring(0,g));b.isGroup||-1!==h.indexOf("emoji-inner")||0!==a.contentType||(g=c.createElement("p"),g.appendChild(c.createTextNode(h)),h=g)}}else a.fileMetaKey&&"object"===typeof a.fileMeta?h=G.getFileIcon(a):a.metadata&&a.metadata.messagePreview&&(h=a.metadata.messagePreview);b.isGroup&&3!==b.type&&7!==b.type&&10!==b.type&&(b=a.to.split(",")[0]===A?"Me":m.getTabDisplayName(a.to.split(",")[0],!1),10!==a.contentType&&(h=b+": "+h),-1===h.indexOf("emoji-inner")&&a&&
a.message&&0===a.contentType&&(g=c.createElement("p"),g.appendChild(c.createTextNode(h)),h=g))}return h};b.getTextForMessagePreview=function(b,f){var h="";if("undefined"!==typeof b){if(2===b.contentType)h="Shared location";else if(b.message)if(h=b.message,M.startsWith(h,"\x3cimg"))h="Image attachment";else{var g=c.createElement("div");g.innerHTML=h;h=a.trim(M.textVal(g));h=h.substring(0,50)}else b.fileMetaKey&&"object"===typeof b.fileMeta&&(h=-1!==b.fileMeta.contentType.indexOf("image")?"Image attachment":
"File attachment");f.isGroup&&3!==f.type&&7!==f.type&&(h=(b.to.split(",")[0]===A?"Me":m.getTabDisplayName(b.to.split(",")[0],!1))+": "+h)}return h};b.getUserIdFromMessage=function(a){a=a.to;a.lastIndexOf(",")===a.length-1&&(a=a.substring(0,a.length-1));return a.split(",")};b.getUserIdArrayFromMessageList=function(f){var c=[];"undefined"===typeof f.length?c.concat(b.getUserIdFromMessage(f)):a.each(f,function(a,f){"undefined"!==typeof f.to&&(c=c.concat(b.getUserIdFromMessage(f)))});return c};b.messageContextMenu=
function(b){var c=a("."+b+" .mck-msg-box");c.addEventListener?c.addEventListener("contextmenu",function(a){a.preventDefault()},!1):c.bind("contextmenu",function(c){c.preventDefault();a(".mck-context-menu").removeClass("vis").addClass("n-vis");a("."+b+" .mck-context-menu").removeClass("n-vis").addClass("vis");f.event.returnValue=!1})};b.isValidMetaData=function(a){return a.metadata?"HIDDEN"===a.metadata.category||"ARCHIVE"===a.metadata.category||"true"==a.metadata.hide?!1:!0:!0};b.updateDraftMessage=
function(b,f){if("object"===typeof f){var c={text:"",files:[]};var h={fileMeta:f,filelb:G.getFilePreviewPath(f),filesize:G.getFilePreviewSize(f.size)};"undefined"!==typeof b&&"object"===typeof Sa[b]&&(c=Sa[b],a.each(c.files,function(a,b){b.filelb===h.filelb&&c.files.splice(a,1)}));c.files.push(h)}Sa[b]=c};b.updateUnreadCount=function(a,f,c){var h=b.getUnreadCount(a);wa[a]=f;if(c||0<Ua.length)K+=f-h,0>K&&(K=0),0<K?Ua.html(K):Ua.html("");c&&M.badgeCountOnLaucher(Ub,K)};b.incrementUnreadCount=function(a){K+=
1;wa[a]="undefined"===typeof wa[a]?1:wa[a]+1;0<Ua.length&&Ua.html(K);M.badgeCountOnLaucher(Ub,K)};b.getUnreadCount=function(a){return"undefined"===typeof wa[a]?wa[a]=0:wa[a]};b.isGroupDeleted=function(a,b){return b?(a=v.getDeletedAtTime(a),"undefined"!==typeof a&&0<a):!1};b.getTabDisplayName=function(a,f,c){var h="";if(f)return w.getGroupDisplayName(a);"function"===typeof Qb&&(h=Qb(a));"undefined"!==typeof c&&c&&(h=c,Da[a]=c);h||(h=b.getContactDisplayName(a));f=b.fetchContact(""+a);h?(f.displayName=
h,Ja[f.contactId]=f):"undefined"!==typeof f.displayName&&(h=f.displayName);h||(h=a);return h};b.populateMessage=function(f,c,g){var h=mckDateUtils.convertMilisIntoTime(c.metadata.CALL_DURATION);xa.loadUserProfile(c.to);103==c.contentType&&(4==c.type&&"CALL_REJECTED"==c.metadata.MSG_TYPE?c.message="you rejected a Video call from "+c.to:5==c.type&&"CALL_REJECTED"==c.metadata.MSG_TYPE?c.message=c.to+"rejected a Video call from you":4==c.type&&"CALL_END"==c.metadata.MSG_TYPE?c.message="you were in a call with "+
c.to+"\n call duration : "+h:5==c.type&&"CALL_END"==c.metadata.MSG_TYPE?c.message="you were in a call with "+c.to+"\n call duration : "+h:4==c.type&&"CALL_MISSED"==c.metadata.MSG_TYPE?c.message="you missed a Video call from "+c.to:5==c.type&&"CALL_MISSED"==c.metadata.MSG_TYPE&&(c.message=c.to+"missed a Video call from you"));var H=D.data("mck-id");var k=m.isValidMetaData(c);h=c.groupId?C.getGroup(c.groupId):m.getContact(c.to);if("undefined"===typeof H||""===H){var t=a("#mck-contact-list").length;
0<t&&k?c.groupId?w.addGroupFromMessage(c,!0,function(a,f,c){b.updateRecentConversationList(a,f,c)}):m.addContactsFromMessage(c,!0):m.addContactsFromMessageList({message:[c]},"");if("APPLOZIC_01"===f||"MESSAGE_RECEIVED"===f){"undefined"===typeof h&&(h=c.groupId?C.createGroup(c.groupId):m.createContact(c.to));if(Bb){m.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}f=c.groupId?"group_"+h.contactId:"user_"+h.contactId;k&&(10!==c.contentType&&102!==c.contentType&&
m.incrementUnreadCount(f),Cb.notifyUser(c));g=c.groupId?"group-"+h.htmlId:"user-"+h.htmlId;a("#li-"+g+" .mck-unread-count-text").html(m.getUnreadCount(f));0<m.getUnreadCount(f)&&a("#li-"+g+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");I.sendDeliveryUpdate(c)}}else if("undefined"===typeof h&&(h=c.groupId?C.createGroup(c.groupId):m.createContact(c.to)),"APPLOZIC_01"===f||"MESSAGE_RECEIVED"===f){if("undefined"!==typeof h&&(f=D.data("isgroup"),("undefined"===typeof c.oldKey||0===a("."+
c.oldKey).length)&&0===a("."+c.key).length||10===c.contentType)){if("undefined"===typeof H||H!==h.contactId||f!==h.isGroup||ha.hasClass("vis")){if(Bb){m.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}if(k&&10!==c.contentType||102!==c.contentType)f=c.groupId?"group_"+h.contactId:"user_"+h.contactId,m.incrementUnreadCount(f);I.sendDeliveryUpdate(c)}else{k=!0;f&&6===h.type&&(k=w.isAppendOpenGroupContextMenu(h));if(c.conversationId&&(Oa||ab))if((f=D.data("mck-conversationid"))&&
f.toString()===c.conversationId.toString())c.metadata&&"HIDDEN"===c.metadata.category||m.addMessage(c,h,!0,!0,k),I.sendReadUpdate(c.pairedMessageKey);else{if(Bb){m.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}}else{if(7===h.type){var l;f=C.getGroup(c.groupId);w.getContactFromGroupOfTwo(f,function(a){l=m.fetchContact(a)});Fa.lastSeenOfGroupOfTwo(l.contactId);m.addMessage(c,h,!0,!0,k)}(!c.metadata||"HIDDEN"!==c.metadata.category&&"true"!==c.metadata.hide&&7!==
h.type)&&m.addMessage(c,h,!0,!0,k);I.sendReadUpdate(c.pairedMessageKey)}c.groupId||(a("#mck-tab-status").html(MCK_LABELS.online),xa.updateUserStatus({userId:c.to,status:1},function(a){da.getUsersDetail(a,{})}))}g&&6!==h.type&&Cb.notifyUser(c)}}else"APPLOZIC_02"!==f||102!=!c.contentType||("undefined"!==typeof c.oldKey&&0!==a("."+c.oldKey).length||0!==a("."+c.key).length)&&10!==c.contentType||(0<t?m.addContactsFromMessage(c,!0):"undefined"!==typeof h&&(f=D.data("isgroup"),"undefined"!==typeof H&&H===
h.contactId&&f===h.isGroup&&(k=!0,f&&6===h.type&&(k=w.isAppendOpenGroupContextMenu(h)),c.metadata&&"HIDDEN"===c.metadata.category||m.addMessage(c,h,!0,!0,k),3===c.type&&(a("."+c.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),m.addTooltip(c.key)))));q.removeClass("vis").addClass("n-vis")};b.getMessageFeed=function(b){var f={};f.key=b.key;f.timeStamp=b.createdAtTime;f.message=b.message;f.from=4===b.type?b.to:A;f.to=b.groupId?b.groupId:5===b.type?b.to:A;f.status="read";
f.type=4===b.type?"inbox":"outbox";5===b.type&&(3===b.status?f.status="sent":4===b.status&&(f.status="delivered"));if("object"===typeof b.fileMeta){var c=a.extend({},b.fileMeta);if("undefined"===typeof c.url||""===c.url)c.url=Ra+"/rest/ws/aws/file/"+b.fileMeta.blobKey;delete c.blobKey;f.file=c}f.source=b.source;f.metadata=b.metadata;return f};b.updateUnreadCountonChatIcon=function(b){if(Xb&&0<b.length){var f=null,c=0;0<b.length&&(a.each(b,function(a,b){!(0<b.unreadCount&&null!==f)&&0<b.unreadCount&&
(f=b.userId,c=b.unreadCount)}),0<K&&"none"===E.css("display")&&(null!==f&&c===K?m.loadTab({tabId:f,isGroup:!1}):m.loadTab({tabId:"",isGroup:!1})))}};b.loadMessageListOnUserDetailFetch=function(b){q.removeClass("vis").addClass("n-vis");var f=D.data("mck-id"),c=D.data("isgroup");if("undefined"===typeof f||b.tabId===f&&""+c===""+b.isGroup)f=C.getGroup(b.tabId),v.addGroupStatus(f),c=!0,6===f.type&&(v.validateOpenGroupUser(f),c=w.isAppendOpenGroupContextMenu(f)),b.isMessages?(m.processMessageList(b.messageData,
!0,c),6!==f.type&&kb.removeClass("n-vis").addClass("vis"),"function"===typeof ib&&ib(b.tabId)):0===a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&kb.removeClass("vis").addClass("n-vis")}},y=new function(){var b=this,g=a("#mck-search"),k=a("#mck-msg-to"),n=a("#mck-msg-new");a("#mck-audio");a("#mck-mike-btn");var ea=a("#mck-sidebox"),r=a("#mck-file-box"),E=a("#mck-text-box"),T=a("#mck-msg-form"),V=a("#mck-msg-sbmt"),x=a("#mck-new-group"),F=a("#mck-tab-title"),u=a("#mck-msg-error"),
G=a("#mck-btn-attach"),K=a("#mck-tab-status"),S=a("#mck-message-cell"),ja=a(".mck-typing-box"),N=a("#mck-gms-loading"),O=a("#mck-group-title"),oa=a("#mck-contact-loading");a("#mck-no-messages");var L=a(".mck-group-search");a(".mck-city-search");var ya=a("#mck-msg-response"),P=a("#mck-msg-form #mck-file-input"),nb=a("#mck-block-button"),ob=a("#li-mck-block-user"),ka=a("#li-mck-group-info"),ra=a("#li-mck-video-call"),sa=a("#mck_response_text"),ua=a(".mck-contact-search"),la=a("#mck-group-info-tab"),
Ga=a("#mck-price-text-box");a("#mck-sidebox-search");var va=a("#mck-group-info-btn");la=a("#mck-group-info-tab");var Ba=a("#mck-btn-group-exit"),Ea=a("#mck-group-back-link"),W=a("#mck-btn-leave-group"),fa=a(".mck-sidebox-content");a("#mck-no-more-messages");var Da=a("#mck-btn-group-create");a("#mck-group-create-tab");var Ma=a("#mck-group-add-member");a("#mck-contacts-content");var wa=a("#mck-tab-option-panel");a("#mck-no-conversations");var pa=a("#mck-group-create-title"),ma=a(".mck-group-menu-options"),
na=a(".mck-tab-message-option"),Ia=a(".mck-group-admin-options"),eb=a("#mck-group-member-search"),Pa=a("#mck-autosuggest-search-input"),Ja=a("#mck-autosuggest-metadata"),q=a("#mck-message-cell .mck-message-inner");a("#mck-search-cell .mck-message-inner");a("#mck-no-more-conversations");var Na=a("#mck-gm-search-box"),Ua=a("#mck-group-member-search-list"),Ya=a("#mck-no-gsm-text"),Ra,$a=a("#mck-minutes"),bb=a("#mck-seconds");b.createNewConversation=function(a,b){Kommunicate.startConversation(a,b)};b.loadConversationWithAgents=
function(b,f){"kommunicate"==window.applozic.PRODUCT_ID&&W.removeClass("vis").addClass("n-vis");Kommunicate.client.getGroupDetailByType({type:10,startIndex:0,limit:10},function(b,c){b?console.log("error while fetching group detail by type",b):0==c.response.length?y.createNewConversation({groupName:gb,agentId:Xa,botIds:hb},function(a){f()}):(1==c.response.length?a.fn.applozic("loadGroupTab",c.response[0].id):a.fn.applozic("loadTab"),f())})};b.timer=function(){var a=0,b=this;Ra=setInterval(function(){++a;
bb.html(b.pad(a%60));$a.html(b.pad(parseInt(a/60)))},1E3);b.pad=function(a){a+="";return 2>a.length?"0"+a:a}};b.stoptimer=function(){bb.html("0");$a.html("0");clearInterval(Ra)};a(c).on("click",".mck-message-delete",function(){b.deleteMessage(a(this).parents(".mck-m-b").data("msgkey"))});a(c).on("click",".mck-message-reply",function(){b.replyMessage(a(this).parents(".mck-m-b").data("msgkey"))});a(c).on("click",".mck-message-forward",function(){n.data("forwardMessageKey",a(this).parents(".mck-m-b").data("msgkey"));
n.trigger("click")});a(".mck-minimize-icon").click(function(){a(".mck-box-md,.mck-box-ft").animate({height:"toggle"});fa.hasClass("minimized")?(fa.css("height","100%"),fa.removeClass("minimized")):(fa.css("height","0%"),fa.addClass("minimized"))});b.init=function(){a.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');
ALStorage.clearMckMessageArray();a(c).on("click","."+lb,function(){a(this).hasClass("mck-msg-preview")&&a(this).hide()});m.initSearchAutoType();ua.click(function(){y.createNewConversation({groupName:gb,agentId:Xa,botIds:hb},function(a){});a("#mck-msg-new").attr("disabled",!0)});a(c).on("click","#talk-to-human-link",function(){""===a("#km-faq-search-input").val()?(y.createNewConversation({groupName:gb,agentId:Xa,botIds:hb},function(a){}),KommunicateUI.showChat()):y.createNewConversation({groupName:gb,
agentId:Xa,botIds:hb},function(a){KommunicateUI.sendFaqQueryAsMsg(a);KommunicateUI.showChat()});a("#mck-contact-list").removeClass("vis").addClass("n-vis")});L.click(function(){m.addGroupsToGroupSearchList()});E.keydown(function(a){E.hasClass("mck-text-req")&&E.removeClass("mck-text-req");if(13===a.keyCode&&(a.shiftKey||a.ctrlKey)){if(a.preventDefault(),f.getSelection){a=f.getSelection();var b=a.getRangeAt(0),g=c.createElement("br"),k=c.createTextNode("\u00a0");b.deleteContents();b.insertNode(g);
b.collapse(!1);b.insertNode(k);b.selectNodeContents(k);a.removeAllRanges();a.addRange(b);E.animate({scrollTop:E.prop("scrollHeight")},0);return!1}}else 13===a.keyCode?(a.preventDefault(),1===qa&&Q.sendTypingStatus(0,q.data("mck-id")),V.is(":disabled")&&r.hasClass("vis")?alert("Please wait file is uploading."):T.submit()):0===qa&&Q.sendTypingStatus(1,q.data("mck-id"))});a(c).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&y.deleteConversation()});a(c).on("click",
".applozic-tm-launcher",function(b){b.preventDefault();var f=a(this).data("mck-id");f="undefined"!==typeof f&&""!==f?f.toString():"";var c=a(this).data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():"";b=a(this).data("mck-supportid");b="undefined"!==typeof b&&""!==b?b.toString():"";var g=a(this).data("mck-topicid");g="undefined"!==typeof g&&""!==g?g.toString():"";var k=a(this).data("mck-msg");k="undefined"!==typeof k&&""!==k?k.toString():"";if("function"===typeof Ca&&g){var H=Ca(g);"object"===
typeof H&&"undefined"!==H.title&&(aa[g]=H)}f={topicId:g,tabId:f,userName:c,isMessage:!0};f.messagePxy={type:5,contentType:0,message:k};b?(f.isGroup=!0,f.supportId=b,y.getConversationId(f)):(f.isGroup=!1,m.loadTab(f,I.dispatchMessage))});a(c).on("click",".applozic-wt-launcher",function(b){b.preventDefault();b=a(this).data("mck-id");b="undefined"!==typeof b&&""!==b?b.toString():"";var f=a(this).data("mck-name");f="undefined"!==typeof f&&""!==f?f.toString():"";var c=a(this).data("mck-topicid");c="undefined"!==
typeof c&&""!==c?c.toString():"";var g=a(this).data("mck-topic-status");g=g?-1===X.indexOf(g)?X[0]:g.toString():X[0];if("function"===typeof Ca){var k=Ca(c);"object"===typeof k&&"undefined"!==k.title&&(aa[c]=k)}y.getConversationId({tabId:b,isGroup:!1,userName:f,topicId:c,topicStatus:g,isMessage:!1})});a(c).on("click",".applozic-ct-launcher",function(b){b.preventDefault();var f=a(this).data("mck-id");f="undefined"!==typeof f&&""!==f?f.toString():"";var c=a(this).data("mck-name");c="undefined"!==typeof c&&
""!==c?c.toString():"";b=a(this).data("mck-topicid");b="undefined"!==typeof b&&""!==b?b.toString():"";var g=a(this).data("mck-topic-status");g=g?-1===X.indexOf(g)?X[0]:g.toString():X[0];f={tabId:f,isGroup:!1,userName:c,topicId:b,topicStatus:g,isMessage:!1};"function"===typeof Tb&&(c=Tb(b),"object"===typeof c&&(c.topicDetail&&"object"===typeof c.topicDetail&&"undefined"!==c.topicDetail.title&&(aa[b]=c.topicDetail),c.fallBackTemplatesList&&0<c.fallBackTemplatesList.length&&(f.fallBackTemplatesList=
c.fallBackTemplatesList)));y.getConversationId(f)});a(c).on("click","."+lb+", .mck-contact-list ."+lb,function(b){b.preventDefault();b=a(this);var f=this;b.data("mck-id")?b.parents(".mck-search-list").length?(g.bind("blur"),setTimeout(function(){y.openChat(f)},600)):y.openChat(f):a.fn.applozic("mckLaunchSideboxChat")});a("#km-form-chat-login").submit(function(a){var b=$("#km-submit-chat-login"),f=$("#km-error-chat-login"),c=$("#km-userId").val();a=$("#km-email").val();var g=$("#km-userName").val(),
k=$("#km-contact").val();k&&(c=k);a&&(c=a);b.attr("disabled",!0);b.html("Initiating chat...");f.removeClass("show").addClass("hide");f.html("");b={userId:c,applicationId:Y,onInit:t,baseUrl:MCK_BASE_URL,locShare:mb,googleApiKey:ic};a&&(b.email=a);g&&(b.displayName=g);k&&(b.contactNumber=k);jb.initialize(b);return!1});var t=function(){"kommunicate"===window.applozic.PRODUCT_ID&&W.removeClass("vis").addClass("n-vis");y.loadConversationWithAgents({groupName:gb,agentId:Xa,botIds:hb})};a(".km-login-model-close").on("click",
function(b){a("#km-chat-login-modal").css("display","none")});a(c).on("click",".mck-conversation-tab-link",function(b){b.preventDefault();a(this);b=q.data("mck-id");var f=q.data("isgroup");KommunicateUI.hideAwayMessage();KommunicateUI.hideLeadCollectionTemplate();m.loadTab({tabId:"",isGroup:!1,lastActiveTabId:b,isLastActiveTabGroup:f})});a(c).on("click",".mck-close-sidebox",function(b){b.preventDefault();ea.mckModal("hide");a("#mck-sidebox-launcher").removeClass("n-vis").addClass("vis");b=q.data("mck-conversationid");
q.data("mck-id","");q.data("mck-topicid","");q.data("mck-name","");q.data("mck-conversationid","");b&&(b=ca[b],"object"===typeof b&&(b=b.topicId,"function"===typeof Nb&&Nb(A,b)));Q.unsubscibeToTypingChannel()});a(c).on("click",".mck-price-submit",function(a){a.preventDefault();b.sendPriceMessage()});Ga.keydown(function(a){13===a.keyCode&&b.sendPriceMessage()});q.bind("scroll",function(){if(0<q.find(".mck-contact-list").length){if(q.scrollTop()+q.innerHeight()>=q[0].scrollHeight){var a=q.data("datetime");
0<a&&!Ka&&y.loadMessageList({tabId:"",isGroup:!1,startTime:a})}}else if(0===q.scrollTop()){var b=q.data("mck-id");if("undefined"!==typeof b&&""!==b){var f=q.data("isgroup"),c=q.data("mck-conversationid");c=c?c.toString():"";a=wa.data("datetime");0<a&&!Ka&&y.loadMessageList({tabId:b,isGroup:f,conversationId:c,startTime:a})}}});Ga.on("click",function(a){a.preventDefault();Ga.removeClass("mck-text-req")});nb.on("click",function(a){a.preventDefault();a=q.data("mck-id");var b=q.data("isgroup"),f=!q.data("blocked");
b?(ob.removeClass("vis").addClass("n-vis"),ra.removeClass("vis").addClass("n-vis")):confirm(f?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"])&&xa.blockUser(a,f,function(a){Fa.toggleBlockUser(a,f)})});W.on("click",function(a){a.preventDefault();a=q.data("mck-id");q.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&w.leaveGroup({apzCallback:v.onGroupLeft,groupId:a}):ma.removeClass("vis").addClass("n-vis")});a(c).on("click",".mck-add-to-group",function(b){b.preventDefault();b=
a(this).data("mck-id");"undefined"!==typeof b&&v.addGroupMemberFromSearch(b);Na.mckModal("hide")});a(c).on("click",".mck-btn-remove-member",function(b){b.stopPropagation();b=a(this).parents(".mck-li-group-member").data("mck-id");var f=la.data("mck-id");if("undefined"!==typeof f&&"undefined"!==typeof b){var c=C.getGroup(f);"object"===typeof c&&A===c.adminName?confirm(MCK_LABELS["remove.member.alert"])&&w.removeGroupMember({groupId:f,userId:b,apzCallback:v.onRemovedGroupMember}):Ia.removeClass("vis").addClass("n-vis")}});
Ba.on("click",function(a){a.preventDefault();(a=la.data("mck-id"))?confirm(MCK_LABELS["exit.group.alert"])&&w.leaveGroup({groupId:a,apzCallback:v.onGroupLeft}):m.loadTab({tabId:"",isGroup:!1})});va.on("click",function(a){a.preventDefault();a=q.data("mck-id");if(q.data("isgroup")){a={groupId:a};var b=q.data("mck-conversationid");b&&(a.conversationId=b);v.loadGroupInfo(a)}else ma.removeClass("vis").addClass("n-vis")});x.on("click",function(a){a.preventDefault();v.loadCreateGroupTab()});Ea.on("click",
function(a){a.preventDefault();var b=la.data("mck-id");a=la.data("mck-conversation-id");b?(b={tabId:b,isGroup:!0},a&&(b.conversationId=a),m.loadTab(b)):m.loadTab({tabId:"",isGroup:!1})});Ma.on("click",function(b){b.preventDefault();if(b=la.data("mck-id"))(b=C.getGroup(b))&&b.adminName===A?(Ua.html(""),Na.mckModal(),N.removeClass("n-vis").addClass("vis"),0<db.length?v.addMembersToGroupSearchList():Wb?0<cb.length?(a.each(cb,function(a,b){db.push(b.contactId)}),v.addMembersToGroupSearchList()):(N.removeClass("vis").addClass("n-vis"),
Ya.removeClass("n-vis").addClass("vis")):xa.getUserStatus({callback:v.addMembersToGroupSearchList},function(b){a.each(b.users,function(a,b){a=m.getContact(""+b.userId);a="undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b);db.push(a.contactId)})})):Ia.removeClass("vis").addClass("n-vis")});eb.keypress(function(a){if(13===a.which)return a=eb.val(),""!==a&&v.addGroupMemberFromSearch(a),eb.val(""),!0});a(c).on("click",".mck-group-member-search-link",function(a){a.preventDefault();
a=eb.val();""!==a&&v.addGroupMemberFromSearch(a);eb.val("")});a(c).on("click",".mck-show-more",function(b){b.preventDefault();var f=a(this);b=f.data("tabId");var c=q.data("isgroup"),g=q.data("mck-conversationid");g=g?g.toString():"";f=f.data("datetime");y.loadMessageList({tabId:b,isGroup:c,conversationId:g,startTime:f})});a(c).on("click",".mck-accept",function(b){b=a(this).data("mck-conversationid");var f=a(this).data("mck-topic-price");if("function"===typeof Za&&f&&b){var c=ca[b],g=k.val();g=w.getGroupDisplayName(g);
"object"===typeof c?(Za({custId:A,suppId:g,productId:c.topicId,price:f}),I.sendConversationCloseUpdate(b)):I.getTopicId({conversationId:b,suppId:g,priceText:f},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)})}});T.submit(function(){1===qa&&Q.sendTypingStatus(0,q.data("mck-id"));var c=a.trim(M.textVal(E[0]));r.hasClass("n-vis")&&0<U.length&&(U=[]);if(0===c.length&&0===U.length)return E.addClass("mck-text-req"),!1;if("function"===typeof Rb&&!Rb(c))return!1;c={type:5,contentType:0,
message:c};var g=Kommunicate.getSettings("KM_CHAT_CONTEXT");g&&(c.metadata={KM_CHAT_CONTEXT:g});var t=q.data("mck-conversationid");g=q.data("mck-topicid");t?c.conversationId=t:g&&(t={topicId:g},g=aa[g],"object"===typeof g&&(t.topicDetail=f.JSON.stringify(g)),c.conversationPxy=t);(g=Ja.val())&&""!=g&&(c.metadata={suggestMessageMetadata:g},Ja.val(""));""!=Pa.data("prev-msgkey")&&"undefined"!=typeof Pa.data("prev-msgkey")&&(y.updateMessageMetadata({key:Pa.data("prev-msgkey"),metadata:{obsolete:!0}}),
Pa.data("prev-msgkey",""));Pa.hasClass("mck-text-box")&&(Pa.addClass("n-vis").removeClass("mck-text-box").val(""),E.removeClass("n-vis").addClass("mck-text-box"),Pa.data("source-url",""),a(".mck-dropup-menu").hide());!0===q.data("isgroup")?c.groupId=k.val():c.to=k.val();V.attr("disabled",!0);u.removeClass("vis").addClass("n-vis");u.html("");sa.html("");ya.removeClass("vis").addClass("n-vis");if(1==a("[data-msgtype\x3d5]").length&&KommunicateUI.isLeadCollectionEnabled&&KommunicateUI.awayMessageInfo.isEnabled&&
1==KommunicateUI.awayMessageInfo.eventId&&!KommunicateUI.validateEmail(c.message))return!1;b.sendMessage(c);return!1});P.on("click",function(){a(this).val("");u.removeClass("vis").addClass("n-vis");ya.removeClass("vis").addClass("n-vis")});a(c).bind("click",function(b){a(".mck-context-menu").removeClass("vis").addClass("n-vis");!G.hasClass("on")||a(b.target).hasClass("mck-icon-upload")||a(b.target).hasClass("mck-btn-attach")||Zb.fileMenuToggle();E.removeClass("mck-text-req");c.activeElement&&c.activeElement!==
E&&1===qa&&Q.sendTypingStatus(0,q.data("mck-id"));c.activeElement&&"mck-group-name-save"!==c.activeElement.id&&O.removeClass("mck-req-border");c.activeElement&&"mck-btn-group-create"!==c.activeElement.id&&pa.removeClass("mck-req-border");a(".mcktypeahead.mck-dropdown-menu").hide()});a(".mck-tabview-item").click(function(){a(".mck-tabview-item").removeClass("active");a(this).addClass("active")})};a(".mck-sidebox").on("click","#mck-mike-btn",function(){a(this).removeClass("vis").addClass("n-vis");$(".mck-stop-btn").addClass("vis").removeClass("n-vis");
Fr.voice.record(!1,function(){$("#mck-audio").removeClass("n-vis").addClass("vis");y.timer()})});a(".mck-sidebox").on("click","#mck-stop-recording",function(){$("#mck-mike-btn").addClass("vis").removeClass("n-vis");$(".mck-stop-btn").addClass("n-vis").removeClass("vis");$("#mck-audio").removeClass("vis").addClass("n-vis");y.stoptimer();Fr.voice.export(function(b){var f={};f.file=b;f.name="blob";a.fn.applozic("audioAttach",f)},"blob");Fr.voice.stop()});b.openChat=function(b){var f=a(b);b=f.data("mck-id");
b="undefined"!==typeof b&&""!==b?b.toString():"";var c=f.data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():"";var k=f.data("mck-topicid");k="undefined"!==typeof k&&""!==k?k.toString():"";var t=!0===f.data("isgroup");f=f.data("mck-conversationid");f="undefined"!==typeof f&&""!==f?f.toString():"";k&&!f?(f=(f=a(elem).data("mck-topic-status"))?-1===X.indexOf(f)?X[0]:f.toString():X[0],y.getConversationId({tabId:b,isGroup:t,userName:c,topicId:k,topicStatus:f,isMessage:!1})):m.loadTab({tabId:b,
isGroup:t,userName:c,conversationId:f,topicId:k});g.val("")};b.sendMessage=function(f){if(void 0!==$("#mck-message-cell .mck-message-inner div[name\x3d'message']:last-child").data("msgkey")){var c=$("#mck-message-cell .mck-message-inner div[name\x3d'message']:last-child").data("msgkey");c=I.getReplyMessageByKey(c)}if("object"===typeof f)if(f.to&&za[f.to]&&(za[f.to].deletedAtTime||!0===Hc))u.html(MCK_LABELS["user.delete"]).removeClass("n-vis").addClass("vis"),a("#mck-tab-status").removeClass("vis").addClass("n-vis"),
T.removeClass("vis").addClass("n-vis"),ob.removeClass("vis").addClass("n-vis");else{var g=f.metadata?f.metadata:{};var k=a("#mck-text-box").data("AL_REPLY");"undefined"===typeof k||""===k||f.forward||(g.AL_REPLY=k);f.metadata=g;if("undefined"!==typeof f.message&&0!==f.message.length||0!==U.length){c&&c.metadata.altype&&(0===c.type||4===c.type||6===c.type)&&(g.altype=c.metadata.altype);if(f.conversationId&&(c=ca[f.conversationId],"undefined"!==c&&c.closed)){m.closeConversation();V.attr("disabled",
!1);return}if(q.data("blocked")&&!f.groupId)Fa.toggleBlockUser(t,!0),V.attr("disabled",!1);else{var l="";f.groupId?(l=C.getGroup(f.groupId),"undefined"===typeof l&&(l=C.createGroup(f.groupId))):l=f.clientGroupId?C.getGroupByClientGroupId(f.clientGroupId):m.fetchContact(f.to);0<a("#mck-message-cell .mck-no-data-text").length&&a(".mck-no-data-text").remove();if(f.message&&0===U.length){g=na.hasClass("n-vis");var t=q.data("mck-id");var n=M.randomId();f.key=n;12!==f.contentType&&t&&t.toString()===l.contactId&&
102!==f.contentType&&I.addMessageToTab(f,l,function(a,b){m.addMessage(a,b,!0,!0,!1)});t={tabId:l.contactId,isTopPanelAdded:g};b.submitMessage(f,t)}else!f.message||0===U.length||1!==f.contentType&&2!==f.contentType?0<U.length&&a.each(U,function(a,c){a=na.hasClass("n-vis");var g=q.data("mck-id"),k=M.randomId();f.key=k;f.fileMeta=c;f.contentType=1;12!==f.contentType&&g&&g.toString()===l.contactId&&I.addMessageToTab(f,l,function(a,b){m.addMessage(a,b,!0,!0,!1)});b.submitMessage(f,{tabId:l.contactId,isTopPanelAdded:a})}):
(g=na.hasClass("n-vis"),t=q.data("mck-id"),n=M.randomId(),f.key=n,c={},f.groupId?c.groupId=f.groupId:c.to=f.to,c.type=f.type,c.key=M.randomId(),c.message=f.message,c.contentType=f.contentType,f.contentType=1,f.fileMeta=U[0],f.message="",12!==f.contentType&&t&&t.toString()===l.contactId&&(I.addMessageToTab(f,l,function(a,b){m.addMessage(a,b,!0,!0,!1)}),I.addMessageToTab(c,l,function(a,b){m.addMessage(a,b,!0,!0,!1)})),t={tabId:l.contactId,isTopPanelAdded:g},b.submitMessage(f,t),b.submitMessage(c,t));
E.removeClass("mck-text-req");V.attr("disabled",!1);a("."+n+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");m.addTooltip(n);m.clearMessageField(!0);U=[];delete Sa[l.contactId]}}else E.addClass("mck-text-req")}};b.sendForwardMessage=function(a){var c=ALStorage.getMessageByKey(a);if("undefined"!==typeof c){c.fileMeta&&U.push(c.fileMeta);a={type:5,contentType:c.contentType,message:c.message,forward:"forward"};c.metadata&&(c.metadata.AL_REPLY&&(c.metadata.AL_REPLY=""),a.metadata=
c.metadata);var g=q.data("mck-conversationid");c=q.data("mck-topicid");g?a.conversationId=g:c&&(g={topicId:c},c=aa[c],"object"===typeof c&&(g.topicDetail=f.JSON.stringify(c)),a.conversationPxy=g);!0===q.data("isgroup")?a.groupId=k.val():a.to=k.val();b.sendMessage(a)}};b.sendWelcomeMessage=function(a){var b=M.randomId(),f=q.data("mck-id"),c=q.data("isgroup");b={key:b,type:4,contentType:0,to:a.sender,message:a.messageContent};f&&f.toString()===a.sender&&!c&&(f=m.fetchContact(f),I.addMessageToTab(b,
f,function(a,b){m.addMessage(a,b,!0,!0,!1)}));M.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+encodeURIComponent(a.sender)+"\x26messageContent\x3d"+encodeURIComponent(a.messageContent),contentType:"text/plain",success:function(b){a.callback&&a.callback(b)}})};b.submitMessage=function(b,c){var g=b.key,k=b.metadata?b.metadata:{};mc&&(b.metadata={userStatus:4});var l=a("#mck-text-box").data("AL_REPLY");"undefined"===typeof l||""===l||b.forward||(k.AL_REPLY=
l,a("#mck-text-box").data("AL_REPLY",""));b.source=Dc;var t=a("#mck-message-cell .mck-message-inner div[name\x3d'message']."+g);102!=b.contentType&&103!=b.contentType&&(b.metadata=lc);b.metadata=k;M.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:f.JSON.stringify(b),contentType:"application/json",success:function(f){var k=q.data("mck-id");if("object"===typeof f){var l=f.messageKey;if(k&&k.toString()===c.tabId){var n=f.conversationId;q.data("mck-conversationid",n);t.removeClass(g).addClass(l);
t.data("msgkey",l);a("."+l+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title","sent");m.addTooltip(l);c.isTopPanelAdded&&wa.data("datetime",f.createdAt);f=!0;b.groupId&&6===C.getGroup(b.groupId).type&&(f=!1);f&&m.messageContextMenu(l)}b.conversationPxy&&(l=b.conversationPxy,b.topicId&&(Aa[b.topicId]=[n]),ca[n]=l)}else"CONVERSATION_CLOSED"===f||"BUSY_WITH_OTHER"===f?(V.attr("disabled",!1),m.closeConversation(f),t.remove(),c.isTopPanelAdded&&na.removeClass("vis").addClass("n-vis")):
"error"===f&&(V.attr("disabled",!1),u.html("Unable to process your request. Please try again"),u.removeClass("n-vis").addClass("vis"),t.remove(),c.isTopPanelAdded&&na.removeClass("vis").addClass("n-vis"));n=a("[data-msgtype\x3d5]").length;1==n&&KommunicateUI.isLeadCollectionEnabled&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId&&KommunicateUI.displayLeadCollectionTemplate(null);1<n&&a("#mck-email-collection-box").removeClass("vis").addClass("n-vis");n=m.getTabDisplayName(k,
!1);za[k]||k===n||(da.updateDisplayName(k,n),k={userId:k,userName:n},za[k.userId]=k)},error:function(){u.html("Unable to process your request. Please try again.");u.removeClass("n-vis").addClass("vis");t&&t.remove();c.isTopPanelAdded&&na.removeClass("vis").addClass("n-vis")}});$("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};b.updateMessageMetadata=function(a){a.metadata||a.messageKey?M.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",global:!1,data:f.JSON.stringify(a),
contentType:"application/json",success:function(a){console.log("metadata updated: ",a)},error:function(){}}):console.log("empty metadata")};b.downloadImage=function(a){window.open(a,"_blank")};b.replyMessage=function(b){q.data("mck-id");var f=I.getReplyMessageByKey(b);E.focus().select();$("#mck-reply-to-div").removeClass("n-vis").addClass("vis");var c=5===f.type?"You":m.getTabDisplayName(f.to,!1);$("#mck-reply-to").html(c);"object"===typeof f.fileMeta||2===f.contentType?$("#mck-reply-msg").html(m.getImageForMessagePreview(f)):
$("#mck-reply-msg").html(f.message);a("#mck-text-box").data("AL_REPLY",b)};$("#close").click(function(){$("#mck-reply-to-div").removeClass("vis").addClass("n-vis");a("#mck-text-box").data("AL_REPLY","")});b.deleteMessage=function(b){var c=q.data("mck-id");"undefined"!==typeof c&&M.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+b,type:"get",success:function(g){"success"===g?(q.data("mck-id")===c&&(a("."+b).remove(),q.is(":empty")&&na.removeClass("vis").addClass("n-vis")),ALStorage.clearMckMessageArray()):
f.console.log("Unable to delete message. Please reload page.")}})};b.deleteConversation=function(){var a=q.data("mck-id"),b=q.data("isgroup"),f=q.data("mck-conversationid");if("undefined"!==typeof a){var c={};b?c.groupId=a:c.userId=a;f&&(c.conversationId=f);Ka=!0;window.Applozic.ALApiService.deleteConversation({data:c,success:function(){q.data("mck-id")===a&&(q.html(""),wa.data("datetime",""),S.removeClass("n-vis").addClass("vis"),na.removeClass("vis").addClass("n-vis"),Ka=!1)},error:function(){}})}};
b.loadMessageList=function(b,c){var g=!1,k=!1,l="";"undefined"!==typeof b.tabId&&""!==b.tabId?(l=b.isGroup?"\x26groupId\x3d"+b.tabId:"\x26userId\x3d"+encodeURIComponent(b.tabId),g=!0,b.startTime&&(l+="\x26endTime\x3d"+b.startTime),l+="\x26pageSize\x3d30",(Oa||ab)&&b.conversationId&&(l+="\x26conversationId\x3d"+b.conversationId,"undefined"===typeof Ha[b.tabId]?(k=!0,l+="\x26conversationReq\x3dtrue"):m.addConversationMenu(b.tabId,b.isGroup)),b.isGroup&&Kommunicate.getAwayMessage({applicationId:Y,conversationId:b.tabId},
KommunicateUI.populateAwayMessage)):(Ka=!0,b.startTime&&(l+="\x26endTime\x3d"+b.startTime),l+="\x26mainPageSize\x3d60");b.startTime||q.html("");oa.removeClass("n-vis").addClass("vis");M.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+l,type:"get",global:!1,success:function(l){var O=!0;KommunicateUI.displayLeadCollectionTemplate(l.message);var t=q.data("mck-id"),L=q.data("isgroup");b.isGroup&&!b.startTime||oa.removeClass("vis").addClass("n-vis");Ka=!1;if("undefined"===typeof t||b.tabId===
t&&""+L===""+b.isGroup){if("null"===l+""||"undefined"===typeof l.message||0===l.message.length)O=!1,g?b.startTime?wa.data("datetime",""):b.isGroup||0!==a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||na.removeClass("vis").addClass("n-vis"):q.data("datetime","");if("null"!==l+""&&"error"!==l.status)if(g){O&&(0<b.startTime?m.processMessageList(l,!1,!0):b.isGroup||(m.processMessageList(l,!0,!0),na.removeClass("n-vis").addClass("vis")));0< !b.startTime&&!b.isGroup&&"function"===
typeof ib&&ib(b.tabId);0<l.userDetails.length&&a.each(l.userDetails,function(a,c){za[c.userId]=c;b.isGroup||(c.connected?f.MCK_OL_MAP[c.userId]=!0:(f.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(ba[c.userId]=c.lastSeenAtTime)),qb||b.isGroup||(c.blockedByThis?(ta[c.userId]=!0,Fa.toggleBlockUser(b.tabId,!0)):c.blockedByOther?(La[c.userId]=!0,F.removeClass("mck-tab-title-w-status"),K.removeClass("vis").addClass("n-vis"),ja.removeClass("vis").addClass("n-vis"),q.data("blocked",!1)):
Fa.toggleBlockUser(b.tabId,!1)),c.userName&&!b.startTime&&(a=m.getTabDisplayName(b.tabId,b.isGroup,c.userName),F.html(a),F.attr("title",a)))});!rb||b.isGroup||b.startTime||f.MCK_OL_MAP[b.tabId]||jb.manageOfflineMessageTime(b.tabId);if(0<l.conversationPxys.length){var B=[];a.each(l.conversationPxys,function(b,c){if("object"===typeof c&&(B.push(c),ca[c.id]=c,Aa[c.topicId]=[c.id],c.topicDetail))try{aa[c.topicId]=a.parseJSON(c.topicDetail)}catch(ub){f.console.log("Incorect Topic Detail!")}});k&&(Ha[b.tabId]=
B,m.addConversationMenu(b.tabId,b.isGroup))}b.conversationId&&(t=ca[b.conversationId],"object"===typeof t&&t.closed&&m.closeConversation());b.startTime||(b.isGroup?(v.addGroupStatus(C.getGroup(b.tabId)),m.updateUnreadCount("group_"+b.tabId,0,!0)):m.updateUnreadCount("user_"+b.tabId,0,!0),"function"===typeof c&&c(b));0<l.groupFeeds.length&&a.each(l.groupFeeds,function(f,c){f=C.addGroup(c);if(!b.startTime){var g=[];a.each(c.membersId,function(a,b){"undefined"===typeof m.getContact(b)&&g.push(b)});if(0<
g.length)b.isMessages=O,b.messageData=l,b.isLoadMessageList=!0,da.getUsersDetail(g,b);else{v.addGroupStatus(f);c=!0;var k;7===f.type&&(ka.removeClass("vis").addClass("n-vis"),w.getContactFromGroupOfTwo(f,function(a){k=m.fetchContact(a)}),Fa.lastSeenOfGroupOfTwo(k.contactId));"kommunicate"==window.applozic.PRODUCT_ID&&(3!==f.users[A].role&&2!==f.users[A].role&&0!==f.users[A].role||ka.removeClass("vis").addClass("n-vis"));6===f.type&&(v.validateOpenGroupUser(f),c=w.isAppendOpenGroupContextMenu(f));
oa.removeClass("vis").addClass("n-vis");O?(m.processMessageList(l,!0,c),6!==f.type&&na.removeClass("n-vis").addClass("vis")):0===a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&na.removeClass("vis").addClass("n-vis");"function"===typeof ib&&ib(b.tabId)}}})}else b.startTime||(f.MCK_OL_MAP=[]),0<l.userDetails.length&&a.each(l.userDetails,function(a,b){za[b.userId]=b;b.connected?f.MCK_OL_MAP[b.userId]=!0:(f.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(ba[b.userId]=
b.lastSeenAtTime));m.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b)}),0<l.groupFeeds.length&&a.each(l.groupFeeds,function(a,b){m.updateUnreadCount("group_"+b.id,b.unreadCount,!1);C.addGroup(b)}),0<l.blockedUserPxyList.blockedToUserList.length&&a.each(l.blockedUserPxyList.blockedToUserList,function(a,b){b.userBlocked&&(ta[b.blockedTo]=!0)}),0<l.blockedUserPxyList.blockedByUserList.length&&
a.each(l.blockedUserPxyList.blockedByUserList,function(a,b){b.userBlocked&&(La[b.blockedBy]=!0)}),0<l.conversationPxys.length&&a.each(l.conversationPxys,function(b,c){ca[c.id]=c;Aa[c.topicId]=[c.id];if(c.topicDetail)try{aa[c.topicId]=a.parseJSON(c.topicDetail)}catch(ub){f.console.log("Incorect Topic Detail!")}}),O?(b.startTime?b.startTime&&(b.isReload=!1,g||ALStorage.updateLatestMessageArray(l.message)):(b.isReload=!0,g||ALStorage.setLatestMessageArray(l.message)),g&&ALStorage.updateMckMessageArray(l.message),
m.addContactsFromMessageList(l,b)):q.data("datetime",""),b.isLaunch&&m.updateUnreadCountonChatIcon(l.userDetails)}t=n.data("forwardMessageKey");"undefined"!==typeof t&&(y.sendForwardMessage(t),n.data("forwardMessageKey",""))},error:function(a,b,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));Ka=!1;oa.removeClass("vis").addClass("n-vis");f.console.log("Unable to load messages. Please reload page.")}})};b.updateContactList=function(a,f){var c={};f?c.groupId=a:c.userId=
a;c.pageSize=1;window.Applozic.ALApiService.getMessages({data:c,success:function(c){c=c.data;"null"===c+""||"undefined"===typeof c.message||0===c.message.length?m.clearContactMessageData(a,f):(c=c.message[0],"undefined"!==typeof c&&(c.groupId?w.addGroupFromMessage(c,!0,function(a,f,c){b.updateRecentConversationList(a,f,c)}):m.addContactsFromMessage(c,!0)))},error:function(b){m.clearContactMessageData(a,f)}})};b.conversationReadUpdate=function(a){var b=a.tabId,f=a.isGroup?"group_"+b:"user_"+b;b&&0<
m.getUnreadCount(f)&&window.Applozic.ALApiService.conversationReadUpdate({data:"true"===""+a.isGroup?"groupId\x3d"+b:"userId\x3d"+b,success:function(a){m.updateUnreadCount(f,0,!0)},error:function(){}})};b.getConversationId=function(b){var c;if(!b.isGroup&&!b.isMessage&&b.topicStatus!==X[1]&&(c=Aa[b.topicId])&&(c=ca[c],"object"===typeof c)){q.data("mck-conversationid",c.id);b.conversationId=c.id;if("undefined"!==typeof Ha[b.tabId]){var g=Ha[b.tabId];g.push(c);Ha[b.tabId]=g}m.loadTab(b);return}b.topicId&&
(c={topicId:b.topicId,userId:b.tabId,status:b.topicStatus},b.isGroup?c.groupId=b.groupId:c.userId=b.tabId,g=aa[b.topicId],"object"===typeof g&&(c.topicDetail=f.JSON.stringify(g)),b.fallBackTemplatesList&&0<b.fallBackTemplatesList.length&&(c.fallBackTemplatesList=b.fallBackTemplatesList),window.Applozic.ALApiService.getConversationId({data:c,success:function(c){if("object"===typeof c&&"success"===c.status){var g=c.response;if("object"===typeof g&&"undefined"!==g.conversationPxy){c=g.conversationPxy;
ca[c.id]=c;Aa[c.topicId]=[c.id];if(c.topicDetail)try{aa[c.topicId]=a.parseJSON(c.topicDetail)}catch(bc){f.console.log("Incorect Topic Detail!")}q.data("mck-conversationid",c.id);b.conversationId=c.id;if("undefined"!==typeof Ha[b.tabId]){var k=Ha[b.tabId];k.push(c);Ha[b.tabId]=k}b.isGroup&&(g=C.addGroup(g),b.tabId=g.contactId);b.isMessage&&c.created?m.loadTab(b,I.dispatchMessage):m.loadTab(b)}}},error:function(){}}))};b.sendPriceMessage=function(){var f=Ga.val();if(""===f)Ga.addClass("mck-text-req");
else{f=a.trim(f);var c=k.val();var g=q.data("mck-conversationid",g);var l={type:5,contentType:4,message:f};!0===q.data("isgroup")?l.groupId=c:l.to=c;if(q.data("mck-conversationid")){g=q.data("mck-conversationid");l.conversationId=g;var n=ca[g];"object"!==n?I.getTopicId({conversationId:g,suppId:c,priceText:f},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)}):"function"===typeof Za&&Za({custId:A,suppId:c,productId:n.topicId,price:f});Ga.val("")}b.sendMessage(l)}};b.getGroup=function(b){var c=
[];a.each(b.users,function(a,b){"undefined"!==typeof b.userId&&("undefined"!==typeof b.groupRole&&-1===Kb.indexOf(b.groupRole)||c.push(b))});var g={groupName:a.trim(b.groupName),users:c,type:b.type};b.admin&&(g.admin=b.admin);b.clientGroupId&&(g.clientGroupId=b.clientGroupId);b.groupIcon&&(g.imageUrl=b.groupIcon);g.metadata=b.metadata?b.metadata:MCK_LABELS["group.metadata"];var k={},l={"UserId-Enabled":!0,Authorization:"Basic "+p,"Application-Key":Y,"Device-Key":ha,"Access-Token":ia};M.ajax({url:MCK_BASE_URL+
"/rest/ws/group/v2.1/create",global:!1,data:f.JSON.stringify(g),type:"post",headers:l,contentType:"application/json",success:function(c){b.isInternal&&Da.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);if("object"===typeof c&&"success"===c.status){var g=c.response;if("object"===typeof g){var l=C.addGroup(g);0<g.users.length&&a.each(g.users,function(a,b){za[b.userId]=b;b.connected?f.MCK_OL_MAP[b.userId]=!0:(f.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(ba[b.userId]=b.lastSeenAtTime));
m.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b)});b.tabId=l.contactId;b.isGroup=!0;b.isMessage?m.loadTab(b,I.dispatchMessage):b.isInternal?(q.data("mck-id",l.contactId),q.data("isgroup",!0),v.loadGroupInfo({groupId:l.contactId})):m.loadTab(b);"function"===typeof b.callback&&(k.updated=c.updated?c.updated:!1,k.status="success",k.data=l,b.callback(k))}}else"error"===c.status&&"function"===
typeof b.callback&&(k.status="error",k.errorMessage=c.errorResponse[0].description,b.callback(k))},error:function(){b.isInternal&&Da.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);"function"===typeof b.callback&&(k.status="error",k.errorMessage="Unable to process request.",b.callback(k))}})}},da=new function(){a("#mck-search-list");var b=a("#mck-sidebox-search"),c=a("#mck-search-loading");a("#mck-search-cell .mck-message-inner");a("#mck-message-cell .mck-message-inner");a(".mck-tab-message-option");
a("#mck-contact-loading");this.getContactDisplayName=function(a){var b=[];window.Applozic.ALApiService.getContactDisplayName({data:{userIdArray:a},success:function(a){for(var f in a)a.hasOwnProperty(f)&&(b.push([f,a[f]]),Da[f]=a[f],m.fetchContact(f).displayName=a[f]);ALStorage.updateMckContactNameArray(b)},error:function(){}})};this.loadContacts=function(){var g=[];window.Applozic.ALApiService.getContactList({url:"?startIndex\x3d0\x26pageSize\x3d50\x26orderBy\x3d1",baseUrl:MCK_BASE_URL,success:function(c){b.hasClass("vis")&&
("object"===typeof c&&0<c.users.length&&(a.each(c.users,function(a,b){"undefined"!==typeof b.userId&&(a=m.getContact(""+b.userId),a="undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b),cb.push(a),g.push([b.userId,a.displayName]),b.connected?f.MCK_OL_MAP[b.userId]=!0:(f.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(ba[b.userId]=b.lastSeenAtTime)))}),da.getUsersDetail(contactNameArray,{async:!1}),0<g.length&&ALStorage.updateMckContactNameArray(g)),m.addContactsToSearchList(),
v.addMembersToGroupSearchList())},error:function(){c.removeClass("vis").addClass("n-vis");f.console.log("Unable to load contacts. Please reload page.")}})};this.getUsersDetail=function(b,c){if(!("undefined"===typeof b||1>b.length)){for(var g="undefined"!==typeof c.cached?c.cached:!0,k=[],l=b.filter(function(a,f){return b.indexOf(a)===f}),n=0;n<l.length;n++){var B=l[n];g&&"undefined"!==typeof za[B]||k.push(B)}if(0===k.length)c.setStatus?Fa.updateUserConnectedStatus():c.message?m.populateMessage(c.messageType,
c.message,c.notifyUser):c.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(c);else{var p={};window.Applozic.ALApiService.getUserDetail({data:{userIdList:k},success:function(b){"success"===b.status&&0<b.response.length&&a.each(b.response,function(a,b){za[b.userId]=b;f.MCK_OL_MAP[b.userId]=b.connected;a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b)});c.setStatus?Fa.updateUserConnectedStatus():c.message?m.populateMessage(c.messageType,c.message,
c.notifyUser):c.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(c);p.status="success";p.data=b;c.callback&&c.callback(p)},error:function(){c.setStatus?Fa.updateUserConnectedStatus():c.message?m.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(c);p.status="error";c.callback&&c.callback(p)}})}}};this.updateUserIdentity=function(a){if(null!==a.newUserId&&""!==a.newUserId){var b="newUserId\x3d"+encodeURIComponent(a.newUserId);M.ajax({url:MCK_BASE_URL+
"/rest/ws/user/change/identifier",type:"get",data:b,contentType:"application/json",success:function(b){"object"===typeof b&&"success"===b.status&&a.callback&&a.callback(b)},error:function(b){a.callback&&a.callback({response:"error"})}})}};this.updateUser=function(a){M.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/user/update",data:f.JSON.stringify(a.data),contentType:"application/json",success:function(b){a.success&&a.success(b)},error:function(b){a.error&&a.error(b)}})};this.updateDisplayName=function(b,
f){""!==b&&""!==f&&a.ajax({url:MCK_BASE_URL+"/rest/ws/user/name",type:"get",data:"userId\x3d"+b+"\x26displayName\x3d"+f,success:function(a){if("object"===typeof a&&"success"===a.status)return"success"},error:function(){}})}},Cb=new function(){var b=this,f,c,g,k,n,p,r;b.init=function(){a("#mck-sidebox");c=a("#mck-msg-preview");n=a("#mck-group-info-tab");a("#mck-sidebox-launcher");f=a("#mck-message-cell .mck-message-inner");g=a("#mck-msg-preview .mck-preview-icon");k=a("#mck-msg-preview .mck-preview-cont-name");
p=a("#mck-msg-preview .mck-preview-msg-content");r=a("#mck-msg-preview .mck-preview-file-content")};b.notifyUser=function(a){if(!1!==a.alert&&7!==a.type&&!1!==a.metadata.alert){var f=a.groupId?C.getGroup(""+a.groupId):m.fetchContact(""+a.to.split(",")[0]),c=!1;a.groupId&&(c=!0);xa.loadUserProfile(a.to);c=m.getTabDisplayName(f.contactId,c);var g=xc;b.showNewMessageNotification(a,f,c);if(pc&&!Hb){var k=Cc;a=m.getTextForMessagePreview(a,f);"function"!==typeof $a||f.isGroup||(f=$a(f.contactId))&&"undefined"!==
typeof f&&(k=f);g?yc.sendDesktopNotification(c,k,a,g):yc.sendDesktopNotification(c,k,a)}}};b.showNewMessageNotification=function(a,b,l){if(qc&&102!==a.contentType){var B=f.data("mck-id"),x=f.data("isgroup");if(B===b.contactId&&x===b.isGroup&&!n.hasClass("vis"))if(a.conversationId&&(Oa||ab)){if(B=f.data("mck-conversationid"),B="undefined"!==typeof B&&""!==B?B.toString():"",B===a.conversationId.toString())return}else return;c.data("isgroup",b.isGroup);c.data("mck-conversationid",a.conversationId?a.conversationId:
"");B=m.getContactImageLink(b,l);a.message?(x=m.getMessageTextForContactPreview(a,b,100),p.html(""),"object"===typeof x?p.append(x):p.html(x),p.removeClass("n-vis").addClass("vis")):p.html("");a.fileMetaKey?(r.html(G.getFileIcon(a)),r.removeClass("n-vis").addClass("vis"),""===p.html()&&p.removeClass("vis").addClass("n-vis")):(r.html(""),r.removeClass("vis").addClass("n-vis"));!0===b.isGroup&&10!==b.type&&k.html(l);g.html(B);c.data("mck-id",b.contactId);c.show();setTimeout(function(){c.fadeOut(3E3)},
1E4)}}},I=new AlMessageService,G=new AlFileService,yc=new MckNotificationUtils,uc=new AlNotificationService,xa=new AlUserService,Ua=a(".chat-launcher-icon"),ka=new function(){var b=this,f;b.token=null;b.Identity=null;b.outgoingCallServices=null;b.incomingCallServices=null;var c=a(".mck-videocall-btn"),g=a(".applozic-vid-container"),k=a("#mck-sidebox"),n=a("#mck-video-call-indicator"),p=a("#mck-video-box");b.hideVideoBox=function(){g.addClass("n-vis").removeClass("vis");k.addClass("vis").removeClass("n-vis");
n.addClass("n-vis").removeClass("vis")};b.init=function(){p.mckModal();Ia.loop=!0;b.token=null!==ALStorage.getAppHeaders()?ALStorage.getAppHeaders().videoToken:void 0;b.ringToneForHost=vb.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",Ia);a("#mck-btn-video-call").on("click",function(c){if(b.token){var g=$mck_msg_to.val();c=A+(new Date).getTime().toString()+Math.random().toString(36).slice(2);g=I.sendVideoCallMessage(c,"CALL_DIALED",102,!1,g,function(a){y.sendMessage(a)});
var k=m.fetchContact(g.to);g=m.getTabDisplayName(k.contactId,!1);k=m.getContactImageLink(k,g);var l=new Date;b.outgoingCallServices=new MckCallingService(A,ka.token,c,g,!0,l,y,k,!1,b.ringToneForHost);b.outgoingCallServices.startVideoCall();a("#mck-btn-video-call").data("isCallHost",!0);a("#mck-btn-video-call").data("callStartTime",l)}else"INSUFFICIENT_FUNDS"===f?alert("Video calling is not available at the moment. For details, contact support."):alert("missing token... please refresh page..")});a("#mck-vid-receive-btn").on("click",
function(b){console.log("call received");$("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");c.removeClass("vis").addClass("n-vis");b=a("#mck-video-call-indicator").data("call-id");var f=a("#mck-video-call-indicator").data("isAudioCall");a("#mck-video-call-indicator").data("callReceived",!0);a("#mck-video-call-indicator").addClass("n-vis");ka.callReceived(b,f)});a("#mck-vid-reject-btn").on("click",function(b){console.log("call rejected");b=a("#mck-video-call-indicator").data("call-id");
var f=a("#mck-video-call-indicator").data("isAudioCall");ka.callRejected(b,f);a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};b.InitilizeVideoClient=function(c,g){b.Identity=c;a.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:c,device:g},success:function(a){if(null!=a&&""!=a){b.token=a.token;var c=ALStorage.getAppHeaders();c.videoToken=a.token;ALStorage.setAppHeaders(c)}a.hasOwnProperty("errorResponse")&&(f=a.errorResponse[0].description)},
error:function(a){console.log("error while getting token"+a)}})};b.callReceived=function(a,f){var c=$mck_msg_to.val();console.log("_this.callReceived");sa&&sa.stop();I.sendVideoCallMessage(a,"CALL_ANSWERED",102,f,c,function(a){y.sendMessage(a)});b.incomingCallServices=new MckCallingService(b.Identity,b.token,a,null,!1,null,y,null,f);b.incomingCallServices.startVideoCall()};b.callRejected=function(a,b){sa&&sa.stop();I.sendVideoCallMessage(a,"CALL_REJECTED",102,b,toUser,function(a){y.sendMessage(a)})}},
xc=null,Ia={},vb,Hc=!1,sa=null,Yb=g.isAnonymousChat,Ea=g.askUserDetails,gb=g.conversationTitle,Xa=g.agentId,hb=g.botIds;f.MCK_OL_MAP=[];k.mckLaunchSideboxChat=function(){a("#mck-sidebox-launcher").removeClass("vis").addClass("n-vis");KommunicateUI.showChat();a("#mck-away-msg-box").removeClass("vis").addClass("n-vis");y.loadConversationWithAgents({groupName:gb,agentId:Xa,botIds:hb},function(){console.log("conversation created successfully")})};k.events={onConnectFailed:function(){},onConnect:function(){},
onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};k.loadConversationWithAgent=function(a){if(a&&
a.agentId)console.log("setting default agent inside Applozic"),y.loadConversationWithAgents(a);else throw Error("params are empty");};var Q=new function(b){var c=this,g=b.events,k=null,p=null,r="",u=null,G=[],V,x,F="",U=a("#mck-sidebox"),K=a("#mck-tab-title"),S=a(".mck-typing-box"),Q=a("#mck-tab-status");a("#mck-offline-message-box");var X=a("#mck-typing-label"),N=a("#mck-message-cell .mck-message-inner");c.init=function(){if("undefined"!==typeof wb){var a=M.startsWith(wb,"https")?"15675":"15674";
"function"===typeof f.SockJS&&(F||(F=new SockJS(wb+":"+a+"/stomp")),p=f.Stomp.over(F),p.heartbeat.outgoing=0,p.heartbeat.incoming=0,p.onclose=function(){c.disconnect()},p.connect("guest","guest",c.onConnect,c.onError,"/"),f.addEventListener("beforeunload",function(a){c.disconnect()}))}};c.checkConnected=function(a){p.connected?(V&&clearInterval(V),x&&clearInterval(x),V=setInterval(function(){c.connectToSocket(a)},6E5),x=setInterval(function(){c.sendStatus(1)},12E5)):c.connectToSocket(a)};c.connectToSocket=
function(a){if(!p.connected){if(a&&"block"===U.css("display"))if(a=N.data("mck-id")){var b=N.data("isgroup"),f=N.data("mck-conversationid"),g=N.data("mck-topicid");ALStorage.clearMckMessageArray();m.loadTab({tabId:a,isGroup:b,conversationId:f,topicId:g})}else ALStorage.clearMckMessageArray(),m.loadTab({tabId:"",isGroup:!1});c.init()}};c.stopConnectedCheck=function(){V&&clearInterval(V);x&&clearInterval(x);x=V="";c.disconnect()};c.disconnect=function(){clearInterval(void 0);p&&p.connected&&(c.sendStatus(0),
p.disconnect(),F.close(),F="")};c.unsubscibeToTypingChannel=function(){p&&p.connected&&u&&(1===qa&&c.sendTypingStatus(0,r),u.unsubscribe());u=null};c.unsubscibeToNotification=function(){p&&p.connected&&k&&k.unsubscribe();k=null};c.subscibeToTypingChannel=function(a,b){a=b?a:A;p&&p.connected?u=p.subscribe("/topic/typing-"+Y+"-"+a,c.onTypingStatus):c.reconnect()};c.subscribeToOpenGroup=function(a){if(p&&p.connected){var b=p.subscribe("/topic/group-"+Y+"-"+a.contactId,c.onOpenGroupMessage);G.push(b.id);
Jb[a.contactId]=b.id}else c.reconnect()};c.sendTypingStatus=function(a,b){if(p&&p.connected){1===a&&1===qa&&p.send("/topic/typing-"+Y+"-"+r,{"content-type":"text/plain"},Y+","+A+","+a);if(b){if(b===r&&a===qa&&1===a)return;r=b;p.send("/topic/typing-"+Y+"-"+b,{"content-type":"text/plain"},Y+","+A+","+a);setTimeout(function(){qa=0},6E4)}else 0===a&&p.send("/topic/typing-"+Y+"-"+r,{"content-type":"text/plain"},Y+","+A+","+a);qa=a}};c.onTypingStatus=function(a){if(null!=u&&u.id===a.headers.subscription){var b=
a.body,c=b.split(",")[1];b=Number(b.split(",")[2]);var f=a.headers.destination.substring(a.headers.destination.lastIndexOf("-")+1,a.headers.destination.length),g=N.data("mck-id");a=N.data("isgroup");var k=C.getGroup(g);if(!ta[c]&&!La[c])if(1===b){if(!(A===c&&a||g!==c&&g!==f)){if(a=N.data("isgroup")){if(c!==A){if(w.authenticateGroupUser(k)||6===k.type&&!ua.disableChatForNonGroupMember)K.addClass("mck-tab-title-w-typing"),Q.removeClass("vis").addClass("n-vis"),c=m.getTabDisplayName(c,!1),c=c.split(" ")[0],
X.html(c+" "+MCK_LABELS["is.typing"]);7===k.type&&(K.addClass("mck-tab-title-w-typing"),X.html(MCK_LABELS["is.typing"]),Q.html(""))}}else K.addClass("mck-tab-title-w-typing"),Q.removeClass("vis").addClass("n-vis"),X.html(MCK_LABELS.typing);S.removeClass("n-vis").addClass("vis");setTimeout(function(){K.removeClass("mck-tab-title-w-typing");S.removeClass("vis").addClass("n-vis");K.hasClass("undefined"===typeof k||7!=k.type)&&Q.removeClass("n-vis").addClass("vis");X.html(MCK_LABELS.typing)},6E4)}}else K.removeClass("mck-tab-title-w-typing"),
S.removeClass("vis").addClass("n-vis"),!K.hasClass("mck-tab-title-w-status")||"undefined"!==typeof k&&7==k.type||Q.removeClass("n-vis").addClass("vis"),X.html(MCK_LABELS.typing)}};c.reconnect=function(){c.unsubscibeToTypingChannel();c.unsubscibeToNotification();c.disconnect();c.init()};c.onError=function(a){f.console.log("Error in channel notification. "+a);g.onConnectFailed()};c.sendStatus=function(a){p&&p.connected&&p.send("/topic/status-v2",{"content-type":"text/plain"},n+","+ha+","+a)};c.onConnect=
function(){p.connected?(k&&c.unsubscibeToNotification(),k=p.subscribe("/topic/"+n,c.onMessage),c.sendStatus(1),c.checkConnected(!0)):setTimeout(function(){k=p.subscribe("/topic/"+n,c.onMessage);c.sendStatus(1);c.checkConnected(!0)},5E3);g.onConnect()};c.onOpenGroupMessage=function(b){if(-1!==G.indexOf(b.headers.subscription)){var c=a.parseJSON(b.body),f=c.type;b=c.message;if("APPLOZIC_03"===f)ALStorage.updateLatestMessage(b),0!==b.type&&4!==b.type&&(a("."+b.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),
m.addTooltip(b.key)),g.onMessageSentUpdate({messageKey:b.key});else if("APPLOZIC_01"===f||"APPLOZIC_02"===f||"MESSAGE_RECEIVED"===f){ALStorage.updateLatestMessage(b);var k=b.groupId?C.getGroup(b.groupId):m.getContact(b.to);a("#mck-sidebox-content");N.data("mck-id");if("APPLOZIC_01"===f||"MESSAGE_RECEIVED"===f){var l=m.getMessageFeed(b);g.onMessageReceived({message:l})}else"APPLOZIC_02"===f&&(l=m.getMessageFeed(b),g.onMessageSent({message:l}));b.conversationId&&(l=ca[b.conversationId],!Oa&&!ab||"object"===
typeof l&&"object"===typeof aa[l.topicId]||I.getTopicId({conversationId:b.conversationId,messageType:f,message:b,notifyUser:c.notifyUser,async:!1,populate:!1},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)}));"undefined"===typeof k?(c={message:b,messageType:f,notifyUser:c.notifyUser},b.groupId?v.getGroupFeedFromMessage(c):(f=[],f.push(b.to),da.getUsersDetail(f,c))):m.populateMessage(f,b,c.notifyUser)}}};c.onMessage=function(b){if(null!=k&&k.id===b.headers.subscription){b=a.parseJSON(b.body);
var c=b.type;if("APPLOZIC_04"===c||"MESSAGE_DELIVERED"===c)a("."+b.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),m.addTooltip(b.message.split(",")[0]),g.onMessageDelivered({messageKey:b.message.split(",")[0]});else if("APPLOZIC_08"===c||"MT_MESSAGE_DELIVERED_READ"===c)a("."+b.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),
m.addTooltip(b.message.split(",")[0]),g.onMessageRead({messageKey:b.message.split(",")[0]});else if("APPLOZIC_05"===c){var l=b.message.split(",")[0];var n=b.message.split(",")[1];var p="1"===b.message.split(",")[2]?!0:!1;m.removedDeletedMessage(l,n,p);b={messageKey:b.message.split(",")[0]};p?b.groupId=n:b.userKey=n;g.onMessageDeleted(b)}else if("APPLOZIC_27"===c)l=b.message.split(",")[0],b=b.message.split(",")[1],"undefined"!==typeof l&&(m.removeConversationThread(l,!1),m.updateUnreadCount("user_"+
l,0,!0),p={userId:l},b&&(p.topicId=b),g.onConversationDeleted(p));else if("APPLOZIC_11"===c){l=b.message;p=m.fetchContact(l);n=N.data("mck-id");if(!ta[l]&&!La[l]){if(n!==p.contactId||N.data("isgroup")){var r=mckContactUtils.formatContactId(l);a("#li-user-"+r+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else a("#mck-tab-status").html(MCK_LABELS.online),rb&&m.hideOfflineMessage();a(".mck-user-ol-status."+r).removeClass("n-vis").addClass("vis");a(".mck-user-ol-status."+r).next().html("("+
MCK_LABELS.online+")");f.MCK_OL_MAP[l]=!0;xa.updateUserStatus({userId:b.message,status:1},function(a){da.getUsersDetail(a,{})})}g.onUserConnect({userId:b.message})}else if("APPLOZIC_12"===c)l=b.message.split(",")[0],b=b.message.split(",")[1],p=m.fetchContact(l),f.MCK_OL_MAP[l]=!1,b&&(ba[l]=b),ta[l]||La[l]||(n=N.data("mck-id"),n!==p.contactId||N.data("isgroup")||(a("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(b)),rb&&jb.manageOfflineMessageTime(n)),a(".mck-user-ol-status."+p.htmlId).removeClass("vis").addClass("n-vis"),
a(".mck-user-ol-status."+p.htmlId).next().html("(Offline)"),a("#li-user-"+r+" .mck-ol-status").removeClass("vis").addClass("n-vis"),xa.updateUserStatus({userId:l,status:0,lastSeenAtTime:b},function(a){da.getUsersDetail(a,{})})),g.onUserDisconnect({userId:l,lastSeenAtTime:b});else if("APPLOZIC_29"===c){l=b.message.split(",")[0];b=b.message.split(",")[1];p=m.fetchContact(l);m.updateUnreadCount("user_"+p.contactId,0,!0);n=N.data("mck-id");if("undefined"===typeof n||""===n)a("#li-user-"+p.htmlId+" .mck-unread-count-text").html(m.getUnreadCount("user_"+
p.contactId)),a("#li-user-"+p.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");p={userId:l};b&&(p.topicId=b);g.onConversationReadFromOtherSource(p)}else if("APPLOZIC_28"===c)l=b.message.split(",")[0],b=b.message.split(",")[1],n=N.data("mck-id"),n===l&&(a(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),a(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),
p=m.getContact(l),"undefined"===typeof p&&(p=[],p.push(l),da.getUsersDetail(p,{}))),p={userId:l},b&&(p.topicId=b),g.onConversationRead(p);else if("APPLOZIC_16"===c)c=b.message.split(":")[0],l=b.message.split(":")[1],p=m.fetchContact(l),n=N.data("mck-id"),n===p.contactId?c===tc[0]?(ta[p.contactId]=!0,Fa.toggleBlockUser(n,!0)):(La[p.contactId]=!0,K.removeClass("mck-tab-title-w-status"),Q.removeClass("vis").addClass("n-vis"),S.removeClass("vis").addClass("n-vis")):a("#li-user-"+p.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),
g.onUserBlocked({status:c,userId:l});else if("APPLOZIC_17"===c){c=b.message.split(":")[0];l=b.message.split(":")[1];p=m.fetchContact(l);n=N.data("mck-id");if(n===p.contactId)if(c===tc[2])ta[p.contactId]=!1,Fa.toggleBlockUser(n,!1);else{if(f.MCK_OL_MAP[n]||ba[n])La[p.contactId]=!1,ta[n]||(f.MCK_OL_MAP[n]?Q.html(MCK_LABELS.online):ba[n]&&Q.html(mckDateUtils.getLastSeenAtStatus(ba[n])),K.addClass("mck-tab-title-w-status"),Q.removeClass("n-vis").addClass("vis"))}else f.MCK_OL_MAP[n]&&a("#li-user-"+p.htmlId+
" .mck-ol-status").removeClass("n-vis").addClass("vis");g.onUserUnblocked({status:c,userId:l})}else if("APPLOZIC_18"===c)qb=!1,g.onUserActivated();else if("APPLOZIC_19"===c)qb=!0,g.onUserDeactivated();else if(l=b.message,"APPLOZIC_03"===c)ALStorage.updateLatestMessage(l),0!==l.type&&4!==l.type&&(a("."+l.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),m.addTooltip(l.key)),g.onMessageSentUpdate({messageKey:l.key});else if("APPLOZIC_01"===c||"APPLOZIC_02"===c||"MESSAGE_RECEIVED"===
c)ALStorage.updateLatestMessage(l),p=l.groupId?C.getGroup(l.groupId):m.getContact(l.to),a("#mck-sidebox-content"),n=N.data("mck-id"),"APPLOZIC_01"===c||"MESSAGE_RECEIVED"===c?(n=m.getMessageFeed(l),g.onMessageReceived({message:n})):"APPLOZIC_02"===c&&(n=m.getMessageFeed(l),g.onMessageSent({message:n})),l.conversationId&&(n=ca[l.conversationId],!Oa&&!ab||"object"===typeof n&&"object"===typeof aa[n.topicId]||I.getTopicId({conversationId:l.conversationId,messageType:c,message:l,notifyUser:b.notifyUser,
async:!1,populate:!1},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)})),"undefined"===typeof p?(b={message:l,messageType:c,notifyUser:b.notifyUser},l.groupId?v.getGroupFeedFromMessage(b):(p=[],p.push(l.to),da.getUsersDetail(p,b))):(102==l.contentType&&Ya&&(b.notifyUser=!1,4==l.type&&"CALL_DIALED"==l.metadata.MSG_TYPE?(p=m.fetchContact(l.to),n=m.getTabDisplayName(p.contactId,!1),p=m.getContactImageLink(p,n),a("#mck-video-call-indicator").data("call-id",l.metadata.CALL_ID),a("#mck-video-call-indicator").data("isAudioCall",
l.metadata.CALL_AUDIO_ONLY),a("#mck-video-call-indicator-txt").html(n+" calling..."),a("#mck-video-call-icon").html(p),a("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),sa.play(),setTimeout(function(){a("#mck-video-call-indicator").data("callReceived")||(console.log("call is not answered"),sa.stop(),a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==l.type&&"CALL_REJECTED"==l.metadata.MSG_TYPE&&a("#mck-btn-video-call").data("isCallHost")&&(p=$mck_msg_to.val(),
I.sendVideoCallMessage(l.metadata.CALL_ID,"CALL_REJECTED",103,!1,p,function(a){y.sendMessage(a)}),ka.ringToneForHost.stop(),ka.outgoingCallServices.twilioService.leaveRoomIfJoined(),ka.hideVideoBox(),ka.outgoingCallServices&&(ka.outgoingCallServices.rejectedByReceiver=!0))),103==l.contentType?4==l.type&&"CALL_MISSED"==l.metadata.MSG_TYPE&&(a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),sa&&sa.stop()):m.populateMessage(c,l,b.notifyUser))}}}(k);k.getOptions=function(){return g};
k.init=function(){window.Applozic.ALApiService.initServerUrl(MCK_BASE_URL);G.get(g);I.init(g);uc.init(g);m.init();Ia.loop=!1;hc&&(vb=new RingToneService,xc=vb.loadRingTone(hc,Ia));y.init();Eb.init();v.init();jb.initializeApp(g,!1);Cb.init();Zb.init();zc?m.initEmojis():document.getElementById("mck-btn-smiley-box").getElementsByTagName("div")[0].setAttribute("class","n-vis");Ya&&(Ia.loop=!0,vb=new RingToneService,sa=vb.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",
Ia),ka.init())};k.reInit=function(b){KommunicateUtils.storeDataIntoKmSession("appOptions",b);"object"===a.type(b)&&(b=a.extend(!0,{},r,b),g.conversationTitle=g.conversationTitle||g.groupName,g.accessToken=g.password||g.accessToken,a.fn.applozic("reset",b),b.userId&&b.appId&&""!==a.trim(b.userId)&&""!==a.trim(b.appId)?(jb.initializeApp(b,!0),g=b):f.console("Oops! looks like incorrect application id or user Id."))};k.loadTabView=function(b){"undefined"===typeof b.isGroup&&(b.isGroup=!1);m.loadTab(b);
a("#mck-search").val("")};k.loadTab=function(b,c){m.loadTab({tabId:b,isGroup:!1},c);a("#mck-search").val("")};k.loadChat=function(b){if(!("undefined"!==typeof b.userId&&""!==b.userId||"undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId))return"UserId or groupId or clientGroupId required";var c={};b.userId&&(c.tabId=userId,c.isGroup=!1);b.displayName&&(c.userName=b.displayName);b.convId&&(c.conversationId=b.convId);if(b.groupId||b.clientGroupId)if(c.isGroup=
!0,b.clientGroupId){c.clientGroupId=b.clientGroupId;var f=C.getGroupByClientGroupId(b.clientGroupId);if("object"===typeof f)c.tabId=f.contactId;else{w.getGroupFeed({clientGroupId:c.clientGroupId,apzCallback:v.onGroupFeed,callback:v.loadGroupTab});a("#mck-search").val("");return}}else if(f=C.getGroup(b.groupId),"object"===typeof f)c.tabId=b.groupId;else{w.getGroupFeed({groupId:b.groupId,apzCallback:v.onGroupFeed,callback:v.loadGroupTab});a("#mck-search").val("");return}m.loadTab(c);a("#mck-search").val("")};
k.uploadFile=function(a){Eb.uploadFile(a)};k.audioAttach=function(a){Eb.audioRecoder(a)};k.loadGroupTab=function(b){if("undefined"===typeof b||""===b)return"GroupId required";"object"===typeof C.getGroup(b)?(m.loadTab({tabId:b,isGroup:!0}),a("#mck-search").val("")):w.getGroupFeed({groupId:b,apzCallback:v.onGroupFeed,callback:v.loadGroupTab})};k.loadGroupTabByClientGroupId=function(b){if("undefined"===typeof b.clientGroupId||""===b.clientGroupId)return"Client Group Id Required";var c=C.getGroupByClientGroupId(b.clientGroupId);
"object"===typeof c?(m.loadTab({tabId:c.contactId,isGroup:!0}),a("#mck-search").val("")):w.getGroupFeed({clientGroupId:b.clientGroupId,apzCallback:v.onGroupFeed,callback:v.loadGroupTab})};k.loadConvTab=function(a){"object"===typeof a&&a.userId&&a.convId&&m.loadTab({tabId:a.userId,conversationId:a.convId,isGroup:!1})};k.loadTabWithTopic=function(a){if("object"===typeof a&&(a.userId||a.groupId)&&a.topicId){var b={tabId:a.userId,topicId:a.topicId};a.userName&&(b.userName=a.userName);b.topicStatus=a.topicStatus?
-1===X.indexOf(a.topicStatus)?X[0]:a.topicStatus.toString():X[0];if("function"===typeof Ca||a.topicDetail){var c=a.topicDetail?a.topicDetail:Ca(a.topicId);"object"===typeof c&&"undefined"!==c.title&&(aa[a.topicId]=c)}a.message?(b.messagePxy={type:5,contentType:0,message:message},b.isMessage=!0):b.isMessage=!1;a.supportId?(b.isGroup=!0,b.supportId=supportId):(b.isGroup=!1,b.userId=a.userId);y.getConversationId(b)}else{if(!a.userId||!a.groupId)return"UserId required";if(!a.topicId)return"TopicId required"}};
k.loadContacts=function(a){m.loadContacts(a)};k.loadContactsForContactList=function(a){m.loadContactsForContactList(a)};k.setOffline=function(){"undefined"!==typeof Q&&Q.sendStatus(0)};k.reset=function(b){f.sessionStorage.clear();p=n="";U=[];MCK_GROUP_MAP=[];Gb=!0;Ja=[];ha="";Ib=b.mode;ta=[];La=[];Ka=!1;Ma=90;Y=b.appId;ba=[];ca=[];aa=[];MCK_CLIENT_GROUP_MAP=[];Hb=!0;MCK_LABELS=b.labels;K=0;MCK_BASE_URL=b.baseUrl;Na=b.fileupload;cc=b.customFileUrl;ja={};bb=[];lb=b.launcher;Jb=[];dc=b.userName;xb=b.visitor;
Aa=[];cb=[];Sa={};Ra=b.fileBaseUrl;mb=b.locShare;Ya=g.video;S=b.onInit;Mb=b.onTopicDetails;Da=[];wa=[];Nb=b.onClose;ia=b.accessToken;Ob=b.displayText;ib=b.readConversation;ra=b.maxGroupSize;Ha=[];Pb=b.onTabClicked;ec=b.contactNumber;yb=b.appModuleName;Ca=b.getTopicDetail;Ba=b.maxAttachmentSize;Rb=b.validateMessage;Qb=b.contactDisplayName;db=[];Za=b.finalPriceResponse;$a=b.contactDisplayImage;Sb=b.priceWidget;ua=g.openGroupSettings;va=b.offlineMessageDetail;Tb=b.getConversationDetail;zb=b.authenticationTypeId;
A=xb?"guest":a.trim(b.userId);ic=mb?b.googleApiKey:"NO_ACCESS";Ab="boolean"===typeof b.olStatus?b.olStatus:!1;ab="boolean"===typeof b.topicBox?b.topicBox:!1;rb="boolean"===typeof b.showOfflineMessage?b.showOfflineMessage:!1;Oa="boolean"===typeof b.topicHeader?b.topicHeader:!1;qc="boolean"===typeof b.notification?b.notification:!0;oc=b.supportId?'data-mck-id\x3d"'+b.supportId+'"':"";kc="boolean"===typeof b.hideGroupSubtitle?b.hideGroupSubtitle:!1;lc="undefined"===typeof b.defaultMessageMetaData?{}:
b.defaultMessageMetaData;Vb="boolean"===typeof b.groupUserCount?b.groupUserCount:!1;pc="boolean"===typeof b.desktopNotification?b.desktopNotification:!1;Wb="boolean"===typeof b.loadOwnContacts?b.loadOwnContacts:!1;jc="boolean"===typeof b.messageBubbleAvator?b.messageBubbleAvator:!1;nc="boolean"===typeof g.resetUserStatus?g.resetUserStatus:!1;Bb="boolean"===typeof b.launchOnNewMessage?b.launchOnNewMessage:!1;rc="boolean"===typeof b.autoTypeSearchEnabled?b.autoTypeSearchEnabled:!0;mc="boolean"===typeof b.checkUserBusyWithStatus?
b.checkUserBusyWithStatus:!1;Xb="boolean"===typeof b.launchOnUnreadMessage?b.launchOnUnreadMessage:!1;Yb=g.isAnonymousChat;Ea=g.askUserDetails};k.logout=function(){"undefined"!==typeof Q&&(Q.disconnect(),ALStorage.clearMckMessageArray(),a.fn.applozic("reset",g),a("#mck-sidebox").hide(),a("#mck-sidebox-launcher").hide());Gb=!1};k.setOnline=function(){"undefined"!==typeof Q&&Q.sendStatus(1)};k.getUserStatus=function(b){"function"===typeof b.callback&&("undefined"!==typeof b.userIds?da.getUsersDetail(b.userIds,
b):xa.getUserStatus(b,function(b){a.each(b.users,function(a,b){a=m.getContact(""+b.userId);a="undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b);db.push(a.contactId)})}))};k.getGroupList=function(a){return"function"===typeof a.callback?(a.apzCallback=v.loadGroups,w.loadGroups(a),"success"):"Callback Function Required"};k.leaveGroup=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback){if("undefined"!==typeof a.groupId&&
""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)return a.apzCallback=v.onGroupLeft,w.leaveGroup(a),"success";a.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};k.addGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===
typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else if("undefined"!==typeof a.role&&-1===Kb.indexOf(a.role))a.callback({status:"error",errorMessage:"Incorrect member role"});else return xa.loadUserProfile(a.userId),a.apzCallback=v.onAddedGroupMember,w.addGroupMember(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};k.removeGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";
if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else return a.apzCallback=v.onRemovedGroupMember,w.removeGroupMemberFromChat(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};k.updateGroupInfo=function(b){if("object"!==
typeof b)return"Unsupported format. Please check format";if("function"===typeof b.callback)if("undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId){if("undefined"!==typeof b.name&&""!==b.name||"undefined"!==typeof b.imageUrl&&""!==b.imageUrl||b.users&&0!==b.users.length){if(b.users&&0<b.users.length){var c=[];a.each(b.users,function(a,b){b.userId&&"undefined"!==typeof b.role&&-1!==Kb.indexOf(b.role)&&c.push(b)});if(0===c.length){b.callback({status:"error",
errorMessage:"Incorrect users detail"});return}}c=[];a(".mck-group-change-role-box.vis").each(function(b,f){b=a(this);f=parseInt(b.find("select").val());var g=b.parents(".mck-li-group-member").data("role");f!==g&&(b={userId:b.parents(".mck-li-group-member").data("mck-id"),role:f},c.push(b))});b.apzCallback=v.onUpdateGroupInfo;w.updateGroupInfo(b);return"success"}b.callback({status:"error",errorMessage:"Group properties required"})}else b.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});
else return"Callback function required"};k.getMessages=function(a){"function"===typeof a.callback&&I.getMessages(a)};k.getMessageList=function(a){return"undefined"!==typeof a&&"function"===typeof a.callback?(I.getMessageList(a,function(a){if("undefined"!==typeof a.to||"undefined"!==typeof a.groupId)a=m.getMessageFeed(a),messageFeeds.push(a)}),"success"):"Callback function required"};k.getMessageListByTopicId=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===
typeof a.callback)if("undefined"!==typeof a.id&&""!==a.id||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if(a.id&&"boolean"!==typeof a.isGroup)a.callback({status:"error",errorMessage:"IsGroup parameter required"});else{if(a.topicId){a.id&&(a.tabId=a.id);a.topicStatus=X[0];var b=Aa[a.topicId];b&&"object"===typeof ca[b]?(a.conversationId=b,I.getMessageList(a,function(a){if("undefined"!==typeof a.to||"undefined"!==typeof a.groupId)a=m.getMessageFeed(a),messageFeeds.push(a)})):(a.isExtMessageList=
!0,a.pageSize=1,I.fetchConversationByTopicId(a,function(a){y.getMessageList(a)}));return"success"}a.callback("TopicId required")}else a.callback({status:"error",errorMessage:"Id or clientGroupId required"});else return"Callback function required."};k.sendMessage=function(b){if("object"===typeof b){b=a.extend(!0,{},u,b);var c=b.message;if(!b.to)return"To field required";if("undefined"===typeof c||""===c)return"Message field required";if(12<b.type)return"Invalid message type";c=a.trim(c);b={to:a.trim(b.to),
type:b.messageType,contentType:b.type,message:c,metadata:b.metadata};y.sendMessage(b);return"success"}return"Unsupported format. Please check format"};k.updateUserIdentity=function(a){da.updateUserIdentity(a)};k.updateUser=function(a){da.updateUser(a)};k.getGroupListByFilter=function(a){w.getGroupByFilter(a)};k.updateMessageMetadata=function(a){y.updateMessageMetadata(a)};k.sendGroupMessage=function(b){if("object"===typeof b){b=a.extend(!0,{},u,b);var c=b.message;if(!b.groupId&&!b.clientGroupId)return"groupId or clientGroupId required";
if("undefined"===typeof c||""===c)return"message field required";if(12<b.type)return"invalid message type";c=a.trim(c);c={type:b.messageType,contentType:b.type,message:c,metadata:b.metadata||{}};if(b.groupId)c.groupId=a.trim(b.groupId);else if(b.clientGroupId){if("undefined"===typeof C.getGroupByClientGroupId(b.clientGroupId))return"group not found";c.clientGroupId=a.trim(b.clientGroupId)}y.sendMessage(c);return"success"}return"Unsupported format. Please check format"};k.addWelcomeMessage=function(a){if("object"===
typeof a){if("undefined"===typeof a.sender||""===a.sender)return"Sender Field Required";if("undefined"===typeof a.messageContent||""===a.messageContent)return"Message Content Required";y.sendWelcomeMessage(a)}else return"Unsupported format. Please check format"};k.createGroup=function(a){if("object"===typeof a){if("function"===typeof a.callback){var b=a.users;if("undefined"===typeof b||1>b.length){a.callback({status:"error",errorMessage:"Users list required"});return}if(b.length>ra){a.callback({status:"error",
errorMessage:"Users limit exceeds "+ra+". Max number of users allowed is "+ra+"."});return}if(!a.groupName){a.callback({status:"error",errorMessage:"Group name required"});return}if("undefined"===typeof a.type||""===a.type){a.callback({status:"error",errorMessage:"Group type required"});return}if(-1===Lb.indexOf(a.type)){a.callback({status:"error",errorMessage:"Invalid group type"});return}y.getGroup(a);return"success"}return"Callback function required"}return"Unsupported Format. Please check format"};
k.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";if(b.length>ra)return"Users limit exceeds "+ra+". Max number of users allowed is "+ra+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===Lb.indexOf(a.type))return"Invalid group type";y.getGroup(a);return"success"}return"Unsupported format. Please check format"};k.getTotalUnreadCount=function(){return K};k.subscribeToEvents=
function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(k.events.onConnectFailed=a.onConnectFailed),"function"===typeof a.onConnect&&(k.events.onConnect=a.onConnect),"function"===typeof a.onMessageDelivered&&(k.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(k.events.onMessageRead=a.onMessageRead),"function"===typeof a.onMessageDeleted&&(k.events.onMessageDeleted=a.onMessageDeleted),"function"===typeof a.onConversationDeleted&&(k.events.onConversationDeleted=
a.onConversationDeleted),"function"===typeof a.onUserConnect&&(k.events.onUserConnect=a.onUserConnect),"function"===typeof a.onUserDisconnect&&(k.events.onUserDisconnect=a.onUserDisconnect),"function"===typeof a.onConversationReadFromOtherSource&&(k.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&(k.events.onConversationRead=a.onConversationRead),"function"===typeof a.onMessageReceived&&(k.events.onMessageReceived=a.onMessageReceived),
"function"===typeof a.onMessageSentUpdate&&(k.events.onMessageSentUpdate=a.onMessageSentUpdate),"function"===typeof a.onMessageSent&&(k.events.onMessageSent=a.onMessageSent),"function"===typeof a.onUserBlocked&&(k.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(k.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&(k.events.onUserActivated=a.onUserActivated),"function"===typeof a.onUserDeactivated&&(k.events.onUserDeactivated=a.onUserDeactivated))};
k.getConversation=function(a){I.getTopicId({conversationId:a.conversationId},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)})}}f.applozic||(f.applozic=f.applozic?f.applozic:{},a.extend(!0,f.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var r={baseUrl:"https://chat.kommunicate.io",fileBaseUrl:"https://applozic.appspot.com",customFileUrl:"https://googleupload.applozic.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",
launcher:"applozic-launcher",emojilibrary:!1,userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,groupUserCount:!1,desktopNotification:!0,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,isAnonymousChat:!0,groupName:"Kommunicate",agentId:"",agentName:"",labels:{"conversations.title":"Conversations","start.new":"Start New Conversation","search.contacts":"Contacts",
"search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update",
"group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?",
"remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send",
"send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",hour:" hour",min:" min",yesterday:"yesterday",hours:" hours",mins:" mins","user.delete":"This user has been deleted",ago:"ago",admin:"Admin",user:"User",moderator:"Moderator",member:"Member","public":"Public","private":"Private",open:"Open",you:"You","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",
REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,
disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},u={messageType:5,type:0};a.fn.applozic=function(c,f,u){var g=a("#mck-sidebox");"object"===a.type(c)&&(KommunicateUtils.storeDataIntoKmSession("appOptions",c),c=a.extend(!0,{},r,c),c.conversationTitle=c.conversationTitle||c.groupName,c.accessToken=c.password||c.accessToken);if("undefined"!==typeof g.data("applozic_instance"))if(g=g.data("applozic_instance"),"string"===a.type(c))switch(c){case "reInitialize":return g.reInit(f);
case "loadConvTab":g.loadConvTab(f);break;case "loadTab":g.loadTab(f,u);break;case "uploadFile":g.uploadFile(f);break;case "loadTabView":g.loadTabView(f);break;case "loadChat":g.loadChat(f);break;case "loadContextualTab":return g.loadTabWithTopic(f);case "audioAttach":g.audioAttach(f);break;case "addWelcomeMessage":g.addWelcomeMessage(f);break;case "loadContacts":g.loadContacts(f);break;case "sendMessage":return g.sendMessage(f);case "sendGroupMessage":return g.sendGroupMessage(f);case "createGroup":return g.createGroup(f);
case "loadBroadcastTab":return f.groupName=f.groupName?f.groupName:"Broadcast",f.type=5,g.initGroupTab(f);case "initBroadcastTab":return f.groupName=f.groupName?f.groupName:"Broadcast",f.type=5,g.initGroupTab(f);case "initGroupTab":return g.initGroupTab(f);case "loadGroupTab":return g.loadGroupTab(f);case "loadGroupTabByClientGroupId":return g.loadGroupTabByClientGroupId(f);case "setOffline":return g.setOffline(),"success";case "setOnline":return g.setOffline(),"success";case "logout":return g.logout(),
"success";case "reset":g.reset(f);break;case "getUserDetail":return g.getUserStatus(f),"success";case "getGroupList":return g.getGroupList(f),"success";case "leaveGroup":return g.leaveGroup(f);case "addGroupMember":return g.addGroupMember(f);case "removeGroupMember":return g.removeGroupMember(f);case "updateGroupInfo":return g.updateGroupInfo(f);case "getMessages":g.getMessages(f);break;case "messageList":return g.getMessageList(f);case "getMessageListByTopicId":return g.getMessageListByTopicId(f);
case "getTotalUnreadCount":return g.getTotalUnreadCount();case "subscribeToEvents":return g.subscribeToEvents(f);case "getConversation":return g.getConversation(f);case "loadConversationWithAgent":return g.loadConversationWithAgent(f);case "updateUserIdentity":return g.updateUserIdentity(f);case "updateUser":return g.updateUser(f);case "getGroupListByFilter":return g.getGroupListByFilter(f);case "updateMessageMetadata":return g.updateMessageMetadata(f);case "mckLaunchSideboxChat":return g.mckLaunchSideboxChat()}else"object"===
a.type(c)&&g.reInit(c);else"object"===a.type(c)&&(c.userId&&c.appId&&""!==a.trim(c.userId)&&""!==a.trim(c.appId)?"undefined"!==typeof g.data("applozic_instance")?(g=g.data("applozic_instance"),g.reInit(c)):(jQuery="undefined"!==typeof c.ojq?$=c.ojq:$=a,"function"===typeof c.obsm?($.fn.modal=c.obsm,jQuery.fn.modal=c.obsm):"function"===typeof a.fn.modal?(f=a.fn.modal.noConflict(),$.fn.modal=f,jQuery.fn.modal=f):"function"===typeof $.fn.modal&&(f=$.fn.modal.noConflict(),$.fn.modal=f,jQuery.fn.modal=
f),"function"===typeof c.omckm?a.fn.mckModal=c.omckm:"function"===typeof a.fn.mckModal?a.fn.mckModal=a.fn.mckModal.noConflict():"function"===typeof $.fn.mckModal&&(a.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(a.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof a.fn.linkify&&($.fn.linkify=a.fn.linkify,jQuery.fn.linkify=a.fn.linkify),"function"===typeof $.fn.emojiarea?a.fn.emojiarea=$.fn.emojiarea:"function"===typeof a.fn.emojiarea&&($.fn.emojiarea=
a.fn.emojiarea,jQuery.fn.emojiarea=a.fn.emojiarea),"function"===typeof $.fn.locationpicker?a.fn.locationpicker=$.fn.locationpicker:"function"===typeof a.fn.locationpicker&&($.fn.locationpicker=a.fn.locationpicker,jQuery.fn.locationpicker=a.fn.locationpicker),c=new n(c),g.data("applozic_instance",c),c.init()):alert("Oops! looks like incorrect application id or user Id."))};a.fn.applozic.defaults=r})($applozic,window,document);
Kommunicate.attachEvents=function(a){a("#mck-message-cell").on("click",".km-increment-guest-count",Kommunicate.richMsgEventHandler.incrementGuestCount);a("#mck-message-cell").on("click",".km-decrement-guest-count",Kommunicate.richMsgEventHandler.decrementGuestCount);a("#mck-message-cell").on("click",".km-btn-add-more-rooms",Kommunicate.richMsgEventHandler.addMoreRoom);a("#mck-message-cell").on("click",".km-done-button",Kommunicate.richMsgEventHandler.processSelectedRoom);a("#mck-message-cell").on("click",
".km-card-message-footer-button",Kommunicate.richMsgEventHandler.processHotelBookClick);a("#mck-message-cell").on("click",".km-cta-button",Kommunicate.richMsgEventHandler.handlleRichButtonClick);a("#mck-message-cell").on("click",".km-submit-person-detail",Kommunicate.richMsgEventHandler.handlleSubmitPersonDetail);a("#mck-message-cell").on("click",".km-block-room-button",Kommunicate.richMsgEventHandler.processBookRoomClick);a("#mck-message-cell").on("click",".km-quick-replies",Kommunicate.richMsgEventHandler.processQuickReplies);
a("#mck-message-cell").on("click",".km-list-item-handler",Kommunicate.richMsgEventHandler.processClickOnListItem);a("#mck-message-cell").on("click",".km-list-button-item-handler",Kommunicate.richMsgEventHandler.processClickOnButtonItem);a("#mck-message-cell").on("click",".km-faq-dialog-button",Kommunicate.richMsgEventHandler.processClickOnDialogButton)};
Kommunicate.richMsgEventHandler={initializeSlick:function(a){0<a.length&&tns({container:a[0],items:1,slideBy:"page",mouseDrag:!0,arrowKeys:!0,onInit:function(){console.log("tiny-slider initilized");document.querySelector(".km-slick-container .tns-controls button:first-child").innerHTML="\x3c";document.querySelector(".km-slick-container .tns-controls button:last-child").innerHTML="\x3e"}})},decrementGuestCount:function(a){a=a.target||a.srcElement;var f=a.dataset.type;"guest"==f?a.parentElement.getElementsByClassName("km-room-number-field")[0].stepDown():
"children"==f&&a.parentElement.getElementsByClassName("km-person-number-field")[0].stepDown()},incrementGuestCount:function(a){a=a.target||a.srcElement;var f=a.dataset.type;"guest"==f?a.parentElement.getElementsByClassName("km-room-number-field")[0].stepUp():"children"==f&&a.parentElement.getElementsByClassName("km-person-number-field")[0].stepUp()},decrementPersonCount:function(){document.getElementById("km-person-number-field").stepDown()},incrementPersonCount:function(){document.getElementById("km-person-number-field").stepUp()},
addMoreRoom:function(a){var f=a.target.parentElement.parentElement.parentElement,c=Number(a.target.dataset.roomcount)+1;a.target.setAttribute("data-roomcount",c);a=document.createElement("div");a.innerHTML=Kommunicate.markup.getSingleRoomPaxInfo(c);f.getElementsByClassName("km-room-person-selector-container")[0].appendChild(a)},processSelectedRoom:function(a){var f=[],c=$(a.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-room-number-field");a=
$(a.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-person-number-field");for(var n="",r=0;r<c.length;r++){var u=a[r].value,g=Array(1*u).fill(10);f.push({NoOfAdults:c[r].value,NoOfChild:u,ChildAge:g});n+="Room "+(r+1)+" Guest "+c[r].value+"\n"}f={message:n,metadata:{isRoomGuestJSON:!0,roomGuestJson:JSON.stringify(f),guestTypeId:"ADULTS"}};Kommunicate.sendMessage(f)},processHotelBookClick:function(a){a=a.target||a.srcElement;var f=a.dataset.sessionid,
c=a.dataset.resultindex;a={message:"Get room detail of "+a.dataset.name.replace("_"," "),metadata:{hotelSelected:!0,sessionId:f,resultIndex:c,skipDialogflow:!0}};Kommunicate.sendMessage(a)},processBookRoomClick:function(a){a=a.target||a.srcElement;var f=a.dataset.sessionid,c=a.dataset.roomindex,n=a.dataset.noofrooms,r=a.dataset.hotelresultindex;a={message:"Book "+("undefined"==a.dataset.hotelname?"":a.dataset.hotelname).replace("_"," "),metadata:{sessionId:f,RoomIndex:c,NoOfRooms:n,blockHotelRoom:!0,
skipDialogflow:!0,HotelResultIndex:r}};f=$applozic("#mck-message-cell .mck-message-inner");c=$applozic("#mck-msg-to");!0===f.data("isgroup")?a.groupId=c.val():a.to=c.val();$applozic.fn.applozic("sendGroupMessage",a)},handlleRichButtonClick:function(a){a=a.target||a.srcElement;"km-eh-001"==a.dataset.eventhandlerid&&a.parentElement.getElementsByClassName("km-btn-hidden-form")[0].submit()},handlleSubmitPersonDetail:function(a){var f=$applozic(a.target).closest(".km-guest-details-container").find(".km-title-select option:selected").text(),
c=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.km-age-input"),n=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.first-name-input"),r=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.middle-name-input"),u=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.last-name-input"),g=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.e-mail-input"),
k=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.number-input");""==n[0].value||""==u[0].value||""==g[0].value||""==k[0].value?$applozic(a.target).closest(".km-guest-details-container").find(".km-mandatory-field-error").removeClass("n-vis").addClass("vis"):(f={Title:"title"===f?"":f,Age:c[0].value,FirstName:n[0].value,MiddleName:r[0].value,LastName:u[0].value,EmailId:g[0].value,PhoneNo:k[0].value},a={message:f.Title+" "+f.FirstName+" "+f.LastName+"\n"+
f.EmailId+"\n"+f.PhoneNo,metadata:{sessionId:(a.target||a.srcElement).dataset.sessionid,guestDetail:!0,skipDialogflow:!0,personInfo:JSON.stringify(f)}},Kommunicate.sendMessage(a),console.log("passenger detail submitted"))},processQuickReplies:function(a){Kommunicate.sendMessage({message:a.target.title,metadata:{}})},processClickOnListItem:function(a){var f=a.currentTarget;a=f.dataset.reply;var c=f.dataset.type,n=f.dataset.articleid;f=f.dataset.source;c&&"quick_reply"==c&&Kommunicate.sendMessage({message:a,
metadata:{KM_FAQ_ID:n,source:f}})},processClickOnButtonItem:function(a){var f=a.currentTarget;a=f.dataset.reply;(f=f.dataset.type)&&"quick_reply"==f&&Kommunicate.sendMessage({message:a,metadata:{KM_BUTTON_CLICKED:!0}})},processClickOnDialogButton:function(a){Kommunicate.sendMessage({message:a.currentTarget.dataset.reply,metadata:{skipBot:!0}})}};
KommunicateUI={awayMessageInfo:{},isLeadCollectionEnabled:!1,CONSTS:{},populateAwayMessage:function(a,f){var c=$applozic("#mck-tab-individual").hasClass("n-vis");!a&&"SUCCESS"==f.code&&0<f.data.messageList.length&&!c?(KommunicateUI.isLeadCollectionEnabled=f.data.collectEmail,KommunicateUI.awayMessageInfo.isEnabled=!0,KommunicateUI.awayMessageInfo.eventId=f.data.messageList[0].eventId,awayMessage=f.data.messageList[0].message,$applozic("#mck-away-msg").html(awayMessage),$applozic("#mck-away-msg-box").removeClass("n-vis").addClass("vis")):
$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis")},hideAwayMessage:function(){$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis")},displayLeadCollectionTemplate:function(a){if(a&&a.length){for(var f=0,c=0;c<a.length&&(5!=a[c].type||(f++,2!=f));c++);1==f?KommunicateUI.isLeadCollectionEnabled&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId&&(this.populateLeadCollectionTemplate(),this.hideAwayMessage()):this.hideLeadCollectionTemplate()}else null==
a&&(this.populateLeadCollectionTemplate(),this.hideAwayMessage())},populateLeadCollectionTemplate:function(){$applozic("#mck-email-collection-box").removeClass("n-vis").addClass("vis");$applozic("#mck-btn-attach-box").removeClass("vis").addClass("n-vis");$applozic("#mck-text-box").blur();$applozic("#mck-text-box").attr("data-text","Your email ID")},hideLeadCollectionTemplate:function(){$applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis");$applozic("#mck-email-error-alert-box").removeClass("vis").addClass("n-vis");
$applozic("#mck-btn-attach-box").removeClass("n-vis").addClass("vis");$applozic("#mck-text-box").attr("data-text","Type your message...")},validateEmail:function(a){if(a.match(/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/))return $applozic("#mck-email-error-alert-box").removeClass("vis").addClass("n-vis"),this.hideLeadCollectionTemplate(),$applozic("#mck-away-msg-box").removeClass("n-vis").addClass("vis"),window.$applozic.fn.applozic("updateUser",
{data:{email:a}}),!0;$applozic("#mck-email-error-alert-box").removeClass("n-vis").addClass("vis");$applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis");return!1},faqEvents:function(a,f){var c;$applozic(d).on("click","#mck-msg-preview",function(){KommunicateUI.showChat()});$applozic(d).on("click",".km-faq-list",function(){$applozic("#km-faqanswer").empty();var c=$(this).attr("data-articleid"),r=$(this).attr("data-source");KommunicateKB.getArticle({data:{appId:a.appId,articleId:c,
source:r,helpdocsAccessKey:f},success:function(a){0==$applozic("#km-faqanswer .km-faqanswer-list").length&&($applozic("#km-faqanswer").append('\x3cdiv class\x3d"km-faqanswer-list km-faqanswerscroll"\x3e\x3cdiv class\x3d"km-faqquestion"\x3e'+a.data.title+'\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor km-faqanswer"\x3e'+a.data.body+"\x3c/div\x3e\x3c/div\x3e"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer").removeClass("n-vis").addClass("vis"),
$applozic("#mck-tab-individual").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-conversation").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"))},error:function(){}})});$applozic(d).on("click","#km-faq",function(){KommunicateUI.showHeader();$applozic("#km-contact-search-input-box").removeClass("n-vis").addClass("vis");$applozic("#km-faq").removeClass("vis").addClass("n-vis");$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis");
$applozic(".faq-common").removeClass("n-vis").addClass("vis");$applozic(".mck-conversation ").removeClass("vis").addClass("n-vis");$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis");$applozic(".mck-conversation-back-btn").removeClass("n-vis").addClass("vis");$applozic("#mck-tab-title").html("FAQ").removeClass("n-vis").addClass("vis");$applozic("#mck-away-msg-box").addClass("n-vis").removeClass("vis");$applozic("#mck-sidebox-ft").addClass("n-vis").removeClass("vis");$applozic("#mck-contacts-content").addClass("n-vis").removeClass("vis");
$applozic("#mck-msg-new").attr("disabled",!1)});$applozic(d).on("click","#km-faqanswer a",function(a){a.preventDefault();window.open(a.target.href)});$applozic("#km-faq-search-input").keydown(function(n){clearTimeout(c);c=setTimeout(function(){KommunicateKB.getArticles({data:{appId:a.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:f},success:function(a){a.data&&0===a.data.length&&$applozic(".km-no-results-found-container").hasClass("n-vis")?($applozic(".km-no-results-found-container").addClass("vis").removeClass("n-vis"),
$applozic(".km-talk-to-human-div p").text("We are here to help.")):($applozic(".km-no-results-found-container").addClass("n-vis").removeClass("vis"),$applozic(".km-talk-to-human-div p").text("Looking for something else? "));$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis");$applozic("#km-faqdiv").empty();$applozic.each(a.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cdiv class\x3d"km-faqimage"\x3e\x3c/div\x3e\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor"\x3e'+
c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")})},error:function(){}})},2E3);32!=n.which&&13!=n.which||KommunicateKB.getArticles({data:{appId:a.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:f},success:function(a){a.data&&0===a.data.length&&$applozic(".km-no-results-found-container").hasClass("n-vis")?($applozic(".km-no-results-found-container").addClass("vis").removeClass("n-vis"),$applozic(".km-talk-to-human-div p").text("We are here to help. ")):($applozic(".km-no-results-found-container").addClass("n-vis").removeClass("vis"),
$applozic(".km-talk-to-human-div p").text("Looking for something else? "));$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis");$applozic("#km-faqdiv").empty();$applozic.each(a.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cspan class\x3d"km-faqimage"/ \x3e\x3c/span\x3e \x3cdiv class\x3d"km-faqanchor "\x3e'+c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")})},
error:function(){}})});$applozic(d).on("click","#mck-conversation-back-btn",function(){$applozic(".km-kb-container").hasClass("vis")&&($applozic("#km-faqanswer").hasClass("vis")?(KommunicateUI.showHeader(),$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic("#km-contact-search-input-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1)):$applozic("#km-faqdiv").hasClass("vis")?($applozic("#mck-tab-individual").removeClass("vis").addClass("n-vis"),
$applozic("#mck-tab-conversation").removeClass("n-vis").addClass("vis"),$applozic(".faq-common").removeClass("vis").addClass("n-vis"),$applozic(".mck-conversation ").removeClass("n-vis").addClass("vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic(".km-talk-to-human-div").addClass("n-vis").removeClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1)):$applozic(".mck-conversation").hasClass("vis")&&($applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",
!1)))})},hideFaq:function(){$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis");$applozic(".km-faqdiv").removeClass("vis").addClass("n-vis");$applozic("#mck-msg-new").attr("disabled",!1)},showChat:function(){$applozic(".faq-common").removeClass("vis").addClass("n-vis");$applozic(".mck-conversation ").removeClass("n-vis").addClass("vis");$applozic("#km-faq").removeClass("n-vis").addClass("vis");$applozic("#mck-msg-new").attr("disabled",!1);$applozic("#mck-tab-conversation").hasClass("vis")},
showHeader:function(){$applozic("#mck-tab-individual").removeClass("n-vis").addClass("vis");$applozic("#mck-tab-conversation").removeClass("vis").addClass("n-vis");$applozic("#mck-msg-new").attr("disabled",!1)},sendFaqQueryAsMsg:function(a){var f=$applozic("#km-faq-search-input").val();""!==f&&$applozic.fn.applozic("sendGroupMessage",{groupId:a,type:5,contentType:0,message:'Hi, I have a query regarding \n"'+f+'"\n\n Can you help me out?'})}};
Kommunicate.postPluginInitialization=function(a,f){$applozic.fn.applozic("subscribeToEvents",{onMessageReceived:function(a){a=a&&a.message;var c=a.metadata&&"HIDDEN"!=a.metadata.category&&"true"!=a.metadata.hide;a.metadata&&!c||KommunicateUI.hideAwayMessage()}});KommunicateKB.init(Kommunicate.getBaseUrl());var c=KommunicateUtils.getDataFromKmSession("HELPDOCS_KEY");null==c||""==c?Kommunicate.client.getThirdPartySettings({appId:f.appId,type:1},function(a,r){a?console.log("err : ",a):r&&"SUCCESS"==
r.code&&((a=r.message.find(function(a){return a.type==KommunicateConstants.THIRD_PARTY_APPLICATION.HELPDOCS}))?(c=a.accessKey,KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY",a.accessKey)):KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY","null"),Kommunicate.helpdocsInitialization(f,c))}):Kommunicate.helpdocsInitialization(f,c)};
Kommunicate.helpdocsInitialization=function(a,f){"null"==f&&(f=null);KommunicateKB.getArticles({data:{appId:a.appId,query:"",helpdocsAccessKey:f},success:function(c){c.data&&0<c.data.length&&$applozic(".km-kb-container").hasClass("n-vis")&&$applozic(".km-kb-container").removeClass("n-vis").addClass("vis");$applozic.each(c.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cdiv class\x3d"km-faqimage"\x3e\x3c/div\x3e\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor"\x3e'+
c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")});KommunicateUI.faqEvents(a,f)},error:function(){}})};function RingToneService(){this.loadRingTone=function(a,f){return new Howl({src:[a],loop:f.loop})}};