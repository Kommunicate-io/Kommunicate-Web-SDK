!function(t){function n(t,n){var e=new google.maps.Map(t,n),o=new google.maps.Marker({position:new google.maps.LatLng(54.19335,-3.92695),map:e,title:"Drag Me",draggable:n.draggable});return{map:e,marker:o,circle:null,location:o.position,radius:n.radius,locationName:n.locationName,addressComponents:{formatted_address:null,addressLine1:null,addressLine2:null,streetName:null,streetNumber:null,city:null,district:null,state:null,stateOrProvince:null},settings:n.settings,domContainer:t,geodecoder:new google.maps.Geocoder}}function e(t){return void 0!=o(t)}function o(n){return t(n).data("locationpicker")}function i(t,n){if(t){var e=r.locationFromLatLng(n.location);t.latitudeInput&&t.latitudeInput.val(e.latitude).change(),t.longitudeInput&&t.longitudeInput.val(e.longitude).change(),t.radiusInput&&t.radiusInput.val(n.radius).change(),t.locationNameInput&&t.locationNameInput.val(n.locationName).change()}}function a(n,e){if(n){if(n.radiusInput&&n.radiusInput.on("change",function(n){n.originalEvent&&(e.radius=t(this).val(),r.setPosition(e,e.location,function(t){t.settings.onchanged.apply(e.domContainer,[r.locationFromLatLng(t.location),t.radius,!1])}))}),n.locationNameInput&&e.settings.enableAutocomplete){var o=!1;e.autocomplete=new google.maps.places.Autocomplete(n.locationNameInput.get(0)),google.maps.event.addListener(e.autocomplete,"place_changed",function(){o=!1;var t=e.autocomplete.getPlace();return t.geometry?void r.setPosition(e,t.geometry.location,function(t){i(n,t),t.settings.onchanged.apply(e.domContainer,[r.locationFromLatLng(t.location),t.radius,!1])}):void e.settings.onlocationnotfound(t.name)}),e.settings.enableAutocompleteBlur&&(n.locationNameInput.on("change",function(t){t.originalEvent&&(o=!0)}),n.locationNameInput.on("blur",function(a){a.originalEvent&&setTimeout(function(){var a=t(n.locationNameInput).val();a.length>5&&o&&(o=!1,e.geodecoder.geocode({address:a},function(t,o){o==google.maps.GeocoderStatus.OK&&t&&t.length&&r.setPosition(e,t[0].geometry.location,function(t){i(n,t),t.settings.onchanged.apply(e.domContainer,[r.locationFromLatLng(t.location),t.radius,!1])})}))},1e3)}))}n.latitudeInput&&n.latitudeInput.on("change",function(n){r.setPosition(e,new google.maps.LatLng(t(this).val(),e.location.lng()),function(t){t.settings.onchanged.apply(e.domContainer,[r.locationFromLatLng(t.location),t.radius,!1])})}),n.longitudeInput&&n.longitudeInput.on("change",function(n){r.setPosition(e,new google.maps.LatLng(e.location.lat(),t(this).val()),function(t){t.settings.onchanged.apply(e.domContainer,[r.locationFromLatLng(t.location),t.radius,!1])})})}}function l(t){google.maps.event.trigger(t.map,"resize"),setTimeout(function(){t.map.setCenter(t.marker.position)},300)}function s(n,e,o){var i=t.extend({},t.fn.locationpicker.defaults,o),l=i.location.latitude,s=i.location.longitude,c=i.radius,u=n.settings.location.latitude,d=n.settings.location.longitude,g=n.settings.radius;(l!=u||s!=d||c!=g)&&(n.settings.location.latitude=l,n.settings.location.longitude=s,n.radius=c,r.setPosition(n,new google.maps.LatLng(n.settings.location.latitude,n.settings.location.longitude),function(t){a(n.settings.inputBinding,n),t.settings.oninitialized(e)}))}var r={drawCircle:function(n,e,o,i){return null!=n.circle&&n.circle.setMap(null),o>0?(o*=1,i=t.extend({strokeColor:"#0000FF",strokeOpacity:.35,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.2},i),i.map=n.map,i.radius=o,i.center=e,n.circle=new google.maps.Circle(i),n.circle):null},setPosition:function(t,n,e){t.location=n,t.marker.setPosition(n),t.map.panTo(n),this.drawCircle(t,n,t.radius,{}),t.settings.enableReverseGeocode?t.geodecoder.geocode({latLng:t.location},function(n,o){o==google.maps.GeocoderStatus.OK&&n.length>0&&(t.locationName=n[0].formatted_address,t.addressComponents=r.address_component_from_google_geocode(n[0].address_components)),e&&e.call(this,t)}):e&&e.call(this,t)},locationFromLatLng:function(t){return{latitude:t.lat(),longitude:t.lng()}},address_component_from_google_geocode:function(t){for(var n={},e=t.length-1;e>=0;e--){var o=t[e];o.types.indexOf("postal_code")>=0?n.postalCode=o.short_name:o.types.indexOf("street_number")>=0?n.streetNumber=o.short_name:o.types.indexOf("route")>=0?n.streetName=o.short_name:o.types.indexOf("locality")>=0?n.city=o.short_name:o.types.indexOf("sublocality")>=0?n.district=o.short_name:o.types.indexOf("administrative_area_level_1")>=0?n.stateOrProvince=o.short_name:o.types.indexOf("country")>=0&&(n.country=o.short_name)}return n.addressLine1=[n.streetNumber,n.streetName].join(" ").trim(),n.addressLine2="",n}};t.fn.locationpicker=function(c,u){if("string"==typeof c){var d=this.get(0);if(!e(d))return;var g=o(d);switch(c){case"location":if(void 0==u){var m=r.locationFromLatLng(g.location);return m.radius=g.radius,m.name=g.locationName,m}u.radius&&(g.radius=u.radius),r.setPosition(g,new google.maps.LatLng(u.latitude,u.longitude),function(t){i(t.settings.inputBinding,t)});break;case"subscribe":if(void 0==u)return null;var p=u.event,f=u.callback;if(!p||!f)return console.error('LocationPicker: Invalid arguments for method "subscribe"'),null;google.maps.event.addListener(g.map,p,f);break;case"map":if(void 0==u){var v=r.locationFromLatLng(g.location);return v.formattedAddress=g.locationName,v.addressComponents=g.addressComponents,{map:g.map,marker:g.marker,location:v}}return null;case"autosize":return l(g),this}return null}return this.each(function(){var l=t(this);if(e(this))return void s(o(this),t(this),c);var u=t.extend({},t.fn.locationpicker.defaults,c),d=new n(this,{zoom:u.zoom,center:new google.maps.LatLng(u.location.latitude,u.location.longitude),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,disableDoubleClickZoom:!1,scrollwheel:u.scrollwheel,streetViewControl:!1,radius:u.radius,locationName:u.locationName,settings:u,draggable:u.draggable});l.data("locationpicker",d),google.maps.event.addListener(d.marker,"dragend",function(t){r.setPosition(d,d.marker.position,function(t){var n=r.locationFromLatLng(d.location);t.settings.onchanged.apply(d.domContainer,[n,t.radius,!0]),i(d.settings.inputBinding,d)})}),r.setPosition(d,new google.maps.LatLng(u.location.latitude,u.location.longitude),function(t){i(u.inputBinding,d),a(u.inputBinding,d),t.settings.oninitialized(l)})})},t.fn.locationpicker.defaults={location:{latitude:40.7324319,longitude:-73.82480777777776},locationName:"",radius:500,zoom:15,scrollwheel:!0,inputBinding:{latitudeInput:null,longitudeInput:null,radiusInput:null,locationNameInput:null},enableAutocomplete:!1,enableAutocompleteBlur:!1,enableReverseGeocode:!0,draggable:!0,onchanged:function(t,n,e){},onlocationnotfound:function(t){},oninitialized:function(t){}}}(jQuery);