!function(e){"undefined"==typeof KMCommonUtils?e.KMCommonUtils={ajax:function(e){var t,a=function(){for(var e=1;e<arguments.length;e++)for(var t in arguments[e])arguments[e].hasOwnProperty(t)&&(arguments[0][t]=arguments[e][t]);return arguments[0]}({},{},e),s=new XMLHttpRequest,o=!0;(void 0!==a.async||e.async)&&(o=a.async),"GET"===(e=a.type.toUpperCase())&&void 0!==a.data&&(a.url=a.url+"?"+a.data),s.open(e,a.url,o),"POST"!==e&&"GET"!==e||(o=void 0===a.contentType?"application/x-www-form-urlencoded; charset=UTF-8":a.contentType,s.setRequestHeader("Content-Type",o)),void 0===a.data?s.send():s.send(a.data),s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE)if(200===s.status){var e=s.getResponseHeader("Content-Type");void 0!==e&&"null"!==e&&null!==e||(e=""),t=-1!=e.toLowerCase().indexOf("text/html")?s.responseXML:-1!=e.toLowerCase().indexOf("application/json")?JSON.parse(s.responseText):s.responseText,a.success(t)}else a.error(t)}}}:console.log("KMCommonUtils already defined.")}(window),function(e){"undefined"==typeof Helpdocs?e.Helpdocs={getArticles:function(e){var t="https://api.helpdocs.io/v1/article?key="+e.data.helpdocsAccessKey;e.data.query&&(t="https://api.helpdocs.io/v1/search?key="+e.data.helpdocsAccessKey+"&query="+e.data.query);var a={};KMCommonUtils.ajax({url:t,async:void 0===e.async||e.async,type:"get",success:function(t){a.status="success",a.data=t,e.success&&e.success(a)},error:function(t,s,o){a.status="error",e.error&&e.error(a)}})},getArticle:function(e){var t={};KMCommonUtils.ajax({url:"https://api.helpdocs.io/v1/article/"+e.data.articleId+"?key="+e.data.helpdocsAccessKey,async:void 0===e.async||e.async,type:"get",success:function(a){t.status="success",t.data=a,e.success&&e.success(t)},error:function(a,s,o){t.status="error",e.error&&e.error(t)}})}}:console.log("Helpdocs already defined.")}(window),function(e){var t,a;"undefined"==typeof KommunicateKB?e.KommunicateKB=(a="https://api.kommunicate.io",(t={}).init=function(e){a=e},t.getArticles=function(e){try{var a=[];t.getFaqs({data:e.data,success:function(t){for(var s=0;s<t.data.length;s++){var o=t.data[s];a.push({articleId:o.id,title:o.name,description:o.content,status:o.status,body:o.content,source:"KOMMUNICATE"})}e.data.helpdocsAccessKey?Helpdocs.getArticles({data:e.data,success:function(t){t=t.data;for(var s=0;s<t.articles.length;s++){var o=t.articles[s];!0===o.is_published&&a.push({articleId:o.article_id,title:o.title,description:o.description,body:o.description,url:o.url,source:"HELPDOCS"})}e.success&&((t={status:"success"}).data=a,e.success(t))},error:function(t){a.length&&e.success?((t={status:"success"}).data=a,e.success(t)):e.error&&e.error(t)}}):e.success&&((t={status:"success"}).data=a,e.success(t))},error:function(t){"function"==typeof e.error&&e.err(t)}})}catch(t){e.error(t)}},t.getArticle=function(e){"HELPDOCS"==e.data.source?Helpdocs.getArticle({data:e.data,success:function(t){if(t={articleId:(t=t.data.article).article_id,title:t.title,description:t.description,body:t.body,url:t.url,source:"HELPDOCS"},e.success){var a={status:"success"};a.data=t,e.success(a)}},error:function(t){e.error(t)}}):t.getFaq({data:e.data,success:function(t){if(t={articleId:(t=t.data.data[0]).id,title:t.name,description:t.content,body:t.content,status:t.status,source:"KOMMUNICATE"},e.success){var a={status:"success"};a.data=t,e.success(a)}},error:function(t){e.error(t)}})},t.getFaqs=function(e){var t=a+"/kb/search?appId=:appId".replace(":appId",e.data.appId);e.data.query&&(t=t+"&query="+e.data.query);var s={};KMCommonUtils.ajax({url:t,async:void 0===e.async||e.async,type:"get",success:function(t){s.status="success",s.data=t.data,e.success&&e.success(s)},error:function(t,a,o){s.status="error",e.error&&e.error(s)}})},t.getFaq=function(e){var t={},s=a+"/kb/search?appId=:appId".replace(":appId",e.data.appId);e.data&&e.data.articleId&&(s+="&articleId="+e.data.articleId),KMCommonUtils.ajax({url:s,async:void 0===e.async||e.async,type:"get",success:function(a){t.status="success",t.data=a,e.success&&e.success(t)},error:function(a,s,o){t.status="error",e.error&&e.error(t)}})},t):console.log("KommunicateKB already defined.")}(window),Kommunicate="undefined"==typeof Kommunicate?{}:Kommunicate,Kommunicate.defaultLabels={"input.message":"Type your message...","conversations.title":"Conversations","start.new":"Start New Conversation","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online",offline:"Offline","clear.messages":"Clear Messages",delete:"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files & Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",hour:" hour",min:" min",yesterday:"yesterday",hours:" hours",mins:" mins","user.delete":"This user has been deleted",ago:"ago",admin:"Admin",user:"User",moderator:"Moderator",member:"Member",public:"Public",private:"Private",open:"Open",you:"You","closed.conversation.message":"This conversation has been marked as resolved. If you have other queries, just send a message here or start a new conversation.","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""},"lead.collection":{email:"Email",name:"Name",contactNumber:"Contact Number",heading:"Before starting, we just need a few details so that we may serve you better",submit:"Start Conversation"}},Kommunicate.client={getGroupDetailByType:function(e,t){var a="type="+e.type+"&startIndex="+e.startIndex+"&limit="+e.limit;$applozic.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:a,contentType:"application/json",success:function(e){t(null,e)},error:function(e){t(e)}})},createConversation:function(e,t){$applozic.fn.applozic("createGroup",{groupName:e.groupName,type:e.type,admin:e.agentId,users:e.users,clientGroupId:e.clientGroupId,isMessage:e.isMessage,isInternal:e.isInternal,metadata:{CREATE_GROUP_MESSAGE:"",REMOVE_MEMBER_MESSAGE:"",ADD_MEMBER_MESSAGE:"",JOIN_MEMBER_MESSAGE:"",GROUP_NAME_CHANGE_MESSAGE:"",GROUP_ICON_CHANGE_MESSAGE:"",GROUP_LEFT_MESSAGE:"",CONVERSATION_STATUS:0,DELETED_GROUP_MESSAGE:"",GROUP_USER_ROLE_UPDATED_MESSAGE:"",GROUP_META_DATA_UPDATED_MESSAGE:"",CONVERSATION_ASSIGNEE:e.assignee||e.agentId,KM_CONVERSATION_TITLE:e.groupName,HIDE:"true",SKIP_ROUTING:e.skipRouting?e.skipRouting:"false"},callback:function(e){console.log("response",e),"success"===e.status&&e.data.clientGroupId&&("function"==typeof t&&t(e.data.value),KommunicateUI.hideFaq())}})},getThirdPartySettings:function(e,t){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/integration/settings/"+e.appId+"?type="+e.type,type:"get",contentType:"application/json",success:function(e){t(null,e)},error:function(e){t(e)}})}},Kommunicate="undefined"==typeof Kommunicate?{}:Kommunicate,Kommunicate.conversationHelper={status:{INITIAL:-1,OPEN:0,PROGRESS:1,CLOSED:2,SPAM:3,DUPLICATE:4,ARCHIVE:5,UNRESPONDED:6},isConversationClosed:function(e){if(void 0!==e)return e.metadata&&e.metadata.CONVERSATION_STATUS==Kommunicate.conversationHelper.status.CLOSED}},Kommunicate="undefined"==typeof Kommunicate?{}:Kommunicate,Kommunicate.conversation={STATUS:Kommunicate.conversationHelper.status,processConversationOpenedFromList:function(e,t){if(t)console.log("Error received. can not post process the conversation ",t);else{var a=e&&e.groupFeeds[0];Kommunicate.conversationHelper.isConversationClosed(a)&&KommunicateUI.showClosedConversationBanner()}}},$applozic.extend(!0,Kommunicate,{getBaseUrl:function(){return KM_PLUGIN_SETTINGS.kommunicateApiUrl},setDefaultAgent:function(e){throw new Error("not implemented")},getConversationOfParticipent:function(e,t){if("function"!=typeof t)throw new Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");$applozic.ajax({url:Kommunicate.getBaseUrl()+"/conversations/participent/"+e.userId,type:"get",success:function(e){t(null,e)},error:function(e){t(e)}})},startConversation:function(e,t){(e="object"==typeof e?e:{}).agentId||e.agentIds||(e.agentId=KommunicateUtils.getDataFromKmSession("appOptions").agentId);var a=[{userId:"bot",groupRole:2}];if(e.agentIds)for(var s=0;s<e.agentIds.length;s++)a.push({userId:e.agentIds[s],groupRole:1});else a.push({userId:e.agentId,groupRole:1});if(e.botIds)for(s=0;s<e.botIds.length;s++)a.push({userId:e.botIds[s],groupRole:2});var o=e.conversationTitle||e.groupName||kommunicate._globals.conversationTitle||kommunicate._globals.groupName||kommunicate._globals.agentId,n=e.assignee||e.agentId,i={groupName:o,type:10,agentId:e.agentId,assignee:n,users:a,clientGroupId:e.clientGroupId,isMessage:e.isMessage,isInternal:e.isInternal,skipRouting:e.skipRouting};Kommunicate.client.createConversation(i,t)},openConversationList:function(){window.$applozic.fn.applozic("loadTab",""),KommunicateUI.showChat(),KommunicateUI.hideFaq()},openConversation:function(e){window.$applozic.fn.applozic("loadGroupTab",e),KommunicateUI.hideFaq()},openDirectConversation:function(e){window.$applozic.fn.applozic("loadTab",e),KommunicateUI.showChat(),KommunicateUI.hideFaq()},loadConversation:function(e,t){var a=(e.agentIds||[]).sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0});console.log("agent list ",a);var s=e.botIds||[];if(a.length<1){var o={code:"INVALID_PARAMETERS",message:"required parameter agentIds is missing."};return"function"==typeof t?t(o):console.log("required parameter agentIds is missing.")}var n=kommunicate._globals.userId||KommunicateUtils.getCookie("kommunicate-id"),i=a.join("_"),r=s.join("_"),c=encodeURIComponent(r?[i,n,r].join("_"):[i,n].join("_"));if(c.length>256){o={code:"MEMBER_LIMIT_EXCEEDS",message:"try adding fewer members"};return"function"==typeof t?t(o):console.log("member limit exceeds. try adding fewer members")}mckGroupService.getGroupFeed({clientGroupId:c,apzCallback:function(e){if("error"==e.status&&"AL-G-01"==e.code){var o=a.map(function(e){return{userId:e,groupRole:1}});o.push({userId:"bot",groupRole:2}),o.push(s.map(function(e){return{userId:e,groupRole:2}}));var n={groupName:kommunicate._globals.conversationTitle||kommunicate._globals.groupName||kommunicate._globals.agentId,type:10,agentId:o[0].userId,users:o,clientGroupId:decodeURIComponent(c)};Kommunicate.client.createConversation(n,function(e){if(t)return t(null,e)})}else if("success"==e.status){var i=e.data.id;return $applozic.fn.applozic("loadGroupTab",i),t(null,e)}}})},createGroupName:function(e){return e.sort().join().replace(/,/g,"_").substring(0,250)},openLastConversation:function(e){var t=e,a=[],s=[];if(s.push(e.agentId),s.push(kommunicate._globals.userId),a.push({userId:e.agentId,groupRole:1}),a.push({userId:"bot",groupRole:2}),e.botIds){console.log(e.botIds);for(var o=0;o<e.botIds.length;o++)a.push({userId:e.botIds[o],groupRole:2}),s.push(e.botIds[o])}var n=Kommunicate.createGroupName(s),i={};i.groupName=n,i.callback=function(e){e.data.groups.length>0?(console.log("already have a group"),Kommunicate.openConversation(e.data.groups[0].id)):(console.log("new user"),Kommunicate.startConversation(t,function(e){}))},window.$applozic.fn.applozic("getGroupListByFilter",i)},createNewConversation:function(e,t){if("function"!=typeof t)throw new Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");let a={groupId:e.groupId,participantUserId:e.participantUserId,createdBy:e.participantUserId,defaultAgentId:e.defaultAgentId,applicationId:e.applicationId};$applozic.ajax({url:Kommunicate.getBaseUrl()+"/conversations",type:"post",data:JSON.stringify(a),contentType:"application/json",success:function(e){console.log("conversation started successfully"),t(null,e)},error:function(e){console.log("err while starting Conversation"),t(e)}})},logout:function(e,t){void 0!==window.$kmApplozic&&void 0!==window.$kmApplozic.fn&&void 0!==window.$kmApplozic.fn.applozic&&window.$kmApplozic.fn.applozic("getLoggedInUser")&&window.$kmApplozic.fn.applozic("logout"),void 0!==window.$applozic&&void 0!==window.$applozic.fn&&void 0!==window.$applozic.fn.applozic&&window.$applozic.fn.applozic("getLoggedInUser")&&window.$applozic.fn.applozic("logout"),sessionStorage.clear(),localStorage.clear()},launchConversation:function(){window.$applozic.fn.applozic("mckLaunchSideboxChat")},triggerEvent:function(e,t){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/events?type="+e,type:"post",data:JSON.stringify({conversationId:t.groupId,applicationId:t.applicationId}),contentType:"application/json",success:function(e){console.log("conversation triggering event")},error:function(e){console.log("err while starting Conversation")}})},updateUser:function(e){var t={data:e};window.$applozic.fn.applozic("updateUser",t)},getAwayMessage:function(e,t){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/"+e.applicationId+"/awaymessage?conversationId="+e.conversationId,type:"get",contentType:"application/json",success:function(e){"function"==typeof t&&t(null,e)},error:function(e){console.log("err while fetching away message"),"function"==typeof t&&t(e)}})},updateUserIdentity:function(e){window.$applozic.fn.applozic("updateUserIdentity",{newUserId:e,callback:function(t){KommunicateUtils.setCookie("kommunicate-id",e),"success"==t&&window.$applozic.fn.applozic("reInitialize",{userId:e})}})},isRichTextMessage:function(e){return e&&300==e.contentType},appendEmailToIframe:function(e){if((Kommunicate.isRichTextMessage(e.metadata)||3==e.contentType)&&7===e.source){var t="km-iframe-"+e.groupId,a=document.getElementById(t),s=a.contentDocument||a.contentWindow.document;s.open(),s.write(e.message),s.close();for(var o=s.getElementsByTagName("a"),n=0;n<o.length;n++)o[n].setAttribute("target","_blank")}},isAttachment:function(e){return"object"==typeof e.fileMeta&&e.contentType==MESSAGE_CONTENT_TYPE.ATTACHMENT||e.contentType==MESSAGE_CONTENT_TYPE.LOCATION},getContainerTypeForRichMessage:function(e){var t=e.metadata;if(t.templateId)switch(t.templateId){case"2":case"4":return"km-slick-container";case"6":return"km-border-less-container";default:return"km-fixed-container"}else if(e.contentType==MESSAGE_CONTENT_TYPE.TEXT_HTML&&e.source==MESSAGE_SOURCE.MAIL_INTERCEPTOR)return"km-fixed-container"},processPaymentRequest:function(e){},sendMessage:function(e){var t=$applozic("#mck-message-cell .mck-message-inner"),a=$applozic("#mck-msg-to");!0===t.data("isgroup")?e.groupId=a.val():e.to=a.val();var s=Kommunicate.getSettings("KM_CHAT_CONTEXT"),o=e.metadata||{};s&&(o={KM_CHAT_CONTEXT:s}),e.metadata=o,$applozic.fn.applozic("sendGroupMessage",e)},getRichTextMessageTemplate:function(e){var t=e.metadata;if(!t.templateId)return e.contentType==MESSAGE_CONTENT_TYPE.TEXT_HTML&&e.source==MESSAGE_SOURCE.MAIL_INTERCEPTOR?Kommunicate.markup.getHtmlMessageMarkups(e):"";switch(t.templateId){case"1":return Kommunicate.markup.getHotelRoomPaxInfoTemplate();case"2":return Kommunicate.markup.getHotelCardContainerTemplate(JSON.parse(t.hotelList||"[]"),t.sessionId);case"3":return Kommunicate.markup.buttonContainerTemplate(t);case"5":return Kommunicate.markup.getPassangerDetail(t);case"4":return Kommunicate.markup.getRoomDetailsContainerTemplate(JSON.parse(t.hotelRoomDetail||"[]"),t.sessionId);case"6":return Kommunicate.markup.quickRepliesContainerTemplate(t);case"7":return Kommunicate.markup.getListContainerMarkup(t);case"8":return Kommunicate.markup.getDialogboxContainer(t);case"9":return Kommunicate.markup.getImageContainer(t);default:return""}},updateSettings:function(e){let t=typeof e;if("object"!=t)throw new error("update settings expects an object, found "+t);var a=KommunicateUtils.getDataFromKmSession("settings");for(var s in a=a?JSON.parse(a):{},e)a[s]=e[s];KommunicateUtils.storeDataIntoKmSession("settings",JSON.stringify(a))},getSettings:function(e){return KommunicateUtils.getSettings(e)}}),Kommunicate.markup={getSingleRoomPaxInfo:function(e){return'<div class = "km-single-pax-info">\n    <div class="km-room-title-text">ROOM '+(e=e||"1")+'</div>\n    <div class="km-room-selector">\n        <div>Guest :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div>\n        <div id= "">\n            <input class ="km-decrement-guest-count" type="button" value="-" data-type="guest">\n            <input type="number" min="1" max="5" value="1" class="km-room-number-field" maxlength="1" disabled>\n            <input class ="km-increment-guest-count" type="button" value="+" data-type="guest">\n        </div>\n    </div>\n    <div class="km-person-selector n-vis">\n        <div class="km-children-text-lable">Children :<span>(1-12 yrs)</span></div>\n        <div>\n            <input class ="km-decrement-guest-count" type="button" value="-" data-type="children">\n            <input type="number" min="0" max="2" value="0" class="km-person-number-field" maxlength="1" disabled >\n            <input class ="km-increment-guest-count" type="button" value="+" data-type="children">\n        </div> \n    </div>\n</div>'},getHotelCardTemplate:function(e,t){var a={star1:"km-star-empty",star2:"km-star-empty",star3:"km-star-empty",star4:"km-star-empty",star5:"km-star-empty"};if(e.StarRating)for(var s=0;s<e.StarRating;s++)a["star"+(s+1)]="km-star-filled";var o=("INR"==e.Price.CurrencyCode?"&#x20B9;":e.Price.CurrencyCode)+" "+Math.ceil(1*e.Price.OfferedPrice);return'\n    <div class="km-single-card-message">\n        <div class="km-card-message-header">\n            <div class="km-card-message-image-continer"><img class ="km-card-message-img" src ='+e.HotelPicture+' />\n                    <div class="km-card-message-image-price-container">'+o+'</div>\n            </div>\n        </div>\n        <div class="km-card-message-body">\n            <h1 class="km-card-message-body-title">'+e.HotelName+'</h1>\n            <div class="km-card-message-body-ratings">\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star1+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star2+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star3+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star4+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n                <span>\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24" class="'+a.star5+'">\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                        <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>\n                    </svg>\n                </span>\n            </div>\n            <div class="km-card-message-body-address">\n                <span class="km-card-message-body-address-icon">\n                    <svg xmlns="http://www.w3.org/2000/svg"  height="24" viewBox="0 0 24 24" width="24">\n                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>\n                        <path d="M0 0h24v24H0z" fill="none"/>\n                    </svg>\n                </span>'+e.HotelAddress+'\n            </div>\n        </div>\n        <div class="km-card-message-footer">\n            <button class="km-card-message-footer-button" data-resultindex= '+e.ResultIndex+" data-sessionid= "+t+" data-name= "+e.HotelName.replace(" ","_")+" > Get Room Details</button>\n        </div>\n    </div>"},getRoomDetailTemplate:function(e,t){let a="undefined"==e.NoOfGuest?1:e.NoOfGuest,s=e.DayRates.Amount?e.DayRates.Amount:e.Price.RoomPrice;return'<div class="km-single-card-message">\n                <div class="message received km-blocked-room">\n                    <div class="km-blocked-room-details">\n                    <div class="km-card-message-image-continer"><img class ="km-card-message-img" src='+e.HotelPicture+" alt="+e.HotelName+'></div>\n                        <div class="km-blocked-room-text-container">\n                            <div class="km-blocked-room-room-type">\n                                <span>Room Type: </span> <span> '+e.RoomTypeName+'</span>\n                            </div>\n                            <div class="km-blocked-room-guests">\n                                <span>Guests:</span><span>'+a+' </span>\n                            </div>\n                            <div class="km-blocked-room-price">\n                                <p>Price:<br><span>(Per Room Per Night)</span></p>\n\n                                <span>'+("INR"==e.Price.CurrencyCode?"&#x20B9;":e.Price.CurrencyCode)+" "+Math.ceil(s)+'</span>\n\n                            </div>\n                            <div class="km-blocked-room-sub-total">\n                                <p>Total:<br><span>(1 Room for '+e.NoOfNights+" Nights)</span></p>\n                                <span> "+("INR"==e.Price.CurrencyCode?"&#x20B9;":e.Price.CurrencyCode)+" "+Math.ceil(e.Price.RoomPrice)+' </span>\n                            </div>\n                        </div>\n                        <div class="km-blocked-room-button-container">\n                            <button class="km-block-room-button" data-sessionId= '+t+" data-roomIndex="+e.RoomIndex+" data-NoOfRooms="+e.NoOfRooms+" data-NoOfNights="+e.NoOfNights+" data-HotelName= "+e.HotelName.replace(" ","_")+" data-HotelResultIndex= "+e.HotelResultIndex+" >Book</button>\n                        </div>\n                    </div>\n                </div>\n            </div>"},getButtonTemplate:function(e,t,a){return"link"==e.type?'<button title= "'+e.replyText+'" class= "km-custom-widget-text-color km-cta-button km-add-more-rooms km-undecorated-link '+a+' "><a href ="'+e.url+'" target="_blank">'+e.name+"</a></button>":'<button title= "'+e.replyText+'" data-buttontype="submit" data-requesttype= "'+t+'" class="km-cta-button km-add-more-rooms '+a+' ">'+e.name+"</button>"},getQuickRepliesTemplate:function(){return'<div class="km-cta-multi-button-container">\n            {{#payload}}\n                 <button title=\'{{message}}\' class="km-cta-button km-add-more-rooms km-quick-replies km-custom-widget-border-color km-custom-widget-text-color {{elemWidthClass}}" data-metadata = "{{replyMetadata}}">{{title}}</button>\n            {{/payload}}\n            </div>'},getPassangerDetail:function(e){return e.sessionId||console.log("sessionId not present in message.."),'  <div class="km-guest-details-container km-rich-text-default-container">\n                <div class="km-guest-detail-form">\n                    <div class= "km-select-title">    \n                        <select name="title" class="km-title-select">\n                            <option value="0" disabled selected>Title *</option>\n                            <option value="Mr.">Mr.</option>\n                            <option value="Ms.">Ms.</option>\n                            <option value="Mrs.">Mrs.</option>\n                        </select>\n                    </div>\n                    <input type="number" name="age"  class="km-input km-age-input n-vis" placeholder="Age *" min="0" max="150">\n                    <input type="text" name="first-name"  class="km-input first-name-input km-pxinfo-btn-left" placeholder="First Name *"  required>\n                    <input type="text" name="middle-name"  class="km-input middle-name-input n-vis" placeholder="Middle Name (optional) ">\n                    <input type="text" name="last-name"  class="km-input last-name-input km-pxinfo-btn-left" placeholder="Last Name *"  required>\n                    <input type="email" name="email"  class="km-input e-mail-input km-pxinfo-btn-left" placeholder="Email Id *" required>\n                    <input type="text" name="contact-no"  class="km-input number-input km-pxinfo-btn-left" placeholder="Contact Number *" required >\n                    <div class= "km-mandatory-field-error n-vis"><span> All fields are mandatory.</span></div>\n                </div>\n                <div class="km-guest-button-container">\n                    <button class="km-add-more-rooms km-submit-person-detail" data-sessionid= '+e.sessionId+">Submit</button>\n                </div>\n            </div>\n            "},getListMarkup:function(){return'<div class="km-message km-received km-chat-faq-list" style="">\n     <div class="km-faq-list--container"  >\n             <div class="km-faq-list--header">\n                     {{{headerImgSrc}}}\n                     <div class="km-faq-list--header_text-container">\n                                     {{{headerText}}}\n                         </div>\n         </div>\n         <div class="km-faq-list--body">\n             <div class="km-faq-list--body_list-container">\n                 <ul class="km-faq-list--body_list {{elementClass}}">\n                     {{#elements}}\n                     <li class ={{hadlerClass}} data-type="{{dataType}}" data-reply = "{{dataReply}}" data-articleid= "{{dataArticleId}}" data-source="{{source}}"> <a href={{href}} target="_blank" class="km-undecorated-link km-custom-widget-text-color" >\n                             <div class="km-faq-list--body_img">\n                                     {{{imgSrc}}}\n                             </div>\n                         <div class="km-faq-list--body_que-ans">\n                                 <p class="km-faq-list--body_que km-custom-widget-text-color">\n                                     {{title}}\n                                 </p>\n                                 <p class="km-faq-list--body_ans">\n                                     \n                                 \n                                 {{{description}}}\n                                 </p>\n                             </div>\n                         </a>\n                     </li>\n                     {{/elements}}\n                 \n                 </ul>\n             </div>\n         </div>\n         <div class="km-faq-list--footer">\n                 <div class="km-faq-list--footer_button-container">\n                         {{#buttons}}\n                         <button class="km-cta-button km-custom-widget-border-color km-custom-widget-text-color km-add-more-rooms {{hadlerClass}}" data-type ="{{dataType}}" data-reply="{{dataReply}}"><a class ="km-undecorated-link km-custom-widget-text-color" href ="{{href}}" target="_blank">{{name}}</a></button>\n                         {{/buttons}}\n                     \n             </div>\n         </div>\n     </div>'},getDialogboxTemplate:function(){return'<div class="km-message km-received km-faq-answer">\n     <div class="km-faq-answer--container">\n         <div class="km-faq-answer--body">\n             <div class="km-faq-answer--body_container">\n                 <p class="km-faq-answer--body_que">{{title}}</p>\n                 <p class="km-faq-answer--body_ans"> {{{description}}} </p>\n             </div>\n         </div>\n         <div class="km-faq-answer--footer">\n             <div class="km-faq-answer--footer_button-text-container">\n                 <p>{{buttonLabel}}</p>\n                 {{#buttons}}\n                 <button class="km-faq-dialog-button km-quick-replies km-cta-button km-add-more-rooms" data-reply="{{name}}" data-metadata ="{{replyMetadata}}">{{name}}</button>\n                {{/buttons}}\n             </div>\n         </div>\n     </div>\n </div>'},getImageTemplate:function(){return'<div>\n    {{#payload}}\n    <div class="km-image-template">\n       <img class="km-template-img" src="{{url}}"></img>\n       <div class="km-template-image-caption-wrapper">\n           <p class="km-template-img-caption">{{caption}}</p>\n       </div>\n   </div>\n   {{/payload}}\n   </div>'}},Kommunicate.markup.buttonContainerTemplate=function(e){for(var t='<div class="km-cta-multi-button-container">',a=JSON.parse(e.payload),s=a?JSON.parse(e.formData||"{}"):"",o=1==a.length?"km-cta-button-1 km-custom-widget-border-color km-custom-widget-text-color":2==a.length?"km-cta-button-2 km-custom-widget-border-color km-custom-widget-text-color":"km-cta-button-many km-custom-widget-border-color km-custom-widget-text-color",n=e.requestType,i=0;i<a.length;i++)t+=Kommunicate.markup.getButtonTemplate(a[i],n,o);if(s){for(var r in t+="<form method ='post'  target='_blank' class= 'km-btn-hidden-form' action ="+e.formAction+">",s)s.hasOwnProperty(r)&&(t+='<input type="hidden" name ="'+r+'" value="'+s[r]+'" />');t+="</form>"}return t+="</div>"},Kommunicate.markup.quickRepliesContainerTemplate=function(e){for(var t=JSON.parse(e.payload),a=1==t.length?"km-cta-button-1":2==t.length?"km-cta-button-2":"km-cta-button-many",s=0;s<t.length;s++)t[s].replyMetadata="object"==typeof t[s].replyMetadata?JSON.stringify(t[s].replyMetadata):t[s].replyMetadata,t[s].elemWidthClass=a;return Mustache.to_html(Kommunicate.markup.getQuickRepliesTemplate(),{payload:t})},Kommunicate.markup.getHotelRoomPaxInfoTemplate=function(e){return'<div class = "km-rich-text-default-container">\n            <div class="km-room-person-selector-container">'+Kommunicate.markup.getSingleRoomPaxInfo(e)+'</div>\n            <hr>\n            <div class="km-add-room-button-container">\n                <button  class="km-add-more-rooms km-btn-add-more-rooms" data-roomcount=1>ADD ROOM</button>\n                <button class=" km-add-more-rooms km-done-button">DONE</button>\n            </div>\n        </div>'},Kommunicate.markup.getHotelCardContainerTemplate=function(e,t){for(var a="",s=0;s<e.length;s++)a+=Kommunicate.markup.getHotelCardTemplate(e[s],t);return'<div class="km-card-message-container  km-div-slider">'+a+"</div>"},Kommunicate.markup.getRoomDetailsContainerTemplate=function(e,t){let a=e.HotelRoomsDetails;for(var s="",o=0;o<a.length;o++)s+=Kommunicate.markup.getRoomDetailTemplate(a[o],t);return'<div class="km-card-room-detail-container  km-div-slider">'+s+"</div>"},Kommunicate.markup.getListContainerMarkup=function(e){if(e&&e.payload){var t=JSON.parse(e.payload);return t.headerImgSrc&&(t.headerImgSrc='<div class="km-faq-list--header_text-img"><img src= "'+t.headerImgSrc+'"  alt = "image" /></div>'),t.headerText&&(t.headerText='<p class="km-faq-list--header_text">'+t.headerText+"</p>"),t.elements&&t.elements.length?(t.elementClass="vis",t.elements=t.elements.map(function(e){return e.imgSrc&&(e.imgSrc='<img src ="'+e.imgSrc+'" />'),e.action&&"link"==e.action.type?e.href=e.action.url:(e.href="javascript:void(0)",e.hadlerClass="km-list-item-handler"),e.action&&(e.dataType=e.action.type||"",e.dataReply=e.action.text||e.title||""),e.dataArticleId=e.articleId||"",e.dataSource=e.source||"",e})):t.elementClass="n-vis",t.buttons&&t.buttons.length&&(t.buttons=t.buttons.map(function(e){return e.action&&"quick_reply"!=e.action.type&&"submit"!=e.action.type?e.href=e.action.url:(e.href="javascript:void(0)",e.hadlerClass="km-list-button-item-handler"),e.dataType=e.action?e.action.type:"",e.dataReply=e.action&&e.action.text?e.action.text:e.name||"",e})),Mustache.to_html(Kommunicate.markup.getListMarkup(),t)}return""},Kommunicate.markup.getDialogboxContainer=function(e){if(e&&e.payload){var t=JSON.parse(e.payload);return t.buttons.length>0&&t.buttons.forEach(function(e){e.replyMetadata="object"==typeof e.replyMetadata?JSON.stringify(e.replyMetadata):e.replyMetadata}),Mustache.to_html(Kommunicate.markup.getDialogboxTemplate(),t)}return""},Kommunicate.markup.getImageContainer=function(e){if(e&&e.payload){let t="string"==typeof e.payload?JSON.parse(e.payload):{};return e.payload=t,Mustache.to_html(Kommunicate.markup.getImageTemplate(),e)}return""},Kommunicate.markup.getHtmlMessageMarkups=function(e){return e&&e.source==MESSAGE_SOURCE.MAIL_INTERCEPTOR?"<iframe class='km-mail-fixed-view' id="+("km-iframe-"+e.groupId)+" ></iframe>":""},Kommunicate.messageTemplate={getAttachmentTemplate:function(){return'<div class="mck-file-text mck-attachment {{attachmentClass}} notranslate mck-attachment-{{key}}" data-groupId="{{groupId}}" data-filemetakey="{{fileMetaKey}}" data-stopupload="{{fileMeta.stopUpload}}" data-filename="{{fileMeta.name}}" data-thumbnailUrl="{{fileMeta.thumbnailUrl}}"  data-filetype="{{fileMeta.contentType}}" data-fileurl="{{fileUrl}" data-filesize="{{fileMeta.size}}+" data-msgkey ="{{key}}"><div>{{{fileExpr}}}</div><div class="{{attachmentDownloadClass}}">{{{downloadMediaUrlExpr}}}</div></div>'},getProgressMeter:function(e){return'<div class="km-progress-meter-container km-progress-meter-back-drop progress-meter-{{key}}"><svg class="km-progress-svg" xmlns="http://www.w3.org/2000/svg" width="55" height="55" viewBox="0 0 107 105"><g class="km-progress-icons"><circle class="km-progress-meter" cx="54" cy="54" r="45" stroke-width="10" /><circle class="km-progress-value" cx="54" cy="54" r="45" stroke-width="5" /><path class="km-progress-stop-upload-icon km-progress-stop-upload-icon-{{key}} vis" d="M51.5,47.9L32.3,28.7c-1.3-1.3-2.3-1.3-3.6,0c-1.3,1.3-0.3,3.3,1,4.6c0,0,0,0,0,0l19.1,19.1   c0.8,0.8,0.8,2.2,0,3.1L29.7,74.7c-1.3,1.3-2.4,3.4-1,4.6c1.8,1.5,2.7,0.6,3.6,0c0,0,1-1,1-1l19.1-19.1c0.8-0.8,2.6-1,3.4-0.1   l19.8,20.3c1.3,1.3,2.3,1.3,3.6,0c1.3-1.3,0.3-3.3-1-4.6L59.1,55.5c-0.8-0.8-0.8-2.2,0-3.1l19.1-19.1c1.3-1.3,2.3-3.3,1-4.6   c-1.3-1.3-3.3-0.3-4.6,1L56.4,48C55.5,48.9,52.3,48.7,51.5,47.9L51.5,47.9z" fill="#FFF" data-name="Path 1"/><path class="km-progress-upload-icon km-progress-upload-icon-{{key}} n-vis" d="M52.246 21.547L30.00689 43.78339a3.2 3.2 0 0 0-.03927 4.4858l.03047.03155a3.2 3.2 0 0 0 4.56449.03994L51.286 31.619v53.712a3.2 3.2 0 0 0 3.2 3.2 3.2 3.2 0 0 0 3.2-3.2V31.619l16.72045 16.72131a3.2 3.2 0 0 0 4.56467-.03976l.03029-.03136a3.2 3.2 0 0 0-.03927-4.4858L56.723 21.547l-.06168-.05724a3.2 3.2 0 0 0-4.3542.00048z" fill="#FFF"/></g></svg></div>'},getAttachmentContanier:function(e,t){var a=new AlFileService;let s=a.getFileurl(e);return e.downloadMediaUrlExpr=a.getFileAttachment(e),e.fileExpr=t,e.fileUrl=s,"object"==typeof e.fileMeta&&(e.attachmentClass=1!=e.fileMeta.contentType.indexOf("image/")||-1!=e.fileMeta.contentType.indexOf("audio/")||1!=e.fileMeta.contentType.indexOf("video/")?"":"mck-msg-box",e.attachmentDownloadClass=-1!=e.fileMeta.contentType.indexOf("image/")?"n-vis":"vis"),Mustache.to_html(Kommunicate.messageTemplate.getAttachmentTemplate(),e)},getProgressMeterContanier:function(e){let t={key:e};return Mustache.to_html(Kommunicate.messageTemplate.getProgressMeter(),t)}},Kommunicate.initilizeEventListners=function(){w.addEventListener("online",function(){Kommunicate.internetStatus=!0}),w.addEventListener("offline",function(){Kommunicate.internetStatus=!1})},Kommunicate.attachmentService={getFileMeta:function(e,t,a){let s={groupId:t,contentType:1,type:5,message:""};var o=new FileReader;o.onload=function(e){return function(t){document.createElement("span").innerHTML=['<img class="thumb" src="',t.target.result,'" title="',escape(e.name),'"/>'].join("")}},o.onloadend=function(){FILE_META=[],FILE_META.push({thumbnailUrl:o.result,contentType:e.type,isUploaded:!1,contentType:e.type,stopUpload:!1}),"function"!=typeof a||a(FILE_META,s,e)},o.readAsDataURL(e)},uploadAttachment:function(e,t,a){data={params:e,messagePxy:t},$applozic.fn.applozic("uploadAttachemnt",data)}};var MCK_TRIGGER_MSG_NOTIFICATION_PARAM,MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[],MCK_EVENT_HISTORY=[],KM_PROGRESS_METER_RADIUS=54,KM_PROGRESS_METER_CIRCUMFERENCE=2*Math.PI*KM_PROGRESS_METER_RADIUS,count=0,isFirstLaunch=!0,KM_PENDING_ATTACHMENT_FILE=new Map;const MESSAGE_SOURCE={DEVICE:0,WEB:1,ANDROID:2,IOS:3,PLATFORM:4,DESKTOP_BROWSER:5,MOBILE_BROWSER:6,MAIL_INTERCEPTOR:7},MESSAGE_CONTENT_TYPE={DEFAULT:0,ATTACHMENT:1,LOCATION:2,TEXT_HTML:3,PRICE:4,IMAGELINK:5,HYPERLINK:6,CONTACT:7,AUDIO:8,VIDEO:9,NOTIFY_MESSAGE:10,HIDDEN_MESSAGE:11,RECEIVER_ONLY:12,BLOCK_NOTIFY_MESSAGE:13,AUDIO_VIDEO_CALL:102,MISSED_CALL:103};!function(t,a,s){"use strict";a.applozic||(a.applozic=a.applozic?a.applozic:{},t.extend(!0,a.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var o={baseUrl:KM_PLUGIN_SETTINGS.applozicBaseUrl||"https://chat.kommunicate.io",fileBaseUrl:"https://applozic.appspot.com",customFileUrl:"https://googleupload.applozic.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",launcher:"applozic-launcher",emojilibrary:!1,userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,unreadCountOnchatLauncher:!0,groupUserCount:!1,desktopNotification:!0,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,groupName:"Conversations",agentId:"",agentName:"",msgTriggerTimeout:0,labels:Kommunicate.defaultLabels,useBranding:!0,openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},n={messageType:5,type:0};t.fn.applozic=function(i,r,c){var l=t("#mck-sidebox");"object"===t.type(i)&&(KommunicateUtils.storeDataIntoKmSession("appOptions",i),(i=t.extend(!0,{},o,i)).conversationTitle=i.conversationTitle||i.groupName,i.accessToken=i.password||i.accessToken);var d=void 0;if(void 0!==l.data("applozic_instance"))if(d=l.data("applozic_instance"),"string"===t.type(i))switch(i){case"reInitialize":return d.reInit(r);case"loadConvTab":d.loadConvTab(r);break;case"loadTab":d.loadTab(r,c);break;case"uploadFile":d.uploadFile(r);break;case"uploadAttachemnt":d.uploadAttachemnt(r);break;case"loadTabView":d.loadTabView(r);break;case"loadChat":d.loadChat(r);break;case"loadContextualTab":return d.loadTabWithTopic(r);case"audioAttach":d.audioAttach(r);break;case"addWelcomeMessage":d.addWelcomeMessage(r);break;case"loadContacts":d.loadContacts(r);break;case"sendMessage":return d.sendMessage(r);case"sendGroupMessage":return d.sendGroupMessage(r);case"createGroup":return d.createGroup(r);case"loadBroadcastTab":case"initBroadcastTab":return r.groupName=r.groupName?r.groupName:"Broadcast",r.type=5,d.initGroupTab(r);case"initGroupTab":return d.initGroupTab(r);case"loadGroupTab":return d.loadGroupTab(r,c);case"loadGroupTabByClientGroupId":return d.loadGroupTabByClientGroupId(r);case"setOffline":case"setOnline":return d.setOffline(),"success";case"logout":return d.logout(),"success";case"reset":d.reset(r);break;case"getUserDetail":return d.getUserStatus(r),"success";case"getGroupList":return d.getGroupList(r),"success";case"leaveGroup":return d.leaveGroup(r);case"addGroupMember":return d.addGroupMember(r);case"removeGroupMember":return d.removeGroupMember(r);case"updateGroupInfo":return d.updateGroupInfo(r);case"getMessages":d.getMessages(r);break;case"messageList":return d.getMessageList(r);case"getMessageListByTopicId":return d.getMessageListByTopicId(r);case"getTotalUnreadCount":return d.getTotalUnreadCount();case"subscribeToEvents":return d.subscribeToEvents(r);case"getConversation":return d.getConversation(r);case"loadConversationWithAgent":return d.loadConversationWithAgent(r);case"updateUserIdentity":return d.updateUserIdentity(r);case"updateUser":return d.updateUser(r);case"getGroupListByFilter":return d.getGroupListByFilter(r);case"updateMessageMetadata":return d.updateMessageMetadata(r);case"mckLaunchSideboxChat":return d.mckLaunchSideboxChat();case"triggerMsgNotification":return d.triggerMsgNotification();case"openChat":return d.openChat(r);case"submitMessage":return d.submitMessage(r)}else"object"===t.type(i)&&d.reInit(i);else if("object"===t.type(i))if(i.userId&&i.appId&&""!==t.trim(i.userId)&&""!==t.trim(i.appId))if(void 0!==l.data("applozic_instance"))(d=l.data("applozic_instance")).reInit(i);else{if(void 0!==i.ojq?($=i.ojq,jQuery=i.ojq):($=t,jQuery=t),"function"==typeof i.obsm)$.fn.modal=i.obsm,jQuery.fn.modal=i.obsm;else if("function"==typeof t.fn.modal){var m=t.fn.modal.noConflict();$.fn.modal=m,jQuery.fn.modal=m}else if("function"==typeof $.fn.modal){m=$.fn.modal.noConflict();$.fn.modal=m,jQuery.fn.modal=m}"function"==typeof i.omckm?t.fn.mckModal=i.omckm:"function"==typeof t.fn.mckModal?t.fn.mckModal=t.fn.mckModal.noConflict():"function"==typeof $.fn.mckModal&&(t.fn.mckModal=$.fn.mckModal.noConflict()),"function"==typeof $.fn.linkify?(t.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"==typeof t.fn.linkify&&($.fn.linkify=t.fn.linkify,jQuery.fn.linkify=t.fn.linkify),"function"==typeof $.fn.emojiarea?t.fn.emojiarea=$.fn.emojiarea:"function"==typeof t.fn.emojiarea&&($.fn.emojiarea=t.fn.emojiarea,jQuery.fn.emojiarea=t.fn.emojiarea),"function"==typeof $.fn.locationpicker?t.fn.locationpicker=$.fn.locationpicker:"function"==typeof t.fn.locationpicker&&($.fn.locationpicker=t.fn.locationpicker,jQuery.fn.locationpicker=t.fn.locationpicker);var p=new function(i){var r,c,l=this;MCK_GROUP_MAP=[];var d,m,p=[],u=!0,v=[],g=0;MCK_CLIENT_GROUP_MAP=[];var f=!1,k=[],C=[],h=90,b=[],y=[],I=[],M=[],T=!0,E=0,S=i.widgetSettings,x=i.emojilibrary,L=i.mode;MCK_LABELS=i.labels,MCK_BASE_URL=i.baseUrl;var A,_=i.customFileUrl,w=i.customUploadUrl,U=i.appId,K=[],G=[0,1,2,3],N=[1,2,5,6,10],O=[],R=!1,D=i.launcher,z=i.visitor,B=i.userName,P=i.locShare,F=i.video,$=i.fileBaseUrl,q=i.onInit,H=i.onTopicDetails,j=[0,1,2],V=i.onClose,Y=i.displayText,W=i.password||i.accessToken,J=i.readConversation,Z=i.maxGroupSize,Q=i.onTabClicked,X=i.contactNumber,ee=i.maxAttachmentSize,te=i.appModuleName,ae=i.getTopicDetail,se=i.contactDisplayName,oe=i.validateMessage,ne=i.finalPriceResponse,ie=i.contactDisplayImage,re=i.priceWidget,ce=i.openGroupSettings,le=i.offlineMessageDetail,de=(i.initAutoSuggestions,i.authenticationTypeId),me=i.getConversationDetail,pe=i.notificationIconLink,ue=i.mapStaticAPIkey,ve=i.unreadCountOnchatLauncher,ge=i.chatLauncherHtml,fe=i.fileupload,ke=i.notificationSoundLink?i.notificationSoundLink:Kommunicate.getBaseUrl()+"/plugin/audio/notification_tone.mp3",Ce=z?"guest":t.trim(i.userId),he=P?i.googleApiKey:"NO_ACCESS",be=void 0===i.source?1:i.source,ye="boolean"==typeof i.topicBox&&i.topicBox,Ie="boolean"==typeof i.olStatus&&i.olStatus,Me="boolean"!=typeof i.messageBubbleAvator||i.messageBubbleAvator,Te="boolean"==typeof i.showOfflineMessage&&i.showOfflineMessage,Ee="boolean"==typeof i.hideGroupSubtitle&&i.hideGroupSubtitle,Se=void 0===i.defaultMessageMetaData?{}:i.defaultMessageMetaData,xe="boolean"==typeof i.groupUserCount&&i.groupUserCount,Le="boolean"==typeof i.checkUserBusyWithStatus&&i.checkUserBusyWithStatus,Ae="boolean"==typeof i.resetUserStatus&&i.resetUserStatus,_e="boolean"==typeof i.topicHeader&&i.topicHeader,we=(i.supportId&&i.supportId,"boolean"==typeof i.loadOwnContacts&&i.loadOwnContacts),Ue="boolean"!=typeof i.desktopNotification||i.desktopNotification,Ke="boolean"!=typeof i.notification||i.notification,Ge=("boolean"==typeof i.swNotification&&i.swNotification,"boolean"!=typeof i.autoTypeSearchEnabled||i.autoTypeSearchEnabled),Ne="boolean"==typeof i.launchOnNewMessage&&i.launchOnNewMessage,Oe="boolean"==typeof i.launchOnUnreadMessage&&i.launchOnUnreadMessage,Re="number"==typeof i.userTypeId&&i.userTypeId,De=["DEFAULT","NEW","OPEN"],ze=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],Be="number"==typeof i.msgTriggerTimeout?i.msgTriggerTimeout:0,Pe=new Object,Fe=new Array,$e=new Array,qe=new Object,He=new Array,je=new Array,Ve=new Array,Ye=new Array,We=new function(){var e,o,n=this,i=!1,l=t("#mck-file-menu"),p=t("#mck-message-cell .mck-message-inner"),v=(t("#mck-tab-individual"),h);n.getLauncherHtml=function(e){var t=lt.customSideboxWidget(),a='<div id="launcher-svg-container" class="vis" style ="white-space: nowrap;">\n                '+ge+"\n                </div>";return e?'<a href="#" target="_self">'+(ge?a:t)+"</a>":'<div id="mck-sidebox-launcher" class="mck-sidebox-launcher launchershadow"><a href="#" target="_self" class="applozic-launcher">'+(ge?a:t)+'<div id="launcher-agent-img-container"></div></a><div id="applozic-badge-count" class="applozic-badge-count"></div><div id="mck-msg-preview-visual-indicator" class="mck-msg-preview-visual-indicator-container n-vis"><div class="mck-close-btn-container"><div class="mck-close-btn"><span class="mck-close-icon-svg"><svg xmlns="http://www.w3.org/2000/svg" width="10" height="10"><g fill="none" fill-rule="evenodd" stroke="#FFF" stroke-linecap="round"><path d="M1.0262069.0262069l7.9475862 7.9475862M8.9737931.0262069L1.0262069 7.9737931"/></g></svg></span><span class="mck-close-text">Close</span></div></div><div class="mck-msg-preview-visual-indicator-text  applozic-launcher"></div></div></div><div id="mck-msg-preview" class="mck-msg-preview applozic-launcher"><div class="mck-row"><div class="blk-lg-3 mck-preview-icon"></div><div class="blk-lg-9"><div class="mck-row mck-truncate mck-preview-content"><strong class="mck-preview-cont-name"></strong></div><div class="mck-row mck-preview-content"><div class="mck-preview-msg-content"></div><div class="mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"></div></div></div></div><div id="mck-msg-preview-btns" class="n-vis"><button id="mck-vid-call-accept">Accept</button><button id="mck-vid-call-reject">reject</div></div>'},n.initializeApp=function(e,a){i=a;var s={applicationId:e.appId,userId:Ce};null!==B&&(s.displayName=e.userName),null!==e.email&&(s.email=e.email),null!==X&&(s.contactNumber=e.contactNumber),e.imageLink&&(s.imageLink=e.imageLink),e.appModuleName&&(s.appModuleName=e.appModuleName),W&&(s.password=e.accessToken),-1===j.indexOf(de)&&(de=0),Ae&&(s.resetUserStatus=!0),"number"==typeof Re&&(s.userTypeId=Re),e.metadata&&(s.metadata=e.metadata),s.enableEncryption=!0,s.appVersionCode=108,s.deviceType=0,s.authenticationTypeId=de,s.chatNotificationMailSent=!0,c="",d="";var o=n.validateAppSession(s);if(o)F&&vt.InitilizeVideoClient(Ce,d);else{var r={name:"km-userName",email:"km-email",phone:"km-contact"};if(Array.isArray(ht)&&0!==ht.length){if(t("#km-userId").val(Ce),ht.length>0)for(var l=0;l<ht.length;l++)t("#"+r[ht[l]]).removeClass("n-vis").addClass("vis"),t("#"+r[ht[l]]).prop("required",!0);var m=document.getElementById("km-chat-login-modal");m.style.visibility="visible",m.style.display="none",t("#km-anonymous-chat-launcher").append(We.getLauncherHtml(!0)),n.setLeadCollectionLabels();var p=document.getElementById("km-anonymous-chat-launcher");p.classList.remove("n-vis"),p.classList.add("vis"),document.getElementById("km-modal-close").addEventListener("click",function(e){e.preventDefault(),m.style.display="none",p.classList.remove("n-vis"),p.classList.add("vis")}),p.addEventListener("click",function(e){e.preventDefault(),m.style.display="block",p.classList.remove("vis"),p.classList.add("n-vis")}),document.getElementById("km-tab-title").innerHTML=e.conversationTitle,t("#km-form-chat-login .km-form-group input").hasClass("n-vis")&&t("#km-form-chat-login .km-form-group .km-form-control.n-vis").prop("required",null)}else n.initialize(s)}},n.initialize=function(e){window.Applozic.ALApiService.login({data:{alUser:e,baseUrl:MCK_BASE_URL},success:function(a){F&&vt.InitilizeVideoClient(a.userId,a.deviceKey),"kommunicate"==window.applozic.PRODUCT_ID&&t("#km-chat-login-modal").css("display","none"),ALStorage.clearMckMessageArray(),ALStorage.clearMckContactNameArray(),"INVALID_PASSWORD"!==a?"INVALID_APPID"!==a?"error"!==a&&"USER_NOT_FOUND"!==a?"APPMODULE_NOT_FOUND"!==a?"object"==typeof a&&null!==a&&a.token?(a.appId=e.applicationId,W&&(a.accessToken=e.password),n.onInitApp(a)):"function"==typeof q&&q({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"}):"function"==typeof q&&q({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"function"==typeof q&&q({status:"error",errorMessage:"USER NOT FOUND"}):"function"==typeof q&&q({status:"error",errorMessage:"INVALID APPLICATION ID"}):"function"==typeof q&&q({status:"error",errorMessage:"INVALID PASSWORD"})},error:function(){ALStorage.clearMckMessageArray(),"function"==typeof q&&q({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})},n.shouldBrandingIncluded=function(e){return!e||!e.pricingPackage||Mt&&e.pricingPackage!==KommunicateConstants.PRICING_PACKAGE.ENTERPRISE_MONTHLY&&KommunicateConstants.PRICING_PACKAGE.ENTERPRISE_YEARLY},n.onInitApp=function(e){var s=t("#mck-sidebox");if(n.appendLauncher(),n.setLabels(),t(".applozic-launcher").each(function(){t(this).hasClass("mck-msg-preview")||t(this).show()}),r=e.token,Je.setEncryptionKey(e.encryptionKey),Ce=e.userId,e.countryCode,d=e.deviceKey,m=e.websocketUrl,h=e.websocketIdleTimeLimit,e.timeZoneOffset,$=e.fileBaseUrl,R=e.deactivated,c=btoa(e.userId+":"+e.deviceKey),window.Applozic.ALApiService.setAjaxHeaders(c,U,d,W,te),E=e.totalUnreadCount,Je.badgeCountOnLaucher(ve,E),e.connectedClientCount,z||"guest"===Ce||"0"===Ce||"C0"===Ce||(i?Tt.reconnect():Tt.init()),st.createContactWithDetail({userId:Ce,displayName:e.displayName,photoLink:e.imageLink}),t.ajaxPrefilter(function(e){e.beforeSend||-1===e.url.indexOf(MCK_BASE_URL)||(e.beforeSend=function(e){n.setHeaders(e)})}),n.shouldBrandingIncluded(e)){var o="https://www.kommunicate.io/?utm_source="+a.location.href+"&utm_medium=webplugin&utm_campaign=poweredby";t(".mck-running-on a").attr("href",o),t(".mck-running-on").removeClass("n-vis").addClass("vis")}var l=ALStorage.getMckContactNameArray();if(null!==l&&l.length>0)for(var p=0;p<l.length;p++){var u=l[p];null!==u&&(He[u[0]]=u[1])}pt.checkUserConnectedStatus(function(e){e.length>0?nt.getUsersDetail(e,{setStatus:!0}):Qe.updateUserConnectedStatus()}),"function"==typeof q&&q("success",e),We.tabFocused(),ut.length>0&&E>0&&ut.html(E),Oe&&ot.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0}),ct.init(e),mt.subscribeToServiceWorker(),ALStorage.setAppHeaders(e),Xe.loadGroups({apzCallback:tt.loadGroups}),void 0!==ht?t.fn.applozic("mckLaunchSideboxChat"):(t.fn.applozic("triggerMsgNotification"),"block"===s.css("display")&&clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM)),Kommunicate.postPluginInitialization(null,e),KommunicateUtils.triggerCustomEvent("kmInitilized",{detail:e,bubbles:!0,cancelable:!0});var v=document.getElementById("km-chat-login-modal");v.style.visibility="hidden"},n.validateAppSession=function(e){tt.init(),st.init();var t=ALStorage.getAppHeaders();return!(!t||!t.userId)&&(e.applicationId===t.appId&&e.userId===t.userId&&e.password===t.accessToken?(n.onInitApp(t),!0):(ALStorage.clearAppHeaders(),!1))},n.setHeaders=function(e){e.setRequestHeader("UserId-Enabled",!0),c&&e.setRequestHeader("Authorization","Basic "+c),e.setRequestHeader("Application-Key",U),d&&e.setRequestHeader("Device-Key",d),W&&e.setRequestHeader("Access-Token",W),te&&e.setRequestHeader("App-Module-Name",te)},n.setLeadCollectionLabels=function(){var e=MCK_LABELS["lead.collection"];document.getElementById("km-email").setAttribute("placeholder",e.email),document.getElementById("km-userName").setAttribute("placeholder",e.name),document.getElementById("km-contact").setAttribute("placeholder",e.contactNumber),document.getElementById("km-submit-chat-login").innerHTML=e.submit,document.getElementById("km-lead-collection-heading").innerHTML=e.heading},n.setLabels=function(){t("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]),t("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]),t("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]),t("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]),t("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]),t("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]),t("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]),t("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]),t("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]),t("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]),t("#mck-msg-error").html(MCK_LABELS["group.deleted"]),t("#mck-gc-title-label").html(MCK_LABELS["group.title"]),t("#mck-gc-type-label").html(MCK_LABELS["group.type"]),t("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]),t("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]),t("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]),t("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]),t("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]),t("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]),t("#mck-typing-label").html(MCK_LABELS.typing),t("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]),t("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),t("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]),t("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]),t("#mck-file-up-label").html(MCK_LABELS["file.attachment"]),t("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]),t(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]),t("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]),t("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close),t("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send),t("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]),t("#mck-btn-smiley").attr("title",MCK_LABELS.smiley),t("#mck-group-name-save").attr("title",MCK_LABELS.save),t("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save),t("#mck-group-name-edit").attr("title",MCK_LABELS.edit),document.getElementById("mck-text-box").dataset.text=MCK_LABELS["input.message"]},t(s).on("click",".fancybox",function(e){var a=t(this),s=a.data("type");if(-1!==s.indexOf("video")){var o,n=a.find(".mck-video-box").html();a.fancybox({content:n,title:a.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){(o=t(".fancybox-inner").find("video").get(0)).load(),o.play()}})}else{var i=a.data("url");t(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:i,type:"image"})}}),t(a).on("resize",function(){if("block"===l.css("display")&&Ze.fileMenuReposition(),0===p.find(".mck-contact-list").length){var e=p.get(0).scrollHeight;p.height()<e&&p.animate({scrollTop:p.prop("scrollHeight")},0)}}),n.appendLauncher=function(){t("#mck-sidebox-launcher").remove(),t("body").append(n.getLauncherHtml()),it.init()},n.tabFocused=function(){var e="hidden";function t(t){var s={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};t=t||a.event,(T=t.type in s?s[t.type]:!this[e])?(v<1&&u&&Tt.checkConnected(!0),n.stopIdleTimeCounter()):(1===g&&Tt.sendTypingStatus(0),n.manageIdleTime())}e in s?s.addEventListener("visibilitychange",t):("mozHidden"===e)in s?s.addEventListener("mozvisibilitychange",t):("webkitHidden"===e)in s?s.addEventListener("webkitvisibilitychange",t):("msHidden"===e)in s?s.addEventListener("msvisibilitychange",t):"onfocusin"in s?s.onfocusin=s.onfocusout=t:a.onpageshow=a.onpagehide=a.onfocus=a.onblur=t,void 0!==s[e]&&t({type:s[e]?"blur":"focus"})},n.manageIdleTime=function(){v=h,e&&clearInterval(e),e=setInterval(function(){--v<0&&(v=0,Tt.stopConnectedCheck(),clearInterval(e),e="")},6e4)},n.stopIdleTimeCounter=function(){v=h,e&&clearInterval(e),e=""},n.manageOfflineMessageTime=function(e){if("object"!=typeof le||isNaN(le.timeout))a.console.log("Offline message timeout required.");else{if(1===le.type){if(!le.userIds||0===le.userIds.length)return void a.console.log("Offline message userIds required.");if(-1===le.userIds.indexOf(e))return}o&&clearInterval(o),o=setTimeout(function(){clearInterval(o),o="",st.showOfflineMessage()},5e3*parseInt(le.timeout))}},n.stopOfflineMessageCounter=function(){o&&clearInterval(o),o=""}},Je=new MckUtils,Ze=new function(){var e=this,s="",o="",n=!1,i=t("#mck-my-loc"),r=t("#mck-loc-box"),c=t("#mck-loc-lat"),l=t("#mck-loc-lon"),d=t("#mck-btn-loc"),m=t("#mck-sidebox-ft"),p=t("#mck-file-menu"),u=t("#mck-btn-attach"),v=t("#mck-map-content"),g=t("#mck-loc-address");e.init=function(){P&&a.google&&"object"==typeof a.google.maps&&(s=new a.google.maps.Geocoder,u.on("click",function(){e.fileMenuToggle()}),d.on("click",function(t){t.preventDefault(),n?r.mckModal():(mckMapUtils.getCurrentLocation(e.onGetCurrLocation,e.onErrorCurrLocation),n=!0)})),i.on("click",function(){mckMapUtils.getCurrentLocation(e.onGetMyCurrLocation,e.onErrorMyCurrLocation)})},e.fileMenuReposition=function(){var e=m.offset();e.bottom=a.innerHeight-e.top,p.css({bottom:e.bottom>51?e.bottom:51,right:0})},e.fileMenuToggle=function(){u.hasClass("on")?(u.removeClass("on"),p.hide()):(e.fileMenuReposition(),u.addClass("on"),p.show())},e.onGetCurrLocation=function(t){MCK_CURR_LATITIUDE=t.coords.latitude,MCK_CURR_LONGITUDE=t.coords.longitude,e.openMapBox()},e.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=46.15242437752303,MCK_CURR_LONGITUDE=2.7470703125,e.openMapBox()},e.onErrorMyCurrLocation=function(e){alert("Unable to retrieve your location. ERROR("+e.code+"): "+e.message)},e.onGetMyCurrLocation=function(e){if(MCK_CURR_LATITIUDE=e.coords.latitude,MCK_CURR_LONGITUDE=e.coords.longitude,c.val(MCK_CURR_LATITIUDE),l.val(MCK_CURR_LONGITUDE),c.trigger("change"),l.trigger("change"),o)g.val(o);else if(s){var t={lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE};s.geocode({location:t},function(e,t){"OK"===t&&e[1]&&(o=e[1].formatted_address)})}},e.openMapBox=function(){v.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:c,longitudeInput:l,locationNameInput:g},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(e){MCK_CURR_LATITIUDE=e.latitude,MCK_CURR_LONGITUDE=e.longitude}}),r.on("shown.bs.mck-box",function(){v.locationpicker("autosize")}),r.mckModal()}},Qe=new function(){var e=t("#mck-msg-form"),s=t("#mck-msg-error"),o=t("#mck-tab-title"),n=t("#mck-tab-status"),i=t(".mck-typing-box"),r=t("#mck-block-button"),c=t("#mck-message-cell .mck-message-inner");this.updateUserConnectedStatus=function(){t(".mck-user-ol-status").each(function(){var e=t(this),a=e.data("mck-id");if(a){var s=b[a];void 0!==pt.MCK_USER_DETAIL_MAP[a]&&s.connected?(e.removeClass("n-vis").addClass("vis"),e.next().html("("+MCK_LABELS.online+")")):(e.removeClass("vis").addClass("n-vis"),e.next().html("(Offline)"))}})},this.lastSeenOfGroupOfTwo=function(e){if(a.MCK_OL_MAP[e])n.attr("title",MCK_LABELS.online).html(MCK_LABELS.online);else if(I[e]){var t=mckDateUtils.getLastSeenAtStatus(I[e]);n.html(t),n.attr("title",t),o.addClass("mck-tab-title-w-status")}},this.toggleBlockUser=function(t,l){if(l)s.html(MCK_LABELS.blocked),s.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),e.removeClass("vis").addClass("n-vis"),o.removeClass("mck-tab-title-w-status"),n.removeClass("vis").addClass("n-vis"),i.removeClass("vis").addClass("n-vis"),c.data("blocked",!0),r.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"]);else if(s.html(""),s.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),e.removeClass("n-vis").addClass("vis"),c.data("blocked",!1),r.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),!C[t]&&(a.MCK_OL_MAP[t]||I[t])){if(a.MCK_OL_MAP[t])n.attr("title",MCK_LABELS.online).html(MCK_LABELS.online);else if(I[t]){var d=mckDateUtils.getLastSeenAtStatus(I[t]);n.html(d),n.attr("title",d)}o.addClass("mck-tab-title-w-status")}}},Xe=(new function(){var e=t("#mck-msg-to"),s=(t("#mck-btn-loc"),t("#mck-loc-box")),o=t("#mck-msg-sbmt"),n=t("#mck-msg-error"),i=t("#mck-loc-submit"),r=t("#mck-msg-response"),c=t("#mck_response_text"),l=t("#mck-message-cell .mck-message-inner");i.on("click",function(){var t={type:5,contentType:2,message:a.JSON.stringify(mckMapUtils.getSelectedLocation())},i=l.data("mck-conversationid"),d=l.data("mck-topicid");if(i)t.conversationId=i;else if(d){var m={topicId:d},p=y[d];"object"==typeof p&&(m.topicDetail=a.JSON.stringify(p)),t.conversationPxy=m}!0===l.data("isgroup")?t.groupId=e.val():t.to=e.val(),o.attr("disabled",!0),n.removeClass("vis").addClass("n-vis"),n.html(""),c.html(""),r.removeClass("vis").addClass("n-vis"),ot.sendMessage(t),s.mckModal("hide")})},new MckGroupService),et=new MckGroupUtils,tt=new function(){var e=this,o={0:MCK_LABELS.user,1:MCK_LABELS.admin,2:MCK_LABELS.moderator,3:MCK_LABELS.member},n=document.getElementById("mck-group-create-type");n.options[n.options.length]=new Option(MCK_LABELS.public,"1"),n.options[n.options.length]=new Option(MCK_LABELS.private,"2"),n.options[n.options.length]=new Option(MCK_LABELS.open,"6");var i=t("#mck-msg-form"),r=t("#mck-msg-error"),c=t("#mck-tab-title"),l=t("#mck-tab-status"),d=t("#mck-no-gsm-text"),m=t("#mck-gms-loading"),p=t("#mck-contact-loading"),u=(t("#mck-tab-menu-box"),t("#mck-search-loading"),t("#mck-group-info-tab")),v=t("#mck-sidebox-search"),g=(t("#mck-group-name-box"),t("#mck-group-back-link")),f=t("#mck-group-name-edit"),C=t("#mck-group-name-save"),h=t("#mck-sidebox-content"),b=t("#mck-tab-option-panel"),T=t("#mck-btn-group-create"),E=t("#mck-group-create-tab"),S=t("#mck-contacts-content"),x=t("#mck-btn-group-update"),L=t("#mck-group-create-type"),A=t("#mck-group-icon-upload"),_=t("#mck-group-icon-change"),w=t("#mck-group-member-list"),U=t("#mck-group-update-panel"),G=t(".mck-tab-message-option"),R=t("#mck-group-create-title"),D=t(".mck-group-menu-options"),z=t("#mck-group-member-search"),B=t("#mck-btn-group-icon-save"),P=(t("#mck-group-info-icon-box"),t(".mck-group-admin-options")),F=t("#mck-group-add-member-box"),$=t("#mck-message-cell .mck-message-inner"),q=t("#mck-group-name-sec .mck-group-title"),H=(t("#mck-group-create-icon-box"),t("#mck-group-info-icon-loading")),j=t("#mck-gm-search-box"),V=(t("#mck-group-member-search-list"),t("#mck-group-create-icon-loading")),Y=t("#mck-group-info-icon-box .mck-group-icon"),W=t("#mck-group-create-icon-box .mck-group-icon"),J=t("#mck-group-create-icon-box .mck-overlay-box"),Z=t("#mck-gc-overlay-label");t(".mck-group-name-box div[contenteditable]").keypress(function(a){return!!(8===a.which||37===a.keyCode||38===a.keyCode||39===a.keyCode||40===a.keyCode||a.ctrlKey&&97===a.which)||(13!==a.keyCode||a.shiftKey||a.ctrlKey?30>this.innerHTML.length:!!t(a.target).hasClass("mck-group-create-title")&&(e.submitCreateGroup(),!1))}).on("paste",function(e){var t=this;setTimeout(function(){var e=t.innerText.length;return e>30&&(t.innerHTML=t.innerText.substring(0,30),Je.setEndOfContenteditable(t)),!1},"fast")}).on("drop",function(e){e.preventDefault(),e.stopPropagation()}),t(s).on("click",".mck-btn-change-role",function(e){e.preventDefault();var a=t(this).parents(".mck-li-group-member").find(".mck-group-change-role-box"),s=t(this).parents(".mck-li-group-member").data("role");a.find("select").val(s),a.removeClass("n-vis").addClass("vis"),U.removeClass("n-vis").addClass("vis")}),x.on("click",function(){var e=[];if(t(".mck-group-change-role-box.vis").each(function(a,s){var o=t(this),n=parseInt(o.find("select").val()),i=o.parents(".mck-li-group-member").data("role");if(n!==i){var r={userId:o.parents(".mck-li-group-member").data("mck-id"),role:n};e.push(r)}}),e.length>0){var a=$.data("mck-id"),s=$.data("isgroup");if(a&&s){x.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]);var o={groupId:a,users:e,apzCallback:tt.onUpdateGroupInfo};Xe.updateGroupInfo(o)}}}),t("#mck-group-info-icon-box .mck-overlay").on("click",function(e){_.trigger("click")}),t("#mck-group-create-icon-box .mck-overlay").on("click",function(e){A.trigger("click")}),t(s).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){t(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var e=t(this);0===e.find(".mck-group-icon-default").length&&e.find(".mck-overlay-box").addClass("n-vis")}),t(s).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){t(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",function(){t(this).find(".mck-overlay-box").addClass("n-vis")}),f.on("click",function(){q.attr("contenteditable",!0).focus(),Je.setEndOfContenteditable(q[0]),C.removeClass("n-vis").addClass("vis"),f.removeClass("vis").addClass("n-vis")}),C.on("click",function(){var e=t.trim(q.text());if(e.length>0){var a=$.data("mck-id"),s=$.data("isgroup");if(a&&s){f.removeClass("n-vis").addClass("vis"),C.removeClass("vis").addClass("n-vis"),q.attr("contenteditable",!1);var o={groupId:a,name:e,apzCallback:tt.onUpdateGroupInfo};Xe.updateGroupInfo(o)}}else q.addClass("mck-req-border")}),B.on("click",function(){var e=Y.data("iconurl");if(e){var t=$.data("mck-id"),a=$.data("isgroup");if(t&&a){setTimeout(function(){B.removeClass("vis").addClass("n-vis")},1e3),Y.data("iconurl","");var s={groupId:t,imageUrl:e,apzCallback:tt.onUpdateGroupInfo};Xe.updateGroupInfo(s)}}else q.addClass("mck-req-border")}),T.on("click",function(){e.submitCreateGroup()}),e.init=function(){t.template("groupMemberTemplate",'<li id="li-gm-${contHtmlExpr}" class="${contIdExpr} mck-li-group-member" data-mck-id="${contIdExpr}" data-role="${roleVal}" data-alpha="${contFirstAlphaExpr}"><div class="mck-row mck-group-member-info" title="${contNameExpr}"><div class="blk-lg-3">{{html contImgExpr}}</div><div class="blk-lg-9"><div class="mck-row"><div class="blk-lg-8 mck-cont-name mck-truncate"><strong>${contNameExpr}</strong></div><div class="blk-lg-4 mck-group-admin-text move-right vis"><span>${roleExpr}</span></div></div><div class="mck-row"><div class="blk-lg-8 mck-truncate mck-last-seen-status" title="${contLastSeenExpr}">${contLastSeenExpr}</div><div class="blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"><div class="mck-menu-box n-vis"><div class="mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle="mckdropdown" aria-expanded="true"><span class="mck-caret"></span></div><ul id="mck-group-admin-menu" class="mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role="menu"><li><a href="#" target="_self"  class="mck-btn-remove-member menu-item" title="${removeMemberLabel}">${removeMemberLabel}</a></li><li><a href="#" target="_self"  class="mck-btn-change-role menu-item" title="${changeRoleLabel}">${changeRoleLabel}</a></li></ul></div></div></div><div id="mck-group-change-role-box" class="mck-row mck-group-change-role-box n-vis"><div class="blk-lg-4"><div class="mck-label">Select role </div></div><div class="blk-lg-8 move-right"><select id="mck-change-role-type" class="mck-select"><option value="0">User</option><option value="1">Admin</option><option value="2">Moderator</option><option value="3" selected>Member</option></select></div></div></div></div></li>'),t.template("groupMemberSearchTemplate",'<li id="li-${contHtmlExpr}" class="${contIdExpr} mck-li-group-member" data-mck-id="${contIdExpr}"><a class="mck-add-to-group" href="#" data-mck-id="${contIdExpr}"><div class="mck-row" title="${contNameExpr}"><div class="blk-lg-3">{{html contImgExpr}}</div><div class="blk-lg-9"><div class="mck-row"><div class="blk-lg-12 mck-cont-name mck-truncate"><strong>${contNameExpr}</strong></div></div><div class="mck-row"><div class="blk-lg-12 mck-truncate mck-last-seen-status" title="${contLastSeenExpr}">${contLastSeenExpr}</div></div></div></div></a></li>')},e.submitCreateGroup=function(){var e=t.trim(R.text()),a=L.val(),s=W.data("iconurl");if(e.length>0){var o={groupName:e};a&&(a=parseInt(a),-1!==N.indexOf(a)&&(o.type=a)),s&&(o.groupIcon=s),W.data("iconurl",""),o.isInternal=!0,T.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),ot.getGroup(o)}else R.addClass("mck-req-border")},e.loadGroups=function(e){var a=e.data;Fe.length=0,t.each(a,function(e,t){if(void 0!==t.id){var t=et.addGroup(t);Fe.push(t)}})},e.getDeletedAtTime=function(e){if("object"==typeof MCK_GROUP_MAP[e]){var t=MCK_GROUP_MAP[e];return t.deletedAtTime}},e.validateOpenGroupUser=function(e){if(6===e.type){var t=Xe.authenticateGroupUser(e);if(!t){if(ce.disableChatForNonGroupMember){var a=ce.defaultChatDisabledMessage;a||(a="Chat disabled"),r.html(a),r.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),i.removeClass("vis").addClass("n-vis"),c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis")}D.removeClass("vis").addClass("n-vis"),G.removeClass("vis").addClass("n-vis"),b.removeClass("vis").addClass("n-vis"),void 0===K[e.contactId]&&Tt.subscribeToOpenGroup(e)}return e.adminName===Ce?0===ce.deleteChatAccess&&G.removeClass("vis").addClass("n-vis"):(ce.allowInfoAccessGroupMembers||D.removeClass("vis").addClass("n-vis"),2!==ce.deleteChatAccess&&G.removeClass("vis").addClass("n-vis"),ce.allowInfoAccessGroupMembers||2===ce.deleteChatAccess||b.removeClass("vis").addClass("n-vis")),!1}return!0},e.addGroupStatus=function(t){var a=e.isGroupLeft(t);if(6!==t.type&&(a||Ee))a&&tt.onGroupLeft("",{groupId:t.contactId}),c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis");else if(t.members.length>0){for(var s="",o=!1,n=t.members.length<=30?t.members.length:25,i=0;i<n;i++)if(Ce!==""+t.members[i]&&-1===t.removedMembersId.indexOf(t.members[i])){var r=st.fetchContact(""+t.members[i]),d=st.getTabDisplayName(r.contactId,!1);s+=" "+d+","}else o=!0;(5!==t.type&&6!==t.type||o&&5!==t.type)&&(s+=" You"),t.members.length>30&&(s+=" and "+(t.members.length-25)+" more"),s=s.replace(/,\s*$/,""),l.html(s),l.attr("title",s),c.addClass("mck-tab-title-w-status"),D.removeClass("n-vis").addClass("vis")}else c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis");7===t.type&&(l.html(""),D.removeClass("vis").addClass("n-vis"))},e.disableGroupTab=function(){r.html(MCK_LABELS["group.chat.disabled"]),r.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),i.removeClass("vis").addClass("n-vis"),c.removeClass("mck-tab-title-w-status"),l.removeClass("vis").addClass("n-vis")},e.isGroupLeft=function(e){var a=!1;return e.removedMembersId&&e.removedMembersId.length>0&&t.each(e.removedMembersId,function(e,t){t===Ce&&(a=!0)}),a},e.onGroupLeft=function(t,a){if(p.removeClass("vis").addClass("n-vis"),"object"!=typeof t||"error"!==t.status){var s=a.groupId;if(u.hasClass("vis")){var o=u.data("mck-id");s===o&&g.trigger("click")}else if(h.hasClass("vis")){var n=$.data("mck-id"),i=$.data("isgroup");n===s.toString()&&i&&(D.removeClass("vis").addClass("n-vis"),e.disableGroupTab())}}else alert("Unable to process your request. "+t.errorMessage)},e.onAddedGroupMember=function(a,s){if(p.removeClass("vis").addClass("n-vis"),"object"!=typeof a||"error"!==a.status){var o=s.groupId,n=s.userId,i="";if(o?i=et.getGroup(o):s.clientGroupId&&(i=et.getGroupByClientGroupId(s.clientGroupId)),"object"==typeof i){if(i=Xe.addMemberToGroup(i,n),u.hasClass("vis")){var r=u.data("mck-id");if(o===r){var c=st.fetchContact(""+n);0===t("#li-gm-"+c.htmlId).length&&e.addGroupMember(i,c),e.sortGroupMemberHtmlList(),e.enableGroupAdminMenuToggle()}}else if(h.hasClass("vis")){var l=$.data("mck-id"),d=$.data("isgroup");l===o.toString()&&d&&e.addGroupStatus(i)}}else Xe.getGroupFeed({groupId:o,clientGroupId:s.clientGroupId,apzCallback:tt.onGroupFeed})}else alert("Unable to process your request. "+a.errorMessage)},e.onRemovedGroupMember=function(a,s){if(p.removeClass("vis").addClass("n-vis"),"object"!=typeof a||"error"!==a.status){var o=s.groupId,n=s.userId,i="";if(o?i=et.getGroup(o):s.clientGroupId&&(i=et.getGroupByClientGroupId(s.clientGroupId)),"object"==typeof i){if(i=Xe.removeMemberFromGroup(i,n),u.hasClass("vis")){var r=u.data("mck-id");if(o===r){var c=st.fetchContact(""+n),l=t("#li-gm-"+c.htmlId);l.length>0&&l.remove()}}else if(h.hasClass("vis")){var d=$.data("mck-id"),m=$.data("isgroup");d===o.toString()&&m&&e.addGroupStatus(i)}}else Xe.getGroupFeed({groupId:o,clientGroupId:s.clientGroupId,apzCallback:tt.onGroupFeed})}else alert("Unable to process your request. "+a.errorMessage)},e.onGroupFeed=function(a,s){if(p.removeClass("vis").addClass("n-vis"),"success"===a.status){var o=a.data,n=o.conversationPxy,c=et.getGroup(o.id);o.deletedAtTime&&(r.html(MCK_LABELS["group.deleted"]),r.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),i.removeClass("vis").addClass("n-vis"));var l=new Array;"object"==typeof n&&(M[n.id]=n,O[n.topicId]=[n.id],n.topicDetail&&(y[n.topicId]=t.parseJSON(n.topicDetail)),l.push(n)),l.length>0&&(Ye[s.groupId]=l),pt.loadUserProfiles(o.membersId,function(e,a){t.each(e,function(e,t){void 0===st.getContact(t)&&a.push(t)}),nt.getUsersDetail(a,{async:!1})}),s.isMessage&&"object"==typeof s.message&&st.populateMessage(s.messageType,s.message,s.notifyUser),s.isReloadTab&&e.reloadGroupTab(c)}},e.onUpdateGroupInfo=function(a,s){if(p.removeClass("vis").addClass("n-vis"),x.attr("disabled",!1).html("Update"),U.removeClass("vis").addClass("n-vis"),"object"!=typeof a||"error"!==a.status){var o=s.groupId,n=s.groupInfo,i=et.getGroup(o);if("object"==typeof i){if(n.imageUrl&&(i.imageUrl=n.imageUrl),n.newName&&(i.displayName=n.newName),n.metadata&&(i.metadata=n.metadata),n.users&&n.users.length>0&&t.each(n.users,function(e,t){t.userId&&(i.users[t.userId]=t)}),u.hasClass("vis"))n.imageUrl&&Y.html(Xe.getGroupImage(i.imageUrl)),q.html(i.displayName),n.users&&n.users.length>0&&(w.html(""),e.addMembersToGroupInfoList(i),i.adminName===Ce?F.removeClass("n-vis").addClass("vis"):F.removeClass("vis").addClass("n-vis"));else if(h.hasClass("vis")){var r=$.data("mck-id"),l=$.data("isgroup");r===o.toString()&&l?c.html(i.displayName):t("#li-group-"+i.htmlId).length>0&&(t("#li-group-"+i.htmlId+" .mck-cont-name strong").html(i.displayName),n.imageUrl&&t("#li-group-"+i.htmlId+" .blk-lg-3").html("<img src=' "+i.imageUrl+"'>"))}MCK_GROUP_MAP[i.contactId]=i}}else alert("Unable to process your request. "+a.errorMessage)},e.getGroupFeedFromMessage=function(e){var t=e.message;if(t){if(e.groupId=t.groupId,e.isMessage=!0,t.conversationId){var a=M[t.conversationId];"object"==typeof a&&"object"==typeof y[a.topicId]||(e.conversationId=t.conversationId)}e.apzCallback=tt.onGroupFeed,Xe.getGroupFeed(e)}},e.reloadGroupTab=function(t){var a=$.data("mck-id"),s=$.data("isgroup");a===t.contactId.toString()&&s&&e.addGroupStatus(t)},e.loadGroupTab=function(e){if("error"===e.status)alert("Unable to process your request. "+e.errorMessage);else{var a=e.data;st.loadTab({tabId:a.contactId,isGroup:!0}),t("#mck-search").val("")}},e.addMembersToGroupInfoList=function(a){var s=a.members;s.sort(),w.html(""),t.each(s,function(s,o){if(o){var n=st.fetchContact(""+o);0===t("#li-gm-"+n.htmlId).length&&e.addGroupMember(a,n)}}),e.sortGroupMemberHtmlList(),e.enableGroupAdminMenuToggle()},e.enableGroupAdminMenuToggle=function(){t(".mck-group-member-info").bind("mouseenter",function(){t(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",function(){t(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})},e.addGroupMember=function(e,s){var n="n-vis",i="n-vis",r=e.users[s.contactId],c=MCK_LABELS.member,l=3;r&&void 0!==r.role&&(l=r.role,c=o[r.role]);var d=st.getTabDisplayName(s.contactId,!1);s.contactId===e.adminName&&(n="vis"),e.adminName===Ce&&(i="vis"),s.contactId===Ce&&(d=MCK_LABELS.you,i="n-vis");var m=st.getContactImageLink(s,d),p="";k[s.contactId]||(a.MCK_OL_MAP[s.contactId]?p=MCK_LABELS.online:I[s.contactId]&&(p=mckDateUtils.getLastSeenAtStatus(I[s.contactId])));var u=[{roleExpr:c,roleVal:l,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:s.htmlId,contIdExpr:s.contactId,contImgExpr:m,contLastSeenExpr:p,contNameExpr:d,contFirstAlphaExpr:d.charAt(0).toUpperCase(),isAdminExpr:n,enableAdminMenuExpr:i}];t.tmpl("groupMemberTemplate",u).appendTo("#mck-group-member-list")},e.addMembersToGroupSearchList=function(){var a=$.data("mck-id"),s=$.data("isgroup");if(s){var o=et.getGroup(a),n=Ve,i=[],r=ALStorage.getFriendListGroupName(),c=ALStorage.getFriendListGroupType();r&&c&&(n=nt.getFriendList(r,c)),r&&!c&&(n=nt.getFriendList(r)),(n=n.filter(function(e,t){return n.indexOf(e)===t})).sort();var l=o.members;t.each(n,function(t,a){if(a){if("object"==typeof a&&a.contactId)var a=st.fetchContact(""+a.contactId);else var a=st.fetchContact(""+a);(-1===l.indexOf(a.contactId)||-1!==l.indexOf(a.contactId)&&-1!==o.removedMembersId.indexOf(a.contactId))&&(e.addGroupSearchMember(a),i.push(a))}}),e.enableGroupAdminMenuToggle(),i.length>0?d.removeClass("vis").addClass("n-vis"):d.removeClass("n-vis").addClass("vis"),st.initAutoSuggest({contactsArray:i,$searchId:z,isContactSearch:!1})}m.removeClass("vis").addClass("n-vis")},e.addGroupSearchMember=function(e){var s=st.getTabDisplayName(e.contactId,!1),o=st.getContactImageLink(e,s),n="user-"+e.htmlId,i="";k[e.contactId]||(a.MCK_OL_MAP[e.contactId]?i=MCK_LABELS.online:I[e.contactId]&&(i=mckDateUtils.getLastSeenAtStatus(I[e.contactId])));var r=[{contHtmlExpr:n,contIdExpr:e.contactId,contImgExpr:o,contLastSeenExpr:i,contNameExpr:s}];t.tmpl("groupMemberSearchTemplate",r).appendTo("#mck-group-member-search-list")},e.loadCreateGroupTab=function(){S.removeClass("vis").addClass("n-vis"),h.removeClass("vis").addClass("n-vis"),v.removeClass("vis").addClass("n-vis"),u.removeClass("vis").addClass("n-vis"),V.removeClass("vis").addClass("n-vis"),W.data("iconurl",""),R.html(""),J.removeClass("n-vis"),Z.html(MCK_LABELS["add.group.icon"]),W.html(Xe.getGroupDefaultIcon()),E.removeClass("n-vis").addClass("vis")},e.loadGroupInfo=function(t){if(t.groupId){q.attr("contenteditable",!1),C.removeClass("vis").addClass("n-vis"),f.removeClass("n-vis").addClass("vis"),S.removeClass("vis").addClass("n-vis"),h.removeClass("vis").addClass("n-vis"),v.removeClass("vis").addClass("n-vis"),U.removeClass("vis").addClass("n-vis"),E.removeClass("vis").addClass("n-vis"),B.removeClass("vis").addClass("n-vis"),H.removeClass("vis").addClass("n-vis"),u.removeClass("n-vis").addClass("vis"),u.data("mck-id",t.groupId),Y.data("iconurl",""),t.conversationId&&u.data("mck-conversation-id",t.conversationId),w.html("");var a=et.getGroup(t.groupId);"object"==typeof a?(Y.html(Xe.getGroupImage(a.imageUrl)),q.html(a.displayName),e.addMembersToGroupInfoList(a),a.adminName===Ce?F.removeClass("n-vis").addClass("vis"):F.removeClass("vis").addClass("n-vis")):Xe.getGroupFeed({groupId:t.groupId,apzCallback:tt.onGroupFeed})}},e.sortGroupMemberHtmlList=function(){t("#mck-group-member-list .mck-li-group-member").sort(function(e,t){return e.dataset.alpha>t.dataset.alpha}).appendTo("#mck-group-member-list")},e.addGroupMemberFromSearch=function(e){var t=u.data("mck-id");if(void 0!==t&&void 0!==e){var a=et.getGroup(t);"object"==typeof a&&Ce===a.adminName?(pt.loadUserProfile(e),Xe.addGroupMember({groupId:t,userId:e,apzCallback:tt.onAddedGroupMember})):P.removeClass("vis").addClass("n-vis")}j.mckModal("hide")}},at=new function(){var e=this,a=["CREATE","UPDATE"],o=t("#mck-file-box"),n=t(".mck-overlay"),i=t("#mck-msg-sbmt"),r=t("#mck-text-box"),l=t("#mck-file-input"),m=t("#mck-autosuggest-search-input"),u=t(".mck-overlay-box"),v=t(".mck-file-upload"),g=t("#mck-group-icon-upload"),f=t("#mck-group-icon-change"),k=t("#mck-group-info-icon-box"),C=t("#mck-btn-group-icon-save"),h=t("#mck-message-cell .mck-message-inner"),b=t("#mck-group-create-icon-box"),y=t("#mck-group-info-icon-loading"),I=t("#mck-group-create-icon-loading"),M=t("#mck-group-info-icon-box .mck-group-icon"),T=t("#mck-group-create-icon-box .mck-group-icon"),E=t("#mck-gc-overlay-label");e.init=function(){t.template("fileboxTemplate",'<div id="mck-filebox-${fileIdExpr}" class="mck-file-box ${fileIdExpr}"><div class="mck-file-expr"><span class="mck-file-content blk-lg-8"><span class="mck-file-lb">{{html fileNameExpr}}</span>&nbsp;<span class="mck-file-sz">${fileSizeExpr}</span></span><span class="km-progress km-progress-striped active blk-lg-3" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"><span class="km-progress-bar km-progress-bar-success km-bar" stye></span></span><span class="move-right"><button type="button" class="mck-attach-icon mck-box-close mck-remove-file" data-dismiss="div" aria-hidden="true">x</button></span></div></div>'),Kommunicate.attachEvents(t),v.on("click",function(e){e.preventDefault(),l.trigger("click")}),g.on("change",function(){var s=t(this)[0].files[0];return e.uplaodFileToAWS(s,a[0]),!1}),f.on("change",function(){var s=t(this)[0].files[0];return e.uplaodFileToAWS(s,a[1]),!1}),l.on("change",function(){var e=t(this)[0].files[0],a=h.data("mck-id");if(-1!=e.type.indexOf("image/"))Kommunicate.attachmentService.getFileMeta(e,a,function(e,t,a){p=e,ot.sendMessage(t,a,function(e){t.key=e.key;var s={};s.file=a,s.name=a.name,Kommunicate.attachmentService.uploadAttachment(s,t,fe)})});else{var s={};s.file=e,s.name=e.name,Kommunicate.attachmentService.uploadAttachment(s,null,fe)}}),t(s).on("click",".mck-remove-file",function(){var e=t(this).parents(".mck-file-box"),a=e.data("mckfile");e.remove(),i.attr("disabled",!1),0===o.find(".mck-file-box").length&&(o.removeClass("vis").addClass("n-vis"),r.attr("required","")),"object"==typeof a&&(ct.deleteFileMeta(a.blobKey),t.each(p,function(e,t){void 0!==t&&t.blobKey===a.blobKey&&p.splice(e,1)}))}),m.on("input",function(e){e.preventDefault(),r.text(m.val()),"KM_AUTO_SUGGEST"!=m.data("origin")&&""!=m.data("source-url")&&st.populateAutoSuggest({sourceUrl:m.data("source-url"),method:m.data("method"),headers:m.data("headers")})})},e.audioRecoder=function(t){"awsS3Server"===fe?e.uploadAttachment2AWS(t):"googleCloud"===fe?e.customFileUpload(t):e.uploadFile(t)},e.customFileUpload=function(e,a){var s=e.file,n=!1,l=new FormData,m=[];if(void 0!==s){if(t(".mck-file-box").length>4&&m.push("Can't upload more than 5 files at a time"),s.size>1048576*ee&&m.push("file size can not be more than "+ee+" MB"),!(m.length>0)){var u=Je.randomId(),g=[{fileIdExpr:u,fileName:e.name,fileNameExpr:'<a href="#" target="_self" >'+e.name+"</a>",fileSizeExpr:ct.getFilePreviewSize(s.size)}];t.tmpl("fileboxTemplate",g).appendTo("#mck-file-box");var f=t(".mck-file-box."+u),k=t(".mck-file-box."+u+" .mck-file-lb"),C=t(".mck-file-box."+u+" .km-progress .km-bar"),b=t(".mck-file-box."+u+" .km-progress"),y=t(".mck-file-box."+u+" .mck-remove-file");if(C.css("width","0%"),a&&Kommunicate.attachmentEventHandler.progressMeter(0,a.key),b.removeClass("n-vis").addClass("vis"),y.attr("disabled",!0),v.attr("disabled",!0),KommunicateUI.hideFileBox(s,o,v),e.name===t(".mck-file-box."+u+" .mck-file-lb a").html()){var I=h.data("mck-id"),M=e.name+s.size;Pe[M]=I,i.attr("disabled",!0),l.append("files[]",s);var T=new XMLHttpRequest;(T.upload||T).addEventListener("progress",function(e){var t=parseInt(e.loaded/e.total*100,10);C.css("width",t+"%"),a&&Kommunicate.attachmentEventHandler.progressMeter(t,a.key)}),T.addEventListener("load",function(e){var s=t.parseJSON(this.responseText);if("object"==typeof s){var o=s.fileMeta;if(a){a.fileMeta=o;var c={tabId:a.groupId};return n=KommunicateUI.getAttachmentStopUploadStatus(a.key),KommunicateUI.updateAttachmentTemplate(o,a.key),!n&&ot.submitMessage(a,c),void KommunicateUI.updateImageAttachmentPreview(o,a.key)}var l="object"==typeof o?'<a href="'+o.url+'" target="_blank">'+o.name+"</a>":"",d=o.name,m=o.size,u=h.data("mck-id"),g=d+m,C=Pe[g];return I!==u?(st.updateDraftMessage(C,o),void delete Pe[g]):(y.attr("disabled",!1),v.attr("disabled",!1),i.attr("disabled",!1),delete Pe[g],k.html(l),b.removeClass("vis").addClass("n-vis"),t(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),p.push(o),f.data("mckfile",o),v.children("input").val(""),!1)}y.attr("disabled",!1),i.attr("disabled",!1),y.trigger("click")});var E=_+"/files/upload/";T.open("post",E,!0),T.setRequestHeader("UserId-Enabled",!0),T.setRequestHeader("Authorization","Basic "+c),T.setRequestHeader("Application-Key",U),T.setRequestHeader("Device-Key",d),W&&T.setRequestHeader("Access-Token",W),T.send(l)}return!1}alert(m.toString())}},e.uploadAttachemnt=function(t,a){"awsS3Server"===fe?e.uploadAttachment2AWS(t,a):"googleCloud"===fe?e.customFileUpload(t,a):e.uploadFile(t,a)},e.uploadFile=function(e,a){var s=e.file,n=new Object,c=!1,l=[];if(void 0!==s){if(t(".mck-file-box").length>4&&l.push("Can't upload more than 5 files at a time"),s.size>1048576*ee&&l.push("file size can not be more than "+ee+" MB"),!(l.length>0)){var d=Je.randomId(),m=[{fileIdExpr:d,fileName:e.name,fileNameExpr:'<a href="#" target="_self" >'+e.name+"</a>",fileSizeExpr:ct.getFilePreviewSize(s.size)}];t.tmpl("fileboxTemplate",m).appendTo("#mck-file-box");var u=t(".mck-file-box."+d),g=t(".mck-file-box."+d+" .mck-file-lb"),f=t(".mck-file-box."+d+" .km-progress .km-bar"),k=t(".mck-file-box."+d+" .km-progress"),C=t(".mck-file-box."+d+" .mck-remove-file");if(f.css("width","0%"),a&&Kommunicate.attachmentEventHandler.progressMeter(0,a.key),k.removeClass("n-vis").addClass("vis"),C.attr("disabled",!0),v.attr("disabled",!0),KommunicateUI.hideFileBox(s,o,v),e.name===t(".mck-file-box."+d+" .mck-file-lb a").html()){var b=h.data("mck-id"),y=e.name+s.size;Pe[y]=b,i.attr("disabled",!0),n.files=[],n.files.push(s);var I=new XMLHttpRequest;(I.upload||I).addEventListener("progress",function(e){var t=parseInt(e.loaded/e.total*100,10);f.css("width",t+"%"),a&&Kommunicate.attachmentEventHandler.progressMeter(t,a.key)}),I.addEventListener("load",function(e){var s=t.parseJSON(this.responseText);if("object"==typeof s.fileMeta){var o=s.fileMeta;if(a){a.fileMeta=o;var n={tabId:a.groupId};return c=KommunicateUI.getAttachmentStopUploadStatus(a.key),KommunicateUI.updateAttachmentTemplate(o,a.key),!c&&ot.submitMessage(a,n),void KommunicateUI.updateImageAttachmentPreview(o,a.key)}var l=ct.getFilePreviewPath(o);o.url=$+"/rest/ws/aws/file/"+o.blobKey;var d=o.name,m=o.size,f=h.data("mck-id"),y=d+m,I=Pe[y];return b!==f?(st.updateDraftMessage(I,o),void delete Pe[y]):(C.attr("disabled",!1),v.attr("disabled",!1),i.attr("disabled",!1),delete Pe[y],g.html(l),k.removeClass("vis").addClass("n-vis"),t(".mck-file-box .km-progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),p.push(o),u.data("mckfile",o),v.children("input").val(""),!1)}C.attr("disabled",!1),i.attr("disabled",!1),C.trigger("click")}),t.ajax({type:"GET",url:$+"/rest/ws/aws/file/url",global:!1,data:"data="+(new Date).getTime(),crosDomain:!0,success:function(e){var t=new FormData;t.append("files[]",s),I.open("POST",e,!0),I.send(t)},error:function(){}})}return!1}alert(l.toString())}},e.uploadAttachment2AWS=function(e,a){var s=e.file,n=new FormData,l=[],m=!1;if(void 0!==s){if(t(".mck-file-box").length>4&&l.push("Can't upload more than 5 files at a time"),s.size>1048576*ee&&l.push("file size can not be more than "+ee+" MB"),!(l.length>0)){var u=Je.randomId(),g=[{fileIdExpr:u,fileName:e.name,fileNameExpr:'<a href="#" target="_self" >'+e.name+"</a>",fileSizeExpr:ct.getFilePreviewSize(s.size)}];t.tmpl("fileboxTemplate",g).appendTo("#mck-file-box");var f=t(".mck-file-box."+u),k=t(".mck-file-box."+u+" .mck-file-lb"),C=t(".mck-file-box."+u+" .km-progress .km-bar"),b=t(".mck-file-box."+u+" .km-progress"),y=t(".mck-file-box."+u+" .mck-remove-file");if(C.css("width","0%"),a&&Kommunicate.attachmentEventHandler.progressMeter(0,a.key),b.removeClass("n-vis").addClass("vis"),y.attr("disabled",!0),v.attr("disabled",!0),KommunicateUI.hideFileBox(s,o,v),e.name===t(".mck-file-box."+u+" .mck-file-lb a").html()){var I=h.data("mck-id"),M=e.name+s.size;Pe[M]=I,i.attr("disabled",!0),n.append("file",s);var T=new XMLHttpRequest;(T.upload||T).addEventListener("progress",function(e){var t=parseInt(e.loaded/e.total*100,10);C.css("width",t+"%"),a&&Kommunicate.attachmentEventHandler.progressMeter(t,a.key)}),T.addEventListener("load",function(e){var s=t.parseJSON(this.responseText);if("object"==typeof s){var o=s;if(a){a.fileMeta=o;var n={tabId:a.groupId};return m=KommunicateUI.getAttachmentStopUploadStatus(a.key),KommunicateUI.updateAttachmentTemplate(o,a.key),!m&&ot.submitMessage(a,n),void KommunicateUI.updateImageAttachmentPreview(o,a.key)}var c="object"==typeof o?'<a href="'+o.url+'" target="_blank">'+o.name+"</a>":"",l=o.name,d=o.size,u=h.data("mck-id"),g=l+d,C=Pe[g];return I!==u?(st.updateDraftMessage(C,o),void delete Pe[g]):(y.attr("disabled",!1),v.attr("disabled",!1),i.attr("disabled",!1),delete Pe[g],k.html(c),b.removeClass("vis").addClass("n-vis"),t(".mck-file-box .km-progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),p.push(o),f.data("mckfile",o),v.children("input").val(""),!1)}y.attr("disabled",!1),i.attr("disabled",!1),y.trigger("click")});var E=MCK_BASE_URL+"/rest/ws/upload/image";T.open("post",E,!0),T.setRequestHeader("UserId-Enabled",!0),T.setRequestHeader("Authorization","Basic "+c),T.setRequestHeader("Application-Key",U),T.setRequestHeader("Device-Key",d),W&&T.setRequestHeader("Access-Token",W),T.send(n)}return!1}alert(l.toString())}},e.uplaodFileToAWS=function(e,t){var s=new FormData,o=[];if(void 0!==e)if(-1===e.type.indexOf("image")&&o.push("Please upload image file."),o.length>0)alert(o.toString());else{n.attr("disabled",!0),a[0]===t?(b.find(".mck-overlay-box").removeClass("n-vis"),b.removeClass("mck-hover-on"),I.removeClass("n-vis").addClass("vis")):(k.find(".mck-overlay-box").removeClass("n-vis"),k.removeClass("mck-hover-on"),y.removeClass("n-vis").addClass("vis"));var i=new XMLHttpRequest;i.addEventListener("load",function(e){var s=this.responseText;return s&&(a[0]===t?(T.html('<img src="'+s+'"/>'),T.data("iconurl",s),E.html(MCK_LABELS["change.group.icon"]),I.removeClass("vis").addClass("n-vis"),b.addClass("mck-hover-on")):(M.html('<img src="'+s+'"/>'),M.data("iconurl",s),y.removeClass("vis").addClass("n-vis"),k.addClass("mck-hover-on"),setTimeout(function(){C.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){u.addClass("n-vis")},1500)),n.attr("disabled",!1),a[0]===t?g.val(""):f.val(""),!1}),s.append("file",e),i.open("post",MCK_BASE_URL+"/rest/ws/upload/file",!0),i.setRequestHeader("UserId-Enabled",!0),i.setRequestHeader("Authorization","Basic "+c),i.setRequestHeader("Application-Key",U),i.setRequestHeader("Device-Key",d),W&&i.setRequestHeader("Access-Token",W),i.send(s)}},e.addFileBox=function(e){var a=Je.randomId(),s="";"object"==typeof e.fileMeta&&(a=e.fileMeta.createdAtTime,s=e.fileMeta.name);var o=[{fileNameExpr:e.filelb,fileSizeExpr:e.filesize,fileIdExpr:a,fileName:s}];t.tmpl("fileboxTemplate",o).appendTo("#mck-file-box");var n=t(".mck-file-box."+a),c=n.find(".mck-remove-file"),l=n.find(".progress");"object"==typeof e.fileMeta?(n.data("mckblob",e.fileMeta.blobKey),r.removeAttr("required"),i.attr("disabled",!1),c.attr("disabled",!1),l.removeClass("vis").addClass("n-vis"),p.push(e.fileMeta)):(i.attr("disabled",!0),c.attr("disabled",!0),l.removeClass("n-vis").addClass("vis"))}},st=new function(){var o=this,n="",i=t("#mck-search"),r=t("#mck-msg-to"),c=t(".mck-file-lb"),l=t(".mck-file-sz"),d=t("#mck-sidebox"),m=t("#mck-file-box"),u=t("#mck-msg-sbmt"),g=t("#mck-msg-form"),h=t("#mck-text-box"),b=t("#mck-msg-error"),T=(t("#mck-show-more"),t("#mck-tab-title")),x=t("#mck-tab-status"),A=t("#mck-message-cell"),_=t(".mck-typing-box"),U=(t("#mck-no-messages"),t("#mck-product-box")),K=t(".mck-product-icon"),G=t(".mck-product-title"),N=t(".mck-product-subtitle"),O=t("#mck-product-box .mck-caret"),z=t(".mck-product-rt-up .mck-product-key"),B=t("#mck-contact-search-input-box"),q=t(".mck-product-rt-up .mck-product-value"),j=t(".mck-product-rt-down .mck-product-key"),V=t(".mck-product-rt-down .mck-product-value"),W=(t("#li-mck-group-info"),t("#li-mck-leave-group"),t("#mck-group-info-tab")),Z=t("#mck-group-search-tab"),X=t("#mck-no-search-groups"),ee=t("#mck-group-create-tab"),te=t("#mck-group-search-list"),ae=(t("#mck-group-search-tabview"),t(".mck-group-menu-options")),oe=t(".mck-videocall-btn"),ne=t("#mck-group-search-input"),ce=t("#mck-group-search-input-box"),de=t("#mck-contact-search-list"),me=t("#mck-contacts-content"),pe=t("#mck-contact-search-tab"),ge=(t("#mck-contact-search-tabview"),t("#mck-contact-search-input")),fe=t("#mck-autosuggest-search-input"),ke=t("#mck-autosuggest-metadata"),he=(t("#mck-search-list"),t("#mck-no-search-contacts")),be=t("#mck-search-tab-box li a"),Ee=t("#mck-search-tabview-box"),Se=t("#mck-sidebox-search"),Le=t("#mck-contact-loading"),Ae=t("#mck-typing-label"),Ue=t("#mck-price-widget"),Ke=t("#mck-msg-response"),Re=t("#mck_response_text"),De=t("#li-mck-block-user"),ze=t("#li-mck-video-call"),Be=t("#mck-search-loading"),Pe=t("#mck-tab-individual"),Ze=t("#mck-attachfile-box"),lt=t("#mck-location-sharing-box"),dt=t("#mck-sidebox-content"),mt=t("#mck-tab-option-panel"),vt=t("#mck-tab-conversation"),gt=t("#mck-conversation-header"),ft=(t("#mck-no-conversations"),t("#mck-conversation-list")),kt=t(".mck-tab-message-option"),Ct=t(".mck-box-ft .mck-box-form"),ht=t("#mck-btn-clear-messages"),bt=t("#mck-offline-message-box"),yt=t("#mck-message-cell .mck-message-inner"),It=(t("#mck-msg-new"),new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi));o.init=function(){t.template("convTemplate",'<li id="li-${convIdExpr}" class="${convIdExpr}"><a class="${mckLauncherExpr}" href="#" data-mck-conversationid="${convIdExpr}" data-mck-id="${tabIdExpr}" data-isgroup="${isGroupExpr}" data-mck-topicid="${topicIdExpr}" data-isconvtab="true"><div class="mck-row mck-truncate" title="${convTitleExpr}">${convTitleExpr}</div></a></li>'),t.template("messageTemplate",'<div name="message" data-msgdelivered="${msgDeliveredExpr}" data-msgsent="${msgSentExpr}" data-msgtype="${msgTypeExpr}" data-msgtime="${msgCreatedAtTime}data-msgcontent="${replyIdExpr}" data-msgkey="${msgKeyExpr}" data-contact="${toExpr}" class="mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"><div class="mck-clear"><div class="${nameTextExpr} ${showNameExpr} mck-conversation-name"><span class="mck-ol-status ${contOlExpr}"><span class="mck-ol-icon" title="${onlineLabel}"></span>&nbsp;</span>${msgNameExpr}</div><div class="blk-lg-12"><div class="mck-msg-avator blk-lg-3">{{html msgImgExpr}}</div><div class ="km-conversation-container-right"><div class="mck-msg-box ${msgClassExpr}" style= "background-color: ${msgBoxColor}"><div class="move-right mck-msg-text"></div><div class="mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"><div class="mck-msgto">${msgReplyTo} </div></div><div class="mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"><div class="mck-msgreply-border ${textreplyVisExpr}">${msgReply}</div><div class="mck-msgreply-border ${msgpreviewvisExpr}">{{html msgPreview}}</div></div><div class="mck-msg-text mck-msg-content notranslate"></div></div><div class="km-msg-box-attachment ${attachmentBoxExpr} ">{{html attachmentTemplate}}<div class="km-msg-box-progressMeter ${progressMeterClassExpr} ">{{html progressMeter}}</div></div><div class="mck-msg-box-rich-text-container notranslate ${kmRichTextMarkupVisibility} ${containerType}"><div class="email-message-indicator ${emailMsgIndicatorExpr}"><span><svg xmlns="http://www.w3.org/2000/svg" width="12" height="11" viewBox="0 0 12 11"><path fill="#BCBABA" fill-rule="nonzero" d="M12 3.64244378L7.82144281 0v2.08065889h-.0112584c-1.2252898.0458706-2.30872368.23590597-3.23022417.58877205-1.03614858.39436807-1.89047392.92952513-2.56710409 1.60169828-.53552482.53356847-.95771502 1.14100649-1.27501442 1.8173497-.08349984.17792235-.16437271.35624185-.23304899.54349718-.32987128.89954044-.56029331 1.87632619-.49311816 2.87991943C.02781163 9.76011309.1572833 10.5.30795828 10.5c0 0 .18801538-1.03695368.94795775-2.22482365.23267371-.36259621.50437656-.70533502.81698495-1.02186205l.0350887.03038182v-.06533086c.19420749-.19301397.40079923-.37828356.63497407-.54588006.63272238-.45433742 1.40748832-.8141536 2.32279668-1.0796471.74962217-.21763716 1.60432278-.34412883 2.54909064-.39019801h.20809286l-.00150112 2.08085746L12 3.64244378z"/></svg></span><span>via email</span></div>{{html kmRichTextMarkup}}</div></div></div><div class="${msgFloatExpr}-muted mck-text-light mck-text-xs mck-t-xs ${timeStampExpr} vis"><span class="mck-created-at-time notranslate">${createdAtTimeExpr}</span> <span class="mck-message-status notranslate"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17.06103 10.90199" width="24" height="24" class="${statusIconExpr} mck-message-status notranslate"><path fill="#859479" d="M16.89436.53548l-.57-.444a.434.434 0 0 0-.609.076l-6.39 8.2a.38.38 0 0 1-.577.039l-.427-.388a.381.381 0 0 0-.578.038l-.451.576a.5.5 0 0 0 .043.645l1.575 1.51a.38.38 0 0 0 .577-.039l7.483-9.6a.436.436 0 0 0-.076-.609z" class="mck-delivery-report--delivered-read"></path><path fill="#859479" d="M12.00236.53548l-.57-.444a.434.434 0 0 0-.609.076l-6.39 8.2a.38.38 0 0 1-.577.039l-2.614-2.558a.435.435 0 0 0-.614.007l-.505.516a.435.435 0 0 0 .007.614l3.887 3.8a.38.38 0 0 0 .577-.039l7.483-9.6A.435.435 0 0 0 12.00109.536l-.00073-.00052z"  class="mck-delivery-report--sent"></path><path fill="#859479" d="M9.75 7.713H8.244V5.359a.5.5 0 0 0-.5-.5H7.65a.5.5 0 0 0-.5.5v2.947a.5.5 0 0 0 .5.5h.094l.003-.001.003.002h2a.5.5 0 0 0 .5-.5v-.094a.5.5 0 0 0-.5-.5zm0-5.263h-3.5c-1.82 0-3.3 1.48-3.3 3.3v3.5c0 1.82 1.48 3.3 3.3 3.3h3.5c1.82 0 3.3-1.48 3.3-3.3v-3.5c0-1.82-1.48-3.3-3.3-3.3zm2 6.8a2 2 0 0 1-2 2h-3.5a2 2 0 0 1-2-2v-3.5a2 2 0 0 1 2-2h3.5a2 2 0 0 1 2 2v3.5z" class="mck-delivery-report--pending"></path></svg><p class="mck-sending-failed">Sending failed</p></span></div></div><div class="n-vis mck-context-menu"><ul><li><a class="mck-message-forward ${msgForwardVisibleExpr}">${msgForwardExpr}</a></li><li><a class="mck-message-delete">${msgDeleteExpr}</a></li><li><a class="mck-message-reply">${msgReplyExpr}</a></li></ul></div></div>'),t.template("contactTemplate",'<li id="li-${contHtmlExpr}" class="${contIdExpr}" data-msg-time="${msgCreatedAtTimeExpr}"><a class="${mckLauncherExpr}" href="#" data-mck-conversationid="${conversationExpr}" data-mck-id="${contIdExpr}" data-isgroup="${contTabExpr}"><div class="mck-row" title="${contNameExpr}"><div class="mck-conversation-topic mck-truncate ${contHeaderExpr}">${titleExpr}</div><div class="blk-lg-3">{{html contImgExpr}}<div class="mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"><span class="mck-unread-count-text">{{html contUnreadCount}}</span></div></div><div class="blk-lg-9"><div class="mck-row"><div class="blk-lg-8 mck-cont-name mck-truncate"><div class="mck-ol-status ${contOlExpr}"><span class="mck-ol-icon" title="${onlineLabel}"></span>&nbsp;</div><strong class="mck-truncate">${contNameExpr}</strong></div><div class="mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4">${msgCreatedDateExpr}</div></div><div class="mck-row"><div class="mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"></div></div></div></div></a></li>'),t.template("searchContactbox",'<li id="li-${contHtmlExpr}" class="${contIdExpr}"><a class="applozic-launcher" href="#" data-mck-id="${contIdExpr}" data-isgroup="${contTabExpr}"><div class="mck-row" title="${contNameExpr}"><div class="blk-lg-3">{{html contImgExpr}}</div><div class="blk-lg-9"><div class="mck-row"><div class="blk-lg-12 mck-cont-name mck-truncate"><strong>${contNameExpr}</strong><div class="move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}">${groupUserCountExpr}</div></div><div class="blk-lg-12 mck-text-muted">${contLastSeenExpr}</div></div></div></div></a></li>')},o.openConversation=function(){"none"===d.css("display")&&(t(".mckModal").mckModal("hide"),d.mckModal()),r.focus()},o.initEmojis=function(){try{t("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(e){n||(n=setTimeout(function(){o.initEmojis()},3e4))}},o.loadTab=function(e,s){var n=yt.data("mck-id");if(n)if(h.html().length>1||m.hasClass("vis")){var i=h.html(),c={text:i,files:[]};m.hasClass("vis")&&t(".mck-file-box").each(function(){var e=t(this),a={filelb:e.find(".mck-file-lb").html(),filesize:e.find(".mck-file-sz").html()},s=e.data("mckfile");"object"==typeof s&&(a.fileMeta=s),c.files.push(a)}),qe[n]=c}else delete qe[n];if(f=!0,o.clearMessageField(!1),o.addDraftMessage(e.tabId),b.html(""),b.removeClass("vis").addClass("n-vis"),Re.html(""),Ke.removeClass("vis").addClass("n-vis"),g[0].reset(),g.removeClass("n-vis").addClass("vis"),yt.html(""),b.removeClass("mck-no-mb"),me.removeClass("n-vis").addClass("vis"),Ct.removeClass("vis").addClass("n-vis"),t("#mck-sidebox-ft").removeClass("vis").addClass("n-vis"),Se.removeClass("vis").addClass("n-vis"),W.removeClass("vis").addClass("n-vis"),ee.removeClass("vis").addClass("n-vis"),dt.removeClass("n-vis").addClass("vis"),U.removeClass("vis").addClass("n-vis"),gt.addClass("n-vis"),Le.removeClass("vis").addClass("n-vis"),yt.removeClass("mck-group-inner"),x.removeClass("vis").addClass("n-vis"),T.removeClass("mck-tab-title-w-status"),T.removeClass("mck-tab-title-w-typing"),_.removeClass("vis").addClass("n-vis"),Ae.html(MCK_LABELS.typing),yt.data("isgroup",e.isGroup),yt.data("datetime",""),e.tabId){if(r.val(e.tabId),yt.data("mck-id",e.tabId),yt.data("mck-conversationid",e.conversationId),yt.data("mck-topicid",e.topicId),mt.data("tabId",e.tabId),mt.removeClass("n-vis").addClass("vis"),me.removeClass("vis").addClass("n-vis"),Ct.removeClass("n-vis").addClass("vis"),t("#mck-sidebox-ft").removeClass("n-vis").addClass("vis"),ht.removeClass("n-vis").addClass("vis"),ae.removeClass("vis").addClass("n-vis"),e.isGroup?(yt.addClass("mck-group-inner"),De.removeClass("vis").addClass("n-vis"),ze.removeClass("vis").addClass("n-vis"),oe.removeClass("vis").addClass("n-vis"),KommunicateUI.activateTypingField()):(De.removeClass("n-vis").addClass("vis"),ze.removeClass("n-vis").addClass("vis"),F&&oe.removeClass("n-vis").addClass("vis")),!e.topicId&&e.conversationId){var l=M[e.conversationId];"object"==typeof l&&(e.topicId=l.topicId)}if(e.topicId){var d=y[e.topicId];"object"==typeof d&&(_e?(yt.data("mck-title",d.title),gt.html(d.title),gt.removeClass("n-vis")):ye&&(o.setProductProperties(d,e.topicId),O.addClass("n-vis"),U.addClass("mck-product-box-wc"),ft.addClass("n-vis"),U.removeClass("n-vis").addClass("vis")))}P&&a.google&&"object"==typeof a.google.maps?(Ze.removeClass("vis").addClass("n-vis"),lt.removeClass("n-vis").addClass("vis")):(lt.removeClass("vis").addClass("n-vis"),Ze.removeClass("n-vis").addClass("vis"));var p=o.getTabDisplayName(e.tabId,e.isGroup,e.userName);o.isGroupDeleted(e.tabId,e.isGroup)&&(b.html(MCK_LABELS["group.deleted"]),b.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),g.removeClass("vis").addClass("n-vis")),T.html(p),T.attr("title",p),vt.removeClass("vis").addClass("n-vis"),Ee.removeClass("vis").addClass("n-vis"),Pe.removeClass("n-vis").addClass("vis"),"support"===L&&t(".mck-tab-link").removeClass("vis").addClass("n-vis"),re&&(Ue.removeClass("n-vis").addClass("vis"),yt.addClass("mck-msg-w-panel")),R&&(b.html("Deactivated"),b.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),g.removeClass("vis").addClass("n-vis"));var u=e.isGroup?e.tabId:Ce;Tt.subscibeToTypingChannel(u,e.isGroup),"function"==typeof Q&&Q({tabId:e.tabId,isGroup:e.isGroup})}else{e.tabId="",Te&&st.hideOfflineMessage(),Pe.removeClass("vis").addClass("n-vis"),vt.removeClass("n-vis").addClass("vis"),Ee.removeClass("n-vis").addClass("vis"),U.removeClass("vis").addClass("n-vis"),yt.data("mck-id",""),yt.data("mck-conversationid",""),yt.data("mck-topicid",""),Ue.removeClass("vis").addClass("n-vis"),yt.removeClass("mck-msg-w-panel"),mt.removeClass("vis").addClass("n-vis"),ht.removeClass("vis").addClass("n-vis"),r.val("");var v=ALStorage.getLatestMessageArray();if(Tt.unsubscibeToTypingChannel(),null!==v&&v.length>0)return e.isReload=!0,st.addContactsFromMessageList({message:v},e),o.openConversation(),void(f=!1)}ot.loadMessageList(e,s),o.openConversation()},o.setProductProperties=function(e,t){G.html(e.title),K.html(o.getTopicLink(e.link));var a=e.subtitle?e.subtitle:"";N.html(a);var s=e.key1?e.key1:"",n=e.value1?":"+e.value1:"";z.html(s),q.html(n);var i=e.key2?e.key2:"",r=e.value2?":"+e.value2:"";j.html(i),V.html(r),"function"==typeof H&&(e.topicId=t,H(e))},o.getTopicLink=function(e){return e?'<img src="'+e+'">':'<span class="mck-icon-no-image"></span>'},o.processMessageList=function(e,a,s){var n,i=yt.children("div[name='message']:first"),r=yt.data("mck-id"),c=yt.data("isgroup"),l=c?et.getGroup(r):st.fetchContact(r);if(void 0===e.message.length){var d=[];d.push(e.message),ALStorage.updateMckMessageArray(d),o.addMessage(e.message,l,!1,!1,s),n=e.createdAtTime}else ALStorage.updateMckMessageArray(e.message),t.each(e.message,function(e,t){void 0!==t.to&&(o.addMessage(t,l,!1,!1,s),Kommunicate.appendEmailToIframe(t),n=t.createdAtTime)});mt.data("datetime",n),!a&&i.length>0?yt.scrollTop(i.offset().top-yt.offset().top+yt.scrollTop()):a&&yt.animate({scrollTop:yt.prop("scrollHeight")},"slow")},o.closeConversation=function(e){if("function"==typeof Y){var t=Y();if("object"==typeof t)var a="BUSY_WITH_OTHER"===e?t.onBusyWithOtherUser:t.onConversationClose}a||(a="Chat disabled with user"),b.html(a),b.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),g.removeClass("vis").addClass("n-vis")},o.addTooltip=function(e){t("."+e+" .mck-pending-icon").attr("title","pending"),t("."+e+" .mck-btn-trash").attr("title","delete"),t("."+e+" .mck-sent-icon").attr("title","sent"),t("."+e+" .mck-btn-forward").attr("title","forward message"),t("."+e+" .mck-delivered-icon").attr("title","delivered"),t("."+e+" .mck-read-icon").attr("title","delivered and read"),t("."+e+" .msgtype-outbox-cr").attr("title","sent via Carrier"),t("."+e+" .msgtype-outbox-mck").attr("title","sent"),t("."+e+" .msgtype-inbox-cr").attr("title","received via Carrier"),t("."+e+" .msgtype-inbox-mck").attr("title","recieved")},o.fetchContact=function(e){var t=o.getContact(e);return void 0===t&&(t=o.createContact(e)),t},o.getContact=function(e){return"object"==typeof v[e]?v[e]:void 0},o.getContactDisplayName=function(e){if("string"==typeof He[e])return He[e];if(void 0===He[e]){var t=pt.MCK_USER_DETAIL_MAP[e];return void 0!==t?t.displayName:void 0}},o.sendUserEmail=function(){if(document.getElementById("input-for-email").value.length>1){var e=document.getElementById("input-for-email").value;nt.updateUser({data:{email:e},success:function(e){console.log("email updated successfully !"),t("#input-for-email").after("<div style='width: 100px; margin: auto;'><span>Email Sent</span></div>"),t("#input-for-email").remove(),t("#send-email-button").remove()},error:function(e){}})}else alert("No email")},o.updateMetadata=function(e,t){var s=a.JSON.stringify({key:e,metadata:t});Je.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",global:!1,data:s,contentType:"application/json",success:function(e){console.log("metadata cleared successfully !")}})},o.addMessage=function(e,n,i,r,c){var l="",d="",m="",p="vis",u="n-vis",v="",g="n-vis",f="n-vis",k="vis",C="n-vis",b="n-vis";if("object"==typeof e.metadata&&void 0!==e.metadata.AL_REPLY&&(l=e.metadata.AL_REPLY,void 0!==(d=rt.getReplyMessageByKey(l))&&((n.isGroup&&d||!n.isGroup&&void 0===d.fileMeta)&&(g="vis"),v=5===d.type?"You":st.getTabDisplayName(d.to,!1),"object"!=typeof d.fileMeta&&2!==d.contentType||(m=o.getImageForReplyMessage(d),p="n-vis",u="vis",g="n-vis"))),6!==e.type&&7!==e.type&&!(e.metadata&&"HIDDEN"===e.metadata.category||102===e.contentType||e.metadata&&(e.metadata.KM_ASSIGN||e.metadata.KM_STATUS)||10===e.contentType&&e.metadata&&"true"===e.metadata.hide||t("#mck-message-cell ."+e.key).length>0)){e.source==MESSAGE_SOURCE.MAIL_INTERCEPTOR&&(f="vis",t(".email-conversation-indicator").addClass("vis").removeClass("n-vis")),e.contentType==MESSAGE_CONTENT_TYPE.ATTACHMENT||e.contentType==MESSAGE_CONTENT_TYPE.LOCATION?(k="n-vis",C="n-vis",b="vis"):k=e.contentType==MESSAGE_CONTENT_TYPE.TEXT_HTML&&e.source==MESSAGE_SOURCE.MAIL_INTERCEPTOR||e.contentType==MESSAGE_CONTENT_TYPE.DEFAULT&&"string"!=typeof e.message?"n-vis":"vis";var I="mck-msg-right",T="",E="mck-pending-icon",x="mck-timestamp-"+e.key;0!==e.type&&4!==e.type&&6!==e.type||(I="mck-msg-left"),4!==e.contentType&&10!==e.contentType&&103!==e.contentType||(I="mck-msg-center"),"mck-msg-right"===I&&S&&S.primaryColor&&(T=S.primaryColor),E=o.getStatusIconName(e);var L=e.key,A="'"+e.deviceKey+"','"+e.to+"','"+e.to+"','"+L+"'",_="",w="",U="",K="n-vis",G="";if(pt.loadUserProfile(e.to),!e.groupId||4===e.contentType||7===n.type||0!==e.type&&4!==e.type&&6!==e.type||(_=o.getTabDisplayName(e.to,!1),K="vis",U=o.getNameTextClassByAlphabet(_)),Me){G="mck-msg-avator-bubble";var N="",O=_;"mck-msg-right"===I?(N=st.fetchContact(Ce),O=o.getTabDisplayName(N.displayName,!1)):"mck-msg-left"===I&&(N=e.groupId?st.fetchContact(e.to):n),N&&(w=o.getContactImageLink(N,O))}e.groupId&&10===e.contentType&&(_="",w="",U="");var R="n-vis",D="",z="",B=e.message;"object"==typeof e.fileMeta&&(D=e.fileMeta.name,z=e.fileMeta.size),"object"==typeof e.fileMeta&&(e.fileMeta.contentType.indexOf("audio")||e.fileMeta.contentType.indexOf("image")||e.fileMeta.contentType.indexOf("video"))&&(R="vis");var P="n-vis";Ie&&a.MCK_OL_MAP[e.to]&&10!==e.contentType&&(P="vis");var F=Kommunicate.isRichTextMessage(e.metadata)||3==e.contentType,$=F?"vis":"n-vis",q=F?Kommunicate.getRichTextMessageTemplate(e):"",H=Kommunicate.getContainerTypeForRichMessage(e),j=Kommunicate.isAttachment(e),V=j?Kommunicate.messageTemplate.getAttachmentContanier(e,st.getFilePath(e)):"";if(e.contentType==MESSAGE_CONTENT_TYPE.ATTACHMENT){var C=j?"n-vis":"vis";b=j?"vis":"n-vis";var Y=!j||e.fileMeta.url||e.fileMeta.blobKey?"":Kommunicate.messageTemplate.getProgressMeterContanier(e.key)}var W=[{msgReply:d?d.message+"\n":"",msgReplyTo:d?v+"\n":"",msgReplyDivExpr:d?"vis":"n-vis",msgReplyToVisibleExpr:g,msgPreview:m?o.getImageForReplyMessage(d):"",msgpreviewvisExpr:u,textreplyVisExpr:p,msgKeyExpr:e.key,msgDeliveredExpr:e.delivered,msgSentExpr:e.sent,msgCreatedAtTime:e.createdAtTime,msgTypeExpr:e.type,msgDeleteExpr:MCK_LABELS.delete,msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"kommunicate"==window.applozic.PRODUCT_ID?"n-vis":"vis",msgSourceExpr:e.source,statusIconExpr:E,contactExpr:"vis",toExpr:e.to,msgAvatorClassExpr:G,showNameExpr:K,msgNameExpr:_,msgImgExpr:w,nameTextExpr:U,msgFloatExpr:I,timeStampExpr:x,replyIdExpr:L,createdAtTimeExpr:mckDateUtils.getDate(e.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:A,downloadMediaUrlExpr:ct.getFileAttachment(e),msgClassExpr:k,msgBoxColor:T,progressMeterClassExpr:C,attachmentBoxExpr:b,msgExpr:B,selfDestructTimeExpr:e.timeToLive,fileMetaKeyExpr:e.fileMetaKey,downloadIconVisibleExpr:R,fileExpr:st.getFilePath(e),fileUrlExpr:ct.getFileurl(e),fileNameExpr:D,fileSizeExpr:z,contOlExpr:P,kmRichTextMarkupVisibility:$,kmRichTextMarkup:q,containerType:H,emailMsgIndicatorExpr:f,attachmentTemplate:V,progressMeter:Y}];if(i?t.tmpl("messageTemplate",W).appendTo("#mck-message-cell .mck-message-inner"):t.tmpl("messageTemplate",W).prependTo("#mck-message-cell .mck-message-inner"),(!e.metadata.obsolete||"true"!=e.metadata.obsolete)&&e.metadata.KM_AUTO_SUGGESTION){var J={};try{J=JSON.parse(e.metadata.KM_AUTO_SUGGESTION)}catch(e){console.error("suggestionList should be an array")}fe.addClass("mck-text-box").removeClass("n-vis"),h.removeClass("mck-text-box").addClass("n-vis"),fe.attr("placeholder",J.placeholder?J.placeholder:""),fe.data("prev-msgkey",e.key),J.source.constructor==Array?(fe.data("origin","KM_AUTO_SUGGEST"),J.source.length&&st.populateAutoSuggest({source:J.source})):"object"==typeof J.source&&(fe.data("source-url",J.source.url),fe.data("method",J.source.method?J.source.method:"get"),fe.data("headers",J.source.headers?J.source.headers:{}))}if(23===e.contentType){if("BUTTON"===e.metadata.msg_type){var Z=[];if(e.metadata.payload){if(!(Z=t.parseJSON(e.metadata.payload))[0].hidden)var Q="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>"+Z[0].title+"</button></div>";if(Z.length>1)for(var X=1;X<Z.length;X++)Z[X].hidden||(Q+="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>"+Z[X].title+"</button></div>");t("div[data-msgkey='"+e.key+"'] .blk-lg-12").after(Q)}else{console.log("msg.contentType === 23 && metadata.msg_type === BUTTON");var Q="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>Button</button></div>";t("div[data-msgkey='"+e.key+"'] .blk-lg-12").after(Q)}}if("INPUT"===e.metadata.msg_type&&"false"===e.metadata.hidden){console.log("msg.contentType === 23 && metadata.msg_type === INPUT");var Q="<div style='float: left; margin: 13px; width: 100%'><input id='input-for-email' type='text' style='background-color: #FFF;width: 60%;height:35px;' placeholder='Enter your email...'/>";Q+="<button id='send-email-button' style='height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'>Submit</button></div>",t("div[data-msgkey='"+e.key+"'] .blk-lg-12").after(Q),t("#send-email-button").click(function(){document.getElementById("input-for-email").value.length>1&&(o.sendUserEmail(),o.updateMetadata(e.key,{hidden:"true"}))})}if("LIST"===e.metadata.msg_type){var Z=[];if(e.metadata.payload){Z=t.parseJSON(e.metadata.payload),console.log("msg.contentType === 23 && metadata.msg_type === LIST");var Q="";if(Z[0].hidden||("button"===Z[0].type.toLowerCase()?Q="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>"+Z[0].title+"</button></div>":"input"===Z[0].type.toLowerCase()&&(Q="<div style='float: left; margin: 13px; width: 100%'><input type='text' style='background-color: #FFF;width: 60%;height:35px;' placeholder='Enter your email...'/>",Q+="<button style='height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'>"+Z[0].title+"</button></div>")),Z.length>1)for(var X=1;X<Z.length;X++)Z[X].hidden||("button"===Z[X].type.toLowerCase()?Q+="<div style='width: 100px; margin: auto;'><button style='height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'>"+Z[X].title+"</button></div>":"input"===Z[X].type.toLowerCase()&&(Q+="<div style='float: left; margin: 13px; width: 100%'><input type='text' style='background-color: #FFF;width: 60%;height:35px;' placeholder='Enter your email...'/>",Q+="<button style='height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'>"+Z[X].title+"</button></div>"));t("div[data-msgkey='"+e.key+"'] .blk-lg-12").after(Q)}}}var ee="";if(e.message){var te=e.message.replace(/\n/g,"<br/>");null!==a.emoji&&void 0!==a.emoji?(ee=a.emoji.replace_unified(te),ee=a.emoji.replace_colons(ee)):ee=te}if(e.conversationId){var ae=M[e.conversationId];if("object"!=typeof ae&&rt.getTopicId({conversationId:e.conversationId},function(e){st.populateMessage(e.messageType,e.message,e.notifyUser)}),i&&(yt.data("mck-conversationid",e.conversationId),ae)){var se=y[ae.topicId];"object"==typeof se&&(ye?o.setProductProperties(se,ae.topicId):_e&&gt.html(se.title))}}if(4===e.contentType){var oe=ee;ee="Final agreed price: "+ee,re||(ee+='<br/><button class="mck-accept" data-mck-topic-price="'+oe+'" data-mck-conversationid="'+e.conversationId+'">Accept</button>')}var ne=t("."+L+" .mck-msg-content");if(-1===ee.indexOf("emoji-inner")&&0===e.contentType)for(var ie=ee.split("<br/>"),X=0;X<ie.length;X++){if(""===ie[X])var ce=s.createElement("BR");else{var ce=s.createElement("div");ce.appendChild(s.createTextNode(ie[X])),ie[X]&&ie[X].match(It)&&(ce=t(ce).linkify({target:"_blank"}))}ne.append(ce)}else ne.html(ee),ne.linkify({target:"_blank"});if(F&&Kommunicate.richMsgEventHandler.initializeSlick(t("div[data-msgkey='"+e.key+"'] .km-div-slider")),e.fileMeta&&(-1!=e.fileMeta.contentType.indexOf("image")&&-1==t("."+L+" .mck-file-text a:first")[0].dataset.url.indexOf("undefined")&&t("."+L+" .mck-file-text a:first").trigger("click"),t("."+L+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===ne.html()&&ne.removeClass("vis").addClass("n-vis")),2===e.contentType&&(ne.removeClass("vis").addClass("n-vis"),t("."+L+" .mck-file-text").removeClass("n-vis").addClass("vis")),r&&yt.animate({scrollTop:yt.prop("scrollHeight")},"slow"),kt.hasClass("n-vis"))if(e.groupId){var le=et.getGroup(e.groupId);6!==le.type&&kt.removeClass("n-vis").addClass("vis")}else kt.removeClass("n-vis").addClass("vis");o.addTooltip(e.key),4!==e.contentType&&10!==e.contentType&&c&&o.messageContextMenu(e.key),e.groupId&&10===e.contentType&&i&&Xe.getGroupFeed({groupId:e.groupId,isReloadTab:!0,apzCallback:tt.onGroupFeed}),4===e.source&&t(".mck-msg-box-rich-text-container .km-faq-answer--body_ans").linkify({target:"_blank"})}},o.addContactForSearchList=function(e,s){var n=e.userCount,i=e.isGroup,r=o.getTabDisplayName(e.contactId,i),c=o.getContactImageLink(e,r),l=(i?e.contactId:e.contactId,i?"gs-group-"+e.htmlId:"cs-user-"+e.htmlId),d="",m=i&&xe;t("#li-"+l+" .mck-group-count-text").html(n),i||k[e.contactId]||(a.MCK_OL_MAP[e.contactId]?d=MCK_LABELS.online:I[e.contactId]&&(d=mckDateUtils.getLastSeenAtStatus(I[e.contactId])));var p=[{contHtmlExpr:l,contIdExpr:e.contactId,contTabExpr:e.isGroup,contImgExpr:c,contLastSeenExpr:d,contNameExpr:r,groupUserCountExpr:e.userCount,displayGroupUserCountExpr:m?"vis":"n-vis"}];t.tmpl("searchContactbox",p).prependTo("#"+s)},o.getFilePath=function(e){if(2===e.contentType)try{var a=t.parseJSON(e.message);if(a.lat&&a.lon)return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+a.lat+","+a.lon+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+a.lat+","+a.lon+"&maptype=roadmap&markers=color:red|"+a.lat+","+a.lon+"&key="+ue+'"/></a>'}catch(t){if(-1!==e.message.indexOf(","))return'<a href="http://maps.google.com/maps?z=17&t=m&q=loc:'+e.message+'" target="_blank"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+e.message+"&maptype=roadmap&markers=color:red|"+e.message+"&key="+ue+'" /></a>'}return"object"==typeof e.fileMeta?-1!==e.fileMeta.contentType.indexOf("image")?-1!==e.fileMeta.contentType.indexOf("svg")?'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox" data-type="'+e.fileMeta.contentType+'" data-url="'+ct.getFileurl(e)+'" data-name="'+e.fileMeta.name+'"><img src="'+$+"/rest/ws/aws/file/"+e.fileMeta.blobKey+'" area-hidden="true"></img></a>':5===e.contentType?'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox" data-type="'+e.fileMeta.contentType+'" data-url="'+e.fileMeta.blobKey+'" data-name="'+e.fileMeta.name+'"><img src="'+e.fileMeta.blobKey+'" area-hidden="true"></img></a>':e.fileMeta.hasOwnProperty("url")?e.fileMeta.hasOwnProperty("thumbnailBlobKey")?'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox" data-type="'+e.fileMeta.contentType+'" data-url="'+o.cloudupdate(e.fileMeta.BlobKey)+'" data-name="'+e.fileMeta.name+'"><img src="'+o.cloudupdate(e.fileMeta.thumbnailBlobKey)+'" area-hidden="true" ></img></a>':'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox" data-type="'+e.fileMeta.contentType+'" data-url="'+ct.getFileurl(e)+'" data-name="'+e.fileMeta.name+'"><img src="'+e.fileMeta.thumbnailUrl+'" area-hidden="true" ></img></a>':e.fileMeta.thumbnailUrl==="thumbnail_"+e.fileMeta.name?'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox" data-type="'+e.fileMeta.contentType+'" data-url="'+ct.getFileurl(e)+'" data-name="'+e.fileMeta.name+'"><img src="'+w+"/files/thumbnail_"+e.fileMeta.name+'" area-hidden="true" ></img></a>':'<a href="#" target="_self"  role="link" class="file-preview-link fancybox-media fancybox" data-type="'+e.fileMeta.contentType+'" data-url="'+ct.getFileurl(e)+'" data-name="'+e.fileMeta.name+'"><img src="'+e.fileMeta.thumbnailUrl+'" area-hidden="true" ></img></a>':-1!==e.fileMeta.contentType.indexOf("video")?'<a href= "#" target="_self"  ><video controls class="mck-video-player"><source src="'+ct.getFileurl(e)+'" type="video/mp4"><source src="'+ct.getFileurl(e)+'" type="video/ogg"></video></a>':-1!==e.fileMeta.contentType.indexOf("audio")?'<a href="#" target="_self" ><audio controls class="mck-audio-player"><source src="'+ct.getFileurl(e)+'" type="audio/ogg"><source src="'+ct.getFileurl(e)+'" type="audio/mpeg"></audio><p class="mck-file-tag"></p></a>':'<a href="#" role="link" class="file-preview-link" target="_blank"></a>':""},o.getImageForMessagePreview=function(e){if("object"==typeof e.fileMeta)return-1!==e.fileMeta.contentType.indexOf("image")?'<span>photo</span> <img src="'+$+"/rest/ws/aws/file/"+e.fileMeta.blobKey+'" class="mck-image-reply move-right"/>':-1!==e.fileMeta.contentType.indexOf("audio")?'<span>audio</span><span class="mck-file-detail move-right"><span class="mck-file-name"><span class="mck-icon-attachment"></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+ct.getFilePreviewSize(e.fileMeta.size)+"</span></span>":'<span class="mck-file-detail move-right"><span class="mck-file-name"><span class="mck-icon-attachment"></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+ct.getFilePreviewSize(e.fileMeta.size)+"</span></span>";if(2===e.contentType){var a=t.parseJSON(e.message);return'<span>location</span><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+a.lat+","+a.lon+"&maptype=roadmap&markers=color:red|"+a.lat+","+a.lon+'" class="mck-image-reply move-right"/>'}},o.getImageForReplyMessage=function(e){var a=st.getTabDisplayName(e.to,!1);if("object"==typeof e.fileMeta)return-1!==e.fileMeta.contentType.indexOf("image")?'<div><div class="mck-imagereply mck-margin"><div class="mck-msgto">'+a+'</div><div><span class="mck-icon-camera mck-camera"></span><span>Photo</span></div></div><div class="mck-imagereply"><img src="'+ct.getFileurl(e)+'" class="mck-image-reply mck-msg-text mck-msg-content"/></div></div>':-1!==e.fileMeta.contentType.indexOf("audio")?'<div class="mck-attachmentmsgto">'+a+'</div><span class="mck-file-detail mck-msg-text mck-msg-content"><span class="mck-file-name"><span class="mck-icon-attachment"></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+ct.getFilePreviewSize(e.fileMeta.size)+"</span></span>":'<div class="mck-attachmentmsgto">'+a+'</div><span class="mck-file-detail"><span class="mck-file-name"><span class="mck-icon-attachment"></span>&nbsp;'+e.fileMeta.name+'</span>&nbsp;<span class="file-size">'+ct.getFilePreviewSize(e.fileMeta.size)+"</span></span>";if(2===e.contentType){var s=t.parseJSON(e.message);return'<div><div class="mck-imagereply mck-margin"><div class="mck-msgto">'+a+'</div><span class="mck-icon-marker mck-location-icon"></span><span>Location</span></div><div class="mck-imagereply"><img src="https://maps.googleapis.com/maps/api/staticmap?zoom=17&size=200x150&center='+s.lat+","+s.lon+"&maptype=roadmap&markers=color:red|"+s.lat+","+s.lon+'" class="mck-image-reply mck-msg-text "/></div></div>'}},o.getImageUrlForGroupType=function(e,t){return e.imageUrl?'<img src="'+e.imageUrl+'"/>':o.getContactImageByAlphabet(t)},o.getContactImageLink=function(e,t){var a="";if(e.members&&10==e.type)a=o.getImageUrlForGroupType(e,t);else if(e.isGroup&&7!==e.type)a=Xe.getGroupImage(e.imageUrl);else{if(e.isGroup&&7===e.type&&e.members.length>1&&Xe.getContactFromGroupOfTwo(e,function(t){e=st.fetchContact(t)}),"function"==typeof ie){var s=ie(e.contactId);s&&void 0!==s&&(a='<img src="'+s+'"/>')}a||(e.photoSrc?a='<img src="'+e.photoSrc+'"/>':e.photoData?a='<img src="data:image/jpeg;base64,'+e.photoData+'"/>':e.photoLink?a='<img src="'+MCK_BASE_URL+"/contact.image?photoLink="+e.photoLink+'"/>':"bot"==e.contactId?a='<img src="https://api.kommunicate.io/img/logo02.svg"/>':(t||(t=e.displayName),a=o.getContactImageByAlphabet(t)))}return a},o.getContactImageByAlphabet=function(e){if(void 0===e||""===e)return'<div class="mck-alpha-contact-image mck-alpha-user"><span class="mck-icon-user"></span></div>';var t=e.charAt(0);return t.match(/^[a-zA-Z0-9]+$/)?'<div class="mck-videocall-image alpha_'+(t=t.toUpperCase())+'"><span class="mck-contact-icon">'+t+"</span></div>":'<div class="mck-videocall-image alpha_user"><span class="mck-icon-user"></span></div>'},o.getNameTextClassByAlphabet=function(e){if(void 0===e||""===e)return"mck-text-user";var t=(e=e.toString()).charAt(0);return t.match(/^[a-zA-Z0-9]+$/)?"mck-text-"+(t=t.toLowerCase()):"mck-text-user"},o.addContactsFromMessageList=function(e,a){var s;if(e+""!="null"){if(0==yt.has(t("#mck-contact-list")).length&&yt.html('<ul id="mck-contact-list" class="mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"></ul>'),void 0===e.message.length?(e.message.groupId?Xe.addGroupFromMessage(e.message,!1,function(e,t,a){o.updateRecentConversationList(e,t,a)}):o.addContactsFromMessage(e.message),s=e.message.createdAtTime):t.each(e.message,function(e,t){void 0!==t.to&&(t.groupId?Xe.addGroupFromMessage(t,!0,function(e,t,a){o.updateRecentConversationList(e,t,a)}):o.addContactsFromMessage(t,!0),s=t.createdAtTime)}),yt.data("datetime",s),a.isReload){var n="";if(a.lastActiveTabId){var i=a.isLastActiveTabGroup?"group-"+a.lastActiveTabId:"user-"+mckContactUtils.formatContactId(a.lastActiveTabId);n=t("#li-"+i)}n.length>0?yt.animate({scrollTop:n.offset().top-yt.offset().top+yt.scrollTop()},"fast"):yt.animate({scrollTop:0},0)}}else s=""},o.addGroupFromMessageList=function(e,a){e+""!="null"&&(a&&yt.html('<ul id="mck-group-list" class="mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"></ul>'),void 0===e.message.length?Xe.addGroupFromMessage(e.message,!1,function(e,t,a){o.updateRecentConversationList(e,t,a)}):t.each(e.message,function(e,t){void 0!==t.to&&Xe.addGroupFromMessage(t,!0,function(e,t,a){o.updateRecentConversationList(e,t,a)})}))},o.createContact=function(e){var t=o.getContactDisplayName(e);void 0===t&&(t=e);var a={contactId:e,htmlId:mckContactUtils.formatContactId(e),displayName:t,name:t+" <"+e+"> [Main]",value:e,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return v[e]=a,a},o.createContactWithDetail=function(e){var t=e.displayName,a=e.userId;t||(t=o.getContactDisplayName(a)),void 0===t?t=a:He[a]=t;var s=e.photoLink?e.photoLink:"";s||(s=e.imageLink?e.imageLink:"");var n=e.imageData?e.imageData:"",i={contactId:a,htmlId:mckContactUtils.formatContactId(a),displayName:t,name:t+" <"+a+"> [Main]",value:a,photoLink:"",photoSrc:s,photoData:n,email:"",unsaved:!0,isGroup:!1,roleType:e.roleType};return v[a]=i,i},o.updateContactDetail=function(e,t){var a=t.displayName,s=t.userId;e.displayName&&e.displayName!==e.contactId||(a||(a=o.getContactDisplayName(s)),void 0===a?a=s:He[s]=a,e.displayName=a);var n=t.photoLink;n||(n=t.imageLink?t.imageLink:""),n&&!e.photoSrc&&(e.photoSrc=n);var i=t.imageData?t.imageData:"";return i&&!e.photoData&&(e.photoData=i),t.roleType&&(e.roleType=t.roleType),v[s]=e,e},o.addContactsFromMessage=function(e,t){var a=o.getUserIdFromMessage(e);if(a.length>0&&a[0])for(var s=0;s<a.length;s++){var n=o.fetchContact(""+a[s]);o.updateRecentConversationList(n,e,t)}},o.updateRecentConversationList=function(e,a,s){if(!a||!a.metadata||!a.metadata.KM_ASSIGN&&!a.metadata.KM_STATUS){var n="mck-contact-list",i=e.isGroup?"group-"+e.htmlId:"user-"+e.htmlId;if(t("#"+n+" #li-"+i).length>0){var r=t("#"+n+" #li-"+e.htmlId+" .mck-cont-msg-wrapper");(r.is(":empty")||s)&&void 0!==a&&o.updateContact(e,a,n)}else o.addContact(e,n,a)}},o.addContactsToSearchList=function(){var e=[],a=[];if(t.each($e,function(e,t){a.push(t.contactId)}),"undefined"!=typeof contactList){var s={async:!1};s.userIds=contactList,nt.getUsersDetail(s.userIds,s),a=contactList}var n=a.filter(function(e,t){return a.indexOf(e)===t});n.sort(),Be.removeClass("vis").addClass("n-vis"),n.length>0?t.each(n,function(a,s){if(s){var n=o.fetchContact(""+s);e.push(n),0===t("#li-cs-user-"+n.htmlId).length&&o.addContactForSearchList(n,"mck-contact-search-list")}}):he.removeClass("n-vis").addClass("vis"),o.initAutoSuggest({contactsArray:e,$searchId:ge,isContactSearch:!0})},o.populateAutoSuggest=function(t){fe.mcktypeahead({order:"desc",hint:!1,minLength:3,wrapper:".mck-sidebox",backdropOnFocus:!0,menu:'<ul class="mcktypeahead mck-auto-suggest-menu mck-dropup-menu"></ul>',show:function(){var t=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({left:t.left}),this.$menu.show(),this.shown=!0,this},source:t&&t.source?o.processAutosuggestData(t.source):function(e,a){Je.ajax({url:t.sourceUrl+e,type:t.method,header:t.headers,success:function(e){var t=o.processAutosuggestData(e.data);a(t)}})},items:8,updater:function(e){var t=JSON.parse(e);return 0!=Object.keys(t.metadata).length&&ke.val(JSON.stringify(t.metadata)),h.text(t.displayMessage),t.displayMessage},matcher:function(e){var t=new RegExp(this.query,"i");return t.test(e.searchKey)},highlighter:function(e){var t=JSON.parse(e.toString());return t.displayMessage}})},o.processAutosuggestData=function(e){var t=new Array;return e.map(function(e){var a="string"==typeof e?{searchKey:e,message:e,metadata:{}}:e,s={searchKey:a.searchKey,toString:function(){var e={displayMessage:a.message,metadata:a.metadata?a.metadata:{}};return JSON.stringify(e)},toLowerCase:function(){return a.searchKey.toLowerCase()},indexOf:function(e){return String.prototype.indexOf.apply(a.searchKey,arguments)},replace:function(e){var t=a.searchKey;return String.prototype.replace.apply('<div style="padding: 10px; font-size: 1.5em;">'+t+"</div>",arguments)}};t.push(s)}),t},o.initAutoSuggest=function(e){for(var a,s=e.contactsArray,n=e.$searchId,i=[],r={},c=[],l=0;l<s.length;l++){var d=s[l];d.displayName=o.getTabDisplayName(d.contactId,d.isGroup),a=d.displayName?t.trim(d.displayName):t.trim(d.contactId),(!0===MCK_SELF_CHAT_DISABLE&&d.contactId!==Ce||!0!==MCK_SELF_CHAT_DISABLE)&&(r[a]=d,i.push(a),c.push(a))}var m=function(e){var t=r[e],a=t.displayName.split(" "),s=a.length,o=a[0],n="",i="";2===s?i=a[1]:s>=3&&(i=a[s-1],n=a[s-2]);var c=new RegExp(this.query,"i");return c.test(t.displayName)||c.test(t.contactId)||c.test(n)||c.test(i)||c.test(t.email)||c.test(o+" "+i)},p=function(e){var t=r[e];return t.displayName},u=function(a){var s=r[a];e.isContactSearch?(st.loadTab({tabId:s.contactId,isGroup:s.isGroup}),Ct.removeClass("n-vis").addClass("vis"),t("#mck-sidebox-ft").removeClass("n-vis").addClass("n-vis")):tt.addGroupMemberFromSearch(s.contactId)};if(n.hasClass("mck-typeahead"))return n.mcktypeahead().data("mcktypeahead").source=i,n.mcktypeahead().data("mcktypeahead").matcher=m,n.mcktypeahead().data("mcktypeahead").highlighter=p,void(n.mcktypeahead().data("mcktypeahead").updater=u);n.addClass("mck-typeahead"),n.mcktypeahead({source:i,matcher:m,highlighter:p,updater:u})},o.initSearchAutoType=function(){Ge&&(ge.keypress(function(e){if(13===e.which){var t=ge.val();t&&(!0===MCK_SELF_CHAT_DISABLE&&t!==Ce||!0!==MCK_SELF_CHAT_DISABLE)&&(t=void 0!==t&&""!==t?t.toString():"")&&(st.loadTab({tabId:t,isGroup:!1,isSearch:!0}),Ct.removeClass("n-vis").addClass("vis")),ge.val("")}}),ne.keypress(function(e){if(13===e.which)return!0}),t(s).on("click",".mck-group-search-link",function(e){return e.preventDefault(),!0}),t(s).on("click",".mck-contact-search-link",function(e){e.preventDefault();var a=ge.val();""!==a&&(!0===MCK_SELF_CHAT_DISABLE&&a!==Ce||!0!==MCK_SELF_CHAT_DISABLE)&&(st.loadTab({tabId:a,isGroup:!1,isSearch:!0}),Ct.removeClass("n-vis").addClass("vis"),t("#mck-sidebox-ft").removeClass("n-vis").addClass("vis")),ge.val("")}))},o.removeContact=function(e){var a=e.isGroup?"group-"+e.htmlId:"user-"+e.htmlId;t("#li-"+a).remove()},o.updateContact=function(e,a,s){var n=e.isGroup?"group-"+e.htmlId:"user-"+e.htmlId,i=t("#li-"+n),r=i.data("msg-time");if((!a.metadata||!a.metadata.action)&&a&&a.createdAtTime>r){var c=a.groupId?"group_"+e.contactId:"user_"+e.contactId,l=o.getUnreadCount(c),d=o.getMessageTextForContactPreview(a,e);t("#li-"+n+" .mck-cont-msg-date").html(void 0===a.createdAtTime?"":mckDateUtils.getTimeOrDate(a?a.createdAtTime:"",!0));var m=t("#li-"+n+" .mck-cont-msg-wrapper");if(m.html(""),"object"==typeof d?m.append(d):m.html(d),a.conversationId){var p=a.conversationId,u=M[p];if("object"==typeof u){var v=u.topicId;if(v&&_e){var g=y[v];"object"==typeof g&&t("#li-"+n+" .mck-conversation-topic").html(g.title)}}t("#li-"+n+" a").data("mck-conversationid",p)}l>0&&(t("#li-"+n+" .mck-unread-count-text").html(l),t("#li-"+n+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));var f=t("#"+s+" li:nth-child(1)").data("msg-time");i.data("msg-time",a.createdAtTime),(void 0===f||(a?a.createdAtTime:"")>=f)&&0!==t("#mck-contact-list li").index(i)&&t("#"+s+" li:nth-child(1)").before(i)}},o.clearContactMessageData=function(e,a){var s=mckContactUtils.formatContactId(e),o=a?"group-"+s:"user-"+s;t("#li-"+o+" .mck-cont-msg-date").html(""),t("#li-"+o+" .mck-cont-msg-wrapper").html("")},o.addContact=function(e,s,n){var i=o.getMessageTextForContactPreview(n,e),r=e.userCount,c="",l=!1;if(void 0!==n){if(n.conversationId){c=n.conversationId;var d=M[c]}n.groupId&&(l=!0)}var m=o.getTabDisplayName(e.contactId,l),p=o.getContactImageLink(e,m),u=!1,v=l?"group_"+e.contactId:"user_"+e.contactId,g=o.getUnreadCount(v),f=g>0&&"mck-search-list"!==s?"vis":"n-vis",h="n-vis",b=l?"group-"+e.htmlId:"user-"+e.htmlId,I=l&&xe;if(t("#li-"+b+" .mck-group-count-text").html(r),t("#li-"+b+" .mck-group-count-box").removeClass("n-vis").addClass("vis"),l||k[e.contactId]||C[e.contactId]||!Ie||!a.MCK_OL_MAP[e.contactId]||(h="vis",u=!0),7===e.type&&e.members.length>1){var T,E=et.getGroup(n.groupId);Xe.getContactFromGroupOfTwo(E,function(e){T=st.fetchContact(e)}),l&&Ie&&a.MCK_OL_MAP[T.contactId]&&(h="vis",u=!0)}var S="n-vis";if("object"==typeof d&&_e){var x=y[d.topicId];if("object"==typeof x){S="vis";var L=x.title}}var b=l?"group-"+e.htmlId:"user-"+e.htmlId,A=[{contHtmlExpr:b,contIdExpr:e.contactId,contTabExpr:l,msgCreatedAtTimeExpr:n?n.createdAtTime:"",mckLauncherExpr:D,contImgExpr:p,contOlExpr:h,onlineLabel:MCK_LABELS.online,contUnreadExpr:f,contUnreadCount:g,contNameExpr:m,conversationExpr:c,contHeaderExpr:S,titleExpr:L,groupUserCountExpr:l?e.userCount:"",displayGroupUserCountExpr:I?"vis":"n-vis",msgCreatedDateExpr:n?mckDateUtils.getTimeOrDate(n.createdAtTime,!0):""}],_=t("#"+s+" li:nth-child(1)").data("msg-time");void 0===_||(n?n.createdAtTime:"")>=_||-1!==s.indexOf("search")&&u?t.tmpl("contactTemplate",A).prependTo("#"+s):t.tmpl("contactTemplate",A).appendTo("#"+s);var w=t("#li-"+b+" .msgTextExpr");"object"==typeof i?w.append(i):w.html(i)},o.addContactsToContactSearchList=function(){he.removeClass("vis").addClass("n-vis"),X.removeClass("vis").addClass("n-vis"),pe.hasClass("active")||(be.removeClass("active"),pe.addClass("active")),te.removeClass("vis").addClass("n-vis"),de.removeClass("n-vis").addClass("vis"),ce.removeClass("vis").addClass("n-vis"),B.removeClass("n-vis").addClass("vis"),de.html(""),me.removeClass("vis").addClass("n-vis"),dt.removeClass("vis").addClass("n-vis"),W.removeClass("vis").addClass("n-vis"),ee.removeClass("vis").addClass("n-vis"),Se.removeClass("n-vis").addClass("vis"),Be.removeClass("n-vis").addClass("vis"),0!==$e.length?st.addContactsToSearchList():we?(Be.removeClass("vis").addClass("n-vis"),he.removeClass("n-vis").addClass("vis")):nt.loadContacts(),ge.focus()},o.addGroupsToGroupSearchList=function(){var e=[],a=[];if(he.removeClass("vis").addClass("n-vis"),X.removeClass("vis").addClass("n-vis"),Z.hasClass("active")||(be.removeClass("active"),Z.addClass("active")),de.removeClass("vis").addClass("n-vis"),te.removeClass("n-vis").addClass("vis"),B.removeClass("vis").addClass("n-vis"),ce.removeClass("n-vis").addClass("vis"),te.html(""),me.removeClass("vis").addClass("n-vis"),dt.removeClass("vis").addClass("n-vis"),W.removeClass("vis").addClass("n-vis"),ee.removeClass("vis").addClass("n-vis"),Se.removeClass("n-vis").addClass("vis"),Be.removeClass("n-vis").addClass("vis"),Fe.length>0){t.each(Fe,function(e,t){a.push(t.contactId)});var s=a.filter(function(e,t){return a.indexOf(e)===t});s.sort(),t.each(s,function(a,s){if(s){var n=et.getGroup(""+s);e.push(n),0===t("#li-gs-group-"+n.htmlId).length&&o.addContactForSearchList(n,"mck-group-search-list")}})}else X.removeClass("n-vis").addClass("vis");o.initAutoSuggest({contactsArray:e,$searchId:ne,isContactSearch:!0}),Be.removeClass("vis").addClass("n-vis")},o.addConversationMenu=function(e,a){var s=yt.data("mck-id");if(ft.html(""),e===s){var o=Ye[e];if(void 0===o||0===o.length||1===o.length)return O.addClass("n-vis"),U.addClass("mck-product-box-wc"),void ft.addClass("n-vis");ft.removeClass("n-vis"),O.removeClass("n-vis"),U.removeClass("mck-product-box-wc"),t.each(o,function(s,o){if(0===t("#mck-conversation-list #li-"+o.id).length){var n="";if(o.topicDetail){var i=t.parseJSON(o.topicDetail);n="object"==typeof i?i.title:o.topicDetail}n||(n=o.topicId);var r=[{convIdExpr:o.id,tabIdExpr:e,isGroupExpr:a,topicIdExpr:o.topicId,convTitleExpr:n,mckLauncherExpr:D}];t.tmpl("convTemplate",r).appendTo(ft)}}),t("#mck-conversation-list li").length<2&&(O.addClass("n-vis"),U.addClass("mck-product-box-wc"),ft.addClass("n-vis"))}},o.loadContacts=function(e){e+""!="null"&&void 0!==e&&void 0!==e.contacts&&0!==e.contacts.length&&($e.length=0,Ve.length=0,t.each(e.contacts,function(e,t){if(void 0!==t.userId){var a=o.getContact(""+t.userId);a=void 0===a?o.createContactWithDetail(t):o.updateContactDetail(a,t),$e.push(a),Ve.push(a.contactId)}}))},o.loadContactsForContactList=function(e){var t=e.startIndex?e.startIndex:"0",s=e.pageSize?e.pageSize:"50",o=MCK_BASE_URL+"/rest/ws/user/filter?startIndex="+t+"&pageSize="+s+"&orderBy=1";Je.ajax({url:o,type:"get",global:!1,success:function(e){console.log(e)},error:function(){a.console.log("Unable to load contacts. Please reload page.")}})},o.getStatusIcon=function(e){return'<span class="'+o.getStatusIconName(e)+" move-right "+e.key+'_status status-icon"></span>'},o.getStatusIconName=function(e){return Kommunicate.internetStatus||1!==e.contentType?7===e.type||6===e.type||4===e.type||0===e.type?"":5===e.status?"mck-read-icon":4===e.status?"mck-delivered-icon":3===e.type||5===e.type||1===e.type&&(0===e.source||1===e.source)?"mck-sent-icon":"":"mck-failed-text"},o.clearMessageField=function(e){h.html(""),u.attr("disabled",!1),m.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required","").html(""),e?h.focus().select():(i.blur(),h.blur())},o.addDraftMessage=function(e){if(p=[],e&&"object"==typeof qe[e]){var a=qe[e];h.html(a.text),a.files.length>0&&(t.each(a.files,function(e,t){at.addFileBox(t)}),c.html(a.filelb),l.html(a.filesize),m.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))}else p=[]},o.showOfflineMessage=function(){"object"==typeof le&&le.innerHTML?(bt.html(le.innerHTML),bt.removeClass("n-vis").addClass("vis")):a.console.log("Offline message innerHTML required.")},o.hideOfflineMessage=function(){We.stopOfflineMessageCounter(),bt.removeClass("vis").addClass("n-vis")},o.removeConversationThread=function(e,a){ALStorage.clearMckMessageArray();var s=a?et.getGroup(e):st.getContact(e),o=yt.data("mck-id"),n=yt.data("isgroup");if(void 0===o||""===o){var i=void 0!==s?s.htmlId:mckContactUtils.formatContactId(e),r=a?"group-"+i:"user-"+i;t("#li-"+r).remove()}else o===e&&n===a&&(mt.data("datetime",""),A.removeClass("n-vis").addClass("vis"),kt.removeClass("vis").addClass("n-vis"))},o.removedDeletedMessage=function(e,a,s){ALStorage.clearMckMessageArray();var o=t("."+e);if(o.length>0)o.remove(),yt.is(":empty")&&(A.removeClass("n-vis").addClass("vis"),kt.removeClass("vis").addClass("n-vis"));else if(void 0!==a){var n=t("#mck-contact-list").length;n>0&&rt.updateContactList(a,s)}},o.getMessageTextForContactPreview=function(e,t){var o="";if(void 0!==e){if(e.message){if("true"===e.metadata.hide)return;if(e.metadata&&(e.metadata.KM_ASSIGN||e.metadata.KM_STATUS))return;if(2===e.contentType)o='<span class="mck-icon--location"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg></span><span>Location</span>';else if(3===e.contentType&&7===e.source){var n=e.message,i=n.match(/<b>(.*?)<\/b>/g).map(function(e){return e.replace(/<\/?b>/g,"")}),r='<span class="mck-icon--email"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"/><path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-.4 4.25l-6.54 4.09c-.65.41-1.47.41-2.12 0L4.4 8.25c-.25-.16-.4-.43-.4-.72 0-.67.73-1.07 1.3-.72L12 11l6.7-4.19c.57-.35 1.3.05 1.3.72 0 .29-.15.56-.4.72z" fill="rgba(38,50,56,.52)"/></svg>';o=i?r+i[0]:r+"</span><span>Email</span>"}else{var c=e.message;if(Je.startsWith(c,"<img"))return'<span class="mck-icon--camera"><svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3.2" fill="rgba(38,50,56,.52)"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z" fill="rgba(38,50,56,.52)"/><path d="M0 0h24v24H0z" fill="none"/></svg></span><span>image</span>';if(null!==a.emoji&&void 0!==a.emoji?(o=a.emoji.replace_unified(c),o=-1!==(o=a.emoji.replace_colons(o)).indexOf("</span>")?o.substring(0,o.lastIndexOf("</span>")):o):o=c,!t.isGroup&&-1===o.indexOf("emoji-inner")&&0===e.contentType){var l=s.createElement("p");l.appendChild(s.createTextNode(o)),o=l}}}else e.fileMetaKey&&"object"==typeof e.fileMeta?o=ct.getFileIcon(e):e.metadata&&e.metadata.messagePreview&&(o=e.metadata.messagePreview);if(t.isGroup&&3!==t.type&&7!==t.type&&10!==t.type){var d=e.to.split(",")[0]===Ce?"Me":st.getTabDisplayName(e.to.split(",")[0],!1);if(10!==e.contentType&&(o=d+": "+o),-1===o.indexOf("emoji-inner")&&e&&e.message&&0===e.contentType){var l=s.createElement("p");l.appendChild(s.createTextNode(o)),o=l}}}return o},o.getTextForMessagePreview=function(e,a){var o="";if(void 0!==e){if(2===e.contentType)o="Shared location";else if(e.message){var n=e.message;if(Je.startsWith(n,"<img"))o="Image attachment";else{var i=s.createElement("div");i.innerHTML=n,n=t.trim(Je.textVal(i)),o=n.substring(0,50)}}else e.fileMetaKey&&"object"==typeof e.fileMeta&&(o=-1!==e.fileMeta.contentType.indexOf("image")?"Image attachment":"File attachment");if(a.isGroup&&3!==a.type&&7!==a.type){var r=e.to.split(",")[0]===Ce?"Me":st.getTabDisplayName(e.to.split(",")[0],!1);o=r+": "+o}}return o},o.getUserIdFromMessage=function(e){var t=e.to;return t.lastIndexOf(",")===t.length-1&&(t=t.substring(0,t.length-1)),t.split(",")},o.getUserIdArrayFromMessageList=function(e){var a=new Array;return void 0===e.length?a.concat(o.getUserIdFromMessage(e)):t.each(e,function(e,t){void 0!==t.to&&(a=a.concat(o.getUserIdFromMessage(t)))}),a},o.messageContextMenu=function(e){var s=t("."+e+" .mck-msg-box");s.addEventListener?s.addEventListener("contextmenu",function(e){e.preventDefault()},!1):s.bind("contextmenu",function(s){s.preventDefault(),t(".mck-context-menu").removeClass("vis").addClass("n-vis"),t("."+e+" .mck-context-menu").removeClass("n-vis").addClass("vis"),a.event.returnValue=!1})},o.isValidMetaData=function(e){return!e.metadata||"HIDDEN"!==e.metadata.category&&"true"!=e.metadata.hide&&"false"!=e.metadata.show&&!e.metadata.KM_ASSIGN&&!e.metadata.KM_STATUS},o.updateDraftMessage=function(e,a){if("object"==typeof a){var s={text:"",files:[]},o={fileMeta:a,filelb:ct.getFilePreviewPath(a),filesize:ct.getFilePreviewSize(a.size)};void 0!==e&&"object"==typeof qe[e]&&(s=qe[e],t.each(s.files,function(e,t){t.filelb===o.filelb&&s.files.splice(e,1)})),s.files.push(o)}qe[e]=s},o.updateUnreadCount=function(e,t,a){var s=o.getUnreadCount(e);je[e]=t,(a||ut.length>0)&&((E+=t-s)<0&&(E=0),E>0?ut.html(E):ut.html("")),a&&Je.badgeCountOnLaucher(ve,E)},o.incrementUnreadCount=function(e){E+=1,je[e]=void 0===je[e]?1:je[e]+1,ut.length>0&&ut.html(E),Je.badgeCountOnLaucher(ve,E)},o.getUnreadCount=function(e){return void 0===je[e]?(je[e]=0,0):je[e]},o.isGroupDeleted=function(e,t){if(t){var a=tt.getDeletedAtTime(e);return void 0!==a&&a>0}return!1},o.getTabDisplayName=function(e,t,a){var s="";if(t)return Xe.getGroupDisplayName(e);"function"==typeof se&&(s=se(e)),void 0!==a&&a&&(s=a,He[e]=a),s||(s=o.getContactDisplayName(e));var n=o.fetchContact(""+e);return s?(n.displayName=s,v[n.contactId]=n):void 0!==n.displayName&&(s=n.displayName),s||(s=e),s},o.populateMessage=function(e,a,s){var n=mckDateUtils.convertMilisIntoTime(a.metadata.CALL_DURATION);pt.loadUserProfile(a.to),t(".km-typing-wrapper").remove(),103==a.contentType&&(4==a.type&&"CALL_REJECTED"==a.metadata.MSG_TYPE?a.message="you rejected a Video call from "+a.to:5==a.type&&"CALL_REJECTED"==a.metadata.MSG_TYPE?a.message=a.to+"rejected a Video call from you":4==a.type&&"CALL_END"==a.metadata.MSG_TYPE?a.message="you were in a call with "+a.to+"\n call duration : "+n:5==a.type&&"CALL_END"==a.metadata.MSG_TYPE?a.message="you were in a call with "+a.to+"\n call duration : "+n:4==a.type&&"CALL_MISSED"==a.metadata.MSG_TYPE?a.message="you missed a Video call from "+a.to:5==a.type&&"CALL_MISSED"==a.metadata.MSG_TYPE&&(a.message=a.to+"missed a Video call from you"));var i=yt.data("mck-id"),r=st.isValidMetaData(a),c=a.groupId?et.getGroup(a.groupId):st.getContact(a.to);if(void 0===i||""===i){var l=t("#mck-contact-list").length;if(l>0&&r){var d="object"==typeof a.metadata&&(void 0===a.metadata.KM_ASSIGN||void 0===a.metadata.KM_STATUS);a.groupId?Xe.addGroupFromMessage(a,d,function(e,t,a){o.updateRecentConversationList(e,t,a)}):st.addContactsFromMessage(a,!0)}else st.addContactsFromMessageList({message:[a]},"");if("APPLOZIC_01"===e||"MESSAGE_RECEIVED"===e){if(void 0===c&&(c=a.groupId?et.createGroup(a.groupId):st.createContact(a.to)),Ne)return void st.loadTab({tabId:c.contactId,isGroup:c.isGroup,conversationId:a.conversationId});var m=a.groupId?"group_"+c.contactId:"user_"+c.contactId;r&&(10!==a.contentType&&102!==a.contentType&&st.incrementUnreadCount(m),it.notifyUser(a));var p=a.groupId?"group-"+c.htmlId:"user-"+c.htmlId;t("#li-"+p+" .mck-unread-count-text").html(st.getUnreadCount(m)),st.getUnreadCount(m)>0&&t("#li-"+p+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"),rt.sendDeliveryUpdate(a)}}else if(void 0===c&&(c=a.groupId?et.createGroup(a.groupId):st.createContact(a.to)),"APPLOZIC_01"===e||"MESSAGE_RECEIVED"===e){if(void 0!==c){var u=yt.data("isgroup");if((void 0===a.oldKey||0===t("."+a.oldKey).length)&&0===t("."+a.key).length||10===a.contentType){if(void 0===i||i!=c.contactId||u!==c.isGroup||W.hasClass("vis")){if(Ne)return void st.loadTab({tabId:c.contactId,isGroup:c.isGroup,conversationId:a.conversationId});if(r&&10!==a.contentType&&102!==a.contentType){var m=a.groupId?"group_"+c.contactId:"user_"+c.contactId;st.incrementUnreadCount(m)}rt.sendDeliveryUpdate(a)}else{var v=!0;if(u&&6===c.type&&(v=Xe.isAppendOpenGroupContextMenu(c)),a.conversationId&&(_e||ye)){var g=yt.data("mck-conversationid");if(g&&g.toString()===a.conversationId.toString())a.metadata&&"HIDDEN"===a.metadata.category||st.addMessage(a,c,!0,!0,v),rt.sendReadUpdate(a.pairedMessageKey);else if(Ne)return void st.loadTab({tabId:c.contactId,isGroup:c.isGroup,conversationId:a.conversationId})}else{if(7===c.type){var f,k=et.getGroup(a.groupId);Xe.getContactFromGroupOfTwo(k,function(e){f=st.fetchContact(e)}),Qe.lastSeenOfGroupOfTwo(f.contactId),st.addMessage(a,c,!0,!0,v)}(!a.metadata||"HIDDEN"!==a.metadata.category&&"true"!==a.metadata.hide&&7!==c.type)&&st.addMessage(a,c,!0,!0,v),rt.sendReadUpdate(a.pairedMessageKey)}a.groupId||(t("#mck-tab-status").html(MCK_LABELS.online),pt.updateUserStatus({userId:a.to,status:1},function(e){nt.getUsersDetail(e,{})}))}s&&6!==c.type&&it.notifyUser(a)}}}else if("APPLOZIC_02"===e&&102==!a.contentType&&((void 0===a.oldKey||0===t("."+a.oldKey).length)&&0===t("."+a.key).length||10===a.contentType))if(l>0)st.addContactsFromMessage(a,!0);else if(void 0!==c){var u=yt.data("isgroup");if(void 0!==i&&i===c.contactId&&u===c.isGroup){var v=!0;u&&6===c.type&&(v=Xe.isAppendOpenGroupContextMenu(c)),a.metadata&&"HIDDEN"===a.metadata.category||st.addMessage(a,c,!0,!0,v),3===a.type&&(t("."+a.key+" .mck-message-status").removeClass("mck-pending-icon").addClass("mck-sent-icon"),st.addTooltip(a.key))}}Le.removeClass("vis").addClass("n-vis")},o.getMessageFeed=function(e){var a={};if(a.key=e.key,a.timeStamp=e.createdAtTime,a.message=e.message,a.from=4===e.type?e.to:Ce,e.groupId?a.to=e.groupId:a.to=5===e.type?e.to:Ce,a.status="read",a.type=4===e.type?"inbox":"outbox",5===e.type&&(3===e.status?a.status="sent":4===e.status&&(a.status="delivered")),"object"==typeof e.fileMeta){var s=t.extend({},e.fileMeta);void 0!==s.url&&""!==s.url||(s.url=$+"/rest/ws/aws/file/"+e.fileMeta.blobKey),delete s.blobKey,a.file=s}return a.source=e.source,a.metadata=e.metadata,a},o.updateUnreadCountonChatIcon=function(e){if(Oe&&e.length>0){var a=null,s=0;e.length>0&&(t.each(e,function(e,t){t.unreadCount>0&&null!==a||t.unreadCount>0&&(a=t.userId,s=t.unreadCount)}),E>0&&"none"===d.css("display")&&(null!==a&&s===E?st.loadTab({tabId:a,isGroup:!1}):st.loadTab({tabId:"",isGroup:!1})))}},o.loadMessageListOnUserDetailFetch=function(e){Le.removeClass("vis").addClass("n-vis");var a=yt.data("mck-id"),s=yt.data("isgroup");if(void 0===a||e.tabId===a&&""+s==""+e.isGroup){var o=et.getGroup(e.tabId);tt.addGroupStatus(o);var n=6!==o.type,n=!0;6===o.type&&(tt.validateOpenGroupUser(o),n=Xe.isAppendOpenGroupContextMenu(o)),e.isMessages?(st.processMessageList(e.messageData,!0,n),6!==o.type&&kt.removeClass("n-vis").addClass("vis"),"function"==typeof J&&J(e.tabId)):0===t("#mck-message-cell .mck-message-inner div[name='message']").length&&kt.removeClass("vis").addClass("n-vis")}}},ot=new function(){var e,o=this,n=t("#mck-search"),i=t("#mck-msg-to"),r=t("#mck-msg-new"),l=(t("#mck-audio"),t("#mck-mike-btn"),t("#mck-sidebox")),m=t("#mck-file-box"),u=t("#mck-text-box"),v=t("#mck-msg-form"),h=t("#mck-msg-sbmt"),b=t("#mck-new-group"),T=t("#mck-tab-title"),E=t("#mck-msg-error"),S=t("#mck-btn-attach"),x=t("#mck-tab-status"),L=t("#mck-message-cell"),A=t(".mck-typing-box"),_=t("#mck-gms-loading"),w=t("#mck-group-title"),K=t("#mck-contact-loading"),N=(t("#mck-no-messages"),t(".mck-group-search")),z=(t(".mck-city-search"),t("#mck-msg-response")),B=t("#mck-msg-form #mck-file-input"),F=t("#mck-block-button"),$=t("#li-mck-block-user"),q=t("#li-mck-group-info"),H=t("#li-mck-video-call"),j=t("#mck_response_text"),Y=t(".mck-contact-search"),Z=t("#mck-group-info-tab"),Q=t("#mck-price-text-box"),X=(t("#mck-sidebox-search"),t("#mck-group-info-btn")),Z=t("#mck-group-info-tab"),ee=t("#mck-btn-group-exit"),te=t("#mck-group-back-link"),se=t("#mck-btn-leave-group"),ie=t(".mck-sidebox-content"),re=(t("#mck-no-more-messages"),t("#mck-btn-group-create")),ce=(t("#mck-group-create-tab"),t("#mck-group-add-member")),le=(t("#mck-contacts-content"),t("#mck-tab-option-panel")),de=(t("#mck-no-conversations"),t("#mck-group-create-title")),pe=t(".mck-group-menu-options"),ue=t(".mck-tab-message-option"),ve=t(".mck-group-admin-options"),fe=t("#mck-group-member-search"),ke=t("#mck-autosuggest-search-input"),Ie=t("#mck-autosuggest-metadata"),Me=t("#mck-message-cell .mck-message-inner"),Ee=(t("#mck-search-cell .mck-message-inner"),t("#mck-no-more-conversations"),t("#mck-gm-search-box")),xe=t("#mck-group-member-search-list"),Ae=t("#mck-no-gsm-text"),Ue=t("#mck-minutes"),Ke=t("#mck-seconds");o.checkArray=function(e){if(e&&!1===Array.isArray(e))throw new Error("askUserDetails should be an array");return e},o.createNewConversation=function(e,t){Kommunicate.startConversation(e,t)},o.loadConversationWithAgents=function(e,a){"kommunicate"==window.applozic.PRODUCT_ID&&se.removeClass("vis").addClass("n-vis");Kommunicate.client.getGroupDetailByType({type:10,startIndex:0,limit:10},function(e,s){if(e)console.log("error while fetching group detail by type",e);else if(0==s.response.length)ot.createNewConversation({groupName:bt,agentId:yt,botIds:It},function(e){a()});else if(1==s.response.length){var o=s.response[0].id;t.fn.applozic("loadGroupTab",o,a)}else t.fn.applozic("loadTab",null,a)})},o.timer=function(){var t=0,a=this;e=setInterval(function(){++t,Ke.html(a.pad(t%60)),Ue.html(a.pad(parseInt(t/60)))},1e3),a.pad=function(e){var t=e+"";return t.length<2?"0"+t:t}},o.stoptimer=function(){Ke.html("0"),Ue.html("0"),clearInterval(e)},t(s).on("click",".mck-message-delete",function(){o.deleteMessage(t(this).parents(".mck-m-b").data("msgkey"))}),t(s).on("click",".mck-message-reply",function(){o.replyMessage(t(this).parents(".mck-m-b").data("msgkey"))}),t(s).on("click",".mck-message-forward",function(){r.data("forwardMessageKey",t(this).parents(".mck-m-b").data("msgkey")),r.trigger("click")}),t(".mck-minimize-icon").click(function(){t(".mck-box-md,.mck-box-ft").animate({height:"toggle"}),ie.hasClass("minimized")?(ie.css("height","100%"),ie.removeClass("minimized")):(ie.css("height","0%"),ie.addClass("minimized"))}),o.init=function(){t.template("oflTemplate",'<div id="mck-ofl-blk" class="mck-m-b"><div class="mck-clear"><div class="blk-lg-12 mck-text-light mck-text-muted mck-test-center">${userIdExpr} is offline now</div></div></div>'),ALStorage.clearMckMessageArray(),t(s).on("click","."+D,function(){t(this).hasClass("mck-msg-preview")&&t(this).hide(),clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM)}),st.initSearchAutoType(),Y.click(function(){ot.createNewConversation({groupName:bt,agentId:yt,botIds:It},function(e){}),t("#mck-msg-new").attr("disabled",!0),clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM)}),t(s).on("click","#mck-sidebox-launcher",function(){document.getElementById("launcher-agent-img-container").classList.add("n-vis"),document.getElementById("launcher-agent-img-container").classList.remove("vis"),void 0!==ge?document.getElementById("mck-sidebox-launcher").childNodes[0].childNodes[0].classList.remove("n-vis"):document.getElementById("launcher-svg-container").classList.remove("n-vis")}),t(s).on("click","#talk-to-human-link",function(){""===t("#km-faq-search-input").val()?(ot.createNewConversation({groupName:bt,agentId:yt,botIds:It},function(e){}),KommunicateUI.showChat()):ot.createNewConversation({groupName:bt,agentId:yt,botIds:It},function(e){KommunicateUI.sendFaqQueryAsMsg(e),KommunicateUI.showChat()}),t("#mck-contact-list").removeClass("vis").addClass("n-vis")}),N.click(function(){st.addGroupsToGroupSearchList()}),u.keydown(function(e){if(u.hasClass("mck-text-req")&&u.removeClass("mck-text-req"),13===e.keyCode&&(e.shiftKey||e.ctrlKey)){if(e.preventDefault(),a.getSelection){var t=a.getSelection(),o=t.getRangeAt(0),n=s.createElement("br"),i=s.createTextNode(" ");return o.deleteContents(),o.insertNode(n),o.collapse(!1),o.insertNode(i),o.selectNodeContents(i),t.removeAllRanges(),t.addRange(o),u.animate({scrollTop:u.prop("scrollHeight")},0),!1}}else 13===e.keyCode?(e.preventDefault(),1===g&&Tt.sendTypingStatus(0,Me.data("mck-id")),h.is(":disabled")&&m.hasClass("vis")?alert("Please wait file is uploading."):v.submit()):0===g&&Tt.sendTypingStatus(1,Me.data("mck-id"))}),t(s).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&ot.deleteConversation()}),t(s).on("click",".applozic-tm-launcher",function(e){e.preventDefault();var a=t(this).data("mck-id");a=void 0!==a&&""!==a?a.toString():"";var s=t(this).data("mck-name");s=void 0!==s&&""!==s?s.toString():"";var o=t(this).data("mck-supportid");o=void 0!==o&&""!==o?o.toString():"";var n=t(this).data("mck-topicid");n=void 0!==n&&""!==n?n.toString():"";var i=t(this).data("mck-msg");if(i=void 0!==i&&""!==i?i.toString():"","function"==typeof ae&&n){var r=ae(n);"object"==typeof r&&"undefined"!==r.title&&(y[n]=r)}var c={topicId:n,tabId:a,userName:s,isMessage:!0},l={type:5,contentType:0,message:i};c.messagePxy=l,o?(c.isGroup=!0,c.supportId=o,ot.getConversationId(c)):(c.isGroup=!1,st.loadTab(c,rt.dispatchMessage))}),t(s).on("click",".applozic-wt-launcher",function(e){e.preventDefault();var a=t(this).data("mck-id");a=void 0!==a&&""!==a?a.toString():"";var s=t(this).data("mck-name");s=void 0!==s&&""!==s?s.toString():"";var o=t(this).data("mck-topicid");o=void 0!==o&&""!==o?o.toString():"";var n=t(this).data("mck-topic-status");if(n=n?-1===De.indexOf(n)?De[0]:n.toString():De[0],"function"==typeof ae){var i=ae(o);"object"==typeof i&&"undefined"!==i.title&&(y[o]=i)}ot.getConversationId({tabId:a,isGroup:!1,userName:s,topicId:o,topicStatus:n,isMessage:!1})}),t(s).on("click",".applozic-ct-launcher",function(e){e.preventDefault();var a=t(this).data("mck-id");a=void 0!==a&&""!==a?a.toString():"";var s=t(this).data("mck-name");s=void 0!==s&&""!==s?s.toString():"";var o=t(this).data("mck-topicid");o=void 0!==o&&""!==o?o.toString():"";var n=t(this).data("mck-topic-status");n=n?-1===De.indexOf(n)?De[0]:n.toString():De[0];var i={tabId:a,isGroup:!1,userName:s,topicId:o,topicStatus:n,isMessage:!1};if("function"==typeof me){var r=me(o);"object"==typeof r&&(r.topicDetail&&"object"==typeof r.topicDetail&&"undefined"!==r.topicDetail.title&&(y[o]=r.topicDetail),r.fallBackTemplatesList&&r.fallBackTemplatesList.length>0&&(i.fallBackTemplatesList=r.fallBackTemplatesList))}ot.getConversationId(i)}),t(s).on("click","."+D+", .mck-contact-list ."+D,function(e){e.preventDefault(),!isFirstLaunch&&t("#mck-tab-individual .mck-tab-link.mck-back-btn-container").addClass("vis-table").removeClass("n-vis"),t("#mck-tab-individual .mck-name-status-container.mck-box-title").removeClass("padding"),count++;var a=t(this),s=this,o=a.data("mck-id");count>1&&"object"!=typeof MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-1]&&MCK_EVENT_HISTORY.push(s),o?a.parents(".mck-search-list").length?(n.bind("blur"),setTimeout(function(){ot.openChat(s)},600)):ot.openChat(s,Kommunicate.conversation.processConversationOpenedFromList):(t.fn.applozic("mckLaunchSideboxChat"),clearTimeout(MCK_TRIGGER_MSG_NOTIFICATION_PARAM))}),t("#km-form-chat-login").submit(function(a){var s=t("#km-submit-chat-login"),o=t("#km-error-chat-login"),n=t("#km-userId").val(),i=t("#km-email").val(),r=t("#km-userName").val(),c=t("#km-contact").val();c&&(n=c),i&&(n=i),o.removeClass("show").addClass("hide"),o.html("");var l={userId:n,applicationId:U,onInit:e,baseUrl:MCK_BASE_URL,locShare:P,googleApiKey:he,chatNotificationMailSent:!0};return i&&(l.email=i),r&&(l.displayName=r),c&&(l.contactNumber=c),s.attr("disabled",!0),s.html("Initiating chat..."),We.initialize(l),!1});var e=function(){"kommunicate"===window.applozic.PRODUCT_ID&&se.removeClass("vis").addClass("n-vis"),ot.loadConversationWithAgents({groupName:bt,agentId:yt,botIds:It})};t(".km-login-model-close").on("click",function(e){t("#km-chat-login-modal").css("display","none")}),t(s).on("click",".mck-conversation-tab-link",function(e){e.preventDefault();t(this);var a=Me.data("mck-id"),s=Me.data("isgroup");KommunicateUI.hideAwayMessage(),KommunicateUI.hideLeadCollectionTemplate(),KommunicateUI.hideClosedConversationBanner(),st.loadTab({tabId:"",isGroup:!1,lastActiveTabId:a,isLastActiveTabGroup:s})}),t(s).on("click",".mck-close-sidebox",function(e){e.preventDefault(),KommunicateUI.hideAwayMessage(),KommunicateUI.hideLeadCollectionTemplate(),KommunicateUI.hideClosedConversationBanner(),l.mckModal("hide"),t("#mck-sidebox-launcher").removeClass("n-vis").addClass("vis"),document.getElementById("launcher-agent-img-container").classList.contains("vis")?(document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.add("n-vis"),document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.remove("vis")):(document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.add("vis"),document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.remove("n-vis"));var a=Me.data("mck-conversationid");if(Me.data("mck-id",""),Me.data("mck-topicid",""),Me.data("mck-name",""),Me.data("mck-conversationid",""),a){var s=M[a];if("object"==typeof s){var o=s.topicId;"function"==typeof V&&V(Ce,o)}}Tt.unsubscibeToTypingChannel()}),t(s).on("click",".mck-price-submit",function(e){e.preventDefault(),o.sendPriceMessage()}),Q.keydown(function(e){13===e.keyCode&&o.sendPriceMessage()}),Me.bind("scroll",function(){if(Me.find(".mck-contact-list").length>0){if(Me.scrollTop()+Me.innerHeight()>=Me[0].scrollHeight){var e=Me.data("datetime");e>0&&!f&&ot.loadMessageList({tabId:"",isGroup:!1,startTime:e})}}else if(0===Me.scrollTop()){var t=Me.data("mck-id");if(void 0===t||""===t)return;var a=Me.data("isgroup"),s=Me.data("mck-conversationid");s=s?s.toString():"";var e=le.data("datetime");e>0&&!f&&ot.loadMessageList({tabId:t,isGroup:a,conversationId:s,startTime:e})}}),Q.on("click",function(e){e.preventDefault(),Q.removeClass("mck-text-req")}),F.on("click",function(e){e.preventDefault();var t=Me.data("mck-id"),a=Me.data("isgroup"),s=!Me.data("blocked");if(a)return $.removeClass("vis").addClass("n-vis"),void H.removeClass("vis").addClass("n-vis");var o=s?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"];confirm(o)&&pt.blockUser(t,s,function(e){Qe.toggleBlockUser(e,s)})}),se.on("click",function(e){e.preventDefault();var t=Me.data("mck-id"),a=Me.data("isgroup");a?confirm(MCK_LABELS["exit.group.alert"])&&Xe.leaveGroup({apzCallback:tt.onGroupLeft,groupId:t}):pe.removeClass("vis").addClass("n-vis")}),t(s).on("click",".mck-add-to-group",function(e){e.preventDefault();var a=t(this).data("mck-id");void 0!==a&&tt.addGroupMemberFromSearch(a),Ee.mckModal("hide")}),t(s).on("click",".mck-btn-remove-member",function(e){e.stopPropagation();var a=t(this).parents(".mck-li-group-member").data("mck-id"),s=Z.data("mck-id");if(void 0!==s&&void 0!==a){var o=et.getGroup(s);"object"==typeof o&&Ce===o.adminName?confirm(MCK_LABELS["remove.member.alert"])&&Xe.removeGroupMember({groupId:s,userId:a,apzCallback:tt.onRemovedGroupMember}):ve.removeClass("vis").addClass("n-vis")}}),ee.on("click",function(e){e.preventDefault();var t=Z.data("mck-id");t?confirm(MCK_LABELS["exit.group.alert"])&&Xe.leaveGroup({groupId:t,apzCallback:tt.onGroupLeft}):st.loadTab({tabId:"",isGroup:!1})}),X.on("click",function(e){e.preventDefault();var t=Me.data("mck-id"),a=Me.data("isgroup");if(a){var s={groupId:t},o=Me.data("mck-conversationid");o&&(s.conversationId=o),tt.loadGroupInfo(s)}else pe.removeClass("vis").addClass("n-vis")}),b.on("click",function(e){e.preventDefault(),tt.loadCreateGroupTab()}),te.on("click",function(e){e.preventDefault();var t=Z.data("mck-id"),a=Z.data("mck-conversation-id");if(t){var s={tabId:t,isGroup:!0};a&&(s.conversationId=a),st.loadTab(s)}else st.loadTab({tabId:"",isGroup:!1})}),ce.on("click",function(e){e.preventDefault();var a=Z.data("mck-id");if(a){var s=et.getGroup(a);if(!s||s.adminName!==Ce)return void ve.removeClass("vis").addClass("n-vis");xe.html(""),Ee.mckModal(),_.removeClass("n-vis").addClass("vis"),Ve.length>0?tt.addMembersToGroupSearchList():we?$e.length>0?(t.each($e,function(e,t){Ve.push(t.contactId)}),tt.addMembersToGroupSearchList()):(_.removeClass("vis").addClass("n-vis"),Ae.removeClass("n-vis").addClass("vis")):nt.loadContacts()}}),fe.keypress(function(e){if(13===e.which){var t=fe.val();return""!==t&&tt.addGroupMemberFromSearch(t),fe.val(""),!0}}),t(s).on("click",".mck-group-member-search-link",function(e){e.preventDefault();var t=fe.val();""!==t&&tt.addGroupMemberFromSearch(t),fe.val("")}),t(s).on("click",".mck-show-more",function(e){e.preventDefault();var a=t(this),s=a.data("tabId"),o=Me.data("isgroup"),n=Me.data("mck-conversationid");n=n?n.toString():"";var i=a.data("datetime");ot.loadMessageList({tabId:s,isGroup:o,conversationId:n,startTime:i})}),t(s).on("click",".mck-accept",function(e){var a=t(this).data("mck-conversationid"),s=t(this).data("mck-topic-price");if("function"==typeof ne&&s&&a){var o=M[a],n=i.val(),r=Xe.getGroupDisplayName(n);"object"==typeof o?(ne({custId:Ce,suppId:r,productId:o.topicId,price:s}),rt.sendConversationCloseUpdate(a)):rt.getTopicId({conversationId:a,suppId:r,priceText:s},function(e){st.populateMessage(e.messageType,e.message,e.notifyUser)})}}),v.submit(function(){1===g&&Tt.sendTypingStatus(0,Me.data("mck-id"));var e=t.trim(Je.textVal(u[0]));if(m.hasClass("n-vis")&&p.length>0&&(p=[]),0===e.length&&0===p.length)return u.addClass("mck-text-req"),!1;if("function"==typeof oe&&!oe(e))return!1;var s={type:5,contentType:0,message:e},n=Me.data("mck-conversationid"),r=Me.data("mck-topicid");if(n)s.conversationId=n;else if(r){var c={topicId:r},l=y[r];"object"==typeof l&&(c.topicDetail=a.JSON.stringify(l)),s.conversationPxy=c}var d=Ie.val();d&&""!=d&&(s.metadata={suggestMessageMetadata:d},Ie.val("")),""!=ke.data("prev-msgkey")&&void 0!==ke.data("prev-msgkey")&&(ot.updateMessageMetadata({key:ke.data("prev-msgkey"),metadata:{obsolete:!0}}),ke.data("prev-msgkey","")),ke.hasClass("mck-text-box")&&(ke.addClass("n-vis").removeClass("mck-text-box").val(""),u.removeClass("n-vis").addClass("mck-text-box"),ke.data("source-url",""),t(".mck-dropup-menu").hide()),!0===Me.data("isgroup")?s.groupId=i.val():s.to=i.val(),h.attr("disabled",!0),E.removeClass("vis").addClass("n-vis"),E.html(""),j.html(""),z.removeClass("vis").addClass("n-vis");let v=t("[data-msgtype=5]").length;if(1==v&&(KommunicateUI.leadCollectionEnabledOnAwayMessage&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId||KommunicateUI.welcomeMessageEnabled&&KommunicateUI.leadCollectionEnabledOnWelcomeMessage&&KommunicateUI.anonymousUser)){var f=KommunicateUI.validateEmail(s.message);if(!f)return!1}return o.sendMessage(s),!1}),B.on("click",function(){t(this).val(""),E.removeClass("vis").addClass("n-vis"),z.removeClass("vis").addClass("n-vis")}),t(s).bind("click",function(e){t(".mck-context-menu").removeClass("vis").addClass("n-vis"),!S.hasClass("on")||t(e.target).hasClass("mck-icon-upload")||t(e.target).hasClass("mck-btn-attach")||Ze.fileMenuToggle(),u.removeClass("mck-text-req"),s.activeElement&&s.activeElement!==u&&1===g&&Tt.sendTypingStatus(0,Me.data("mck-id")),s.activeElement&&"mck-group-name-save"!==s.activeElement.id&&w.removeClass("mck-req-border"),s.activeElement&&"mck-btn-group-create"!==s.activeElement.id&&de.removeClass("mck-req-border"),t(".mcktypeahead.mck-dropdown-menu").hide()}),t(".mck-tabview-item").click(function(){t(".mck-tabview-item").removeClass("active"),t(this).addClass("active")})},t(".mck-sidebox").on("click","#mck-mike-btn",function(){t(this).removeClass("vis").addClass("n-vis"),t(".mck-stop-btn").addClass("vis").removeClass("n-vis"),Fr.voice.record(!1,function(){t("#mck-audio").removeClass("n-vis").addClass("vis"),ot.timer()})}),t(".mck-sidebox").on("click","#mck-stop-recording",function(){t("#mck-mike-btn").addClass("vis").removeClass("n-vis"),t(".mck-stop-btn").addClass("n-vis").removeClass("vis"),t("#mck-audio").removeClass("vis").addClass("n-vis"),ot.stoptimer(),Fr.voice.export(function(e){var a={};a.file=e,a.name="blob",t.fn.applozic("audioAttach",a)},"blob"),Fr.voice.stop()}),o.openChat=function(e,a){var s=t(e),o=s.data("mck-id");o=void 0!==o&&""!==o?o.toString():"";var i=s.data("mck-name");i=void 0!==i&&""!==i?i.toString():"";var r=s.data("mck-topicid");r=void 0!==r&&""!==r?r.toString():"";var c=!0===s.data("isgroup"),l=s.data("mck-conversationid");if(l=void 0!==l&&""!==l?l.toString():"",r&&!l){var d=t(elem).data("mck-topic-status");d=d?-1===De.indexOf(d)?De[0]:d.toString():De[0],ot.getConversationId({tabId:o,isGroup:c,userName:i,topicId:r,topicStatus:d,isMessage:!1})}else st.loadTab({tabId:o,isGroup:c,userName:i,conversationId:l,topicId:r},a);n.val("")},o.sendMessage=function(e,a,s){var n,i;if(Kommunicate.internetStatus&&void 0!==t("#mck-message-cell .mck-message-inner div[name='message']:last-child").data("msgkey")&&(n=t("#mck-message-cell .mck-message-inner div[name='message']:last-child").data("msgkey"),i=rt.getReplyMessageByKey(n)),"object"==typeof e){if(e.to&&pt.MCK_USER_DETAIL_MAP[e.to]&&(pt.MCK_USER_DETAIL_MAP[e.to].deletedAtTime||!0===kt))return E.html(MCK_LABELS["user.delete"]).removeClass("n-vis").addClass("vis"),t("#mck-tab-status").removeClass("vis").addClass("n-vis"),v.removeClass("vis").addClass("n-vis"),void $.removeClass("vis").addClass("n-vis");var r=e.metadata?e.metadata:{},c=t("#mck-text-box").data("AL_REPLY");if(void 0===c||""===c||e.forward||(r.AL_REPLY=c),e.metadata=r,void 0!==e.message&&0!==e.message.length||0!==p.length){if(i&&(!i.metadata.altype||0!==i.type&&4!==i.type&&6!==i.type||(r.altype=i.metadata.altype)),e.conversationId){var l=M[e.conversationId];if("undefined"!==l&&l.closed)return st.closeConversation(),void h.attr("disabled",!1)}var d=Me.data("blocked");if(d&&!e.groupId)return Qe.toggleBlockUser(f,!0),void h.attr("disabled",!1);var m="";if(e.groupId?void 0===(m=et.getGroup(e.groupId))&&(m=et.createGroup(e.groupId)):m=e.clientGroupId?et.getGroupByClientGroupId(e.clientGroupId):st.fetchContact(e.to),t("#mck-message-cell .mck-no-data-text").length>0&&t(".mck-no-data-text").remove(),e.message&&0===p.length){var g=ue.hasClass("n-vis"),f=Me.data("mck-id"),k=Je.randomId();e.key=k,12!==e.contentType&&f&&f.toString()===m.contactId&&102!==e.contentType&&rt.addMessageToTab(e,m,function(e,t){st.addMessage(e,t,!0,!0,!1)});var C={tabId:m.contactId,isTopPanelAdded:g};o.submitMessage(e,C)}else if(!e.message||0===p.length||1!==e.contentType&&2!==e.contentType)p.length>0&&t.each(p,function(n,i){var r=ue.hasClass("n-vis"),c=Me.data("mck-id"),l=Je.randomId();e.key=l,e.fileMeta=i,e.contentType=1,12!==e.contentType&&c&&c.toString()===m.contactId&&rt.addMessageToTab(e,m,function(e,t){st.addMessage(e,t,!0,!0,!1)});var d={tabId:m.contactId,isTopPanelAdded:r},u=KommunicateUI.getAttachmentStopUploadStatus(e.key);if(!Kommunicate.internetStatus||u)return KM_PENDING_ATTACHMENT_FILE[e.key]=a,KommunicateUI.displayUploadIconForAttachment(e.key,!1),void KommunicateUI.updateAttachmentStopUploadStatus(e.key,!0);p&&-1!=p[0].contentType.indexOf("image/")?(t(".mck-timestamp-"+e.key).removeClass("vis").addClass("n-vis"),KommunicateUI.displayProgressMeter(e.key),KommunicateUI.updateAttachmentTemplate(e,e.key),"function"==typeof s&&s(e)):o.submitMessage(e,d)});else{var g=ue.hasClass("n-vis"),f=Me.data("mck-id"),k=Je.randomId();e.key=k;var b={};e.groupId?b.groupId=e.groupId:b.to=e.to,b.type=e.type,b.key=Je.randomId(),b.message=e.message,b.contentType=e.contentType,e.contentType=1,e.fileMeta=p[0],e.message="",12!==e.contentType&&f&&f.toString()===m.contactId&&(rt.addMessageToTab(e,m,function(e,t){st.addMessage(e,t,!0,!0,!1)}),rt.addMessageToTab(b,m,function(e,t){st.addMessage(e,t,!0,!0,!1)}));var C={tabId:m.contactId,isTopPanelAdded:g};o.submitMessage(e,C),o.submitMessage(b,C)}u.removeClass("mck-text-req"),h.attr("disabled",!1),t("."+k+" .mck-message-status").removeClass("mck-sent-icon").addClass("mck-pending-icon"),st.addTooltip(k),st.clearMessageField(!0),p=[],delete qe[m.contactId]}else u.addClass("mck-text-req")}},o.sendForwardMessage=function(e){var t=ALStorage.getMessageByKey(e);if(void 0!==t){t.fileMeta&&p.push(t.fileMeta);var s={type:5,contentType:t.contentType,message:t.message,forward:"forward"};t.metadata&&(t.metadata.AL_REPLY&&(t.metadata.AL_REPLY=""),s.metadata=t.metadata);var n=Me.data("mck-conversationid"),r=Me.data("mck-topicid");if(n)s.conversationId=n;else if(r){var c={topicId:r},l=y[r];"object"==typeof l&&(c.topicDetail=a.JSON.stringify(l)),s.conversationPxy=c}!0===Me.data("isgroup")?s.groupId=i.val():s.to=i.val(),o.sendMessage(s)}},o.sendWelcomeMessage=function(e){var t=Je.randomId(),a=Me.data("mck-id"),s=Me.data("isgroup"),o={key:t,type:4,contentType:0,to:e.sender,message:e.messageContent};if(a&&a.toString()===e.sender&&!s){var n=st.fetchContact(a);rt.addMessageToTab(o,n,function(e,t){st.addMessage(e,t,!0,!0,!1)})}Je.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender="+encodeURIComponent(e.sender)+"&messageContent="+encodeURIComponent(e.messageContent),contentType:"text/plain",success:function(t){e.callback&&e.callback(t)}})},o.submitMessage=function(e,s){var o=e.key,n=e.metadata?e.metadata:{};Le&&(n=t.extend(e.metadata,{userStatus:4}));var i=t("#mck-text-box").data("AL_REPLY");void 0===i||""===i||e.forward||(n.AL_REPLY=i,t("#mck-text-box").data("AL_REPLY","")),e.source=be;var r=t("#mck-message-cell .mck-message-inner div[name='message']."+o);if(102!=e.contentType&&103!=e.contentType){var c=KommunicateUtils.getSettings("KM_CHAT_CONTEXT");Se="object"==typeof Se?Se:{},c="object"==typeof c?t.extend(c,Se):{},t.extend(n,{KM_CHAT_CONTEXT:JSON.stringify(c)})}e.metadata=n,Je.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:a.JSON.stringify(e),contentType:"application/json",success:function(a){e&&"object"==typeof e.fileMeta&&-1!=e.fileMeta.contentType.indexOf("image/")&&(t(".mck-timestamp-"+e.key).removeClass("n-vis").addClass("vis"),KommunicateUI.updateAttachmentStopUploadStatus(e.key,!1));var n=Me.data("mck-id");if("object"==typeof a){KommunicateUI.deleteProgressMeter(e.key,!0);var i=a.messageKey;if(n&&n.toString()===s.tabId){var c=a.conversationId;Me.data("mck-conversationid",c),r.removeClass(o).addClass(i),r.data("msgkey",i),t("."+i+" .mck-message-status").removeClass("mck-pending-icon").addClass("mck-sent-icon").attr("title","sent"),st.addTooltip(i),s.isTopPanelAdded&&le.data("datetime",a.createdAt);var l=!0;if(e.groupId){var d=et.getGroup(e.groupId);6===d.type&&(l=!1)}l&&st.messageContextMenu(i)}if(e.conversationPxy){var m=e.conversationPxy;e.topicId&&(O[e.topicId]=[c]),M[c]=m}}else"CONVERSATION_CLOSED"===a||"BUSY_WITH_OTHER"===a?(h.attr("disabled",!1),st.closeConversation(a),r.remove(),s.isTopPanelAdded&&ue.removeClass("vis").addClass("n-vis")):"error"===a&&(h.attr("disabled",!1),E.html("Unable to process your request. Please try again"),E.removeClass("n-vis").addClass("vis"),r.remove(),s.isTopPanelAdded&&ue.removeClass("vis").addClass("n-vis"));let p=t("[data-msgtype=5]").length;1==p&&(KommunicateUI.leadCollectionEnabledOnAwayMessage&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId||KommunicateUI.welcomeMessageEnabled&&KommunicateUI.leadCollectionEnabledOnWelcomeMessage&&KommunicateUI.anonymousUser)&&KommunicateUI.displayLeadCollectionTemplate(null),p>1&&t("#mck-email-collection-box").removeClass("vis").addClass("n-vis");var u=st.getTabDisplayName(n,!1);if(!pt.MCK_USER_DETAIL_MAP[n]&&n!==u){nt.updateDisplayName(n,u);var v={userId:n,userName:u};pt.MCK_USER_DETAIL_MAP[v.userId]=v}},error:function(){E.html("Unable to process your request. Please try again."),E.removeClass("n-vis").addClass("vis"),r&&r.remove(),s.isTopPanelAdded&&ue.removeClass("vis").addClass("n-vis")}}),t("#mck-reply-to-div").removeClass("vis").addClass("n-vis")},o.updateMessageMetadata=function(e){e.metadata||e.messageKey?Je.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",global:!1,data:a.JSON.stringify(e),contentType:"application/json",success:function(e){console.log("metadata updated: ",e)},error:function(){}}):console.log("empty metadata")},o.downloadImage=function(e){window.open(e,"_blank")},o.replyMessage=function(e){var a="",s=(Me.data("mck-id"),rt.getReplyMessageByKey(e));u.focus().select(),t("#mck-reply-to-div").removeClass("n-vis").addClass("vis"),a=5===s.type?"You":st.getTabDisplayName(s.to,!1),t("#mck-reply-to").html(a),"object"==typeof s.fileMeta||2===s.contentType?t("#mck-reply-msg").html(st.getImageForMessagePreview(s)):t("#mck-reply-msg").html(s.message),t("#mck-text-box").data("AL_REPLY",e)},t("#close").click(function(){t("#mck-reply-to-div").removeClass("vis").addClass("n-vis"),t("#mck-text-box").data("AL_REPLY","")}),o.deleteMessage=function(e){var s=Me.data("mck-id");void 0!==s&&Je.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key="+e,type:"get",success:function(o){if("success"===o){var n=Me.data("mck-id");n===s&&(t("."+e).remove(),Me.is(":empty")&&ue.removeClass("vis").addClass("n-vis")),ALStorage.clearMckMessageArray()}else a.console.log("Unable to delete message. Please reload page.")}})},o.deleteConversation=function(){var e=Me.data("mck-id"),t=Me.data("isgroup"),a=Me.data("mck-conversationid");if(void 0!==e){var s={};t?s.groupId=e:s.userId=e,a&&(s.conversationId=a),f=!0,window.Applozic.ALApiService.deleteConversation({data:s,success:function(){var t=Me.data("mck-id");t===e&&(Me.html(""),le.data("datetime",""),L.removeClass("n-vis").addClass("vis"),ue.removeClass("vis").addClass("n-vis"),f=!1)},error:function(){}})}},o.loadMessageList=function(e,s){var o=!1,n=!1,i="";void 0!==e.tabId&&""!==e.tabId?(i=e.isGroup?"&groupId="+e.tabId:"&userId="+encodeURIComponent(e.tabId),o=!0,e.startTime&&(i+="&endTime="+e.startTime),i+="&pageSize=30",(_e||ye)&&e.conversationId&&(i+="&conversationId="+e.conversationId,void 0===Ye[e.tabId]?(n=!0,i+="&conversationReq=true"):st.addConversationMenu(e.tabId,e.isGroup))):(f=!0,e.startTime&&(i+="&endTime="+e.startTime),i+="&mainPageSize=60"),e.startTime||Me.html(""),K.removeClass("n-vis").addClass("vis"),Je.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex=0"+i,type:"get",global:!1,success:function(i){var c=!0;e.isGroup&&Kommunicate.getAwayMessage({applicationId:U,conversationId:e.tabId},function(e,t){MCK_LABELS.away="AGENTS_ONLINE"!=t.code?"Away":null,KommunicateUI.populateAwayMessage(e,t),KommunicateUI.updateLeadCollectionStatus(e,t,i.message)});var l=Me.data("mck-id"),d=Me.data("isgroup");if(e.isGroup&&!e.startTime||K.removeClass("vis").addClass("n-vis"),f=!1,(void 0===l||e.tabId===l&&""+d==""+e.isGroup)&&(i+""!="null"&&void 0!==i.message&&0!==i.message.length||(c=!1,o?e.startTime?le.data("datetime",""):e.isGroup||0!==t("#mck-message-cell .mck-message-inner div[name='message']").length||ue.removeClass("vis").addClass("n-vis"):(e.startTime,Me.data("datetime",""))),i+""!="null"&&"error"!==i.status)){if(o){if(c&&(e.startTime>0?st.processMessageList(i,!1,!0):e.isGroup||(st.processMessageList(i,!0,!0),ue.removeClass("n-vis").addClass("vis"))),!e.startTime>0&&!e.isGroup&&"function"==typeof J&&J(e.tabId),i.userDetails.length>0&&t.each(i.userDetails,function(t,s){if(pt.MCK_USER_DETAIL_MAP[s.userId]=s,!e.isGroup&&(s.connected?a.MCK_OL_MAP[s.userId]=!0:(a.MCK_OL_MAP[s.userId]=!1,void 0!==s.lastSeenAtTime&&(I[s.userId]=s.lastSeenAtTime)),R||e.isGroup||(s.blockedByThis?(k[s.userId]=!0,Qe.toggleBlockUser(e.tabId,!0)):s.blockedByOther?(C[s.userId]=!0,T.removeClass("mck-tab-title-w-status"),x.removeClass("vis").addClass("n-vis"),A.removeClass("vis").addClass("n-vis"),Me.data("blocked",!1)):Qe.toggleBlockUser(e.tabId,!1)),s.userName&&!e.startTime)){var o=st.getTabDisplayName(e.tabId,e.isGroup,s.userName);T.html(o),T.attr("title",o)}}),!Te||e.isGroup||e.startTime||a.MCK_OL_MAP[e.tabId]||We.manageOfflineMessageTime(e.tabId),i.conversationPxys.length>0){var m=new Array;t.each(i.conversationPxys,function(e,s){if("object"==typeof s&&(m.push(s),M[s.id]=s,O[s.topicId]=[s.id],s.topicDetail))try{y[s.topicId]=t.parseJSON(s.topicDetail)}catch(e){a.console.log("Incorect Topic Detail!")}}),n&&(Ye[e.tabId]=m,st.addConversationMenu(e.tabId,e.isGroup))}if(e.conversationId){var p=M[e.conversationId];"object"==typeof p&&p.closed&&st.closeConversation()}e.startTime||(e.isGroup?(tt.addGroupStatus(et.getGroup(e.tabId)),st.updateUnreadCount("group_"+e.tabId,0,!0)):st.updateUnreadCount("user_"+e.tabId,0,!0)),i.groupFeeds.length>0&&t.each(i.groupFeeds,function(a,s){var o=et.addGroup(s);if(!e.startTime){var n=s.membersId,r=[];if(t.each(n,function(e,t){void 0===st.getContact(t)&&r.push(t)}),r.length>0)e.isMessages=c,e.messageData=i,e.isLoadMessageList=!0,nt.getUsersDetail(r,e);else{tt.addGroupStatus(o);var l,d=!0;7===o.type&&(q.removeClass("vis").addClass("n-vis"),Xe.getContactFromGroupOfTwo(o,function(e){l=st.fetchContact(e)}),Qe.lastSeenOfGroupOfTwo(l.contactId)),"kommunicate"==window.applozic.PRODUCT_ID&&(3!==o.users[Ce].role&&2!==o.users[Ce].role&&0!==o.users[Ce].role||q.removeClass("vis").addClass("n-vis")),6===o.type&&(tt.validateOpenGroupUser(o),d=Xe.isAppendOpenGroupContextMenu(o)),K.removeClass("vis").addClass("n-vis"),c?(st.processMessageList(i,!0,d),6!==o.type&&ue.removeClass("n-vis").addClass("vis")):0===t("#mck-message-cell .mck-message-inner div[name='message']").length&&ue.removeClass("vis").addClass("n-vis"),"function"==typeof J&&J(e.tabId)}}})}else e.startTime||(a.MCK_OL_MAP=[]),i.userDetails.length>0&&t.each(i.userDetails,function(e,t){pt.MCK_USER_DETAIL_MAP[t.userId]=t,t.connected?a.MCK_OL_MAP[t.userId]=!0:(a.MCK_OL_MAP[t.userId]=!1,void 0!==t.lastSeenAtTime&&(I[t.userId]=t.lastSeenAtTime)),st.updateUnreadCount("user_"+t.userId,t.unreadCount,!1);var s=st.getContact(""+t.userId);void 0===s?st.createContactWithDetail(t):st.updateContactDetail(s,t)}),i.groupFeeds.length>0&&t.each(i.groupFeeds,function(e,t){st.updateUnreadCount("group_"+t.id,t.unreadCount,!1),et.addGroup(t)}),i.blockedUserPxyList.blockedToUserList.length>0&&t.each(i.blockedUserPxyList.blockedToUserList,function(e,t){t.userBlocked&&(k[t.blockedTo]=!0)}),i.blockedUserPxyList.blockedByUserList.length>0&&t.each(i.blockedUserPxyList.blockedByUserList,function(e,t){t.userBlocked&&(C[t.blockedBy]=!0)}),i.conversationPxys.length>0&&t.each(i.conversationPxys,function(e,s){if(M[s.id]=s,O[s.topicId]=[s.id],s.topicDetail)try{y[s.topicId]=t.parseJSON(s.topicDetail)}catch(e){a.console.log("Incorect Topic Detail!")}}),c?(e.startTime?e.startTime&&(e.isReload=!1,o||ALStorage.updateLatestMessageArray(i.message)):(e.isReload=!0,o||ALStorage.setLatestMessageArray(i.message)),o&&ALStorage.updateMckMessageArray(i.message),st.addContactsFromMessageList(i,e)):Me.data("datetime",""),e.isLaunch&&st.updateUnreadCountonChatIcon(i.userDetails);var u,v,g;if(i.userDetails.length>0&&i.groupFeeds.length>0)g=void 0!==e.groupName?e.groupName:st.getTabDisplayName(e.tabId,e.isGroup,e.userName),u=bt==g?i.groupFeeds[0].metadata.CONVERSATION_ASSIGNEE:g,t.each(i.userDetails,function(e,t){if(t.userId==u||t.displayName==u)return v=t,!1}),t(".mck-agent-image-container").removeClass("n-vis").addClass("vis"),t(".mck-agent-status-text").removeClass("n-vis").addClass("vis"),void 0!==v&&void 0!==v.imageLink&&t(".mck-agent-image-container img").attr("src",v.imageLink),MCK_LABELS.away?(t(".mck-agent-image-container .mck-agent-status-indicator").addClass("mck-status--away").removeClass("mck-status--online").removeClass("mck-status--offline"),t("#mck-agent-status-text").text(MCK_LABELS.away).addClass("vis").removeClass("n-vis")):void 0!==v&&1===v.roleType?(t(".mck-agent-image-container .mck-agent-status-indicator").addClass("mck-status--online").removeClass("mck-status--offline"),t("#mck-agent-status-text").text(MCK_LABELS.online).addClass("vis").removeClass("n-vis")):void 0!==v&&8===v.roleType&&(void 0!==v&&1==v.connected?(t(".mck-agent-image-container .mck-agent-status-indicator").addClass("mck-status--online").removeClass("mck-status--offline"),t("#mck-agent-status-text").text(MCK_LABELS.online).addClass("vis").removeClass("n-vis")):(t(".mck-agent-image-container .mck-agent-status-indicator").addClass("mck-status--offline").removeClass("mck-status--online"),t("#mck-agent-status-text").text(MCK_LABELS.offline).addClass("vis").removeClass("n-vis")))}var h=r.data("forwardMessageKey");void 0!==h&&(ot.sendForwardMessage(h),r.data("forwardMessageKey","")),"function"==typeof s&&s(i)},error:function(e,t,o){401===e.status&&(sessionStorage.clear(),console.log("Please reload page.")),f=!1,K.removeClass("vis").addClass("n-vis"),a.console.log("Unable to load messages. Please reload page."),"function"==typeof s&&s(null,o)}})},o.updateContactList=function(e,t){var a={};t?a.groupId=e:a.userId=e,a.pageSize=1,window.Applozic.ALApiService.getMessages({data:a,success:function(a){var s=a.data;if(s+""=="null"||void 0===s.message||0===s.message.length)st.clearContactMessageData(e,t);else{var n=s.message[0];void 0!==n&&(n.groupId?Xe.addGroupFromMessage(n,!0,function(e,t,a){o.updateRecentConversationList(e,t,a)}):st.addContactsFromMessage(n,!0))}},error:function(a){st.clearContactMessageData(e,t)}})},o.conversationReadUpdate=function(e){var t=e.tabId,a=e.isGroup?"group_"+t:"user_"+t;if(t&&st.getUnreadCount(a)>0){var s=""+e.isGroup=="true"?"groupId="+t:"userId="+t;window.Applozic.ALApiService.conversationReadUpdate({data:s,success:function(e){st.updateUnreadCount(a,0,!0)},error:function(){}})}},o.getConversationId=function(e){if(!e.isGroup&&!e.isMessage&&e.topicStatus!==De[1]){var s=O[e.topicId];if(s&&"object"==typeof(n=M[s])){if(Me.data("mck-conversationid",n.id),e.conversationId=n.id,void 0!==Ye[e.tabId]){var o=Ye[e.tabId];o.push(n),Ye[e.tabId]=o}return void st.loadTab(e)}}if(e.topicId){var n={topicId:e.topicId,userId:e.tabId,status:e.topicStatus};e.isGroup?n.groupId=e.groupId:n.userId=e.tabId;var i=y[e.topicId];"object"==typeof i&&(n.topicDetail=a.JSON.stringify(i)),e.fallBackTemplatesList&&e.fallBackTemplatesList.length>0&&(n.fallBackTemplatesList=e.fallBackTemplatesList),window.Applozic.ALApiService.getConversationId({data:n,success:function(s){if("object"==typeof s&&"success"===s.status){var o=s.response;if("object"==typeof o&&"undefined"!==o.conversationPxy){var n=o.conversationPxy;if(M[n.id]=n,O[n.topicId]=[n.id],n.topicDetail)try{y[n.topicId]=t.parseJSON(n.topicDetail)}catch(e){a.console.log("Incorect Topic Detail!")}if(Me.data("mck-conversationid",n.id),e.conversationId=n.id,void 0!==Ye[e.tabId]){var i=Ye[e.tabId];i.push(n),Ye[e.tabId]=i}if(e.isGroup){var r=et.addGroup(o);e.tabId=r.contactId}e.isMessage&&n.created?st.loadTab(e,rt.dispatchMessage):st.loadTab(e)}}},error:function(){}})}},o.sendPriceMessage=function(){var e=Q.val();if(""!==e){e=t.trim(e);var a=i.val(),s=Me.data("mck-conversationid",s),n={type:5,contentType:4,message:e};if(!0===Me.data("isgroup")?n.groupId=a:n.to=a,Me.data("mck-conversationid")){var s=Me.data("mck-conversationid");n.conversationId=s;var r=M[s];"object"!==r?rt.getTopicId({conversationId:s,suppId:a,priceText:e},function(e){st.populateMessage(e.messageType,e.message,e.notifyUser)}):"function"==typeof ne&&ne({custId:Ce,suppId:a,productId:r.topicId,price:e}),Q.val("")}o.sendMessage(n)}else Q.addClass("mck-text-req")},o.getGroup=function(e){var s=[];t.each(e.users,function(e,t){void 0!==t.userId&&(void 0!==t.groupRole&&-1===G.indexOf(t.groupRole)||s.push(t))});var o={groupName:t.trim(e.groupName),users:s,type:e.type};e.admin&&(o.admin=e.admin),e.clientGroupId&&(o.clientGroupId=e.clientGroupId),e.groupIcon&&(o.imageUrl=e.groupIcon),o.metadata=e.metadata?e.metadata:MCK_LABELS["group.metadata"];var n=new Object;let i={"UserId-Enabled":!0,Authorization:"Basic "+c,"Application-Key":U,"Device-Key":d,"Access-Token":W};Je.ajax({url:MCK_BASE_URL+"/rest/ws/group/v2.1/create",global:!1,data:a.JSON.stringify(o),type:"post",headers:i,contentType:"application/json",success:function(s){if(e.isInternal&&re.attr("disabled",!1).html(MCK_LABELS["create.group.title"]),"object"==typeof s&&"success"===s.status){var o=s.response;if("object"==typeof o){var i=et.addGroup(o);o.users.length>0&&t.each(o.users,function(e,t){pt.MCK_USER_DETAIL_MAP[t.userId]=t,t.connected?a.MCK_OL_MAP[t.userId]=!0:(a.MCK_OL_MAP[t.userId]=!1,void 0!==t.lastSeenAtTime&&(I[t.userId]=t.lastSeenAtTime)),st.updateUnreadCount("user_"+t.userId,t.unreadCount,!1);var s=st.getContact(""+t.userId);void 0===s?st.createContactWithDetail(t):st.updateContactDetail(s,t)}),e.tabId=i.contactId,e.isGroup=!0,e.isMessage?st.loadTab(e,rt.dispatchMessage):e.isInternal?(Me.data("mck-id",i.contactId),Me.data("isgroup",!0),tt.loadGroupInfo({groupId:i.contactId})):st.loadTab(e),"function"==typeof e.callback&&(n.updated=!!s.updated&&s.updated,n.status="success",n.data=i,e.callback(n))}}else"error"===s.status&&"function"==typeof e.callback&&(n.status="error",n.errorMessage=s.errorResponse[0].description,e.callback(n))},error:function(){e.isInternal&&re.attr("disabled",!1).html(MCK_LABELS["create.group.title"]),"function"==typeof e.callback&&(n.status="error",n.errorMessage="Unable to process request.",e.callback(n))}})}},nt=new function(){t("#mck-search-list");var e=t("#mck-sidebox-search"),s=t("#mck-search-loading");t("#mck-search-cell .mck-message-inner"),t("#mck-message-cell .mck-message-inner"),t(".mck-tab-message-option"),t("#mck-contact-loading");this.getContactDisplayName=function(e){var t=[];window.Applozic.ALApiService.getContactDisplayName({data:{userIdArray:e},success:function(e){for(var a in e)if(e.hasOwnProperty(a)){t.push([a,e[a]]),He[a]=e[a];var s=st.fetchContact(a);s.displayName=e[a]}ALStorage.updateMckContactNameArray(t)},error:function(){}})},this.loadContacts=function(){var o=[];window.Applozic.ALApiService.getContactList({url:"/rest/ws/user/v3/filter?startIndex=0&pageSize=50&orderBy=1",baseUrl:MCK_BASE_URL,success:function(s){if(e.hasClass("vis"))return"object"==typeof s&&s.users.length>0&&(t.each(s.users,function(e,t){if(void 0!==t.userId){var s=st.getContact(""+t.userId);s=void 0===s?st.createContactWithDetail(t):st.updateContactDetail(s,t),$e.push(s),o.push([t.userId,s.displayName]),t.connected?a.MCK_OL_MAP[t.userId]=!0:(a.MCK_OL_MAP[t.userId]=!1,void 0!==t.lastSeenAtTime&&(I[t.userId]=t.lastSeenAtTime))}}),nt.getUsersDetail(contactNameArray,{async:!1}),o.length>0&&ALStorage.updateMckContactNameArray(o)),st.addContactsToSearchList(),void tt.addMembersToGroupSearchList()},error:function(){s.removeClass("vis").addClass("n-vis"),a.console.log("Unable to load contacts. Please reload page.")}})},this.getUsersDetail=function(e,s){if(!(void 0===e||e.length<1)){for(var o=void 0===s.cached||s.cached,n=[],i=e.filter(function(t,a){return e.indexOf(t)===a}),r=0;r<i.length;r++){var c=i[r];o&&void 0!==pt.MCK_USER_DETAIL_MAP[c]||n.push(c)}if(0!==n.length){var l=new Object;window.Applozic.ALApiService.getUserDetail({data:{userIdList:n},success:function(e){"success"===e.status&&e.response.length>0&&t.each(e.response,function(e,t){pt.MCK_USER_DETAIL_MAP[t.userId]=t,a.MCK_OL_MAP[t.userId]=t.connected;var s=st.getContact(""+t.userId);s=void 0===s?st.createContactWithDetail(t):st.updateContactDetail(s,t)}),s.setStatus?Qe.updateUserConnectedStatus():s.message?st.populateMessage(s.messageType,s.message,s.notifyUser):s.isLoadMessageList&&st.loadMessageListOnUserDetailFetch(s),l.status="success",l.data=e,s.callback&&s.callback(l)},error:function(){s.setStatus?Qe.updateUserConnectedStatus():s.message?st.populateMessage(s.messageType,s.message,s.notifyUser):s.isLoadMessageList&&st.loadMessageListOnUserDetailFetch(s),l.status="error",s.callback&&s.callback(l)}})}else s.setStatus?Qe.updateUserConnectedStatus():s.message?st.populateMessage(s.messageType,s.message,s.notifyUser):s.isLoadMessageList&&st.loadMessageListOnUserDetailFetch(s)}},this.updateUserIdentity=function(e){if(null!==e.newUserId&&""!==e.newUserId){var t="newUserId="+encodeURIComponent(e.newUserId);Je.ajax({url:MCK_BASE_URL+"/rest/ws/user/change/identifier",type:"get",data:t,contentType:"application/json",success:function(t){"object"==typeof t&&"success"===t.status&&e.callback&&e.callback(t)},error:function(t){e.callback&&e.callback({response:"error"})}})}},this.updateUser=function(e){Je.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/user/update",data:a.JSON.stringify(e.data),contentType:"application/json",success:function(t){e.success&&e.success(t)},error:function(t){e.error&&e.error(t)}})},this.updateDisplayName=function(e,a){if(""!==e&&""!==a){var s="userId="+e+"&displayName="+a;t.ajax({url:MCK_BASE_URL+"/rest/ws/user/name",type:"get",data:s,success:function(e){if("object"==typeof e&&"success"===e.status)return"success"},error:function(){}})}}},it=new function(){var e,a,o,n,i=this;i.init=function(){t("#mck-sidebox"),a=t("#mck-group-info-tab"),t("#mck-sidebox-launcher"),e=t("#mck-message-cell .mck-message-inner"),o=t("#mck-msg-preview-visual-indicator"),n=t("#mck-msg-preview-visual-indicator .mck-msg-preview-visual-indicator-text")},i.notifyUser=function(e){if(!1!==e.alert&&7!==e.type&&!1!==e.metadata.alert){var t=e.groupId?et.getGroup(""+e.groupId):st.fetchContact(""+e.to.split(",")[0]),a=!1;e.groupId&&(a=!0),pt.loadUserProfile(e.to);var s=st.getTabDisplayName(t.contactId,a),o=gt;if(i.showNewMessageNotification(e,t,s),Ue&&!T){var n=pe,r=st.getTextForMessagePreview(e,t);if("function"==typeof ie&&!t.isGroup){var c=ie(t.contactId);c&&void 0!==c&&(n=c)}o?dt.sendDesktopNotification(s,n,r,o):dt.sendDesktopNotification(s,n,r)}}},i.showNewMessageNotification=function(i,r,c){if(Ke&&102!==i.contentType&&!i.metadata.KM_ASSIGN&&!i.metadata.KM_STATUS){var l=e.data("mck-id"),d=e.data("isgroup");if(l===r.contactId&&d===r.isGroup&&!a.hasClass("vis")){if(!i.conversationId||!_e&&!ye)return;var m=e.data("mck-conversationid");if((m=void 0!==m&&""!==m?m.toString():"")===i.conversationId.toString())return}n.data("isgroup",r.isGroup);var p=i.conversationId?i.conversationId:"";n.data("mck-conversationid",p);var u=st.getContactImageLink(r,c);if(i.message){var v=st.getMessageTextForContactPreview(i,r);n.html(""),n.removeClass("mck-flexi"),"object"==typeof v?n.append(v):n.html(v),o.removeClass("n-vis").addClass("vis")}else n.html("");if(i.fileMetaKey)n.html(ct.getFileIcon(i)),o.removeClass("n-vis").addClass("vis"),n.addClass("mck-flexi");else if(2===i.contentType){for(;"."===v[v.length-1];)v=v.slice(0,-1);n.html(v),o.removeClass("n-vis").addClass("vis"),n.addClass("mck-flexi")}-1!=!u.indexOf("/avatars/default.png")?(t("#launcher-agent-img-container").html(u),t("#launcher-agent-img-container").addClass("vis").removeClass("n-vis"),t("#launcher-svg-container").addClass("n-vis").removeClass("vis")):(t("#launcher-agent-img-container").html("").addClass("n-vis").removeClass("vis"),t("#launcher-svg-container").addClass("vis").removeClass("n-vis")),void 0!==ge&&document.getElementById("mck-sidebox-launcher").childNodes[0].childNodes[0].classList.add("n-vis"),n.data("mck-id",r.contactId),Tt.onNotificationEvent(i),t(s).on("click","#mck-msg-preview-visual-indicator .mck-close-btn, #mck-msg-preview-visual-indicator .mck-msg-preview-visual-indicator-text",function(){o.removeClass("vis").addClass("n-vis"),n.html("")})}}},rt=new AlMessageService,ct=new AlFileService,lt=new KmCustomTheme,dt=new MckNotificationUtils,mt=new AlNotificationService,pt=new AlUserService,ut=t(".chat-launcher-icon"),vt=new function(){var e,a=this;a.token=null,a.Identity=null,a.outgoingCallServices=null,a.incomingCallServices=null;var s=t(".mck-videocall-btn"),o=t(".applozic-vid-container"),n=t("#mck-sidebox"),i=t("#mck-video-call-indicator"),r=t("#mck-video-box");a.hideVideoBox=function(){o.addClass("n-vis").removeClass("vis"),n.addClass("vis").removeClass("n-vis"),i.addClass("n-vis").removeClass("vis")},a.init=function(){r.mckModal(),ft.loop=!0,a.token=null!==ALStorage.getAppHeaders()?ALStorage.getAppHeaders().videoToken:void 0,a.ringToneForHost=A.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",ft),t("#mck-btn-video-call").on("click",function(s){if(a.token){var o=$mck_msg_to.val(),n=Ce+(new Date).getTime().toString()+Math.random().toString(36).slice(2),i=rt.sendVideoCallMessage(n,"CALL_DIALED",102,!1,o,function(e){ot.sendMessage(e)}),r=st.fetchContact(i.to),c=st.getTabDisplayName(r.contactId,!1),l=st.getContactImageLink(r,c),d=new Date,m=Ce;a.outgoingCallServices=new MckCallingService(m,vt.token,n,c,!0,d,ot,l,!1,a.ringToneForHost),a.outgoingCallServices.startVideoCall(),t("#mck-btn-video-call").data("isCallHost",!0),t("#mck-btn-video-call").data("callStartTime",d)}else"INSUFFICIENT_FUNDS"===e?alert("Video calling is not available at the moment. For details, contact support."):alert("missing token... please refresh page..")}),t("#mck-vid-receive-btn").on("click",function(e){console.log("call received"),t("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),s.removeClass("vis").addClass("n-vis");var a=t("#mck-video-call-indicator").data("call-id"),o=t("#mck-video-call-indicator").data("isAudioCall");t("#mck-video-call-indicator").data("callReceived",!0),t("#mck-video-call-indicator").addClass("n-vis"),vt.callReceived(a,o)}),t("#mck-vid-reject-btn").on("click",function(e){console.log("call rejected");var a=t("#mck-video-call-indicator").data("call-id"),s=t("#mck-video-call-indicator").data("isAudioCall");vt.callRejected(a,s),t("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})},a.InitilizeVideoClient=function(s,o){a.Identity=s,t.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:s,device:o},success:function(t){if(null!=t&&""!=t){a.token=t.token;var s=ALStorage.getAppHeaders();s.videoToken=t.token,ALStorage.setAppHeaders(s)}t.hasOwnProperty("errorResponse")&&(e=t.errorResponse[0].description)},error:function(e){console.log("error while getting token"+e)}})},a.callReceived=function(e,t){var s=$mck_msg_to.val();console.log("_this.callReceived"),Ct&&Ct.stop();rt.sendVideoCallMessage(e,"CALL_ANSWERED",102,t,s,function(e){ot.sendMessage(e)});a.incomingCallServices=new MckCallingService(a.Identity,a.token,e,null,!1,null,ot,null,t),a.incomingCallServices.startVideoCall()},a.callRejected=function(e,t){Ct&&Ct.stop();rt.sendVideoCallMessage(e,"CALL_REJECTED",102,t,toUser,function(e){ot.sendMessage(e)})}},gt=null,ft={},kt=!1,Ct=null,ht=ot.checkArray(i.askUserDetails),bt=i.conversationTitle,yt=i.agentId,It=i.botIds,Mt=(i.agentName,"boolean"!=typeof i.useBranding||i.useBranding);a.MCK_OL_MAP=new Array,l.submitMessage=function(e){ot.submitMessage(e.messagePxy,e.optns)},l.mckLaunchSideboxChat=function(){t("#mck-sidebox-launcher").removeClass("vis").addClass("n-vis"),KommunicateUI.showChat();t("#mck-away-msg-box").removeClass("vis").addClass("n-vis"),ot.loadConversationWithAgents({groupName:bt,agentId:yt,botIds:It},function(e){console.log("conversation created successfully"),KommunicateUI.activateTypingField(),Kommunicate.conversation.processConversationOpenedFromList(e)}),t("#mck-msg-preview-visual-indicator").hasClass("vis")&&t("#mck-msg-preview-visual-indicator").removeClass("vis").addClass("n-vis")},l.openChat=function(e){ot.openChat(e)},l.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){},onMessageNotification:function(e){}},l.loadConversationWithAgent=function(e){if(!e||!e.agentId)throw new Error("params are empty");console.log("setting default agent inside Applozic"),ot.loadConversationWithAgents(e)};var Tt=new function(e){var s,o,n=this,i=e.events,c=null,l=null,p="",u=null,v=[],f="",h=t("#mck-sidebox"),b=t("#mck-tab-title"),T=t(".mck-typing-box"),E=t("#mck-tab-status"),S=(t("#mck-offline-message-box"),t("#mck-typing-label")),x=t("#mck-message-cell .mck-message-inner"),L=t(".mck-message-inner");n.init=function(){if(void 0!==m){var e=Je.startsWith(m,"https")?"15675":"15674";"function"==typeof a.SockJS&&(f||(f=new SockJS(m+":"+e+"/stomp")),(l=a.Stomp.over(f)).heartbeat.outgoing=0,l.heartbeat.incoming=0,l.onclose=function(){n.disconnect()},l.connect("guest","guest",n.onConnect,n.onError,"/"),a.addEventListener("beforeunload",function(e){n.disconnect()}))}},n.checkConnected=function(e){l.connected?(s&&clearInterval(s),o&&clearInterval(o),s=setInterval(function(){n.connectToSocket(e)},6e5),o=setInterval(function(){n.sendStatus(1)},12e5)):n.connectToSocket(e)},n.connectToSocket=function(e){if(!l.connected){if(e&&"block"===h.css("display")){var t=x.data("mck-id");if(t){var a=x.data("isgroup"),s=x.data("mck-conversationid"),o=x.data("mck-topicid");ALStorage.clearMckMessageArray(),st.loadTab({tabId:t,isGroup:a,conversationId:s,topicId:o})}else ALStorage.clearMckMessageArray(),st.loadTab({tabId:"",isGroup:!1})}n.init()}},n.stopConnectedCheck=function(){s&&clearInterval(s),o&&clearInterval(o),s="",o="",n.disconnect()},n.disconnect=function(){clearInterval(void 0),l&&l.connected&&(n.sendStatus(0),l.disconnect(),f.close(),f="")},n.unsubscibeToTypingChannel=function(){l&&l.connected&&u&&(1===g&&n.sendTypingStatus(0,p),u.unsubscribe()),u=null},n.unsubscibeToNotification=function(){l&&l.connected&&c&&c.unsubscribe(),c=null},n.subscibeToTypingChannel=function(e,t){var a=t?e:Ce;l&&l.connected?u=l.subscribe("/topic/typing-"+U+"-"+a,n.onTypingStatus):n.reconnect()},n.subscribeToOpenGroup=function(e){if(l&&l.connected){var t=l.subscribe("/topic/group-"+U+"-"+e.contactId,n.onOpenGroupMessage);v.push(t.id),K[e.contactId]=t.id}else n.reconnect()},n.sendTypingStatus=function(e,t){if(l&&l.connected){if(1===e&&1===g&&l.send("/topic/typing-"+U+"-"+p,{"content-type":"text/plain"},U+","+Ce+","+e),t){if(t===p&&e===g&&1===e)return;p=t,l.send("/topic/typing-"+U+"-"+t,{"content-type":"text/plain"},U+","+Ce+","+e),setTimeout(function(){g=0},6e4)}else 0===e&&l.send("/topic/typing-"+U+"-"+p,{"content-type":"text/plain"},U+","+Ce+","+e);g=e}},n.onTypingStatus=function(e){if(null!=u&&u.id===e.headers.subscription){var a=e.body,s=a.split(",")[1],o=Number(a.split(",")[2]),n=e.headers.destination.substring(e.headers.destination.lastIndexOf("-")+1,e.headers.destination.length),i=x.data("mck-id"),r=x.data("isgroup"),c=et.getGroup(i);if(!k[s]&&!C[s])if(1===o){if(!(Ce===s&&r||i!==s&&i!=n)){var r=x.data("isgroup");if(r){if(s!==Ce){if(Xe.authenticateGroupUser(c)||6===c.type&&!ce.disableChatForNonGroupMember){b.addClass("mck-tab-title-w-typing"),E.removeClass("vis").addClass("n-vis");var l=st.getTabDisplayName(s,!1);l=l.split(" ")[0],S.html(l+" "+MCK_LABELS["is.typing"])}7===c.type&&(b.addClass("mck-tab-title-w-typing"),S.html(MCK_LABELS["is.typing"]),E.html(""))}}else b.addClass("mck-tab-title-w-typing"),E.removeClass("vis").addClass("n-vis");t(".km-typing-wrapper").remove(),L.append('<div class="km-typing-wrapper"><div class="km-typing-indicator"></div><div class="km-typing-indicator"></div><div class="km-typing-indicator"></div></div>'),L.animate({scrollTop:L.prop("scrollHeight")},0),setTimeout(function(){b.removeClass("mck-tab-title-w-typing"),t(".km-typing-wrapper").remove(),b.hasClass(void 0===c||7!=c.type),S.html(MCK_LABELS.typing)},1e4)}}else b.removeClass("mck-tab-title-w-typing"),T.removeClass("vis").addClass("n-vis"),t(".km-typing-wrapper").remove(),b.hasClass("mck-tab-title-w-status")&&(void 0===c||c.type),S.html(MCK_LABELS.typing)}},n.reconnect=function(){n.unsubscibeToTypingChannel(),n.unsubscibeToNotification(),n.disconnect(),n.init()},n.onNotificationEvent=function(e){i.onMessageNotification(e)},n.onError=function(e){a.console.log("Error in channel notification. "+e),i.onConnectFailed()},n.sendStatus=function(e){l&&l.connected&&l.send("/topic/status-v2",{"content-type":"text/plain"},r+","+d+","+e)},n.onConnect=function(){l.connected?(c&&n.unsubscibeToNotification(),c=l.subscribe("/topic/"+r,n.onMessage),n.sendStatus(1),n.checkConnected(!0)):setTimeout(function(){c=l.subscribe("/topic/"+r,n.onMessage),n.sendStatus(1),n.checkConnected(!0)},5e3),i.onConnect()},n.onOpenGroupMessage=function(e){if(-1!==v.indexOf(e.headers.subscription)){var a=t.parseJSON(e.body),s=a.type,o=a.message;if("APPLOZIC_03"===s)ALStorage.updateLatestMessage(o),0!==o.type&&4!==o.type&&(t("."+o.key+" .mck-message-status").removeClass("mck-pending-icon").addClass("mck-sent-icon").attr("title","sent"),st.addTooltip(o.key)),i.onMessageSentUpdate({messageKey:o.key});else if("APPLOZIC_01"===s||"APPLOZIC_02"===s||"MESSAGE_RECEIVED"===s){ALStorage.updateLatestMessage(o);var n=o.groupId?et.getGroup(o.groupId):st.getContact(o.to);t("#mck-sidebox-content"),x.data("mck-id");if("APPLOZIC_01"===s||"MESSAGE_RECEIVED"===s){var r=st.getMessageFeed(o);i.onMessageReceived({message:r})}else if("APPLOZIC_02"===s){var r=st.getMessageFeed(o);i.onMessageSent({message:r})}if(o.conversationId){var c=M[o.conversationId];!_e&&!ye||"object"==typeof c&&"object"==typeof y[c.topicId]||rt.getTopicId({conversationId:o.conversationId,messageType:s,message:o,notifyUser:a.notifyUser,async:!1,populate:!1},function(e){st.populateMessage(e.messageType,e.message,e.notifyUser)})}if(void 0===n){var l={message:o,messageType:s,notifyUser:a.notifyUser};if(o.groupId)tt.getGroupFeedFromMessage(l);else{var d=[];d.push(o.to),nt.getUsersDetail(d,l)}return}st.populateMessage(s,o,a.notifyUser)}}},n.onMessage=function(e){if(null!=c&&c.id===e.headers.subscription){var s=t.parseJSON(e.body),o=s.type;if("APPLOZIC_04"===o||"MESSAGE_DELIVERED"===o)t("."+s.message.split(",")[0]+" .mck-message-status").removeClass("mck-pending-icon").removeClass("mck-sent-icon").addClass("mck-delivered-icon").attr("title","delivered"),st.addTooltip(s.message.split(",")[0]),i.onMessageDelivered({messageKey:s.message.split(",")[0]});else if("APPLOZIC_08"===o||"MT_MESSAGE_DELIVERED_READ"===o)t("."+s.message.split(",")[0]+" .mck-message-status").removeClass("mck-pending-icon").removeClass("mck-sent-icon").removeClass("mck-delivered-icon").addClass("mck-read-icon"),st.addTooltip(s.message.split(",")[0]),i.onMessageRead({messageKey:s.message.split(",")[0]});else if("APPLOZIC_05"===o){var n=s.message.split(",")[0],r=s.message.split(",")[1],l="1"===s.message.split(",")[2];st.removedDeletedMessage(n,r,l);var d={messageKey:s.message.split(",")[0]};l?d.groupId=r:d.userKey=r,i.onMessageDeleted(d)}else if("APPLOZIC_27"===o){var m=s.message.split(",")[0],p=s.message.split(",")[1];if(void 0!==m){st.removeConversationThread(m,!1),st.updateUnreadCount("user_"+m,0,!0);var u={userId:m};p&&(u.topicId=p),i.onConversationDeleted(u)}}else if("APPLOZIC_11"===o){var m=s.message,v=st.fetchContact(m),r=x.data("mck-id");if(!k[m]&&!C[m]){if(r!==v.contactId||x.data("isgroup")){var g=mckContactUtils.formatContactId(m);t("#li-user-"+g+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else t("#mck-tab-status").html(MCK_LABELS.online),Te&&st.hideOfflineMessage();t(".mck-user-ol-status."+g).removeClass("n-vis").addClass("vis"),t(".mck-user-ol-status."+g).next().html("("+MCK_LABELS.online+")"),a.MCK_OL_MAP[m]=!0,pt.updateUserStatus({userId:s.message,status:1},function(e){nt.getUsersDetail(e,{})})}i.onUserConnect({userId:s.message})}else if("APPLOZIC_12"===o){var m=s.message.split(",")[0],f=s.message.split(",")[1],v=st.fetchContact(m);if(a.MCK_OL_MAP[m]=!1,f&&(I[m]=f),!k[m]&&!C[m]){var r=x.data("mck-id");r!==v.contactId||x.data("isgroup")||(t("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(f)),Te&&We.manageOfflineMessageTime(r)),t(".mck-user-ol-status."+v.htmlId).removeClass("vis").addClass("n-vis"),t(".mck-user-ol-status."+v.htmlId).next().html("(Offline)"),t("#li-user-"+g+" .mck-ol-status").removeClass("vis").addClass("n-vis"),pt.updateUserStatus({userId:m,status:0,lastSeenAtTime:f},function(e){nt.getUsersDetail(e,{})})}i.onUserDisconnect({userId:m,lastSeenAtTime:f})}else if("APPLOZIC_29"===o){var m=s.message.split(",")[0],p=s.message.split(",")[1],v=st.fetchContact(m);st.updateUnreadCount("user_"+v.contactId,0,!0);var r=x.data("mck-id");void 0!==r&&""!==r||(t("#li-user-"+v.htmlId+" .mck-unread-count-text").html(st.getUnreadCount("user_"+v.contactId)),t("#li-user-"+v.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis"));var u={userId:m};p&&(u.topicId=p),i.onConversationReadFromOtherSource(u)}else if("APPLOZIC_28"===o){var m=s.message.split(",")[0],p=s.message.split(",")[1],r=x.data("mck-id");if(r===m){t(".mck-msg-right .mck-message-status").removeClass("mck-pending-icon").removeClass("mck-sent-icon").removeClass("mck-delivered-icon").addClass("mck-read-icon"),t(".mck-msg-right .mck-delivered-icon").attr("title","delivered and read");var v=st.getContact(m);if(void 0===v){var h=[];h.push(m),nt.getUsersDetail(h,{})}}var u={userId:m};p&&(u.topicId=p),i.onConversationRead(u)}else if("APPLOZIC_16"===o){var S=s.message.split(":")[0],m=s.message.split(":")[1],v=st.fetchContact(m),r=x.data("mck-id");r===v.contactId?S===ze[0]?(k[v.contactId]=!0,Qe.toggleBlockUser(r,!0)):(C[v.contactId]=!0,b.removeClass("mck-tab-title-w-status"),E.removeClass("vis").addClass("n-vis"),T.removeClass("vis").addClass("n-vis")):t("#li-user-"+v.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),i.onUserBlocked({status:S,userId:m})}else if("APPLOZIC_17"===o){var S=s.message.split(":")[0],m=s.message.split(":")[1],v=st.fetchContact(m),r=x.data("mck-id");r===v.contactId?S===ze[2]?(k[v.contactId]=!1,Qe.toggleBlockUser(r,!1)):(a.MCK_OL_MAP[r]||I[r])&&(C[v.contactId]=!1,k[r]||(a.MCK_OL_MAP[r]?E.html(MCK_LABELS.online):I[r]&&E.html(mckDateUtils.getLastSeenAtStatus(I[r])),b.addClass("mck-tab-title-w-status"))):a.MCK_OL_MAP[r]&&t("#li-user-"+v.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis"),i.onUserUnblocked({status:S,userId:m})}else if("APPLOZIC_18"===o)R=!1,i.onUserActivated();else if("APPLOZIC_19"===o)R=!0,i.onUserDeactivated();else{var L=s.message;if("APPLOZIC_03"===o)ALStorage.updateLatestMessage(L),0!==L.type&&4!==L.type&&(t("."+L.key+" .mck-message-status").removeClass("mck-pending-icon").addClass("mck-sent-icon"),st.addTooltip(L.key)),i.onMessageSentUpdate({messageKey:L.key});else if("APPLOZIC_01"===o||"APPLOZIC_02"===o||"MESSAGE_RECEIVED"===o){ALStorage.updateLatestMessage(L);var v=L.groupId?et.getGroup(L.groupId):st.getContact(L.to),r=(t("#mck-sidebox-content"),x.data("mck-id"));if("APPLOZIC_01"===o||"MESSAGE_RECEIVED"===o){var A=st.getMessageFeed(L);i.onMessageReceived({message:A})}else if("APPLOZIC_02"===o){var A=st.getMessageFeed(L);i.onMessageSent({message:A})}if(L.conversationId){var _=M[L.conversationId];!_e&&!ye||"object"==typeof _&&"object"==typeof y[_.topicId]||rt.getTopicId({conversationId:L.conversationId,messageType:o,message:L,notifyUser:s.notifyUser,async:!1,populate:!1},function(e){st.populateMessage(e.messageType,e.message,e.notifyUser)})}if(void 0===v){var w={message:L,messageType:o,notifyUser:s.notifyUser};if(L.groupId)tt.getGroupFeedFromMessage(w);else{var h=[];h.push(L.to),nt.getUsersDetail(h,w)}return}if(102==L.contentType&&F)if(s.notifyUser=!1,4==L.type&&"CALL_DIALED"==L.metadata.MSG_TYPE){var v=st.fetchContact(L.to),U=st.getTabDisplayName(v.contactId,!1),K=st.getContactImageLink(v,U);t("#mck-video-call-indicator").data("call-id",L.metadata.CALL_ID),t("#mck-video-call-indicator").data("isAudioCall",L.metadata.CALL_AUDIO_ONLY),t("#mck-video-call-indicator-txt").html(U+" calling..."),t("#mck-video-call-icon").html(K),t("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),Ct.play(),setTimeout(function(){var e=t("#mck-video-call-indicator").data("callReceived");e||(console.log("call is not answered"),Ct.stop(),t("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6e4)}else if(4==L.type&&"CALL_REJECTED"==L.metadata.MSG_TYPE&&t("#mck-btn-video-call").data("isCallHost")){var G=$mck_msg_to.val();rt.sendVideoCallMessage(L.metadata.CALL_ID,"CALL_REJECTED",103,!1,G,function(e){ot.sendMessage(e)}),vt.ringToneForHost.stop(),vt.outgoingCallServices.twilioService.leaveRoomIfJoined(),vt.hideVideoBox(),vt.outgoingCallServices&&(vt.outgoingCallServices.rejectedByReceiver=!0)}103==L.contentType?4==L.type&&"CALL_MISSED"==L.metadata.MSG_TYPE&&(t("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),Ct&&Ct.stop()):st.populateMessage(o,L,s.notifyUser)}}}}}(l);l.getOptions=function(){return i},l.init=function(){window.Applozic.ALApiService.initServerUrl(MCK_BASE_URL),ct.get(i),rt.init(i),lt.init(i),mt.init(i),st.init(),ft.loop=!1,ke&&(A=new RingToneService,gt=A.loadRingTone(ke,ft)),ot.init(),at.init(),tt.init(),We.initializeApp(i,!1),it.init(),Ze.init(),x&&(document.getElementById("mck-btn-smiley-box").classList.remove("n-vis"),st.initEmojis()),F&&(ft.loop=!0,A=new RingToneService,Ct=A.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",ft),vt.init())},l.reInit=function(e){KommunicateUtils.storeDataIntoKmSession("appOptions",e),"object"===t.type(e)&&(e=t.extend(!0,{},o,e),i.conversationTitle=i.conversationTitle||i.groupName,i.accessToken=i.password||i.accessToken,t.fn.applozic("reset",e),e.userId&&e.appId&&""!==t.trim(e.userId)&&""!==t.trim(e.appId)?(We.initializeApp(e,!0),i=e):a.console("Oops! looks like incorrect application id or user Id."))},l.loadTabView=function(e){void 0===e.isGroup&&(e.isGroup=!1),st.loadTab(e),t("#mck-search").val("")},l.loadTab=function(e,a){st.loadTab({tabId:e,isGroup:!1},a),t("#mck-search").val("")},l.loadChat=function(e){if(!(void 0!==e.userId&&""!==e.userId||void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId))return"UserId or groupId or clientGroupId required";var a={tabId:e.userId,isGroup:!1},a={};if(e.userId&&(a.tabId=userId,a.isGroup=!1),e.displayName&&(a.userName=e.displayName),e.convId&&(a.conversationId=e.convId),e.groupId||e.clientGroupId)if(a.isGroup=!0,e.clientGroupId){a.clientGroupId=e.clientGroupId;var s=et.getGroupByClientGroupId(e.clientGroupId);if("object"!=typeof s)return Xe.getGroupFeed({clientGroupId:a.clientGroupId,apzCallback:tt.onGroupFeed,callback:tt.loadGroupTab}),void t("#mck-search").val("");a.tabId=s.contactId}else{var s=et.getGroup(e.groupId);if("object"!=typeof s)return Xe.getGroupFeed({groupId:e.groupId,apzCallback:tt.onGroupFeed,callback:tt.loadGroupTab}),void t("#mck-search").val("");a.tabId=e.groupId}st.loadTab(a),t("#mck-search").val("")},l.uploadFile=function(e){at.uploadFile(e)},l.uploadAttachemnt=function(e){at.uploadAttachemnt(e.params,e.messagePxy)},l.audioAttach=function(e){at.audioRecoder(e)},l.loadGroupTab=function(e,a){if(void 0===e||""===e)return"GroupId required";var s=et.getGroup(e);"object"==typeof s?(st.loadTab({tabId:e,isGroup:!0},a),t("#mck-search").val("")):Xe.getGroupFeed({groupId:e,apzCallback:tt.onGroupFeed,callback:tt.loadGroupTab})},l.loadGroupTabByClientGroupId=function(e){if(void 0===e.clientGroupId||""===e.clientGroupId)return"Client Group Id Required";var a=et.getGroupByClientGroupId(e.clientGroupId);"object"==typeof a?(st.loadTab({tabId:a.contactId,isGroup:!0}),t("#mck-search").val("")):Xe.getGroupFeed({clientGroupId:e.clientGroupId,apzCallback:tt.onGroupFeed,callback:tt.loadGroupTab})},l.loadConvTab=function(e){"object"==typeof e&&e.userId&&e.convId&&st.loadTab({tabId:e.userId,conversationId:e.convId,isGroup:!1})},l.loadTabWithTopic=function(e){if("object"==typeof e&&(e.userId||e.groupId)&&e.topicId){var t={tabId:e.userId,topicId:e.topicId};if(e.userName&&(t.userName=e.userName),e.topicStatus?t.topicStatus=-1===De.indexOf(e.topicStatus)?De[0]:e.topicStatus.toString():t.topicStatus=De[0],"function"==typeof ae||e.topicDetail){var a=e.topicDetail?e.topicDetail:ae(e.topicId);"object"==typeof a&&"undefined"!==a.title&&(y[e.topicId]=a)}if(e.message){var s={type:5,contentType:0,message:message};t.messagePxy=s,t.isMessage=!0}else t.isMessage=!1;e.supportId?(t.isGroup=!0,t.supportId=supportId):(t.isGroup=!1,t.userId=e.userId),ot.getConversationId(t)}else{if(!e.userId||!e.groupId)return"UserId required";if(!e.topicId)return"TopicId required"}},l.loadContacts=function(e){st.loadContacts(e)},l.loadContactsForContactList=function(e){st.loadContactsForContactList(e)},l.setOffline=function(){void 0!==Tt&&Tt.sendStatus(0)},l.reset=function(e){a.sessionStorage.clear(),r="",c="",p=[],MCK_GROUP_MAP=[],u=!0,v=[],d="",L=e.mode,"",k=[],C=[],f=!1,h=90,U=e.appId,I=[],M=[],y=[],MCK_CLIENT_GROUP_MAP=[],T=!0,MCK_LABELS=e.labels,E=0,MCK_BASE_URL=e.baseUrl,fe=e.fileupload,_=e.customFileUrl,Pe=new Object,Fe=new Array,D=e.launcher,0,K=[],B=e.userName,z=e.visitor,O=[],$e=new Array,qe=new Object,$=e.fileBaseUrl,P=e.locShare,F=i.video,q=e.onInit,H=e.onTopicDetails,He=new Array,je=new Array,V=e.onClose,W=e.accessToken,Y=e.displayText,J=e.readConversation,Z=e.maxGroupSize,Ye=new Array,Q=e.onTabClicked,X=e.contactNumber,te=e.appModuleName,ae=e.getTopicDetail,ee=e.maxAttachmentSize,oe=e.validateMessage,se=e.contactDisplayName,Ve=new Array,ne=e.finalPriceResponse,ie=e.contactDisplayImage,re=e.priceWidget,ce=i.openGroupSettings,le=e.offlineMessageDetail,e.initAutoSuggestions,me=e.getConversationDetail,de=e.authenticationTypeId,Ce=z?"guest":t.trim(e.userId),he=P?e.googleApiKey:"NO_ACCESS",Ie="boolean"==typeof e.olStatus&&e.olStatus,ye="boolean"==typeof e.topicBox&&e.topicBox,Te="boolean"==typeof e.showOfflineMessage&&e.showOfflineMessage,_e="boolean"==typeof e.topicHeader&&e.topicHeader,Ke="boolean"!=typeof e.notification||e.notification,"boolean"==typeof e.swNotification&&e.swNotification,e.supportId?'data-mck-id="'+e.supportId+'"':"",Ee="boolean"==typeof e.hideGroupSubtitle&&e.hideGroupSubtitle,Se=void 0===e.defaultMessageMetaData?{}:e.defaultMessageMetaData,xe="boolean"==typeof e.groupUserCount&&e.groupUserCount,Ue="boolean"==typeof e.desktopNotification&&e.desktopNotification,we="boolean"==typeof e.loadOwnContacts&&e.loadOwnContacts,Me="boolean"==typeof e.messageBubbleAvator&&e.messageBubbleAvator,Ae="boolean"==typeof i.resetUserStatus&&i.resetUserStatus,Ne="boolean"==typeof e.launchOnNewMessage&&e.launchOnNewMessage,Ge="boolean"!=typeof e.autoTypeSearchEnabled||e.autoTypeSearchEnabled,Le="boolean"==typeof e.checkUserBusyWithStatus&&e.checkUserBusyWithStatus,Oe="boolean"==typeof e.launchOnUnreadMessage&&e.launchOnUnreadMessage,ht=i.askUserDetails},l.logout=function(){void 0!==Tt&&(Tt.disconnect(),ALStorage.clearMckMessageArray(),t.fn.applozic("reset",i),t("#mck-sidebox").hide(),t("#mck-sidebox-launcher").hide()),u=!1},l.setOnline=function(){void 0!==Tt&&Tt.sendStatus(1)},l.getUserStatus=function(e){"function"==typeof e.callback&&(void 0!==e.userIds?nt.getUsersDetail(e.userIds,e):pt.getUserStatus(e,function(e){t.each(e.users,function(e,t){var a=st.getContact(""+t.userId);a=void 0===a?st.createContactWithDetail(t):st.updateContactDetail(a,t),Ve.push(a.contactId)})}))},l.getGroupList=function(e){return"function"==typeof e.callback?(e.apzCallback=tt.loadGroups,Xe.loadGroups(e),"success"):"Callback Function Required"},l.leaveGroup=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?(e.apzCallback=tt.onGroupLeft,Xe.leaveGroup(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"}):"Callback Function Required"},l.addGroupMember=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?void 0===e.userId||""===e.userId?void e.callback({status:"error",errorMessage:"UserId required"}):void 0!==e.role&&-1===G.indexOf(e.role)?void e.callback({status:"error",errorMessage:"Incorrect member role"}):(pt.loadUserProfile(e.userId),e.apzCallback=tt.onAddedGroupMember,Xe.addGroupMember(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"}):"Callback function required"},l.removeGroupMember=function(e){return"object"!=typeof e?"Unsupported Format. Please check format":"function"==typeof e.callback?void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId?void 0===e.userId||""===e.userId?void e.callback({status:"error",errorMessage:"UserId required"}):(e.apzCallback=tt.onRemovedGroupMember,Xe.removeGroupMemberFromChat(e),"success"):void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"}):"Callback function required"},l.updateGroupInfo=function(e){if("object"!=typeof e)return"Unsupported format. Please check format";if("function"==typeof e.callback){if(!(void 0!==e.groupId&&""!==e.groupId||void 0!==e.clientGroupId&&""!==e.clientGroupId))return void e.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});if(!(void 0!==e.name&&""!==e.name||void 0!==e.imageUrl&&""!==e.imageUrl||e.users&&0!==e.users.length))return void e.callback({status:"error",errorMessage:"Group properties required"});if(e.users&&e.users.length>0){var a=[];if(t.each(e.users,function(e,t){t.userId&&void 0!==t.role&&-1!==G.indexOf(t.role)&&a.push(t)}),0===a.length)return void e.callback({status:"error",errorMessage:"Incorrect users detail"})}var a=[];return t(".mck-group-change-role-box.vis").each(function(e,s){var o=t(this),n=parseInt(o.find("select").val()),i=o.parents(".mck-li-group-member").data("role");if(n!==i){var r={userId:o.parents(".mck-li-group-member").data("mck-id"),role:n};a.push(r)}}),e.apzCallback=tt.onUpdateGroupInfo,Xe.updateGroupInfo(e),"success"}return"Callback function required"},l.getMessages=function(e){"function"==typeof e.callback&&rt.getMessages(e)},l.getMessageList=function(e){return void 0!==e&&"function"==typeof e.callback?(rt.getMessageList(e,function(e){if(void 0!==e.to||void 0!==e.groupId){var t=st.getMessageFeed(e);messageFeeds.push(t)}}),"success"):"Callback function required"},l.getMessageListByTopicId=function(e){if("object"!=typeof e)return"Unsupported format. Please check format";if("function"==typeof e.callback){if(!(void 0!==e.id&&""!==e.id||void 0!==e.clientGroupId&&""!==e.clientGroupId))return void e.callback({status:"error",errorMessage:"Id or clientGroupId required"});if(e.id&&"boolean"!=typeof e.isGroup)return void e.callback({status:"error",errorMessage:"IsGroup parameter required"});if(!e.topicId)return void e.callback("TopicId required");e.id&&(e.tabId=e.id),e.topicStatus=De[0];var t=O[e.topicId];return t&&"object"==typeof M[t]?(e.conversationId=t,rt.getMessageList(e,function(e){if(void 0!==e.to||void 0!==e.groupId){var t=st.getMessageFeed(e);messageFeeds.push(t)}})):(e.isExtMessageList=!0,e.pageSize=1,rt.fetchConversationByTopicId(e,function(e){ot.getMessageList(e)})),"success"}return"Callback function required."},l.sendMessage=function(e){if("object"==typeof e){var a=(e=t.extend(!0,{},n,e)).message;if(!e.to)return"To field required";if(void 0===a||""===a)return"Message field required";if(e.type>12)return"Invalid message type";a=t.trim(a);var s={to:t.trim(e.to),type:e.messageType,contentType:e.type,message:a,metadata:e.metadata};return ot.sendMessage(s),"success"}return"Unsupported format. Please check format"},l.updateUserIdentity=function(e){nt.updateUserIdentity(e)},l.updateUser=function(e){nt.updateUser(e)},l.getGroupListByFilter=function(e){Xe.getGroupByFilter(e)},l.updateMessageMetadata=function(e){ot.updateMessageMetadata(e)},l.sendGroupMessage=function(e){if("object"==typeof e){var a=(e=t.extend(!0,{},n,e)).message;if(!e.groupId&&!e.clientGroupId)return"groupId or clientGroupId required";if(void 0===a||""===a)return"message field required";if(e.type>12)return"invalid message type";a=t.trim(a);var s={type:e.messageType,contentType:e.type,message:a,metadata:e.metadata||{}};if(e.groupId)s.groupId=t.trim(e.groupId);else if(e.clientGroupId){var o=et.getGroupByClientGroupId(e.clientGroupId);if(void 0===o)return"group not found";s.clientGroupId=t.trim(e.clientGroupId)}return ot.sendMessage(s),"success"}return"Unsupported format. Please check format"},l.addWelcomeMessage=function(e){return"object"!=typeof e?"Unsupported format. Please check format":void 0===e.sender||""===e.sender?"Sender Field Required":void 0===e.messageContent||""===e.messageContent?"Message Content Required":void ot.sendWelcomeMessage(e)},l.createGroup=function(e){if("object"==typeof e){if("function"==typeof e.callback){var t=e.users;return void 0===t||t.length<1?void e.callback({status:"error",errorMessage:"Users list required"}):t.length>Z?void e.callback({status:"error",errorMessage:"Users limit exceeds "+Z+". Max number of users allowed is "+Z+"."}):e.groupName?void 0===e.type||""===e.type?void e.callback({status:"error",errorMessage:"Group type required"}):-1===N.indexOf(e.type)?void e.callback({status:"error",errorMessage:"Invalid group type"}):(ot.getGroup(e),"success"):void e.callback({status:"error",errorMessage:"Group name required"})}return"Callback function required"}return"Unsupported Format. Please check format"},l.triggerMsgNotification=function(){0!=Be&&(MCK_TRIGGER_MSG_NOTIFICATION_PARAM=setTimeout(function(){Kommunicate.startConversation({isMessage:!1,isInternal:!0},function(e){})},Be))},l.initGroupTab=function(e){if("object"==typeof e){var t=e.users;return void 0===t||t.length<1?"Users List Required":t.length>Z?"Users limit exceeds "+Z+". Max number of users allowed is "+Z+".":e.groupName?void 0===e.type?"Group type required":-1===N.indexOf(e.type)?"Invalid group type":(ot.getGroup(e),"success"):"Group name required"}return"Unsupported format. Please check format"},l.getTotalUnreadCount=function(){return E},l.subscribeToEvents=function(e){"object"==typeof e&&("function"==typeof e.onConnectFailed&&(l.events.onConnectFailed=e.onConnectFailed),"function"==typeof e.onConnect&&(l.events.onConnect=e.onConnect),"function"==typeof e.onMessageDelivered&&(l.events.onMessageDelivered=e.onMessageDelivered),"function"==typeof e.onMessageRead&&(l.events.onMessageRead=e.onMessageRead),"function"==typeof e.onMessageDeleted&&(l.events.onMessageDeleted=e.onMessageDeleted),"function"==typeof e.onConversationDeleted&&(l.events.onConversationDeleted=e.onConversationDeleted),"function"==typeof e.onUserConnect&&(l.events.onUserConnect=e.onUserConnect),"function"==typeof e.onUserDisconnect&&(l.events.onUserDisconnect=e.onUserDisconnect),"function"==typeof e.onConversationReadFromOtherSource&&(l.events.onConversationReadFromOtherSource=e.onConversationReadFromOtherSource),"function"==typeof e.onConversationRead&&(l.events.onConversationRead=e.onConversationRead),"function"==typeof e.onMessageReceived&&(l.events.onMessageReceived=e.onMessageReceived),"function"==typeof e.onMessageSentUpdate&&(l.events.onMessageSentUpdate=e.onMessageSentUpdate),"function"==typeof e.onMessageSent&&(l.events.onMessageSent=e.onMessageSent),"function"==typeof e.onUserBlocked&&(l.events.onUserBlocked=e.onUserBlocked),"function"==typeof e.onUserUnblocked&&(l.events.onUserUnblocked=e.onUserUnblocked),"function"==typeof e.onUserActivated&&(l.events.onUserActivated=e.onUserActivated),"function"==typeof e.onMessageNotification&&(l.events.onMessageNotification=e.onMessageNotification),"function"==typeof e.onUserDeactivated&&(l.events.onUserDeactivated=e.onUserDeactivated))},l.getConversation=function(e){rt.getTopicId({conversationId:e.conversationId},function(e){st.populateMessage(e.messageType,e.message,e.notifyUser)})}}(i);l.data("applozic_instance",p),p.init()}else alert("Oops! looks like incorrect application id or user Id.")},t.fn.applozic.defaults=o}($applozic,window,document);var kmCustomTheme=new KmCustomTheme;function KmCustomTheme(){var e,t=this;t.init=function(a){(e=a.widgetSettings)&&t.changeColorTheme()},t.KmCustomImageIcon=function(e){return"<img src="+e+"></img>"},t.createCustomClasses=function(e){for(var t=0;t<e.length;t++){var a=document.createElement("style");a.type="text/css",a.innerHTML=e[t],document.getElementsByTagName("head")[0].appendChild(a)}},t.customSideboxWidget=function(){var a="#5553B7";if(e){var s=".km-custom-widget-background-color { background: "+(a=e&&e.primaryColor?e.primaryColor:"#5553B7")+" !important}",o=".km-custom-widget-border-color { border-color: "+a+" !important}",n=".km-custom-widget-text-color { color: "+a+" !important;}";t.createCustomClasses([s,o,n])}else{var i=".km-chat-widget-background-color { background: "+a+" !important}";t.createCustomClasses([i])}return'<div id="launcher-svg-container" class="km-chat-icon-sidebox km-custom-widget-background-color km-chat-widget-background-color">'+t.reutrnCutomWidget()+"</div>"},t.reutrnCutomWidget=function(){return null!==e?"image"===e.iconIndex?t.KmCustomImageIcon(e.widgetImageLink):KommunicateConstants.CUSTOM_WIDGETS_SVG[e.iconIndex]:KommunicateConstants.CUSTOM_WIDGETS_SVG[1]},t.changeColorTheme=function(){for(var t=document.getElementsByClassName("mck-box-top"),a=0;a<t.length;a++)t[a].style.backgroundColor=e.primaryColor}}function RingToneService(){this.loadRingTone=function(e,t){return new Howl({src:[e],loop:t.loop})}}Kommunicate.attachEvents=function(e){e("#mck-message-cell").on("click",".km-increment-guest-count",Kommunicate.richMsgEventHandler.incrementGuestCount),e("#mck-message-cell").on("click",".km-decrement-guest-count",Kommunicate.richMsgEventHandler.decrementGuestCount),e("#mck-message-cell").on("click",".km-btn-add-more-rooms",Kommunicate.richMsgEventHandler.addMoreRoom),e("#mck-message-cell").on("click",".km-done-button",Kommunicate.richMsgEventHandler.processSelectedRoom),e("#mck-message-cell").on("click",".km-card-message-footer-button",Kommunicate.richMsgEventHandler.processHotelBookClick),e("#mck-message-cell").on("click",".km-cta-button",Kommunicate.richMsgEventHandler.handlleRichButtonClick),e("#mck-message-cell").on("click",".km-submit-person-detail",Kommunicate.richMsgEventHandler.handlleSubmitPersonDetail),e("#mck-message-cell").on("click",".km-block-room-button",Kommunicate.richMsgEventHandler.processBookRoomClick),e("#mck-message-cell").on("click",".km-quick-replies",Kommunicate.richMsgEventHandler.processQuickReplies),e("#mck-message-cell").on("click",".km-list-item-handler",Kommunicate.richMsgEventHandler.processClickOnListItem),e("#mck-message-cell").on("click",".km-list-button-item-handler",Kommunicate.richMsgEventHandler.processClickOnButtonItem),e("#mck-message-cell").on("click",".km-faq-dialog-button",Kommunicate.richMsgEventHandler.processClickOnDialogButton),e("#mck-message-cell").on("click",".km-progress-meter-container",Kommunicate.attachmentEventHandler.manageUploadAttachment)},Kommunicate.attachmentEventHandler={manageUploadAttachment:function(e){var t=$applozic(e.target).closest(".km-msg-box-attachment").find(".km-progress-stop-upload-icon").hasClass("n-vis"),a=$applozic(e.target).closest(".km-msg-box-attachment").find(".km-progress-upload-icon").hasClass("n-vis"),s=$applozic(e.target).closest(".km-msg-box-attachment").children();let o=s[0].dataset.msgkey;var n=$applozic(e.target).closest(".mck-clear").find(".mck-msg-right-muted");if(Kommunicate.internetStatus)if(!t&&a)KommunicateUI.updateAttachmentStopUploadStatus(o,!0),Kommunicate.attachmentEventHandler.progressMeter(100,o),$applozic(".km-progress-stop-upload-icon-"+o).removeClass("vis").addClass("n-vis"),$applozic(".km-progress-upload-icon-"+o).removeClass("n-vis").addClass("vis"),Kommunicate.attachmentEventHandler.progressMeter(100,o),$applozic(".mck-timestamp-"+o).removeClass("n-vis").addClass("vis"),n[0].querySelector(".mck-sending-failed").style.display="block";else{KommunicateUI.updateAttachmentStopUploadStatus(o,!1);let t=s[0].dataset.filemetakey,a=s[0].dataset.filename,i=s[0].dataset.filesize,r=s[0].dataset.fileurl,c=s[0].dataset.filetype,l=s[0].dataset.groupid,d=s[0].dataset.thumbnailurl;if(i&&r&&t&&a&&c){messagePxy={contentType:1,groupId:l,fileMeta:{blobKey:t,url:r,contentType:c,size:i,key:t,thumbnailUrl:r,name:a},message:"",type:5,metadata:{},key:o};let s={messagePxy:messagePxy,optns:{tabId:l}};$applozic.fn.applozic("submitMessage",s),$applozic(e.target).closest(".km-msg-box-progressMeter").children().removeClass("km-progress-meter-back-drop"),$applozic(e.target).closest(".km-msg-box-progressMeter").addClass("n-vis"),$applozic(".mck-timestamp-"+o).removeClass("n-vis").addClass("vis"),n[0].querySelector(".mck-sending-failed").style.display="none"}else if(d&&l&&o){messagePxy={contentType:1,groupId:l,key:o,fileMeta:{thumbnailUrl:d,contentType:1,isUploaded:!1},message:"",type:5,metadata:{}};let t=KM_PENDING_ATTACHMENT_FILE[o];params={params:{file:t,name:t.name},messagePxy:messagePxy},$applozic.fn.applozic("uploadAttachemnt",params),$applozic(".mck-timestamp-"+o).removeClass("n-vis").addClass("vis"),n[0].querySelector(".mck-sending-failed").style.display="none",delete KM_PENDING_ATTACHMENT_FILE[o],$applozic(e.target).closest(".km-msg-box-progressMeter").children().removeClass("km-progress-meter-back-drop")}}else KommunicateUI.displayUploadIconForAttachment(o,!1),KommunicateUI.updateAttachmentStopUploadStatus(o,!0)},progressMeter:function(e,t){document.getElementById("km-progress-meter-input");let a=".progress-meter-"+t+" .km-progress-value";KommunicateUI.getAttachmentStopUploadStatus(t)&&(e=100);var s=document.querySelector(a);if(s){s.style.strokeDasharray=KM_PROGRESS_METER_CIRCUMFERENCE;var o=KM_PROGRESS_METER_CIRCUMFERENCE*(1-e/100);s.style.strokeDashoffset=o}}},Kommunicate.richMsgEventHandler={initializeSlick:function(e){if(e.length>0)tns({container:e[0],items:1,slideBy:"page",mouseDrag:!0,arrowKeys:!0,onInit:function(){console.log("tiny-slider initilized"),document.querySelector(".km-slick-container .tns-controls button:first-child").innerHTML="<",document.querySelector(".km-slick-container .tns-controls button:last-child").innerHTML=">"}})},decrementGuestCount:function(e){var t=e.target||e.srcElement,a=t.dataset.type;"guest"==a?t.parentElement.getElementsByClassName("km-room-number-field")[0].stepDown():"children"==a&&t.parentElement.getElementsByClassName("km-person-number-field")[0].stepDown()},incrementGuestCount:function(e){var t=e.target||e.srcElement,a=t.dataset.type;"guest"==a?t.parentElement.getElementsByClassName("km-room-number-field")[0].stepUp():"children"==a&&t.parentElement.getElementsByClassName("km-person-number-field")[0].stepUp()},decrementPersonCount:function(){document.getElementById("km-person-number-field").stepDown()},incrementPersonCount:function(){document.getElementById("km-person-number-field").stepUp()},addMoreRoom:function(e){var t=e.target.parentElement.parentElement.parentElement,a=Number(e.target.dataset.roomcount)+1;e.target.setAttribute("data-roomcount",a);var s=document.createElement("div");s.innerHTML=Kommunicate.markup.getSingleRoomPaxInfo(a),t.getElementsByClassName("km-room-person-selector-container")[0].appendChild(s)},processSelectedRoom:function(e){for(var t=[],a=$(e.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-room-number-field"),s=$(e.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-person-number-field"),o="",n=0;n<a.length;n++){let e=s[n].value,i=Array(1*e).fill(10);t.push({NoOfAdults:a[n].value,NoOfChild:e,ChildAge:i}),o+="Room "+(n+1)+" Guest "+a[n].value+"\n"}var i={message:o,metadata:{isRoomGuestJSON:!0,roomGuestJson:JSON.stringify(t),guestTypeId:"ADULTS"}};Kommunicate.sendMessage(i)},processHotelBookClick:function(e){var t=e.target||e.srcElement,a=t.dataset.sessionid,s=t.dataset.resultindex,o={message:"Get room detail of "+t.dataset.name.replace("_"," "),metadata:{hotelSelected:!0,sessionId:a,resultIndex:s,skipDialogflow:!0}};Kommunicate.sendMessage(o)},processBookRoomClick:function(e){var t=e.target||e.srcElement,a=t.dataset.sessionid,s=t.dataset.roomindex,o=t.dataset.noofrooms,n="undefined"==t.dataset.hotelname?"":t.dataset.hotelname,i=t.dataset.hotelresultindex,r={message:"Book "+n.replace("_"," "),metadata:{sessionId:a,RoomIndex:s,NoOfRooms:o,blockHotelRoom:!0,skipDialogflow:!0,HotelResultIndex:i}},c=$applozic("#mck-message-cell .mck-message-inner"),l=$applozic("#mck-msg-to");!0===c.data("isgroup")?r.groupId=l.val():r.to=l.val(),$applozic.fn.applozic("sendGroupMessage",r)},handlleRichButtonClick:function(e){var t=e.target||e.srcElement,a=t.dataset.requesttype,s=t.title||t.innerHTML,o=t.dataset.buttontype,n={},i=t.parentElement.getElementsByClassName("km-btn-hidden-form")[0];if("submit"==o){if("json"==a){for(var r=i.getElementsByTagName("input"),c=0;c<r.length;c++)n[r[c].name]=r[c].value;window.Applozic.ALApiService.ajax({url:i.action,async:!1,type:"post",data:JSON.stringify(n),contentType:"application/json",success:function(e){},error:function(e,t,a){console.log("error while sending data ",a)}})}else i.submit();if(s){var l={message:s};Kommunicate.sendMessage(l)}}},handlleSubmitPersonDetail:function(e){var t=$applozic(e.target).closest(".km-guest-details-container").find(".km-title-select option:selected").text(),a=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.km-age-input"),s=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.first-name-input"),o=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.middle-name-input"),n=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.last-name-input"),i=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.e-mail-input"),r=$applozic(e.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.number-input");if(""!=s[0].value&&""!=n[0].value&&""!=i[0].value&&""!=r[0].value){var c={Title:"title"===t?"":t,Age:a[0].value,FirstName:s[0].value,MiddleName:o[0].value,LastName:n[0].value,EmailId:i[0].value,PhoneNo:r[0].value},l=(e.target||e.srcElement).dataset.sessionid,d={message:c.Title+" "+c.FirstName+" "+c.LastName+"\n"+c.EmailId+"\n"+c.PhoneNo,metadata:{sessionId:l,guestDetail:!0,skipDialogflow:!0,personInfo:JSON.stringify(c)}};Kommunicate.sendMessage(d),console.log("passenger detail submitted")}else $applozic(e.target).closest(".km-guest-details-container").find(".km-mandatory-field-error").removeClass("n-vis").addClass("vis")},processQuickReplies:function(e){var t=e.target.title,a={};try{a=JSON.parse(e.target.dataset.metadata)}catch(e){}var s={message:t,metadata:a};Kommunicate.sendMessage(s)},processClickOnListItem:function(e){var t=e.currentTarget,a=t.dataset.reply,s=t.dataset.type,o=t.dataset.articleid,n=t.dataset.source;if(s&&"quick_reply"==s){var i={message:a,metadata:{KM_FAQ_ID:o,source:n}};Kommunicate.sendMessage(i)}},processClickOnButtonItem:function(e){var t=e.currentTarget,a=t.dataset.reply,s=t.dataset.type;if(s&&"quick_reply"==s){var o={message:a,metadata:{KM_BUTTON_CLICKED:!0}};Kommunicate.sendMessage(o)}},processClickOnDialogButton:function(e){var t=e.currentTarget,a=t.dataset.reply,s={};try{s=JSON.parse(t.dataset.metadata)}catch(e){}s.skipBot=void 0===s.skipBot||s.skipBot;var o={message:a,metadata:s};Kommunicate.sendMessage(o)}},KommunicateUI={awayMessageInfo:{},awayMessageScroll:!0,leadCollectionEnabledOnAwayMessage:!1,welcomeMessageEnabled:!1,leadCollectionEnabledOnWelcomeMessage:!1,anonymousUser:!1,CONSTS:{},updateLeadCollectionStatus:function(e,t,a){KommunicateUI.awayMessageInfo={},e||"SUCCESS"!=t.code&&"AGENTS_ONLINE"!=t.code||(KommunicateUI.leadCollectionEnabledOnAwayMessage=t.data.collectEmailOnAwayMessage,"AGENTS_ONLINE"!=t.code&&t.data.messageList.length>0&&(KommunicateUI.awayMessageInfo.eventId=t.data.messageList[0].eventId,KommunicateUI.awayMessageInfo.isEnabled=!0),KommunicateUI.leadCollectionEnabledOnWelcomeMessage=t.data.collectEmailOnWelcomeMessage,KommunicateUI.welcomeMessageEnabled=t.data.welcomeMessageEnabled,KommunicateUI.anonymousUser=t.data.anonymousUser,KommunicateUI.displayLeadCollectionTemplate(a))},populateAwayMessage:function(e,t){var a=$applozic("#mck-tab-individual").hasClass("n-vis"),s=$applozic("#mck-conversation-status-box").hasClass("vis");!e&&"SUCCESS"==t.code&&t.data.messageList.length>0&&!a&&!s?(awayMessage=t.data.messageList[0].message,$applozic("#mck-away-msg").html(awayMessage),$applozic("#mck-away-msg-box").removeClass("n-vis").addClass("vis")):$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis");var o=document.querySelectorAll(".mck-message-inner.mck-group-inner")[0];KommunicateUI.awayMessageScroll&&o&&(o.scrollTop=o.scrollHeight,KommunicateUI.awayMessageScroll=!1)},showAwayMessage:function(){var e=$applozic("#mck-tab-individual").hasClass("n-vis");KommunicateUI.awayMessageInfo&&KommunicateUI.awayMessageInfo.isEnabled&&!e&&($applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-away-msg-box").removeClass("n-vis").addClass("vis"))},hideAwayMessage:function(){$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis")},displayLeadCollectionTemplate:function(e){if(e&&e.length){let a=0;for(var t=0;t<e.length&&(5!=e[t].type||2!=++a);t++);1==a?(KommunicateUI.leadCollectionEnabledOnAwayMessage&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId||KommunicateUI.welcomeMessageEnabled&&KommunicateUI.leadCollectionEnabledOnWelcomeMessage&&KommunicateUI.anonymousUser)&&(this.populateLeadCollectionTemplate(),this.hideAwayMessage()):this.hideLeadCollectionTemplate()}else null==e&&(this.populateLeadCollectionTemplate(),this.hideAwayMessage())},displayProgressMeter:function(e,t){$applozic(".progress-meter-"+e).removeClass("n-vis").addClass("vis"),$applozic(".mck-attachment-"+e).next().removeClass("n-vis").addClass("vis"),$applozic(".mck-attachment-"+e+" .mck-image-download").addClass("n-vis")},deleteProgressMeter:function(e,t){$applozic(".progress-meter-"+e).remove(),t&&$applozic(".mck-attachment-"+e).next().removeClass("vis").addClass("n-vis")},displayUploadIconForAttachment:function(e,t){$applozic(".progress-meter-"+e+" .km-progress-upload-icon").removeClass("n-vis").addClass("vis"),$applozic(".progress-meter-"+e+" .km-progress-stop-upload-icon").removeClass("vis").addClass("n-vis"),Kommunicate.attachmentEventHandler.progressMeter(100,e),!t&&$applozic(".mck-attachment-"+e).next().removeClass("n-vis").addClass("vis")},updateImageAttachmentPreview:function(e,t){let a=$applozic(".mck-attachment-"+t)[0].dataset.thumbnailurl;$applozic(".mck-attachment-"+t+" .file-preview-link").attr("data-url",a),$applozic("."+t+" .mck-file-text a:first").trigger("click")},hideFileBox:function(e,t,a){-1!=e.type.indexOf("image/")?(t.removeClass("vis").addClass("n-vis"),a.attr("disabled",!1)):t.removeClass("n-vis").addClass("vis")},updateAttachmentTemplate:function(e,t){let a=document.querySelector(".mck-message-inner.mck-group-inner").querySelector(".mck-attachment-"+t);a.setAttribute("data-filemetakey",e.blobKey),a.setAttribute("data-filename",e.name),a.setAttribute("data-fileurl",e.thumbnailUrl||e.fileMeta.thumbnailUrl),a.setAttribute("data-filesize",e.size),a.setAttribute("data-filetype",e.contentType||e.fileMeta.contentType)},updateAttachmentStopUploadStatus:function(e,t){document.querySelector(".mck-message-inner.mck-group-inner").querySelector(".mck-attachment-"+e).setAttribute("data-stopupload",t)},getAttachmentStopUploadStatus:function(e){var t=$applozic(".mck-attachment-"+e).attr("data-stopupload");return t="true"==t},populateLeadCollectionTemplate:function(){KommunicateUI.hideAwayMessage(),$applozic("#mck-email-collection-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-btn-attach-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-text-box").blur(),$applozic("#mck-text-box").attr("data-text","Your email ID")},hideLeadCollectionTemplate:function(){$applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-email-error-alert-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-btn-attach-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-text-box").attr("data-text",MCK_LABELS["input.message"])},validateEmail:function(e){return e.match(/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/)?($applozic("#mck-email-error-alert-box").removeClass("vis").addClass("n-vis"),this.hideLeadCollectionTemplate(),window.$applozic.fn.applozic("updateUser",{data:{email:e}}),!0):($applozic("#mck-email-error-alert-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis"),!1)},faqEvents:function(e,t){var a;$applozic(d).on("click","#mck-msg-preview, #mck-msg-preview-visual-indicator .mck-msg-preview-visual-indicator-text",function(){KommunicateUI.showChat()}),$applozic(d).on("click",".km-faq-list",function(){$applozic("#km-faqanswer").empty(),"km-faq-answer-list"!==MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-1]&&MCK_EVENT_HISTORY.push("km-faq-answer-list");var a=$(this).attr("data-articleid"),s=$(this).attr("data-source");KommunicateKB.getArticle({data:{appId:e.appId,articleId:a,source:s,helpdocsAccessKey:t},success:function(e){0==$applozic("#km-faqanswer .km-faqanswer-list").length&&($applozic("#km-faqanswer").append('<div class="km-faqanswer-list km-faqanswerscroll"><div class="km-faqquestion">'+e.data.title+'</div> <div class="km-faqanchor km-faqanswer">'+e.data.body+"</div></div>"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-individual").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-conversation").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer .km-faqanswer").linkify({target:"_blank"}))},error:function(){}}),$applozic(".km-contact-input-container").removeClass("vis").addClass("n-vis")}),$applozic(d).on("click","#km-faq",function(){KommunicateUI.showHeader(),KommunicateUI.awayMessageScroll=!0,"km-faq-list"!==MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-1]&&MCK_EVENT_HISTORY.push("km-faq-list"),$applozic("#km-contact-search-input-box").removeClass("n-vis").addClass("vis"),$applozic("#km-faq").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"),$applozic(".faq-common").removeClass("n-vis").addClass("vis"),$applozic(".mck-conversation ").removeClass("vis").addClass("n-vis"),$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis"),$applozic(".mck-conversation-back-btn").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-title").html("FAQ").removeClass("n-vis").addClass("vis"),$applozic("#mck-away-msg-box").addClass("n-vis").removeClass("vis"),$applozic("#mck-sidebox-ft").addClass("n-vis").removeClass("vis"),$applozic("#mck-contacts-content").addClass("n-vis").removeClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),$applozic(".km-contact-input-container").removeClass("n-vis").addClass("vis"),$applozic(".mck-agent-image-container").removeClass("vis").addClass("n-vis"),$applozic(".mck-agent-status-text").removeClass("vis").addClass("n-vis"),$applozic("#mck-tab-individual .mck-tab-link.mck-back-btn-container").removeClass("n-vis").addClass("vis-table"),$applozic("#mck-tab-individual .mck-name-status-container.mck-box-title").removeClass("padding")}),$applozic(d).on("click","#km-faqanswer a",function(e){e.preventDefault(),window.open(e.target.href)}),$applozic("#km-faq-search-input").keydown(function(s){clearTimeout(a),a=setTimeout(function(){KommunicateKB.getArticles({data:{appId:e.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:t},success:function(e){e.data&&0===e.data.length&&$applozic(".km-no-results-found-container").hasClass("n-vis")?($applozic(".km-no-results-found-container").addClass("vis").removeClass("n-vis"),$applozic(".km-talk-to-human-div p").text("We are here to help."),$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis")):($applozic(".km-no-results-found-container").addClass("n-vis").removeClass("vis"),$applozic(".km-talk-to-human-div p").text("Looking for something else? "),$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis")),$applozic("#km-faqdiv").empty(),$applozic.each(e.data,function(e,t){$applozic("#km-faqdiv").append('<li class="km-faq-list" data-source="'+t.source+'" data-articleId="'+t.articleId+'"><a class="km-faqdisplay"> <div><div class="km-faqimage"></div></div> <div class="km-faqanchor">'+t.title+"</div></a></li>")})},error:function(){}})},2e3),32!=s.which&&13!=s.which||KommunicateKB.getArticles({data:{appId:e.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:t},success:function(e){e.data&&0===e.data.length&&$applozic(".km-no-results-found-container").hasClass("n-vis")?($applozic(".km-no-results-found-container").addClass("vis").removeClass("n-vis"),$applozic(".km-talk-to-human-div p").text("We are here to help. "),$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis")):($applozic(".km-no-results-found-container").addClass("n-vis").removeClass("vis"),$applozic(".km-talk-to-human-div p").text("Looking for something else? "),$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis")),$applozic("#km-faqdiv").empty(),$applozic.each(e.data,function(e,t){$applozic("#km-faqdiv").append('<li class="km-faq-list" data-source="'+t.source+'" data-articleId="'+t.articleId+'"><a class="km-faqdisplay"> <div><span class="km-faqimage"/ ></span> <div class="km-faqanchor ">'+t.title+"</div></a></li>")})},error:function(){}})}),$applozic(d).on("click","#mck-conversation-back-btn",function(){if($applozic(".km-contact-input-container").removeClass("vis").addClass("n-vis"),KommunicateUI.awayMessageScroll=!0,KommunicateUI.hideAwayMessage(),KommunicateUI.hideLeadCollectionTemplate(),MCK_EVENT_HISTORY.length>=2){if("km-faq-list"==MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-2])return KommunicateUI.showHeader(),$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic("#km-contact-search-input-box").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),$applozic(".km-contact-input-container").removeClass("n-vis").addClass("vis"),void MCK_EVENT_HISTORY.splice(MCK_EVENT_HISTORY.length-1,1);if("object"==typeof MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-2]){$applozic(".mck-conversation ").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-conversation").removeClass("n-vis").addClass("vis"),$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic(".mck-agent-image-container").removeClass("n-vis").addClass("vis"),$applozic(".mck-agent-status-text").removeClass("n-vis").addClass("vis");let e=MCK_EVENT_HISTORY[MCK_EVENT_HISTORY.length-2];return $applozic.fn.applozic("openChat",e),MCK_EVENT_HISTORY.splice(MCK_EVENT_HISTORY.length-1,1),void KommunicateUI.activateTypingField()}return $applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),MCK_EVENT_HISTORY.splice(MCK_EVENT_HISTORY.length-1,1),void(MCK_EVENT_HISTORY.length=0)}return $applozic(".mck-conversation ").removeClass("n-vis").addClass("vis"),$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),void(MCK_EVENT_HISTORY.length=0)})},hideFaq:function(){$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic(".km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic("#mck-msg-new").attr("disabled",!1)},hideMessagePreview:function(){$applozic("#mck-msg-preview-visual-indicator").removeClass("vis").addClass("n-vis"),$applozic("#mck-msg-preview-visual-indicator .mck-msg-preview-visual-indicator-text").html("")},showChat:function(){$applozic(".faq-common").removeClass("vis").addClass("n-vis"),$applozic(".mck-conversation").removeClass("n-vis").addClass("vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic("#mck-msg-new").attr("disabled",!1),0===$applozic("#mck-message-cell .mck-message-inner div[name='message']").length&&1==isFirstLaunch?($applozic("#mck-tab-individual .mck-tab-link.mck-back-btn-container").addClass("n-vis"),$applozic("#mck-tab-individual .mck-name-status-container.mck-box-title").addClass("padding"),isFirstLaunch=!1):($applozic("#mck-tab-individual .mck-tab-link.mck-back-btn-container").removeClass("n-vis"),$applozic("#mck-tab-individual .mck-name-status-container.mck-box-title").removeClass("padding"))},showHeader:function(){$applozic("#mck-tab-individual").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-conversation").removeClass("vis").addClass("n-vis"),$applozic("#mck-msg-new").attr("disabled",!1)},sendFaqQueryAsMsg:function(e){var t=$applozic("#km-faq-search-input").val();if(""!==t){var a={groupId:e,type:5,contentType:0,message:'Hi, I have a query regarding \n"'+t+'"\n\n Can you help me out?'};$applozic.fn.applozic("sendGroupMessage",a)}},activateTypingField:function(){$applozic("#mck-text-box").focus()},showClosedConversationBanner:function(){var e=MCK_LABELS["closed.conversation.message"],t=document.getElementById("mck-sidebox-ft"),a=document.getElementById("mck-conversation-status-box");a.innerHTML=e,t.classList.add("mck-closed-conv-banner"),a.classList.add("vis"),a.classList.remove("n-vis")},hideClosedConversationBanner:function(){var e=document.getElementById("mck-sidebox-ft"),t=document.getElementById("mck-conversation-status-box");(e.classList.contains("mck-closed-conv-banner")||t.classList.contains("vis"))&&(e.classList.remove("mck-closed-conv-banner"),t.classList.remove("vis"),t.classList.add("n-vis"))}},Kommunicate.ApplozicEvents={onMessageNotification:function(e){Kommunicate.KmEventHandler.notificationEvent(e)},onMessageReceived:function(e){var t=e&&e.message,a=t.metadata&&"HIDDEN"!=t.metadata.category&&"true"!=t.metadata.hide;t.metadata&&!a||KommunicateUI.hideAwayMessage()},onMessageSent:function(e){KommunicateUI.hideClosedConversationBanner()}},Kommunicate.KmEventHandler={openChatOnNotification:function(e){"block"!==document.getElementById("mck-sidebox").style.display&&(e&&e.groupId?(document.getElementById("launcher-agent-img-container").classList.remove("vis"),document.getElementById("launcher-agent-img-container").classList.add("n-vis"),document.getElementById("launcher-svg-container").classList.remove("n-vis"),document.getElementById("launcher-svg-container").classList.add("vis"),window.Kommunicate.openConversation(e.groupId)):window.Kommunicate.openDirectConversation(e.to),KommunicateUI.hideMessagePreview())},notificationEvent:function(e){KommunicateUtils.getDataFromKmSession("appOptions").openConversationOnNewMessage?Kommunicate.KmEventHandler.openChatOnNotification(e):document.getElementById("launcher-agent-img-container").classList.contains("vis")&&(document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.add("n-vis"),document.querySelector("#mck-sidebox-launcher #launcher-svg-container").classList.remove("vis"))}},Kommunicate.postPluginInitialization=function(e,t){Kommunicate.initilizeEventListners(),$applozic.fn.applozic("subscribeToEvents",Kommunicate.ApplozicEvents),KommunicateKB.init(Kommunicate.getBaseUrl());var a=KommunicateUtils.getDataFromKmSession("HELPDOCS_KEY");null==a||""==a?Kommunicate.client.getThirdPartySettings({appId:t.appId,type:1},function(e,s){if(e)console.log("err : ",e);else if(s&&"SUCCESS"==s.code){var o=s.message.find(function(e){return e.type==KommunicateConstants.THIRD_PARTY_APPLICATION.HELPDOCS});o?(a=o.accessKey,KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY",o.accessKey)):KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY","null"),Kommunicate.helpdocsInitialization(t,a)}}):Kommunicate.helpdocsInitialization(t,a)},Kommunicate.helpdocsInitialization=function(e,t){"null"==t&&(t=null),KommunicateKB.getArticles({data:{appId:e.appId,query:"",helpdocsAccessKey:t},success:function(a){a.data&&a.data.length>0&&$applozic(".km-kb-container").hasClass("n-vis")&&$applozic(".km-kb-container").removeClass("n-vis").addClass("vis"),$applozic.each(a.data,function(e,t){$applozic("#km-faqdiv").append('<li class="km-faq-list" data-source="'+t.source+'" data-articleId="'+t.articleId+'"><a class="km-faqdisplay"> <div><div class="km-faqimage"></div></div> <div class="km-faqanchor">'+t.title+"</div></a></li>")}),KommunicateUI.faqEvents(e,t)},error:function(){}})};