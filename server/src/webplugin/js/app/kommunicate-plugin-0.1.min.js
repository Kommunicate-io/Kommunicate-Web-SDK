var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,c,e){a instanceof String&&(a=String(a));for(var n=a.length,v=0;v<n;v++){var y=a[v];if(c.call(e,y,v,a))return{i:v,v:y}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,e){a!=Array.prototype&&a!=Object.prototype&&(a[c]=e.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,c,e,n){if(c){e=$jscomp.global;a=a.split(".");for(n=0;n<a.length-1;n++){var v=a[n];v in e||(e[v]={});e=e[v]}a=a[a.length-1];n=e[a];c=c(n);c!=n&&null!=c&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:c})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,e){return $jscomp.findInternal(this,a,e).v}},"es6","es3");$jscomp.checkStringArgs=function(a,c,e){if(null==a)throw new TypeError("The 'this' value for String.prototype."+e+" must not be null or undefined");if(c instanceof RegExp)throw new TypeError("First argument to String.prototype."+e+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,e){var c=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var v=c.length,y=a.length;e=Math.max(0,Math.min(e|0,c.length));for(var f=0;f<y&&e<v;)if(c[e++]!=a[f++])return!1;return f>=y}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,e,n){var c=this.length||0;0>e&&(e=Math.max(0,c+e));if(null==n||n>c)n=c;n=Number(n);0>n&&(n=Math.max(0,c+n));for(e=Number(e||0);e<n;e++)this[e]=a;return this}},"es6","es3");
(function(a){function c(){return{ajax:function(a){var c=function(){for(var a=1;a<arguments.length;a++)for(var c in arguments[a])arguments[a].hasOwnProperty(c)&&(arguments[0][c]=arguments[a][c]);return arguments[0]}({},{},a),e=new XMLHttpRequest,y,f=!0;if("undefined"!==typeof c.async||a.async)f=c.async;a=c.type.toUpperCase();"GET"===a&&"undefined"!==typeof c.data&&(c.url=c.url+"?"+c.data);e.open(a,c.url,f);if("POST"===a||"GET"===a)f="undefined"===typeof c.contentType?"application/x-www-form-urlencoded; charset\x3dUTF-8":
c.contentType,e.setRequestHeader("Content-Type",f);"undefined"===typeof c.data?e.send():e.send(c.data);e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE)if(200===e.status){var a=e.getResponseHeader("Content-Type");if("undefined"===typeof a||"null"===a||null===a)a="";y=-1!=a.toLowerCase().indexOf("text/html")?e.responseXML:-1!=a.toLowerCase().indexOf("application/json")?JSON.parse(e.responseText):e.responseText;c.success(y)}else c.error(y)}}}}"undefined"===typeof KMCommonUtils?
a.KMCommonUtils=c():console.log("KMCommonUtils already defined.")})(window);
(function(a){function c(){return{getArticles:function(a){var c="https://api.helpdocs.io/v1/article?key\x3d"+a.data.helpdocsAccessKey;a.data.query&&(c="https://api.helpdocs.io/v1/search?key\x3d"+a.data.helpdocsAccessKey+"\x26query\x3d"+a.data.query);var e={};KMCommonUtils.ajax({url:c,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(c){e.status="success";e.data=c;a.success&&a.success(e)},error:function(c,f,g){e.status="error";a.error&&a.error(e)}})},getArticle:function(a){var c=
{};KMCommonUtils.ajax({url:"https://api.helpdocs.io/v1/article/"+a.data.articleId+"?key\x3d"+a.data.helpdocsAccessKey,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(e){c.status="success";c.data=e;a.success&&a.success(c)},error:function(e,n,f){c.status="error";a.error&&a.error(c)}})}}}"undefined"===typeof Helpdocs?a.Helpdocs=c():console.log("Helpdocs already defined.")})(window);
(function(a){function c(){var a={},c="https://api.kommunicate.io";a.init=function(a){c=a};a.getArticles=function(c){try{var e=[];a.getFaqs({data:c.data,success:function(a){for(var f=0;f<a.data.length;f++){var n=a.data[f];e.push({articleId:n.id,title:n.name,description:n.content,status:n.status,body:n.content,source:"KOMMUNICATE"})}c.data.helpdocsAccessKey?Helpdocs.getArticles({data:c.data,success:function(a){a=a.data;for(var f=0;f<a.articles.length;f++){var g=a.articles[f];e.push({articleId:g.article_id,
title:g.title,description:g.description,body:g.description,url:g.url,source:"HELPDOCS"})}c.success&&(a={status:"success"},a.data=e,c.success(a))},error:function(a){c.error(a)}}):c.success&&(a={status:"success"},a.data=e,c.success(a))},error:function(a){"function"===typeof c.error&&c.err(a)}})}catch(f){c.error(f)}};a.getArticle=function(c){"HELPDOCS"==c.data.source?Helpdocs.getArticle({data:c.data,success:function(a){a=a.data.article;a={articleId:a.article_id,title:a.title,description:a.description,
body:a.body,url:a.url,source:"HELPDOCS"};if(c.success){var e={status:"success"};e.data=a;c.success(e)}},error:function(a){c.error(a)}}):a.getFaq({data:c.data,success:function(a){a=a.data.data[0];a={articleId:a.id,title:a.name,description:a.content,body:a.content,status:a.status,source:"KOMMUNICATE"};if(c.success){var e={status:"success"};e.data=a;c.success(e)}},error:function(a){c.error(a)}})};a.getFaqs=function(a){var e=c+"/kb/search?appId\x3d:appId".replace(":appId",a.data.appId);a.data.query&&
(e=e+"\x26query\x3d"+a.data.query);var f={};KMCommonUtils.ajax({url:e,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(c){f.status="success";f.data=c.data;a.success&&a.success(f)},error:function(c,e,n){f.status="error";a.error&&a.error(f)}})};a.getFaq=function(a){var e={},f=c+"/kb/search?appId\x3d:appId".replace(":appId",a.data.appId);a.data&&a.data.articleId&&(f+="\x26articleId\x3d"+a.data.articleId);KMCommonUtils.ajax({url:f,async:"undefined"!==typeof a.async?a.async:!0,
type:"get",success:function(c){e.status="success";e.data=c;a.success&&a.success(e)},error:function(c,f,n){e.status="error";a.error&&a.error(e)}})};return a}"undefined"===typeof KommunicateKB?a.KommunicateKB=c():console.log("KommunicateKB already defined.")})(window);var mckGroupService=new MckGroupService;
Kommunicate.client={getGroupDetailByType:function(a,c){$applozic.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:"type\x3d"+a.type+"\x26startIndex\x3d"+a.startIndex+"\x26limit\x3d"+a.limit,contentType:"application/json",success:function(a){c(null,a)},error:function(a){c(a)}})},createConversation:function(a,c){$applozic.fn.applozic("createGroup",{groupName:a.groupName,type:a.type,admin:a.agentId,users:a.users,clientGroupId:a.clientGroupId,metadata:{CREATE_GROUP_MESSAGE:"",REMOVE_MEMBER_MESSAGE:"",
ADD_MEMBER_MESSAGE:"",JOIN_MEMBER_MESSAGE:"",GROUP_NAME_CHANGE_MESSAGE:"",GROUP_ICON_CHANGE_MESSAGE:"",GROUP_LEFT_MESSAGE:"",DELETED_GROUP_MESSAGE:"",GROUP_USER_ROLE_UPDATED_MESSAGE:"",GROUP_META_DATA_UPDATED_MESSAGE:"",CONVERSATION_ASSIGNEE:a.agentId,KM_CONVERSATION_TITLE:a.groupName,HIDE:"true"},callback:function(e){console.log("response",e);"success"===e.status&&e.data.clientGroupId&&Kommunicate.createNewConversation({groupId:e.data.value,participentUserId:kommunicate._globals.userId,defaultAgentId:a.agentId,
applicationId:kommunicate._globals.appId},function(a,v){console.log(a,v);a||c(e.data.value)})}})},getThirdPartySettings:function(a,c){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/integration/settings/"+a.appId+"?type\x3d"+a.type,type:"get",contentType:"application/json",success:function(a){c(null,a)},error:function(a){c(a)}})}};
$applozic.extend(!0,Kommunicate,{getBaseUrl:function(){switch(MCK_BASE_URL){case "https://apps-test.applozic.com/":case "https://apps-test.applozic.com":return"https://api-test.kommunicate.io";default:return"https://api.kommunicate.io"}},setDefaultAgent:function(a){throw Error("not implemented");},getConversationOfParticipent:function(a,c){if("function"!==typeof c)throw Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");$applozic.ajax({url:Kommunicate.getBaseUrl()+
"/conversations/participent/"+a.userId,type:"get",success:function(a){c(null,a)},error:function(a){c(a)}})},startConversation:function(a,c){var e=[{userId:a.agentId,groupRole:1},{userId:"bot",groupRole:2}];if(a.botIds)for(var n=0;n<a.botIds.length;n++)e.push({userId:a.botIds[n],groupRole:2});Kommunicate.client.createConversation({groupName:a.groupName||kommunicate._globals.conversationTitle||kommunicate._globals.groupName||kommunicate._globals.agentId,type:10,agentId:a.agentId,users:e,clientGroupId:a.clientGroupId},
c)},openConversationList:function(){window.$applozic.fn.applozic("loadTab","")},openConversation:function(a){window.$applozic.fn.applozic("loadGroupTab",a)},openDirectConversation:function(a){window.$applozic.fn.applozic("loadTab",a)},loadConversation:function(a,c){var e=(a.agentIds||[]).sort(function(a,c){return a.toLowerCase()<c.toLowerCase()?-1:a.toLowerCase()>c.toLowerCase()?1:0});console.log("agent list ",e);var n=a.botIds||[];if(1>e.length)return a={code:"INVALID_PARAMETERS",message:"required parameter agentIds is missing."},
"function"==typeof c?c(a):console.log("required parameter agentIds is missing.");a=kommunicate._globals.userId||KommunicateUtils.getCookie("kommunicate-id");var v=e.join("_"),y=n.join("_"),f=encodeURIComponent(y?[v,a,y].join("_"):[v,a].join("_"));if(256<f.length)return a={code:"MEMBER_LIMIT_EXCEEDS",message:"try adding fewer members"},"function"==typeof c?c(a):console.log("member limit exceeds. try adding fewer members");mckGroupService.getGroupFeed({clientGroupId:f,apzCallback:function(a){if("error"==
a.status&&"AL-G-01"==a.code)a=e.map(function(a){return{userId:a,groupRole:1}}),a.push({userId:"bot",groupRole:2}),a.push(n.map(function(a){return{userId:a,groupRole:2}})),a={groupName:kommunicate._globals.conversationTitle||kommunicate._globals.groupName||kommunicate._globals.agentId,type:10,agentId:a[0].userId,users:a,clientGroupId:decodeURIComponent(f)},Kommunicate.client.createConversation(a,function(a){if(c)return c(null,a)});else if("success"==a.status)return $applozic.fn.applozic("loadGroupTab",
a.data.id),c(null,a)}})},createGroupName:function(a){return a.sort().join().replace(/,/g,"_").substring(0,250)},openLastConversation:function(a){var c=[],e=[];e.push(a.agentId);e.push(kommunicate._globals.userId);c.push({userId:a.agentId,groupRole:1});c.push({userId:"bot",groupRole:2});if(a.botIds){console.log(a.botIds);for(var n=0;n<a.botIds.length;n++)c.push({userId:a.botIds[n],groupRole:2}),e.push(a.botIds[n])}c=Kommunicate.createGroupName(e);e={};e.groupName=c;e.callback=function(c){0<c.data.groups.length?
(console.log("already have a group"),Kommunicate.openConversation(c.data.groups[0].id)):(console.log("new user"),Kommunicate.startConversation(a,function(a){}))};window.$applozic.fn.applozic("getGroupListByFilter",e)},createNewConversation:function(a,c){if("function"!==typeof c)throw Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");a={groupId:a.groupId,participentUserId:a.participentUserId,createdBy:a.participentUserId,defaultAgentId:a.defaultAgentId,applicationId:a.applicationId};
$applozic.ajax({url:Kommunicate.getBaseUrl()+"/conversations",type:"post",data:JSON.stringify(a),contentType:"application/json",success:function(a){console.log("conversation started successfully");c(null,a)},error:function(a){console.log("err while starting Conversation");c(a)}})},logout:function(a,c){"undefined"!==typeof window.$kmApplozic&&"undefined"!==typeof window.$kmApplozic.fn&&"undefined"!==typeof window.$kmApplozic.fn.applozic&&window.$kmApplozic.fn.applozic("getLoggedInUser")&&window.$kmApplozic.fn.applozic("logout");
"undefined"!==typeof window.$applozic&&"undefined"!==typeof window.$applozic.fn&&"undefined"!==typeof window.$applozic.fn.applozic&&window.$applozic.fn.applozic("getLoggedInUser")&&window.$applozic.fn.applozic("logout");sessionStorage.clear();localStorage.clear()},triggerEvent:function(a,c){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/events?type\x3d"+a,type:"post",data:JSON.stringify({conversationId:c.groupId,applicationId:c.applicationId}),contentType:"application/json",success:function(a){console.log("conversation triggering event")},
error:function(a){console.log("err while starting Conversation")}})},updateUser:function(a){window.$applozic.fn.applozic("updateUser",{data:a})},getAwayMessage:function(a,c){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/"+a.applicationId+"/awaymessage?conversationId\x3d"+a.conversationId,type:"get",contentType:"application/json",success:function(a){console.debug("got away message data");"function"==typeof c?c(null,a):""},error:function(a){console.log("err while fetching away message");
"function"==typeof c?c(a):""}})},updateUserIdentity:function(a){window.$applozic.fn.applozic("updateUserIdentity",{newUserId:a,callback:function(c){KommunicateUtils.setCookie("kommunicate-id",a);"success"==c&&window.$applozic.fn.applozic("reInitialize",{userId:a})}})},isRichTextMessage:function(a){return a&&300==a.contentType},getConatainerTypeForRichMessage:function(a){if(a)switch(a.templateId){case "2":case "4":return"km-slick-container";default:return"km-fixed-container"}},processPaymentRequest:function(a){},
sendMessage:function(a){var c=$applozic("#mck-message-cell .mck-message-inner"),e=$applozic("#mck-msg-to");!0===c.data("isgroup")?a.groupId=e.val():a.to=e.val();$applozic.fn.applozic("sendGroupMessage",a)},getRichTextMessageTemplate:function(a){if(a)switch(a.templateId){case "1":return Kommunicate.markup.getHotelRoomPaxInfoTemplate();case "2":return Kommunicate.markup.getHotelCardContainerTemplate(JSON.parse(a.hotelList||"[]"),a.sessionId);case "3":return Kommunicate.markup.buttonContainerTemplate(a);
case "5":return Kommunicate.markup.getPassangerDetail(a);case "4":return Kommunicate.markup.getRoomDetailsContainerTemplate(JSON.parse(a.hotelRoomDetail||"[]"),a.sessionId);case "6":return Kommunicate.markup.quickRepliesContainerTemplate(a);case "7":return Kommunicate.markup.getListContainerMarkup(a);case "8":return Kommunicate.markup.getDialogboxContainer(a);default:return""}else return""}});
Kommunicate.markup={getSingleRoomPaxInfo:function(a){return'\x3cdiv class \x3d "km-single-pax-info"\x3e\n    \x3cdiv class\x3d"km-room-title-text"\x3eROOM '+(a||"1")+'\x3c/div\x3e\n    \x3cdiv class\x3d"km-room-selector"\x3e\n        \x3cdiv\x3eGuest :\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/div\x3e\n        \x3cdiv id\x3d ""\x3e\n            \x3cinput class \x3d"km-decrement-guest-count" type\x3d"button" value\x3d"-" data-type\x3d"guest"\x3e\n            \x3cinput type\x3d"number" min\x3d"1" max\x3d"5" value\x3d"1" class\x3d"km-room-number-field" maxlength\x3d"1" disabled\x3e\n            \x3cinput class \x3d"km-increment-guest-count" type\x3d"button" value\x3d"+" data-type\x3d"guest"\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"km-person-selector n-vis"\x3e\n        \x3cdiv class\x3d"km-children-text-lable"\x3eChildren :\x3cspan\x3e(1-12 yrs)\x3c/span\x3e\x3c/div\x3e\n        \x3cdiv\x3e\n            \x3cinput class \x3d"km-decrement-guest-count" type\x3d"button" value\x3d"-" data-type\x3d"children"\x3e\n            \x3cinput type\x3d"number" min\x3d"0" max\x3d"2" value\x3d"0" class\x3d"km-person-number-field" maxlength\x3d"1" disabled \x3e\n            \x3cinput class \x3d"km-increment-guest-count" type\x3d"button" value\x3d"+" data-type\x3d"children"\x3e\n        \x3c/div\x3e \n    \x3c/div\x3e\n\x3c/div\x3e'},
getHotelCardTemplate:function(a,c){var e={star1:"km-star-empty",star2:"km-star-empty",star3:"km-star-empty",star4:"km-star-empty",star5:"km-star-empty"};if(a.StarRating)for(var n=0;n<a.StarRating;n++)e["star"+(n+1)]="km-star-filled";return'\n    \x3cdiv class\x3d"km-single-card-message"\x3e\n        \x3cdiv class\x3d"km-card-message-header"\x3e\n            \x3cdiv class\x3d"km-card-message-image-continer"\x3e\x3cimg class \x3d"km-card-message-img" src \x3d'+a.HotelPicture+' /\x3e\n                    \x3cdiv class\x3d"km-card-message-image-price-container"\x3e'+
(("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(1*a.Price.OfferedPrice))+'\x3c/div\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"km-card-message-body"\x3e\n            \x3ch1 class\x3d"km-card-message-body-title"\x3e'+a.HotelName+'\x3c/h1\x3e\n            \x3cdiv class\x3d"km-card-message-body-ratings"\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
e.star1+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+e.star2+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
e.star3+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+e.star4+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
e.star5+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"km-card-message-body-address"\x3e\n                \x3cspan class\x3d"km-card-message-body-address-icon"\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24"\x3e\n                        \x3cpath d\x3d"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e'+
a.HotelAddress+'\n            \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"km-card-message-footer"\x3e\n            \x3cbutton class\x3d"km-card-message-footer-button" data-resultindex\x3d '+a.ResultIndex+" data-sessionid\x3d "+c+" data-name\x3d "+a.HotelName.replace(" ","_")+" \x3e Get Room Details\x3c/button\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e"},getRoomDetailTemplate:function(a,c){return'\x3cdiv class\x3d"km-single-card-message"\x3e\n                \x3cdiv class\x3d"message received km-blocked-room"\x3e\n                    \x3cdiv class\x3d"km-blocked-room-details"\x3e\n                    \x3cdiv class\x3d"km-card-message-image-continer"\x3e\x3cimg class \x3d"km-card-message-img" src\x3d'+
a.HotelPicture+" alt\x3d"+a.HotelName+'\x3e\x3c/div\x3e\n                        \x3cdiv class\x3d"km-blocked-room-text-container"\x3e\n                            \x3cdiv class\x3d"km-blocked-room-room-type"\x3e\n                                \x3cspan\x3eRoom Type: \x3c/span\x3e \x3cspan\x3e '+a.RoomTypeName+'\x3c/span\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-guests"\x3e\n                                \x3cspan\x3eGuests:\x3c/span\x3e\x3cspan\x3e'+
("undefined"==a.NoOfGuest?1:a.NoOfGuest)+' \x3c/span\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-price"\x3e\n                                \x3cp\x3ePrice:\x3cbr\x3e\x3cspan\x3e(Per Room Per Night)\x3c/span\x3e\x3c/p\x3e\n\n                                \x3cspan\x3e'+("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(a.DayRates.Amount?a.DayRates.Amount:a.Price.RoomPrice)+'\x3c/span\x3e\n\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-sub-total"\x3e\n                                \x3cp\x3eTotal:\x3cbr\x3e\x3cspan\x3e(1 Room for '+
a.NoOfNights+" Nights)\x3c/span\x3e\x3c/p\x3e\n                                \x3cspan\x3e "+("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(a.Price.RoomPrice)+' \x3c/span\x3e\n                            \x3c/div\x3e\n                        \x3c/div\x3e\n                        \x3cdiv class\x3d"km-blocked-room-button-container"\x3e\n                            \x3cbutton class\x3d"km-block-room-button" data-sessionId\x3d '+c+" data-roomIndex\x3d"+a.RoomIndex+" data-NoOfRooms\x3d"+
a.NoOfRooms+" data-NoOfNights\x3d"+a.NoOfNights+" data-HotelName\x3d "+a.HotelName.replace(" ","_")+" data-HotelResultIndex\x3d "+a.HotelResultIndex+" \x3eBook\x3c/button\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e"},getButtonTemplate:function(a,c){return"link"==a.type?'\x3cbutton data-eventhandlerid\x3d"'+a.handlerId+'" class\x3d"km-cta-button km-add-more-rooms km-undecorated-link '+c+'"\x3e\x3ca href \x3d"'+
a.url+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e\x3c/button\x3e":'\x3cbutton data-eventhandlerid\x3d"'+a.handlerId+'" class\x3d"km-cta-button km-add-more-rooms '+c+'"\x3e'+a.name+"\x3c/button\x3e"},getQuickRepliesTemplate:function(a,c){return'\x3cbutton title\x3d"'+a.message+'" class\x3d"km-cta-button km-add-more-rooms km-quick-replies '+c+'"\x3e'+a.title+"\x3c/button\x3e"},getPassangerDetail:function(a){a.sessionId||console.log("sessionId not present in message..");return'  \x3cdiv class\x3d"km-guest-details-container km-rich-text-default-container"\x3e\n                \x3cdiv class\x3d"km-guest-detail-form"\x3e\n                    \x3cdiv class\x3d "km-select-title"\x3e    \n                        \x3cselect name\x3d"title" class\x3d"km-title-select"\x3e\n                            \x3coption value\x3d"0" disabled selected\x3eTitle *\x3c/option\x3e\n                            \x3coption value\x3d"Mr."\x3eMr.\x3c/option\x3e\n                            \x3coption value\x3d"Ms."\x3eMs.\x3c/option\x3e\n                            \x3coption value\x3d"Mrs."\x3eMrs.\x3c/option\x3e\n                        \x3c/select\x3e\n                    \x3c/div\x3e\n                    \x3cinput type\x3d"number" name\x3d"age"  class\x3d"km-input km-age-input n-vis" placeholder\x3d"Age *" min\x3d"0" max\x3d"150"\x3e\n                    \x3cinput type\x3d"text" name\x3d"first-name"  class\x3d"km-input first-name-input km-pxinfo-btn-right" placeholder\x3d"First Name *"\x3e\n                    \x3cinput type\x3d"text" name\x3d"middle-name"  class\x3d"km-input middle-name-input n-vis" placeholder\x3d"Middle Name (optional) "\x3e\n                    \x3cinput type\x3d"text" name\x3d"last-name"  class\x3d"km-input last-name-input km-pxinfo-btn-left" placeholder\x3d"Last Name *"\x3e\n                    \x3cinput type\x3d"email" name\x3d"email"  class\x3d"km-input e-mail-input km-pxinfo-btn-right" placeholder\x3d"Email Id *"\x3e\n                    \x3cinput type\x3d"text" name\x3d"contact-no"  class\x3d"km-input number-input km-pxinfo-btn-left" placeholder\x3d"Contact Number "\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"km-guest-button-container"\x3e\n                    \x3cbutton class\x3d"km-add-more-rooms km-submit-person-detail" data-sessionid\x3d '+
a.sessionId+"\x3eSubmit\x3c/button\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e\n            "},getListMarkup:function(){return'\x3cdiv class\x3d"km-message km-received km-faq-list" style\x3d""\x3e\n     \x3cdiv class\x3d"km-faq-list--container"  \x3e\n             \x3cdiv class\x3d"km-faq-list--header"\x3e\n                     {{{headerImgSrc}}}\n                     \x3cdiv class\x3d"km-faq-list--header_text-container"\x3e\n                                     {{{headerText}}}\n                         \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-list--body"\x3e\n             \x3cdiv class\x3d"km-faq-list--body_list-container"\x3e\n                 \x3cul class\x3d"km-faq-list--body_list"\x3e\n                     {{#elements}}\n                     \x3cli class \x3d{{hadlerClass}} data-type\x3d"{{dataType}}" data-reply \x3d "{{dataReply}}" data-articleid\x3d "{{dataArticleId}}" data-source\x3d"{{source}}"\x3e \x3ca href\x3d{{href}} target\x3d"_blank" class\x3d"km-undecorated-link" \x3e\n                             \x3cdiv class\x3d"km-faq-list--body_img"\x3e\n                                     {{{imgSrc}}}\n                             \x3c/div\x3e\n                         \x3cdiv class\x3d"km-faq-list--body_que-ans"\x3e\n                                 \x3cp class\x3d"km-faq-list--body_que"\x3e\n                                     {{title}}\n                                 \x3c/p\x3e\n                                 \x3cp class\x3d"km-faq-list--body_ans"\x3e\n                                     {{description}}\n                                 \x3c/p\x3e\n                             \x3c/div\x3e\n                         \x3c/a\x3e\n                     \x3c/li\x3e\n                     {{/elements}}\n                 \n                 \x3c/ul\x3e\n             \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-list--footer"\x3e\n                 \x3cdiv class\x3d"km-faq-list--footer_button-container"\x3e\n                         {{#buttons}}\n                         \x3cbutton class\x3d"km-cta-button km-add-more-rooms {{hadlerClass}}" data-type \x3d"{{dataType}}" data-reply\x3d"{{dataReply}}"\x3e\x3ca class \x3d"km-undecorated-link" href \x3d"{{href}}" target\x3d"_blank"\x3e{{name}}\x3c/a\x3e\x3c/button\x3e\n                         {{/buttons}}\n                     \n             \x3c/div\x3e\n         \x3c/div\x3e\n     \x3c/div\x3e'},
getDialogboxTemplate:function(){return'\x3cdiv id \x3d"km-faq-answer" class\x3d"km-message km-received km-faq-answer"\x3e\n     \x3cdiv class\x3d"km-faq-answer--container"\x3e\n         \x3cdiv class\x3d"km-faq-answer--body"\x3e\n             \x3cdiv class\x3d"km-faq-answer--body_container"\x3e\n                 \x3cp class\x3d"km-faq-answer--body_que"\x3e{{title}}\x3c/p\x3e\n                 \x3cp class\x3d"km-faq-answer--body_ans"\x3e {{description}}\x3c/p\x3e\n             \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-answer--footer"\x3e\n             \x3cdiv class\x3d"km-faq-answer--footer_button-text-container"\x3e\n                 \x3cp\x3e{{buttonLabel}}\x3c/p\x3e\n                 {{#buttons}}\n                 \x3cbutton class\x3d"km-faq-dialog-button km-quick-replies km-cta-button km-add-more-rooms" data-reply\x3d"{{name}}"\x3e{{name}}\x3c/button\x3e\n                {{/buttons}}\n             \x3c/div\x3e\n         \x3c/div\x3e\n     \x3c/div\x3e\n \x3c/div\x3e'}};
Kommunicate.markup.buttonContainerTemplate=function(a){for(var c='\x3cdiv class\x3d"km-cta-multi-button-container"\x3e',e=JSON.parse(a.payload),n=e?JSON.parse(a.formData||"{}"):"",v=1==e.length?"km-cta-button-1":2==e.length?"km-cta-button-2":"km-cta-button-many",y=0;y<e.length;y++)c+=Kommunicate.markup.getButtonTemplate(e[y],v);if(n){c+="\x3cform method \x3d'post'  target\x3d'_blank' class\x3d km-btn-hidden-form action \x3d"+a.formAction+"\x3e";for(var f in n)n.hasOwnProperty(f)&&(c+='\x3cinput type\x3d"hidden" name \x3d"'+
f+'" value\x3d"'+n[f]+'" /\x3e');c+="\x3c/form\x3e"}return c+"\x3c/div\x3e"};Kommunicate.markup.quickRepliesContainerTemplate=function(a){var c='\x3cdiv class\x3d"km-cta-multi-button-container"\x3e';a=JSON.parse(a.payload);for(var e=1==a.length?"km-cta-button-1":2==a.length?"km-cta-button-2":"km-cta-button-many",n=0;n<a.length;n++)c+=Kommunicate.markup.getQuickRepliesTemplate(a[n],e);return c+"\x3c/div\x3e"};
Kommunicate.markup.getHotelRoomPaxInfoTemplate=function(a){return'\x3cdiv class \x3d "km-rich-text-default-container"\x3e\n            \x3cdiv class\x3d"km-room-person-selector-container"\x3e'+Kommunicate.markup.getSingleRoomPaxInfo(a)+'\x3c/div\x3e\n            \x3chr\x3e\n            \x3cdiv class\x3d"km-add-room-button-container"\x3e\n                \x3cbutton  class\x3d"km-add-more-rooms km-btn-add-more-rooms" data-roomcount\x3d1\x3eADD ROOM\x3c/button\x3e\n                \x3cbutton class\x3d" km-add-more-rooms km-done-button"\x3eDONE\x3c/button\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e'};
Kommunicate.markup.getHotelCardContainerTemplate=function(a,c){for(var e="",n=0;n<a.length;n++)e+=Kommunicate.markup.getHotelCardTemplate(a[n],c);return'\x3cdiv class\x3d"km-card-message-container  km-div-slider"\x3e'+e+"\x3c/div\x3e"};Kommunicate.markup.getRoomDetailsContainerTemplate=function(a,c){a=a.HotelRoomsDetails;for(var e="",n=0;n<a.length;n++)e+=Kommunicate.markup.getRoomDetailTemplate(a[n],c);return'\x3cdiv class\x3d"km-card-room-detail-container  km-div-slider"\x3e'+e+"\x3c/div\x3e"};
Kommunicate.markup.getListContainerMarkup=function(a){return a&&a.payload?(a=JSON.parse(a.payload),a.headerImgSrc&&(a.headerImgSrc='\x3cdiv class\x3d"faq-list--header_text-img"\x3e\x3cimg src\x3d '+a.headerImgSrc+"/\x3e\x3c/div\x3e"),a.headerText&&(a.headerText='\x3cp class\x3d"faq-list--header_text"\x3e'+a.headerText+"\x3c/p\x3e"),a.elements.length&&(a.elements=a.elements.map(function(a){a.imgSrc&&(a.imgSrc="\x3cimg src \x3d"+a.imgSrc+"/\x3e");a.action&&"quick_reply"!=a.action.type&&"submit"!=a.action.type?
a.href=a.action.url:(a.href="javascript:void(0)",a.hadlerClass="km-list-item-handler");a.dataType=a.action.type||"";a.dataReply=a.action.text||a.title||"";a.dataArticleId=a.articleId||"";a.dataSource=a.source||"";return a})),a.buttons=a.buttons.map(function(a){a.action&&"quick_reply"!=a.action.type&&"submit"!=a.action.type?a.href=a.action.url:(a.href="javascript:void(0)",a.hadlerClass="km-list-button-item-handler");a.dataType=a.action.type||"";a.dataReply=a.action.text||a.name||"";return a}),Mustache.to_html(Kommunicate.markup.getListMarkup(),
a)):""};Kommunicate.markup.getDialogboxContainer=function(a){return a&&a.payload?(a=JSON.parse(a.payload),Mustache.to_html(Kommunicate.markup.getDialogboxTemplate(),a)):""};var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(a,c,e){function n(f){var g=this,n,w;MCK_GROUP_MAP=[];var I=[],oa,Fa,rb=!0,Na=[],xa=0;MCK_CLIENT_GROUP_MAP=[];var Ga=!1,pa=[],Ha=[],Ia=90,ha=[],T=[],Z=[],U=[],sb=!0,H=0,tb=f.mode;MCK_LABELS=f.labels;MCK_BASE_URL=f.baseUrl;var S=f.appId,ub=[],vb=[0,1,2,3],wb=[1,2,5,6,10],qa=[],fb=!1,cb=f.launcher,Ja=f.visitor,Ob=f.userName,db=f.locShare,Oa=f.video,O=f.fileBaseUrl,M=f.onInit,xb=f.onTopicDetails,lc=[0,1,2],yb=f.onClose,zb=f.displayText,ra=f.accessToken,Ya=f.readConversation,R=f.maxGroupSize,
Ab=f.onTabClicked,Pb=f.contactNumber,ea=f.maxAttachmentSize,Bb=f.appModuleName,Aa=f.getTopicDetail,Za=f.contactDisplayName,Cb=f.validateMessage,Ka=f.finalPriceResponse,$a=f.contactDisplayImage,Db=f.priceWidget,ia=f.openGroupSettings,ya=f.offlineMessageDetail,kb=f.authenticationTypeId,Eb=f.getConversationDetail,mc=f.notificationIconLink,Qb=f.mapStaticAPIkey,Rb=f.chatLauncherHtml,nc=f.awsS3Server?f.awsS3Server:!1,oc=f.notificationSoundLink?f.notificationSoundLink:Kommunicate.getBaseUrl()+"/plugin/audio/notification_tone.mp3",
z=Ja?"guest":a.trim(f.userId),Sb=db?f.googleApiKey:"NO_ACCESS",pc="undefined"===typeof f.source?1:f.source,Pa="boolean"===typeof f.topicBox?f.topicBox:!1,lb="boolean"===typeof f.olStatus?f.olStatus:!1,Tb="boolean"===typeof f.messageBubbleAvator?f.messageBubbleAvator:!0,gb="boolean"===typeof f.showOfflineMessage?f.showOfflineMessage:!1,Ub="boolean"===typeof f.hideGroupSubtitle?f.hideGroupSubtitle:!1,Vb="undefined"===typeof f.defaultMessageMetaData?{}:f.defaultMessageMetaData,Fb="boolean"===typeof f.groupUserCount?
f.groupUserCount:!1,Wb="boolean"===typeof f.checkUserBusyWithStatus?f.checkUserBusyWithStatus:!1,Xb="boolean"===typeof f.resetUserStatus?f.resetUserStatus:!1,Ca="boolean"===typeof f.topicHeader?f.topicHeader:!1,Yb=f.supportId?'data-mck-id\x3d"'+f.supportId+'"':"",Gb="boolean"===typeof f.loadOwnContacts?f.loadOwnContacts:!1,Zb="boolean"===typeof f.desktopNotification?f.desktopNotification:!0,$b="boolean"===typeof f.notification?f.notification:!0,ac="boolean"===typeof f.swNotification?f.swNotification:
!1,bc="boolean"===typeof f.autoTypeSearchEnabled?f.autoTypeSearchEnabled:!0,mb="boolean"===typeof f.launchOnNewMessage?f.launchOnNewMessage:!1,Hb="boolean"===typeof f.launchOnUnreadMessage?f.launchOnUnreadMessage:!1,cc="number"===typeof f.userTypeId?f.userTypeId:!1,J=["DEFAULT","NEW","OPEN"],dc=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],C=new function(){var b=this,e=[],m=[],f=[],h=[];b.updateLatestMessage=function(a){var c=[];c.push(a);b.updateLatestMessageArray(c);b.updateMckMessageArray(c)};
b.getLatestMessageArray=function(){return"undefined"!==typeof c.sessionStorage?a.parseJSON(c.sessionStorage.getItem("mckLatestMessageArray")):e};b.setLatestMessageArray=function(a){"undefined"!==typeof c.sessionStorage?c.sessionStorage.setItem("mckLatestMessageArray",c.JSON.stringify(a)):e=a};b.updateLatestMessageArray=function(b){if("undefined"!==typeof c.sessionStorage){var m=a.parseJSON(c.sessionStorage.getItem("mckLatestMessageArray"));null!==m?(m=m.concat(b),c.sessionStorage.setItem("mckLatestMessageArray",
c.JSON.stringify(m))):c.sessionStorage.setItem("mckLatestMessageArray",c.JSON.stringify(b));return b}return e=e.concat(b)};b.getMckMessageArray=function(){return"undefined"!==typeof c.sessionStorage?a.parseJSON(c.sessionStorage.getItem("mckMessageArray")):m};b.clearMckMessageArray=function(){"undefined"!==typeof c.sessionStorage?(c.sessionStorage.removeItem("mckMessageArray"),c.sessionStorage.removeItem("mckLatestMessageArray")):(m.length=0,e.length=0)};b.clearAppHeaders=function(){"undefined"!==
typeof c.sessionStorage&&c.sessionStorage.removeItem("mckAppHeaders")};b.setAppHeaders=function(a){"undefined"!==typeof c.sessionStorage&&c.sessionStorage.setItem("mckAppHeaders",c.JSON.stringify(a))};b.getAppHeaders=function(b){return"undefined"!==typeof c.sessionStorage?a.parseJSON(c.sessionStorage.getItem("mckAppHeaders")):{}};b.getMessageByKey=function(a){return f[a]};b.updateMckMessageArray=function(b){for(var e=0;e<b.length;e++){var h=b[e];f[h.key]=h}return"undefined"!==typeof c.sessionStorage?
(e=a.parseJSON(c.sessionStorage.getItem("mckMessageArray")),null!==e?(e=e.concat(b),c.sessionStorage.setItem("mckMessageArray",c.JSON.stringify(e))):c.sessionStorage.setItem("mckMessageArray",c.JSON.stringify(b)),b):m=m.concat(b)};b.getMckContactNameArray=function(){return"undefined"!==typeof c.sessionStorage?a.parseJSON(c.sessionStorage.getItem("mckContactNameArray")):h};b.setMckContactNameArray=function(a){"undefined"!==typeof c.sessionStorage?c.sessionStorage.setItem("mckContactNameArray",c.JSON.stringify(a)):
h=a};b.updateMckContactNameArray=function(b){if("undefined"!==typeof c.sessionStorage){var e=a.parseJSON(c.sessionStorage.getItem("mckContactNameArray"));null!==e&&(b=b.concat(e));c.sessionStorage.setItem("mckContactNameArray",c.JSON.stringify(b));return b}return h=h.concat(b)};b.clearMckContactNameArray=function(){"undefined"!==typeof c.sessionStorage?c.sessionStorage.removeItem("mckContactNameArray"):h.length=0}},da={},Sa=[],Ta=[],Qa={},ta=[],La=[],Ua=[],ba=[],eb=new function(){var b=this,f=!1,
g,K,h=a("#mck-file-menu"),sa=a("#mck-message-cell .mck-message-inner");a("#mck-tab-individual");var E=Ia;b.getLauncherHtml=function(){return Rb?'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher launchershadow"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher"\x3e'+Rb+"\x3c/a\x3e\x3c/div\x3e":'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher mck-button-launcher" '+("support"===
tb?Yb:"")+'\x3e\x3cdiv\x3e\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" xmlns:xlink\x3d"http://www.w3.org/1999/xlink" version\x3d"1.1" id\x3d"Layer_1" x\x3d"0px" y\x3d"0px" viewBox\x3d"0 0 500 500" style\x3d"enable-background:new 0 0 500 500;" xml:space\x3d"preserve"\x3e\n              \x3cstyle type\x3d"text/css"\x3e\n                  .km-launcher-logo-0{fill:url(#km-launcher-logo-gradient-1);}\n                  .km-launcher-logo-1{fill:#FFFFFF;}\n              \x3c/style\x3e\n              \x3cg\x3e\n                  \x3clinearGradient id\x3d"km-launcher-logo-gradient-1" gradientUnits\x3d"userSpaceOnUse" x1\x3d"3.367313e-08" y1\x3d"250" x2\x3d"500" y2\x3d"250"\x3e\n                      \x3cstop offset\x3d"0" style\x3d"stop-color:#3A3C80"/\x3e\n                      \x3cstop offset\x3d"0.1658" style\x3d"stop-color:#4B4C93"/\x3e\n                      \x3cstop offset\x3d"0.3516" style\x3d"stop-color:#5858A2"/\x3e\n                      \x3cstop offset\x3d"0.5063" style\x3d"stop-color:#5C5CA7"/\x3e\n                      \x3cstop offset\x3d"0.6795" style\x3d"stop-color:#53549D"/\x3e\n                      \x3cstop offset\x3d"0.9706" style\x3d"stop-color:#3D3E83"/\x3e\n                      \x3cstop offset\x3d"1" style\x3d"stop-color:#3A3C80"/\x3e\n                  \x3c/linearGradient\x3e\n                  \x3ccircle class\x3d"km-launcher-logo-0" cx\x3d"250" cy\x3d"250" r\x3d"250"/\x3e\n                  \x3cg\x3e\n                      \x3cpath class\x3d"km-launcher-logo-1" d\x3d"M377.5,379.6V237.1c0-51.4-41.7-93.1-93.1-93.1h-84.7c-51.4,0-93.1,41.7-93.1,93.1    c0,51.4,41.7,93.1,93.1,93.1h91.7c0,0,7.4,0.4,11.9,2.1c4.3,1.6,9.1,5.3,9.1,5.3l56.7,46.7c0,0,5.2,4.4,7,3.5    C377.9,386.9,377.5,379.6,377.5,379.6z M202.2,256.2c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-40    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V256.2z M254.1,275c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-77.8    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V275z M306,256.2c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-40    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V256.2z"/\x3e\n                  \x3c/g\x3e\n              \x3c/g\x3e\n              \x3c/svg\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
b.initializeApp=function(e,m){f=m;var h={applicationId:e.appId,userId:z};null!==Ob&&(h.displayName=e.userName);null!==e.email&&(h.email=e.email);null!==Pb&&(h.contactNumber=e.contactNumber);e.imageLink&&(h.imageLink=e.imageLink);e.appModuleName&&(h.appModuleName=e.appModuleName);ra&&(h.password=e.accessToken);-1===lc.indexOf(kb)&&(kb=0);Xb&&(h.resetUserStatus=!0);"number"==typeof cc&&(h.userTypeId=cc);h.enableEncryption=!0;h.appVersionCode=108;h.authenticationTypeId=kb;h.chatNotificationMailSent=
!0;oa=w="";b.validateAppSession(h)?Oa&&fa.InitilizeVideoClient(z,oa):a.ajax({url:MCK_BASE_URL+"/v2/tab/initialize.page",type:"post",data:c.JSON.stringify(h),contentType:"application/json",headers:{"Application-Key":S},success:function(c){Oa&&fa.InitilizeVideoClient(c.userId,c.deviceKey);"kommunicate"==window.applozic.PRODUCT_ID&&a("#km-chat-login-modal").css("display","none");C.clearMckMessageArray();C.clearMckContactNameArray();"INVALID_PASSWORD"===c?"function"===typeof M&&M({status:"error",errorMessage:"INVALID PASSWORD"}):
"INVALID_APPID"===c?"function"===typeof M&&M({status:"error",errorMessage:"INVALID APPLICATION ID"}):"error"===c||"USER_NOT_FOUND"===c?"function"===typeof M&&M({status:"error",errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===c?"function"===typeof M&&M({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof c&&null!==c&&c.token?(c.appId=h.applicationId,ra&&(c.accessToken=h.password),b.onInitApp(c)):"function"===typeof M&&M({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})},
error:function(){C.clearMckMessageArray();"function"===typeof M&&M({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})};b.onInitApp=function(e){b.appendLauncher();b.setLabels();a(".applozic-launcher").each(function(){a(this).hasClass("mck-msg-preview")||a(this).show()});n=e.token;mckUtils.setEncryptionKey(e.encryptionKey);z=e.userId;oa=e.deviceKey;Fa=e.websocketUrl;Ia=e.websocketIdleTimeLimit;O=e.fileBaseUrl;fb=e.deactivated;w=btoa(e.userId+":"+e.deviceKey);H=e.totalUnreadCount;Ja||"guest"===
z||"0"===z||"C0"===z||(f?aa.reconnect():aa.init());m.createContactWithDetail({userId:z,displayName:e.displayName,photoLink:e.imageLink});a.ajaxPrefilter(function(a){a.beforeSend||-1===a.url.indexOf(MCK_BASE_URL)||(a.beforeSend=function(a){b.setHeaders(a)})});if(e.betaPackage){var h="https://www.kommunicate.io/?utm_source\x3d"+c.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";a(".mck-running-on a").attr("href",h);a(".mck-running-on").removeClass("n-vis").addClass("vis")}h=
C.getMckContactNameArray();if(null!==h&&0<h.length)for(var p=0;p<h.length;p++){var g=h[p];null!==g&&(ta[g[0]]=g[1])}ca.checkUserConnectedStatus();"function"===typeof M&&M("success",e);eb.tabFocused();0<za.length&&0<H&&za.html(H);Hb&&x.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});Va.subscribeToServiceWorker();C.setAppHeaders(e);mckGroupService.loadGroups({apzCallback:t.loadGroups});Kommunicate.postPluginInitialization(null,e)};b.validateAppSession=function(a){var c=C.getAppHeaders();if(c&&c.userId){if(a.applicationId===
c.appId&&a.userId===c.userId&&a.password===c.accessToken)return b.onInitApp(c),!0;C.clearAppHeaders()}return!1};b.setHeaders=function(a){a.setRequestHeader("UserId-Enabled",!0);w&&a.setRequestHeader("Authorization","Basic "+w);a.setRequestHeader("Application-Key",S);oa&&a.setRequestHeader("Device-Key",oa);ra&&a.setRequestHeader("Access-Token",ra);Bb&&a.setRequestHeader("App-Module-Name",Bb)};b.setLabels=function(){a("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);
a("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]);a("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]);a("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]);a("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]);a("#mck-loc-address").attr("placeholder",
MCK_LABELS["location.placeholder"]);a("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]);a("#mck-no-messages").html(MCK_LABELS["empty.messages"]);a("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]);a("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]);a("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);a("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);a("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",
MCK_LABELS["create.group.title"]);a("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);a("#mck-msg-error").html(MCK_LABELS["group.deleted"]);a("#mck-gc-title-label").html(MCK_LABELS["group.title"]);a("#mck-gc-type-label").html(MCK_LABELS["group.type"]);a("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);a("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);a("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",
MCK_LABELS["members.title"]);a("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]);a("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);a("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);a("#mck-typing-label").html(MCK_LABELS.typing);a("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",
MCK_LABELS["clear.messages"]);a("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);a("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]);a("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);a("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);a("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);a(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);
a("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);a("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close);a("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send);a("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);a("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);a("#mck-group-name-save").attr("title",MCK_LABELS.save);a("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);a("#mck-group-name-edit").attr("title",
MCK_LABELS.edit)};a(e).on("click",".fancybox",function(b){b=a(this);if(-1!==b.data("type").indexOf("video")){var c=b.find(".mck-video-box").html(),e;b.fancybox({content:c,title:b.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){e=a(".fancybox-inner").find("video").get(0);e.load();e.play()}})}else b=b.data("url"),a(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:b,type:"image"})});
a(c).on("resize",function(){"block"===h.css("display")&&Ib.fileMenuReposition();if(0===sa.find(".mck-contact-list").length){var a=sa.get(0).scrollHeight;sa.height()<a&&sa.animate({scrollTop:sa.prop("scrollHeight")},0)}});b.appendLauncher=function(){a("#mck-sidebox-launcher").remove();a("body").append(b.getLauncherHtml());Va.init()};b.tabFocused=function(){function a(a){var e={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};a=a||c.event;(sb=a.type in e?e[a.type]:this.hidden?!1:!0)?
(1>E&&rb&&aa.checkConnected(!0),b.stopIdleTimeCounter()):(1===xa&&aa.sendTypingStatus(0),b.manageIdleTime())}"hidden"in e?e.addEventListener("visibilitychange",a):!1 in e?e.addEventListener("mozvisibilitychange",a):!1 in e?e.addEventListener("webkitvisibilitychange",a):!1 in e?e.addEventListener("msvisibilitychange",a):"onfocusin"in e?e.onfocusin=e.onfocusout=a:c.onpageshow=c.onpagehide=c.onfocus=c.onblur=a;void 0!==e.hidden&&a({type:e.hidden?"blur":"focus"})};b.manageIdleTime=function(){E=Ia;g&&
clearInterval(g);g=setInterval(function(){0>--E&&(E=0,aa.stopConnectedCheck(),clearInterval(g),g="")},6E4)};b.stopIdleTimeCounter=function(){E=Ia;g&&clearInterval(g);g=""};b.manageOfflineMessageTime=function(a){if("object"!==typeof ya||isNaN(ya.timeout))c.console.log("Offline message timeout required.");else{if(1===ya.type){if(!ya.userIds||0===ya.userIds.length){c.console.log("Offline message userIds required.");return}if(-1===ya.userIds.indexOf(a))return}K&&clearInterval(K);K=setTimeout(function(){clearInterval(K);
K="";m.showOfflineMessage()},5E3*parseInt(ya.timeout))}};b.stopOfflineMessageCounter=function(){K&&clearInterval(K);K=""}},Ib=new function(){var b=this,e="",m="",f=!1,h=a("#mck-my-loc"),g=a("#mck-loc-box"),n=a("#mck-loc-lat"),V=a("#mck-loc-lon"),qc=a("#mck-btn-loc"),A=a("#mck-sidebox-ft"),P=a("#mck-file-menu"),w=a("#mck-btn-attach"),t=a("#mck-map-content"),x=a("#mck-loc-address");b.init=function(){db&&c.google&&"object"===typeof c.google.maps&&(e=new c.google.maps.Geocoder,w.on("click",function(){b.fileMenuToggle()}),
qc.on("click",function(){f?g.mckModal():(mckMapUtils.getCurrentLocation(b.onGetCurrLocation,b.onErrorCurrLocation),f=!0)}));h.on("click",function(){mckMapUtils.getCurrentLocation(b.onGetMyCurrLocation,b.onErrorMyCurrLocation)})};b.fileMenuReposition=function(){var a=A.offset();a.bottom=c.innerHeight-a.top;P.css({bottom:51<a.bottom?a.bottom:51,right:0})};b.fileMenuToggle=function(){w.hasClass("on")?(w.removeClass("on"),P.hide()):(b.fileMenuReposition(),w.addClass("on"),P.show())};b.onGetCurrLocation=
function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;b.openMapBox()};b.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;b.openMapBox()};b.onErrorMyCurrLocation=function(a){alert("Unable to retrieve your location. ERROR("+a.code+"): "+a.message)};b.onGetMyCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;n.val(MCK_CURR_LATITIUDE);V.val(MCK_CURR_LONGITUDE);n.trigger("change");
V.trigger("change");m?x.val(m):e&&e.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(a,b){"OK"===b&&a[1]&&(m=a[1].formatted_address)})};b.openMapBox=function(){t.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:n,longitudeInput:V,locationNameInput:x},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(a){MCK_CURR_LATITIUDE=a.latitude;MCK_CURR_LONGITUDE=a.longitude}});g.on("shown.bs.mck-box",
function(){t.locationpicker("autosize")});g.mckModal()}},ca=new function(){var b=this,e=a("#mck-msg-form"),m=a("#mck-msg-error"),f=a("#mck-tab-title"),h=a("#mck-tab-status"),g=a(".mck-typing-box"),n=a("#mck-block-button"),V=a("#mck-message-cell .mck-message-inner");b.updateUserStatus=function(a){if("object"===typeof ha[a.userId]){var b=ha[a.userId];0===a.status?(b.connected=!1,b.lastSeenAtTime=a.lastSeenAtTime):1===a.status&&(b.connected=!0)}else b=[],b.push(a.userId),X.getUsersDetail(b,{})};b.getUserDetail=
function(a){if("object"===typeof ha[a])return ha[a]};b.checkUserConnectedStatus=function(){var c=[],e=[];a(".mck-user-ol-status").each(function(){var b=a(this).data("mck-id");"undefined"!==typeof b&&""!==b&&(c.push(b),b=mckContactUtils.formatContactId(""+b),a(this).addClass(b),a(this).next().addClass(b))});0<c.length&&(a.each(c,function(a,b){"undefined"===typeof ha[b]&&e.push(b)}),0<e.length?X.getUsersDetail(e,{setStatus:!0}):b.updateUserConnectedStatus())};b.updateUserConnectedStatus=function(){a(".mck-user-ol-status").each(function(){var b=
a(this),c=b.data("mck-id");if(c){var e=ha[c];"undefined"!==typeof ha[c]&&e.connected?(b.removeClass("n-vis").addClass("vis"),b.next().html("("+MCK_LABELS.online+")")):(b.removeClass("vis").addClass("n-vis"),b.next().html("(Offline)"))}})};b.lastSeenOfGroupOfTwo=function(a){c.MCK_OL_MAP[a]?(h.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),h.removeClass("n-vis").addClass("vis")):Z[a]&&(a=mckDateUtils.getLastSeenAtStatus(Z[a]),h.html(a),h.attr("title",a),f.addClass("mck-tab-title-w-status"),
h.removeClass("n-vis").addClass("vis"))};b.toggleBlockUser=function(a,b){b?(m.html(MCK_LABELS.blocked),m.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),e.removeClass("vis").addClass("n-vis"),f.removeClass("mck-tab-title-w-status"),h.removeClass("vis").addClass("n-vis"),g.removeClass("vis").addClass("n-vis"),V.data("blocked",!0),n.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"])):(m.html(""),m.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),e.removeClass("n-vis").addClass("vis"),
V.data("blocked",!1),n.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),Ha[a]||!c.MCK_OL_MAP[a]&&!Z[a]||(c.MCK_OL_MAP[a]?h.attr("title",MCK_LABELS.online).html(MCK_LABELS.online):Z[a]&&(a=mckDateUtils.getLastSeenAtStatus(Z[a]),h.html(a),h.attr("title",a)),f.addClass("mck-tab-title-w-status"),h.removeClass("n-vis").addClass("vis")))}};new function(){var b=a("#mck-msg-to");a("#mck-btn-loc");var e=a("#mck-loc-box"),m=a("#mck-msg-sbmt"),f=a("#mck-msg-error"),h=a("#mck-loc-submit"),
g=a("#mck-msg-response"),n=a("#mck_response_text"),V=a("#mck-message-cell .mck-message-inner");h.on("click",function(){var a={type:5,contentType:2,message:c.JSON.stringify(mckMapUtils.getSelectedLocation())},h=V.data("mck-conversationid"),p=V.data("mck-topicid");h?a.conversationId=h:p&&(h={topicId:p},p=T[p],"object"===typeof p&&(h.topicDetail=c.JSON.stringify(p)),a.conversationPxy=h);!0===V.data("isgroup")?a.groupId=b.val():a.to=b.val();m.attr("disabled",!0);f.removeClass("vis").addClass("n-vis");
f.html("");n.html("");g.removeClass("vis").addClass("n-vis");x.sendMessage(a);e.mckModal("hide")})};var t=new function(){var b=this,f={0:"User",1:"Admin",2:"Moderator",3:"Member"},g=a("#mck-msg-form"),n=a("#mck-msg-error"),h=a("#mck-tab-title"),sa=a("#mck-tab-status"),E=a("#mck-no-gsm-text"),V=a("#mck-gms-loading"),w=a("#mck-contact-loading");a("#mck-tab-menu-box");a("#mck-search-loading");var A=a("#mck-group-info-tab"),P=a("#mck-sidebox-search");a("#mck-group-name-box");var v=a("#mck-group-back-link"),
Da=a("#mck-group-name-edit"),Wa=a("#mck-group-name-save"),C=a("#mck-sidebox-content"),y=a("#mck-tab-option-panel"),G=a("#mck-btn-group-create"),F=a("#mck-group-create-tab"),L=a("#mck-contacts-content"),N=a("#mck-btn-group-update"),Y=a("#mck-group-create-type"),ja=a("#mck-group-icon-upload"),Jb=a("#mck-group-icon-change"),Kb=a("#mck-group-member-list"),I=a("#mck-group-update-panel"),O=a(".mck-tab-message-option"),S=a("#mck-group-create-title"),Ma=a(".mck-group-menu-options"),rc=a("#mck-group-member-search"),
ua=a("#mck-btn-group-icon-save");a("#mck-group-info-icon-box");var hb=a(".mck-group-admin-options"),nb=a("#mck-group-add-member-box"),W=a("#mck-message-cell .mck-message-inner"),va=a("#mck-group-name-sec .mck-group-title");a("#mck-group-create-icon-box");var sc=a("#mck-group-info-icon-loading"),ca=a("#mck-gm-search-box");a("#mck-group-member-search-list");var M=a("#mck-group-create-icon-loading"),H=a("#mck-group-info-icon-box .mck-group-icon"),J=a("#mck-group-create-icon-box .mck-group-icon"),wa=
a("#mck-group-create-icon-box .mck-overlay-box"),ha=a("#mck-gc-overlay-label");a.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
a.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a(".mck-group-name-box div[contenteditable]").keypress(function(c){if(8===c.which||37===c.keyCode||38===c.keyCode||39===c.keyCode||40===c.keyCode||c.ctrlKey&&97===c.which)return!0;if(13!==c.keyCode||c.shiftKey||c.ctrlKey)return 30>this.innerHTML.length;a(c.target).hasClass("mck-group-create-title")&&b.submitCreateGroup();return!1}).on("paste",function(a){var b=this;setTimeout(function(){30<b.innerText.length&&(b.innerHTML=b.innerText.substring(0,30),mckUtils.setEndOfContenteditable(b));return!1},
"fast")}).on("drop",function(a){a.preventDefault();a.stopPropagation()});a(e).on("click",".mck-btn-change-role",function(b){b.preventDefault();b=a(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var c=a(this).parents(".mck-li-group-member").data("role");b.find("select").val(c);b.removeClass("n-vis").addClass("vis");I.removeClass("n-vis").addClass("vis")});N.on("click",function(){var b=[];a(".mck-group-change-role-box.vis").each(function(c,e){c=a(this);e=parseInt(c.find("select").val());
var m=c.parents(".mck-li-group-member").data("role");e!==m&&(c={userId:c.parents(".mck-li-group-member").data("mck-id"),role:e},b.push(c))});if(0<b.length){var c=W.data("mck-id"),e=W.data("isgroup");c&&e&&(N.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),mckGroupService.updateGroupInfo({groupId:c,users:b,apzCallback:t.onUpdateGroupInfo}))}});a("#mck-group-info-icon-box .mck-overlay").on("click",function(a){Jb.trigger("click")});a("#mck-group-create-icon-box .mck-overlay").on("click",
function(a){ja.trigger("click")});a(e).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var b=a(this);0===b.find(".mck-group-icon-default").length&&b.find(".mck-overlay-box").addClass("n-vis")});a(e).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",
function(){a(this).find(".mck-overlay-box").addClass("n-vis")});Da.on("click",function(){va.attr("contenteditable",!0).focus();mckUtils.setEndOfContenteditable(va[0]);Wa.removeClass("n-vis").addClass("vis");Da.removeClass("vis").addClass("n-vis")});Wa.on("click",function(){var b=a.trim(va.text());if(0<b.length){var c=W.data("mck-id"),e=W.data("isgroup");c&&e&&(Da.removeClass("n-vis").addClass("vis"),Wa.removeClass("vis").addClass("n-vis"),va.attr("contenteditable",!1),mckGroupService.updateGroupInfo({groupId:c,
name:b,apzCallback:t.onUpdateGroupInfo}))}else va.addClass("mck-req-border")});ua.on("click",function(){var a=H.data("iconurl");if(a){var b=W.data("mck-id"),c=W.data("isgroup");b&&c&&(setTimeout(function(){ua.removeClass("vis").addClass("n-vis")},1E3),H.data("iconurl",""),mckGroupService.updateGroupInfo({groupId:b,imageUrl:a,apzCallback:t.onUpdateGroupInfo}))}else va.addClass("mck-req-border")});G.on("click",function(){b.submitCreateGroup()});b.submitCreateGroup=function(){var b=a.trim(S.text()),
c=Y.val(),e=J.data("iconurl");0<b.length?(b={groupName:b},c&&(c=parseInt(c),-1!==wb.indexOf(c)&&(b.type=c)),e&&(b.groupIcon=e),J.data("iconurl",""),b.isInternal=!0,G.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),x.getGroup(b)):S.addClass("mck-req-border")};b.loadGroups=function(b){b=b.data;Sa.length=0;a.each(b,function(a,b){"undefined"!==typeof b.id&&(b=mckGroupUtils.addGroup(b),Sa.push(b))})};b.getDeletedAtTime=function(a){if("object"===typeof MCK_GROUP_MAP[a])return MCK_GROUP_MAP[a].deletedAtTime};
b.getGroupDisplayName=function(a){if("object"===typeof MCK_GROUP_MAP[a]){a=MCK_GROUP_MAP[a];var b=a.displayName;if(7===a.type){var c=m.getContactFromGroupOfTwo(a);"undefined"!==typeof c&&(b=m.getTabDisplayName(c.contactId,!1))}3===a.type&&-1!==b.indexOf(z)&&(b=b.replace(z,"").replace(":",""),"function"===typeof Za&&(b=(c=Za(b))?c:b));b||5!==a.type||(b="Broadcast");b||(b=a.contactId);return b}return a};b.getGroupImage=function(a){return a?'\x3cimg src\x3d"'+a+'"/\x3e':'\x3cimg src\x3d"'+MCK_BASE_URL+
'/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'};b.getGroupDefaultIcon=function(){return'\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'};b.addMemberToGroup=function(a,b){"object"===typeof a.members&&(-1===a.members.indexOf(b)&&a.members.push(b),"object"===typeof a.removedMembersId&&-1!==a.removedMembersId.indexOf(b)&&a.removedMembersId.splice(a.removedMembersId.indexOf(b),1),MCK_GROUP_MAP[a.contactId]=a);return a};b.removeMemberFromGroup=function(a,b){"object"!==typeof a.removedMembersId||
1>a.removedMembersId.length?(a.removedMembersId=[],a.removedMembersId.push(b)):-1===a.removedMembersId.indexOf(b)&&a.removedMembersId.push(b);return MCK_GROUP_MAP[a.contactId]=a};b.authenticateGroupUser=function(a){if(!b.isGroupLeft(a)&&0<a.members.length)for(var c=0;c<a.members.length;c++)if(z===""+a.members[c])return!0;return!1};b.isAppendOpenGroupContextMenu=function(a){return 0!==ia.deleteChatAccess&&b.authenticateGroupUser(a)?a.adminName===z||2===ia.deleteChatAccess?!0:!1:!1};b.validateOpenGroupUser=
function(a){if(6===a.type){if(!b.authenticateGroupUser(a)){if(ia.disableChatForNonGroupMember){var c=ia.defaultChatDisabledMessage;c||(c="Chat disabled");n.html(c);n.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");g.removeClass("vis").addClass("n-vis");h.removeClass("mck-tab-title-w-status");sa.removeClass("vis").addClass("n-vis")}Ma.removeClass("vis").addClass("n-vis");O.removeClass("vis").addClass("n-vis");y.removeClass("vis").addClass("n-vis");"undefined"===typeof ub[a.contactId]&&aa.subscribeToOpenGroup(a)}a.adminName===
z?0===ia.deleteChatAccess&&O.removeClass("vis").addClass("n-vis"):(ia.allowInfoAccessGroupMembers||Ma.removeClass("vis").addClass("n-vis"),2!==ia.deleteChatAccess&&O.removeClass("vis").addClass("n-vis"),ia.allowInfoAccessGroupMembers||2===ia.deleteChatAccess||y.removeClass("vis").addClass("n-vis"));return!1}return!0};b.addGroupStatus=function(a){var c=b.isGroupLeft(a);if(6!==a.type&&(c||Ub)){if(c)t.onGroupLeft("",{groupId:a.contactId});h.removeClass("mck-tab-title-w-status");sa.removeClass("vis").addClass("n-vis")}else if(0<
a.members.length){c="";for(var e=!1,f=30>=a.members.length?a.members.length:25,g=0;g<f;g++)if(z===""+a.members[g]||-1!==a.removedMembersId.indexOf(a.members[g]))e=!0;else{var p=m.fetchContact(""+a.members[g]);p=m.getTabDisplayName(p.contactId,!1);c+=" "+p+","}if(5!==a.type&&6!==a.type||e&&5!==a.type)c+=" You";30<a.members.length&&(c+=" and "+(a.members.length-25)+" more");c=c.replace(/,\s*$/,"");sa.html(c);sa.attr("title",c);sa.removeClass("n-vis").addClass("vis");h.addClass("mck-tab-title-w-status");
Ma.removeClass("n-vis").addClass("vis")}else h.removeClass("mck-tab-title-w-status"),sa.removeClass("vis").addClass("n-vis");7===a.type&&(sa.html(""),Ma.removeClass("vis").addClass("n-vis"))};b.disableGroupTab=function(){n.html(MCK_LABELS["group.chat.disabled"]);n.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");g.removeClass("vis").addClass("n-vis");h.removeClass("mck-tab-title-w-status");sa.removeClass("vis").addClass("n-vis")};b.isGroupLeft=function(b){var c=!1;b.removedMembersId&&0<
b.removedMembersId.length&&a.each(b.removedMembersId,function(a,b){b===z&&(c=!0)});return c};b.onGroupLeft=function(a,c){w.removeClass("vis").addClass("n-vis");if("object"===typeof a&&"error"===a.status)alert("Unable to process your request. "+a.errorMessage);else if(a=c.groupId,A.hasClass("vis"))c=A.data("mck-id"),a===c&&v.trigger("click");else if(C.hasClass("vis")){c=W.data("mck-id");var e=W.data("isgroup");c===a.toString()&&e&&(Ma.removeClass("vis").addClass("n-vis"),b.disableGroupTab())}};b.onAddedGroupMember=
function(c,e){w.removeClass("vis").addClass("n-vis");if("object"===typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{var f=e.groupId,h=e.userId;c="";f?c=mckGroupUtils.getGroup(f):e.clientGroupId&&(c=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId));"object"===typeof c?(c=b.addMemberToGroup(c,h),A.hasClass("vis")?(e=A.data("mck-id"),f===e&&(f=m.fetchContact(""+h),0===a("#li-gm-"+f.htmlId).length&&b.addGroupMember(c,f),b.sortGroupMemberHtmlList(),b.enableGroupAdminMenuToggle())):
C.hasClass("vis")&&(e=W.data("mck-id"),h=W.data("isgroup"),e===f.toString()&&h&&b.addGroupStatus(c))):mckGroupService.getGroupFeed({groupId:f,clientGroupId:e.clientGroupId,apzCallback:t.onGroupFeed})}};b.onRemovedGroupMember=function(c,e){w.removeClass("vis").addClass("n-vis");if("object"===typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{c=e.groupId;var f=e.userId,h="";c?h=mckGroupUtils.getGroup(c):e.clientGroupId&&(h=mckGroupUtils.getGroupByClientGroupId(e.clientGroupId));
"object"===typeof h?(h=b.removeMemberFromGroup(h,f),A.hasClass("vis")?(h=A.data("mck-id"),c===h&&(c=m.fetchContact(""+f),c=a("#li-gm-"+c.htmlId),0<c.length&&c.remove())):C.hasClass("vis")&&(e=W.data("mck-id"),f=W.data("isgroup"),e===c.toString()&&f&&b.addGroupStatus(h))):mckGroupService.getGroupFeed({groupId:c,clientGroupId:e.clientGroupId,apzCallback:t.onGroupFeed})}};b.onGroupFeed=function(c,e){w.removeClass("vis").addClass("n-vis");if("success"===c.status){c=c.data;var f=c.conversationPxy,h=mckGroupUtils.getGroup(c.id);
c.deletedAtTime&&(n.html(MCK_LABELS["group.deleted"]),n.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),g.removeClass("vis").addClass("n-vis"));var p=[];"object"===typeof f&&(U[f.id]=f,qa[f.topicId]=[f.id],f.topicDetail&&(T[f.topicId]=a.parseJSON(f.topicDetail)),p.push(f));0<p.length&&(ba[e.groupId]=p);X.loadUserProfiles(c.membersId);e.isMessage&&"object"===typeof e.message&&m.populateMessage(e.messageType,e.message,e.notifyUser);e.isReloadTab&&b.reloadGroupTab(h)}};b.onUpdateGroupInfo=
function(c,e){w.removeClass("vis").addClass("n-vis");N.attr("disabled",!1).html("Update");I.removeClass("vis").addClass("n-vis");if("object"===typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{c=e.groupId;e=e.groupInfo;var f=mckGroupUtils.getGroup(c);if("object"===typeof f){e.imageUrl&&(f.imageUrl=e.imageUrl);e.newName&&(f.displayName=e.newName);e.users&&0<e.users.length&&a.each(e.users,function(a,b){b.userId&&(f.users[b.userId]=b)});if(A.hasClass("vis"))e.imageUrl&&
H.html(b.getGroupImage(f.imageUrl)),va.html(f.displayName),e.users&&0<e.users.length&&(Kb.html(""),b.addMembersToGroupInfoList(f),f.adminName===z?nb.removeClass("n-vis").addClass("vis"):nb.removeClass("vis").addClass("n-vis"));else if(C.hasClass("vis")){var m=W.data("mck-id"),g=W.data("isgroup");m===c.toString()&&g?h.html(f.displayName):0<a("#li-group-"+f.htmlId).length&&(a("#li-group-"+f.htmlId+" .mck-cont-name strong").html(f.displayName),e.imageUrl&&a("#li-group-"+f.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+
f.imageUrl+"'\x3e"))}MCK_GROUP_MAP[f.contactId]=f}}};b.getGroupFeedFromMessage=function(a){var b=a.message;if(b){a.groupId=b.groupId;a.isMessage=!0;if(b.conversationId){var c=U[b.conversationId];if("object"!==typeof c||"object"!==typeof T[c.topicId])a.conversationId=b.conversationId}a.apzCallback=t.onGroupFeed;mckGroupService.getGroupFeed(a)}};b.reloadGroupTab=function(a){var c=W.data("mck-id"),e=W.data("isgroup");c===a.contactId.toString()&&e&&b.addGroupStatus(a)};b.loadGroupTab=function(b){"error"===
b.status?alert("Unable to process your request. "+b.errorMessage):(m.loadTab({tabId:b.data.contactId,isGroup:!0}),a("#mck-search").val(""))};b.addMembersToGroupInfoList=function(c){var e=c.members;e.sort();Kb.html("");a.each(e,function(e,f){f&&(e=m.fetchContact(""+f),0===a("#li-gm-"+e.htmlId).length&&b.addGroupMember(c,e))});b.sortGroupMemberHtmlList();b.enableGroupAdminMenuToggle()};b.enableGroupAdminMenuToggle=function(){a(".mck-group-member-info").bind("mouseenter",function(){a(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",
function(){a(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};b.addGroupMember=function(b,e){var h="n-vis",g="n-vis",p=b.users[e.contactId],F="Member",n=3;p&&"undefined"!==typeof p.role&&(n=p.role,F=f[p.role]);p=m.getTabDisplayName(e.contactId,!1);e.contactId===b.adminName&&(h="vis");b.adminName===z&&(g="vis");e.contactId===z&&(p="You",g="n-vis");b=m.getContactImageLink(e,p);var Y="";pa[e.contactId]||(c.MCK_OL_MAP[e.contactId]?Y=MCK_LABELS.online:Z[e.contactId]&&(Y=mckDateUtils.getLastSeenAtStatus(Z[e.contactId])));
e=[{roleExpr:F,roleVal:n,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:e.htmlId,contIdExpr:e.contactId,contImgExpr:b,contLastSeenExpr:Y,contNameExpr:p,contFirstAlphaExpr:p.charAt(0).toUpperCase(),isAdminExpr:h,enableAdminMenuExpr:g}];a.tmpl("groupMemberTemplate",e).appendTo("#mck-group-member-list")};b.addMembersToGroupSearchList=function(){var c=W.data("mck-id");if(W.data("isgroup")){var e=mckGroupUtils.getGroup(c),f=Ua,h=[];f=f.filter(function(a,
b){return f.indexOf(a)===b});f.sort();var g=e.members;a.each(f,function(a,c){c&&(a=m.fetchContact(""+c),-1===g.indexOf(a.contactId)||-1!==g.indexOf(a.contactId)&&-1!==e.removedMembersId.indexOf(a.contactId))&&(b.addGroupSearchMember(a),h.push(a))});b.enableGroupAdminMenuToggle();0<h.length?E.removeClass("vis").addClass("n-vis"):E.removeClass("n-vis").addClass("vis");m.initAutoSuggest({contactsArray:h,$searchId:rc,isContactSearch:!1})}V.removeClass("vis").addClass("n-vis")};b.addGroupSearchMember=
function(b){var e=m.getTabDisplayName(b.contactId,!1),f=m.getContactImageLink(b,e),h="user-"+b.htmlId,g="";pa[b.contactId]||(c.MCK_OL_MAP[b.contactId]?g=MCK_LABELS.online:Z[b.contactId]&&(g=mckDateUtils.getLastSeenAtStatus(Z[b.contactId])));a.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:h,contIdExpr:b.contactId,contImgExpr:f,contLastSeenExpr:g,contNameExpr:e}]).appendTo("#mck-group-member-search-list")};b.loadCreateGroupTab=function(){L.removeClass("vis").addClass("n-vis");C.removeClass("vis").addClass("n-vis");
P.removeClass("vis").addClass("n-vis");A.removeClass("vis").addClass("n-vis");M.removeClass("vis").addClass("n-vis");J.data("iconurl","");S.html("");wa.removeClass("n-vis");ha.html(MCK_LABELS["add.group.icon"]);J.html(b.getGroupDefaultIcon());F.removeClass("n-vis").addClass("vis")};b.loadGroupInfo=function(a){if(a.groupId){va.attr("contenteditable",!1);Wa.removeClass("vis").addClass("n-vis");Da.removeClass("n-vis").addClass("vis");L.removeClass("vis").addClass("n-vis");C.removeClass("vis").addClass("n-vis");
P.removeClass("vis").addClass("n-vis");I.removeClass("vis").addClass("n-vis");F.removeClass("vis").addClass("n-vis");ua.removeClass("vis").addClass("n-vis");sc.removeClass("vis").addClass("n-vis");A.removeClass("n-vis").addClass("vis");A.data("mck-id",a.groupId);H.data("iconurl","");a.conversationId&&A.data("mck-conversation-id",a.conversationId);Kb.html("");var c=mckGroupUtils.getGroup(a.groupId);"object"===typeof c?(H.html(b.getGroupImage(c.imageUrl)),va.html(c.displayName),b.addMembersToGroupInfoList(c),
c.adminName===z?nb.removeClass("n-vis").addClass("vis"):nb.removeClass("vis").addClass("n-vis")):mckGroupService.getGroupFeed({groupId:a.groupId,apzCallback:t.onGroupFeed})}};b.sortGroupMemberHtmlList=function(){a("#mck-group-member-list .mck-li-group-member").sort(function(a,b){return a.dataset.alpha>b.dataset.alpha}).appendTo("#mck-group-member-list")};b.addGroupMemberFromSearch=function(a){var b=A.data("mck-id");if("undefined"!==typeof b&&"undefined"!==typeof a){var c=mckGroupUtils.getGroup(b);
"object"===typeof c&&z===c.adminName?(X.loadUserProfile(a),mckGroupService.addGroupMember({groupId:b,userId:a,apzCallback:t.onAddedGroupMember})):hb.removeClass("vis").addClass("n-vis")}ca.mckModal("hide")}},la=new function(){var b=this,c=["CREATE","UPDATE"],f=a("#mck-file-box"),g=a(".mck-overlay"),h=a("#mck-msg-sbmt"),n=a("#mck-text-box"),E=a("#mck-file-input"),V=a(".mck-overlay-box"),t=a(".mck-file-upload"),A=a("#mck-group-icon-upload"),P=a("#mck-group-icon-change"),x=a("#mck-group-info-icon-box"),
v=a("#mck-btn-group-icon-save"),z=a("#mck-message-cell .mck-message-inner"),C=a("#mck-group-create-icon-box"),y=a("#mck-group-info-icon-loading"),G=a("#mck-group-create-icon-loading"),F=a("#mck-group-info-icon-box .mck-group-icon"),L=a("#mck-group-create-icon-box .mck-group-icon"),N=a("#mck-gc-overlay-label");a.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"progress progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"progress-bar progress-bar-success bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
b.init=function(){Kommunicate.attachEvents(a);t.on("click",function(){E.trigger("click")});A.on("change",function(){var e=a(this)[0].files[0];b.uplaodFileToAWS(e,c[0]);return!1});P.on("change",function(){var e=a(this)[0].files[0];b.uplaodFileToAWS(e,c[1]);return!1});E.on("change",function(){var c=a(this)[0].files[0],e={};e.file=c;e.name=c.name;!0===nc?b.uploadAttachment2AWS(e):b.uploadFile(e)});a(e).on("click",".mck-remove-file",function(){var c=a(this).parents(".mck-file-box"),e=c.data("mckfile");
c.remove();h.attr("disabled",!1);0===f.find(".mck-file-box").length&&(f.removeClass("vis").addClass("n-vis"),n.attr("required",""));"object"===typeof e&&(b.deleteFileMeta(e.blobKey),a.each(I,function(a,b){"undefined"!==typeof b&&b.blobKey===e.blobKey&&I.splice(a,1)}))})};b.audioRecoder=function(c){var e=c.file,g=[];if("undefined"!==typeof e)if(4<a(".mck-file-box").length&&g.push("Can't upload more than 5 files at a time"),e.size>1048576*ea&&g.push("file size can not be more than "+ea+" MB"),0<g.length)alert(g.toString());
else{g=mckUtils.randomId();var p=[{fileIdExpr:g,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:b.getFilePreviewSize(e.size)}];a.tmpl("fileboxTemplate",p).appendTo("#mck-file-box");var F=a(".mck-file-box."+g),N=a(".mck-file-box."+g+" .mck-file-lb"),Y=a(".mck-file-box."+g+" .progress .bar"),E=a(".mck-file-box."+g+" .progress"),K=a(".mck-file-box."+g+" .mck-remove-file");Y.css("width","0%");E.removeClass("n-vis").addClass("vis");K.attr("disabled",
!0);t.attr("disabled",!0);f.removeClass("n-vis").addClass("vis");if(c.name===a(".mck-file-box."+g+" .mck-file-lb a").html()){var A=z.data("mck-id");da[c.name+e.size]=A;h.attr("disabled",!0);c=[];c.push(e);var L=new XMLHttpRequest;(L.upload||L).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);Y.css("width",a+"%")});L.addEventListener("load",function(c){c=a.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var e=b.getFilePreviewPath(c),f=c.name,g=
c.size,p=z.data("mck-id");f+=g;g=da[f];if(A!==p)m.updateDraftMessage(g,c),delete da[f];else return K.attr("disabled",!1),t.attr("disabled",!1),h.attr("disabled",!1),delete da[f],N.html(e),E.removeClass("vis").addClass("n-vis"),a(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),n.removeAttr("required"),I.push(c),F.data("mckfile",c),t.children("input").val(""),!1}else K.attr("disabled",!1),h.attr("disabled",!1),K.trigger("click")});a.ajax({type:"GET",url:O+"/rest/ws/aws/file/url",global:!1,
data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=new FormData;b.append("files[]",e);L.open("POST",a,!0);L.send(b)},error:function(){}})}return!1}};b.uploadFile=function(c){var e=c.file,g=[];if("undefined"!==typeof e)if(4<a(".mck-file-box").length&&g.push("Can't upload more than 5 files at a time"),e.size>1048576*ea&&g.push("file size can not be more than "+ea+" MB"),0<g.length)alert(g.toString());else{g=mckUtils.randomId();var p=[{fileIdExpr:g,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+
c.name+"\x3c/a\x3e",fileSizeExpr:b.getFilePreviewSize(e.size)}];a.tmpl("fileboxTemplate",p).appendTo("#mck-file-box");var F=a(".mck-file-box."+g),N=a(".mck-file-box."+g+" .mck-file-lb"),Y=a(".mck-file-box."+g+" .progress .bar"),E=a(".mck-file-box."+g+" .progress"),K=a(".mck-file-box."+g+" .mck-remove-file");Y.css("width","0%");E.removeClass("n-vis").addClass("vis");K.attr("disabled",!0);t.attr("disabled",!0);f.removeClass("n-vis").addClass("vis");if(c.name===a(".mck-file-box."+g+" .mck-file-lb a").html()){var A=
z.data("mck-id");da[c.name+e.size]=A;h.attr("disabled",!0);c=[];c.push(e);var L=new XMLHttpRequest;(L.upload||L).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);Y.css("width",a+"%")});L.addEventListener("load",function(c){c=a.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var e=b.getFilePreviewPath(c),f=c.name,g=c.size,p=z.data("mck-id");f+=g;g=da[f];if(A!==p)m.updateDraftMessage(g,c),delete da[f];else return K.attr("disabled",!1),t.attr("disabled",
!1),h.attr("disabled",!1),delete da[f],N.html(e),E.removeClass("vis").addClass("n-vis"),a(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),n.removeAttr("required"),I.push(c),F.data("mckfile",c),t.children("input").val(""),!1}else K.attr("disabled",!1),h.attr("disabled",!1),K.trigger("click")});a.ajax({type:"GET",url:O+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=new FormData;b.append("files[]",e);L.open("POST",a,!0);
L.send(b)},error:function(){}})}return!1}};b.uploadAttachment2AWS=function(c){var e=c.file,g=new FormData,p=[];if("undefined"!==typeof e)if(4<a(".mck-file-box").length&&p.push("Can't upload more than 5 files at a time"),e.size>1048576*ea&&p.push("file size can not be more than "+ea+" MB"),0<p.length)alert(p.toString());else{p=mckUtils.randomId();var F=[{fileIdExpr:p,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:b.getFilePreviewSize(e.size)}];
a.tmpl("fileboxTemplate",F).appendTo("#mck-file-box");var N=a(".mck-file-box."+p),K=a(".mck-file-box."+p+" .mck-file-lb"),E=a(".mck-file-box."+p+" .progress .bar"),Y=a(".mck-file-box."+p+" .progress"),A=a(".mck-file-box."+p+" .mck-remove-file");E.css("width","0%");Y.removeClass("n-vis").addClass("vis");A.attr("disabled",!0);t.attr("disabled",!0);f.removeClass("n-vis").addClass("vis");if(c.name===a(".mck-file-box."+p+" .mck-file-lb a").html()){var L=z.data("mck-id");da[c.name+e.size]=L;h.attr("disabled",
!0);g.append("file",e);c=new XMLHttpRequest;(c.upload||c).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);E.css("width",a+"%")});c.addEventListener("load",function(b){b=a.parseJSON(this.responseText);if("object"===typeof b){var c="object"===typeof b?'\x3ca href\x3d"'+b.url+'" target\x3d"_blank"\x3e'+b.name+"\x3c/a\x3e":"",e=b.name,f=b.size,g=z.data("mck-id");e+=f;f=da[e];if(L!==g)m.updateDraftMessage(f,b),delete da[e];else return A.attr("disabled",!1),t.attr("disabled",
!1),h.attr("disabled",!1),delete da[e],K.html(c),Y.removeClass("vis").addClass("n-vis"),a(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),n.removeAttr("required"),I.push(b),N.data("mckfile",b),t.children("input").val(""),!1}else A.attr("disabled",!1),h.attr("disabled",!1),A.trigger("click")});c.open("post",MCK_BASE_URL+"/rest/ws/upload/image",!0);c.setRequestHeader("UserId-Enabled",!0);c.setRequestHeader("Authorization","Basic "+w);c.setRequestHeader("Application-Key",S);c.setRequestHeader("Device-Key",
oa);ra&&c.setRequestHeader("Access-Token",ra);c.send(g)}return!1}};b.uplaodFileToAWS=function(a,b){var e=new FormData,f=[];"undefined"!==typeof a&&(-1===a.type.indexOf("image")&&f.push("Please upload image file."),0<f.length?alert(f.toString()):(g.attr("disabled",!0),c[0]===b?(C.find(".mck-overlay-box").removeClass("n-vis"),C.removeClass("mck-hover-on"),G.removeClass("n-vis").addClass("vis")):(x.find(".mck-overlay-box").removeClass("n-vis"),x.removeClass("mck-hover-on"),y.removeClass("n-vis").addClass("vis")),
f=new XMLHttpRequest,f.addEventListener("load",function(a){if(a=this.responseText)c[0]===b?(L.html('\x3cimg src\x3d"'+a+'"/\x3e'),L.data("iconurl",a),N.html(MCK_LABELS["change.group.icon"]),G.removeClass("vis").addClass("n-vis"),C.addClass("mck-hover-on")):(F.html('\x3cimg src\x3d"'+a+'"/\x3e'),F.data("iconurl",a),y.removeClass("vis").addClass("n-vis"),x.addClass("mck-hover-on"),setTimeout(function(){v.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){V.addClass("n-vis")},1500);g.attr("disabled",
!1);c[0]===b?A.val(""):P.val("");return!1}),e.append("file",a),f.open("post",MCK_BASE_URL+"/rest/ws/upload/file",!0),f.setRequestHeader("UserId-Enabled",!0),f.setRequestHeader("Authorization","Basic "+w),f.setRequestHeader("Application-Key",S),f.setRequestHeader("Device-Key",oa),ra&&f.setRequestHeader("Access-Token",ra),f.send(e)))};b.deleteFileMeta=function(a){mckUtils.ajax({url:O+"/rest/ws/aws/file/delete?key\x3d"+a,type:"post",success:function(){},error:function(){}})};b.getFilePreviewPath=function(a){return"object"===
typeof a?'\x3ca href\x3d"'+O+"/rest/ws/aws/file"+a.blobKey+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":""};b.getFilePreviewSize=function(a){return a?1048576<a?"("+parseInt(a/1048576)+" MB)":1024<a?"("+parseInt(a/1024)+" KB)":"("+parseInt(a)+" B)":""};b.addFileBox=function(b){var c=mckUtils.randomId(),e="";"object"===typeof b.fileMeta&&(c=b.fileMeta.createdAtTime,e=b.fileMeta.name);a.tmpl("fileboxTemplate",[{fileNameExpr:b.filelb,fileSizeExpr:b.filesize,fileIdExpr:c,fileName:e}]).appendTo("#mck-file-box");
c=a(".mck-file-box."+c);e=c.find(".mck-remove-file");var f=c.find(".progress");"object"===typeof b.fileMeta?(c.data("mckblob",b.fileMeta.blobKey),n.removeAttr("required"),h.attr("disabled",!1),e.attr("disabled",!1),f.removeClass("vis").addClass("n-vis"),I.push(b.fileMeta)):(h.attr("disabled",!0),e.attr("disabled",!0),f.removeClass("n-vis").addClass("vis"))}},m=new function(){var b=this,f="",g=a("#mck-search"),n=a("#mck-msg-to"),h=a(".mck-file-lb"),w=a(".mck-file-sz"),E=a("#mck-sidebox"),V=a("#mck-file-box"),
v=a("#mck-msg-sbmt"),A=a("#mck-msg-form"),P=a("#mck-text-box"),y=a("#mck-msg-error");a("#mck-show-more");var Da=a("#mck-tab-title"),Wa=a("#mck-tab-status"),S=a("#mck-message-cell"),J=a(".mck-typing-box"),G=a("#mck-no-messages"),F=a("#mck-product-box"),L=a(".mck-product-icon"),N=a(".mck-product-title"),Y=a(".mck-product-subtitle"),ja=a("#mck-product-box .mck-caret"),Jb=a(".mck-product-rt-up .mck-product-key"),M=a("#mck-contact-search-input-box"),da=a(".mck-product-rt-up .mck-product-value"),ia=a(".mck-product-rt-down .mck-product-key"),
fa=a(".mck-product-rt-down .mck-product-value");a("#li-mck-group-info");a("#li-mck-leave-group");var Ma=a("#mck-group-info-tab"),xa=a("#mck-group-search-tab"),ua=a("#mck-no-search-groups"),hb=a("#mck-group-create-tab"),qa=a("#mck-group-search-list");a("#mck-group-search-tabview");var W=a(".mck-group-menu-options"),va=a(".mck-videocall-btn"),oa=a("#mck-group-search-input"),ra=a("#mck-group-search-input-box"),na=a("#mck-contact-search-list"),R=a("#mck-contacts-content"),ea=a("#mck-contact-search-tab");
a("#mck-contact-search-tabview");var wa=a("#mck-contact-search-input");a("#mck-search-list");var Aa=a("#mck-no-search-contacts"),Ka=a("#mck-search-tab-box li a"),Ba=a("#mck-search-tabview-box"),ka=a("#mck-sidebox-search"),Lb=a("#mck-contact-loading"),tc=a("#mck-typing-label"),u=a("#mck-price-widget"),Ia=a("#mck-msg-response"),Ea=a("#mck_response_text"),Fa=a("#li-mck-block-user"),Ja=a("#li-mck-video-call"),Xa=a("#mck-search-loading"),ec=a("#mck-tab-individual"),fc=a("#mck-attachfile-box"),k=a("#mck-attachmenu-box"),
q=a("#mck-sidebox-content"),Q=a("#mck-tab-option-panel"),D=a("#mck-tab-conversation"),ma=a("#mck-conversation-header"),ib=a("#mck-no-conversations"),ab=a("#mck-conversation-list"),bb=a(".mck-tab-message-option"),jb=a(".mck-box-ft .mck-box-form"),gc=a("#mck-btn-clear-messages"),Mb=a("#mck-offline-message-box"),B=a("#mck-message-cell .mck-message-inner");a("#mck-msg-new");var Nb=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);a.template("convTemplate",
'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');a.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}" data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d "move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${nameTextExpr} ${showNameExpr}"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}" data-filename\x3d"${fileNameExpr}" data-fileurl\x3d "${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box-rich-text-container ${kmRichTextMarkupVisibility} ${containerType}" \x3e{{html kmRichTextMarkup}}\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward ${msgForwardVisibleExpr}"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
a.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.openConversation=function(){"none"===E.css("display")&&(a(".mckModal").mckModal("hide"),E.mckModal());n.focus()};b.initEmojis=function(){try{a("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(l){f||(f=setTimeout(function(){b.initEmojis()},3E4))}};b.loadTab=function(l,e){var r=B.data("mck-id");if(r)if(1<P.html().length||V.hasClass("vis")){var f={text:P.html(),files:[]};V.hasClass("vis")&&a(".mck-file-box").each(function(){var b=a(this),l={filelb:b.find(".mck-file-lb").html(),
filesize:b.find(".mck-file-sz").html()};b=b.data("mckfile");"object"===typeof b&&(l.fileMeta=b);f.files.push(l)});Qa[r]=f}else delete Qa[r];Ga=!0;b.clearMessageField(!1);b.addDraftMessage(l.tabId);y.html("");y.removeClass("vis").addClass("n-vis");Ea.html("");Ia.removeClass("vis").addClass("n-vis");A[0].reset();A.removeClass("n-vis").addClass("vis");B.html("");y.removeClass("mck-no-mb");R.removeClass("n-vis").addClass("vis");jb.removeClass("vis").addClass("n-vis");ka.removeClass("vis").addClass("n-vis");
Ma.removeClass("vis").addClass("n-vis");hb.removeClass("vis").addClass("n-vis");q.removeClass("n-vis").addClass("vis");F.removeClass("vis").addClass("n-vis");ma.addClass("n-vis");Lb.removeClass("vis").addClass("n-vis");B.removeClass("mck-group-inner");Wa.removeClass("vis").addClass("n-vis");Da.removeClass("mck-tab-title-w-status");Da.removeClass("mck-tab-title-w-typing");J.removeClass("vis").addClass("n-vis");tc.html(MCK_LABELS.typing);B.data("isgroup",l.isGroup);B.data("datetime","");if(l.tabId)n.val(l.tabId),
B.data("mck-id",l.tabId),B.data("mck-conversationid",l.conversationId),B.data("mck-topicid",l.topicId),Q.data("tabId",l.tabId),Q.removeClass("n-vis").addClass("vis"),R.removeClass("vis").addClass("n-vis"),jb.removeClass("n-vis").addClass("vis"),gc.removeClass("n-vis").addClass("vis"),W.removeClass("vis").addClass("n-vis"),l.isGroup?(B.addClass("mck-group-inner"),Fa.removeClass("vis").addClass("n-vis"),Ja.removeClass("vis").addClass("n-vis"),va.removeClass("vis").addClass("n-vis")):(Fa.removeClass("n-vis").addClass("vis"),
Ja.removeClass("n-vis").addClass("vis"),Oa&&va.removeClass("n-vis").addClass("vis")),!l.topicId&&l.conversationId&&(r=U[l.conversationId],"object"===typeof r&&(l.topicId=r.topicId)),l.topicId&&(r=T[l.topicId],"object"===typeof r&&(Ca?(B.data("mck-title",r.title),ma.html(r.title),ma.removeClass("n-vis")):Pa&&(b.setProductProperties(r,l.topicId),ja.addClass("n-vis"),F.addClass("mck-product-box-wc"),ab.addClass("n-vis"),F.removeClass("n-vis").addClass("vis")))),db&&c.google&&"object"===typeof c.google.maps?
(fc.removeClass("vis").addClass("n-vis"),k.removeClass("n-vis").addClass("vis")):(k.removeClass("vis").addClass("n-vis"),fc.removeClass("n-vis").addClass("vis")),r=b.getTabDisplayName(l.tabId,l.isGroup,l.userName),b.isGroupDeleted(l.tabId,l.isGroup)&&(y.html(MCK_LABELS["group.deleted"]),y.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),A.removeClass("vis").addClass("n-vis")),Da.html(r),Da.attr("title",r),D.removeClass("vis").addClass("n-vis"),Ba.removeClass("vis").addClass("n-vis"),ec.removeClass("n-vis").addClass("vis"),
"support"===tb&&a(".mck-tab-link").removeClass("vis").addClass("n-vis"),Db&&(u.removeClass("n-vis").addClass("vis"),B.addClass("mck-msg-w-panel")),fb&&(y.html("Deactivated"),y.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),A.removeClass("vis").addClass("n-vis")),aa.subscibeToTypingChannel(l.tabId,l.isGroup),"function"===typeof Ab&&Ab({tabId:l.tabId,isGroup:l.isGroup});else if(l.tabId="",gb&&m.hideOfflineMessage(),ec.removeClass("vis").addClass("n-vis"),D.removeClass("n-vis").addClass("vis"),
Ba.removeClass("n-vis").addClass("vis"),F.removeClass("vis").addClass("n-vis"),B.data("mck-id",""),B.data("mck-conversationid",""),B.data("mck-topicid",""),u.removeClass("vis").addClass("n-vis"),B.removeClass("mck-msg-w-panel"),Q.removeClass("vis").addClass("n-vis"),gc.removeClass("vis").addClass("n-vis"),n.val(""),r=C.getLatestMessageArray(),aa.unsubscibeToTypingChannel(),null!==r&&0<r.length){l.isReload=!0;m.addContactsFromMessageList({message:r},l);b.openConversation();Ga=!1;return}x.loadMessageList(l,
e);b.openConversation()};b.setProductProperties=function(a,c){N.html(a.title);L.html(b.getTopicLink(a.link));Y.html(a.subtitle?a.subtitle:"");var l=a.value1?":"+a.value1:"";Jb.html(a.key1?a.key1:"");da.html(l);l=a.value2?":"+a.value2:"";ia.html(a.key2?a.key2:"");fa.html(l);"function"===typeof xb&&(a.topicId=c,xb(a))};b.getTopicLink=function(a){return a?'\x3cimg src\x3d"'+a+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};b.processMessageList=function(l,c,e){var k=B.children("div[name\x3d'message']:first"),
r=B.data("mck-id"),q=B.data("isgroup")?mckGroupUtils.getGroup(r):m.fetchContact(r);if("undefined"===typeof l.message.length){r=[];r.push(l.message);C.updateMckMessageArray(r);b.addMessage(l.message,q,!1,!1,e);var f=l.createdAtTime}else C.updateMckMessageArray(l.message),a.each(l.message,function(a,l){"undefined"!==typeof l.to&&(b.addMessage(l,q,!1,!1,e),f=l.createdAtTime)});Q.data("datetime",f);!c&&0<k.length?B.scrollTop(k.offset().top-B.offset().top+B.scrollTop()):c&&B.animate({scrollTop:B.prop("scrollHeight")},
"fast")};b.closeConversation=function(a){var b;if("function"===typeof zb){var l=zb();"object"===typeof l&&(b="BUSY_WITH_OTHER"===a?l.onBusyWithOtherUser:l.onConversationClose)}b||(b="Chat disabled with user");y.html(b);y.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");A.removeClass("vis").addClass("n-vis")};b.addTooltip=function(b){a("."+b+" .mck-icon-time").attr("title","pending");a("."+b+" .mck-btn-trash").attr("title","delete");a("."+b+" .mck-icon-sent").attr("title","sent");a("."+b+
" .mck-btn-forward").attr("title","forward message");a("."+b+" .mck-icon-delivered").attr("title","delivered");a("."+b+" .mck-icon-read").attr("title","delivered and read");a("."+b+" .msgtype-outbox-cr").attr("title","sent via Carrier");a("."+b+" .msgtype-outbox-mck").attr("title","sent");a("."+b+" .msgtype-inbox-cr").attr("title","received via Carrier");a("."+b+" .msgtype-inbox-mck").attr("title","recieved")};b.fetchContact=function(a){var l=b.getContact(a);"undefined"===typeof l&&(l=b.createContact(a));
return l};b.getContact=function(a){if("object"===typeof Na[a])return Na[a]};b.getContactDisplayName=function(a){if("string"===typeof ta[a])return ta[a];if("undefined"===typeof ta[a]){var b=ha[a];if("undefined"!==typeof b)return b.displayName;b=[];b.push(a);X.getUsersDetail(b,{async:!1});b=ca.getUserDetail(a);if("undefined"!==typeof b)return b.displayName}};b.sendUserEmail=function(){if(1<document.getElementById("input-for-email").value.length){var b=document.getElementById("input-for-email").value;
X.updateUser({data:{email:b},success:function(b){console.log("email updated successfully !");a("#input-for-email").after("\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cspan\x3eEmail Sent\x3c/span\x3e\x3c/div\x3e");a("#input-for-email").remove();a("#send-email-button").remove()},error:function(a){}})}else alert("No email")};b.updateMetadata=function(a,b){a=c.JSON.stringify({key:a,metadata:b});mckUtils.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",global:!1,data:a,contentType:"application/json",
success:function(a){console.log("metadata cleared successfully !")}})};b.addMessage=function(l,k,q,f,Q){var r,g="",h="",p="";var D="vis";var Ra="n-vis",hc="",F="n-vis";if("object"===typeof l.metadata&&"undefined"!==typeof l.metadata.AL_REPLY&&(g=l.metadata.AL_REPLY,h=x.getReplyMessageByKey(g),"undefined"!==typeof h)){if(k.isGroup&&h||!k.isGroup&&"undefined"===typeof h.fileMeta)F="vis";hc=5===h.type?"You":m.getTabDisplayName(h.to,!1);if("object"===typeof h.fileMeta||2===h.contentType)p=b.getImageForReplyMessage(h),
D="n-vis",Ra="vis",F="n-vis"}if(6!==l.type&&7!==l.type&&!(l.metadata&&"HIDDEN"===l.metadata.category||102===l.contentType||l.metadata&&(l.metadata.KM_ASSIGN||l.metadata.KM_STATUS)||10===l.contentType&&l.metadata&&"true"===l.metadata.hide||0<a("#mck-message-cell ."+l.key).length)){G.hasClass("vis")&&G.removeClass("vis").addClass("n-vis");var n="mck-msg-right",N="mck-icon-time";if(0===l.type||4===l.type||6===l.type)n="mck-msg-left";if(4===l.contentType||10===l.contentType||103===l.contentType)n="mck-msg-center";
N=b.getStatusIconName(l);g=l.key;var E="'"+l.deviceKey+"','"+l.to+"','"+l.to+"','"+g+"'",K="",A="",L="",ib="n-vis",u="";X.loadUserProfile(l.to);!l.groupId||4===l.contentType||7===k.type||0!==l.type&&4!==l.type&&6!==l.type||(K=b.getTabDisplayName(l.to,!1),ib="vis",L=b.getNameTextClassByAlphabet(K));if(Tb){u="mck-msg-avator-bubble";var w="",ja=K;"mck-msg-right"===n?(w=m.fetchContact(z),ja=b.getTabDisplayName(w.displayName,!1)):"mck-msg-left"===n&&(w=l.groupId?m.fetchContact(l.to):k);w&&(A=b.getContactImageLink(w,
ja))}l.groupId&&10===l.contentType&&(L=A=K="");w="n-vis";var ic=ja="",P=l.message;"object"===typeof l.fileMeta&&(ja=l.fileMeta.name,ic=l.fileMeta.size);"object"===typeof l.fileMeta&&(l.fileMeta.contentType.indexOf("audio")||l.fileMeta.contentType.indexOf("image")||l.fileMeta.contentType.indexOf("video"))&&(w="vis");var Y="n-vis";lb&&c.MCK_OL_MAP[l.to]&&10!==l.contentType&&(Y="vis");k=Kommunicate.isRichTextMessage(l.metadata);p=[{msgReply:h?h.message+"\n":"",msgReplyTo:h?hc+"\n":"",msgReplyDivExpr:h?
"vis":"n-vis",msgReplyToVisibleExpr:F,msgPreview:p?b.getImageForReplyMessage(h):"",msgpreviewvisExpr:Ra,textreplyVisExpr:D,msgKeyExpr:l.key,msgDeliveredExpr:l.delivered,msgSentExpr:l.sent,msgCreatedAtTime:l.createdAtTime,msgTypeExpr:l.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"kommunicate"==window.applozic.PRODUCT_ID?"n-vis":"vis",msgSourceExpr:l.source,statusIconExpr:N,contactExpr:"vis",toExpr:l.to,msgAvatorClassExpr:u,
showNameExpr:ib,msgNameExpr:K,msgImgExpr:A,nameTextExpr:L,msgFloatExpr:n,replyIdExpr:g,createdAtTimeExpr:mckDateUtils.getDate(l.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:E,downloadMediaUrlExpr:b.getFileAttachment(l),msgClassExpr:"",msgExpr:P,selfDestructTimeExpr:l.timeToLive,fileMetaKeyExpr:l.fileMetaKey,downloadIconVisibleExpr:w,fileExpr:b.getFilePath(l),fileUrlExpr:b.getFileurl(l),fileNameExpr:ja,fileSizeExpr:ic,contOlExpr:Y,kmRichTextMarkupVisibility:k?"vis":"n-vis",kmRichTextMarkup:k?
Kommunicate.getRichTextMessageTemplate(l.metadata):"",containerType:Kommunicate.getConatainerTypeForRichMessage(l.metadata)}];q?a.tmpl("messageTemplate",p).appendTo("#mck-message-cell .mck-message-inner"):a.tmpl("messageTemplate",p).prependTo("#mck-message-cell .mck-message-inner");if(23===l.contentType){if("BUTTON"===l.metadata.msg_type){D=[];if(l.metadata.payload){if(D=a.parseJSON(l.metadata.payload),D[0].hidden||(r="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+
D[0].title+"\x3c/button\x3e\x3c/div\x3e"),1<D.length)for(p=1;p<D.length;p++)D[p].hidden||(r+="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+D[p].title+"\x3c/button\x3e\x3c/div\x3e")}else console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d BUTTON"),r="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3eButton\x3c/button\x3e\x3c/div\x3e";
a("div[data-msgkey\x3d'"+l.key+"'] .blk-lg-12").after(r)}"INPUT"===l.metadata.msg_type&&"false"===l.metadata.hidden&&(console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d INPUT"),r="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput id\x3d'input-for-email' type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e\x3cbutton id\x3d'send-email-button' style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3eSubmit\x3c/button\x3e\x3c/div\x3e",
a("div[data-msgkey\x3d'"+l.key+"'] .blk-lg-12").after(r),a("#send-email-button").click(function(){1<document.getElementById("input-for-email").value.length&&(b.sendUserEmail(),b.updateMetadata(l.key,{hidden:"true"}))}));if("LIST"===l.metadata.msg_type&&(D=[],l.metadata.payload)){D=a.parseJSON(l.metadata.payload);console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d LIST");r="";D[0].hidden||("button"===D[0].type.toLowerCase()?r="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+
D[0].title+"\x3c/button\x3e\x3c/div\x3e":"input"===D[0].type.toLowerCase()&&(r="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e"+("\x3cbutton style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3e"+D[0].title+"\x3c/button\x3e\x3c/div\x3e")));if(1<D.length)for(p=1;p<D.length;p++)D[p].hidden||("button"===D[p].type.toLowerCase()?
r+="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+D[p].title+"\x3c/button\x3e\x3c/div\x3e":"input"===D[p].type.toLowerCase()&&(r+="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e",r+="\x3cbutton style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3e"+
D[p].title+"\x3c/button\x3e\x3c/div\x3e"));a("div[data-msgkey\x3d'"+l.key+"'] .blk-lg-12").after(r)}}r="";l.message&&(r=l.message.replace(/\n/g,"\x3cbr/\x3e"),null!==c.emoji&&"undefined"!==typeof c.emoji&&(r=c.emoji.replace_unified(r),r=c.emoji.replace_colons(r)));l.conversationId&&(p=U[l.conversationId],"object"!==typeof p&&x.getTopicId({conversationId:l.conversationId}),q&&(B.data("mck-conversationid",l.conversationId),p&&(D=T[p.topicId],"object"===typeof D&&(Pa?b.setProductProperties(D,p.topicId):
Ca&&ma.html(D.title)))));4===l.contentType&&(p=r,r="Final agreed price: "+r,Db||(r+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+p+'" data-mck-conversationid\x3d"'+l.conversationId+'"\x3eAccept\x3c/button\x3e'));D=a("."+g+" .mck-msg-content");if(-1===r.indexOf("emoji-inner")&&0===l.contentType)for(Ra=r.split("\x3cbr/\x3e"),p=0;p<Ra.length;p++)""===Ra[p]?r=e.createElement("BR"):(r=e.createElement("div"),r.appendChild(e.createTextNode(Ra[p])),Ra[p]&&Ra[p].match(Nb)&&(r=a(r).linkify({target:"_blank"}))),
D.append(r);else D.html(r),D.linkify({target:"_blank"});k&&Kommunicate.richMsgEventHandler.initializeSlick(a("div[data-msgkey\x3d'"+l.key+"'] .km-div-slider"));l.fileMeta&&(a("."+g+" .mck-file-text a:first").trigger("click"),a("."+g+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===D.html()&&D.removeClass("vis").addClass("n-vis"));2===l.contentType&&(D.removeClass("vis").addClass("n-vis"),a("."+g+" .mck-file-text").removeClass("n-vis").addClass("vis"));f&&B.animate({scrollTop:B.prop("scrollHeight")},
"fast");bb.hasClass("n-vis")&&(l.groupId?6!==mckGroupUtils.getGroup(l.groupId).type&&bb.removeClass("n-vis").addClass("vis"):bb.removeClass("n-vis").addClass("vis"));b.addTooltip(l.key);4!==l.contentType&&10!==l.contentType&&Q&&b.messageContextMenu(l.key);l.groupId&&10===l.contentType&&q&&mckGroupService.getGroupFeed({groupId:l.groupId,isReloadTab:!0,apzCallback:t.onGroupFeed})}};b.addContactForSearchList=function(l,e){var k=l.userCount,r=l.isGroup,q=b.getTabDisplayName(l.contactId,r),f=b.getContactImageLink(l,
q),Q=r?"gs-group-"+l.htmlId:"cs-user-"+l.htmlId,h="",g=r&&Fb;a("#li-"+Q+" .mck-group-count-text").html(k);r||pa[l.contactId]||(c.MCK_OL_MAP[l.contactId]?h=MCK_LABELS.online:Z[l.contactId]&&(h=mckDateUtils.getLastSeenAtStatus(Z[l.contactId])));a.tmpl("searchContactbox",[{contHtmlExpr:Q,contIdExpr:l.contactId,contTabExpr:l.isGroup,contImgExpr:f,contLastSeenExpr:h,contNameExpr:q,groupUserCountExpr:l.userCount,displayGroupUserCountExpr:g?"vis":"n-vis"}]).prependTo("#"+e)};b.getFileurl=function(a){return"object"===
typeof a.fileMeta?O+"/rest/ws/aws/file/"+a.fileMeta.blobKey:""};b.getFilePath=function(b){if(2===b.contentType)try{var c=a.parseJSON(b.message);if(c.lat&&c.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+c.lat+","+c.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+c.lat+","+c.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+c.lat+","+c.lon+"\x26key\x3d"+Qb+'"/\x3e\x3c/a\x3e'}catch(Ra){if(-1!==
b.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+b.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+b.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.message+"\x26key\x3d"+Qb+'" /\x3e\x3c/a\x3e'}return"object"===typeof b.fileMeta?-1!==b.fileMeta.contentType.indexOf("image")?-1!==b.fileMeta.contentType.indexOf("svg")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
b.fileMeta.contentType+'" data-url\x3d"'+O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" data-name\x3d"'+b.fileMeta.name+'"\x3e\x3cimg src\x3d"'+O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':5===b.contentType?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+b.fileMeta.contentType+'" data-url\x3d"'+b.fileMeta.blobKey+'" data-name\x3d"'+b.fileMeta.name+'"\x3e\x3cimg src\x3d"'+b.fileMeta.blobKey+
'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+b.fileMeta.contentType+'" data-url\x3d"'+O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" data-name\x3d"'+b.fileMeta.name+'"\x3e\x3cimg src\x3d"'+b.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':-1!==b.fileMeta.contentType.indexOf("video")?'\x3ca href\x3d "#" target\x3d"_self"  \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+
O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3ca href\x3d"#" target\x3d"_self" \x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':
'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e':""};b.getImageForMessagePreview=function(b){if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")?'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" class\x3d"mck-image-reply move-right"/\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===b.contentType)return b=a.parseJSON(b.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
b.lat+","+b.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.lat+","+b.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};b.getImageForReplyMessage=function(b){var c=m.getTabDisplayName(b.to,!1);if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+c+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+
O+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+c+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(b.fileMeta.size)+
"\x3c/span\x3e\x3c/span\x3e":'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+c+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===b.contentType)return b=a.parseJSON(b.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+
c+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+b.lat+","+b.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.lat+","+b.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};b.getFileAttachment=function(a){if("object"===typeof a.fileMeta)return-1!==
a.fileMeta.contentType.indexOf("image")||-1!==a.fileMeta.contentType.indexOf("audio")||a.fileMeta.contentType.indexOf("video"),'\x3ca href\x3d"'+O+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(a.fileMeta.size)+
"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e"};b.getFileIcon=function(a){return a.fileMetaKey&&"object"===typeof a.fileMeta?-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eImage\x3c/span\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eAudio\x3c/span\x3e':-1!==a.fileMeta.contentType.indexOf("video")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eVideo\x3c/span\x3e':
'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eFile\x3c/span\x3e':""};b.getContactFromGroupOfTwo=function(a){for(var b=0;b<a.members.length;b++)if(z!==""+a.members[b])return m.fetchContact(""+a.members[b])};b.getImageUrlForGroupType=function(a,c){return a.imageUrl?'\x3cimg src\x3d"'+a.imageUrl+'"/\x3e':b.getContactImageByAlphabet(c)};b.getContactImageLink=function(a,c){var l="";if(a.members&&10==a.type)l=b.getImageUrlForGroupType(a,c);else if(a.isGroup&&7!==a.type)l=
t.getGroupImage(a.imageUrl);else{a.isGroup&&7===a.type&&1<a.members.length&&(a=b.getContactFromGroupOfTwo(a));if("function"===typeof $a){var e=$a(a.contactId);e&&"undefined"!==typeof e&&(l='\x3cimg src\x3d"'+e+'"/\x3e')}l||(a.photoSrc?l='\x3cimg src\x3d"'+a.photoSrc+'"/\x3e':a.photoData?l='\x3cimg src\x3d"data:image/jpeg;base64,'+a.photoData+'"/\x3e':a.photoLink?l='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+a.photoLink+'"/\x3e':"bot"==a.contactId?l='\x3cimg src\x3d"https://api.kommunicate.io/img/logo02.svg"/\x3e':
(c||(c=a.displayName),l=b.getContactImageByAlphabet(c)))}return l};b.getContactImageByAlphabet=function(a){if("undefined"===typeof a||""===a)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';a=a.charAt(0);return a.match(/^[a-zA-Z0-9]+$/)?(a=a.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+a+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+a+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};
b.getNameTextClassByAlphabet=function(a){if("undefined"===typeof a||""===a)return"mck-text-user";a=a.toString();a=a.charAt(0);return a.match(/^[a-zA-Z0-9]+$/)?(a=a.toLowerCase(),"mck-text-"+a):"mck-text-user"};b.addContactsFromMessageList=function(c,e){G.removeClass("vis").addClass("n-vis");if("null"===c+"")var l="";else ib.removeClass("vis").addClass("n-vis"),0==B.has(a("#mck-contact-list")).length&&B.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),
"undefined"===typeof c.message.length?(c.message.groupId?b.addGroupFromMessage(c.message):b.addContactsFromMessage(c.message),l=c.message.createdAtTime):a.each(c.message,function(a,c){"undefined"!==typeof c.to&&(c.groupId?b.addGroupFromMessage(c,!0):b.addContactsFromMessage(c,!0),l=c.createdAtTime)}),B.data("datetime",l),e.isReload&&(c="",e.lastActiveTabId&&(e=e.isLastActiveTabGroup?"group-"+e.lastActiveTabId:"user-"+mckContactUtils.formatContactId(e.lastActiveTabId),c=a("#li-"+e)),0<c.length?B.animate({scrollTop:c.offset().top-
B.offset().top+B.scrollTop()},"fast"):B.animate({scrollTop:0},0))};b.addGroupFromMessageList=function(c,e){"null"!==c+""&&(e&&B.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof c.message.length?b.addGroupFromMessage(c.message):a.each(c.message,function(a,c){"undefined"!==typeof c.to&&b.addGroupFromMessage(c,!0)}))};b.createContact=function(a){var c=b.getContactDisplayName(a);"undefined"===typeof c&&(c=a);c={contactId:a,
htmlId:mckContactUtils.formatContactId(a),displayName:c,name:c+" \x3c"+a+"\x3e [Main]",value:a,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return Na[a]=c};b.createContactWithDetail=function(a){var c=a.displayName,l=a.userId;c||(c=b.getContactDisplayName(l));"undefined"===typeof c?c=l:ta[l]=c;var e=a.photoLink?a.photoLink:"";e||(e=a.imageLink?a.imageLink:"");var k=a.imageData?a.imageData:"";a={contactId:l,htmlId:mckContactUtils.formatContactId(l),displayName:c,name:c+" \x3c"+
l+"\x3e [Main]",value:l,photoLink:"",photoSrc:e,photoData:k,email:"",unsaved:!0,isGroup:!1,roleType:a.roleType};return Na[l]=a};b.updateContactDetail=function(a,c){var l=c.displayName,e=c.userId;a.displayName&&a.displayName!==a.contactId||(l||(l=b.getContactDisplayName(e)),"undefined"===typeof l?l=e:ta[e]=l,a.displayName=l);(l=c.photoLink)||(l=c.imageLink?c.imageLink:"");l&&!a.photoSrc&&(a.photoSrc=l);(l=c.imageData?c.imageData:"")&&!a.photoData&&(a.photoData=l);c.roleType&&(a.roleType=c.roleType);
return Na[e]=a};b.addContactsFromMessage=function(a,c){var l=b.getUserIdFromMessage(a);if(0<l.length&&l[0])for(var e=0;e<l.length;e++){var k=b.fetchContact(""+l[e]);b.updateRecentConversationList(k,a,c)}};b.addGroupFromMessage=function(a,c){var l=a.groupId,e=mckGroupUtils.getGroup(""+l);"undefined"===typeof e&&(e=mckGroupUtils.createGroup(l),mckGroupService.loadGroups({apzCallback:t.loadGroups}));b.updateRecentConversationList(e,a,c)};b.updateRecentConversationList=function(c,e,k){0<a("#mck-contact-list #li-"+
(c.isGroup?"group-"+c.htmlId:"user-"+c.htmlId)).length?(a("#mck-contact-list #li-"+c.htmlId+" .mck-cont-msg-wrapper").is(":empty")||k)&&void 0!==e&&b.updateContact(c,e,"mck-contact-list"):b.addContact(c,"mck-contact-list",e)};b.addContactsToSearchList=function(){var c=[],e=[];a.each(Ta,function(a,b){e.push(b.contactId)});var k=e.filter(function(a,b){return e.indexOf(a)===b});k.sort();Xa.removeClass("vis").addClass("n-vis");0<k.length?a.each(k,function(l,e){e&&(l=b.fetchContact(""+e),c.push(l),0===
a("#li-cs-user-"+l.htmlId).length&&b.addContactForSearchList(l,"mck-contact-search-list"))}):Aa.removeClass("n-vis").addClass("vis");b.initAutoSuggest({contactsArray:c,$searchId:wa,isContactSearch:!0})};b.initAutoSuggest=function(c){for(var l=c.contactsArray,e=c.$searchId,k=[],q,f={},Q=[],h=0;h<l.length;h++){var g=l[h];g.displayName=b.getTabDisplayName(g.contactId,g.isGroup);q=g.displayName?a.trim(g.displayName):a.trim(g.contactId);f[q]=g;k.push(q);Q.push(q)}l=function(a){a=f[a];var b=a.displayName.split(" "),
c=b.length,e=b[0],l="",k="";2===c?k=b[1]:3<=c&&(k=b[c-1],l=b[c-2]);b=new RegExp(this.query,"i");return b.test(a.displayName)||b.test(a.contactId)||b.test(l)||b.test(k)||b.test(a.email)||b.test(e+" "+k)};q=function(a){return f[a].displayName};Q=function(a){a=f[a];c.isContactSearch?(m.loadTab({tabId:a.contactId,isGroup:a.isGroup}),jb.removeClass("n-vis").addClass("vis")):t.addGroupMemberFromSearch(a.contactId)};e.hasClass("mck-typeahead")?(e.mcktypeahead().data("mcktypeahead").source=k,e.mcktypeahead().data("mcktypeahead").matcher=
l,e.mcktypeahead().data("mcktypeahead").highlighter=q,e.mcktypeahead().data("mcktypeahead").updater=Q):(e.addClass("mck-typeahead"),e.mcktypeahead({source:k,matcher:l,highlighter:q,updater:Q}))};b.initSearchAutoType=function(){bc&&(wa.keypress(function(a){if(13===a.which){if(a=wa.val())if(a="undefined"!==typeof a&&""!==a?a.toString():"")m.loadTab({tabId:a,isGroup:!1,isSearch:!0}),jb.removeClass("n-vis").addClass("vis");wa.val("")}}),oa.keypress(function(a){if(13===a.which)return!0}),a(e).on("click",
".mck-group-search-link",function(a){a.preventDefault();return!0}),a(e).on("click",".mck-contact-search-link",function(a){a.preventDefault();a=wa.val();""!==a&&(m.loadTab({tabId:a,isGroup:!1,isSearch:!0}),jb.removeClass("n-vis").addClass("vis"));wa.val("")}))};b.removeContact=function(b){a("#li-"+(b.isGroup?"group-"+b.htmlId:"user-"+b.htmlId)).remove()};b.updateContact=function(c,e,k){var l=c.isGroup?"group-"+c.htmlId:"user-"+c.htmlId,q=a("#li-"+l),f=q.data("msg-time");if(e&&e.createdAtTime>f){f=
b.getUnreadCount(e.groupId?"group_"+c.contactId:"user_"+c.contactId);c=b.getMessageTextForContactPreview(e,c,15);a("#li-"+l+" .mck-cont-msg-date").html("undefined"===typeof e.createdAtTime?"":mckDateUtils.getTimeOrDate(e?e.createdAtTime:"",!0));var r=a("#li-"+l+" .mck-cont-msg-wrapper");r.html("");"object"===typeof c?r.append(c):r.html(c);e.conversationId&&(c=e.conversationId,r=U[c],"object"===typeof r&&(r=r.topicId)&&Ca&&(r=T[r],"object"===typeof r&&a("#li-"+l+" .mck-conversation-topic").html(r.title)),
a("#li-"+l+" a").data("mck-conversationid",c));0<f&&(a("#li-"+l+" .mck-unread-count-text").html(f),a("#li-"+l+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));l=a("#"+k+" li:nth-child(1)").data("msg-time");q.data("msg-time",e.createdAtTime);("undefined"===typeof l||(e?e.createdAtTime:"")>=l)&&0!==a("#mck-contact-list li").index(q)&&a("#"+k+" li:nth-child(1)").before(q)}};b.clearContactMessageData=function(b,c){b=mckContactUtils.formatContactId(b);c=c?"group-"+b:"user-"+b;a("#li-"+c+
" .mck-cont-msg-date").html("");a("#li-"+c+" .mck-cont-msg-wrapper").html("")};b.addContact=function(e,k,q){var l=b.getMessageTextForContactPreview(q,e,100),f=e.userCount,r="",Q=!1;if("undefined"!==typeof q){if(q.conversationId){r=q.conversationId;var h=U[r]}q.groupId&&(Q=!0)}var g=b.getTabDisplayName(e.contactId,Q),p=b.getContactImageLink(e,g),D=!1,F=b.getUnreadCount(Q?"group_"+e.contactId:"user_"+e.contactId),n=0<F&&"mck-search-list"!==k?"vis":"n-vis",N="n-vis",ma=Q?"group-"+e.htmlId:"user-"+e.htmlId,
B=Q&&Fb;a("#li-"+ma+" .mck-group-count-text").html(f);a("#li-"+ma+" .mck-group-count-box").removeClass("n-vis").addClass("vis");Q||pa[e.contactId]||Ha[e.contactId]||!lb||!c.MCK_OL_MAP[e.contactId]||(N="vis",D=!0);7===e.type&&1<e.members.length&&(ma=mckGroupUtils.getGroup(q.groupId),ma=m.getContactFromGroupOfTwo(ma),Q&&lb&&c.MCK_OL_MAP[ma.contactId]&&(N="vis",D=!0));f="n-vis";if("object"===typeof h&&Ca&&(h=T[h.topicId],"object"===typeof h)){f="vis";var K=h.title}ma=Q?"group-"+e.htmlId:"user-"+e.htmlId;
e=[{contHtmlExpr:ma,contIdExpr:e.contactId,contTabExpr:Q,msgCreatedAtTimeExpr:q?q.createdAtTime:"",mckLauncherExpr:cb,contImgExpr:p,contOlExpr:N,onlineLabel:MCK_LABELS.online,contUnreadExpr:n,contUnreadCount:F,contNameExpr:g,conversationExpr:r,contHeaderExpr:f,titleExpr:K,groupUserCountExpr:Q?e.userCount:"",displayGroupUserCountExpr:B?"vis":"n-vis",msgCreatedDateExpr:q?mckDateUtils.getTimeOrDate(q.createdAtTime,!0):""}];K=a("#"+k+" li:nth-child(1)").data("msg-time");"undefined"===typeof K||(q?q.createdAtTime:
"")>=K||-1!==k.indexOf("search")&&D?a.tmpl("contactTemplate",e).prependTo("#"+k):a.tmpl("contactTemplate",e).appendTo("#"+k);k=a("#li-"+ma+" .msgTextExpr");"object"===typeof l?k.append(l):k.html(l)};b.addContactsToContactSearchList=function(){Aa.removeClass("vis").addClass("n-vis");ua.removeClass("vis").addClass("n-vis");ea.hasClass("active")||(Ka.removeClass("active"),ea.addClass("active"));qa.removeClass("vis").addClass("n-vis");na.removeClass("n-vis").addClass("vis");ra.removeClass("vis").addClass("n-vis");
M.removeClass("n-vis").addClass("vis");na.html("");R.removeClass("vis").addClass("n-vis");q.removeClass("vis").addClass("n-vis");Ma.removeClass("vis").addClass("n-vis");hb.removeClass("vis").addClass("n-vis");ka.removeClass("n-vis").addClass("vis");Xa.removeClass("n-vis").addClass("vis");0!==Ta.length?m.addContactsToSearchList():Gb?(Xa.removeClass("vis").addClass("n-vis"),Aa.removeClass("n-vis").addClass("vis")):X.loadContacts();wa.focus()};b.addGroupsToGroupSearchList=function(){var c=[],e=[];Aa.removeClass("vis").addClass("n-vis");
ua.removeClass("vis").addClass("n-vis");xa.hasClass("active")||(Ka.removeClass("active"),xa.addClass("active"));na.removeClass("vis").addClass("n-vis");qa.removeClass("n-vis").addClass("vis");M.removeClass("vis").addClass("n-vis");ra.removeClass("n-vis").addClass("vis");qa.html("");R.removeClass("vis").addClass("n-vis");q.removeClass("vis").addClass("n-vis");Ma.removeClass("vis").addClass("n-vis");hb.removeClass("vis").addClass("n-vis");ka.removeClass("n-vis").addClass("vis");Xa.removeClass("n-vis").addClass("vis");
if(0<Sa.length){a.each(Sa,function(a,b){e.push(b.contactId)});var k=e.filter(function(a,b){return e.indexOf(a)===b});k.sort();a.each(k,function(e,k){k&&(e=mckGroupUtils.getGroup(""+k),c.push(e),0===a("#li-gs-group-"+e.htmlId).length&&b.addContactForSearchList(e,"mck-group-search-list"))})}else ua.removeClass("n-vis").addClass("vis");b.initAutoSuggest({contactsArray:c,$searchId:oa,isContactSearch:!0});Xa.removeClass("vis").addClass("n-vis")};b.addConversationMenu=function(b,c){var e=B.data("mck-id");
ab.html("");b===e&&(e=ba[b],"undefined"===typeof e||0===e.length||1===e.length?(ja.addClass("n-vis"),F.addClass("mck-product-box-wc"),ab.addClass("n-vis")):(ab.removeClass("n-vis"),ja.removeClass("n-vis"),F.removeClass("mck-product-box-wc"),a.each(e,function(e,k){0===a("#mck-conversation-list #li-"+k.id).length&&(e="",k.topicDetail&&(e=a.parseJSON(k.topicDetail),e="object"===typeof e?e.title:k.topicDetail),e||(e=k.topicId),a.tmpl("convTemplate",[{convIdExpr:k.id,tabIdExpr:b,isGroupExpr:c,topicIdExpr:k.topicId,
convTitleExpr:e,mckLauncherExpr:cb}]).appendTo(ab))}),2>a("#mck-conversation-list li").length&&(ja.addClass("n-vis"),F.addClass("mck-product-box-wc"),ab.addClass("n-vis"))))};b.loadContacts=function(c){"null"!==c+""&&"undefined"!==typeof c&&"undefined"!==typeof c.contacts&&0!==c.contacts.length&&(Ta.length=0,Ua.length=0,a.each(c.contacts,function(a,c){"undefined"!==typeof c.userId&&(a=b.getContact(""+c.userId),a="undefined"===typeof a?b.createContactWithDetail(c):b.updateContactDetail(a,c),Ta.push(a),
Ua.push(a.contactId))}))};b.getStatusIcon=function(a){return'\x3cspan class\x3d"'+b.getStatusIconName(a)+" move-right "+a.key+'_status status-icon"\x3e\x3c/span\x3e'};b.getStatusIconName=function(a){return 7===a.type||6===a.type||4===a.type||0===a.type?"":5===a.status?"mck-icon-read":4===a.status?"mck-icon-delivered":3===a.type||5===a.type||1===a.type&&(0===a.source||1===a.source)?"mck-icon-sent":""};b.clearMessageField=function(a){P.html("");v.attr("disabled",!1);V.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required",
"").html("");a?P.focus().select():(g.blur(),P.blur())};b.addDraftMessage=function(b){I=[];b&&"object"===typeof Qa[b]?(b=Qa[b],P.html(b.text),0<b.files.length&&(a.each(b.files,function(a,b){la.addFileBox(b)}),h.html(b.filelb),w.html(b.filesize),V.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):I=[]};b.showOfflineMessage=function(){"object"===typeof ya&&ya.innerHTML?(Mb.html(ya.innerHTML),Mb.removeClass("n-vis").addClass("vis")):c.console.log("Offline message innerHTML required.")};
b.hideOfflineMessage=function(){eb.stopOfflineMessageCounter();Mb.removeClass("vis").addClass("n-vis")};b.removeConversationThread=function(b,c){C.clearMckMessageArray();var e=c?mckGroupUtils.getGroup(b):m.getContact(b),k=B.data("mck-id"),l=B.data("isgroup");"undefined"===typeof k||""===k?(b="undefined"!==typeof e?e.htmlId:mckContactUtils.formatContactId(b),a("#li-"+(c?"group-"+b:"user-"+b)).remove()):k===b&&l===c&&(Q.data("datetime",""),G.removeClass("n-vis").addClass("vis"),S.removeClass("n-vis").addClass("vis"),
bb.removeClass("vis").addClass("n-vis"))};b.removedDeletedMessage=function(b,c,e){C.clearMckMessageArray();b=a("."+b);0<b.length?(b.remove(),B.is(":empty")&&(S.removeClass("n-vis").addClass("vis"),bb.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof c&&0<a("#mck-contact-list").length&&x.updateContactList(c,e)};b.getMessageTextForContactPreview=function(a,b,k){var q="";if("undefined"!==typeof a){if(a.message){if("true"===a.metadata.hide||a.metadata&&(a.metadata.KM_ASSIGN||a.metadata.KM_STATUS))return;
if(2===a.contentType)q='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';else{q=a.message;if(mckUtils.startsWith(q,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';null!==c.emoji&&"undefined"!==typeof c.emoji&&(q=c.emoji.replace_unified(q),q=c.emoji.replace_colons(q),q=-1!==q.indexOf("\x3c/span\x3e")?q.substring(0,q.lastIndexOf("\x3c/span\x3e")):q.substring(0,k));b.isGroup||-1!==q.indexOf("emoji-inner")||0!==a.contentType||(k=e.createElement("p"),
k.appendChild(e.createTextNode(q)),q=k)}}else a.fileMetaKey&&"object"===typeof a.fileMeta&&(q=m.getFileIcon(a));b.isGroup&&3!==b.type&&7!==b.type&&(b=a.to.split(",")[0]===z?"Me":m.getTabDisplayName(a.to.split(",")[0],!1),10!==a.contentType&&(q=b+": "+q),-1===q.indexOf("emoji-inner")&&a&&a.message&&0===a.contentType&&(k=e.createElement("p"),k.appendChild(e.createTextNode(q)),q=k))}return q};b.getTextForMessagePreview=function(b,c){var k="";if("undefined"!==typeof b){if(2===b.contentType)k="Shared location";
else if(b.message)if(k=b.message,mckUtils.startsWith(k,"\x3cimg"))k="Image attachment";else{var q=e.createElement("div");q.innerHTML=k;k=a.trim(mckUtils.textVal(q));k=k.substring(0,50)}else b.fileMetaKey&&"object"===typeof b.fileMeta&&(k=-1!==b.fileMeta.contentType.indexOf("image")?"Image attachment":"File attachment");c.isGroup&&3!==c.type&&7!==c.type&&(k=(b.to.split(",")[0]===z?"Me":m.getTabDisplayName(b.to.split(",")[0],!1))+": "+k)}return k};b.getUserIdFromMessage=function(a){a=a.to;a.lastIndexOf(",")===
a.length-1&&(a=a.substring(0,a.length-1));return a.split(",")};b.getUserIdArrayFromMessageList=function(c){var e=[];"undefined"===typeof c.length?e.concat(b.getUserIdFromMessage(c)):a.each(c,function(a,c){"undefined"!==typeof c.to&&(e=e.concat(b.getUserIdFromMessage(c)))});return e};b.messageContextMenu=function(b){var e=a("."+b+" .mck-msg-box");e.addEventListener?e.addEventListener("contextmenu",function(a){a.preventDefault()},!1):e.bind("contextmenu",function(e){e.preventDefault();a(".mck-context-menu").removeClass("vis").addClass("n-vis");
a("."+b+" .mck-context-menu").removeClass("n-vis").addClass("vis");c.event.returnValue=!1})};b.isValidMetaData=function(a){return a.metadata?"HIDDEN"===a.metadata.category||"ARCHIVE"===a.metadata.category||"true"==a.metadata.hide?!1:!0:!0};b.updateDraftMessage=function(b,c){if("object"===typeof c){var e={text:"",files:[]};var k={fileMeta:c,filelb:la.getFilePreviewPath(c),filesize:la.getFilePreviewSize(c.size)};"undefined"!==typeof b&&"object"===typeof Qa[b]&&(e=Qa[b],a.each(e.files,function(a,b){b.filelb===
k.filelb&&e.files.splice(a,1)}));e.files.push(k)}Qa[b]=e};b.updateUnreadCount=function(a,c,e){var k=b.getUnreadCount(a);La[a]=c;if(e||0<za.length)H+=c-k,0>H&&(H=0),0<H?za.html(H):za.html("")};b.incrementUnreadCount=function(a){H+=1;La[a]="undefined"===typeof La[a]?1:La[a]+1;0<za.length&&za.html(H)};b.getUnreadCount=function(a){return"undefined"===typeof La[a]?La[a]=0:La[a]};b.isGroupDeleted=function(a,b){return b?(a=t.getDeletedAtTime(a),"undefined"!==typeof a&&0<a):!1};b.getTabDisplayName=function(a,
c,e){var k="";if(c)return t.getGroupDisplayName(a);"function"===typeof Za&&(k=Za(a));"undefined"!==typeof e&&e&&(k=e,ta[a]=e);k||(k=b.getContactDisplayName(a));c=b.fetchContact(""+a);k?(c.displayName=k,Na[c.contactId]=c):"undefined"!==typeof c.displayName&&(k=c.displayName);k||(k=a);return k};b.populateMessage=function(b,c,e){var k=mckDateUtils.convertMilisIntoTime(c.metadata.CALL_DURATION);X.loadUserProfile(c.to);103==c.contentType&&(4==c.type&&"CALL_REJECTED"==c.metadata.MSG_TYPE?c.message="you rejected a Video call from "+
c.to:5==c.type&&"CALL_REJECTED"==c.metadata.MSG_TYPE?c.message=c.to+"rejected a Video call from you":4==c.type&&"CALL_END"==c.metadata.MSG_TYPE?c.message="you were in a call with "+c.to+"\n call duration : "+k:5==c.type&&"CALL_END"==c.metadata.MSG_TYPE?c.message="you were in a call with "+c.to+"\n call duration : "+k:4==c.type&&"CALL_MISSED"==c.metadata.MSG_TYPE?c.message="you missed a Video call from "+c.to:5==c.type&&"CALL_MISSED"==c.metadata.MSG_TYPE&&(c.message=c.to+"missed a Video call from you"));
var q=B.data("mck-id");var f=m.isValidMetaData(c);k=c.groupId?mckGroupUtils.getGroup(c.groupId):m.getContact(c.to);if("undefined"===typeof q||""===q){var l=a("#mck-contact-list").length;0<l&&f&&(c.groupId?m.addGroupFromMessage(c,!0):m.addContactsFromMessage(c,!0));if("APPLOZIC_01"===b||"MESSAGE_RECEIVED"===b){"undefined"===typeof k&&(k=c.groupId?mckGroupUtils.createGroup(c.groupId):m.createContact(c.to));if(mb){m.loadTab({tabId:k.contactId,isGroup:k.isGroup,conversationId:c.conversationId});return}b=
c.groupId?"group_"+k.contactId:"user_"+k.contactId;f&&(10!==c.contentType&&102!==c.contentType&&m.incrementUnreadCount(b),Va.notifyUser(c));e=c.groupId?"group-"+k.htmlId:"user-"+k.htmlId;a("#li-"+e+" .mck-unread-count-text").html(m.getUnreadCount(b));0<m.getUnreadCount(b)&&a("#li-"+e+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");x.sendDeliveryUpdate(c)}}else if("undefined"===typeof k&&(k=c.groupId?mckGroupUtils.createGroup(c.groupId):m.createContact(c.to)),"APPLOZIC_01"===b||"MESSAGE_RECEIVED"===
b){if("undefined"!==typeof k&&(b=B.data("isgroup"),0===a("."+c.oldKey).length&&0===a("."+c.key).length||10===c.contentType)){if("undefined"===typeof q||q!==k.contactId||b!==k.isGroup||Ma.hasClass("vis")){if(mb){m.loadTab({tabId:k.contactId,isGroup:k.isGroup,conversationId:c.conversationId});return}if(f&&10!==c.contentType||102!==c.contentType)b=c.groupId?"group_"+k.contactId:"user_"+k.contactId,m.incrementUnreadCount(b);x.sendDeliveryUpdate(c)}else{f=!0;b&&6===k.type&&(f=t.isAppendOpenGroupContextMenu(k));
if(c.conversationId&&(Ca||Pa))if((b=B.data("mck-conversationid"))&&b.toString()===c.conversationId.toString())c.metadata&&"HIDDEN"===c.metadata.category||m.addMessage(c,k,!0,!0,f),x.sendReadUpdate(c.pairedMessageKey);else{if(mb){m.loadTab({tabId:k.contactId,isGroup:k.isGroup,conversationId:c.conversationId});return}}else if(7===k.type&&(b=mckGroupUtils.getGroup(c.groupId),b=m.getContactFromGroupOfTwo(b),ca.lastSeenOfGroupOfTwo(b.contactId),m.addMessage(c,k,!0,!0,f)),!c.metadata||"HIDDEN"!==c.metadata.category&&
"true"!==c.metadata.hide&&7!==k.type)m.addMessage(c,k,!0,!0,f),x.sendReadUpdate(c.pairedMessageKey);c.groupId||(a("#mck-tab-status").html(MCK_LABELS.online),ca.updateUserStatus({userId:c.to,status:1}))}e&&6!==k.type&&Va.notifyUser(c)}}else"APPLOZIC_02"===b&&102==!c.contentType&&(0===a("."+c.oldKey).length&&0===a("."+c.key).length||10===c.contentType)&&(0<l?m.addContactsFromMessage(c,!0):"undefined"!==typeof k&&(b=B.data("isgroup"),"undefined"!==typeof q&&q===k.contactId&&b===k.isGroup&&(f=!0,b&&6===
k.type&&(f=t.isAppendOpenGroupContextMenu(k)),c.metadata&&"HIDDEN"===c.metadata.category||m.addMessage(c,k,!0,!0,f),3===c.type&&(a("."+c.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),m.addTooltip(c.key)))));Lb.removeClass("vis").addClass("n-vis")};b.getMessageFeed=function(b){var c={};c.key=b.key;c.timeStamp=b.createdAtTime;c.message=b.message;c.from=4===b.type?b.to:z;c.to=b.groupId?b.groupId:5===b.type?b.to:z;c.status="read";c.type=4===b.type?"inbox":"outbox";
5===b.type&&(3===b.status?c.status="sent":4===b.status&&(c.status="delivered"));if("object"===typeof b.fileMeta){var e=a.extend({},b.fileMeta);if("undefined"===typeof e.url||""===e.url)e.url=O+"/rest/ws/aws/file/"+b.fileMeta.blobKey;delete e.blobKey;c.file=e}c.source=b.source;c.metadata=b.metadata;return c};b.updateUnreadCountonChatIcon=function(b){if(Hb&&0<b.length){var c=null,e=0;0<b.length&&(a.each(b,function(a,b){!(0<b.unreadCount&&null!==c)&&0<b.unreadCount&&(c=b.userId,e=b.unreadCount)}),0<
H&&"none"===E.css("display")&&(null!==c&&e===H?m.loadTab({tabId:c,isGroup:!1}):m.loadTab({tabId:"",isGroup:!1})))}};b.loadMessageListOnUserDetailFetch=function(b){Lb.removeClass("vis").addClass("n-vis");var c=B.data("mck-id"),e=B.data("isgroup");if("undefined"===typeof c||b.tabId===c&&""+e===""+b.isGroup)c=mckGroupUtils.getGroup(b.tabId),t.addGroupStatus(c),e=!0,6===c.type&&(t.validateOpenGroupUser(c),e=t.isAppendOpenGroupContextMenu(c)),b.isMessages?(G.removeClass("vis").addClass("n-vis"),m.processMessageList(b.messageData,
!0,e),6!==c.type&&bb.removeClass("n-vis").addClass("vis"),"function"===typeof Ya&&Ya(b.tabId)):0===a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(bb.removeClass("vis").addClass("n-vis"),G.removeClass("n-vis").addClass("vis"))}},x=new function(){var b=this,f=a("#mck-search"),g=a("#mck-msg-to"),n=a("#mck-msg-new");a("#mck-audio");a("#mck-mike-btn");var h=a("#mck-sidebox"),w=a("#mck-file-box"),E=a("#mck-text-box"),V=a("#mck-msg-form"),v=a("#mck-msg-sbmt"),A=a("#mck-new-group"),
P=a("#mck-tab-title"),y=a("#mck-msg-error"),Da=a("#mck-btn-attach"),Wa=a("#mck-tab-status"),O=a("#mck-message-cell"),H=a(".mck-typing-box"),G=a("#mck-gms-loading"),F=a("#mck-group-title"),L=a("#mck-contact-loading"),N=a("#mck-no-messages"),Y=a(".mck-group-search"),ja=a("#mck-msg-response"),M=a("#mck-msg-form input"),da=a("#mck-block-button"),ia=a("#li-mck-block-user"),fa=a("#li-mck-group-info"),na=a("#li-mck-video-call"),oa=a("#mck_response_text"),ra=a(".mck-contact-search"),ua=a("#mck-group-info-tab"),
R=a("#mck-price-text-box");a("#mck-sidebox-search");var ya=a("#mck-group-info-btn");ua=a("#mck-group-info-tab");var W=a("#mck-btn-group-exit"),va=a("#mck-group-back-link"),la=a("#mck-btn-leave-group"),ea=a(".mck-sidebox-content"),ta=a("#mck-no-more-messages"),Ba=a("#mck-btn-group-create");a("#mck-group-create-tab");var La=a("#mck-group-add-member");a("#mck-contacts-content");var wa=a("#mck-tab-option-panel"),Fa=a("#mck-no-conversations"),Na=a("#mck-group-create-title"),Ia=a(".mck-group-menu-options"),
ka=a(".mck-tab-message-option"),Ja=a(".mck-group-admin-options"),za=a("#mck-group-member-search"),u=a("#mck-message-cell .mck-message-inner");a("#mck-search-cell .mck-message-inner");var Ea=a("#mck-no-more-conversations"),Oa=a("#mck-gm-search-box"),Za=a("#mck-group-member-search-list"),$a=a("#mck-no-gsm-text");a.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');
var Xa,Sa=a("#mck-minutes"),Va=a("#mck-seconds");b.createNewConversation=function(a,b){Kommunicate.startConversation(a,b)};b.loadConversationWithAgents=function(b,c){"kommunicate"==window.applozic.PRODUCT_ID&&la.removeClass("vis").addClass("n-vis");Kommunicate.client.getGroupDetailByType({type:10,startIndex:0,limit:10},function(b,e){b?console.log("error while fetching group detail by type",b):0==e.response.length?x.createNewConversation({groupName:ob,agentId:pb,botIds:qb},function(a){Kommunicate.triggerEvent(KommunicateConstants.EVENT_IDS.WELCOME_MESSAGE,
{groupId:a,applicationId:S});c()}):(1==e.response.length?a.fn.applozic("loadGroupTab",e.response[0].id):a.fn.applozic("loadTab"),c())})};b.timer=function(){var a=0,b=this;Xa=setInterval(function(){++a;Va.html(b.pad(a%60));Sa.html(b.pad(parseInt(a/60)))},1E3);b.pad=function(a){a+="";return 2>a.length?"0"+a:a}};b.stoptimer=function(){Va.html("0");Sa.html("0");clearInterval(Xa)};a(e).on("click",".mck-message-delete",function(){b.deleteMessage(a(this).parents(".mck-m-b").data("msgkey"))});a(e).on("click",
".mck-message-reply",function(){b.replyMessage(a(this).parents(".mck-m-b").data("msgkey"))});a(e).on("click",".mck-message-forward",function(){n.data("forwardMessageKey",a(this).parents(".mck-m-b").data("msgkey"));n.trigger("click")});a(".mck-minimize-icon").click(function(){a(".mck-box-md,.mck-box-ft").animate({height:"toggle"});ea.hasClass("minimized")?(ea.css("height","100%"),ea.removeClass("minimized")):(ea.css("height","0%"),ea.addClass("minimized"))});b.init=function(){C.clearMckMessageArray();
a(e).on("click","."+cb,function(){a(this).hasClass("mck-msg-preview")&&a(this).hide()});m.initSearchAutoType();ra.click(function(){x.createNewConversation({groupName:ob,agentId:pb,botIds:qb},function(a){Kommunicate.triggerEvent(KommunicateConstants.EVENT_IDS.WELCOME_MESSAGE,{groupId:a,applicationId:S})})});Y.click(function(){m.addGroupsToGroupSearchList()});E.keydown(function(a){E.hasClass("mck-text-req")&&E.removeClass("mck-text-req");if(13===a.keyCode&&(a.shiftKey||a.ctrlKey)){if(a.preventDefault(),
c.getSelection){a=c.getSelection();var b=a.getRangeAt(0),k=e.createElement("br"),q=e.createTextNode("\u00a0");b.deleteContents();b.insertNode(k);b.collapse(!1);b.insertNode(q);b.selectNodeContents(q);a.removeAllRanges();a.addRange(b);E.animate({scrollTop:E.prop("scrollHeight")},0);return!1}}else 13===a.keyCode?(a.preventDefault(),1===xa&&aa.sendTypingStatus(0,u.data("mck-id")),v.is(":disabled")&&w.hasClass("vis")?alert("Please wait file is uploading."):V.submit()):0===xa&&aa.sendTypingStatus(1,u.data("mck-id"))});
a(e).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&x.deleteConversation()});a(e).on("click",".applozic-tm-launcher",function(b){b.preventDefault();var c=a(this).data("mck-id");c="undefined"!==typeof c&&""!==c?c.toString():"";var e=a(this).data("mck-name");e="undefined"!==typeof e&&""!==e?e.toString():"";b=a(this).data("mck-supportid");b="undefined"!==typeof b&&""!==b?b.toString():"";var k=a(this).data("mck-topicid");k="undefined"!==typeof k&&""!==k?k.toString():
"";var q=a(this).data("mck-msg");q="undefined"!==typeof q&&""!==q?q.toString():"";if("function"===typeof Aa&&k){var f=Aa(k);"object"===typeof f&&"undefined"!==f.title&&(T[k]=f)}c={topicId:k,tabId:c,userName:e,isMessage:!0};c.messagePxy={type:5,contentType:0,message:q};b?(c.isGroup=!0,c.supportId=b,x.getConversationId(c)):(c.isGroup=!1,m.loadTab(c,x.dispatchMessage))});a(e).on("click",".applozic-wt-launcher",function(b){b.preventDefault();b=a(this).data("mck-id");b="undefined"!==typeof b&&""!==b?b.toString():
"";var c=a(this).data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():"";var e=a(this).data("mck-topicid");e="undefined"!==typeof e&&""!==e?e.toString():"";var k=a(this).data("mck-topic-status");k=k?-1===J.indexOf(k)?J[0]:k.toString():J[0];if("function"===typeof Aa){var q=Aa(e);"object"===typeof q&&"undefined"!==q.title&&(T[e]=q)}x.getConversationId({tabId:b,isGroup:!1,userName:c,topicId:e,topicStatus:k,isMessage:!1})});a(e).on("click",".applozic-ct-launcher",function(b){b.preventDefault();
var c=a(this).data("mck-id");c="undefined"!==typeof c&&""!==c?c.toString():"";var e=a(this).data("mck-name");e="undefined"!==typeof e&&""!==e?e.toString():"";b=a(this).data("mck-topicid");b="undefined"!==typeof b&&""!==b?b.toString():"";var k=a(this).data("mck-topic-status");k=k?-1===J.indexOf(k)?J[0]:k.toString():J[0];c={tabId:c,isGroup:!1,userName:e,topicId:b,topicStatus:k,isMessage:!1};"function"===typeof Eb&&(e=Eb(b),"object"===typeof e&&(e.topicDetail&&"object"===typeof e.topicDetail&&"undefined"!==
e.topicDetail.title&&(T[b]=e.topicDetail),e.fallBackTemplatesList&&0<e.fallBackTemplatesList.length&&(c.fallBackTemplatesList=e.fallBackTemplatesList)));x.getConversationId(c)});a(e).on("click","."+cb+", .mck-contact-list ."+cb,function(c){c.preventDefault();a("#mck-sidebox-launcher").removeClass("vis").addClass("n-vis");c=a(this);var e=this;"false"===jc?a("#km-chat-login-modal").css("display","block"):c.data("mck-id")?c.parents(".mck-search-list").length?(f.bind("blur"),setTimeout(function(){b.openChat(e)},
600)):b.openChat(e):x.loadConversationWithAgents({groupName:ob,agentId:pb,botIds:qb},function(){console.log("conversation created successfully")})});a("#km-form-chat-login").submit(function(b){b=$("#km-submit-chat-login");var c=$("#km-error-chat-login"),e=$("#km-userName").val();$("#km-email").val();b.attr("disabled",!0);b.html("Initiating chat...");c.removeClass("show").addClass("hide");c.html("");a.fn.applozic("reInitialize",{userId:e,appId:S,onInit:k,baseUrl:MCK_BASE_URL,locShare:db,googleApiKey:Sb});
return!1});var k=function(){"kommunicate"===window.applozic.PRODUCT_ID&&la.removeClass("vis").addClass("n-vis");x.loadConversationWithAgents({groupName:ob,agentId:pb,botIds:qb})};a(".km-login-model-close").on("click",function(b){a("#km-chat-login-modal").css("display","none")});a(e).on("click",".mck-conversation-tab-link",function(b){b.preventDefault();a(this);b=u.data("mck-id");var c=u.data("isgroup");KommunicateUI.hideAwayMessage();m.loadTab({tabId:"",isGroup:!1,lastActiveTabId:b,isLastActiveTabGroup:c})});
a(e).on("click",".mck-close-sidebox",function(b){b.preventDefault();h.mckModal("hide");a("#mck-sidebox-launcher").removeClass("n-vis").addClass("vis");b=u.data("mck-conversationid");u.data("mck-id","");u.data("mck-topicid","");u.data("mck-name","");u.data("mck-conversationid","");b&&(b=U[b],"object"===typeof b&&(b=b.topicId,"function"===typeof yb&&yb(z,b)));aa.unsubscibeToTypingChannel()});a(e).on("click",".mck-price-submit",function(a){a.preventDefault();b.sendPriceMessage()});R.keydown(function(a){13===
a.keyCode&&b.sendPriceMessage()});u.bind("scroll",function(){if(0<u.find(".mck-contact-list").length){if(u.scrollTop()+u.innerHeight()>=u[0].scrollHeight){var a=u.data("datetime");0<a&&!Ga&&x.loadMessageList({tabId:"",isGroup:!1,startTime:a})}}else if(0===u.scrollTop()){var b=u.data("mck-id");if("undefined"!==typeof b&&""!==b){var c=u.data("isgroup"),e=u.data("mck-conversationid");e=e?e.toString():"";a=wa.data("datetime");0<a&&!Ga&&x.loadMessageList({tabId:b,isGroup:c,conversationId:e,startTime:a})}}});
R.on("click",function(a){a.preventDefault();R.removeClass("mck-text-req")});da.on("click",function(a){a.preventDefault();a=u.data("mck-id");var b=u.data("isgroup"),c=!u.data("blocked");b?(ia.removeClass("vis").addClass("n-vis"),na.removeClass("vis").addClass("n-vis")):confirm(c?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"])&&X.blockUser(a,c)});la.on("click",function(a){a.preventDefault();a=u.data("mck-id");u.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({apzCallback:t.onGroupLeft,
groupId:a}):Ia.removeClass("vis").addClass("n-vis")});a(e).on("click",".mck-add-to-group",function(b){b.preventDefault();b=a(this).data("mck-id");"undefined"!==typeof b&&t.addGroupMemberFromSearch(b);Oa.mckModal("hide")});a(e).on("click",".mck-btn-remove-member",function(b){b.stopPropagation();b=a(this).parents(".mck-li-group-member").data("mck-id");var c=ua.data("mck-id");if("undefined"!==typeof c&&"undefined"!==typeof b){var e=mckGroupUtils.getGroup(c);"object"===typeof e&&z===e.adminName?confirm(MCK_LABELS["remove.member.alert"])&&
mckGroupService.removeGroupMember({groupId:c,userId:b,apzCallback:t.onRemovedGroupMember}):Ja.removeClass("vis").addClass("n-vis")}});W.on("click",function(a){a.preventDefault();(a=ua.data("mck-id"))?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({groupId:a,apzCallback:t.onGroupLeft}):m.loadTab({tabId:"",isGroup:!1})});ya.on("click",function(a){a.preventDefault();a=u.data("mck-id");if(u.data("isgroup")){a={groupId:a};var b=u.data("mck-conversationid");b&&(a.conversationId=b);
t.loadGroupInfo(a)}else Ia.removeClass("vis").addClass("n-vis")});A.on("click",function(a){a.preventDefault();t.loadCreateGroupTab()});va.on("click",function(a){a.preventDefault();var b=ua.data("mck-id");a=ua.data("mck-conversation-id");b?(b={tabId:b,isGroup:!0},a&&(b.conversationId=a),m.loadTab(b)):m.loadTab({tabId:"",isGroup:!1})});La.on("click",function(b){b.preventDefault();if(b=ua.data("mck-id"))(b=mckGroupUtils.getGroup(b))&&b.adminName===z?(Za.html(""),Oa.mckModal(),G.removeClass("n-vis").addClass("vis"),
0<Ua.length?t.addMembersToGroupSearchList():Gb?0<Ta.length?(a.each(Ta,function(a,b){Ua.push(b.contactId)}),t.addMembersToGroupSearchList()):(G.removeClass("vis").addClass("n-vis"),$a.removeClass("n-vis").addClass("vis")):X.getUserStatus({callback:t.addMembersToGroupSearchList})):Ja.removeClass("vis").addClass("n-vis")});za.keypress(function(a){if(13===a.which)return a=za.val(),""!==a&&t.addGroupMemberFromSearch(a),za.val(""),!0});a(e).on("click",".mck-group-member-search-link",function(a){a.preventDefault();
a=za.val();""!==a&&t.addGroupMemberFromSearch(a);za.val("")});a(e).on("click",".mck-show-more",function(b){b.preventDefault();var c=a(this);b=c.data("tabId");var e=u.data("isgroup"),k=u.data("mck-conversationid");k=k?k.toString():"";c=c.data("datetime");x.loadMessageList({tabId:b,isGroup:e,conversationId:k,startTime:c})});a(e).on("click",".mck-accept",function(b){b=a(this).data("mck-conversationid");var c=a(this).data("mck-topic-price");if("function"===typeof Ka&&c&&b){var e=U[b],k=g.val();k=t.getGroupDisplayName(k);
"object"===typeof e?(Ka({custId:z,suppId:k,productId:e.topicId,price:c}),x.sendConversationCloseUpdate(b)):x.getTopicId({conversationId:b,suppId:k,priceText:c})}});V.submit(function(){1===xa&&aa.sendTypingStatus(0,u.data("mck-id"));var e=a.trim(mckUtils.textVal(E[0]));w.hasClass("n-vis")&&0<I.length&&(I=[]);if(0===e.length&&0===I.length)return E.addClass("mck-text-req"),!1;if("function"===typeof Cb&&!Cb(e))return!1;e={type:5,contentType:0,message:e};var k=u.data("mck-conversationid"),f=u.data("mck-topicid");
k?e.conversationId=k:f&&(k={topicId:f},f=T[f],"object"===typeof f&&(k.topicDetail=c.JSON.stringify(f)),e.conversationPxy=k);!0===u.data("isgroup")?e.groupId=g.val():e.to=g.val();v.attr("disabled",!0);y.removeClass("vis").addClass("n-vis");y.html("");oa.html("");ja.removeClass("vis").addClass("n-vis");b.sendMessage(e);return!1});M.on("click",function(){a(this).val("");y.removeClass("vis").addClass("n-vis");ja.removeClass("vis").addClass("n-vis")});a(e).bind("click",function(b){a(".mck-context-menu").removeClass("vis").addClass("n-vis");
!Da.hasClass("on")||a(b.target).hasClass("mck-icon-upload")||a(b.target).hasClass("mck-btn-attach")||Ib.fileMenuToggle();E.removeClass("mck-text-req");e.activeElement&&e.activeElement!==E&&1===xa&&aa.sendTypingStatus(0,u.data("mck-id"));e.activeElement&&"mck-group-name-save"!==e.activeElement.id&&F.removeClass("mck-req-border");e.activeElement&&"mck-btn-group-create"!==e.activeElement.id&&Na.removeClass("mck-req-border");a(".mcktypeahead.mck-dropdown-menu").hide()});a(".mck-tabview-item").click(function(){a(".mck-tabview-item").removeClass("active");
a(this).addClass("active")})};a(".mck-sidebox").on("click","#mck-mike-btn",function(){a(this).removeClass("vis").addClass("n-vis");$(".mck-stop-btn").addClass("vis").removeClass("n-vis");Fr.voice.record(!1,function(){$("#mck-audio").removeClass("n-vis").addClass("vis");x.timer()})});a(".mck-sidebox").on("click","#mck-stop-recording",function(){$("#mck-mike-btn").addClass("vis").removeClass("n-vis");$(".mck-stop-btn").addClass("n-vis").removeClass("vis");$("#mck-audio").removeClass("vis").addClass("n-vis");
x.stoptimer();Fr.voice.export(function(b){var c={};c.file=b;c.name="blob";a.fn.applozic("audioAttach",c)},"blob");Fr.voice.stop()});b.openChat=function(b){var c=a(b);b=c.data("mck-id");b="undefined"!==typeof b&&""!==b?b.toString():"";var e=c.data("mck-name");e="undefined"!==typeof e&&""!==e?e.toString():"";var k=c.data("mck-topicid");k="undefined"!==typeof k&&""!==k?k.toString():"";var g=!0===c.data("isgroup");c=c.data("mck-conversationid");c="undefined"!==typeof c&&""!==c?c.toString():"";k&&!c?(c=
(c=a(elem).data("mck-topic-status"))?-1===J.indexOf(c)?J[0]:c.toString():J[0],x.getConversationId({tabId:b,isGroup:g,userName:e,topicId:k,topicStatus:c,isMessage:!1})):m.loadTab({tabId:b,isGroup:g,userName:e,conversationId:c,topicId:k});f.val("")};b.sendMessage=function(c){if("object"===typeof c){var e=c.metadata?c.metadata:{},k=a("#mck-text-box").data("AL_REPLY");"undefined"===typeof k||""===k||c.forward||(e.AL_REPLY=k);c.metadata=e;if("undefined"!==typeof c.message&&0!==c.message.length||0!==I.length){if(c.conversationId&&
(e=U[c.conversationId],"undefined"!==e&&e.closed)){m.closeConversation();v.attr("disabled",!1);return}if(u.data("blocked"))ca.toggleBlockUser(g,!0),v.attr("disabled",!1);else{var f="";c.groupId?(f=mckGroupUtils.getGroup(c.groupId),"undefined"===typeof f&&(f=mckGroupUtils.createGroup(c.groupId))):f=c.clientGroupId?mckGroupUtils.getGroupByClientGroupId(c.clientGroupId):m.fetchContact(c.to);0<a("#mck-message-cell .mck-no-data-text").length&&a(".mck-no-data-text").remove();if(c.message&&0===I.length){e=
ka.hasClass("n-vis");var g=u.data("mck-id");var h=mckUtils.randomId();c.key=h;12!==c.contentType&&g&&g.toString()===f.contactId&&102!==c.contentType&&b.addMessageToTab(c,f);b.submitMessage(c,{tabId:f.contactId,isTopPanelAdded:e})}else 0<I.length&&a.each(I,function(a,e){a=ka.hasClass("n-vis");var k=u.data("mck-id"),g=mckUtils.randomId();c.key=g;c.fileMeta=e;c.contentType=1;12!==c.contentType&&k&&k.toString()===f.contactId&&b.addMessageToTab(c,f);b.submitMessage(c,{tabId:f.contactId,isTopPanelAdded:a})});
E.removeClass("mck-text-req");v.attr("disabled",!1);a("."+h+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");m.addTooltip(h);m.clearMessageField(!0);I=[];delete Qa[f.contactId]}}else E.addClass("mck-text-req")}};b.addMessageToTab=function(a,b){var c={to:a.to,groupId:a.groupId,deviceKey:a.deviceKey,contentType:a.contentType,message:a.message,conversationId:a.conversationId,topicId:a.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:a.key,storeOnDevice:!0,
sent:!1,read:!0,metadata:a.metadata?a.metadata:""};c.type=a.type?a.type:5;a.fileMeta&&(c.fileMeta=a.fileMeta);m.addMessage(c,b,!0,!0,!1)};b.sendForwardMessage=function(a){var e=C.getMessageByKey(a);if("undefined"!==typeof e){e.fileMeta&&I.push(e.fileMeta);a={type:5,contentType:e.contentType,message:e.message,forward:"forward"};e.metadata&&(e.metadata.AL_REPLY&&(e.metadata.AL_REPLY=""),a.metadata=e.metadata);var k=u.data("mck-conversationid");e=u.data("mck-topicid");k?a.conversationId=k:e&&(k={topicId:e},
e=T[e],"object"===typeof e&&(k.topicDetail=c.JSON.stringify(e)),a.conversationPxy=k);!0===u.data("isgroup")?a.groupId=g.val():a.to=g.val();b.sendMessage(a)}};b.sendWelcomeMessage=function(a){var c=mckUtils.randomId(),e=u.data("mck-id"),k=u.data("isgroup");c={key:c,type:4,contentType:0,to:a.sender,message:a.messageContent};e&&e.toString()===a.sender&&!k&&(e=m.fetchContact(e),b.addMessageToTab(c,e));mckUtils.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+
encodeURIComponent(a.sender)+"\x26messageContent\x3d"+encodeURIComponent(a.messageContent),contentType:"text/plain",success:function(b){a.callback&&a.callback(b)}})};b.submitMessage=function(b,e){var k=b.key,f=b.metadata?b.metadata:{};Wb&&(b.metadata={userStatus:4});var g=a("#mck-text-box").data("AL_REPLY");"undefined"===typeof g||""===g||b.forward||(f.AL_REPLY=g,a("#mck-text-box").data("AL_REPLY",""));b.source=pc;var h=a("#mck-message-cell .mck-message-inner div[name\x3d'message']."+k);102!=b.contentType&&
103!=b.contentType&&(b.metadata=Vb);b.metadata=f;mckUtils.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:c.JSON.stringify(b),contentType:"application/json",success:function(c){var f=u.data("mck-id");if("object"===typeof c){var g=c.messageKey;if(f&&f.toString()===e.tabId){var p=c.conversationId;u.data("mck-conversationid",p);h.removeClass(k).addClass(g);h.data("msgkey",g);a("."+g+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title",
"sent");m.addTooltip(g);e.isTopPanelAdded&&wa.data("datetime",c.createdAt);c=!0;b.groupId&&6===mckGroupUtils.getGroup(b.groupId).type&&(c=!1);c&&m.messageContextMenu(g)}b.conversationPxy&&(g=b.conversationPxy,b.topicId&&(qa[b.topicId]=[p]),U[p]=g)}else"CONVERSATION_CLOSED"===c||"BUSY_WITH_OTHER"===c?(v.attr("disabled",!1),m.closeConversation(c),h.remove(),e.isTopPanelAdded&&ka.removeClass("vis").addClass("n-vis")):"error"===c&&(v.attr("disabled",!1),y.html("Unable to process your request. Please try again"),
y.removeClass("n-vis").addClass("vis"),h.remove(),e.isTopPanelAdded&&ka.removeClass("vis").addClass("n-vis"))},error:function(){y.html("Unable to process your request. Please try again.");y.removeClass("n-vis").addClass("vis");h&&h.remove();e.isTopPanelAdded&&ka.removeClass("vis").addClass("n-vis")}});$("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};b.downloadImage=function(a){window.open(a,"_blank")};b.replyMessage=function(b){u.data("mck-id");var c=x.getReplyMessageByKey(b);E.focus().select();
$("#mck-reply-to-div").removeClass("n-vis").addClass("vis");var e=5===c.type?"You":m.getTabDisplayName(c.to,!1);$("#mck-reply-to").html(e);"object"===typeof c.fileMeta||2===c.contentType?$("#mck-reply-msg").html(m.getImageForMessagePreview(c)):$("#mck-reply-msg").html(c.message);a("#mck-text-box").data("AL_REPLY",b)};$("#close").click(function(){$("#mck-reply-to-div").removeClass("vis").addClass("n-vis");a("#mck-text-box").data("AL_REPLY","")});b.deleteMessage=function(b){var e=u.data("mck-id");"undefined"!==
typeof e&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+b,type:"get",success:function(k){"success"===k?(u.data("mck-id")===e&&(a("."+b).remove(),u.is(":empty")&&ka.removeClass("vis").addClass("n-vis")),C.clearMckMessageArray()):c.console.log("Unable to delete message. Please reload page.")}})};b.deleteConversation=function(){var a=u.data("mck-id"),b=u.data("isgroup"),c=u.data("mck-conversationid");"undefined"!==typeof a&&(b=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a),
c&&(b+="\x26conversationId\x3d"+c),Ga=!0,mckUtils.ajax({type:"get",url:MCK_BASE_URL+"/rest/ws/message/delete/conversation",global:!1,data:b,success:function(){u.data("mck-id")===a&&(u.html(""),wa.data("datetime",""),O.removeClass("n-vis").addClass("vis"),N.removeClass("n-vis").addClass("vis"),ka.removeClass("vis").addClass("n-vis"),Ga=!1)},error:function(){}}))};b.getMessages=function(a){var b="";"undefined"!==typeof a.userId&&""!==a.userId?(b=a.isGroup?"\x26groupId\x3d"+a.userId:"\x26userId\x3d"+
encodeURIComponent(a.userId),a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26pageSize\x3d30",(Ca||Pa)&&a.conversationId&&(b+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof ba[a.userId]&&(b+="\x26conversationReq\x3dtrue"))):(a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26mainPageSize\x3d100");var c={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+b,type:"get",success:function(b){c.status="success";c.data=b;a.callback&&a.callback(c)},error:function(b,
e,k){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));c.status="error";a.callback&&a.callback(c)}})};b.getMessageList=function(b){var c=b.id;if("undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId){var e=b.pageSize?"\x26pageSize\x3d"+b.pageSize:"\x26pageSize\x3d50";e+="\x26clientGroupId\x3d"+b.clientGroupId;b.startTime&&(e+="\x26endTime\x3d"+b.startTime);var k={clientGroupId:b.clientGroupId}}else"undefined"!==typeof c&&""!==c?(e=b.pageSize?"\x26pageSize\x3d"+b.pageSize:
"\x26pageSize\x3d50",e+="true"===""+b.isGroup?"\x26groupId\x3d"+c:"\x26userId\x3d"+c,b.startTime&&(e+="\x26endTime\x3d"+b.startTime),k={id:c}):(e=b.pageSize?"\x26mainPageSize\x3d"+b.pageSize:"\x26mainPageSize\x3d50",b.startTime&&(e+="\x26endTime\x3d"+b.startTime),k={id:""});b.topicId&&(c||b.clientGroupId)&&(b.conversationId&&(e+="\x26conversationId\x3d"+b.conversationId),b.topicId&&(k.topicId=b.topicId));mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+e,type:"get",global:!1,
success:function(c){k.status="success";if("undefined"===typeof c.message||0===c.message.length)k.messages=[];else{var e=[];a.each(c.message,function(a,b){if("undefined"!==typeof b.to||"undefined"!==typeof b.groupId)a=m.getMessageFeed(b),e.push(a)});k.messages=e}0<c.groupFeeds.length&&(k.id=c.groupFeeds[0].id);b.callback(k)},error:function(a,c,e){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));k.status="error";b.callback(k)}})};b.getReplyMessageByKey=function(a){"undefined"===
typeof C.getMessageByKey(a)&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/detail",async:!1,type:"get",data:"keys\x3d"+a,success:function(a){C.updateMckMessageArray(a)}});return C.getMessageByKey(a)};b.loadMessageList=function(b,e){var k=!1,f=!1,g="";"undefined"!==typeof b.tabId&&""!==b.tabId?(g=b.isGroup?"\x26groupId\x3d"+b.tabId:"\x26userId\x3d"+encodeURIComponent(b.tabId),k=!0,b.startTime&&(g+="\x26endTime\x3d"+b.startTime),g+="\x26pageSize\x3d30",(Ca||Pa)&&b.conversationId&&(g+="\x26conversationId\x3d"+
b.conversationId,"undefined"===typeof ba[b.tabId]?(f=!0,g+="\x26conversationReq\x3dtrue"):m.addConversationMenu(b.tabId,b.isGroup)),b.isGroup&&Kommunicate.getAwayMessage({applicationId:S,conversationId:b.tabId},KommunicateUI.populateAwayMessage)):(Ga=!0,b.startTime&&(g+="\x26endTime\x3d"+b.startTime),g+="\x26mainPageSize\x3d60");b.startTime||u.html("");L.removeClass("n-vis").addClass("vis");mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+g,type:"get",global:!1,success:function(g){var h=
!0,p=u.data("mck-id"),q=u.data("isgroup");b.isGroup&&!b.startTime||L.removeClass("vis").addClass("n-vis");Ga=!1;if("undefined"===typeof p||b.tabId===p&&""+q===""+b.isGroup){if("null"===g+""||"undefined"===typeof g.message||0===g.message.length)h=!1,k?b.startTime?(ta.removeClass("n-vis").addClass("vis"),ta.fadeOut(5E3,function(){ta.removeClass("vis").addClass("n-vis")}),wa.data("datetime","")):b.isGroup||0!==a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||(ka.removeClass("vis").addClass("n-vis"),
Fa.removeClass("vis").addClass("n-vis"),N.removeClass("n-vis").addClass("vis")):(N.removeClass("vis").addClass("n-vis"),b.startTime?(Ea.removeClass("n-vis").addClass("vis"),Ea.fadeOut(5E3,function(){Ea.removeClass("vis").addClass("n-vis")})):(N.removeClass("vis").addClass("n-vis"),Fa.removeClass("n-vis").addClass("vis")),u.data("datetime",""));if("null"!==g+""&&"error"!==g.status)if(k){h&&(0<b.startTime?m.processMessageList(g,!1,!0):b.isGroup||(m.processMessageList(g,!0,!0),ka.removeClass("n-vis").addClass("vis")));
0< !b.startTime&&!b.isGroup&&"function"===typeof Ya&&Ya(b.tabId);0<g.userDetails.length&&a.each(g.userDetails,function(a,e){ha[e.userId]=e;b.isGroup||(e.connected?c.MCK_OL_MAP[e.userId]=!0:(c.MCK_OL_MAP[e.userId]=!1,"undefined"!==typeof e.lastSeenAtTime&&(Z[e.userId]=e.lastSeenAtTime)),fb||b.isGroup||(e.blockedByThis?(pa[e.userId]=!0,ca.toggleBlockUser(b.tabId,!0)):e.blockedByOther?(Ha[e.userId]=!0,P.removeClass("mck-tab-title-w-status"),Wa.removeClass("vis").addClass("n-vis"),H.removeClass("vis").addClass("n-vis"),
u.data("blocked",!1)):ca.toggleBlockUser(b.tabId,!1)),e.userName&&!b.startTime&&(a=m.getTabDisplayName(b.tabId,b.isGroup,e.userName),P.html(a),P.attr("title",a)))});!gb||b.isGroup||b.startTime||c.MCK_OL_MAP[b.tabId]||eb.manageOfflineMessageTime(b.tabId);if(0<g.conversationPxys.length){var F=[];a.each(g.conversationPxys,function(b,e){if("object"===typeof e&&(F.push(e),U[e.id]=e,qa[e.topicId]=[e.id],e.topicDetail))try{T[e.topicId]=a.parseJSON(e.topicDetail)}catch(Nb){c.console.log("Incorect Topic Detail!")}});
f&&(ba[b.tabId]=F,m.addConversationMenu(b.tabId,b.isGroup))}b.conversationId&&(p=U[b.conversationId],"object"===typeof p&&p.closed&&m.closeConversation());b.startTime||(b.isGroup?(t.addGroupStatus(mckGroupUtils.getGroup(b.tabId)),m.updateUnreadCount("group_"+b.tabId,0,!0)):m.updateUnreadCount("user_"+b.tabId,0,!0),"function"===typeof e&&e(b));0<g.groupFeeds.length&&a.each(g.groupFeeds,function(c,e){c=mckGroupUtils.addGroup(e);if(!b.startTime){var k=[];a.each(e.membersId,function(a,b){"undefined"===
typeof m.getContact(b)&&k.push(b)});if(0<k.length)b.isMessages=h,b.messageData=g,b.isLoadMessageList=!0,X.getUsersDetail(k,b);else{t.addGroupStatus(c);e=!0;if(7===c.type){fa.removeClass("vis").addClass("n-vis");var f=m.getContactFromGroupOfTwo(c);ca.lastSeenOfGroupOfTwo(f.contactId)}"kommunicate"==window.applozic.PRODUCT_ID&&(3!==c.users[z].role&&2!==c.users[z].role&&0!==c.users[z].role||fa.removeClass("vis").addClass("n-vis"));6===c.type&&(t.validateOpenGroupUser(c),e=t.isAppendOpenGroupContextMenu(c));
L.removeClass("vis").addClass("n-vis");h?(N.removeClass("vis").addClass("n-vis"),m.processMessageList(g,!0,e),6!==c.type&&ka.removeClass("n-vis").addClass("vis")):0===a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(ka.removeClass("vis").addClass("n-vis"),N.removeClass("n-vis").addClass("vis"));"function"===typeof Ya&&Ya(b.tabId)}}})}else b.startTime||(c.MCK_OL_MAP=[]),0<g.userDetails.length&&a.each(g.userDetails,function(a,b){ha[b.userId]=b;b.connected?c.MCK_OL_MAP[b.userId]=
!0:(c.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(Z[b.userId]=b.lastSeenAtTime));m.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b)}),0<g.groupFeeds.length&&a.each(g.groupFeeds,function(a,b){m.updateUnreadCount("group_"+b.id,b.unreadCount,!1);mckGroupUtils.addGroup(b)}),0<g.blockedUserPxyList.blockedToUserList.length&&a.each(g.blockedUserPxyList.blockedToUserList,function(a,
b){b.userBlocked&&(pa[b.blockedTo]=!0)}),0<g.blockedUserPxyList.blockedByUserList.length&&a.each(g.blockedUserPxyList.blockedByUserList,function(a,b){b.userBlocked&&(Ha[b.blockedBy]=!0)}),0<g.conversationPxys.length&&a.each(g.conversationPxys,function(b,e){U[e.id]=e;qa[e.topicId]=[e.id];if(e.topicDetail)try{T[e.topicId]=a.parseJSON(e.topicDetail)}catch(Nb){c.console.log("Incorect Topic Detail!")}}),h?(b.startTime?b.startTime&&(b.isReload=!1,k||C.updateLatestMessageArray(g.message)):(b.isReload=!0,
k||C.setLatestMessageArray(g.message)),k&&C.updateMckMessageArray(g.message),m.addContactsFromMessageList(g,b)):u.data("datetime",""),b.isLaunch&&m.updateUnreadCountonChatIcon(g.userDetails)}p=n.data("forwardMessageKey");"undefined"!==typeof p&&(x.sendForwardMessage(p),n.data("forwardMessageKey",""))},error:function(a,b,e){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));Ga=!1;L.removeClass("vis").addClass("n-vis");c.console.log("Unable to load messages. Please reload page.")}})};
b.updateContactList=function(a,b){var c=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list",data:"startIndex\x3d0\x26pageSize\x3d1\x26"+c,global:!1,type:"get",success:function(c){"null"===c+""||"undefined"===typeof c.message||0===c.message.length?m.clearContactMessageData(a,b):(c=c.message[0],"undefined"!==typeof c&&(c.groupId?m.addGroupFromMessage(c,!0):m.addContactsFromMessage(c,!0)))},error:function(c,e,k){401===c.status&&(sessionStorage.clear(),
console.log("Please reload page."));m.clearContactMessageData(a,b)}})};b.sendDeliveryUpdate=function(a){mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delivered",data:"key\x3d"+a.pairedMessageKey,global:!1,type:"get",success:function(){},error:function(){}})};b.sendReadUpdate=function(a){"undefined"!==typeof a&&""!==a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read",data:"key\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};b.conversationReadUpdate=function(a,b){var c=
b?"group_"+a:"user_"+a;a&&0<m.getUnreadCount(c)&&(a=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read/conversation",data:a,global:!1,type:"get",success:function(){m.updateUnreadCount(c,0,!0)},error:function(){}}))};b.getConversationId=function(e){var f;if(!e.isGroup&&!e.isMessage&&e.topicStatus!==J[1]&&(f=qa[e.topicId])&&(f=U[f],"object"===typeof f)){u.data("mck-conversationid",f.id);e.conversationId=f.id;if("undefined"!==typeof ba[e.tabId]){var k=
ba[e.tabId];k.push(f);ba[e.tabId]=k}m.loadTab(e);return}e.topicId&&(f={topicId:e.topicId,userId:e.tabId,status:e.topicStatus},e.isGroup&&(f.supportIds=[],f.supportIds.push(e.supportId)),k=T[e.topicId],"object"===typeof k&&(f.topicDetail=c.JSON.stringify(k)),e.fallBackTemplatesList&&0<e.fallBackTemplatesList.length&&(f.fallBackTemplatesList=e.fallBackTemplatesList),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/id",global:!1,data:c.JSON.stringify(f),type:"post",contentType:"application/json",
success:function(f){if("object"===typeof f&&"success"===f.status){var k=f.response;if("object"===typeof k&&"undefined"!==k.conversationPxy){f=k.conversationPxy;U[f.id]=f;qa[f.topicId]=[f.id];if(f.topicDetail)try{T[f.topicId]=a.parseJSON(f.topicDetail)}catch(ab){c.console.log("Incorect Topic Detail!")}u.data("mck-conversationid",f.id);e.conversationId=f.id;if("undefined"!==typeof ba[e.tabId]){var g=ba[e.tabId];g.push(f);ba[e.tabId]=g}e.isGroup&&(k=mckGroupUtils.addGroup(k),e.tabId=k.contactId);e.isMessage&&
f.created?m.loadTab(e,b.dispatchMessage):m.loadTab(e)}}},error:function(){}}))};b.fetchConversationByTopicId=function(b){var e="topic\x3d"+b.topicId;if(b.tabId)e+="true"===""+b.isGroup?"\x26groupId\x3d"+b.tabId:"\x26userId\x3d"+encodeURIComponent(b.tabId);else if(b.clientGroupId)e+="\x26clientGroupId\x3d"+b.clientGroupId;else return!1;b.pageSize&&(e+="\x26pageSize\x3d"+b.pageSize);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/get",data:e,type:"get",success:function(e){"object"===typeof e&&
"success"===e.status?(e=e.response,0<e.length&&a.each(e,function(e,f){U[f.id]=f;qa[f.topicId]=[f.id];if(f.topicDetail)try{T[f.topicId]=a.parseJSON(f.topicDetail)}catch(ib){c.console.log("Incorect Topic Detail!")}b.tabId&&"undefined"!==typeof ba[b.tabId]&&(e=ba[b.tabId],e.push(f),ba[b.tabId]=e)}),b.isExtMessageList&&(0<e.length?(b.conversationId=e[0].id,b.pageSize=50,x.getMessageList(b)):"function"===typeof b.callback&&(e={},b.tabId?(e.id=b.tabId,e.isGroup=b.isGroup):b.clientGroupId&&(e.clientGroupId=
b.clientGroupId),e.topicId=b.topicId,e.status="success",e.messages=[],b.callback(e)))):b.isExtMessageList&&"function"===typeof b.callback&&(e={},b.tabId?e.id=b.tabId:b.clientGroupId&&(e.clientGroupId=b.clientGroupId),e.topicId=b.topicId,e.status="error",e.errorMessage="Unable to process request. Please try again.",b.callback(e))},error:function(){if("function"===typeof b.callback){var a={};b.tabId?a.id=b.tabId:b.clientGroupId&&(a.clientGroupId=b.clientGroupId);a.topicId=b.topicId;a.status="error";
a.errorMessage="Unable to process request. Please try again.";b.callback(a)}}})};b.getTopicId=function(e){e.conversationId&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/topicId",data:"id\x3d"+e.conversationId,global:!1,type:"get",async:"undefined"!==typeof e.async?e.async:!0,success:function(f){if("object"===typeof f&&"success"===f.status&&(f=f.response,"object"===typeof f)){qa[f.topicId]=[e.conversationId];U[e.conversationId]=f;if(f.topicDetail)try{T[f.topicId]=a.parseJSON(f.topicDetail)}catch(ma){c.console.log("Incorect Topic Detail!")}"function"===
typeof Ka&&e.priceText&&(Ka({custId:z,suppId:e.suppId,productId:f.topicId,price:e.priceText}),b.sendConversationCloseUpdate(e.conversationId));if(e.messageType&&"object"===typeof e.message){var k=e.message.groupId?e.message.groupId:e.message.to;if("undefined"!==typeof ba[k]){var g=ba[k];g.push(f);ba[k]=g}("undefined"!==typeof e.populate?e.populate:1)&&m.populateMessage(e.messageType,e.message,e.notifyUser)}"function"===typeof e.callback&&e.callback(f)}},error:function(){}})};b.sendConversationCloseUpdate=
function(a){a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/close",data:"id\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};b.sendPriceMessage=function(){var c=R.val();if(""===c)R.addClass("mck-text-req");else{c=a.trim(c);var e=g.val();u.data("mck-conversationid",h);var f={type:5,contentType:4,message:c};!0===u.data("isgroup")?f.groupId=e:f.to=e;if(u.data("mck-conversationid")){var h=u.data("mck-conversationid");f.conversationId=h;var p=U[h];"object"!==p?b.getTopicId({conversationId:h,
suppId:e,priceText:c}):"function"===typeof Ka&&Ka({custId:z,suppId:e,productId:p.topicId,price:c});R.val("")}b.sendMessage(f)}};b.dispatchMessage=function(e){if("object"===e.messagePxy){var f=e.messagePxy;if(e.topicId){var g=T[e.topicId];if("object"===typeof g&&"undefined"!==g.title)if(f.message||(f.message=a.trim(g.title)),e.conversationId)f.conversationId=e.conversationId;else if(e.topicId){var k={topicId:e.topicId};"object"===typeof g&&(k.topicDetail=c.JSON.stringify(g));f.conversationPxy=k}!f.message&&
g.link&&(g={blobKey:a.trim(g.link),contentType:"image/png"},f.fileMeta=g,f.contentType=5,I=[],I.push(g))}e.isGroup?f.groupId=e.tabId:f.to=e.tabId;b.sendMessage(f)}};b.getGroup=function(e){var f=[];a.each(e.users,function(a,b){"undefined"!==typeof b.userId&&("undefined"!==typeof b.groupRole&&-1===vb.indexOf(b.groupRole)||f.push(b))});var g={groupName:a.trim(e.groupName),users:f,type:e.type};e.admin&&(g.admin=e.admin);e.clientGroupId&&(g.clientGroupId=e.clientGroupId);e.groupIcon&&(g.imageUrl=e.groupIcon);
g.metadata=e.metadata?e.metadata:MCK_LABELS["group.metadata"];var k={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/group/v2.1/create",global:!1,data:c.JSON.stringify(g),type:"post",contentType:"application/json",success:function(f){e.isInternal&&Ba.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);if("object"===typeof f&&"success"===f.status){if(f=f.response,"object"===typeof f){var g=mckGroupUtils.addGroup(f);0<f.users.length&&a.each(f.users,function(a,b){ha[b.userId]=b;b.connected?c.MCK_OL_MAP[b.userId]=
!0:(c.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(Z[b.userId]=b.lastSeenAtTime));m.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b)});e.tabId=g.contactId;e.isGroup=!0;e.isMessage?m.loadTab(e,b.dispatchMessage):e.isInternal?(u.data("mck-id",g.contactId),u.data("isgroup",!0),t.loadGroupInfo({groupId:g.contactId})):m.loadTab(e);"function"===typeof e.callback&&(k.status="success",
k.data=g,e.callback(k))}}else"error"===f.status&&"function"===typeof e.callback&&(k.status="error",k.errorMessage=f.errorResponse[0].description,e.callback(k))},error:function(){e.isInternal&&Ba.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);"function"===typeof e.callback&&(k.status="error",k.errorMessage="Unable to process request.",e.callback(k))}})};b.sendVideoCallMessage=function(a,c,e,f){var k="CALL_MISSED"==c?"Missed Call":"CALL_REJECTED"==c?"Call Rejected":"";if(""==k||void 0==
k)k="video message";a={to:g.val(),type:5,contentType:e,message:k,metadata:{MSG_TYPE:c,CALL_ID:a,CALL_AUDIO_ONLY:f},senderName:z};b.sendMessage(a);return a};b.sendVideoCallEndMessage=function(a,c,e,f,h){var k="";h&&(k=mckDateUtils.convertMilisIntoTime(h));k="CALL_MISSED"==c?"Missed Call":"CALL_REJECTED"==c?"Call Rejected":"CALL_END"==c?"Call End \n Duration: "+k:"video message";if(""==k||void 0==k)k="video message";a={to:g.val(),type:5,contentType:e,message:k,metadata:{MSG_TYPE:c,CALL_ID:a,CALL_AUDIO_ONLY:f,
CALL_DURATION:h}};b.sendMessage(a);return a}},X=new function(){var b=this;a("#mck-search-list");var e=a("#mck-sidebox-search"),f=a("#mck-search-loading");a("#mck-search-cell .mck-message-inner");a("#mck-message-cell .mck-message-inner");a(".mck-tab-message-option");a("#mck-contact-loading");b.getContactDisplayName=function(a){var b=[];if(0<a.length&&a[0]){for(var c="",e=a.filter(function(b,c){return a.indexOf(b)===c}),f=0;f<e.length;f++){var g=e[f];"undefined"===typeof ta[g]&&(c+="userIds\x3d"+encodeURIComponent(g)+
"\x26")}c.lastIndexOf("\x26")===c.length-1&&(c=c.substring(0,c.length-1));c&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/info",data:c,global:!1,type:"get",success:function(a){for(var c in a)a.hasOwnProperty(c)&&(b.push([c,a[c]]),ta[c]=a[c],m.fetchContact(c).displayName=a[c]);C.updateMckContactNameArray(b)},error:function(){}})}};b.loadContacts=function(){var b=[];mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d0\x26pageSize\x3d30\x26orderBy\x3d1",type:"get",global:!1,success:function(f){e.hasClass("vis")&&
("object"===typeof f&&0<f.users.length&&(a.each(f.users,function(a,e){"undefined"!==typeof e.userId&&(a=m.getContact(""+e.userId),a="undefined"===typeof a?m.createContactWithDetail(e):m.updateContactDetail(a,e),Ta.push(a),b.push([e.userId,a.displayName]),e.connected?c.MCK_OL_MAP[e.userId]=!0:(c.MCK_OL_MAP[e.userId]=!1,"undefined"!==typeof e.lastSeenAtTime&&(Z[e.userId]=e.lastSeenAtTime)))}),0<b.length&&C.updateMckContactNameArray(b)),m.addContactsToSearchList())},error:function(){f.removeClass("vis").addClass("n-vis");
c.console.log("Unable to load contacts. Please reload page.")}})};b.loadUserProfile=function(a){if("undefined"!==typeof a){var c=[];a=""+a.split(",")[0];c.push(a);b.loadUserProfiles(c)}};b.loadUserProfiles=function(c){var e=[];a.each(c,function(a,b){"undefined"===typeof m.getContact(b)&&e.push(b)});b.getUsersDetail(e,{async:!1})};b.getUsersDetail=function(b,e){if(!("undefined"===typeof b||1>b.length)){for(var f="undefined"!==typeof e.cached?e.cached:!0,g=[],h=b.filter(function(a,c){return b.indexOf(a)===
c}),p=0;p<h.length;p++){var n=h[p];f&&"undefined"!==typeof ha[n]||g.push(n)}if(0===g.length)e.setStatus?ca.updateUserConnectedStatus():e.message?m.populateMessage(e.messageType,e.message,e.notifyUser):e.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(e);else{var w={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/v2/detail",type:"post",async:"undefined"!==typeof e.async?e.async:!0,data:JSON.stringify({userIdList:g}),contentType:"application/json",success:function(b){"success"===b.status&&0<
b.response.length&&a.each(b.response,function(a,b){ha[b.userId]=b;c.MCK_OL_MAP[b.userId]=b.connected;a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b)});e.setStatus?ca.updateUserConnectedStatus():e.message?m.populateMessage(e.messageType,e.message,e.notifyUser):e.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(e);w.status="success";w.data=b;e.callback&&e.callback(w)},error:function(){e.setStatus?ca.updateUserConnectedStatus():e.message?
m.populateMessage(e.messageType,e.message,e.notifyUser):e.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(e);w.status="error";e.callback&&e.callback(w)}})}}};b.getUserStatus=function(b){var c={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/chat/status",type:"get",success:function(e){0<e.users.length&&(Ua=[],a.each(e.users,function(a,b){a=m.getContact(""+b.userId);a="undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b);Ua.push(a.contactId)}));c.status="success";c.data=
e;b.callback&&b.callback(c)},error:function(){c.status="error";b.callback&&b.callback(c)}})};b.blockUser=function(a,b){a&&"undefined"!==typeof b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:"userId\x3d"+a+"\x26block\x3d"+b,success:function(c){"object"===typeof c&&"success"===c.status&&(pa[a]=b,ca.toggleBlockUser(a,b))},error:function(){}})};b.updateUserIdentity=function(a){if(null!==a.newUserId&&""!==a.newUserId){var b="newUserId\x3d"+encodeURIComponent(a.newUserId);mckUtils.ajax({url:MCK_BASE_URL+
"/rest/ws/user/change/identifier",type:"get",data:b,contentType:"application/json",success:function(b){"object"===typeof b&&"success"===b.status&&a.callback&&a.callback(b)},error:function(b){a.callback&&a.callback({response:"error"})}})}};b.updateUser=function(a){mckUtils.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/user/update",data:c.JSON.stringify(a.data),contentType:"application/json",success:function(b){a.success&&a.success(b)},error:function(b){a.error&&a.error(b)}})}},Va=new function(){var b=
this,c,e,f,g,n,w,t,v;b.init=function(){a("#mck-sidebox");e=a("#mck-msg-preview");n=a("#mck-group-info-tab");a("#mck-sidebox-launcher");c=a("#mck-message-cell .mck-message-inner");f=a("#mck-msg-preview .mck-preview-icon");g=a("#mck-msg-preview .mck-preview-cont-name");t=a("#mck-msg-preview .mck-preview-msg-content");v=a("#mck-msg-preview .mck-preview-file-content")};b.notifyUser=function(a){if(!1!==a.alert&&7!==a.type){var c=a.groupId?mckGroupUtils.getGroup(""+a.groupId):m.fetchContact(""+a.to.split(",")[0]),
e=!1;a.groupId&&(e=!0);X.loadUserProfile(a.to);e=m.getTabDisplayName(c.contactId,e);var f=kc;b.showNewMessageNotification(a,c,e);if(Zb&&!sb){var g=mc;a=m.getTextForMessagePreview(a,c);"function"!==typeof $a||c.isGroup||(c=$a(c.contactId))&&"undefined"!==typeof c&&(g=c);mckNotificationUtils.sendDesktopNotification(e,g,a,f)}}};b.showNewMessageNotification=function(a,b,p){if($b&&102!==a.contentType){var h=c.data("mck-id"),w=c.data("isgroup");if(h===b.contactId&&w===b.isGroup&&!n.hasClass("vis"))if(a.conversationId&&
(Ca||Pa)){if(h=c.data("mck-conversationid"),h="undefined"!==typeof h&&""!==h?h.toString():"",h===a.conversationId.toString())return}else return;e.data("isgroup",b.isGroup);e.data("mck-conversationid",a.conversationId?a.conversationId:"");h=m.getContactImageLink(b,p);a.message?(w=m.getMessageTextForContactPreview(a,b,50),t.html(""),"object"===typeof w?t.append(w):t.html(w),t.removeClass("n-vis").addClass("vis")):t.html("");a.fileMetaKey?(v.html(m.getFileIcon(a)),v.removeClass("n-vis").addClass("vis"),
""===t.html()&&t.removeClass("vis").addClass("n-vis")):(v.html(""),v.removeClass("vis").addClass("n-vis"));!0===b.isGroup&&10!==b.type&&g.html(p);f.html(h);e.data("mck-id",b.contactId);e.show();setTimeout(function(){e.fadeOut(3E3)},1E4)}};b.unsubscribeToServiceWorker=function(){w&&navigator.serviceWorker.ready.then(function(a){w.unsubscribe().then(function(a){w=null;console.log("Unsubscribed to notification successfully")})})};b.sendSubscriptionIdToServer=function(){if(w){var a=w.endpoint.split("/").slice(-1)[0];
a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/plugin/update/sw/id",type:"post",data:"registrationId\x3d"+a,success:function(a){},error:function(a,b,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."))}})}};b.subscribeToServiceWorker=function(){ac&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",{scope:"./"}),navigator.serviceWorker.ready.then(function(a){a.pushManager.subscribe({userVisibleOnly:!0}).then(function(a){console.log("The reg ID is:: ",
a.endpoint.split("/").slice(-1));w=a;b.sendSubscriptionIdToServer()})}))}},za=a(".chat-launcher-icon"),fa=new function(){var b=this;b.token=null;b.Identity=null;b.outgoingCallServices=null;b.incomingCallServices=null;var c=a(".mck-videocall-btn"),e=a(".applozic-vid-container"),f=a("#mck-sidebox"),g=a("#mck-video-call-indicator"),n=a("#mck-video-box");b.hideVideoBox=function(){e.addClass("n-vis").removeClass("vis");f.addClass("vis").removeClass("n-vis");g.addClass("n-vis").removeClass("vis")};b.init=
function(){n.mckModal();Ba.loop=!0;b.token=null!==C.getAppHeaders()?C.getAppHeaders().videoToken:void 0;b.ringToneForHost=Ea.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",Ba);a("#mck-btn-video-call").on("click",function(c){if(b.token){c=z+(new Date).getTime().toString()+Math.random().toString(36).slice(2);var e=x.sendVideoCallMessage(c,"CALL_DIALED",102,!1),f=m.fetchContact(e.to);e=m.getTabDisplayName(f.contactId,!1);f=m.getContactImageLink(f,e);
var g=new Date;b.outgoingCallServices=new MckCallingService(z,fa.token,c,e,!0,g,x,f,!1,b.ringToneForHost);b.outgoingCallServices.startVideoCall();a("#mck-btn-video-call").data("isCallHost",!0);a("#mck-btn-video-call").data("callStartTime",g)}else alert("missing token... please refresh page..")});a("#mck-vid-receive-btn").on("click",function(b){console.log("call received");$("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");c.removeClass("vis").addClass("n-vis");b=a("#mck-video-call-indicator").data("call-id");
var e=a("#mck-video-call-indicator").data("isAudioCall");a("#mck-video-call-indicator").data("callReceived",!0);a("#mck-video-call-indicator").addClass("n-vis");fa.callReceived(b,e)});a("#mck-vid-reject-btn").on("click",function(b){console.log("call rejected");b=a("#mck-video-call-indicator").data("call-id");var c=a("#mck-video-call-indicator").data("isAudioCall");fa.callRejected(b,c);a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};b.InitilizeVideoClient=function(c,e){b.Identity=
c;a.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:c,device:e},success:function(a){if(null!=a&&""!=a){b.token=a.token;var c=C.getAppHeaders();c.videoToken=a.token;C.setAppHeaders(c)}},error:function(a){console.log("error while getting token"+a)}})};b.callReceived=function(a,c){console.log("_this.callReceived");na&&na.stop();x.sendVideoCallMessage(a,"CALL_ANSWERED",102,c);b.incomingCallServices=new MckCallingService(b.Identity,b.token,
a,null,!1,null,x,null,c);b.incomingCallServices.startVideoCall()};b.callRejected=function(a,b){na&&na.stop();x.sendVideoCallMessage(a,"CALL_REJECTED",102,b)}},kc=null,Ba={},Ea,na=null,jc=f.isAnonymousChat,ob=f.conversationTitle,pb=f.agentId,qb=f.botIds;c.MCK_OL_MAP=[];g.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},
onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};g.loadConversationWithAgent=function(a){if(a&&a.agentId)console.log("setting default agent inside Applozic"),x.loadConversationWithAgents(a);else throw Error("params are empty");};var aa=new function(b){var e=this,
f=b.events,g=null,h=null,w="",v=null,y=[],I,A,P="",O=a("#mck-sidebox"),H=a("#mck-tab-title"),M=a(".mck-typing-box"),J=a("#mck-tab-status");a("#mck-offline-message-box");var R=a("#mck-typing-label"),G=a("#mck-message-cell .mck-message-inner");e.init=function(){if("undefined"!==typeof Fa){var a=mckUtils.startsWith(Fa,"https")?"15675":"15674";"function"===typeof c.SockJS&&(P||(P=new SockJS(Fa+":"+a+"/stomp")),h=c.Stomp.over(P),h.heartbeat.outgoing=0,h.heartbeat.incoming=0,h.onclose=function(){e.disconnect()},
h.connect("guest","guest",e.onConnect,e.onError,"/"),c.addEventListener("beforeunload",function(a){e.disconnect()}))}};e.checkConnected=function(a){h.connected?(I&&clearInterval(I),A&&clearInterval(A),I=setInterval(function(){e.connectToSocket(a)},6E5),A=setInterval(function(){e.sendStatus(1)},12E5)):e.connectToSocket(a)};e.connectToSocket=function(a){if(!h.connected){if(a&&"block"===O.css("display"))if(a=G.data("mck-id")){var b=G.data("isgroup"),c=G.data("mck-conversationid"),f=G.data("mck-topicid");
C.clearMckMessageArray();m.loadTab({tabId:a,isGroup:b,conversationId:c,topicId:f})}else C.clearMckMessageArray(),m.loadTab({tabId:"",isGroup:!1});e.init()}};e.stopConnectedCheck=function(){I&&clearInterval(I);A&&clearInterval(A);A=I="";e.disconnect()};e.disconnect=function(){h&&h.connected&&(e.sendStatus(0),h.disconnect())};e.unsubscibeToTypingChannel=function(){h&&h.connected&&v&&(1===xa&&e.sendTypingStatus(0,w),v.unsubscribe());v=null};e.unsubscibeToNotification=function(){h&&h.connected&&g&&g.unsubscribe();
g=null};e.subscibeToTypingChannel=function(a,b){a=b?a:z;h&&h.connected?v=h.subscribe("/topic/typing-"+S+"-"+a,e.onTypingStatus):e.reconnect()};e.subscribeToOpenGroup=function(a){if(h&&h.connected){var b=h.subscribe("/topic/group-"+S+"-"+a.contactId,e.onOpenGroupMessage);y.push(b.id);ub[a.contactId]=b.id}else e.reconnect()};e.sendTypingStatus=function(a,b){if(h&&h.connected){1===a&&1===xa&&h.send("/topic/typing-"+S+"-"+w,{"content-type":"text/plain"},S+","+z+","+a);if(b){if(b===w&&a===xa&&1===a)return;
w=b;h.send("/topic/typing-"+S+"-"+b,{"content-type":"text/plain"},S+","+z+","+a);setTimeout(function(){xa=0},6E4)}else 0===a&&h.send("/topic/typing-"+S+"-"+w,{"content-type":"text/plain"},S+","+z+","+a);xa=a}};e.onTypingStatus=function(a){if(null!=v&&v.id===a.headers.subscription){var b=a.body,c=b.split(",")[1];b=Number(b.split(",")[2]);var e=a.headers.destination.substring(a.headers.destination.lastIndexOf("-")+1,a.headers.destination.length),f=G.data("mck-id");a=G.data("isgroup");var g=mckGroupUtils.getGroup(f);
if(!pa[c]&&!Ha[c])if(1===b){if(!(z===c&&a||f!==c&&f!==e)){if(a=G.data("isgroup")){if(c!==z){if(t.authenticateGroupUser(g)||6===g.type&&!ia.disableChatForNonGroupMember)H.addClass("mck-tab-title-w-typing"),J.removeClass("vis").addClass("n-vis"),c=m.getTabDisplayName(c,!1),c=c.split(" ")[0],R.html(c+" "+MCK_LABELS["is.typing"]);7===g.type&&(H.addClass("mck-tab-title-w-typing"),R.html(MCK_LABELS["is.typing"]),J.html(""))}}else H.addClass("mck-tab-title-w-typing"),J.removeClass("vis").addClass("n-vis"),
R.html(MCK_LABELS.typing);M.removeClass("n-vis").addClass("vis");setTimeout(function(){H.removeClass("mck-tab-title-w-typing");M.removeClass("vis").addClass("n-vis");H.hasClass("undefined"===typeof g||7!=g.type)&&J.removeClass("n-vis").addClass("vis");R.html(MCK_LABELS.typing)},6E4)}}else H.removeClass("mck-tab-title-w-typing"),M.removeClass("vis").addClass("n-vis"),!H.hasClass("mck-tab-title-w-status")||"undefined"!==typeof g&&7==g.type||J.removeClass("n-vis").addClass("vis"),R.html(MCK_LABELS.typing)}};
e.reconnect=function(){e.unsubscibeToTypingChannel();e.unsubscibeToNotification();e.disconnect();e.init()};e.onError=function(a){c.console.log("Error in channel notification. "+a);f.onConnectFailed()};e.sendStatus=function(a){h&&h.connected&&h.send("/topic/status-v2",{"content-type":"text/plain"},n+","+oa+","+a)};e.onConnect=function(){h.connected?(g&&e.unsubscibeToNotification(),g=h.subscribe("/topic/"+n,e.onMessage),e.sendStatus(1),e.checkConnected(!0)):setTimeout(function(){g=h.subscribe("/topic/"+
n,e.onMessage);e.sendStatus(1);e.checkConnected(!0)},5E3);f.onConnect()};e.onOpenGroupMessage=function(b){if(-1!==y.indexOf(b.headers.subscription)){var c=a.parseJSON(b.body),e=c.type;b=c.message;if("APPLOZIC_03"===e)C.updateLatestMessage(b),0!==b.type&&4!==b.type&&(a("."+b.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),m.addTooltip(b.key)),f.onMessageSentUpdate({messageKey:b.key});else if("APPLOZIC_01"===e||"APPLOZIC_02"===e||"MESSAGE_RECEIVED"===e){C.updateLatestMessage(b);
var g=b.groupId?mckGroupUtils.getGroup(b.groupId):m.getContact(b.to);a("#mck-sidebox-content");G.data("mck-id");if("APPLOZIC_01"===e||"MESSAGE_RECEIVED"===e){var h=m.getMessageFeed(b);f.onMessageReceived({message:h})}else"APPLOZIC_02"===e&&(h=m.getMessageFeed(b),f.onMessageSent({message:h}));b.conversationId&&(h=U[b.conversationId],!Ca&&!Pa||"object"===typeof h&&"object"===typeof T[h.topicId]||x.getTopicId({conversationId:b.conversationId,messageType:e,message:b,notifyUser:c.notifyUser,async:!1,populate:!1}));
"undefined"===typeof g?(c={message:b,messageType:e,notifyUser:c.notifyUser},b.groupId?t.getGroupFeedFromMessage(c):(e=[],e.push(b.to),X.getUsersDetail(e,c))):m.populateMessage(e,b,c.notifyUser)}}};e.onMessage=function(b){if(null!=g&&g.id===b.headers.subscription){b=a.parseJSON(b.body);var e=b.type;if("APPLOZIC_04"===e||"MESSAGE_DELIVERED"===e)a("."+b.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),m.addTooltip(b.message.split(",")[0]),
f.onMessageDelivered({messageKey:b.message.split(",")[0]});else if("APPLOZIC_08"===e||"MT_MESSAGE_DELIVERED_READ"===e)a("."+b.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),m.addTooltip(b.message.split(",")[0]),f.onMessageRead({messageKey:b.message.split(",")[0]});else if("APPLOZIC_05"===e){var h=b.message.split(",")[0];var p=b.message.split(",")[1];var n="1"===b.message.split(",")[2]?
!0:!1;m.removedDeletedMessage(h,p,n);b={messageKey:b.message.split(",")[0]};n?b.groupId=p:b.userKey=p;f.onMessageDeleted(b)}else if("APPLOZIC_27"===e)h=b.message.split(",")[0],b=b.message.split(",")[1],"undefined"!==typeof h&&(m.removeConversationThread(h,!1),m.updateUnreadCount("user_"+h,0,!0),n={userId:h},b&&(n.topicId=b),f.onConversationDeleted(n));else if("APPLOZIC_11"===e){h=b.message;n=m.fetchContact(h);p=G.data("mck-id");if(!pa[h]&&!Ha[h]){if(p!==n.contactId||G.data("isgroup")){var w=mckContactUtils.formatContactId(h);
a("#li-user-"+w+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else a("#mck-tab-status").html(MCK_LABELS.online),gb&&m.hideOfflineMessage();a(".mck-user-ol-status."+w).removeClass("n-vis").addClass("vis");a(".mck-user-ol-status."+w).next().html("("+MCK_LABELS.online+")");c.MCK_OL_MAP[h]=!0;ca.updateUserStatus({userId:b.message,status:1})}f.onUserConnect({userId:b.message})}else if("APPLOZIC_12"===e)h=b.message.split(",")[0],b=b.message.split(",")[1],n=m.fetchContact(h),c.MCK_OL_MAP[h]=!1,
b&&(Z[h]=b),pa[h]||Ha[h]||(p=G.data("mck-id"),p!==n.contactId||G.data("isgroup")||(a("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(b)),gb&&eb.manageOfflineMessageTime(p)),a(".mck-user-ol-status."+n.htmlId).removeClass("vis").addClass("n-vis"),a(".mck-user-ol-status."+n.htmlId).next().html("(Offline)"),a("#li-user-"+w+" .mck-ol-status").removeClass("vis").addClass("n-vis"),ca.updateUserStatus({userId:h,status:0,lastSeenAtTime:b})),f.onUserDisconnect({userId:h,lastSeenAtTime:b});else if("APPLOZIC_29"===
e){h=b.message.split(",")[0];b=b.message.split(",")[1];n=m.fetchContact(h);m.updateUnreadCount("user_"+n.contactId,0,!0);p=G.data("mck-id");if("undefined"===typeof p||""===p)a("#li-user-"+n.htmlId+" .mck-unread-count-text").html(m.getUnreadCount("user_"+n.contactId)),a("#li-user-"+n.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");n={userId:h};b&&(n.topicId=b);f.onConversationReadFromOtherSource(n)}else if("APPLOZIC_28"===e)h=b.message.split(",")[0],b=b.message.split(",")[1],
p=G.data("mck-id"),p===h&&(a(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),a(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),n=m.getContact(h),"undefined"===typeof n&&(n=[],n.push(h),X.getUsersDetail(n,{}))),n={userId:h},b&&(n.topicId=b),f.onConversationRead(n);else if("APPLOZIC_16"===e)e=b.message.split(":")[0],h=b.message.split(":")[1],n=m.fetchContact(h),p=G.data("mck-id"),
p===n.contactId?e===dc[0]?(pa[n.contactId]=!0,ca.toggleBlockUser(p,!0)):(Ha[n.contactId]=!0,H.removeClass("mck-tab-title-w-status"),J.removeClass("vis").addClass("n-vis"),M.removeClass("vis").addClass("n-vis")):a("#li-user-"+n.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),f.onUserBlocked({status:e,userId:h});else if("APPLOZIC_17"===e){e=b.message.split(":")[0];h=b.message.split(":")[1];n=m.fetchContact(h);p=G.data("mck-id");if(p===n.contactId)if(e===dc[2])pa[n.contactId]=!1,ca.toggleBlockUser(p,
!1);else{if(c.MCK_OL_MAP[p]||Z[p])Ha[n.contactId]=!1,pa[p]||(c.MCK_OL_MAP[p]?J.html(MCK_LABELS.online):Z[p]&&J.html(mckDateUtils.getLastSeenAtStatus(Z[p])),H.addClass("mck-tab-title-w-status"),J.removeClass("n-vis").addClass("vis"))}else c.MCK_OL_MAP[p]&&a("#li-user-"+n.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis");f.onUserUnblocked({status:e,userId:h})}else if("APPLOZIC_18"===e)fb=!1,f.onUserActivated();else if("APPLOZIC_19"===e)fb=!0,f.onUserDeactivated();else if(h=b.message,"APPLOZIC_03"===
e)C.updateLatestMessage(h),0!==h.type&&4!==h.type&&(a("."+h.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),m.addTooltip(h.key)),f.onMessageSentUpdate({messageKey:h.key});else if("APPLOZIC_01"===e||"APPLOZIC_02"===e||"MESSAGE_RECEIVED"===e)C.updateLatestMessage(h),n=h.groupId?mckGroupUtils.getGroup(h.groupId):m.getContact(h.to),a("#mck-sidebox-content"),p=G.data("mck-id"),"APPLOZIC_01"===e||"MESSAGE_RECEIVED"===e?(p=m.getMessageFeed(h),f.onMessageReceived({message:p})):
"APPLOZIC_02"===e&&(p=m.getMessageFeed(h),f.onMessageSent({message:p})),h.conversationId&&(p=U[h.conversationId],!Ca&&!Pa||"object"===typeof p&&"object"===typeof T[p.topicId]||x.getTopicId({conversationId:h.conversationId,messageType:e,message:h,notifyUser:b.notifyUser,async:!1,populate:!1})),"undefined"===typeof n?(b={message:h,messageType:e,notifyUser:b.notifyUser},h.groupId?t.getGroupFeedFromMessage(b):(n=[],n.push(h.to),X.getUsersDetail(n,b))):(102==h.contentType&&Oa&&(b.notifyUser=!1,4==h.type&&
"CALL_DIALED"==h.metadata.MSG_TYPE?(n=m.fetchContact(h.to),p=m.getTabDisplayName(n.contactId,!1),n=m.getContactImageLink(n,p),a("#mck-video-call-indicator").data("call-id",h.metadata.CALL_ID),a("#mck-video-call-indicator").data("isAudioCall",h.metadata.CALL_AUDIO_ONLY),a("#mck-video-call-indicator-txt").html(p+" calling..."),a("#mck-video-call-icon").html(n),a("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),na.play(),setTimeout(function(){a("#mck-video-call-indicator").data("callReceived")||
(console.log("call is not answered"),na.stop(),a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==h.type&&"CALL_REJECTED"==h.metadata.MSG_TYPE&&a("#mck-btn-video-call").data("isCallHost")&&(x.sendVideoCallMessage(h.metadata.CALL_ID,"CALL_REJECTED",103,!1),fa.ringToneForHost.stop(),fa.outgoingCallServices.twilioService.leaveRoomIfJoined(),fa.hideVideoBox(),fa.outgoingCallServices&&(fa.outgoingCallServices.rejectedByReceiver=!0))),103==h.contentType?4==h.type&&"CALL_MISSED"==
h.metadata.MSG_TYPE&&(a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),na&&na.stop()):m.populateMessage(e,h,b.notifyUser))}}}(g);g.getOptions=function(){return f};g.init=function(){Ba.loop=!1;Ea=new RingToneService;kc=Ea.loadRingTone(oc,Ba);x.init();la.init();eb.initializeApp(f,!1);Va.init();Ib.init();m.initEmojis();Oa&&(Ba.loop=!0,Ea=new RingToneService,na=Ea.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",Ba),fa.init())};g.reInit=
function(b){"object"===a.type(b)&&(b=a.extend(!0,{},v,b),a.fn.applozic("reset",b),b.userId&&b.appId&&""!==a.trim(b.userId)&&""!==a.trim(b.appId)?(eb.initializeApp(b,!0),f=b):c.console("Oops! looks like incorrect application id or user Id."))};g.loadTabView=function(b){"undefined"===typeof b.isGroup&&(b.isGroup=!1);m.loadTab(b);a("#mck-search").val("")};g.loadTab=function(b,c){m.loadTab({tabId:b,isGroup:!1},c);a("#mck-search").val("")};g.loadChat=function(b){if(!("undefined"!==typeof b.userId&&""!==
b.userId||"undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId))return"UserId or groupId or clientGroupId required";var c={};b.userId&&(c.tabId=userId,c.isGroup=!1);b.displayName&&(c.userName=b.displayName);b.convId&&(c.conversationId=b.convId);if(b.groupId||b.clientGroupId)if(c.isGroup=!0,b.clientGroupId){c.clientGroupId=b.clientGroupId;var e=mckGroupUtils.getGroupByClientGroupId(b.clientGroupId);if("object"===typeof e)c.tabId=e.contactId;else{mckGroupService.getGroupFeed({clientGroupId:c.clientGroupId,
apzCallback:t.onGroupFeed,callback:t.loadGroupTab});a("#mck-search").val("");return}}else if(e=mckGroupUtils.getGroup(b.groupId),"object"===typeof e)c.tabId=b.groupId;else{mckGroupService.getGroupFeed({groupId:b.groupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});a("#mck-search").val("");return}m.loadTab(c);a("#mck-search").val("")};g.uploadFile=function(a){la.uploadFile(a)};g.audioAttach=function(a){la.audioRecoder(a)};g.loadGroupTab=function(b){if("undefined"===typeof b||""===b)return"GroupId required";
"object"===typeof mckGroupUtils.getGroup(b)?(m.loadTab({tabId:b,isGroup:!0}),a("#mck-search").val("")):mckGroupService.getGroupFeed({groupId:b,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};g.loadGroupTabByClientGroupId=function(b){if("undefined"===typeof b.clientGroupId||""===b.clientGroupId)return"Client Group Id Required";var c=mckGroupUtils.getGroupByClientGroupId(b.clientGroupId);"object"===typeof c?(m.loadTab({tabId:c.contactId,isGroup:!0}),a("#mck-search").val("")):mckGroupService.getGroupFeed({clientGroupId:b.clientGroupId,
apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};g.loadConvTab=function(a){"object"===typeof a&&a.userId&&a.convId&&m.loadTab({tabId:a.userId,conversationId:a.convId,isGroup:!1})};g.loadTabWithTopic=function(a){if("object"===typeof a&&a.userId&&a.topicId){var b={tabId:a.userId,topicId:a.topicId};a.userName&&(b.userName=a.userName);b.topicStatus=a.topicStatus?-1===J.indexOf(a.topicStatus)?J[0]:a.topicStatus.toString():J[0];if("function"===typeof Aa){var c=Aa(a.topicId);"object"===typeof c&&"undefined"!==
c.title&&(T[a.topicId]=c)}a.message?(b.messagePxy={type:5,contentType:0,message:message},b.isMessage=!0):b.isMessage=!1;a.supportId?(b.isGroup=!0,b.supportId=supportId):b.isGroup=!1;x.getConversationId(b)}else{if(!a.userId)return"UserId required";if(!a.topicId)return"TopicId required"}};g.loadContacts=function(a){m.loadContacts(a)};g.setOffline=function(){"undefined"!==typeof aa&&aa.sendStatus(0)};g.reset=function(b){c.sessionStorage.clear();w=n="";I=[];MCK_GROUP_MAP=[];rb=!0;Na=[];oa="";tb=b.mode;
pa=[];Ha=[];Ga=!1;Ia=90;S=b.appId;Z=[];U=[];T=[];MCK_CLIENT_GROUP_MAP=[];sb=!0;MCK_LABELS=b.labels;H=0;MCK_BASE_URL=b.baseUrl;da={};Sa=[];cb=b.launcher;ub=[];Ob=b.userName;Ja=b.visitor;qa=[];Ta=[];Qa={};O=b.fileBaseUrl;db=b.locShare;Oa=f.video;M=b.onInit;xb=b.onTopicDetails;ta=[];La=[];yb=b.onClose;ra=b.accessToken;zb=b.displayText;Ya=b.readConversation;R=b.maxGroupSize;ba=[];Ab=b.onTabClicked;Pb=b.contactNumber;Bb=b.appModuleName;Aa=b.getTopicDetail;ea=b.maxAttachmentSize;Cb=b.validateMessage;Za=
b.contactDisplayName;Ua=[];Ka=b.finalPriceResponse;$a=b.contactDisplayImage;Db=b.priceWidget;ia=f.openGroupSettings;ya=b.offlineMessageDetail;Eb=b.getConversationDetail;kb=b.authenticationTypeId;z=Ja?"guest":a.trim(b.userId);Sb=db?b.googleApiKey:"NO_ACCESS";lb="boolean"===typeof b.olStatus?b.olStatus:!1;Pa="boolean"===typeof b.topicBox?b.topicBox:!1;gb="boolean"===typeof b.showOfflineMessage?b.showOfflineMessage:!1;Ca="boolean"===typeof b.topicHeader?b.topicHeader:!1;$b="boolean"===typeof b.notification?
b.notification:!0;ac="boolean"===typeof b.swNotification?b.swNotification:!1;Yb=b.supportId?'data-mck-id\x3d"'+b.supportId+'"':"";Ub="boolean"===typeof b.hideGroupSubtitle?b.hideGroupSubtitle:!1;Vb="undefined"===typeof b.defaultMessageMetaData?{}:b.defaultMessageMetaData;Fb="boolean"===typeof b.groupUserCount?b.groupUserCount:!1;Zb="boolean"===typeof b.desktopNotification?b.desktopNotification:!1;Gb="boolean"===typeof b.loadOwnContacts?b.loadOwnContacts:!1;Tb="boolean"===typeof b.messageBubbleAvator?
b.messageBubbleAvator:!1;Xb="boolean"===typeof f.resetUserStatus?f.resetUserStatus:!1;mb="boolean"===typeof b.launchOnNewMessage?b.launchOnNewMessage:!1;bc="boolean"===typeof b.autoTypeSearchEnabled?b.autoTypeSearchEnabled:!0;Wb="boolean"===typeof b.checkUserBusyWithStatus?b.checkUserBusyWithStatus:!1;Hb="boolean"===typeof b.launchOnUnreadMessage?b.launchOnUnreadMessage:!1;jc=f.isAnonymousChat};g.logout=function(){"undefined"!==typeof aa&&(aa.disconnect(),C.clearMckMessageArray(),a.fn.applozic("reset",
f),a("#mck-sidebox").hide(),a("#mck-sidebox-launcher").hide());rb=!1};g.setOnline=function(){"undefined"!==typeof aa&&aa.sendStatus(1)};g.getUserStatus=function(a){"function"===typeof a.callback&&("undefined"!==typeof a.userIds?X.getUsersDetail(a.userIds,a):X.getUserStatus(a))};g.getGroupList=function(a){return"function"===typeof a.callback?(a.apzCallback=t.loadGroups,mckGroupService.loadGroups(a),"success"):"Callback Function Required"};g.leaveGroup=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";
if("function"===typeof a.callback){if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)return a.apzCallback=t.onGroupLeft,mckGroupService.leaveGroup(a),"success";a.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};g.addGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&
""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else if("undefined"!==typeof a.role&&-1===vb.indexOf(a.role))a.callback({status:"error",errorMessage:"Incorrect member role"});else return X.loadUserProfile(a.userId),a.apzCallback=t.onAddedGroupMember,mckGroupService.addGroupMember(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});
else return"Callback function required"};g.removeGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else return a.apzCallback=t.onRemovedGroupMember,mckGroupService.removeGroupMember(a),"success";else a.callback({status:"error",
errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};g.updateGroupInfo=function(b){if("object"!==typeof b)return"Unsupported format. Please check format";if("function"===typeof b.callback)if("undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId){if("undefined"!==typeof b.name&&""!==b.name||"undefined"!==typeof b.imageUrl&&""!==b.imageUrl||b.users&&0!==b.users.length){if(b.users&&0<b.users.length){var c=[];
a.each(b.users,function(a,b){b.userId&&"undefined"!==typeof b.role&&-1!==vb.indexOf(b.role)&&c.push(b)});if(0===c.length){b.callback({status:"error",errorMessage:"Incorrect users detail"});return}}c=[];a(".mck-group-change-role-box.vis").each(function(b,e){b=a(this);e=parseInt(b.find("select").val());var f=b.parents(".mck-li-group-member").data("role");e!==f&&(b={userId:b.parents(".mck-li-group-member").data("mck-id"),role:e},c.push(b))});b.apzCallback=t.onUpdateGroupInfo;mckGroupService.updateGroupInfo(b);
return"success"}b.callback({status:"error",errorMessage:"Group properties required"})}else b.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};g.getMessages=function(a){"function"===typeof a.callback&&x.getMessages(a)};g.getMessageList=function(a){return"undefined"!==typeof a&&"function"===typeof a.callback?(x.getMessageList(a),"success"):"Callback function required"};g.getMessageListByTopicId=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";
if("function"===typeof a.callback)if("undefined"!==typeof a.id&&""!==a.id||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if(a.id&&"boolean"!==typeof a.isGroup)a.callback({status:"error",errorMessage:"IsGroup parameter required"});else{if(a.topicId){a.id&&(a.tabId=a.id);a.topicStatus=J[0];var b=qa[a.topicId];b&&"object"===typeof U[b]?(a.conversationId=b,x.getMessageList(a)):(a.isExtMessageList=!0,a.pageSize=1,x.fetchConversationByTopicId(a));return"success"}a.callback("TopicId required")}else a.callback({status:"error",
errorMessage:"Id or clientGroupId required"});else return"Callback function required."};g.sendMessage=function(b){if("object"===typeof b){b=a.extend(!0,{},y,b);var c=b.message;if(!b.to)return"To field required";if("undefined"===typeof c||""===c)return"Message field required";if(12<b.type)return"Invalid message type";c=a.trim(c);b={to:a.trim(b.to),type:b.messageType,contentType:b.type,message:c};x.sendMessage(b);return"success"}return"Unsupported format. Please check format"};g.updateUserIdentity=
function(a){X.updateUserIdentity(a)};g.updateUser=function(a){X.updateUser(a)};g.getGroupListByFilter=function(a){mckGroupService.getGroupByFilter(a)};g.sendGroupMessage=function(b){if("object"===typeof b){b=a.extend(!0,{},y,b);var c=b.message;if(!b.groupId&&!b.clientGroupId)return"groupId or clientGroupId required";if("undefined"===typeof c||""===c)return"message field required";if(12<b.type)return"invalid message type";c=a.trim(c);c={type:b.messageType,contentType:b.type,message:c,metadata:b.metadata||
{}};if(b.groupId)c.groupId=a.trim(b.groupId);else if(b.clientGroupId){if("undefined"===typeof mckGroupUtils.getGroupByClientGroupId(b.clientGroupId))return"group not found";c.clientGroupId=a.trim(b.clientGroupId)}x.sendMessage(c);return"success"}return"Unsupported format. Please check format"};g.addWelcomeMessage=function(a){if("object"===typeof a){if("undefined"===typeof a.sender||""===a.sender)return"Sender Field Required";if("undefined"===typeof a.messageContent||""===a.messageContent)return"Message Content Required";
x.sendWelcomeMessage(a)}else return"Unsupported format. Please check format"};g.createGroup=function(a){if("object"===typeof a){if("function"===typeof a.callback){var b=a.users;if("undefined"===typeof b||1>b.length){a.callback({status:"error",errorMessage:"Users list required"});return}if(b.length>R){a.callback({status:"error",errorMessage:"Users limit exceeds "+R+". Max number of users allowed is "+R+"."});return}if(!a.groupName){a.callback({status:"error",errorMessage:"Group name required"});return}if("undefined"===
typeof a.type||""===a.type){a.callback({status:"error",errorMessage:"Group type required"});return}if(-1===wb.indexOf(a.type)){a.callback({status:"error",errorMessage:"Invalid group type"});return}x.getGroup(a);return"success"}return"Callback function required"}return"Unsupported Format. Please check format"};g.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";if(b.length>R)return"Users limit exceeds "+R+". Max number of users allowed is "+
R+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===wb.indexOf(a.type))return"Invalid group type";x.getGroup(a);return"success"}return"Unsupported format. Please check format"};g.getTotalUnreadCount=function(){return H};g.subscribeToEvents=function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(g.events.onConnectFailed=a.onConnectFailed),"function"===typeof a.onConnect&&(g.events.onConnect=a.onConnect),"function"===
typeof a.onMessageDelivered&&(g.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(g.events.onMessageRead=a.onMessageRead),"function"===typeof a.onMessageDeleted&&(g.events.onMessageDeleted=a.onMessageDeleted),"function"===typeof a.onConversationDeleted&&(g.events.onConversationDeleted=a.onConversationDeleted),"function"===typeof a.onUserConnect&&(g.events.onUserConnect=a.onUserConnect),"function"===typeof a.onUserDisconnect&&(g.events.onUserDisconnect=a.onUserDisconnect),
"function"===typeof a.onConversationReadFromOtherSource&&(g.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&(g.events.onConversationRead=a.onConversationRead),"function"===typeof a.onMessageReceived&&(g.events.onMessageReceived=a.onMessageReceived),"function"===typeof a.onMessageSentUpdate&&(g.events.onMessageSentUpdate=a.onMessageSentUpdate),"function"===typeof a.onMessageSent&&(g.events.onMessageSent=a.onMessageSent),"function"===
typeof a.onUserBlocked&&(g.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(g.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&(g.events.onUserActivated=a.onUserActivated),"function"===typeof a.onUserDeactivated&&(g.events.onUserDeactivated=a.onUserDeactivated))};g.getConversation=function(a){x.getTopicId({conversationId:a.conversationId})}}c.applozic||(c.applozic=c.applozic?c.applozic:{},a.extend(!0,c.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));
var v={baseUrl:"https://chat.kommunicate.io",fileBaseUrl:"https://applozic.appspot.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",launcher:"applozic-launcher",userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,awsS3Server:!1,groupUserCount:!1,desktopNotification:!0,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,
authenticationTypeId:0,isAnonymousChat:!0,groupName:"Kommunicate",agentId:"",agentName:"",labels:{"conversations.title":"Conversations","start.new":"Start New Conversation","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location",
"create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!",
"block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User",
"unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",ago:"ago","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",
ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},
y={messageType:5,type:0};a.fn.applozic=function(c,e,y){var f=a("#mck-sidebox");"object"===a.type(c)&&(c=a.extend(!0,{},v,c),c.conversationTitle=c.conversationTitle||c.groupName);if("undefined"!==typeof f.data("applozic_instance"))if(f=f.data("applozic_instance"),"string"===a.type(c))switch(c){case "reInitialize":return f.reInit(e);case "loadConvTab":f.loadConvTab(e);break;case "loadTab":f.loadTab(e,y);break;case "uploadFile":f.uploadFile(e);break;case "loadTabView":f.loadTabView(e);break;case "loadChat":f.loadChat(e);
break;case "loadContextualTab":return f.loadTabWithTopic(e);case "audioAttach":f.audioAttach(e);break;case "addWelcomeMessage":f.addWelcomeMessage(e);break;case "loadContacts":f.loadContacts(e);break;case "sendMessage":return f.sendMessage(e);case "sendGroupMessage":return f.sendGroupMessage(e);case "createGroup":return f.createGroup(e);case "loadBroadcastTab":return e.groupName=e.groupName?e.groupName:"Broadcast",e.type=5,f.initGroupTab(e);case "initBroadcastTab":return e.groupName=e.groupName?e.groupName:
"Broadcast",e.type=5,f.initGroupTab(e);case "initGroupTab":return f.initGroupTab(e);case "loadGroupTab":return f.loadGroupTab(e);case "loadGroupTabByClientGroupId":return f.loadGroupTabByClientGroupId(e);case "setOffline":return f.setOffline(),"success";case "setOnline":return f.setOffline(),"success";case "logout":return f.logout(),"success";case "reset":f.reset(e);break;case "getUserDetail":return f.getUserStatus(e),"success";case "getGroupList":return f.getGroupList(e),"success";case "leaveGroup":return f.leaveGroup(e);
case "addGroupMember":return f.addGroupMember(e);case "removeGroupMember":return f.removeGroupMember(e);case "updateGroupInfo":return f.updateGroupInfo(e);case "getMessages":f.getMessages(e);break;case "messageList":return f.getMessageList(e);case "getMessageListByTopicId":return f.getMessageListByTopicId(e);case "getTotalUnreadCount":return f.getTotalUnreadCount();case "subscribeToEvents":return f.subscribeToEvents(e);case "getConversation":return f.getConversation(e);case "loadConversationWithAgent":return f.loadConversationWithAgent(e);
case "updateUserIdentity":return f.updateUserIdentity(e);case "updateUser":return f.updateUser(e);case "getGroupListByFilter":return f.getGroupListByFilter(e)}else"object"===a.type(c)&&f.reInit(c);else"object"===a.type(c)&&(c.userId&&c.appId&&""!==a.trim(c.userId)&&""!==a.trim(c.appId)?"undefined"!==typeof f.data("applozic_instance")?(f=f.data("applozic_instance"),f.reInit(c)):(jQuery="undefined"!==typeof c.ojq?$=c.ojq:$=a,"function"===typeof c.obsm?($.fn.modal=c.obsm,jQuery.fn.modal=c.obsm):"function"===
typeof a.fn.modal?(e=a.fn.modal.noConflict(),$.fn.modal=e,jQuery.fn.modal=e):"function"===typeof $.fn.modal&&(e=$.fn.modal.noConflict(),$.fn.modal=e,jQuery.fn.modal=e),"function"===typeof c.omckm?a.fn.mckModal=c.omckm:"function"===typeof a.fn.mckModal?a.fn.mckModal=a.fn.mckModal.noConflict():"function"===typeof $.fn.mckModal&&(a.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(a.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof a.fn.linkify&&($.fn.linkify=
a.fn.linkify,jQuery.fn.linkify=a.fn.linkify),"function"===typeof $.fn.emojiarea?a.fn.emojiarea=$.fn.emojiarea:"function"===typeof a.fn.emojiarea&&($.fn.emojiarea=a.fn.emojiarea,jQuery.fn.emojiarea=a.fn.emojiarea),"function"===typeof $.fn.locationpicker?a.fn.locationpicker=$.fn.locationpicker:"function"===typeof a.fn.locationpicker&&($.fn.locationpicker=a.fn.locationpicker,jQuery.fn.locationpicker=a.fn.locationpicker),c=new n(c),f.data("applozic_instance",c),c.init()):alert("Oops! looks like incorrect application id or user Id."))};
a.fn.applozic.defaults=v})($applozic,window,document);
Kommunicate.attachEvents=function(a){a("#mck-message-cell").on("click",".km-increment-guest-count",Kommunicate.richMsgEventHandler.incrementGuestCount);a("#mck-message-cell").on("click",".km-decrement-guest-count",Kommunicate.richMsgEventHandler.decrementGuestCount);a("#mck-message-cell").on("click",".km-btn-add-more-rooms",Kommunicate.richMsgEventHandler.addMoreRoom);a("#mck-message-cell").on("click",".km-done-button",Kommunicate.richMsgEventHandler.processSelectedRoom);a("#mck-message-cell").on("click",
".km-card-message-footer-button",Kommunicate.richMsgEventHandler.processHotelBookClick);a("#mck-message-cell").on("click",".km-cta-button",Kommunicate.richMsgEventHandler.handlleRichButtonClick);a("#mck-message-cell").on("click",".km-submit-person-detail",Kommunicate.richMsgEventHandler.handlleSubmitPersonDetail);a("#mck-message-cell").on("click",".km-block-room-button",Kommunicate.richMsgEventHandler.processBookRoomClick);a("#mck-message-cell").on("click",".km-quick-replies",Kommunicate.richMsgEventHandler.processQuickReplies);
a("#mck-message-cell").on("click",".km-list-item-handler",Kommunicate.richMsgEventHandler.processClickOnListItem);a("#mck-message-cell").on("click",".km-list-button-item-handler",Kommunicate.richMsgEventHandler.processClickOnButtonItem);a("#mck-message-cell").on("click",".km-faq-dialog-button",Kommunicate.richMsgEventHandler.processClickOnDialogButton)};
Kommunicate.richMsgEventHandler={initializeSlick:function(a){0<a.length&&tns({container:a[0],items:1,slideBy:"page",mouseDrag:!0,arrowKeys:!0,onInit:function(){console.log("tiny-slider initilized");document.querySelector(".km-slick-container .tns-controls button:first-child").innerHTML="\x3c";document.querySelector(".km-slick-container .tns-controls button:last-child").innerHTML="\x3e"}})},decrementGuestCount:function(a){a=a.target||a.srcElement;var c=a.dataset.type;"guest"==c?a.parentElement.getElementsByClassName("km-room-number-field")[0].stepDown():
"children"==c&&a.parentElement.getElementsByClassName("km-person-number-field")[0].stepDown()},incrementGuestCount:function(a){a=a.target||a.srcElement;var c=a.dataset.type;"guest"==c?a.parentElement.getElementsByClassName("km-room-number-field")[0].stepUp():"children"==c&&a.parentElement.getElementsByClassName("km-person-number-field")[0].stepUp()},decrementPersonCount:function(){document.getElementById("km-person-number-field").stepDown()},incrementPersonCount:function(){document.getElementById("km-person-number-field").stepUp()},
addMoreRoom:function(a){var c=a.target.parentElement.parentElement.parentElement,e=Number(a.target.dataset.roomcount)+1;a.target.setAttribute("data-roomcount",e);a=document.createElement("div");a.innerHTML=Kommunicate.markup.getSingleRoomPaxInfo(e);c.getElementsByClassName("km-room-person-selector-container")[0].appendChild(a)},processSelectedRoom:function(a){var c=[],e=$(a.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-room-number-field");a=
$(a.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-person-number-field");for(var n="",v=0;v<e.length;v++){var y=a[v].value,f=Array(1*y).fill(10);c.push({NoOfAdults:e[v].value,NoOfChild:y,ChildAge:f});n+="Room "+(v+1)+" Guest "+e[v].value+"\n"}c={message:n,metadata:{isRoomGuestJSON:!0,roomGuestJson:JSON.stringify(c),guestTypeId:"ADULTS"}};Kommunicate.sendMessage(c)},processHotelBookClick:function(a){a=a.target||a.srcElement;var c=a.dataset.sessionid,
e=a.dataset.resultindex;a={message:"Get room detail of "+a.dataset.name.replace("_"," "),metadata:{hotelSelected:!0,sessionId:c,resultIndex:e,skipBot:!0}};Kommunicate.sendMessage(a)},processBookRoomClick:function(a){a=a.target||a.srcElement;var c=a.dataset.sessionid,e=a.dataset.roomindex,n=a.dataset.noofrooms,v=a.dataset.hotelresultindex;a={message:"Book "+("undefined"==a.dataset.hotelname?"":a.dataset.hotelname).replace("_"," "),metadata:{sessionId:c,RoomIndex:e,NoOfRooms:n,blockHotelRoom:!0,skipBot:!0,
HotelResultIndex:v}};c=$applozic("#mck-message-cell .mck-message-inner");e=$applozic("#mck-msg-to");!0===c.data("isgroup")?a.groupId=e.val():a.to=e.val();$applozic.fn.applozic("sendGroupMessage",a)},handlleRichButtonClick:function(a){console.log("event generated: ",a);a=a.target||a.srcElement;"km-eh-001"==a.dataset.eventhandlerid&&a.parentElement.getElementsByClassName("km-btn-hidden-form")[0].submit()},handlleSubmitPersonDetail:function(a){var c=$applozic(a.target).closest(".km-guest-details-container").find(".km-title-select option:selected").text(),
e=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.km-age-input"),n=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.first-name-input"),v=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.middle-name-input"),y=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.last-name-input"),f=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.e-mail-input"),
g=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.number-input");""==n[0].value?$(a.target).closest(".km-guest-details-container").find("input[type\x3dtext]").focus():(a={message:"Your detail submitted",metadata:{sessionId:(a.target||a.srcElement).dataset.sessionid,guestDetail:!0,skipBot:!0,personInfo:JSON.stringify({Title:"title"===c?"":c,Age:e[0].value,FirstName:n[0].value,MiddleName:v[0].value,LastName:y[0].value,EmailId:f[0].value,PhoneNo:g[0].value})}},
Kommunicate.sendMessage(a),console.log("passenger detail submitted"))},processQuickReplies:function(a){Kommunicate.sendMessage({message:a.target.title,metadata:{}})},processClickOnListItem:function(a){var c=a.currentTarget;a=c.dataset.reply;var e=c.dataset.type,n=c.dataset.articleid;c=c.dataset.source;e&&"quick_reply"==e&&Kommunicate.sendMessage({message:a,metadata:{KM_FAQ_ID:n,source:c}})},processClickOnButtonItem:function(a){var c=a.currentTarget;a=c.dataset.reply;(c=c.dataset.type)&&"quick_reply"==
c&&Kommunicate.sendMessage({message:a,metadata:{KM_BUTTON_CLICKED:!0}})},processClickOnDialogButton:function(a){Kommunicate.sendMessage({message:a.currentTarget.dataset.reply,metadata:{skipBot:!0}})}};
KommunicateUI={CONSTS:{},populateAwayMessage:function(a,c){var e=$applozic("#mck-tab-individual").hasClass("n-vis");!a&&"SUCCESS"==c.code&&0<c.data.length&&!e?(awayMessage=c.data[0].message,$applozic("#mck-away-msg").html(awayMessage),$applozic("#mck-away-msg-box").removeClass("n-vis").addClass("vis")):$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis")},hideAwayMessage:function(){$applozic("#mck-away-msg").html("");$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis")}};
Kommunicate.postPluginInitialization=function(a,c){$applozic.fn.applozic("subscribeToEvents",{onMessageReceived:function(a){a=a&&a.message;var c=a.metadata&&"HIDDEN"!=a.metadata.category&&"true"!=a.metadata.hide,e=c&&a.metadata&&"true"==a.metadata.skipBot;(!a.metadata||c&&!e)&&KommunicateUI.hideAwayMessage()}});KommunicateKB.init(Kommunicate.getBaseUrl());var e=KommunicateUtils.getDataFromKmSession("HELPDOCS_KEY");null==e||""==e?Kommunicate.client.getThirdPartySettings({appId:c.appId,type:1},function(a,
v){a?console.log("err : ",a):(console.log("data : ",v),v&&"SUCCESS"==v.code&&((a=v.message.find(function(a){return a.type==KommunicateConstants.THIRD_PARTY_APPLICATION.HELPDOCS}))?(e=a.accessKey,KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY",a.accessKey)):KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY","null"),Kommunicate.helpdocsInitialization(c,e)))}):Kommunicate.helpdocsInitialization(c,e)};
Kommunicate.helpdocsInitialization=function(a,c){"null"==c&&(c=null);KommunicateKB.getArticles({data:{appId:a.appId,query:"",helpdocsAccessKey:c},success:function(e){e.data&&0<e.data.length&&$applozic(".km-kb-container").hasClass("n-vis")&&$applozic(".km-kb-container").removeClass("n-vis").addClass("vis");$applozic.each(e.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cdiv class\x3d"km-faqimage"\x3e\x3c/div\x3e\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor"\x3e'+
c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")});Kommunicate.faqEvents(a,c)},error:function(){}})};
Kommunicate.faqEvents=function(a,c){var e;$applozic(d).on("click",".mck-sidebox-launcher",function(){Kommunicate.showChat()});$applozic(d).on("click","#mck-msg-preview",function(){Kommunicate.showChat()});$applozic(d).on("click",".km-faq-list",function(){$applozic("#km-faqanswer").empty();var e=$(this).attr("data-articleid"),v=$(this).attr("data-source");KommunicateKB.getArticle({data:{appId:a.appId,articleId:e,source:v,helpdocsAccessKey:c},success:function(a){0==$applozic("#km-faqanswer .km-faqanswer-list").length&&
($applozic("#km-faqanswer").append('\x3cdiv class\x3d"km-faqanswer-list km-faqanswer"\x3e\x3cdiv class\x3d"km-faqquestion"\x3e'+a.data.title+'\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor km-faqanswer"\x3e'+a.data.body+"\x3c/div\x3e\x3c/div\x3e"),$applozic(".mck-faq-inner").removeClass("vis").addClass("n-vis"),$applozic(".km-faqanswer").removeClass("n-vis").addClass("vis"),$applozic(".km-faqsearch").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"),
$applozic(".mck-sidebox-ft").removeClass("vis").addClass("n-vis"))},error:function(){}})});$applozic(d).on("click","#km-faq",function(){document.getElementById("km-faqdiv").hasChildNodes()?($applozic(".mck-message-inner").removeClass("vis").addClass("n-vis"),$applozic("#mck-conversation-title").removeClass("vis").addClass("n-vis"),$applozic("#mck-contacts-content").removeClass("vis").addClass("n-vis"),$applozic("#km-faq").removeClass("vis").addClass("n-vis"),$applozic(".mck-faq-inner").removeClass("n-vis").addClass("vis"),
$applozic(".km-faqback").removeClass("n-vis").addClass("vis"),$applozic(".km-faqtitle").removeClass("n-vis").addClass("vis"),$applozic(".km-faqsearch").removeClass("n-vis").addClass("vis"),$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"),$applozic(".mck-sidebox-ft").removeClass("vis").addClass("n-vis"),$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-msg-form").removeClass("vis").addClass("n-vis"),
$applozic("#mck-tab-individual").removeClass("vis").addClass("n-vis")):$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis")});$applozic(d).on("click","#km-faqanswer a",function(a){a.preventDefault();window.open(a.target.href)});$applozic("#km-faq-search-input").keydown(function(n){clearTimeout(e);e=setTimeout(function(){KommunicateKB.getArticles({data:{appId:a.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:c},success:function(a){$applozic("#km-faqdiv").empty();
$applozic.each(a.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cdiv class\x3d"km-faqimage"\x3e\x3c/div\x3e\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor"\x3e'+c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")})},error:function(){}})},2E3);32!=n.which&&13!=n.which||KommunicateKB.getArticles({data:{appId:a.appId,query:document.getElementById("km-faq-search-input").value,
helpdocsAccessKey:c},success:function(a){$applozic("#km-faqdiv").empty();$applozic.each(a.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cspan class\x3d"km-faqimage"/ \x3e\x3c/span\x3e \x3cdiv class\x3d"km-faqanchor "\x3e'+c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")})},error:function(){}})});$applozic(d).on("click",".km-faqback",function(){$applozic("#km-faqanswer").hasClass("vis")?
($applozic(".mck-faq-inner").removeClass("n-vis").addClass("vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic(".km-faqsearch").removeClass("n-vis").addClass("vis")):($applozic(".mck-message-inner").removeClass("n-vis").addClass("vis"),$applozic("#mck-conversation-title").removeClass("n-vis").addClass("vis"),$applozic("#mck-contacts-content").removeClass("n-vis").addClass("vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic(".mck-faq-inner").removeClass("vis").addClass("n-vis"),
$applozic(".km-faqback").removeClass("vis").addClass("n-vis"),$applozic(".km-faqtitle").removeClass("vis").addClass("n-vis"),$applozic(".km-faqsearch").removeClass("vis").addClass("n-vis"),$applozic("#mck-tab-conversation").removeClass("n-vis").addClass("vis"))})};
Kommunicate.showChat=function(){$applozic("#km-faqdiv").hasClass("vis")&&($applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),$applozic(".mck-message-inner").removeClass("n-vis").addClass("vis"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"));$applozic("#km-faqanswer").hasClass("vis")&&($applozic(".mck-message-inner").removeClass("n-vis").addClass("vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),
$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"))};