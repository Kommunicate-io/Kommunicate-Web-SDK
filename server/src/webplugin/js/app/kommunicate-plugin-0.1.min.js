var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,g,n){a instanceof String&&(a=String(a));for(var H=a.length,M=0;M<H;M++){var na=a[M];if(g.call(n,na,M,a))return{i:M,v:na}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,g,n){a!=Array.prototype&&a!=Object.prototype&&(a[g]=n.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,g,n,H){if(g){n=$jscomp.global;a=a.split(".");for(H=0;H<a.length-1;H++){var M=a[H];M in n||(n[M]={});n=n[M]}a=a[a.length-1];H=n[a];g=g(H);g!=H&&null!=g&&$jscomp.defineProperty(n,a,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,n){return $jscomp.findInternal(this,a,n).v}},"es6","es3");$jscomp.checkStringArgs=function(a,g,n){if(null==a)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(g instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,n){var g=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var M=g.length,na=a.length;n=Math.max(0,Math.min(n|0,g.length));for(var c=0;c<na&&n<M;)if(g[n++]!=a[c++])return!1;return c>=na}},"es6","es3");var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(a,g,n){function H(c){var l=this,y,H;MCK_GROUP_MAP=[];var E=[],ea,kb,qb=!0,za=[],wa=0;MCK_CLIENT_GROUP_MAP=[];var Ga=!1,oa=[],Ha=[],Ia=90,W=[],J=[],T=[],N=[],rb=!0,X=0,sb=c.mode;MCK_LABELS=c.labels;MCK_BASE_URL=c.baseUrl;var Z=c.appId,tb=[],ub=[0,1,2,3],vb=[1,2,5,6,10],pa=[],eb=!1,ab=c.launcher,lb=c.visitor,Lb=c.userName,bb=c.locShare,Pa=c.video,G=c.fileBaseUrl,K=c.onInit,wb=c.onTopicDetails,gc=[0,1,2],xb=c.onClose,yb=c.displayText,xa=c.accessToken,Wa=c.readConversation,O=c.maxGroupSize,
zb=c.onTabClicked,Mb=c.contactNumber,Aa=c.maxAttachmentSize,Ab=c.appModuleName,Ja=c.getTopicDetail,Qa=c.contactDisplayName,Bb=c.validateMessage,Ba=c.finalPriceResponse,Ra=c.contactDisplayImage,Cb=c.priceWidget,ha=c.openGroupSettings,aa=c.offlineMessageDetail,mb=c.authenticationTypeId,Db=c.getConversationDetail,hc=c.notificationIconLink,Nb=c.mapStaticAPIkey,ic=c.notificationSoundLink?c.notificationSoundLink:MCK_BASE_URL+"/resources/sidebox/audio/notification_tone.mp3",z=lb?"guest":a.trim(c.userId),
Ob=bb?c.googleApiKey:"NO_ACCESS",jc="undefined"===typeof c.source?1:c.source,Ma="boolean"===typeof c.topicBox?c.topicBox:!1,nb="boolean"===typeof c.olStatus?c.olStatus:!1,Pb="boolean"===typeof c.messageBubbleAvator?c.messageBubbleAvator:!1,fb="boolean"===typeof c.showOfflineMessage?c.showOfflineMessage:!1,Qb="boolean"===typeof c.hideGroupSubtitle?c.hideGroupSubtitle:!1,Rb="undefined"===typeof c.defaultMessageMetaData?{}:c.defaultMessageMetaData,Eb="boolean"===typeof c.groupUserCount?c.groupUserCount:
!1,Sb="boolean"===typeof c.checkUserBusyWithStatus?c.checkUserBusyWithStatus:!1,Tb="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1,Ca="boolean"===typeof c.topicHeader?c.topicHeader:!1,Ub=c.supportId?'data-mck-id\x3d"'+c.supportId+'"':"",Fb="boolean"===typeof c.loadOwnContacts?c.loadOwnContacts:!1,Vb="boolean"===typeof c.desktopNotification?c.desktopNotification:!1,Wb="boolean"===typeof c.notification?c.notification:!0,Xb="boolean"===typeof c.swNotification?c.swNotification:!1,Yb="boolean"===
typeof c.autoTypeSearchEnabled?c.autoTypeSearchEnabled:!0,ob="boolean"===typeof c.launchOnNewMessage?c.launchOnNewMessage:!1,Gb="boolean"===typeof c.launchOnUnreadMessage?c.launchOnUnreadMessage:!1,Zb="number"===typeof c.userTypeId?c.userTypeId:!1,F=["DEFAULT","NEW","OPEN"],$b=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],B=new function(){var b=this,e=[],c=[],l=[],f=[];b.updateLatestMessage=function(a){var e=[];e.push(a);b.updateLatestMessageArray(e);b.updateMckMessageArray(e)};b.getLatestMessageArray=
function(){return"undefined"!==typeof g.sessionStorage?a.parseJSON(g.sessionStorage.getItem("mckLatestMessageArray")):e};b.setLatestMessageArray=function(a){"undefined"!==typeof g.sessionStorage?g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(a)):e=a};b.updateLatestMessageArray=function(b){if("undefined"!==typeof g.sessionStorage){var f=a.parseJSON(g.sessionStorage.getItem("mckLatestMessageArray"));null!==f?(f=f.concat(b),g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(f))):
g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(b));return b}return e=e.concat(b)};b.getMckMessageArray=function(){return"undefined"!==typeof g.sessionStorage?a.parseJSON(g.sessionStorage.getItem("mckMessageArray")):c};b.clearMckMessageArray=function(){"undefined"!==typeof g.sessionStorage?(g.sessionStorage.removeItem("mckMessageArray"),g.sessionStorage.removeItem("mckLatestMessageArray")):(c.length=0,e.length=0)};b.clearAppHeaders=function(){"undefined"!==typeof g.sessionStorage&&
g.sessionStorage.removeItem("mckAppHeaders")};b.setAppHeaders=function(a){"undefined"!==typeof g.sessionStorage&&g.sessionStorage.setItem("mckAppHeaders",g.JSON.stringify(a))};b.getAppHeaders=function(b){return"undefined"!==typeof g.sessionStorage?a.parseJSON(g.sessionStorage.getItem("mckAppHeaders")):{}};b.getMessageByKey=function(a){return l[a]};b.updateMckMessageArray=function(b){for(var e=0;e<b.length;e++){var f=b[e];l[f.key]=f}return"undefined"!==typeof g.sessionStorage?(e=a.parseJSON(g.sessionStorage.getItem("mckMessageArray")),
null!==e?(e=e.concat(b),g.sessionStorage.setItem("mckMessageArray",g.JSON.stringify(e))):g.sessionStorage.setItem("mckMessageArray",g.JSON.stringify(b)),b):c=c.concat(b)};b.getMckContactNameArray=function(){return"undefined"!==typeof g.sessionStorage?a.parseJSON(g.sessionStorage.getItem("mckContactNameArray")):f};b.setMckContactNameArray=function(a){"undefined"!==typeof g.sessionStorage?g.sessionStorage.setItem("mckContactNameArray",g.JSON.stringify(a)):f=a};b.updateMckContactNameArray=function(b){if("undefined"!==
typeof g.sessionStorage){var e=a.parseJSON(g.sessionStorage.getItem("mckContactNameArray"));null!==e&&(b=b.concat(e));g.sessionStorage.setItem("mckContactNameArray",g.JSON.stringify(b));return b}return f=f.concat(b)};b.clearMckContactNameArray=function(){"undefined"!==typeof g.sessionStorage?g.sessionStorage.removeItem("mckContactNameArray"):f.length=0}},qa={},gb=[],Sa=[],Na={},ya=[],Da=[],Ta=[],Y=[],cb=new function(){var b=this,k=!1,c,l,f=a("#mck-file-menu"),x=a("#mck-message-cell .mck-message-inner");
a("#mck-tab-individual");var q=Ia;b.getLauncherHtml=function(){return'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher mck-button-launcher" '+("support"===sb?Ub:"")+'\x3e\x3cspan class\x3d"mck-icon-chat"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
b.initializeApp=function(e,f){k=f;var c={applicationId:e.appId,userId:z};null!==Lb&&(c.displayName=e.userName);null!==e.email&&(c.email=e.email);null!==Mb&&(c.contactNumber=e.contactNumber);e.imageLink&&(c.imageLink=e.imageLink);e.appModuleName&&(c.appModuleName=e.appModuleName);xa&&(c.password=e.accessToken);-1===gc.indexOf(mb)&&(mb=0);Tb&&(c.resetUserStatus=!0);"number"==typeof Zb&&(c.userTypeId=Zb);c.enableEncryption=!0;c.appVersionCode=108;c.authenticationTypeId=mb;ea=H="";b.validateAppSession(c)?
Pa&&ia.InitilizeVideoClient(z,ea):a.ajax({url:MCK_BASE_URL+"/v2/tab/initialize.page",type:"post",data:g.JSON.stringify(c),contentType:"application/json",headers:{"Application-Key":Z},success:function(e){Pa&&ia.InitilizeVideoClient(e.userId,e.deviceKey);"kommunicate"==window.applozic.PRODUCT_ID&&a("#km-chatLoginModal").removeClass("vis").addClass("n-vis");B.clearMckMessageArray();B.clearMckContactNameArray();"INVALID_PASSWORD"===e?"function"===typeof K&&K({status:"error",errorMessage:"INVALID PASSWORD"}):
"INVALID_APPID"===e?"function"===typeof K&&K({status:"error",errorMessage:"INVALID APPLICATION ID"}):"error"===e||"USER_NOT_FOUND"===e?"function"===typeof K&&K({status:"error",errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===e?"function"===typeof K&&K({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof e&&null!==e&&e.token?(e.appId=c.applicationId,xa&&(e.accessToken=c.password),b.onInitApp(e)):"function"===typeof K&&K({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})},
error:function(){B.clearMckMessageArray();"function"===typeof K&&K({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})};b.onInitApp=function(c){b.appendLauncher();b.setLabels();a(".applozic-launcher").each(function(){a(this).hasClass("mck-msg-preview")||a(this).show()});y=c.token;mckUtils.setEncryptionKey(c.encryptionKey);z=c.userId;ea=c.deviceKey;kb=c.websocketUrl;Ia=c.websocketIdleTimeLimit;G=c.fileBaseUrl;eb=c.deactivated;H=btoa(c.userId+":"+c.deviceKey);X=c.totalUnreadCount;lb||"guest"===
z||"0"===z||"C0"===z||(k?U.reconnect():U.init());e.createContactWithDetail({userId:z,displayName:c.displayName,photoLink:c.imageLink});a.ajaxPrefilter(function(a){a.beforeSend||-1===a.url.indexOf(MCK_BASE_URL)||(a.beforeSend=function(a){b.setHeaders(a)})});if(c.betaPackage){var f="https://www.applozic.com/?utm_source\x3d"+g.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";a(".mck-running-on a").attr("href",f);a(".mck-running-on").removeClass("n-vis").addClass("vis")}f=B.getMckContactNameArray();
if(null!==f&&0<f.length)for(var l=0;l<f.length;l++){var q=f[l];null!==q&&(ya[q[0]]=q[1])}ca.checkUserConnectedStatus();"function"===typeof K&&K("success",c);cb.tabFocused();0<Oa.length&&0<X&&Oa.html(X);Gb&&v.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});hb.subscribeToServiceWorker();B.setAppHeaders(c);mckGroupService.loadGroups({apzCallback:t.loadGroups})};b.validateAppSession=function(a){var e=B.getAppHeaders();if(e&&e.userId){if(a.applicationId===e.appId&&a.userId===e.userId&&a.password===
e.accessToken)return b.onInitApp(e),!0;B.clearAppHeaders()}return!1};b.setHeaders=function(a){a.setRequestHeader("UserId-Enabled",!0);H&&a.setRequestHeader("Authorization","Basic "+H);a.setRequestHeader("Application-Key",Z);ea&&a.setRequestHeader("Device-Key",ea);xa&&a.setRequestHeader("Access-Token",xa);Ab&&a.setRequestHeader("App-Module-Name",Ab)};b.setLabels=function(){a("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);a("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",
MCK_LABELS["start.new"]);a("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]);a("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]);a("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]);a("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]);a("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]);
a("#mck-no-messages").html(MCK_LABELS["empty.messages"]);a("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]);a("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]);a("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);a("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);a("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]);a("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);
a("#mck-msg-error").html(MCK_LABELS["group.deleted"]);a("#mck-gc-title-label").html(MCK_LABELS["group.title"]);a("#mck-gc-type-label").html(MCK_LABELS["group.type"]);a("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);a("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);a("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]);a("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",
MCK_LABELS["add.members.title"]);a("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);a("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);a("#mck-typing-label").html(MCK_LABELS.typing);a("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]);a("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);
a("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]);a("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);a("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);a("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);a(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);a("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);a("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",
MCK_LABELS.close);a("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send);a("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);a("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);a("#mck-group-name-save").attr("title",MCK_LABELS.save);a("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);a("#mck-group-name-edit").attr("title",MCK_LABELS.edit)};a(n).on("click",".fancybox",function(b){b=a(this);if(-1!==b.data("type").indexOf("video")){var e=b.find(".mck-video-box").html(),
c;b.fancybox({content:e,title:b.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){c=a(".fancybox-inner").find("video").get(0);c.load();c.play()}})}else b=b.data("url"),a(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:b,type:"image"})});a(g).on("resize",function(){"block"===f.css("display")&&Hb.fileMenuReposition();if(0===x.find(".mck-contact-list").length){var a=x.get(0).scrollHeight;
x.height()<a&&x.animate({scrollTop:x.prop("scrollHeight")},0)}});b.appendLauncher=function(){a("#mck-sidebox-launcher").remove();a("body").append(b.getLauncherHtml());hb.init()};b.tabFocused=function(){function a(a){var e={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};a=a||g.event;(rb=a.type in e?e[a.type]:this.hidden?!1:!0)?(1>q&&qb&&U.checkConnected(!0),b.stopIdleTimeCounter()):(1===wa&&U.sendTypingStatus(0),b.manageIdleTime())}"hidden"in n?n.addEventListener("visibilitychange",
a):!1 in n?n.addEventListener("mozvisibilitychange",a):!1 in n?n.addEventListener("webkitvisibilitychange",a):!1 in n?n.addEventListener("msvisibilitychange",a):"onfocusin"in n?n.onfocusin=n.onfocusout=a:g.onpageshow=g.onpagehide=g.onfocus=g.onblur=a;void 0!==n.hidden&&a({type:n.hidden?"blur":"focus"})};b.manageIdleTime=function(){q=Ia;c&&clearInterval(c);c=setInterval(function(){0>--q&&(q=0,U.stopConnectedCheck(),clearInterval(c),c="")},6E4)};b.stopIdleTimeCounter=function(){q=Ia;c&&clearInterval(c);
c=""};b.manageOfflineMessageTime=function(a){if("object"!==typeof aa||isNaN(aa.timeout))g.console.log("Offline message timeout required.");else{if(1===aa.type){if(!aa.userIds||0===aa.userIds.length){g.console.log("Offline message userIds required.");return}if(-1===aa.userIds.indexOf(a))return}l&&clearInterval(l);l=setTimeout(function(){clearInterval(l);l="";e.showOfflineMessage()},5E3*parseInt(aa.timeout))}};b.stopOfflineMessageCounter=function(){l&&clearInterval(l);l=""}},Hb=new function(){var b=
this,e="",c="",l=!1,f=a("#mck-my-loc"),x=a("#mck-loc-box"),q=a("#mck-loc-lat"),n=a("#mck-loc-lon"),ba=a("#mck-btn-loc"),C=a("#mck-sidebox-ft"),P=a("#mck-file-menu"),t=a("#mck-btn-attach"),y=a("#mck-map-content"),v=a("#mck-loc-address");b.init=function(){bb&&g.google&&"object"===typeof g.google.maps&&(e=new g.google.maps.Geocoder,t.on("click",function(){b.fileMenuToggle()}),ba.on("click",function(){l?x.mckModal():(mckMapUtils.getCurrentLocation(b.onGetCurrLocation,b.onErrorCurrLocation),l=!0)}));f.on("click",
function(){mckMapUtils.getCurrentLocation(b.onGetMyCurrLocation,b.onErrorMyCurrLocation)})};b.fileMenuReposition=function(){var a=C.offset();a.bottom=g.innerHeight-a.top;P.css({bottom:51<a.bottom?a.bottom:51,right:0})};b.fileMenuToggle=function(){t.hasClass("on")?(t.removeClass("on"),P.hide()):(b.fileMenuReposition(),t.addClass("on"),P.show())};b.onGetCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;b.openMapBox()};b.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=
46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;b.openMapBox()};b.onErrorMyCurrLocation=function(a){alert("Unable to retrieve your location. ERROR("+a.code+"): "+a.message)};b.onGetMyCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;q.val(MCK_CURR_LATITIUDE);n.val(MCK_CURR_LONGITUDE);q.trigger("change");n.trigger("change");c?v.val(c):e&&e.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(a,b){"OK"===b&&a[1]&&(c=a[1].formatted_address)})};
b.openMapBox=function(){y.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:q,longitudeInput:n,locationNameInput:v},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(a){MCK_CURR_LATITIUDE=a.latitude;MCK_CURR_LONGITUDE=a.longitude}});x.on("shown.bs.mck-box",function(){y.locationpicker("autosize")});x.mckModal()}},ca=new function(){var b=this,e=a("#mck-msg-form"),c=a("#mck-msg-error"),l=a("#mck-tab-title"),
f=a("#mck-tab-status"),x=a(".mck-typing-box"),q=a("#mck-block-button"),n=a("#mck-message-cell .mck-message-inner");b.updateUserStatus=function(a){if("object"===typeof W[a.userId]){var b=W[a.userId];0===a.status?(b.connected=!1,b.lastSeenAtTime=a.lastSeenAtTime):1===a.status&&(b.connected=!0)}else b=[],b.push(a.userId),da.getUsersDetail(b,{})};b.getUserDetail=function(a){if("object"===typeof W[a])return W[a]};b.checkUserConnectedStatus=function(){var e=[],c=[];a(".mck-user-ol-status").each(function(){var b=
a(this).data("mck-id");"undefined"!==typeof b&&""!==b&&(e.push(b),b=mckContactUtils.formatContactId(""+b),a(this).addClass(b),a(this).next().addClass(b))});0<e.length&&(a.each(e,function(a,b){"undefined"===typeof W[b]&&c.push(b)}),0<c.length?da.getUsersDetail(c,{setStatus:!0}):b.updateUserConnectedStatus())};b.updateUserConnectedStatus=function(){a(".mck-user-ol-status").each(function(){var b=a(this),e=b.data("mck-id");if(e){var c=W[e];"undefined"!==typeof W[e]&&c.connected?(b.removeClass("n-vis").addClass("vis"),
b.next().html("("+MCK_LABELS.online+")")):(b.removeClass("vis").addClass("n-vis"),b.next().html("(Offline)"))}})};b.lastSeenOfGroupOfTwo=function(a){g.MCK_OL_MAP[a]?(f.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),f.removeClass("n-vis").addClass("vis")):T[a]&&(a=mckDateUtils.getLastSeenAtStatus(T[a]),f.html(a),f.attr("title",a),l.addClass("mck-tab-title-w-status"),f.removeClass("n-vis").addClass("vis"))};b.toggleBlockUser=function(a,b){b?(c.html(MCK_LABELS.blocked),c.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),
e.removeClass("vis").addClass("n-vis"),l.removeClass("mck-tab-title-w-status"),f.removeClass("vis").addClass("n-vis"),x.removeClass("vis").addClass("n-vis"),n.data("blocked",!0),q.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"])):(c.html(""),c.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),e.removeClass("n-vis").addClass("vis"),n.data("blocked",!1),q.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),Ha[a]||!g.MCK_OL_MAP[a]&&!T[a]||(g.MCK_OL_MAP[a]?
f.attr("title",MCK_LABELS.online).html(MCK_LABELS.online):T[a]&&(a=mckDateUtils.getLastSeenAtStatus(T[a]),f.html(a),f.attr("title",a)),l.addClass("mck-tab-title-w-status"),f.removeClass("n-vis").addClass("vis")))}};new function(){var b=a("#mck-msg-to");a("#mck-btn-loc");var e=a("#mck-loc-box"),c=a("#mck-msg-sbmt"),l=a("#mck-msg-error"),f=a("#mck-loc-submit"),x=a("#mck-msg-response"),q=a("#mck_response_text"),n=a("#mck-message-cell .mck-message-inner");f.on("click",function(){var a={type:5,contentType:2,
message:g.JSON.stringify(mckMapUtils.getSelectedLocation())},f=n.data("mck-conversationid"),k=n.data("mck-topicid");f?a.conversationId=f:k&&(f={topicId:k},k=J[k],"object"===typeof k&&(f.topicDetail=g.JSON.stringify(k)),a.conversationPxy=f);!0===n.data("isgroup")?a.groupId=b.val():a.to=b.val();c.attr("disabled",!0);l.removeClass("vis").addClass("n-vis");l.html("");q.html("");x.removeClass("vis").addClass("n-vis");v.sendMessage(a);e.mckModal("hide")})};var t=new function(){var b=this,c={0:"User",1:"Admin",
2:"Moderator",3:"Member"},l=a("#mck-msg-form"),I=a("#mck-msg-error"),f=a("#mck-tab-title"),x=a("#mck-tab-status"),q=a("#mck-no-gsm-text"),y=a("#mck-gms-loading"),ba=a("#mck-contact-loading");a("#mck-tab-menu-box");a("#mck-search-loading");var C=a("#mck-group-info-tab"),P=a("#mck-sidebox-search");a("#mck-group-name-box");var V=a("#mck-group-back-link"),Ea=a("#mck-group-name-edit"),Ua=a("#mck-group-name-save"),B=a("#mck-sidebox-content"),E=a("#mck-tab-option-panel"),D=a("#mck-btn-group-create"),m=a("#mck-group-create-tab"),
Q=a("#mck-contacts-content"),L=a("#mck-btn-group-update"),ja=a("#mck-group-create-type"),S=a("#mck-group-icon-upload"),kc=a("#mck-group-icon-change"),Ib=a("#mck-group-member-list"),H=a("#mck-group-update-panel"),G=a(".mck-tab-message-option"),M=a("#mck-group-create-title"),Ka=a(".mck-group-menu-options"),lc=a("#mck-group-member-search"),ra=a("#mck-btn-group-icon-save");a("#mck-group-info-icon-box");var ib=a(".mck-group-admin-options"),pb=a("#mck-group-add-member-box"),R=a("#mck-message-cell .mck-message-inner"),
sa=a("#mck-group-name-sec .mck-group-title");a("#mck-group-create-icon-box");var K=a("#mck-group-info-icon-loading"),ca=a("#mck-gm-search-box");a("#mck-group-member-search-list");var X=a("#mck-group-create-icon-loading"),F=a("#mck-group-info-icon-box .mck-group-icon"),W=a("#mck-group-create-icon-box .mck-group-icon"),ta=a("#mck-group-create-icon-box .mck-overlay-box"),Z=a("#mck-gc-overlay-label");a.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
a.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a(".mck-group-name-box div[contenteditable]").keypress(function(e){if(8===e.which||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode||e.ctrlKey&&97===e.which)return!0;if(13!==e.keyCode||e.shiftKey||e.ctrlKey)return 30>this.innerHTML.length;a(e.target).hasClass("mck-group-create-title")&&b.submitCreateGroup();return!1}).on("paste",function(a){var b=this;setTimeout(function(){30<b.innerText.length&&(b.innerHTML=b.innerText.substring(0,30),mckUtils.setEndOfContenteditable(b));return!1},
"fast")}).on("drop",function(a){a.preventDefault();a.stopPropagation()});a(n).on("click",".mck-btn-change-role",function(b){b.preventDefault();b=a(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var e=a(this).parents(".mck-li-group-member").data("role");b.find("select").val(e);b.removeClass("n-vis").addClass("vis");H.removeClass("n-vis").addClass("vis")});L.on("click",function(){var b=[];a(".mck-group-change-role-box.vis").each(function(e,fa){e=a(this);fa=parseInt(e.find("select").val());
var c=e.parents(".mck-li-group-member").data("role");fa!==c&&(e={userId:e.parents(".mck-li-group-member").data("mck-id"),role:fa},b.push(e))});if(0<b.length){var e=R.data("mck-id"),c=R.data("isgroup");e&&c&&(L.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),mckGroupService.updateGroupInfo({groupId:e,users:b,apzCallback:t.onUpdateGroupInfo}))}});a("#mck-group-info-icon-box .mck-overlay").on("click",function(a){kc.trigger("click")});a("#mck-group-create-icon-box .mck-overlay").on("click",
function(a){S.trigger("click")});a(n).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var b=a(this);0===b.find(".mck-group-icon-default").length&&b.find(".mck-overlay-box").addClass("n-vis")});a(n).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",
function(){a(this).find(".mck-overlay-box").addClass("n-vis")});Ea.on("click",function(){sa.attr("contenteditable",!0).focus();mckUtils.setEndOfContenteditable(sa[0]);Ua.removeClass("n-vis").addClass("vis");Ea.removeClass("vis").addClass("n-vis")});Ua.on("click",function(){var b=a.trim(sa.text());if(0<b.length){var e=R.data("mck-id"),c=R.data("isgroup");e&&c&&(Ea.removeClass("n-vis").addClass("vis"),Ua.removeClass("vis").addClass("n-vis"),sa.attr("contenteditable",!1),mckGroupService.updateGroupInfo({groupId:e,
name:b,apzCallback:t.onUpdateGroupInfo}))}else sa.addClass("mck-req-border")});ra.on("click",function(){var a=F.data("iconurl");if(a){var b=R.data("mck-id"),e=R.data("isgroup");b&&e&&(setTimeout(function(){ra.removeClass("vis").addClass("n-vis")},1E3),F.data("iconurl",""),mckGroupService.updateGroupInfo({groupId:b,imageUrl:a,apzCallback:t.onUpdateGroupInfo}))}else sa.addClass("mck-req-border")});D.on("click",function(){b.submitCreateGroup()});b.submitCreateGroup=function(){var b=a.trim(M.text()),
e=ja.val(),c=W.data("iconurl");0<b.length?(b={groupName:b},e&&(e=parseInt(e),-1!==vb.indexOf(e)&&(b.type=e)),c&&(b.groupIcon=c),W.data("iconurl",""),b.isInternal=!0,D.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),v.getGroup(b)):M.addClass("mck-req-border")};b.loadGroups=function(b){b=b.data;gb.length=0;a.each(b,function(a,b){"undefined"!==typeof b.id&&(b=mckGroupUtils.addGroup(b),gb.push(b))})};b.getDeletedAtTime=function(a){if("object"===typeof MCK_GROUP_MAP[a])return MCK_GROUP_MAP[a].deletedAtTime};
b.getGroupDisplayName=function(a){var b;if("object"===typeof MCK_GROUP_MAP[a]){a=MCK_GROUP_MAP[a];var c=a.displayName;if("undefined"!==typeof a&&10===a.type){c=[];if(0<a.members.length)for(var fa=0;fa<a.members.length;fa++)c.push(a.members[fa]);if(0===a.users[z].role||3===a.users[z].role)c="Kommunicate";else{for(fa=0;fa<c.length;fa++){var f=c[fa];3===a.users[f].role&&(b=f)}c=e.getTabDisplayName(b,!1)}}7===a.type&&(b=e.getContactFromGroupOfTwo(a),"undefined"!==typeof b&&(c=e.getTabDisplayName(b.contactId,
!1)));3===a.type&&-1!==c.indexOf(z)&&(c=c.replace(z,"").replace(":",""),"function"===typeof Qa&&(c=(b=Qa(c))?b:c));c||5!==a.type||(c="Broadcast");c||(c=a.contactId);return c}return a};b.getGroupImage=function(a){return a?'\x3cimg src\x3d"'+a+'"/\x3e':'\x3cimg src\x3d"'+MCK_BASE_URL+'/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'};b.getGroupDefaultIcon=function(){return'\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'};b.addMemberToGroup=function(a,b){"object"===typeof a.members&&
(-1===a.members.indexOf(b)&&a.members.push(b),"object"===typeof a.removedMembersId&&-1!==a.removedMembersId.indexOf(b)&&a.removedMembersId.splice(a.removedMembersId.indexOf(b),1),MCK_GROUP_MAP[a.contactId]=a);return a};b.removeMemberFromGroup=function(a,b){"object"!==typeof a.removedMembersId||1>a.removedMembersId.length?(a.removedMembersId=[],a.removedMembersId.push(b)):-1===a.removedMembersId.indexOf(b)&&a.removedMembersId.push(b);return MCK_GROUP_MAP[a.contactId]=a};b.authenticateGroupUser=function(a){if(!b.isGroupLeft(a)&&
0<a.members.length)for(var e=0;e<a.members.length;e++)if(z===""+a.members[e])return!0;return!1};b.isAppendOpenGroupContextMenu=function(a){return 0!==ha.deleteChatAccess&&b.authenticateGroupUser(a)?a.adminName===z||2===ha.deleteChatAccess?!0:!1:!1};b.validateOpenGroupUser=function(a){if(6===a.type){if(!b.authenticateGroupUser(a)){if(ha.disableChatForNonGroupMember){var e=ha.defaultChatDisabledMessage;e||(e="Chat disabled");I.html(e);I.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");
f.removeClass("mck-tab-title-w-status");x.removeClass("vis").addClass("n-vis")}Ka.removeClass("vis").addClass("n-vis");G.removeClass("vis").addClass("n-vis");E.removeClass("vis").addClass("n-vis");"undefined"===typeof tb[a.contactId]&&U.subscribeToOpenGroup(a)}a.adminName===z?0===ha.deleteChatAccess&&G.removeClass("vis").addClass("n-vis"):(ha.allowInfoAccessGroupMembers||Ka.removeClass("vis").addClass("n-vis"),2!==ha.deleteChatAccess&&G.removeClass("vis").addClass("n-vis"),ha.allowInfoAccessGroupMembers||
2===ha.deleteChatAccess||E.removeClass("vis").addClass("n-vis"));return!1}return!0};b.addGroupStatus=function(a){var c=b.isGroupLeft(a);if(6!==a.type&&(c||Qb)){if(c)t.onGroupLeft("",{groupId:a.contactId});f.removeClass("mck-tab-title-w-status");x.removeClass("vis").addClass("n-vis")}else if(0<a.members.length){c="";for(var g=!1,m=30>=a.members.length?a.members.length:25,k=0;k<m;k++)if(z===""+a.members[k]||-1!==a.removedMembersId.indexOf(a.members[k]))g=!0;else{var l=e.fetchContact(""+a.members[k]);
l=e.getTabDisplayName(l.contactId,!1);c+=" "+l+","}if(5!==a.type&&6!==a.type||g&&5!==a.type)c+=" You";30<a.members.length&&(c+=" and "+(a.members.length-25)+" more");c=c.replace(/,\s*$/,"");x.html(c);x.attr("title",c);x.removeClass("n-vis").addClass("vis");f.addClass("mck-tab-title-w-status");Ka.removeClass("n-vis").addClass("vis")}else f.removeClass("mck-tab-title-w-status"),x.removeClass("vis").addClass("n-vis");7===a.type&&(x.html(""),Ka.removeClass("vis").addClass("n-vis"))};b.disableGroupTab=
function(){I.html(MCK_LABELS["group.chat.disabled"]);I.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");f.removeClass("mck-tab-title-w-status");x.removeClass("vis").addClass("n-vis")};b.isGroupLeft=function(b){var e=!1;b.removedMembersId&&0<b.removedMembersId.length&&a.each(b.removedMembersId,function(a,b){b===z&&(e=!0)});return e};b.onGroupLeft=function(a,e){ba.removeClass("vis").addClass("n-vis");if("object"===typeof a&&"error"===a.status)alert("Unable to process your request. "+
a.errorMessage);else if(a=e.groupId,C.hasClass("vis"))e=C.data("mck-id"),a===e&&V.trigger("click");else if(B.hasClass("vis")){e=R.data("mck-id");var c=R.data("isgroup");e===a.toString()&&c&&(Ka.removeClass("vis").addClass("n-vis"),b.disableGroupTab())}};b.onAddedGroupMember=function(c,f){ba.removeClass("vis").addClass("n-vis");if("object"===typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{var g=f.groupId,k=f.userId;c="";g?c=mckGroupUtils.getGroup(g):f.clientGroupId&&
(c=mckGroupUtils.getGroupByClientGroupId(f.clientGroupId));"object"===typeof c?(c=b.addMemberToGroup(c,k),C.hasClass("vis")?(f=C.data("mck-id"),g===f&&(g=e.fetchContact(""+k),0===a("#li-gm-"+g.htmlId).length&&b.addGroupMember(c,g),b.sortGroupMemberHtmlList(),b.enableGroupAdminMenuToggle())):B.hasClass("vis")&&(f=R.data("mck-id"),k=R.data("isgroup"),f===g.toString()&&k&&b.addGroupStatus(c))):mckGroupService.getGroupFeed({groupId:g,clientGroupId:f.clientGroupId,apzCallback:t.onGroupFeed})}};b.onRemovedGroupMember=
function(c,f){ba.removeClass("vis").addClass("n-vis");if("object"===typeof c&&"error"===c.status)alert("Unable to process your request. "+c.errorMessage);else{c=f.groupId;var g=f.userId,k="";c?k=mckGroupUtils.getGroup(c):f.clientGroupId&&(k=mckGroupUtils.getGroupByClientGroupId(f.clientGroupId));"object"===typeof k?(k=b.removeMemberFromGroup(k,g),C.hasClass("vis")?(k=C.data("mck-id"),c===k&&(c=e.fetchContact(""+g),c=a("#li-gm-"+c.htmlId),0<c.length&&c.remove())):B.hasClass("vis")&&(f=R.data("mck-id"),
g=R.data("isgroup"),f===c.toString()&&g&&b.addGroupStatus(k))):mckGroupService.getGroupFeed({groupId:c,clientGroupId:f.clientGroupId,apzCallback:t.onGroupFeed})}};b.onGroupFeed=function(c,f){ba.removeClass("vis").addClass("n-vis");if("success"===c.status){c=c.data;var g=c.conversationPxy,k=mckGroupUtils.getGroup(c.id);c.deletedAtTime&&(I.html(MCK_LABELS["group.deleted"]),I.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),l.removeClass("vis").addClass("n-vis"));var m=[];"object"===typeof g&&
(N[g.id]=g,pa[g.topicId]=[g.id],g.topicDetail&&(J[g.topicId]=a.parseJSON(g.topicDetail)),m.push(g));0<m.length&&(Y[f.groupId]=m);da.loadUserProfiles(c.membersId);f.isMessage&&"object"===typeof f.message&&e.populateMessage(f.messageType,f.message,f.notifyUser);f.isReloadTab&&b.reloadGroupTab(k)}};b.onUpdateGroupInfo=function(e,c){ba.removeClass("vis").addClass("n-vis");L.attr("disabled",!1).html("Update");H.removeClass("vis").addClass("n-vis");if("object"===typeof e&&"error"===e.status)alert("Unable to process your request. "+
e.errorMessage);else{e=c.groupId;c=c.groupInfo;var g=mckGroupUtils.getGroup(e);if("object"===typeof g){c.imageUrl&&(g.imageUrl=c.imageUrl);c.newName&&(g.displayName=c.newName);c.users&&0<c.users.length&&a.each(c.users,function(a,b){b.userId&&(g.users[b.userId]=b)});if(C.hasClass("vis"))c.imageUrl&&F.html(b.getGroupImage(g.imageUrl)),sa.html(g.displayName),c.users&&0<c.users.length&&(Ib.html(""),b.addMembersToGroupInfoList(g),g.adminName===z?pb.removeClass("n-vis").addClass("vis"):pb.removeClass("vis").addClass("n-vis"));
else if(B.hasClass("vis")){var k=R.data("mck-id"),m=R.data("isgroup");k===e.toString()&&m?f.html(g.displayName):0<a("#li-group-"+g.htmlId).length&&(a("#li-group-"+g.htmlId+" .mck-cont-name strong").html(g.displayName),c.imageUrl&&a("#li-group-"+g.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+g.imageUrl+"'\x3e"))}MCK_GROUP_MAP[g.contactId]=g}}};b.getGroupFeedFromMessage=function(a){var b=a.message;if(b){a.groupId=b.groupId;a.isMessage=!0;if(b.conversationId){var e=N[b.conversationId];if("object"!==
typeof e||"object"!==typeof J[e.topicId])a.conversationId=b.conversationId}a.apzCallback=t.onGroupFeed;mckGroupService.getGroupFeed(a)}};b.reloadGroupTab=function(a){var e=R.data("mck-id"),c=R.data("isgroup");e===a.contactId.toString()&&c&&b.addGroupStatus(a)};b.loadGroupTab=function(b){"error"===b.status?alert("Unable to process your request. "+b.errorMessage):(e.loadTab({tabId:b.data.contactId,isGroup:!0}),a("#mck-search").val(""))};b.addMembersToGroupInfoList=function(c){var f=c.members;f.sort();
Ib.html("");a.each(f,function(f,g){g&&(f=e.fetchContact(""+g),0===a("#li-gm-"+f.htmlId).length&&b.addGroupMember(c,f))});b.sortGroupMemberHtmlList();b.enableGroupAdminMenuToggle()};b.enableGroupAdminMenuToggle=function(){a(".mck-group-member-info").bind("mouseenter",function(){a(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",function(){a(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};b.addGroupMember=function(b,f){var k="n-vis",m="n-vis",l=b.users[f.contactId],
L="Member",S=3;l&&"undefined"!==typeof l.role&&(S=l.role,L=c[l.role]);l=e.getTabDisplayName(f.contactId,!1);f.contactId===b.adminName&&(k="vis");b.adminName===z&&(m="vis");f.contactId===z&&(l="You",m="n-vis");b=e.getContactImageLink(f,l);var ja="";oa[f.contactId]||(g.MCK_OL_MAP[f.contactId]?ja=MCK_LABELS.online:T[f.contactId]&&(ja=mckDateUtils.getLastSeenAtStatus(T[f.contactId])));f=[{roleExpr:L,roleVal:S,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:f.htmlId,
contIdExpr:f.contactId,contImgExpr:b,contLastSeenExpr:ja,contNameExpr:l,contFirstAlphaExpr:l.charAt(0).toUpperCase(),isAdminExpr:k,enableAdminMenuExpr:m}];a.tmpl("groupMemberTemplate",f).appendTo("#mck-group-member-list")};b.addMembersToGroupSearchList=function(){var c=R.data("mck-id");if(R.data("isgroup")){var f=mckGroupUtils.getGroup(c),g=Ta,k=[];g=g.filter(function(a,b){return g.indexOf(a)===b});g.sort();var m=f.members;a.each(g,function(a,c){c&&(a=e.fetchContact(""+c),-1===m.indexOf(a.contactId)||
-1!==m.indexOf(a.contactId)&&-1!==f.removedMembersId.indexOf(a.contactId))&&(b.addGroupSearchMember(a),k.push(a))});b.enableGroupAdminMenuToggle();0<k.length?q.removeClass("vis").addClass("n-vis"):q.removeClass("n-vis").addClass("vis");e.initAutoSuggest({contactsArray:k,$searchId:lc,isContactSearch:!1})}y.removeClass("vis").addClass("n-vis")};b.addGroupSearchMember=function(b){var c=e.getTabDisplayName(b.contactId,!1),f=e.getContactImageLink(b,c),k="user-"+b.htmlId,m="";oa[b.contactId]||(g.MCK_OL_MAP[b.contactId]?
m=MCK_LABELS.online:T[b.contactId]&&(m=mckDateUtils.getLastSeenAtStatus(T[b.contactId])));a.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:k,contIdExpr:b.contactId,contImgExpr:f,contLastSeenExpr:m,contNameExpr:c}]).appendTo("#mck-group-member-search-list")};b.loadCreateGroupTab=function(){Q.removeClass("vis").addClass("n-vis");B.removeClass("vis").addClass("n-vis");P.removeClass("vis").addClass("n-vis");C.removeClass("vis").addClass("n-vis");X.removeClass("vis").addClass("n-vis");W.data("iconurl",
"");M.html("");ta.removeClass("n-vis");Z.html(MCK_LABELS["add.group.icon"]);W.html(b.getGroupDefaultIcon());m.removeClass("n-vis").addClass("vis")};b.loadGroupInfo=function(a){if(a.groupId){sa.attr("contenteditable",!1);Ua.removeClass("vis").addClass("n-vis");Ea.removeClass("n-vis").addClass("vis");Q.removeClass("vis").addClass("n-vis");B.removeClass("vis").addClass("n-vis");P.removeClass("vis").addClass("n-vis");H.removeClass("vis").addClass("n-vis");m.removeClass("vis").addClass("n-vis");ra.removeClass("vis").addClass("n-vis");
K.removeClass("vis").addClass("n-vis");C.removeClass("n-vis").addClass("vis");C.data("mck-id",a.groupId);F.data("iconurl","");a.conversationId&&C.data("mck-conversation-id",a.conversationId);Ib.html("");var e=mckGroupUtils.getGroup(a.groupId);"object"===typeof e?(F.html(b.getGroupImage(e.imageUrl)),sa.html(e.displayName),b.addMembersToGroupInfoList(e),e.adminName===z?pb.removeClass("n-vis").addClass("vis"):pb.removeClass("vis").addClass("n-vis")):mckGroupService.getGroupFeed({groupId:a.groupId,apzCallback:t.onGroupFeed})}};
b.sortGroupMemberHtmlList=function(){a("#mck-group-member-list .mck-li-group-member").sort(function(a,b){return a.dataset.alpha>b.dataset.alpha}).appendTo("#mck-group-member-list")};b.addGroupMemberFromSearch=function(a){var b=C.data("mck-id");if("undefined"!==typeof b&&"undefined"!==typeof a){var e=mckGroupUtils.getGroup(b);"object"===typeof e&&z===e.adminName?(da.loadUserProfile(a),mckGroupService.addGroupMember({groupId:b,userId:a,apzCallback:t.onAddedGroupMember})):ib.removeClass("vis").addClass("n-vis")}ca.mckModal("hide")}},
la=new function(){var b=this,c=["CREATE","UPDATE"],g=a("#mck-file-box"),l=a(".mck-overlay"),f=a("#mck-msg-sbmt"),x=a("#mck-text-box"),q=a("#mck-file-input"),t=a(".mck-overlay-box"),y=a(".mck-file-upload"),C=a("#mck-group-icon-upload"),P=a("#mck-group-icon-change"),v=a("#mck-group-info-icon-box"),z=a("#mck-btn-group-icon-save"),B=a("#mck-message-cell .mck-message-inner"),J=a("#mck-group-create-icon-box"),N=a("#mck-group-info-icon-loading"),D=a("#mck-group-create-icon-loading"),m=a("#mck-group-info-icon-box .mck-group-icon"),
Q=a("#mck-group-create-icon-box .mck-group-icon"),L=a("#mck-gc-overlay-label");a.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"progress progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"progress-bar progress-bar-success bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
b.init=function(){y.on("click",function(){q.trigger("click")});C.on("change",function(){var e=a(this)[0].files[0];b.uplaodFileToAWS(e,c[0]);return!1});P.on("change",function(){var e=a(this)[0].files[0];b.uplaodFileToAWS(e,c[1]);return!1});q.on("change",function(){var e=a(this)[0].files[0],c={};c.file=e;c.name=e.name;b.uploadFile(c)});a(n).on("click",".mck-remove-file",function(){var e=a(this).parents(".mck-file-box"),c=e.data("mckfile");e.remove();f.attr("disabled",!1);0===g.find(".mck-file-box").length&&
(g.removeClass("vis").addClass("n-vis"),x.attr("required",""));"object"===typeof c&&(b.deleteFileMeta(c.blobKey),a.each(E,function(a,b){"undefined"!==typeof b&&b.blobKey===c.blobKey&&E.splice(a,1)}))})};b.audioRecoder=function(c){var k=c.file,m=[];if("undefined"!==typeof k)if(4<a(".mck-file-box").length&&m.push("Can't upload more than 5 files at a time"),k.size>1048576*Aa&&m.push("file size can not be more than "+Aa+" MB"),0<m.length)alert(m.toString());else{m=mckUtils.randomId();var l=[{fileIdExpr:m,
fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:b.getFilePreviewSize(k.size)}];a.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var L=a(".mck-file-box."+m),q=a(".mck-file-box."+m+" .mck-file-lb"),ja=a(".mck-file-box."+m+" .progress .bar"),n=a(".mck-file-box."+m+" .progress"),C=a(".mck-file-box."+m+" .mck-remove-file");ja.css("width","0%");n.removeClass("n-vis").addClass("vis");C.attr("disabled",!0);y.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");
if(c.name===a(".mck-file-box."+m+" .mck-file-lb a").html()){var Q=B.data("mck-id");qa[c.name+k.size]=Q;f.attr("disabled",!0);c=[];c.push(k);var I=new XMLHttpRequest;(I.upload||I).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);ja.css("width",a+"%")});I.addEventListener("load",function(c){c=a.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var g=b.getFilePreviewPath(c),m=c.name,k=c.size,l=B.data("mck-id");m+=k;k=qa[m];if(Q!==l)e.updateDraftMessage(k,
c),delete qa[m];else return C.attr("disabled",!1),y.attr("disabled",!1),f.attr("disabled",!1),delete qa[m],q.html(g),n.removeClass("vis").addClass("n-vis"),a(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),x.removeAttr("required"),E.push(c),L.data("mckfile",c),y.children("input").val(""),!1}else C.attr("disabled",!1),f.attr("disabled",!1),C.trigger("click")});a.ajax({type:"GET",url:G+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=
new FormData;b.append("files[]",k);I.open("POST",a,!0);I.send(b)},error:function(){}})}return!1}};b.uploadFile=function(c){var m=c.file,k=[];if("undefined"!==typeof m)if(4<a(".mck-file-box").length&&k.push("Can't upload more than 5 files at a time"),m.size>1048576*Aa&&k.push("file size can not be more than "+Aa+" MB"),0<k.length)alert(k.toString());else{k=mckUtils.randomId();var l=[{fileIdExpr:k,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:b.getFilePreviewSize(m.size)}];
a.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var L=a(".mck-file-box."+k),q=a(".mck-file-box."+k+" .mck-file-lb"),n=a(".mck-file-box."+k+" .progress .bar"),ja=a(".mck-file-box."+k+" .progress"),I=a(".mck-file-box."+k+" .mck-remove-file");n.css("width","0%");ja.removeClass("n-vis").addClass("vis");I.attr("disabled",!0);y.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");if(c.name===a(".mck-file-box."+k+" .mck-file-lb a").html()){var C=B.data("mck-id");qa[c.name+m.size]=C;f.attr("disabled",
!0);c=[];c.push(m);var Q=new XMLHttpRequest;(Q.upload||Q).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);n.css("width",a+"%")});Q.addEventListener("load",function(c){c=a.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var g=b.getFilePreviewPath(c),k=c.name,m=c.size,l=B.data("mck-id");k+=m;m=qa[k];if(C!==l)e.updateDraftMessage(m,c),delete qa[k];else return I.attr("disabled",!1),y.attr("disabled",!1),f.attr("disabled",!1),delete qa[k],q.html(g),
ja.removeClass("vis").addClass("n-vis"),a(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),x.removeAttr("required"),E.push(c),L.data("mckfile",c),y.children("input").val(""),!1}else I.attr("disabled",!1),f.attr("disabled",!1),I.trigger("click")});a.ajax({type:"GET",url:G+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=new FormData;b.append("files[]",m);Q.open("POST",a,!0);Q.send(b)},error:function(){}})}return!1}};b.uplaodFileToAWS=
function(a,b){var e=new FormData,f=[];"undefined"!==typeof a&&(-1===a.type.indexOf("image")&&f.push("Please upload image file."),0<f.length?alert(f.toString()):(l.attr("disabled",!0),c[0]===b?(J.find(".mck-overlay-box").removeClass("n-vis"),J.removeClass("mck-hover-on"),D.removeClass("n-vis").addClass("vis")):(v.find(".mck-overlay-box").removeClass("n-vis"),v.removeClass("mck-hover-on"),N.removeClass("n-vis").addClass("vis")),f=new XMLHttpRequest,f.addEventListener("load",function(a){if(a=this.responseText)c[0]===
b?(Q.html('\x3cimg src\x3d"'+a+'"/\x3e'),Q.data("iconurl",a),L.html(MCK_LABELS["change.group.icon"]),D.removeClass("vis").addClass("n-vis"),J.addClass("mck-hover-on")):(m.html('\x3cimg src\x3d"'+a+'"/\x3e'),m.data("iconurl",a),N.removeClass("vis").addClass("n-vis"),v.addClass("mck-hover-on"),setTimeout(function(){z.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){t.addClass("n-vis")},1500);l.attr("disabled",!1);c[0]===b?C.val(""):P.val("");return!1}),e.append("file",a),f.open("post",
MCK_BASE_URL+"/rest/ws/upload/file",!0),f.setRequestHeader("UserId-Enabled",!0),f.setRequestHeader("Authorization","Basic "+H),f.setRequestHeader("Application-Key",Z),f.setRequestHeader("Device-Key",ea),xa&&f.setRequestHeader("Access-Token",xa),f.send(e)))};b.deleteFileMeta=function(a){mckUtils.ajax({url:G+"/rest/ws/aws/file/delete?key\x3d"+a,type:"post",success:function(){},error:function(){}})};b.getFilePreviewPath=function(a){return"object"===typeof a?'\x3ca href\x3d"'+G+"/rest/ws/aws/file"+a.blobKey+
'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":""};b.getFilePreviewSize=function(a){return a?1048576<a?"("+parseInt(a/1048576)+" MB)":1024<a?"("+parseInt(a/1024)+" KB)":"("+parseInt(a)+" B)":""};b.addFileBox=function(b){var c=mckUtils.randomId(),e="";"object"===typeof b.fileMeta&&(c=b.fileMeta.createdAtTime,e=b.fileMeta.name);a.tmpl("fileboxTemplate",[{fileNameExpr:b.filelb,fileSizeExpr:b.filesize,fileIdExpr:c,fileName:e}]).appendTo("#mck-file-box");c=a(".mck-file-box."+c);e=c.find(".mck-remove-file");
var g=c.find(".progress");"object"===typeof b.fileMeta?(c.data("mckblob",b.fileMeta.blobKey),x.removeAttr("required"),f.attr("disabled",!1),e.attr("disabled",!1),g.removeClass("vis").addClass("n-vis"),E.push(b.fileMeta)):(f.attr("disabled",!0),e.attr("disabled",!0),g.removeClass("n-vis").addClass("vis"))}},e=new function(){var b=this,c="",l=a("#mck-search"),I=a("#mck-msg-to"),f=a(".mck-file-lb"),x=a(".mck-file-sz"),q=a("#mck-sidebox"),y=a("#mck-file-box"),ba=a("#mck-msg-sbmt"),C=a("#mck-msg-form"),
P=a("#mck-text-box"),V=a("#mck-msg-error");a("#mck-show-more");var Ea=a("#mck-tab-title"),Ua=a("#mck-tab-status"),H=a("#mck-message-cell"),F=a(".mck-typing-box"),D=a("#mck-no-messages"),m=a("#mck-product-box"),Q=a(".mck-product-icon"),L=a(".mck-product-title"),ja=a(".mck-product-subtitle"),S=a("#mck-product-box .mck-caret"),M=a(".mck-product-rt-up .mck-product-key"),K=a("#mck-contact-search-input-box"),Z=a(".mck-product-rt-up .mck-product-value"),ha=a(".mck-product-rt-down .mck-product-key"),ia=a(".mck-product-rt-down .mck-product-value");
a("#li-mck-group-info");a("#li-mck-leave-group");var Ka=a("#mck-group-info-tab"),wa=a("#mck-group-search-tab"),ra=a("#mck-no-search-groups"),ib=a("#mck-group-create-tab"),pa=a("#mck-group-search-list");a("#mck-group-search-tabview");var R=a(".mck-group-menu-options"),sa=a(".mck-videocall-btn"),qa=a("#mck-group-search-input"),ma=a("#mck-group-search-input-box"),na=a("#mck-contact-search-list"),ea=a("#mck-contacts-content"),xa=a("#mck-contact-search-tab");a("#mck-contact-search-tabview");var ta=a("#mck-contact-search-input");
a("#mck-search-list");var O=a("#mck-no-search-contacts"),fa=a("#mck-search-tab-box li a"),Ja=a("#mck-search-tabview-box"),ka=a("#mck-sidebox-search"),Ba=a("#mck-contact-loading"),mc=a("#mck-typing-label"),r=a("#mck-price-widget"),Fa=a("#mck-msg-response"),Ia=a("#mck_response_text"),Aa=a("#li-mck-block-user"),va=a("#li-mck-video-call"),Va=a("#mck-search-loading"),ac=a("#mck-tab-individual"),bc=a("#mck-attachfile-box"),d=a("#mck-attachmenu-box"),p=a("#mck-sidebox-content"),u=a("#mck-tab-option-panel"),
La=a("#mck-tab-conversation"),Xa=a("#mck-conversation-header"),db=a("#mck-no-conversations"),Ya=a("#mck-conversation-list"),Za=a(".mck-tab-message-option"),jb=a(".mck-box-ft .mck-box-form"),cc=a("#mck-btn-clear-messages"),Jb=a("#mck-offline-message-box"),A=a("#mck-message-cell .mck-message-inner");a("#mck-msg-new");var Kb=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);a.template("convTemplate",'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}" data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d "move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${nameTextExpr} ${showNameExpr}"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}" data-filename\x3d"${fileNameExpr}" data-fileurl\x3d "${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward ${msgForwardVisibleExpr}"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
a.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.openConversation=function(){"none"===q.css("display")&&(a(".mckModal").mckModal("hide"),q.mckModal());I.focus()};b.initEmojis=function(){try{a("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(h){c||(c=setTimeout(function(){b.initEmojis()},3E4))}};b.loadTab=function(h,c){var w=A.data("mck-id");if(w)if(1<P.html().length||y.hasClass("vis")){var f={text:P.html(),files:[]};y.hasClass("vis")&&a(".mck-file-box").each(function(){var b=a(this),h={filelb:b.find(".mck-file-lb").html(),
filesize:b.find(".mck-file-sz").html()};b=b.data("mckfile");"object"===typeof b&&(h.fileMeta=b);f.files.push(h)});Na[w]=f}else delete Na[w];Ga=!0;b.clearMessageField(!1);b.addDraftMessage(h.tabId);V.html("");V.removeClass("vis").addClass("n-vis");Ia.html("");Fa.removeClass("vis").addClass("n-vis");C[0].reset();C.removeClass("n-vis").addClass("vis");A.html("");V.removeClass("mck-no-mb");ea.removeClass("n-vis").addClass("vis");jb.removeClass("vis").addClass("n-vis");ka.removeClass("vis").addClass("n-vis");
Ka.removeClass("vis").addClass("n-vis");ib.removeClass("vis").addClass("n-vis");p.removeClass("n-vis").addClass("vis");m.removeClass("vis").addClass("n-vis");Xa.addClass("n-vis");Ba.removeClass("vis").addClass("n-vis");A.removeClass("mck-group-inner");Ua.removeClass("vis").addClass("n-vis");Ea.removeClass("mck-tab-title-w-status");Ea.removeClass("mck-tab-title-w-typing");F.removeClass("vis").addClass("n-vis");mc.html(MCK_LABELS.typing);A.data("isgroup",h.isGroup);A.data("datetime","");if(h.tabId)I.val(h.tabId),
A.data("mck-id",h.tabId),A.data("mck-conversationid",h.conversationId),A.data("mck-topicid",h.topicId),u.data("tabId",h.tabId),u.removeClass("n-vis").addClass("vis"),ea.removeClass("vis").addClass("n-vis"),jb.removeClass("n-vis").addClass("vis"),cc.removeClass("n-vis").addClass("vis"),R.removeClass("vis").addClass("n-vis"),h.isGroup?(A.addClass("mck-group-inner"),Aa.removeClass("vis").addClass("n-vis"),va.removeClass("vis").addClass("n-vis"),sa.removeClass("vis").addClass("n-vis")):(Aa.removeClass("n-vis").addClass("vis"),
va.removeClass("n-vis").addClass("vis"),Pa&&sa.removeClass("n-vis").addClass("vis")),!h.topicId&&h.conversationId&&(w=N[h.conversationId],"object"===typeof w&&(h.topicId=w.topicId)),h.topicId&&(w=J[h.topicId],"object"===typeof w&&(Ca?(A.data("mck-title",w.title),Xa.html(w.title),Xa.removeClass("n-vis")):Ma&&(b.setProductProperties(w,h.topicId),S.addClass("n-vis"),m.addClass("mck-product-box-wc"),Ya.addClass("n-vis"),m.removeClass("n-vis").addClass("vis")))),bb&&g.google&&"object"===typeof g.google.maps?
(bc.removeClass("vis").addClass("n-vis"),d.removeClass("n-vis").addClass("vis")):(d.removeClass("vis").addClass("n-vis"),bc.removeClass("n-vis").addClass("vis")),w=b.getTabDisplayName(h.tabId,h.isGroup,h.userName),b.isGroupDeleted(h.tabId,h.isGroup)&&(V.html(MCK_LABELS["group.deleted"]),V.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),C.removeClass("vis").addClass("n-vis")),Ea.html(w),Ea.attr("title",w),La.removeClass("vis").addClass("n-vis"),Ja.removeClass("vis").addClass("n-vis"),ac.removeClass("n-vis").addClass("vis"),
"support"===sb&&a(".mck-tab-link").removeClass("vis").addClass("n-vis"),Cb&&(r.removeClass("n-vis").addClass("vis"),A.addClass("mck-msg-w-panel")),eb&&(V.html("Deactivated"),V.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),C.removeClass("vis").addClass("n-vis")),U.subscibeToTypingChannel(h.tabId,h.isGroup),"function"===typeof zb&&zb({tabId:h.tabId,isGroup:h.isGroup});else if(h.tabId="",fb&&e.hideOfflineMessage(),ac.removeClass("vis").addClass("n-vis"),La.removeClass("n-vis").addClass("vis"),
Ja.removeClass("n-vis").addClass("vis"),m.removeClass("vis").addClass("n-vis"),A.data("mck-id",""),A.data("mck-conversationid",""),A.data("mck-topicid",""),r.removeClass("vis").addClass("n-vis"),A.removeClass("mck-msg-w-panel"),u.removeClass("vis").addClass("n-vis"),cc.removeClass("vis").addClass("n-vis"),I.val(""),w=B.getLatestMessageArray(),U.unsubscibeToTypingChannel(),null!==w&&0<w.length){h.isReload=!0;e.addContactsFromMessageList({message:w},h);b.openConversation();Ga=!1;return}v.loadMessageList(h,
c);b.openConversation()};b.setProductProperties=function(a,d){L.html(a.title);Q.html(b.getTopicLink(a.link));ja.html(a.subtitle?a.subtitle:"");var h=a.value1?":"+a.value1:"";M.html(a.key1?a.key1:"");Z.html(h);h=a.value2?":"+a.value2:"";ha.html(a.key2?a.key2:"");ia.html(h);"function"===typeof wb&&(a.topicId=d,wb(a))};b.getTopicLink=function(a){return a?'\x3cimg src\x3d"'+a+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};b.processMessageList=function(h,d,c){var p=A.children("div[name\x3d'message']:first"),
w=A.data("mck-id"),f=A.data("isgroup")?mckGroupUtils.getGroup(w):e.fetchContact(w);if("undefined"===typeof h.message.length){w=[];w.push(h.message);B.updateMckMessageArray(w);b.addMessage(h.message,f,!1,!1,c);var g=h.createdAtTime}else B.updateMckMessageArray(h.message),a.each(h.message,function(a,h){"undefined"!==typeof h.to&&(b.addMessage(h,f,!1,!1,c),g=h.createdAtTime)});u.data("datetime",g);!d&&0<p.length?A.scrollTop(p.offset().top-A.offset().top+A.scrollTop()):d&&A.animate({scrollTop:A.prop("scrollHeight")},
"fast")};b.closeConversation=function(a){var b;if("function"===typeof yb){var h=yb();"object"===typeof h&&(b="BUSY_WITH_OTHER"===a?h.onBusyWithOtherUser:h.onConversationClose)}b||(b="Chat disabled with user");V.html(b);V.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");C.removeClass("vis").addClass("n-vis")};b.addTooltip=function(b){a("."+b+" .mck-icon-time").attr("title","pending");a("."+b+" .mck-btn-trash").attr("title","delete");a("."+b+" .mck-icon-sent").attr("title","sent");a("."+b+
" .mck-btn-forward").attr("title","forward message");a("."+b+" .mck-icon-delivered").attr("title","delivered");a("."+b+" .mck-icon-read").attr("title","delivered and read");a("."+b+" .msgtype-outbox-cr").attr("title","sent via Carrier");a("."+b+" .msgtype-outbox-mck").attr("title","sent");a("."+b+" .msgtype-inbox-cr").attr("title","received via Carrier");a("."+b+" .msgtype-inbox-mck").attr("title","recieved")};b.fetchContact=function(a){var h=b.getContact(a);"undefined"===typeof h&&(h=b.createContact(a));
return h};b.getContact=function(a){if("object"===typeof za[a])return za[a]};b.getContactDisplayName=function(a){if("string"===typeof ya[a])return ya[a];if("undefined"===typeof ya[a]&&(a=W[a],"undefined"!==typeof a))return a.displayName};b.addMessage=function(h,d,c,p,f){var w="",u="",k="vis",m="n-vis",$a="",La="n-vis";if("object"===typeof h.metadata&&"undefined"!==typeof h.metadata.AL_REPLY){var ua=h.metadata.AL_REPLY;w=v.getReplyMessageByKey(ua);if("undefined"!==typeof w){if(d.isGroup&&w||!d.isGroup&&
"undefined"===typeof w.fileMeta)La="vis";$a=5===w.type?"You":e.getTabDisplayName(w.to,!1);if("object"===typeof w.fileMeta||2===w.contentType)u=b.getImageForReplyMessage(w),k="n-vis",m="vis",La="n-vis"}}if(6!==h.type&&7!==h.type&&!(h.metadata&&"HIDDEN"===h.metadata.category||102===h.contentType||10===h.contentType&&h.metadata&&"true"===h.metadata.hide||0<a("#mck-message-cell ."+h.key).length)){D.hasClass("vis")&&D.removeClass("vis").addClass("n-vis");var l="mck-msg-right";if(0===h.type||4===h.type||
6===h.type)l="mck-msg-left";if(4===h.contentType||10===h.contentType||103===h.contentType)l="mck-msg-center";var L=b.getStatusIconName(h);ua=h.key;var q="'"+h.deviceKey+"','"+h.to+"','"+h.to+"','"+ua+"'",x="",db="",I="",Q="n-vis",C="";da.loadUserProfile(h.to);!h.groupId||4===h.contentType||7===d.type||0!==h.type&&4!==h.type&&6!==h.type||(x=b.getTabDisplayName(h.to,!1),Q="vis",I=b.getNameTextClassByAlphabet(x));if(Pb){C="mck-msg-avator-bubble";var S="",r=x;"mck-msg-right"===l?(S=e.fetchContact(z),
r=b.getTabDisplayName(S.displayName,!1)):"mck-msg-left"===l&&(S=h.groupId?e.fetchContact(h.to):d);S&&(db=b.getContactImageLink(S,r))}h.groupId&&10===h.contentType&&(I=db=x="");d="n-vis";r=S="";var y=h.message;"object"===typeof h.fileMeta&&(S=h.fileMeta.name,r=h.fileMeta.size);"object"===typeof h.fileMeta&&(h.fileMeta.contentType.indexOf("audio")||h.fileMeta.contentType.indexOf("image")||h.fileMeta.contentType.indexOf("video"))&&(d="vis");var dc="n-vis";nb&&g.MCK_OL_MAP[h.to]&&10!==h.contentType&&
(dc="vis");u=[{msgReply:w?w.message+"\n":"",msgReplyTo:w?$a+"\n":"",msgReplyDivExpr:w?"vis":"n-vis",msgReplyToVisibleExpr:La,msgPreview:u?b.getImageForReplyMessage(w):"",msgpreviewvisExpr:m,textreplyVisExpr:k,msgKeyExpr:h.key,msgDeliveredExpr:h.delivered,msgSentExpr:h.sent,msgCreatedAtTime:h.createdAtTime,msgTypeExpr:h.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"kommunicate"==window.applozic.PRODUCT_ID?"n-vis":"vis",
msgSourceExpr:h.source,statusIconExpr:L,contactExpr:"vis",toExpr:h.to,msgAvatorClassExpr:C,showNameExpr:Q,msgNameExpr:x,msgImgExpr:db,nameTextExpr:I,msgFloatExpr:l,replyIdExpr:ua,createdAtTimeExpr:mckDateUtils.getDate(h.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:q,downloadMediaUrlExpr:b.getFileAttachment(h),msgClassExpr:"",msgExpr:y,selfDestructTimeExpr:h.timeToLive,fileMetaKeyExpr:h.fileMetaKey,downloadIconVisibleExpr:d,fileExpr:b.getFilePath(h),fileUrlExpr:b.getFileurl(h),fileNameExpr:S,
fileSizeExpr:r,contOlExpr:dc}];c?a.tmpl("messageTemplate",u).appendTo("#mck-message-cell .mck-message-inner"):a.tmpl("messageTemplate",u).prependTo("#mck-message-cell .mck-message-inner");u="";h.message&&(u=h.message.replace(/\n/g,"\x3cbr/\x3e"),null!==g.emoji&&"undefined"!==typeof g.emoji&&(u=g.emoji.replace_unified(u),u=g.emoji.replace_colons(u)));h.conversationId&&(k=N[h.conversationId],"object"!==typeof k&&v.getTopicId({conversationId:h.conversationId}),c&&(A.data("mck-conversationid",h.conversationId),
k&&(m=J[k.topicId],"object"===typeof m&&(Ma?b.setProductProperties(m,k.topicId):Ca&&Xa.html(m.title)))));4===h.contentType&&(k=u,u="Final agreed price: "+u,Cb||(u+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+k+'" data-mck-conversationid\x3d"'+h.conversationId+'"\x3eAccept\x3c/button\x3e'));k=a("."+ua+" .mck-msg-content");if(-1===u.indexOf("emoji-inner")&&0===h.contentType)for(u=u.split("\x3cbr/\x3e"),m=0;m<u.length;m++)$a=n.createElement("div"),$a.appendChild(n.createTextNode(u[m])),
u[m]&&u[m].match(Kb)&&($a=a($a).linkify({target:"_blank"})),k.append($a);else k.html(u),k.linkify({target:"_blank"});h.fileMeta&&(a("."+ua+" .mck-file-text a:first").trigger("click"),a("."+ua+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===k.html()&&k.removeClass("vis").addClass("n-vis"));2===h.contentType&&(k.removeClass("vis").addClass("n-vis"),a("."+ua+" .mck-file-text").removeClass("n-vis").addClass("vis"));p&&A.animate({scrollTop:A.prop("scrollHeight")},"fast");Za.hasClass("n-vis")&&
(h.groupId?6!==mckGroupUtils.getGroup(h.groupId).type&&Za.removeClass("n-vis").addClass("vis"):Za.removeClass("n-vis").addClass("vis"));b.addTooltip(h.key);4!==h.contentType&&10!==h.contentType&&f&&b.messageContextMenu(h.key);h.groupId&&10===h.contentType&&c&&mckGroupService.getGroupFeed({groupId:h.groupId,isReloadTab:!0,apzCallback:t.onGroupFeed})}};b.addContactForSearchList=function(h,d){var c=h.userCount,e=h.isGroup,p=b.getTabDisplayName(h.contactId,e),w=b.getContactImageLink(h,p),u=e?"gs-group-"+
h.htmlId:"cs-user-"+h.htmlId,f="",k=e&&Eb;a("#li-"+u+" .mck-group-count-text").html(c);e||oa[h.contactId]||(g.MCK_OL_MAP[h.contactId]?f=MCK_LABELS.online:T[h.contactId]&&(f=mckDateUtils.getLastSeenAtStatus(T[h.contactId])));a.tmpl("searchContactbox",[{contHtmlExpr:u,contIdExpr:h.contactId,contTabExpr:h.isGroup,contImgExpr:w,contLastSeenExpr:f,contNameExpr:p,groupUserCountExpr:h.userCount,displayGroupUserCountExpr:k?"vis":"n-vis"}]).prependTo("#"+d)};b.getFileurl=function(a){return"object"===typeof a.fileMeta?
G+"/rest/ws/aws/file/"+a.fileMeta.blobKey:""};b.getFilePath=function(b){if(2===b.contentType)try{var h=a.parseJSON(b.message);if(h.lat&&h.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+h.lat+","+h.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+h.lat+","+h.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+h.lat+","+h.lon+"\x26key\x3d"+Nb+'"/\x3e\x3c/a\x3e'}catch(ua){if(-1!==
b.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+b.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+b.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.message+"\x26key\x3d"+Nb+'" /\x3e\x3c/a\x3e'}return"object"===typeof b.fileMeta?-1!==b.fileMeta.contentType.indexOf("image")?-1!==b.fileMeta.contentType.indexOf("svg")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
b.fileMeta.contentType+'" data-url\x3d"'+G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" data-name\x3d"'+b.fileMeta.name+'"\x3e\x3cimg src\x3d"'+G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':5===b.contentType?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+b.fileMeta.contentType+'" data-url\x3d"'+b.fileMeta.blobKey+'" data-name\x3d"'+b.fileMeta.name+'"\x3e\x3cimg src\x3d"'+b.fileMeta.blobKey+
'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+b.fileMeta.contentType+'" data-url\x3d"'+G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" data-name\x3d"'+b.fileMeta.name+'"\x3e\x3cimg src\x3d"'+b.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':-1!==b.fileMeta.contentType.indexOf("video")?'\x3ca href\x3d "#" target\x3d"_self"  \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+
G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3ca href\x3d"#" target\x3d"_self" \x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':
'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e':""};b.getImageForMessagePreview=function(b){if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")?'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" class\x3d"mck-image-reply move-right"/\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===b.contentType)return b=a.parseJSON(b.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
b.lat+","+b.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.lat+","+b.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};b.getImageForReplyMessage=function(b){var h=e.getTabDisplayName(b.to,!1);if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+h+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+
G+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+h+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(b.fileMeta.size)+
"\x3c/span\x3e\x3c/span\x3e":'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+h+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===b.contentType)return b=a.parseJSON(b.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+
h+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+b.lat+","+b.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.lat+","+b.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};b.getFileAttachment=function(a){if("object"===typeof a.fileMeta)return-1!==
a.fileMeta.contentType.indexOf("image")||-1!==a.fileMeta.contentType.indexOf("audio")||a.fileMeta.contentType.indexOf("video"),'\x3ca href\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+la.getFilePreviewSize(a.fileMeta.size)+
"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e"};b.getFileIcon=function(a){return a.fileMetaKey&&"object"===typeof a.fileMeta?-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eImage\x3c/span\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eAudio\x3c/span\x3e':-1!==a.fileMeta.contentType.indexOf("video")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eVideo\x3c/span\x3e':
'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eFile\x3c/span\x3e':""};b.getContactFromGroupOfTwo=function(a){for(var b=0;b<a.members.length;b++)if(z!==""+a.members[b])return e.fetchContact(""+a.members[b])};b.getContactImageLink=function(a,d){var h="";if(a.isGroup&&7!==a.type)h=t.getGroupImage(a.imageUrl);else{a.isGroup&&7===a.type&&1<a.members.length&&(a=b.getContactFromGroupOfTwo(a));if("function"===typeof Ra){var c=Ra(a.contactId);c&&"undefined"!==typeof c&&(h='\x3cimg src\x3d"'+
c+'"/\x3e')}h||(a.photoSrc?h='\x3cimg src\x3d"'+a.photoSrc+'"/\x3e':a.photoData?h='\x3cimg src\x3d"data:image/jpeg;base64,'+a.photoData+'"/\x3e':a.photoLink?h='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+a.photoLink+'"/\x3e':(d||(d=a.displayName),h=b.getContactImageByAlphabet(d)))}return h};b.getContactImageByAlphabet=function(a){if("undefined"===typeof a||""===a)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';
a=a.charAt(0);return a.match(/^[a-zA-Z]+$/)?(a=a.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+a+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+a+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};b.getNameTextClassByAlphabet=function(a){if("undefined"===typeof a||""===a)return"mck-text-user";a=a.toString();a=a.charAt(0);return a.match(/^[a-zA-Z]+$/)?(a=a.toLowerCase(),"mck-text-"+a):"mck-text-user"};
b.addContactsFromMessageList=function(h,d){D.removeClass("vis").addClass("n-vis");if("null"===h+"")var c="";else db.removeClass("vis").addClass("n-vis"),0==A.has(a("#mck-contact-list")).length&&A.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof h.message.length?(h.message.groupId?b.addGroupFromMessage(h.message):b.addContactsFromMessage(h.message),c=h.message.createdAtTime):a.each(h.message,function(a,h){"undefined"!==
typeof h.to&&(h.groupId?b.addGroupFromMessage(h,!0):b.addContactsFromMessage(h,!0),c=h.createdAtTime)}),A.data("datetime",c),d.isReload&&(h="",d.lastActiveTabId&&(d=d.isLastActiveTabGroup?"group-"+d.lastActiveTabId:"user-"+mckContactUtils.formatContactId(d.lastActiveTabId),h=a("#li-"+d)),0<h.length?A.animate({scrollTop:h.offset().top-A.offset().top+A.scrollTop()},"fast"):A.animate({scrollTop:0},0))};b.addGroupFromMessageList=function(h,d){"null"!==h+""&&(d&&A.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),
"undefined"===typeof h.message.length?b.addGroupFromMessage(h.message):a.each(h.message,function(a,h){"undefined"!==typeof h.to&&b.addGroupFromMessage(h,!0)}))};b.createContact=function(a){var h=b.getContactDisplayName(a);"undefined"===typeof h&&(h=a);h={contactId:a,htmlId:mckContactUtils.formatContactId(a),displayName:h,name:h+" \x3c"+a+"\x3e [Main]",value:a,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return za[a]=h};b.createContactWithDetail=function(a){var h=a.displayName,
d=a.userId;h||(h=b.getContactDisplayName(d));"undefined"===typeof h?h=d:ya[d]=h;var c=a.photoLink?a.photoLink:"";c||(c=a.imageLink?a.imageLink:"");a=a.imageData?a.imageData:"";h={contactId:d,htmlId:mckContactUtils.formatContactId(d),displayName:h,name:h+" \x3c"+d+"\x3e [Main]",value:d,photoLink:"",photoSrc:c,photoData:a,email:"",unsaved:!0,isGroup:!1};return za[d]=h};b.updateContactDetail=function(a,d){var h=d.displayName,c=d.userId;a.displayName&&a.displayName!==a.contactId||(h||(h=b.getContactDisplayName(c)),
"undefined"===typeof h?h=c:ya[c]=h,a.displayName=h);(h=d.photoLink)||(h=d.imageLink?d.imageLink:"");h&&!a.photoSrc&&(a.photoSrc=h);(d=d.imageData?d.imageData:"")&&!a.photoData&&(a.photoData=d);return za[c]=a};b.addContactsFromMessage=function(a,d){var h=b.getUserIdFromMessage(a);if(0<h.length&&h[0])for(var c=0;c<h.length;c++){var e=b.fetchContact(""+h[c]);b.updateRecentConversationList(e,a,d)}};b.addGroupFromMessage=function(a,d){var h=a.groupId,c=mckGroupUtils.getGroup(""+h);"undefined"===typeof c&&
(c=mckGroupUtils.createGroup(h),mckGroupService.loadGroups({apzCallback:t.loadGroups}));b.updateRecentConversationList(c,a,d)};b.updateRecentConversationList=function(h,d,c){0<a("#mck-contact-list #li-"+(h.isGroup?"group-"+h.htmlId:"user-"+h.htmlId)).length?(a("#mck-contact-list #li-"+h.htmlId+" .mck-cont-msg-wrapper").is(":empty")||c)&&void 0!==d&&b.updateContact(h,d,"mck-contact-list"):b.addContact(h,"mck-contact-list",d)};b.addContactsToSearchList=function(){var h=[],d=[];a.each(Sa,function(a,
b){d.push(b.contactId)});var c=d.filter(function(a,b){return d.indexOf(a)===b});c.sort();Va.removeClass("vis").addClass("n-vis");0<c.length?a.each(c,function(d,c){c&&(d=b.fetchContact(""+c),h.push(d),0===a("#li-cs-user-"+d.htmlId).length&&b.addContactForSearchList(d,"mck-contact-search-list"))}):O.removeClass("n-vis").addClass("vis");b.initAutoSuggest({contactsArray:h,$searchId:ta,isContactSearch:!0})};b.initAutoSuggest=function(h){for(var d=h.contactsArray,c=h.$searchId,p=[],u,f={},g=[],k=0;k<d.length;k++){var m=
d[k];m.displayName=b.getTabDisplayName(m.contactId,m.isGroup);u=m.displayName?a.trim(m.displayName):a.trim(m.contactId);f[u]=m;p.push(u);g.push(u)}d=function(a){a=f[a];var b=a.displayName.split(" "),h=b.length,d=b[0],c="",e="";2===h?e=b[1]:3<=h&&(e=b[h-1],c=b[h-2]);b=new RegExp(this.query,"i");return b.test(a.displayName)||b.test(a.contactId)||b.test(c)||b.test(e)||b.test(a.email)||b.test(d+" "+e)};u=function(a){return f[a].displayName};g=function(a){a=f[a];h.isContactSearch?(e.loadTab({tabId:a.contactId,
isGroup:a.isGroup}),jb.removeClass("n-vis").addClass("vis")):t.addGroupMemberFromSearch(a.contactId)};c.hasClass("mck-typeahead")?(c.mcktypeahead().data("mcktypeahead").source=p,c.mcktypeahead().data("mcktypeahead").matcher=d,c.mcktypeahead().data("mcktypeahead").highlighter=u,c.mcktypeahead().data("mcktypeahead").updater=g):(c.addClass("mck-typeahead"),c.mcktypeahead({source:p,matcher:d,highlighter:u,updater:g}))};b.initSearchAutoType=function(){Yb&&(ta.keypress(function(a){if(13===a.which){if(a=
ta.val())if(a="undefined"!==typeof a&&""!==a?a.toString():"")e.loadTab({tabId:a,isGroup:!1,isSearch:!0}),jb.removeClass("n-vis").addClass("vis");ta.val("")}}),qa.keypress(function(a){if(13===a.which)return!0}),a(n).on("click",".mck-group-search-link",function(a){a.preventDefault();return!0}),a(n).on("click",".mck-contact-search-link",function(a){a.preventDefault();a=ta.val();""!==a&&(e.loadTab({tabId:a,isGroup:!1,isSearch:!0}),jb.removeClass("n-vis").addClass("vis"));ta.val("")}))};b.removeContact=
function(b){a("#li-"+(b.isGroup?"group-"+b.htmlId:"user-"+b.htmlId)).remove()};b.updateContact=function(h,d,c){var e=h.isGroup?"group-"+h.htmlId:"user-"+h.htmlId,p=a("#li-"+e),u=p.data("msg-time");if(d&&d.createdAtTime>u){u=b.getUnreadCount(d.groupId?"group_"+h.contactId:"user_"+h.contactId);h=b.getMessageTextForContactPreview(d,h,15);a("#li-"+e+" .mck-cont-msg-date").html("undefined"===typeof d.createdAtTime?"":mckDateUtils.getTimeOrDate(d?d.createdAtTime:"",!0));var f=a("#li-"+e+" .mck-cont-msg-wrapper");
f.html("");"object"===typeof h?f.append(h):f.html(h);d.conversationId&&(h=d.conversationId,f=N[h],"object"===typeof f&&(f=f.topicId)&&Ca&&(f=J[f],"object"===typeof f&&a("#li-"+e+" .mck-conversation-topic").html(f.title)),a("#li-"+e+" a").data("mck-conversationid",h));0<u&&(a("#li-"+e+" .mck-unread-count-text").html(u),a("#li-"+e+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));e=a("#"+c+" li:nth-child(1)").data("msg-time");p.data("msg-time",d.createdAtTime);("undefined"===typeof e||
(d?d.createdAtTime:"")>=e)&&0!==a("#mck-contact-list li").index(p)&&a("#"+c+" li:nth-child(1)").before(p)}};b.clearContactMessageData=function(b,d){b=mckContactUtils.formatContactId(b);d=d?"group-"+b:"user-"+b;a("#li-"+d+" .mck-cont-msg-date").html("");a("#li-"+d+" .mck-cont-msg-wrapper").html("")};b.addContact=function(d,c,p){var h=b.getMessageTextForContactPreview(p,d,100),u=d.userCount,f="",w=!1;if("undefined"!==typeof p){if(p.conversationId){f=p.conversationId;var k=N[f]}p.groupId&&(w=!0)}var m=
b.getTabDisplayName(d.contactId,w),l=b.getContactImageLink(d,m),La=!1,L=b.getUnreadCount(w?"group_"+d.contactId:"user_"+d.contactId),Xa=0<L&&"mck-search-list"!==c?"vis":"n-vis",A="n-vis",q=w?"group-"+d.htmlId:"user-"+d.htmlId,n=w&&Eb;a("#li-"+q+" .mck-group-count-text").html(u);a("#li-"+q+" .mck-group-count-box").removeClass("n-vis").addClass("vis");w||oa[d.contactId]||Ha[d.contactId]||!nb||!g.MCK_OL_MAP[d.contactId]||(A="vis",La=!0);7===d.type&&1<d.members.length&&(q=mckGroupUtils.getGroup(p.groupId),
q=e.getContactFromGroupOfTwo(q),w&&nb&&g.MCK_OL_MAP[q.contactId]&&(A="vis",La=!0));u="n-vis";if("object"===typeof k&&Ca&&(k=J[k.topicId],"object"===typeof k)){u="vis";var ua=k.title}q=w?"group-"+d.htmlId:"user-"+d.htmlId;d=[{contHtmlExpr:q,contIdExpr:d.contactId,contTabExpr:w,msgCreatedAtTimeExpr:p?p.createdAtTime:"",mckLauncherExpr:ab,contImgExpr:l,contOlExpr:A,onlineLabel:MCK_LABELS.online,contUnreadExpr:Xa,contUnreadCount:L,contNameExpr:m,conversationExpr:f,contHeaderExpr:u,titleExpr:ua,groupUserCountExpr:w?
d.userCount:"",displayGroupUserCountExpr:n?"vis":"n-vis",msgCreatedDateExpr:p?mckDateUtils.getTimeOrDate(p.createdAtTime,!0):""}];ua=a("#"+c+" li:nth-child(1)").data("msg-time");"undefined"===typeof ua||(p?p.createdAtTime:"")>=ua||-1!==c.indexOf("search")&&La?a.tmpl("contactTemplate",d).prependTo("#"+c):a.tmpl("contactTemplate",d).appendTo("#"+c);c=a("#li-"+q+" .msgTextExpr");"object"===typeof h?c.append(h):c.html(h)};b.addContactsToContactSearchList=function(){O.removeClass("vis").addClass("n-vis");
ra.removeClass("vis").addClass("n-vis");xa.hasClass("active")||(fa.removeClass("active"),xa.addClass("active"));pa.removeClass("vis").addClass("n-vis");na.removeClass("n-vis").addClass("vis");ma.removeClass("vis").addClass("n-vis");K.removeClass("n-vis").addClass("vis");na.html("");ea.removeClass("vis").addClass("n-vis");p.removeClass("vis").addClass("n-vis");Ka.removeClass("vis").addClass("n-vis");ib.removeClass("vis").addClass("n-vis");ka.removeClass("n-vis").addClass("vis");Va.removeClass("n-vis").addClass("vis");
0!==Sa.length?e.addContactsToSearchList():Fb?(Va.removeClass("vis").addClass("n-vis"),O.removeClass("n-vis").addClass("vis")):da.loadContacts();ta.focus()};b.addGroupsToGroupSearchList=function(){var d=[],c=[];O.removeClass("vis").addClass("n-vis");ra.removeClass("vis").addClass("n-vis");wa.hasClass("active")||(fa.removeClass("active"),wa.addClass("active"));na.removeClass("vis").addClass("n-vis");pa.removeClass("n-vis").addClass("vis");K.removeClass("vis").addClass("n-vis");ma.removeClass("n-vis").addClass("vis");
pa.html("");ea.removeClass("vis").addClass("n-vis");p.removeClass("vis").addClass("n-vis");Ka.removeClass("vis").addClass("n-vis");ib.removeClass("vis").addClass("n-vis");ka.removeClass("n-vis").addClass("vis");Va.removeClass("n-vis").addClass("vis");if(0<gb.length){a.each(gb,function(a,b){c.push(b.contactId)});var e=c.filter(function(a,b){return c.indexOf(a)===b});e.sort();a.each(e,function(h,c){c&&(h=mckGroupUtils.getGroup(""+c),d.push(h),0===a("#li-gs-group-"+h.htmlId).length&&b.addContactForSearchList(h,
"mck-group-search-list"))})}else ra.removeClass("n-vis").addClass("vis");b.initAutoSuggest({contactsArray:d,$searchId:qa,isContactSearch:!0});Va.removeClass("vis").addClass("n-vis")};b.addConversationMenu=function(b,d){var h=A.data("mck-id");Ya.html("");b===h&&(h=Y[b],"undefined"===typeof h||0===h.length||1===h.length?(S.addClass("n-vis"),m.addClass("mck-product-box-wc"),Ya.addClass("n-vis")):(Ya.removeClass("n-vis"),S.removeClass("n-vis"),m.removeClass("mck-product-box-wc"),a.each(h,function(h,c){0===
a("#mck-conversation-list #li-"+c.id).length&&(h="",c.topicDetail&&(h=a.parseJSON(c.topicDetail),h="object"===typeof h?h.title:c.topicDetail),h||(h=c.topicId),a.tmpl("convTemplate",[{convIdExpr:c.id,tabIdExpr:b,isGroupExpr:d,topicIdExpr:c.topicId,convTitleExpr:h,mckLauncherExpr:ab}]).appendTo(Ya))}),2>a("#mck-conversation-list li").length&&(S.addClass("n-vis"),m.addClass("mck-product-box-wc"),Ya.addClass("n-vis"))))};b.loadContacts=function(d){"null"!==d+""&&"undefined"!==typeof d&&"undefined"!==
typeof d.contacts&&0!==d.contacts.length&&(Sa.length=0,Ta.length=0,a.each(d.contacts,function(a,d){"undefined"!==typeof d.userId&&(a=b.getContact(""+d.userId),a="undefined"===typeof a?b.createContactWithDetail(d):b.updateContactDetail(a,d),Sa.push(a),Ta.push(a.contactId))}))};b.getStatusIcon=function(a){return'\x3cspan class\x3d"'+b.getStatusIconName(a)+" move-right "+a.key+'_status status-icon"\x3e\x3c/span\x3e'};b.getStatusIconName=function(a){return 7===a.type||6===a.type||4===a.type||0===a.type?
"":5===a.status?"mck-icon-read":4===a.status?"mck-icon-delivered":3===a.type||5===a.type||1===a.type&&(0===a.source||1===a.source)?"mck-icon-sent":""};b.clearMessageField=function(a){P.html("");ba.attr("disabled",!1);y.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required","").html("");a?P.focus().select():(l.blur(),P.blur())};b.addDraftMessage=function(b){E=[];b&&"object"===typeof Na[b]?(b=Na[b],P.html(b.text),0<b.files.length&&(a.each(b.files,function(a,b){la.addFileBox(b)}),
f.html(b.filelb),x.html(b.filesize),y.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):E=[]};b.showOfflineMessage=function(){"object"===typeof aa&&aa.innerHTML?(Jb.html(aa.innerHTML),Jb.removeClass("n-vis").addClass("vis")):g.console.log("Offline message innerHTML required.")};b.hideOfflineMessage=function(){cb.stopOfflineMessageCounter();Jb.removeClass("vis").addClass("n-vis")};b.removeConversationThread=function(b,d){B.clearMckMessageArray();var c=d?mckGroupUtils.getGroup(b):
e.getContact(b),h=A.data("mck-id"),p=A.data("isgroup");"undefined"===typeof h||""===h?(b="undefined"!==typeof c?c.htmlId:mckContactUtils.formatContactId(b),a("#li-"+(d?"group-"+b:"user-"+b)).remove()):h===b&&p===d&&(u.data("datetime",""),D.removeClass("n-vis").addClass("vis"),H.removeClass("n-vis").addClass("vis"),Za.removeClass("vis").addClass("n-vis"))};b.removedDeletedMessage=function(b,d,c){B.clearMckMessageArray();b=a("."+b);0<b.length?(b.remove(),A.is(":empty")&&(H.removeClass("n-vis").addClass("vis"),
Za.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof d&&0<a("#mck-contact-list").length&&v.updateContactList(d,c)};b.getMessageTextForContactPreview=function(a,b,d){var c="";if("undefined"!==typeof a){if(a.message)if(2===a.contentType)c='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';else{c=a.message;if(mckUtils.startsWith(c,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';null!==g.emoji&&"undefined"!==typeof g.emoji&&
(c=g.emoji.replace_unified(c),c=g.emoji.replace_colons(c),c=-1!==c.indexOf("\x3c/span\x3e")?c.substring(0,c.lastIndexOf("\x3c/span\x3e")):c.substring(0,d));b.isGroup||-1!==c.indexOf("emoji-inner")||0!==a.contentType||(d=n.createElement("p"),d.appendChild(n.createTextNode(c)),c=d)}else a.fileMetaKey&&"object"===typeof a.fileMeta&&(c=e.getFileIcon(a));b.isGroup&&3!==b.type&&7!==b.type&&(b=a.to.split(",")[0]===z?"Me":e.getTabDisplayName(a.to.split(",")[0],!1),10!==a.contentType&&(c=b+": "+c),-1===c.indexOf("emoji-inner")&&
a&&a.message&&0===a.contentType&&(d=n.createElement("p"),d.appendChild(n.createTextNode(c)),c=d))}return c};b.getTextForMessagePreview=function(b,d){var c="";if("undefined"!==typeof b){if(2===b.contentType)c="Shared location";else if(b.message)if(c=b.message,mckUtils.startsWith(c,"\x3cimg"))c="Image attachment";else{var h=n.createElement("div");h.innerHTML=c;c=a.trim(mckUtils.textVal(h));c=c.substring(0,50)}else b.fileMetaKey&&"object"===typeof b.fileMeta&&(c=-1!==b.fileMeta.contentType.indexOf("image")?
"Image attachment":"File attachment");d.isGroup&&3!==d.type&&7!==d.type&&(c=(b.to.split(",")[0]===z?"Me":e.getTabDisplayName(b.to.split(",")[0],!1))+": "+c)}return c};b.getUserIdFromMessage=function(a){a=a.to;a.lastIndexOf(",")===a.length-1&&(a=a.substring(0,a.length-1));return a.split(",")};b.getUserIdArrayFromMessageList=function(d){var c=[];"undefined"===typeof d.length?c.concat(b.getUserIdFromMessage(d)):a.each(d,function(a,d){"undefined"!==typeof d.to&&(c=c.concat(b.getUserIdFromMessage(d)))});
return c};b.messageContextMenu=function(b){var d=a("."+b+" .mck-msg-box");d.addEventListener?d.addEventListener("contextmenu",function(a){a.preventDefault()},!1):d.bind("contextmenu",function(d){d.preventDefault();a(".mck-context-menu").removeClass("vis").addClass("n-vis");a("."+b+" .mck-context-menu").removeClass("n-vis").addClass("vis");g.event.returnValue=!1})};b.isValidMetaData=function(a){return a.metadata?"HIDDEN"===a.metadata.category||"ARCHIVE"===a.metadata.category?!1:!0:!0};b.updateDraftMessage=
function(b,d){if("object"===typeof d){var c={text:"",files:[]};var h={fileMeta:d,filelb:la.getFilePreviewPath(d),filesize:la.getFilePreviewSize(d.size)};"undefined"!==typeof b&&"object"===typeof Na[b]&&(c=Na[b],a.each(c.files,function(a,b){b.filelb===h.filelb&&c.files.splice(a,1)}));c.files.push(h)}Na[b]=c};b.updateUnreadCount=function(a,d,c){var h=b.getUnreadCount(a);Da[a]=d;if(c||0<Oa.length)X+=d-h,0>X&&(X=0),0<X?Oa.html(X):Oa.html("")};b.incrementUnreadCount=function(a){X+=1;Da[a]="undefined"===
typeof Da[a]?1:Da[a]+1;0<Oa.length&&Oa.html(X)};b.getUnreadCount=function(a){return"undefined"===typeof Da[a]?Da[a]=0:Da[a]};b.isGroupDeleted=function(a,b){return b?(a=t.getDeletedAtTime(a),"undefined"!==typeof a&&0<a):!1};b.getTabDisplayName=function(a,d,c){var e="";if(d)return t.getGroupDisplayName(a);"function"===typeof Qa&&(e=Qa(a));"undefined"!==typeof c&&c&&(e=c,ya[a]=c);e||(e=b.getContactDisplayName(a));d=b.fetchContact(""+a);e?(d.displayName=e,za[d.contactId]=d):"undefined"!==typeof d.displayName&&
(e=d.displayName);e||(e=a);return e};b.populateMessage=function(b,d,c){var p=mckDateUtils.convertMilisIntoTime(d.metadata.CALL_DURATION);da.loadUserProfile(d.to);103==d.contentType&&(4==d.type&&"CALL_REJECTED"==d.metadata.MSG_TYPE?d.message="you rejected a Video call from "+d.to:5==d.type&&"CALL_REJECTED"==d.metadata.MSG_TYPE?d.message=d.to+"rejected a Video call from you":4==d.type&&"CALL_END"==d.metadata.MSG_TYPE?d.message="you were in a call with "+d.to+"\n call duration : "+p:5==d.type&&"CALL_END"==
d.metadata.MSG_TYPE?d.message="you were in a call with "+d.to+"\n call duration : "+p:4==d.type&&"CALL_MISSED"==d.metadata.MSG_TYPE?d.message="you missed a Video call from "+d.to:5==d.type&&"CALL_MISSED"==d.metadata.MSG_TYPE&&(d.message=d.to+"missed a Video call from you"));var h=A.data("mck-id");var u=e.isValidMetaData(d);p=d.groupId?mckGroupUtils.getGroup(d.groupId):e.getContact(d.to);if("undefined"===typeof h||""===h){var f=a("#mck-contact-list").length;0<f&&u&&(d.groupId?e.addGroupFromMessage(d,
!0):e.addContactsFromMessage(d,!0));if("APPLOZIC_01"===b||"MESSAGE_RECEIVED"===b){"undefined"===typeof p&&(p=d.groupId?mckGroupUtils.createGroup(d.groupId):e.createContact(d.to));if(ob){e.loadTab({tabId:p.contactId,isGroup:p.isGroup,conversationId:d.conversationId});return}b=d.groupId?"group_"+p.contactId:"user_"+p.contactId;u&&(10!==d.contentType&&102!==d.contentType&&e.incrementUnreadCount(b),hb.notifyUser(d));c=d.groupId?"group-"+p.htmlId:"user-"+p.htmlId;a("#li-"+c+" .mck-unread-count-text").html(e.getUnreadCount(b));
0<e.getUnreadCount(b)&&a("#li-"+c+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");v.sendDeliveryUpdate(d)}}else if("undefined"===typeof p&&(p=d.groupId?mckGroupUtils.createGroup(d.groupId):e.createContact(d.to)),"APPLOZIC_01"===b||"MESSAGE_RECEIVED"===b){if("undefined"!==typeof p&&(b=A.data("isgroup"),0===a("."+d.oldKey).length&&0===a("."+d.key).length||10===d.contentType)){if("undefined"===typeof h||h!==p.contactId||b!==p.isGroup||Ka.hasClass("vis")){if(ob){e.loadTab({tabId:p.contactId,
isGroup:p.isGroup,conversationId:d.conversationId});return}if(u&&10!==d.contentType||102!==d.contentType)b=d.groupId?"group_"+p.contactId:"user_"+p.contactId,e.incrementUnreadCount(b);v.sendDeliveryUpdate(d)}else{u=!0;b&&6===p.type&&(u=t.isAppendOpenGroupContextMenu(p));if(d.conversationId&&(Ca||Ma))if((b=A.data("mck-conversationid"))&&b.toString()===d.conversationId.toString())d.metadata&&"HIDDEN"===d.metadata.category||e.addMessage(d,p,!0,!0,u),v.sendReadUpdate(d.pairedMessageKey);else{if(ob){e.loadTab({tabId:p.contactId,
isGroup:p.isGroup,conversationId:d.conversationId});return}}else 7===p.type&&(b=mckGroupUtils.getGroup(d.groupId),b=e.getContactFromGroupOfTwo(b),ca.lastSeenOfGroupOfTwo(b.contactId),e.addMessage(d,p,!0,!0,u)),(!d.metadata||"HIDDEN"!==d.metadata.category&&7!==p.type)&&e.addMessage(d,p,!0,!0,u),v.sendReadUpdate(d.pairedMessageKey);d.groupId||(a("#mck-tab-status").html(MCK_LABELS.online),ca.updateUserStatus({userId:d.to,status:1}))}c&&6!==p.type&&hb.notifyUser(d)}}else"APPLOZIC_02"===b&&102==!d.contentType&&
(0===a("."+d.oldKey).length&&0===a("."+d.key).length||10===d.contentType)&&(0<f?e.addContactsFromMessage(d,!0):"undefined"!==typeof p&&(b=A.data("isgroup"),"undefined"!==typeof h&&h===p.contactId&&b===p.isGroup&&(u=!0,b&&6===p.type&&(u=t.isAppendOpenGroupContextMenu(p)),d.metadata&&"HIDDEN"===d.metadata.category||e.addMessage(d,p,!0,!0,u),3===d.type&&(a("."+d.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(d.key)))));Ba.removeClass("vis").addClass("n-vis")};
b.getMessageFeed=function(b){var d={};d.key=b.key;d.timeStamp=b.createdAtTime;d.message=b.message;d.from=4===b.type?b.to:z;d.to=b.groupId?b.groupId:5===b.type?b.to:z;d.status="read";d.type=4===b.type?"inbox":"outbox";5===b.type&&(3===b.status?d.status="sent":4===b.status&&(d.status="delivered"));if("object"===typeof b.fileMeta){var c=a.extend({},b.fileMeta);if("undefined"===typeof c.url||""===c.url)c.url=G+"/rest/ws/aws/file/"+b.fileMeta.blobKey;delete c.blobKey;d.file=c}d.source=b.source;d.metadata=
b.metadata;return d};b.updateUnreadCountonChatIcon=function(b){if(Gb&&0<b.length){var d=null,c=0;0<b.length&&(a.each(b,function(a,b){!(0<b.unreadCount&&null!==d)&&0<b.unreadCount&&(d=b.userId,c=b.unreadCount)}),0<X&&"none"===q.css("display")&&(null!==d&&c===X?e.loadTab({tabId:d,isGroup:!1}):e.loadTab({tabId:"",isGroup:!1})))}};b.loadMessageListOnUserDetailFetch=function(b){Ba.removeClass("vis").addClass("n-vis");var d=A.data("mck-id"),c=A.data("isgroup");if("undefined"===typeof d||b.tabId===d&&""+
c===""+b.isGroup)d=mckGroupUtils.getGroup(b.tabId),t.addGroupStatus(d),c=!0,6===d.type&&(t.validateOpenGroupUser(d),c=t.isAppendOpenGroupContextMenu(d)),b.isMessages?(D.removeClass("vis").addClass("n-vis"),e.processMessageList(b.messageData,!0,c),6!==d.type&&Za.removeClass("n-vis").addClass("vis"),"function"===typeof Wa&&Wa(b.tabId)):0===a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(Za.removeClass("vis").addClass("n-vis"),D.removeClass("n-vis").addClass("vis"))}},v=new function(){var b=
this,c=a("#mck-search"),l=a("#mck-msg-to"),I=a("#mck-msg-new");a("#mck-audio");a("#mck-mike-btn");var f=a("#mck-sidebox"),x=a("#mck-file-box"),q=a("#mck-text-box"),y=a("#mck-msg-form"),ba=a("#mck-msg-sbmt"),C=a("#mck-new-group"),P=a("#mck-tab-title"),V=a("#mck-msg-error"),Ea=a("#mck-btn-attach"),Ua=a("#mck-tab-status"),H=a("#mck-message-cell"),G=a(".mck-typing-box"),D=a("#mck-gms-loading"),m=a("#mck-group-title"),Q=a("#mck-contact-loading"),L=a("#mck-no-messages"),ja=a(".mck-group-search"),S=a("#mck-msg-response"),
M=a("#mck-msg-form input"),K=a("#mck-block-button"),X=a("#li-mck-block-user"),ea=a("#li-mck-group-info"),ha=a("#li-mck-video-call"),ia=a("#mck_response_text"),na=a(".mck-contact-search"),ra=a("#mck-group-info-tab"),O=a("#mck-price-text-box");a("#mck-sidebox-search");var qa=a("#mck-group-info-btn");ra=a("#mck-group-info-tab");var R=a("#mck-btn-group-exit"),sa=a("#mck-group-back-link"),ma=a("#mck-btn-leave-group"),aa=a(".mck-sidebox-content"),la=a("#mck-no-more-messages"),xa=a("#mck-btn-group-create");
a("#mck-group-create-tab");var ya=a("#mck-group-add-member");a("#mck-contacts-content");var ta=a("#mck-tab-option-panel"),Aa=a("#mck-no-conversations"),fa=a("#mck-group-create-title"),Da=a(".mck-group-menu-options"),ka=a(".mck-tab-message-option"),Fa=a(".mck-group-admin-options"),va=a("#mck-group-member-search"),r=a("#mck-message-cell .mck-message-inner");a("#mck-search-cell .mck-message-inner");var za=a("#mck-no-more-conversations"),Ia=a("#mck-gm-search-box"),Oa=a("#mck-group-member-search-list"),
Pa=a("#mck-no-gsm-text");a.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');var Va,Qa=a("#mck-minutes"),Ra=a("#mck-seconds");b.timer=function(){var a=0,b=this;Va=setInterval(function(){++a;Ra.html(b.pad(a%60));Qa.html(b.pad(parseInt(a/60)))},1E3);b.pad=function(a){a+="";return 2>a.length?"0"+a:a}};
b.stoptimer=function(){Ra.html("0");Qa.html("0");clearInterval(Va)};a(n).on("click",".mck-message-delete",function(){b.deleteMessage(a(this).parents(".mck-m-b").data("msgkey"))});a(n).on("click",".mck-message-reply",function(){b.replyMessage(a(this).parents(".mck-m-b").data("msgkey"))});a(n).on("click",".mck-message-forward",function(){I.data("forwardMessageKey",a(this).parents(".mck-m-b").data("msgkey"));I.trigger("click")});a(".mck-minimize-icon").click(function(){a(".mck-box-md,.mck-box-ft").animate({height:"toggle"});
aa.hasClass("minimized")?(aa.css("height","100%"),aa.removeClass("minimized")):(aa.css("height","0%"),aa.addClass("minimized"))});b.init=function(){B.clearMckMessageArray();a(n).on("click","."+ab,function(){a(this).hasClass("mck-msg-preview")&&a(this).hide()});e.initSearchAutoType();na.click(function(){e.addContactsToContactSearchList()});ja.click(function(){e.addGroupsToGroupSearchList()});q.keydown(function(a){q.hasClass("mck-text-req")&&q.removeClass("mck-text-req");if(13===a.keyCode&&(a.shiftKey||
a.ctrlKey)){if(a.preventDefault(),g.getSelection){a=g.getSelection();var b=a.getRangeAt(0),d=n.createElement("br"),c=n.createTextNode("\u00a0");b.deleteContents();b.insertNode(d);b.collapse(!1);b.insertNode(c);b.selectNodeContents(c);a.removeAllRanges();a.addRange(b);q.animate({scrollTop:q.prop("scrollHeight")},0);return!1}}else 13===a.keyCode?(a.preventDefault(),1===wa&&U.sendTypingStatus(0,r.data("mck-id")),ba.is(":disabled")&&x.hasClass("vis")?alert("Please wait file is uploading."):y.submit()):
0===wa&&U.sendTypingStatus(1,r.data("mck-id"))});a(n).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&v.deleteConversation()});a(n).on("click",".applozic-tm-launcher",function(b){b.preventDefault();var d=a(this).data("mck-id");d="undefined"!==typeof d&&""!==d?d.toString():"";var c=a(this).data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():"";b=a(this).data("mck-supportid");b="undefined"!==typeof b&&""!==b?b.toString():"";var p=a(this).data("mck-topicid");
p="undefined"!==typeof p&&""!==p?p.toString():"";var f=a(this).data("mck-msg");f="undefined"!==typeof f&&""!==f?f.toString():"";if("function"===typeof Ja&&p){var g=Ja(p);"object"===typeof g&&"undefined"!==g.title&&(J[p]=g)}d={topicId:p,tabId:d,userName:c,isMessage:!0};d.messagePxy={type:5,contentType:0,message:f};b?(d.isGroup=!0,d.supportId=b,v.getConversationId(d)):(d.isGroup=!1,e.loadTab(d,v.dispatchMessage))});a(n).on("click",".applozic-wt-launcher",function(b){b.preventDefault();b=a(this).data("mck-id");
b="undefined"!==typeof b&&""!==b?b.toString():"";var d=a(this).data("mck-name");d="undefined"!==typeof d&&""!==d?d.toString():"";var c=a(this).data("mck-topicid");c="undefined"!==typeof c&&""!==c?c.toString():"";var e=a(this).data("mck-topic-status");e=e?-1===F.indexOf(e)?F[0]:e.toString():F[0];if("function"===typeof Ja){var p=Ja(c);"object"===typeof p&&"undefined"!==p.title&&(J[c]=p)}v.getConversationId({tabId:b,isGroup:!1,userName:d,topicId:c,topicStatus:e,isMessage:!1})});a(n).on("click",".applozic-ct-launcher",
function(b){b.preventDefault();var d=a(this).data("mck-id");d="undefined"!==typeof d&&""!==d?d.toString():"";var c=a(this).data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():"";b=a(this).data("mck-topicid");b="undefined"!==typeof b&&""!==b?b.toString():"";var e=a(this).data("mck-topic-status");e=e?-1===F.indexOf(e)?F[0]:e.toString():F[0];d={tabId:d,isGroup:!1,userName:c,topicId:b,topicStatus:e,isMessage:!1};"function"===typeof Db&&(c=Db(b),"object"===typeof c&&(c.topicDetail&&"object"===
typeof c.topicDetail&&"undefined"!==c.topicDetail.title&&(J[b]=c.topicDetail),c.fallBackTemplatesList&&0<c.fallBackTemplatesList.length&&(d.fallBackTemplatesList=c.fallBackTemplatesList)));v.getConversationId(d)});a(n).on("click","."+ab+", .mck-contact-list ."+ab,function(e){e.preventDefault();if("kommunicate"==window.applozic.PRODUCT_ID)"false"===ec?(a("#km-chatLoginModal").removeClass("n-vis").addClass("vis"),a("#km-chatLoginModal").css("display","block")):d();else{var p=this;a(this).parents(".mck-search-list").length?
(c.bind("blur"),setTimeout(function(){b.openChat(p)},600)):b.openChat(this)}});a("#km-form-chat-login").submit(function(b){b=$("#km-submit-chat-login");var c=$("#km-error-chat-login"),e=$("#km-userName").val();$("#km-email").val();b.attr("disabled",!0);b.html("Initiating chat...");c.removeClass("show").addClass("hide");c.html("");a.fn.applozic("reInitialize",{userId:e,appId:Z,onInit:d,baseUrl:MCK_BASE_URL,locShare:bb,googleApiKey:Ob});return!1});var d=function(){"kommunicate"==window.applozic.PRODUCT_ID&&
(ma.removeClass("vis").addClass("n-vis"),$(".mck-conversation-tab-link").removeClass("vis").addClass("n-vis"));a.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:"type\x3d10\x26startIndex\x3d0\x26limit\x3d10",contentType:"application/json",success:function(b){0<b.response.length?a.fn.applozic("loadGroupTab",b.response[0].id):a.fn.applozic("createGroup",{groupName:"Kommnicate",type:10,admin:"agent",users:[{userId:"bot",displayName:"Bot",groupRole:2,roleName:"APPLICATION_WEB_ADMIN"},{userId:"agent",
displayName:"Agent",groupRole:1,roleName:"APPLICATION_WEB_ADMIN"}],metadata:{CREATE_GROUP_MESSAGE:"",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",
ALERT:"false",HIDE:"true"},callback:function(a){}})}})};a(".km-login-model-close").on("click",function(b){a("#km-chatLoginModal").removeClass("vis").addClass("n-vis")});a(n).on("click",".mck-conversation-tab-link",function(b){b.preventDefault();a(this);b=r.data("mck-id");var d=r.data("isgroup");e.loadTab({tabId:"",isGroup:!1,lastActiveTabId:b,isLastActiveTabGroup:d})});a(n).on("click",".mck-close-sidebox",function(a){a.preventDefault();f.mckModal("hide");a=r.data("mck-conversationid");r.data("mck-id",
"");r.data("mck-topicid","");r.data("mck-name","");r.data("mck-conversationid","");a&&(a=N[a],"object"===typeof a&&(a=a.topicId,"function"===typeof xb&&xb(z,a)));U.unsubscibeToTypingChannel()});a(n).on("click",".mck-price-submit",function(a){a.preventDefault();b.sendPriceMessage()});O.keydown(function(a){13===a.keyCode&&b.sendPriceMessage()});r.bind("scroll",function(){if(0<r.find(".mck-contact-list").length){if(r.scrollTop()+r.innerHeight()>=r[0].scrollHeight){var a=r.data("datetime");0<a&&!Ga&&
v.loadMessageList({tabId:"",isGroup:!1,startTime:a})}}else if(0===r.scrollTop()){var b=r.data("mck-id");if("undefined"!==typeof b&&""!==b){var d=r.data("isgroup"),c=r.data("mck-conversationid");c=c?c.toString():"";a=ta.data("datetime");0<a&&!Ga&&v.loadMessageList({tabId:b,isGroup:d,conversationId:c,startTime:a})}}});O.on("click",function(a){a.preventDefault();O.removeClass("mck-text-req")});K.on("click",function(a){a.preventDefault();a=r.data("mck-id");var b=r.data("isgroup"),d=!r.data("blocked");
b?(X.removeClass("vis").addClass("n-vis"),ha.removeClass("vis").addClass("n-vis")):confirm(d?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"])&&da.blockUser(a,d)});ma.on("click",function(a){a.preventDefault();a=r.data("mck-id");r.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({apzCallback:t.onGroupLeft,groupId:a}):Da.removeClass("vis").addClass("n-vis")});a(n).on("click",".mck-add-to-group",function(b){b.preventDefault();b=a(this).data("mck-id");
"undefined"!==typeof b&&t.addGroupMemberFromSearch(b);Ia.mckModal("hide")});a(n).on("click",".mck-btn-remove-member",function(b){b.preventDefault();b=a(this).parents(".mck-li-group-member").data("mck-id");var d=ra.data("mck-id");if("undefined"!==typeof d&&"undefined"!==typeof b){var c=mckGroupUtils.getGroup(d);"object"===typeof c&&z===c.adminName?confirm(MCK_LABELS["remove.member.alert"])&&mckGroupService.removeGroupMember({groupId:d,userId:b,apzCallback:t.onRemovedGroupMember}):Fa.removeClass("vis").addClass("n-vis")}});
R.on("click",function(a){a.preventDefault();(a=ra.data("mck-id"))?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({groupId:a,apzCallback:t.onGroupLeft}):e.loadTab({tabId:"",isGroup:!1})});qa.on("click",function(a){a.preventDefault();a=r.data("mck-id");if(r.data("isgroup")){a={groupId:a};var b=r.data("mck-conversationid");b&&(a.conversationId=b);t.loadGroupInfo(a)}else Da.removeClass("vis").addClass("n-vis")});C.on("click",function(a){a.preventDefault();t.loadCreateGroupTab()});
sa.on("click",function(a){a.preventDefault();var b=ra.data("mck-id");a=ra.data("mck-conversation-id");b?(b={tabId:b,isGroup:!0},a&&(b.conversationId=a),e.loadTab(b)):e.loadTab({tabId:"",isGroup:!1})});ya.on("click",function(b){b.preventDefault();if(b=ra.data("mck-id"))(b=mckGroupUtils.getGroup(b))&&b.adminName===z?(Oa.html(""),Ia.mckModal(),D.removeClass("n-vis").addClass("vis"),0<Ta.length?t.addMembersToGroupSearchList():Fb?0<Sa.length?(a.each(Sa,function(a,b){Ta.push(b.contactId)}),t.addMembersToGroupSearchList()):
(D.removeClass("vis").addClass("n-vis"),Pa.removeClass("n-vis").addClass("vis")):da.getUserStatus({callback:t.addMembersToGroupSearchList})):Fa.removeClass("vis").addClass("n-vis")});va.keypress(function(a){if(13===a.which)return a=va.val(),""!==a&&t.addGroupMemberFromSearch(a),va.val(""),!0});a(n).on("click",".mck-group-member-search-link",function(a){a.preventDefault();a=va.val();""!==a&&t.addGroupMemberFromSearch(a);va.val("")});a(n).on("click",".mck-show-more",function(b){b.preventDefault();var d=
a(this);b=d.data("tabId");var c=r.data("isgroup"),e=r.data("mck-conversationid");e=e?e.toString():"";d=d.data("datetime");v.loadMessageList({tabId:b,isGroup:c,conversationId:e,startTime:d})});a(n).on("click",".mck-accept",function(b){b=a(this).data("mck-conversationid");var d=a(this).data("mck-topic-price");if("function"===typeof Ba&&d&&b){var c=N[b],e=l.val();e=t.getGroupDisplayName(e);"object"===typeof c?(Ba({custId:z,suppId:e,productId:c.topicId,price:d}),v.sendConversationCloseUpdate(b)):v.getTopicId({conversationId:b,
suppId:e,priceText:d})}});y.submit(function(){1===wa&&U.sendTypingStatus(0,r.data("mck-id"));var d=a.trim(mckUtils.textVal(q[0]));x.hasClass("n-vis")&&0<E.length&&(E=[]);if(0===d.length&&0===E.length)return q.addClass("mck-text-req"),!1;if("function"===typeof Bb&&!Bb(d))return!1;d={type:5,contentType:0,message:d};var c=r.data("mck-conversationid"),e=r.data("mck-topicid");c?d.conversationId=c:e&&(c={topicId:e},e=J[e],"object"===typeof e&&(c.topicDetail=g.JSON.stringify(e)),d.conversationPxy=c);!0===
r.data("isgroup")?d.groupId=l.val():d.to=l.val();ba.attr("disabled",!0);V.removeClass("vis").addClass("n-vis");V.html("");ia.html("");S.removeClass("vis").addClass("n-vis");b.sendMessage(d);return!1});M.on("click",function(){a(this).val("");V.removeClass("vis").addClass("n-vis");S.removeClass("vis").addClass("n-vis")});a(n).bind("click",function(b){a(".mck-context-menu").removeClass("vis").addClass("n-vis");!Ea.hasClass("on")||a(b.target).hasClass("mck-icon-upload")||a(b.target).hasClass("mck-btn-attach")||
Hb.fileMenuToggle();q.removeClass("mck-text-req");n.activeElement&&n.activeElement!==q&&1===wa&&U.sendTypingStatus(0,r.data("mck-id"));n.activeElement&&"mck-group-name-save"!==n.activeElement.id&&m.removeClass("mck-req-border");n.activeElement&&"mck-btn-group-create"!==n.activeElement.id&&fa.removeClass("mck-req-border");a(".mcktypeahead.mck-dropdown-menu").hide()});a(".mck-tabview-item").click(function(){a(".mck-tabview-item").removeClass("active");a(this).addClass("active")})};a(".mck-sidebox").on("click",
"#mck-mike-btn",function(){a(this).removeClass("vis").addClass("n-vis");$(".mck-stop-btn").addClass("vis").removeClass("n-vis");Fr.voice.record(!1,function(){$("#mck-audio").removeClass("n-vis").addClass("vis");v.timer()})});a(".mck-sidebox").on("click","#mck-stop-recording",function(){$("#mck-mike-btn").addClass("vis").removeClass("n-vis");$(".mck-stop-btn").addClass("n-vis").removeClass("vis");$("#mck-audio").removeClass("vis").addClass("n-vis");v.stoptimer();Fr.voice.export(function(b){var d={};
d.file=b;d.name="blob";a.fn.applozic("audioAttach",d)},"blob");Fr.voice.stop()});b.openChat=function(b){var d=a(b);b=d.data("mck-id");b="undefined"!==typeof b&&""!==b?b.toString():"";var f=d.data("mck-name");f="undefined"!==typeof f&&""!==f?f.toString():"";var g=d.data("mck-topicid");g="undefined"!==typeof g&&""!==g?g.toString():"";var k=!0===d.data("isgroup");d=d.data("mck-conversationid");d="undefined"!==typeof d&&""!==d?d.toString():"";g&&!d?(d=(d=a(elem).data("mck-topic-status"))?-1===F.indexOf(d)?
F[0]:d.toString():F[0],v.getConversationId({tabId:b,isGroup:k,userName:f,topicId:g,topicStatus:d,isMessage:!1})):e.loadTab({tabId:b,isGroup:k,userName:f,conversationId:d,topicId:g});c.val("")};b.sendMessage=function(d){if("object"===typeof d){var c=d.metadata?d.metadata:{},f=a("#mck-text-box").data("AL_REPLY");"undefined"===typeof f||""===f||d.forward||(c.AL_REPLY=f);d.metadata=c;if("undefined"!==typeof d.message&&0!==d.message.length||0!==E.length){if(d.conversationId&&(c=N[d.conversationId],"undefined"!==
c&&c.closed)){e.closeConversation();ba.attr("disabled",!1);return}if(r.data("blocked"))ca.toggleBlockUser(k,!0),ba.attr("disabled",!1);else{var g="";d.groupId?(g=mckGroupUtils.getGroup(d.groupId),"undefined"===typeof g&&(g=mckGroupUtils.createGroup(d.groupId))):g=d.clientGroupId?mckGroupUtils.getGroupByClientGroupId(d.clientGroupId):e.fetchContact(d.to);0<a("#mck-message-cell .mck-no-data-text").length&&a(".mck-no-data-text").remove();if(d.message&&0===E.length){c=ka.hasClass("n-vis");var k=r.data("mck-id");
var m=mckUtils.randomId();d.key=m;12!==d.contentType&&k&&k.toString()===g.contactId&&102!==d.contentType&&b.addMessageToTab(d,g);b.submitMessage(d,{tabId:g.contactId,isTopPanelAdded:c})}else 0<E.length&&a.each(E,function(a,c){a=ka.hasClass("n-vis");var e=r.data("mck-id"),f=mckUtils.randomId();d.key=f;d.fileMeta=c;d.contentType=1;12!==d.contentType&&e&&e.toString()===g.contactId&&b.addMessageToTab(d,g);b.submitMessage(d,{tabId:g.contactId,isTopPanelAdded:a})});q.removeClass("mck-text-req");ba.attr("disabled",
!1);a("."+m+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");e.addTooltip(m);e.clearMessageField(!0);E=[];delete Na[g.contactId]}}else q.addClass("mck-text-req")}};b.addMessageToTab=function(a,b){var d={to:a.to,groupId:a.groupId,deviceKey:a.deviceKey,contentType:a.contentType,message:a.message,conversationId:a.conversationId,topicId:a.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:a.key,storeOnDevice:!0,sent:!1,read:!0,metadata:a.metadata?a.metadata:""};
d.type=a.type?a.type:5;a.fileMeta&&(d.fileMeta=a.fileMeta);e.addMessage(d,b,!0,!0,!1)};b.sendForwardMessage=function(a){var d=B.getMessageByKey(a);if("undefined"!==typeof d){d.fileMeta&&E.push(d.fileMeta);a={type:5,contentType:d.contentType,message:d.message,forward:"forward"};d.metadata&&(d.metadata.AL_REPLY&&(d.metadata.AL_REPLY=""),a.metadata=d.metadata);var c=r.data("mck-conversationid");d=r.data("mck-topicid");c?a.conversationId=c:d&&(c={topicId:d},d=J[d],"object"===typeof d&&(c.topicDetail=
g.JSON.stringify(d)),a.conversationPxy=c);!0===r.data("isgroup")?a.groupId=l.val():a.to=l.val();b.sendMessage(a)}};b.sendWelcomeMessage=function(a){var d=mckUtils.randomId(),c=r.data("mck-id"),f=r.data("isgroup");d={key:d,type:4,contentType:0,to:a.sender,message:a.messageContent};c&&c.toString()===a.sender&&!f&&(c=e.fetchContact(c),b.addMessageToTab(d,c));mckUtils.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+encodeURIComponent(a.sender)+"\x26messageContent\x3d"+
encodeURIComponent(a.messageContent),contentType:"text/plain",success:function(b){a.callback&&a.callback(b)}})};b.submitMessage=function(b,c){var d=b.key,f=b.metadata?b.metadata:{};Sb&&(b.metadata={userStatus:4});var k=a("#mck-text-box").data("AL_REPLY");"undefined"===typeof k||""===k||b.forward||(f.AL_REPLY=k,a("#mck-text-box").data("AL_REPLY",""));b.source=jc;var m=a("#mck-message-cell .mck-message-inner div[name\x3d'message']."+d);102!=b.contentType&&103!=b.contentType&&(b.metadata=Rb);b.metadata=
f;mckUtils.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:g.JSON.stringify(b),contentType:"application/json",success:function(f){var g=r.data("mck-id");if("object"===typeof f){var k=f.messageKey;if(g&&g.toString()===c.tabId){var p=f.conversationId;r.data("mck-conversationid",p);m.removeClass(d).addClass(k);m.data("msgkey",k);a("."+k+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title","sent");e.addTooltip(k);c.isTopPanelAdded&&ta.data("datetime",
f.createdAt);f=!0;b.groupId&&6===mckGroupUtils.getGroup(b.groupId).type&&(f=!1);f&&e.messageContextMenu(k)}b.conversationPxy&&(k=b.conversationPxy,b.topicId&&(pa[b.topicId]=[p]),N[p]=k)}else"CONVERSATION_CLOSED"===f||"BUSY_WITH_OTHER"===f?(ba.attr("disabled",!1),e.closeConversation(f),m.remove(),c.isTopPanelAdded&&ka.removeClass("vis").addClass("n-vis")):"error"===f&&(ba.attr("disabled",!1),V.html("Unable to process your request. Please try again"),V.removeClass("n-vis").addClass("vis"),m.remove(),
c.isTopPanelAdded&&ka.removeClass("vis").addClass("n-vis"))},error:function(){V.html("Unable to process your request. Please try again.");V.removeClass("n-vis").addClass("vis");m&&m.remove();c.isTopPanelAdded&&ka.removeClass("vis").addClass("n-vis")}});$("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};b.downloadImage=function(a){window.open(a,"_blank")};b.replyMessage=function(b){r.data("mck-id");var d=v.getReplyMessageByKey(b);q.focus().select();$("#mck-reply-to-div").removeClass("n-vis").addClass("vis");
var c=5===d.type?"You":e.getTabDisplayName(d.to,!1);$("#mck-reply-to").html(c);"object"===typeof d.fileMeta||2===d.contentType?$("#mck-reply-msg").html(e.getImageForMessagePreview(d)):$("#mck-reply-msg").html(d.message);a("#mck-text-box").data("AL_REPLY",b)};$("#close").click(function(){$("#mck-reply-to-div").removeClass("vis").addClass("n-vis");a("#mck-text-box").data("AL_REPLY","")});b.deleteMessage=function(b){var d=r.data("mck-id");"undefined"!==typeof d&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+
b,type:"get",success:function(c){"success"===c?(r.data("mck-id")===d&&(a("."+b).remove(),r.is(":empty")&&ka.removeClass("vis").addClass("n-vis")),B.clearMckMessageArray()):g.console.log("Unable to delete message. Please reload page.")}})};b.deleteConversation=function(){var a=r.data("mck-id"),b=r.data("isgroup"),c=r.data("mck-conversationid");"undefined"!==typeof a&&(b=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a),c&&(b+="\x26conversationId\x3d"+c),Ga=!0,mckUtils.ajax({type:"get",url:MCK_BASE_URL+
"/rest/ws/message/delete/conversation",global:!1,data:b,success:function(){r.data("mck-id")===a&&(r.html(""),ta.data("datetime",""),H.removeClass("n-vis").addClass("vis"),L.removeClass("n-vis").addClass("vis"),ka.removeClass("vis").addClass("n-vis"),Ga=!1)},error:function(){}}))};b.getMessages=function(a){var b="";"undefined"!==typeof a.userId&&""!==a.userId?(b=a.isGroup?"\x26groupId\x3d"+a.userId:"\x26userId\x3d"+encodeURIComponent(a.userId),a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26pageSize\x3d30",
(Ca||Ma)&&a.conversationId&&(b+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof Y[a.userId]&&(b+="\x26conversationReq\x3dtrue"))):(a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26mainPageSize\x3d100");var d={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+b,type:"get",success:function(b){d.status="success";d.data=b;a.callback&&a.callback(d)},error:function(b,c,e){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));d.status="error";
a.callback&&a.callback(d)}})};b.getMessageList=function(b){var d=b.id;if("undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId){var c=b.pageSize?"\x26pageSize\x3d"+b.pageSize:"\x26pageSize\x3d50";c+="\x26clientGroupId\x3d"+b.clientGroupId;b.startTime&&(c+="\x26endTime\x3d"+b.startTime);var f={clientGroupId:b.clientGroupId}}else"undefined"!==typeof d&&""!==d?(c=b.pageSize?"\x26pageSize\x3d"+b.pageSize:"\x26pageSize\x3d50",c+="true"===""+b.isGroup?"\x26groupId\x3d"+d:"\x26userId\x3d"+d,b.startTime&&
(c+="\x26endTime\x3d"+b.startTime),f={id:d}):(c=b.pageSize?"\x26mainPageSize\x3d"+b.pageSize:"\x26mainPageSize\x3d50",b.startTime&&(c+="\x26endTime\x3d"+b.startTime),f={id:""});b.topicId&&(d||b.clientGroupId)&&(b.conversationId&&(c+="\x26conversationId\x3d"+b.conversationId),b.topicId&&(f.topicId=b.topicId));mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+c,type:"get",global:!1,success:function(d){f.status="success";if("undefined"===typeof d.message||0===d.message.length)f.messages=
[];else{var c=[];a.each(d.message,function(a,b){if("undefined"!==typeof b.to||"undefined"!==typeof b.groupId)a=e.getMessageFeed(b),c.push(a)});f.messages=c}0<d.groupFeeds.length&&(f.id=d.groupFeeds[0].id);b.callback(f)},error:function(a,d,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));f.status="error";b.callback(f)}})};b.getReplyMessageByKey=function(a){"undefined"===typeof B.getMessageByKey(a)&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/detail",async:!1,type:"get",
data:"keys\x3d"+a,success:function(a){B.updateMckMessageArray(a)}});return B.getMessageByKey(a)};b.loadMessageList=function(b,c){var d=!1,f=!1,k="";"undefined"!==typeof b.tabId&&""!==b.tabId?(k=b.isGroup?"\x26groupId\x3d"+b.tabId:"\x26userId\x3d"+encodeURIComponent(b.tabId),d=!0,b.startTime&&(k+="\x26endTime\x3d"+b.startTime),k+="\x26pageSize\x3d30",(Ca||Ma)&&b.conversationId&&(k+="\x26conversationId\x3d"+b.conversationId,"undefined"===typeof Y[b.tabId]?(f=!0,k+="\x26conversationReq\x3dtrue"):e.addConversationMenu(b.tabId,
b.isGroup))):(Ga=!0,b.startTime&&(k+="\x26endTime\x3d"+b.startTime),k+="\x26mainPageSize\x3d60");b.startTime||r.html("");Q.removeClass("n-vis").addClass("vis");mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+k,type:"get",global:!1,success:function(k){var m=!0,l=r.data("mck-id"),p=r.data("isgroup");b.isGroup&&!b.startTime||Q.removeClass("vis").addClass("n-vis");Ga=!1;if("undefined"===typeof l||b.tabId===l&&""+p===""+b.isGroup){if("null"===k+""||"undefined"===typeof k.message||
0===k.message.length)m=!1,d?b.startTime?(la.removeClass("n-vis").addClass("vis"),la.fadeOut(5E3,function(){la.removeClass("vis").addClass("n-vis")}),ta.data("datetime","")):b.isGroup||0!==a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||(ka.removeClass("vis").addClass("n-vis"),Aa.removeClass("vis").addClass("n-vis"),L.removeClass("n-vis").addClass("vis")):(L.removeClass("vis").addClass("n-vis"),b.startTime?(za.removeClass("n-vis").addClass("vis"),za.fadeOut(5E3,function(){za.removeClass("vis").addClass("n-vis")})):
(L.removeClass("vis").addClass("n-vis"),Aa.removeClass("n-vis").addClass("vis")),r.data("datetime",""));if("null"!==k+""&&"error"!==k.status)if(d){m&&(0<b.startTime?e.processMessageList(k,!1,!0):b.isGroup||(e.processMessageList(k,!0,!0),ka.removeClass("n-vis").addClass("vis")));0< !b.startTime&&!b.isGroup&&"function"===typeof Wa&&Wa(b.tabId);0<k.userDetails.length&&a.each(k.userDetails,function(a,d){W[d.userId]=d;b.isGroup||(d.connected?g.MCK_OL_MAP[d.userId]=!0:(g.MCK_OL_MAP[d.userId]=!1,"undefined"!==
typeof d.lastSeenAtTime&&(T[d.userId]=d.lastSeenAtTime)),eb||b.isGroup||(d.blockedByThis?(oa[d.userId]=!0,ca.toggleBlockUser(b.tabId,!0)):d.blockedByOther?(Ha[d.userId]=!0,P.removeClass("mck-tab-title-w-status"),Ua.removeClass("vis").addClass("n-vis"),G.removeClass("vis").addClass("n-vis"),r.data("blocked",!1)):ca.toggleBlockUser(b.tabId,!1)),d.userName&&!b.startTime&&(a=e.getTabDisplayName(b.tabId,b.isGroup,d.userName),P.html(a),P.attr("title",a)))});!fb||b.isGroup||b.startTime||g.MCK_OL_MAP[b.tabId]||
cb.manageOfflineMessageTime(b.tabId);if(0<k.conversationPxys.length){var u=[];a.each(k.conversationPxys,function(b,d){if("object"===typeof d&&(u.push(d),N[d.id]=d,pa[d.topicId]=[d.id],d.topicDetail))try{J[d.topicId]=a.parseJSON(d.topicDetail)}catch(Kb){g.console.log("Incorect Topic Detail!")}});f&&(Y[b.tabId]=u,e.addConversationMenu(b.tabId,b.isGroup))}b.conversationId&&(l=N[b.conversationId],"object"===typeof l&&l.closed&&e.closeConversation());b.startTime||(b.isGroup?(t.addGroupStatus(mckGroupUtils.getGroup(b.tabId)),
e.updateUnreadCount("group_"+b.tabId,0,!0)):e.updateUnreadCount("user_"+b.tabId,0,!0),"function"===typeof c&&c(b));0<k.groupFeeds.length&&a.each(k.groupFeeds,function(d,c){d=mckGroupUtils.addGroup(c);if(!b.startTime){var f=[];a.each(c.membersId,function(a,b){"undefined"===typeof e.getContact(b)&&f.push(b)});if(0<f.length)b.isMessages=m,b.messageData=k,b.isLoadMessageList=!0,da.getUsersDetail(f,b);else{t.addGroupStatus(d);c=!0;if(7===d.type){ea.removeClass("vis").addClass("n-vis");var h=e.getContactFromGroupOfTwo(d);
ca.lastSeenOfGroupOfTwo(h.contactId)}"kommunicate"==window.applozic.PRODUCT_ID&&(3!==d.users[z].role&&2!==d.users[z].role&&0!==d.users[z].role||ea.removeClass("vis").addClass("n-vis"));6===d.type&&(t.validateOpenGroupUser(d),c=t.isAppendOpenGroupContextMenu(d));Q.removeClass("vis").addClass("n-vis");m?(L.removeClass("vis").addClass("n-vis"),e.processMessageList(k,!0,c),6!==d.type&&ka.removeClass("n-vis").addClass("vis")):0===a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&
(ka.removeClass("vis").addClass("n-vis"),L.removeClass("n-vis").addClass("vis"));"function"===typeof Wa&&Wa(b.tabId)}}})}else b.startTime||(g.MCK_OL_MAP=[]),0<k.userDetails.length&&a.each(k.userDetails,function(a,b){W[b.userId]=b;b.connected?g.MCK_OL_MAP[b.userId]=!0:(g.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(T[b.userId]=b.lastSeenAtTime));e.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=e.getContact(""+b.userId);"undefined"===typeof a?e.createContactWithDetail(b):
e.updateContactDetail(a,b)}),0<k.groupFeeds.length&&a.each(k.groupFeeds,function(a,b){e.updateUnreadCount("group_"+b.id,b.unreadCount,!1);mckGroupUtils.addGroup(b)}),0<k.blockedUserPxyList.blockedToUserList.length&&a.each(k.blockedUserPxyList.blockedToUserList,function(a,b){b.userBlocked&&(oa[b.blockedTo]=!0)}),0<k.blockedUserPxyList.blockedByUserList.length&&a.each(k.blockedUserPxyList.blockedByUserList,function(a,b){b.userBlocked&&(Ha[b.blockedBy]=!0)}),0<k.conversationPxys.length&&a.each(k.conversationPxys,
function(b,d){N[d.id]=d;pa[d.topicId]=[d.id];if(d.topicDetail)try{J[d.topicId]=a.parseJSON(d.topicDetail)}catch(Kb){g.console.log("Incorect Topic Detail!")}}),m?(b.startTime?b.startTime&&(b.isReload=!1,d||B.updateLatestMessageArray(k.message)):(b.isReload=!0,d||B.setLatestMessageArray(k.message)),d&&B.updateMckMessageArray(k.message),e.addContactsFromMessageList(k,b)):r.data("datetime",""),b.isLaunch&&e.updateUnreadCountonChatIcon(k.userDetails)}l=I.data("forwardMessageKey");"undefined"!==typeof l&&
(v.sendForwardMessage(l),I.data("forwardMessageKey",""))},error:function(a,b,d){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));Ga=!1;Q.removeClass("vis").addClass("n-vis");g.console.log("Unable to load messages. Please reload page.")}})};b.updateContactList=function(a,b){var d=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list",data:"startIndex\x3d0\x26pageSize\x3d1\x26"+d,global:!1,type:"get",success:function(d){"null"===
d+""||"undefined"===typeof d.message||0===d.message.length?e.clearContactMessageData(a,b):(d=d.message[0],"undefined"!==typeof d&&(d.groupId?e.addGroupFromMessage(d,!0):e.addContactsFromMessage(d,!0)))},error:function(d,c,f){401===d.status&&(sessionStorage.clear(),console.log("Please reload page."));e.clearContactMessageData(a,b)}})};b.sendDeliveryUpdate=function(a){mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delivered",data:"key\x3d"+a.pairedMessageKey,global:!1,type:"get",success:function(){},
error:function(){}})};b.sendReadUpdate=function(a){"undefined"!==typeof a&&""!==a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read",data:"key\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};b.conversationReadUpdate=function(a,b){var d=b?"group_"+a:"user_"+a;a&&0<e.getUnreadCount(d)&&(a=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read/conversation",data:a,global:!1,type:"get",success:function(){e.updateUnreadCount(d,
0,!0)},error:function(){}}))};b.getConversationId=function(d){var c;if(!d.isGroup&&!d.isMessage&&d.topicStatus!==F[1]&&(c=pa[d.topicId])&&(c=N[c],"object"===typeof c)){r.data("mck-conversationid",c.id);d.conversationId=c.id;if("undefined"!==typeof Y[d.tabId]){var f=Y[d.tabId];f.push(c);Y[d.tabId]=f}e.loadTab(d);return}d.topicId&&(c={topicId:d.topicId,userId:d.tabId,status:d.topicStatus},d.isGroup&&(c.supportIds=[],c.supportIds.push(d.supportId)),f=J[d.topicId],"object"===typeof f&&(c.topicDetail=
g.JSON.stringify(f)),d.fallBackTemplatesList&&0<d.fallBackTemplatesList.length&&(c.fallBackTemplatesList=d.fallBackTemplatesList),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/id",global:!1,data:g.JSON.stringify(c),type:"post",contentType:"application/json",success:function(c){if("object"===typeof c&&"success"===c.status){var f=c.response;if("object"===typeof f&&"undefined"!==f.conversationPxy){c=f.conversationPxy;N[c.id]=c;pa[c.topicId]=[c.id];if(c.topicDetail)try{J[c.topicId]=a.parseJSON(c.topicDetail)}catch(Ya){g.console.log("Incorect Topic Detail!")}r.data("mck-conversationid",
c.id);d.conversationId=c.id;if("undefined"!==typeof Y[d.tabId]){var k=Y[d.tabId];k.push(c);Y[d.tabId]=k}d.isGroup&&(f=mckGroupUtils.addGroup(f),d.tabId=f.contactId);d.isMessage&&c.created?e.loadTab(d,b.dispatchMessage):e.loadTab(d)}}},error:function(){}}))};b.fetchConversationByTopicId=function(b){var c="topic\x3d"+b.topicId;if(b.tabId)c+="true"===""+b.isGroup?"\x26groupId\x3d"+b.tabId:"\x26userId\x3d"+encodeURIComponent(b.tabId);else if(b.clientGroupId)c+="\x26clientGroupId\x3d"+b.clientGroupId;
else return!1;b.pageSize&&(c+="\x26pageSize\x3d"+b.pageSize);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/get",data:c,type:"get",success:function(c){"object"===typeof c&&"success"===c.status?(c=c.response,0<c.length&&a.each(c,function(c,d){N[d.id]=d;pa[d.topicId]=[d.id];if(d.topicDetail)try{J[d.topicId]=a.parseJSON(d.topicDetail)}catch(db){g.console.log("Incorect Topic Detail!")}b.tabId&&"undefined"!==typeof Y[b.tabId]&&(c=Y[b.tabId],c.push(d),Y[b.tabId]=c)}),b.isExtMessageList&&(0<c.length?
(b.conversationId=c[0].id,b.pageSize=50,v.getMessageList(b)):"function"===typeof b.callback&&(c={},b.tabId?(c.id=b.tabId,c.isGroup=b.isGroup):b.clientGroupId&&(c.clientGroupId=b.clientGroupId),c.topicId=b.topicId,c.status="success",c.messages=[],b.callback(c)))):b.isExtMessageList&&"function"===typeof b.callback&&(c={},b.tabId?c.id=b.tabId:b.clientGroupId&&(c.clientGroupId=b.clientGroupId),c.topicId=b.topicId,c.status="error",c.errorMessage="Unable to process request. Please try again.",b.callback(c))},
error:function(){if("function"===typeof b.callback){var a={};b.tabId?a.id=b.tabId:b.clientGroupId&&(a.clientGroupId=b.clientGroupId);a.topicId=b.topicId;a.status="error";a.errorMessage="Unable to process request. Please try again.";b.callback(a)}}})};b.getTopicId=function(c){c.conversationId&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/topicId",data:"id\x3d"+c.conversationId,global:!1,type:"get",async:"undefined"!==typeof c.async?c.async:!0,success:function(d){if("object"===typeof d&&"success"===
d.status&&(d=d.response,"object"===typeof d)){pa[d.topicId]=[c.conversationId];N[c.conversationId]=d;if(d.topicDetail)try{J[d.topicId]=a.parseJSON(d.topicDetail)}catch(Xa){g.console.log("Incorect Topic Detail!")}"function"===typeof Ba&&c.priceText&&(Ba({custId:z,suppId:c.suppId,productId:d.topicId,price:c.priceText}),b.sendConversationCloseUpdate(c.conversationId));if(c.messageType&&"object"===typeof c.message){var f=c.message.groupId?c.message.groupId:c.message.to;if("undefined"!==typeof Y[f]){var k=
Y[f];k.push(d);Y[f]=k}("undefined"!==typeof c.populate?c.populate:1)&&e.populateMessage(c.messageType,c.message,c.notifyUser)}"function"===typeof c.callback&&c.callback(d)}},error:function(){}})};b.sendConversationCloseUpdate=function(b){b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/close",data:"id\x3d"+b,global:!1,type:"get",success:function(){},error:function(){}})};b.sendPriceMessage=function(){var c=O.val();if(""===c)O.addClass("mck-text-req");else{c=a.trim(c);var e=l.val();r.data("mck-conversationid",
k);var f={type:5,contentType:4,message:c};!0===r.data("isgroup")?f.groupId=e:f.to=e;if(r.data("mck-conversationid")){var k=r.data("mck-conversationid");f.conversationId=k;var g=N[k];"object"!==g?b.getTopicId({conversationId:k,suppId:e,priceText:c}):"function"===typeof Ba&&Ba({custId:z,suppId:e,productId:g.topicId,price:c});O.val("")}b.sendMessage(f)}};b.dispatchMessage=function(c){if("object"===c.messagePxy){var d=c.messagePxy;if(c.topicId){var e=J[c.topicId];if("object"===typeof e&&"undefined"!==
e.title)if(d.message||(d.message=a.trim(e.title)),c.conversationId)d.conversationId=c.conversationId;else if(c.topicId){var f={topicId:c.topicId};"object"===typeof e&&(f.topicDetail=g.JSON.stringify(e));d.conversationPxy=f}!d.message&&e.link&&(e={blobKey:a.trim(e.link),contentType:"image/png"},d.fileMeta=e,d.contentType=5,E=[],E.push(e))}c.isGroup?d.groupId=c.tabId:d.to=c.tabId;b.sendMessage(d)}};b.getGroup=function(c){var d=[];a.each(c.users,function(b,a){"undefined"!==typeof a.userId&&("undefined"!==
typeof a.groupRole&&-1===ub.indexOf(a.groupRole)||d.push(a))});var f={groupName:a.trim(c.groupName),users:d,type:c.type};c.admin&&(f.admin=c.admin);c.clientGroupId&&(f.clientGroupId=c.clientGroupId);c.groupIcon&&(f.imageUrl=c.groupIcon);f.metadata=c.metadata?c.metadata:MCK_LABELS["group.metadata"];var k={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/group/v2.1/create",global:!1,data:g.JSON.stringify(f),type:"post",contentType:"application/json",success:function(d){c.isInternal&&xa.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);
if("object"===typeof d&&"success"===d.status){if(d=d.response,"object"===typeof d){var f=mckGroupUtils.addGroup(d);0<d.users.length&&a.each(d.users,function(b,a){W[a.userId]=a;a.connected?g.MCK_OL_MAP[a.userId]=!0:(g.MCK_OL_MAP[a.userId]=!1,"undefined"!==typeof a.lastSeenAtTime&&(T[a.userId]=a.lastSeenAtTime));e.updateUnreadCount("user_"+a.userId,a.unreadCount,!1);b=e.getContact(""+a.userId);"undefined"===typeof b?e.createContactWithDetail(a):e.updateContactDetail(b,a)});c.tabId=f.contactId;c.isGroup=
!0;c.isMessage?e.loadTab(c,b.dispatchMessage):c.isInternal?(r.data("mck-id",f.contactId),r.data("isgroup",!0),t.loadGroupInfo({groupId:f.contactId})):e.loadTab(c);"function"===typeof c.callback&&(k.status="success",k.data=f,c.callback(k))}}else"error"===d.status&&"function"===typeof c.callback&&(k.status="error",k.errorMessage=d.errorResponse[0].description,c.callback(k))},error:function(){c.isInternal&&xa.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);"function"===typeof c.callback&&
(k.status="error",k.errorMessage="Unable to process request.",c.callback(k))}})};b.sendVideoCallMessage=function(a,c,e,f){var d="CALL_MISSED"==c?"Missed Call":"CALL_REJECTED"==c?"Call Rejected":"";if(""==d||void 0==d)d="video message";a={to:l.val(),type:5,contentType:e,message:d,metadata:{MSG_TYPE:c,CALL_ID:a,CALL_AUDIO_ONLY:f},senderName:z};b.sendMessage(a);return a};b.sendVideoCallEndMessage=function(a,c,e,f,k){var d="";k&&(d=mckDateUtils.convertMilisIntoTime(k));d="CALL_MISSED"==c?"Missed Call":
"CALL_REJECTED"==c?"Call Rejected":"CALL_END"==c?"Call End \n Duration: "+d:"video message";if(""==d||void 0==d)d="video message";a={to:l.val(),type:5,contentType:e,message:d,metadata:{MSG_TYPE:c,CALL_ID:a,CALL_AUDIO_ONLY:f,CALL_DURATION:k}};b.sendMessage(a);return a}},da=new function(){var b=this;a("#mck-search-list");var c=a("#mck-sidebox-search"),l=a("#mck-search-loading");a("#mck-search-cell .mck-message-inner");a("#mck-message-cell .mck-message-inner");a(".mck-tab-message-option");a("#mck-contact-loading");
b.getContactDisplayName=function(a){var b=[];if(0<a.length&&a[0]){for(var c="",k=a.filter(function(b,c){return a.indexOf(b)===c}),g=0;g<k.length;g++){var l=k[g];"undefined"===typeof ya[l]&&(c+="userIds\x3d"+encodeURIComponent(l)+"\x26")}c.lastIndexOf("\x26")===c.length-1&&(c=c.substring(0,c.length-1));c&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/info",data:c,global:!1,type:"get",success:function(a){for(var c in a)a.hasOwnProperty(c)&&(b.push([c,a[c]]),ya[c]=a[c],e.fetchContact(c).displayName=
a[c]);B.updateMckContactNameArray(b)},error:function(){}})}};b.loadContacts=function(){var b=[];mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d0\x26pageSize\x3d30\x26orderBy\x3d1",type:"get",global:!1,success:function(f){c.hasClass("vis")&&("object"===typeof f&&0<f.users.length&&(a.each(f.users,function(a,c){"undefined"!==typeof c.userId&&(a=e.getContact(""+c.userId),a="undefined"===typeof a?e.createContactWithDetail(c):e.updateContactDetail(a,c),Sa.push(a),b.push([c.userId,a.displayName]),
c.connected?g.MCK_OL_MAP[c.userId]=!0:(g.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(T[c.userId]=c.lastSeenAtTime)))}),0<b.length&&B.updateMckContactNameArray(b)),e.addContactsToSearchList())},error:function(){l.removeClass("vis").addClass("n-vis");g.console.log("Unable to load contacts. Please reload page.")}})};b.loadUserProfile=function(a){if("undefined"!==typeof a){var c=[];a=""+a.split(",")[0];c.push(a);b.loadUserProfiles(c)}};b.loadUserProfiles=function(c){var f=[];a.each(c,
function(a,b){"undefined"===typeof e.getContact(b)&&f.push(b)});b.getUsersDetail(f,{async:!1})};b.getUsersDetail=function(b,c){if(!("undefined"===typeof b||1>b.length)){for(var f="undefined"!==typeof c.cached?c.cached:!0,k=[],l=b.filter(function(a,c){return b.indexOf(a)===c}),n=0;n<l.length;n++){var C=l[n];f&&"undefined"!==typeof W[C]||k.push(C)}if(0===k.length)c.setStatus?ca.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);
else{var y={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/v2/detail",type:"post",async:"undefined"!==typeof c.async?c.async:!0,data:JSON.stringify({userIdList:k}),contentType:"application/json",success:function(b){"success"===b.status&&0<b.response.length&&a.each(b.response,function(a,b){W[b.userId]=b;g.MCK_OL_MAP[b.userId]=b.connected;a=e.getContact(""+b.userId);"undefined"===typeof a?e.createContactWithDetail(b):e.updateContactDetail(a,b)});c.setStatus?ca.updateUserConnectedStatus():c.message?
e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);y.status="success";y.data=b;c.callback&&c.callback(y)},error:function(){c.setStatus?ca.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);y.status="error";c.callback&&c.callback(y)}})}}};b.getUserStatus=function(b){var c={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/chat/status",
type:"get",success:function(f){0<f.users.length&&(Ta=[],a.each(f.users,function(a,b){a=e.getContact(""+b.userId);a="undefined"===typeof a?e.createContactWithDetail(b):e.updateContactDetail(a,b);Ta.push(a.contactId)}));c.status="success";c.data=f;b.callback&&b.callback(c)},error:function(){c.status="error";b.callback&&b.callback(c)}})};b.blockUser=function(a,b){a&&"undefined"!==typeof b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:"userId\x3d"+a+"\x26block\x3d"+b,success:function(c){"object"===
typeof c&&"success"===c.status&&(oa[a]=b,ca.toggleBlockUser(a,b))},error:function(){}})}},hb=new function(){var b=this,c,g,l,f,n,q,y,t;b.init=function(){a("#mck-sidebox");g=a("#mck-msg-preview");n=a("#mck-group-info-tab");a("#mck-sidebox-launcher");c=a("#mck-message-cell .mck-message-inner");l=a("#mck-msg-preview .mck-preview-icon");f=a("#mck-msg-preview .mck-preview-cont-name");y=a("#mck-msg-preview .mck-preview-msg-content");t=a("#mck-msg-preview .mck-preview-file-content")};b.notifyUser=function(a){if(7!==
a.type){var c=a.groupId?mckGroupUtils.getGroup(""+a.groupId):e.fetchContact(""+a.to.split(",")[0]),f=!1;a.groupId&&(f=!0);da.loadUserProfile(a.to);f=e.getTabDisplayName(c.contactId,f);var k=fc;b.showNewMessageNotification(a,c,f);if(Vb&&!rb){var g=hc;a=e.getTextForMessagePreview(a,c);"function"!==typeof Ra||c.isGroup||(c=Ra(c.contactId))&&"undefined"!==typeof c&&(g=c);mckNotificationUtils.sendDesktopNotification(f,g,a,k)}}};b.showNewMessageNotification=function(a,b,k){if(Wb&&102!==a.contentType){var q=
c.data("mck-id"),x=c.data("isgroup");if(q===b.contactId&&x===b.isGroup&&!n.hasClass("vis"))if(a.conversationId&&(Ca||Ma)){if(q=c.data("mck-conversationid"),q="undefined"!==typeof q&&""!==q?q.toString():"",q===a.conversationId.toString())return}else return;g.data("isgroup",b.isGroup);g.data("mck-conversationid",a.conversationId?a.conversationId:"");q=e.getContactImageLink(b,k);a.message?(x=e.getMessageTextForContactPreview(a,b,50),y.html(""),"object"===typeof x?y.append(x):y.html(x),y.removeClass("n-vis").addClass("vis")):
y.html("");a.fileMetaKey?(t.html(e.getFileIcon(a)),t.removeClass("n-vis").addClass("vis"),""===y.html()&&y.removeClass("vis").addClass("n-vis")):(t.html(""),t.removeClass("vis").addClass("n-vis"));f.html(k);l.html(q);g.data("mck-id",b.contactId);g.show();setTimeout(function(){g.fadeOut(3E3)},1E4)}};b.unsubscribeToServiceWorker=function(){q&&navigator.serviceWorker.ready.then(function(a){q.unsubscribe().then(function(a){q=null;console.log("Unsubscribed to notification successfully")})})};b.sendSubscriptionIdToServer=
function(){if(q){var a=q.endpoint.split("/").slice(-1)[0];a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/plugin/update/sw/id",type:"post",data:"registrationId\x3d"+a,success:function(a){},error:function(a,b,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."))}})}};b.subscribeToServiceWorker=function(){Xb&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",{scope:"./"}),navigator.serviceWorker.ready.then(function(a){a.pushManager.subscribe({userVisibleOnly:!0}).then(function(a){console.log("The reg ID is:: ",
a.endpoint.split("/").slice(-1));q=a;b.sendSubscriptionIdToServer()})}))}},Oa=a(".chat-launcher-icon"),ia=new function(){var b=this;b.token=null;b.Identity=null;b.outgoingCallServices=null;b.incomingCallServices=null;var c=a(".mck-videocall-btn"),g=a(".applozic-vid-container"),l=a("#mck-sidebox"),f=a("#mck-video-call-indicator");b.hideVideoBox=function(){g.addClass("n-vis").removeClass("vis");l.addClass("vis").removeClass("n-vis");f.addClass("n-vis").removeClass("vis")};b.init=function(){Fa.loop=
!0;b.token=null!==B.getAppHeaders()?B.getAppHeaders().videoToken:void 0;b.ringToneForHost=va.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",Fa);a("#mck-btn-video-call").on("click",function(c){if(b.token){c=z+(new Date).getTime().toString()+Math.random().toString(36).slice(2);var f=v.sendVideoCallMessage(c,"CALL_DIALED",102,!1),k=e.fetchContact(f.to);f=e.getTabDisplayName(k.contactId,!1);k=e.getContactImageLink(k,f);var g=new Date;b.outgoingCallServices=new MckCallingService(z,
ia.token,c,f,!0,g,v,k,!1,b.ringToneForHost);b.outgoingCallServices.startVideoCall();a("#mck-btn-video-call").data("isCallHost",!0);a("#mck-btn-video-call").data("callStartTime",g)}else alert("missing token... please refresh page..")});a("#mck-vid-receive-btn").on("click",function(b){console.log("call received");$("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");c.removeClass("vis").addClass("n-vis");b=a("#mck-video-call-indicator").data("call-id");var e=a("#mck-video-call-indicator").data("isAudioCall");
a("#mck-video-call-indicator").data("callReceived",!0);a("#mck-video-call-indicator").addClass("n-vis");ia.callReceived(b,e)});a("#mck-vid-reject-btn").on("click",function(b){console.log("call rejected");b=a("#mck-video-call-indicator").data("call-id");var c=a("#mck-video-call-indicator").data("isAudioCall");ia.callRejected(b,c);a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};b.InitilizeVideoClient=function(c,e){b.Identity=c;a.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",
contentType:"application/x-www-form-urlencoded",data:{identity:c,device:e},success:function(a){if(null!=a&&""!=a){b.token=a.token;var c=B.getAppHeaders();c.videoToken=a.token;B.setAppHeaders(c)}},error:function(a){console.log("error while getting token"+a)}})};b.callReceived=function(a,c){console.log("_this.callReceived");ma&&ma.stop();v.sendVideoCallMessage(a,"CALL_ANSWERED",102,c);b.incomingCallServices=new MckCallingService(b.Identity,b.token,a,null,!1,null,v,null,c);b.incomingCallServices.startVideoCall()};
b.callRejected=function(a,b){ma&&ma.stop();v.sendVideoCallMessage(a,"CALL_REJECTED",102,b)}},fc=null,Fa={},va,ma=null,ec=c.isAnonymousChat;g.MCK_OL_MAP=[];l.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},
onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};var U=new function(b){var c=this,l=b.events,n=null,f=null,x="",q=null,H=[],G,C,P="",M=a("#mck-sidebox"),E=a("#mck-tab-title"),K=a(".mck-typing-box"),F=a("#mck-tab-status");a("#mck-offline-message-box");var O=a("#mck-typing-label"),D=a("#mck-message-cell .mck-message-inner");c.init=function(){if("undefined"!==typeof kb){var a=
mckUtils.startsWith(kb,"https")?"15675":"15674";"function"===typeof g.SockJS&&(P||(P=new SockJS(kb+":"+a+"/stomp")),f=g.Stomp.over(P),f.heartbeat.outgoing=0,f.heartbeat.incoming=0,f.onclose=function(){c.disconnect()},f.connect("guest","guest",c.onConnect,c.onError,"/"),g.addEventListener("beforeunload",function(a){c.disconnect()}))}};c.checkConnected=function(a){f.connected?(G&&clearInterval(G),C&&clearInterval(C),G=setInterval(function(){c.connectToSocket(a)},6E5),C=setInterval(function(){c.sendStatus(1)},
12E5)):c.connectToSocket(a)};c.connectToSocket=function(a){if(!f.connected){if(a&&"block"===M.css("display"))if(a=D.data("mck-id")){var b=D.data("isgroup"),g=D.data("mck-conversationid"),k=D.data("mck-topicid");B.clearMckMessageArray();e.loadTab({tabId:a,isGroup:b,conversationId:g,topicId:k})}else B.clearMckMessageArray(),e.loadTab({tabId:"",isGroup:!1});c.init()}};c.stopConnectedCheck=function(){G&&clearInterval(G);C&&clearInterval(C);C=G="";c.disconnect()};c.disconnect=function(){f&&f.connected&&
(c.sendStatus(0),f.disconnect())};c.unsubscibeToTypingChannel=function(){f&&f.connected&&q&&(1===wa&&c.sendTypingStatus(0,x),q.unsubscribe());q=null};c.unsubscibeToNotification=function(){f&&f.connected&&n&&n.unsubscribe();n=null};c.subscibeToTypingChannel=function(a,b){a=b?a:z;f&&f.connected?q=f.subscribe("/topic/typing-"+Z+"-"+a,c.onTypingStatus):c.reconnect()};c.subscribeToOpenGroup=function(a){if(f&&f.connected){var b=f.subscribe("/topic/group-"+Z+"-"+a.contactId,c.onOpenGroupMessage);H.push(b.id);
tb[a.contactId]=b.id}else c.reconnect()};c.sendTypingStatus=function(a,b){if(f&&f.connected){1===a&&1===wa&&f.send("/topic/typing-"+Z+"-"+x,{"content-type":"text/plain"},Z+","+z+","+a);if(b){if(b===x&&a===wa&&1===a)return;x=b;f.send("/topic/typing-"+Z+"-"+b,{"content-type":"text/plain"},Z+","+z+","+a);setTimeout(function(){wa=0},6E4)}else 0===a&&f.send("/topic/typing-"+Z+"-"+x,{"content-type":"text/plain"},Z+","+z+","+a);wa=a}};c.onTypingStatus=function(a){if(null!=q&&q.id===a.headers.subscription){var b=
a.body,c=b.split(",")[1];b=Number(b.split(",")[2]);var f=a.headers.destination.substring(a.headers.destination.lastIndexOf("-")+1,a.headers.destination.length),g=D.data("mck-id");a=D.data("isgroup");var k=mckGroupUtils.getGroup(g);if(!oa[c]&&!Ha[c])if(1===b){if(!(z===c&&a||g!==c&&g!==f)){if(a=D.data("isgroup")){if(c!==z){if(t.authenticateGroupUser(k)||6===k.type&&!ha.disableChatForNonGroupMember)E.addClass("mck-tab-title-w-typing"),F.removeClass("vis").addClass("n-vis"),c=e.getTabDisplayName(c,!1),
c=c.split(" ")[0],O.html(c+" "+MCK_LABELS["is.typing"]);7===k.type&&(E.addClass("mck-tab-title-w-typing"),O.html(MCK_LABELS["is.typing"]),F.html(""))}}else E.addClass("mck-tab-title-w-typing"),F.removeClass("vis").addClass("n-vis"),O.html(MCK_LABELS.typing);K.removeClass("n-vis").addClass("vis");setTimeout(function(){E.removeClass("mck-tab-title-w-typing");K.removeClass("vis").addClass("n-vis");E.hasClass("undefined"===typeof k||7!=k.type)&&F.removeClass("n-vis").addClass("vis");O.html(MCK_LABELS.typing)},
6E4)}}else E.removeClass("mck-tab-title-w-typing"),K.removeClass("vis").addClass("n-vis"),!E.hasClass("mck-tab-title-w-status")||"undefined"!==typeof k&&7==k.type||F.removeClass("n-vis").addClass("vis"),O.html(MCK_LABELS.typing)}};c.reconnect=function(){c.unsubscibeToTypingChannel();c.unsubscibeToNotification();c.disconnect();c.init()};c.onError=function(a){g.console.log("Error in channel notification. "+a);l.onConnectFailed()};c.sendStatus=function(a){f&&f.connected&&f.send("/topic/status-v2",{"content-type":"text/plain"},
y+","+ea+","+a)};c.onConnect=function(){f.connected?(n&&c.unsubscibeToNotification(),n=f.subscribe("/topic/"+y,c.onMessage),c.sendStatus(1),c.checkConnected(!0)):setTimeout(function(){n=f.subscribe("/topic/"+y,c.onMessage);c.sendStatus(1);c.checkConnected(!0)},5E3);l.onConnect()};c.onOpenGroupMessage=function(b){if(-1!==H.indexOf(b.headers.subscription)){var c=a.parseJSON(b.body),f=c.type;b=c.message;if("APPLOZIC_03"===f)B.updateLatestMessage(b),0!==b.type&&4!==b.type&&(a("."+b.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),
e.addTooltip(b.key)),l.onMessageSentUpdate({messageKey:b.key});else if("APPLOZIC_01"===f||"APPLOZIC_02"===f||"MESSAGE_RECEIVED"===f){B.updateLatestMessage(b);var k=b.groupId?mckGroupUtils.getGroup(b.groupId):e.getContact(b.to);a("#mck-sidebox-content");D.data("mck-id");if("APPLOZIC_01"===f||"MESSAGE_RECEIVED"===f){var g=e.getMessageFeed(b);l.onMessageReceived({message:g})}else"APPLOZIC_02"===f&&(g=e.getMessageFeed(b),l.onMessageSent({message:g}));b.conversationId&&(g=N[b.conversationId],!Ca&&!Ma||
"object"===typeof g&&"object"===typeof J[g.topicId]||v.getTopicId({conversationId:b.conversationId,messageType:f,message:b,notifyUser:c.notifyUser,async:!1,populate:!1}));"undefined"===typeof k?(c={message:b,messageType:f,notifyUser:c.notifyUser},b.groupId?t.getGroupFeedFromMessage(c):(f=[],f.push(b.to),da.getUsersDetail(f,c))):e.populateMessage(f,b,c.notifyUser)}}};c.onMessage=function(b){if(null!=n&&n.id===b.headers.subscription){b=a.parseJSON(b.body);var c=b.type;if("APPLOZIC_04"===c||"MESSAGE_DELIVERED"===
c)a("."+b.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),e.addTooltip(b.message.split(",")[0]),l.onMessageDelivered({messageKey:b.message.split(",")[0]});else if("APPLOZIC_08"===c||"MT_MESSAGE_DELIVERED_READ"===c)a("."+b.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),e.addTooltip(b.message.split(",")[0]),
l.onMessageRead({messageKey:b.message.split(",")[0]});else if("APPLOZIC_05"===c){var f=b.message.split(",")[0];var k=b.message.split(",")[1];var m="1"===b.message.split(",")[2]?!0:!1;e.removedDeletedMessage(f,k,m);b={messageKey:b.message.split(",")[0]};m?b.groupId=k:b.userKey=k;console.log(b);l.onMessageDeleted(b)}else if("APPLOZIC_27"===c)f=b.message.split(",")[0],b=b.message.split(",")[1],"undefined"!==typeof f&&(e.removeConversationThread(f,!1),e.updateUnreadCount("user_"+f,0,!0),m={userId:f},
b&&(m.topicId=b),l.onConversationDeleted(m));else if("APPLOZIC_11"===c){f=b.message;m=e.fetchContact(f);k=D.data("mck-id");if(!oa[f]&&!Ha[f]){if(k!==m.contactId||D.data("isgroup")){var y=mckContactUtils.formatContactId(f);a("#li-user-"+y+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else a("#mck-tab-status").html(MCK_LABELS.online),fb&&e.hideOfflineMessage();a(".mck-user-ol-status."+y).removeClass("n-vis").addClass("vis");a(".mck-user-ol-status."+y).next().html("("+MCK_LABELS.online+")");
g.MCK_OL_MAP[f]=!0;ca.updateUserStatus({userId:b.message,status:1})}l.onUserConnect({userId:b.message})}else if("APPLOZIC_12"===c)f=b.message.split(",")[0],b=b.message.split(",")[1],m=e.fetchContact(f),g.MCK_OL_MAP[f]=!1,b&&(T[f]=b),oa[f]||Ha[f]||(k=D.data("mck-id"),k!==m.contactId||D.data("isgroup")||(a("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(b)),fb&&cb.manageOfflineMessageTime(k)),a(".mck-user-ol-status."+m.htmlId).removeClass("vis").addClass("n-vis"),a(".mck-user-ol-status."+m.htmlId).next().html("(Offline)"),
a("#li-user-"+y+" .mck-ol-status").removeClass("vis").addClass("n-vis"),ca.updateUserStatus({userId:f,status:0,lastSeenAtTime:b})),l.onUserDisconnect({userId:f,lastSeenAtTime:b});else if("APPLOZIC_29"===c){f=b.message.split(",")[0];b=b.message.split(",")[1];m=e.fetchContact(f);e.updateUnreadCount("user_"+m.contactId,0,!0);k=D.data("mck-id");if("undefined"===typeof k||""===k)a("#li-user-"+m.htmlId+" .mck-unread-count-text").html(e.getUnreadCount("user_"+m.contactId)),a("#li-user-"+m.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");
m={userId:f};b&&(m.topicId=b);l.onConversationReadFromOtherSource(m)}else if("APPLOZIC_28"===c)f=b.message.split(",")[0],b=b.message.split(",")[1],k=D.data("mck-id"),k===f&&(a(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),a(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),m=e.getContact(f),"undefined"===typeof m&&(m=[],m.push(f),da.getUsersDetail(m,{}))),m={userId:f},
b&&(m.topicId=b),l.onConversationRead(m);else if("APPLOZIC_16"===c)c=b.message.split(":")[0],f=b.message.split(":")[1],m=e.fetchContact(f),k=D.data("mck-id"),k===m.contactId?c===$b[0]?(oa[m.contactId]=!0,ca.toggleBlockUser(k,!0)):(Ha[m.contactId]=!0,E.removeClass("mck-tab-title-w-status"),F.removeClass("vis").addClass("n-vis"),K.removeClass("vis").addClass("n-vis")):a("#li-user-"+m.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),l.onUserBlocked({status:c,userId:f});else if("APPLOZIC_17"===
c){c=b.message.split(":")[0];f=b.message.split(":")[1];m=e.fetchContact(f);k=D.data("mck-id");if(k===m.contactId)if(c===$b[2])oa[m.contactId]=!1,ca.toggleBlockUser(k,!1);else{if(g.MCK_OL_MAP[k]||T[k])Ha[m.contactId]=!1,oa[k]||(g.MCK_OL_MAP[k]?F.html(MCK_LABELS.online):T[k]&&F.html(mckDateUtils.getLastSeenAtStatus(T[k])),E.addClass("mck-tab-title-w-status"),F.removeClass("n-vis").addClass("vis"))}else g.MCK_OL_MAP[k]&&a("#li-user-"+m.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis");l.onUserUnblocked({status:c,
userId:f})}else if("APPLOZIC_18"===c)eb=!1,l.onUserActivated();else if("APPLOZIC_19"===c)eb=!0,l.onUserDeactivated();else if(f=b.message,"APPLOZIC_03"===c)B.updateLatestMessage(f),0!==f.type&&4!==f.type&&(a("."+f.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(f.key)),l.onMessageSentUpdate({messageKey:f.key});else if("APPLOZIC_01"===c||"APPLOZIC_02"===c||"MESSAGE_RECEIVED"===c)B.updateLatestMessage(f),m=f.groupId?mckGroupUtils.getGroup(f.groupId):e.getContact(f.to),
a("#mck-sidebox-content"),k=D.data("mck-id"),"APPLOZIC_01"===c||"MESSAGE_RECEIVED"===c?(k=e.getMessageFeed(f),l.onMessageReceived({message:k})):"APPLOZIC_02"===c&&(k=e.getMessageFeed(f),l.onMessageSent({message:k})),f.conversationId&&(k=N[f.conversationId],!Ca&&!Ma||"object"===typeof k&&"object"===typeof J[k.topicId]||v.getTopicId({conversationId:f.conversationId,messageType:c,message:f,notifyUser:b.notifyUser,async:!1,populate:!1})),"undefined"===typeof m?(b={message:f,messageType:c,notifyUser:b.notifyUser},
f.groupId?t.getGroupFeedFromMessage(b):(m=[],m.push(f.to),da.getUsersDetail(m,b))):(102==f.contentType&&Pa&&(b.notifyUser=!1,4==f.type&&"CALL_DIALED"==f.metadata.MSG_TYPE?(m=e.fetchContact(f.to),k=e.getTabDisplayName(m.contactId,!1),m=e.getContactImageLink(m,k),a("#mck-video-call-indicator").data("call-id",f.metadata.CALL_ID),a("#mck-video-call-indicator").data("isAudioCall",f.metadata.CALL_AUDIO_ONLY),a("#mck-video-call-indicator-txt").html(k+" calling..."),a("#mck-video-call-icon").html(m),a("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),
ma.play(),setTimeout(function(){a("#mck-video-call-indicator").data("callReceived")||(console.log("call is not answered"),ma.stop(),a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==f.type&&"CALL_REJECTED"==f.metadata.MSG_TYPE&&a("#mck-btn-video-call").data("isCallHost")&&(v.sendVideoCallMessage(f.metadata.CALL_ID,"CALL_REJECTED",103,!1),ia.ringToneForHost.stop(),ia.outgoingCallServices.twilioService.leaveRoomIfJoined(),ia.hideVideoBox(),ia.outgoingCallServices&&(ia.outgoingCallServices.rejectedByReceiver=
!0))),103==f.contentType?4==f.type&&"CALL_MISSED"==f.metadata.MSG_TYPE&&(a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),ma&&ma.stop()):e.populateMessage(c,f,b.notifyUser))}}}(l);l.getOptions=function(){return c};l.init=function(){Fa.loop=!1;va=new RingToneService;fc=va.loadRingTone(ic,Fa);v.init();la.init();cb.initializeApp(c,!1);hb.init();Hb.init();e.initEmojis();Pa&&(Fa.loop=!0,va=new RingToneService,ma=va.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",
Fa),ia.init())};l.reInit=function(b){"object"===a.type(b)&&(b=a.extend(!0,{},M,b),a.fn.applozic("reset",b),b.userId&&b.appId&&""!==a.trim(b.userId)&&""!==a.trim(b.appId)?(cb.initializeApp(b,!0),c=b):g.console("Oops! looks like incorrect application id or user Id."))};l.loadTabView=function(b){"undefined"===typeof b.isGroup&&(b.isGroup=!1);e.loadTab(b);a("#mck-search").val("")};l.loadTab=function(b){e.loadTab({tabId:b,isGroup:!1});a("#mck-search").val("")};l.loadChat=function(b){if(!("undefined"!==
typeof b.userId&&""!==b.userId||"undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId))return"UserId or groupId or clientGroupId required";var c={};b.userId&&(c.tabId=userId,c.isGroup=!1);b.displayName&&(c.userName=b.displayName);b.convId&&(c.conversationId=b.convId);if(b.groupId||b.clientGroupId)if(c.isGroup=!0,b.clientGroupId){c.clientGroupId=b.clientGroupId;var g=mckGroupUtils.getGroupByClientGroupId(b.clientGroupId);if("object"===typeof g)c.tabId=
g.contactId;else{mckGroupService.getGroupFeed({clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});a("#mck-search").val("");return}}else if(g=mckGroupUtils.getGroup(b.groupId),"object"===typeof g)c.tabId=b.groupId;else{mckGroupService.getGroupFeed({groupId:b.groupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});a("#mck-search").val("");return}e.loadTab(c);a("#mck-search").val("")};l.uploadFile=function(b){la.uploadFile(b)};l.audioAttach=function(b){la.audioRecoder(b)};
l.loadGroupTab=function(b){if("undefined"===typeof b||""===b)return"GroupId required";"object"===typeof mckGroupUtils.getGroup(b)?(e.loadTab({tabId:b,isGroup:!0}),a("#mck-search").val("")):mckGroupService.getGroupFeed({groupId:b,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};l.loadGroupTabByClientGroupId=function(b){if("undefined"===typeof b.clientGroupId||""===b.clientGroupId)return"Client Group Id Required";var c=mckGroupUtils.getGroupByClientGroupId(b.clientGroupId);"object"===typeof c?(e.loadTab({tabId:c.contactId,
isGroup:!0}),a("#mck-search").val("")):mckGroupService.getGroupFeed({clientGroupId:b.clientGroupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};l.loadConvTab=function(b){"object"===typeof b&&b.userId&&b.convId&&e.loadTab({tabId:b.userId,conversationId:b.convId,isGroup:!1})};l.loadTabWithTopic=function(b){if("object"===typeof b&&b.userId&&b.topicId){var a={tabId:b.userId,topicId:b.topicId};b.userName&&(a.userName=b.userName);a.topicStatus=b.topicStatus?-1===F.indexOf(b.topicStatus)?F[0]:b.topicStatus.toString():
F[0];if("function"===typeof Ja){var c=Ja(b.topicId);"object"===typeof c&&"undefined"!==c.title&&(J[b.topicId]=c)}b.message?(a.messagePxy={type:5,contentType:0,message:message},a.isMessage=!0):a.isMessage=!1;b.supportId?(a.isGroup=!0,a.supportId=supportId):a.isGroup=!1;v.getConversationId(a)}else{if(!b.userId)return"UserId required";if(!b.topicId)return"TopicId required"}};l.loadContacts=function(b){e.loadContacts(b)};l.setOffline=function(){"undefined"!==typeof U&&U.sendStatus(0)};l.reset=function(b){g.sessionStorage.clear();
H=y="";E=[];MCK_GROUP_MAP=[];qb=!0;za=[];ea="";sb=b.mode;oa=[];Ha=[];Ga=!1;Ia=90;Z=b.appId;T=[];N=[];J=[];MCK_CLIENT_GROUP_MAP=[];rb=!0;MCK_LABELS=b.labels;X=0;MCK_BASE_URL=b.baseUrl;qa={};gb=[];ab=b.launcher;tb=[];Lb=b.userName;lb=b.visitor;pa=[];Sa=[];Na={};G=b.fileBaseUrl;bb=b.locShare;Pa=c.video;K=b.onInit;wb=b.onTopicDetails;ya=[];Da=[];xb=b.onClose;xa=b.accessToken;yb=b.displayText;Wa=b.readConversation;O=b.maxGroupSize;Y=[];zb=b.onTabClicked;Mb=b.contactNumber;Ab=b.appModuleName;Ja=b.getTopicDetail;
Aa=b.maxAttachmentSize;Bb=b.validateMessage;Qa=b.contactDisplayName;Ta=[];Ba=b.finalPriceResponse;Ra=b.contactDisplayImage;Cb=b.priceWidget;ha=c.openGroupSettings;aa=b.offlineMessageDetail;Db=b.getConversationDetail;mb=b.authenticationTypeId;z=lb?"guest":a.trim(b.userId);Ob=bb?b.googleApiKey:"NO_ACCESS";nb="boolean"===typeof b.olStatus?b.olStatus:!1;Ma="boolean"===typeof b.topicBox?b.topicBox:!1;fb="boolean"===typeof b.showOfflineMessage?b.showOfflineMessage:!1;Ca="boolean"===typeof b.topicHeader?
b.topicHeader:!1;Wb="boolean"===typeof b.notification?b.notification:!0;Xb="boolean"===typeof b.swNotification?b.swNotification:!1;Ub=b.supportId?'data-mck-id\x3d"'+b.supportId+'"':"";Qb="boolean"===typeof b.hideGroupSubtitle?b.hideGroupSubtitle:!1;Rb="undefined"===typeof b.defaultMessageMetaData?{}:b.defaultMessageMetaData;Eb="boolean"===typeof b.groupUserCount?b.groupUserCount:!1;Vb="boolean"===typeof b.desktopNotification?b.desktopNotification:!1;Fb="boolean"===typeof b.loadOwnContacts?b.loadOwnContacts:
!1;Pb="boolean"===typeof b.messageBubbleAvator?b.messageBubbleAvator:!1;Tb="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1;ob="boolean"===typeof b.launchOnNewMessage?b.launchOnNewMessage:!1;Yb="boolean"===typeof b.autoTypeSearchEnabled?b.autoTypeSearchEnabled:!0;Sb="boolean"===typeof b.checkUserBusyWithStatus?b.checkUserBusyWithStatus:!1;Gb="boolean"===typeof b.launchOnUnreadMessage?b.launchOnUnreadMessage:!1;ec=c.isAnonymousChat};l.logout=function(){"undefined"!==typeof U&&(U.disconnect(),
B.clearMckMessageArray(),a.fn.applozic("reset",c),a("#mck-sidebox").hide(),a("#mck-sidebox-launcher").hide());qb=!1};l.setOnline=function(){"undefined"!==typeof U&&U.sendStatus(1)};l.getUserStatus=function(b){"function"===typeof b.callback&&("undefined"!==typeof b.userIds?da.getUsersDetail(b.userIds,b):da.getUserStatus(b))};l.getGroupList=function(b){return"function"===typeof b.callback?(b.apzCallback=t.loadGroups,mckGroupService.loadGroups(b),"success"):"Callback Function Required"};l.leaveGroup=
function(b){if("object"!==typeof b)return"Unsupported Format. Please check format";if("function"===typeof b.callback){if("undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId)return b.apzCallback=t.onGroupLeft,mckGroupService.leaveGroup(b),"success";b.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};l.addGroupMember=function(b){if("object"!==typeof b)return"Unsupported Format. Please check format";
if("function"===typeof b.callback)if("undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId)if("undefined"===typeof b.userId||""===b.userId)b.callback({status:"error",errorMessage:"UserId required"});else if("undefined"!==typeof b.role&&-1===ub.indexOf(b.role))b.callback({status:"error",errorMessage:"Incorrect member role"});else return da.loadUserProfile(b.userId),b.apzCallback=t.onAddedGroupMember,mckGroupService.addGroupMember(b),"success";else b.callback({status:"error",
errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.removeGroupMember=function(b){if("object"!==typeof b)return"Unsupported Format. Please check format";if("function"===typeof b.callback)if("undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId)if("undefined"===typeof b.userId||""===b.userId)b.callback({status:"error",errorMessage:"UserId required"});else return b.apzCallback=t.onRemovedGroupMember,mckGroupService.removeGroupMember(b),
"success";else b.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.updateGroupInfo=function(b){if("object"!==typeof b)return"Unsupported format. Please check format";if("function"===typeof b.callback)if("undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId){if("undefined"!==typeof b.name&&""!==b.name||"undefined"!==typeof b.imageUrl&&""!==b.imageUrl||b.users&&0!==b.users.length){if(b.users&&
0<b.users.length){var c=[];a.each(b.users,function(b,a){a.userId&&"undefined"!==typeof a.role&&-1!==ub.indexOf(a.role)&&c.push(a)});if(0===c.length){b.callback({status:"error",errorMessage:"Incorrect users detail"});return}}c=[];a(".mck-group-change-role-box.vis").each(function(b,e){b=a(this);e=parseInt(b.find("select").val());var f=b.parents(".mck-li-group-member").data("role");e!==f&&(b={userId:b.parents(".mck-li-group-member").data("mck-id"),role:e},c.push(b))});b.apzCallback=t.onUpdateGroupInfo;
mckGroupService.updateGroupInfo(b);return"success"}b.callback({status:"error",errorMessage:"Group properties required"})}else b.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.getMessages=function(b){"function"===typeof b.callback&&v.getMessages(b)};l.getMessageList=function(b){return"undefined"!==typeof b&&"function"===typeof b.callback?(v.getMessageList(b),"success"):"Callback function required"};l.getMessageListByTopicId=function(b){if("object"!==
typeof b)return"Unsupported format. Please check format";if("function"===typeof b.callback)if("undefined"!==typeof b.id&&""!==b.id||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId)if(b.id&&"boolean"!==typeof b.isGroup)b.callback({status:"error",errorMessage:"IsGroup parameter required"});else{if(b.topicId){b.id&&(b.tabId=b.id);b.topicStatus=F[0];var a=pa[b.topicId];a&&"object"===typeof N[a]?(b.conversationId=a,v.getMessageList(b)):(b.isExtMessageList=!0,b.pageSize=1,v.fetchConversationByTopicId(b));
return"success"}b.callback("TopicId required")}else b.callback({status:"error",errorMessage:"Id or clientGroupId required"});else return"Callback function required."};l.sendMessage=function(b){if("object"===typeof b){b=a.extend(!0,{},na,b);var c=b.message;if(!b.to)return"To field required";if("undefined"===typeof c||""===c)return"Message field required";if(12<b.type)return"Invalid message type";c=a.trim(c);b={to:a.trim(b.to),type:b.messageType,contentType:b.type,message:c};v.sendMessage(b);return"success"}return"Unsupported format. Please check format"};
l.sendGroupMessage=function(b){if("object"===typeof b){b=a.extend(!0,{},na,b);var c=b.message;if(!b.groupId&&!b.clientGroupId)return"groupId or clientGroupId required";if("undefined"===typeof c||""===c)return"message field required";if(12<b.type)return"invalid message type";c=a.trim(c);c={type:b.messageType,contentType:b.type,message:c};if(b.groupId)c.groupId=a.trim(b.groupId);else if(b.clientGroupId){if("undefined"===typeof mckGroupUtils.getGroupByClientGroupId(b.clientGroupId))return"group not found";
c.clientGroupId=a.trim(b.clientGroupId)}v.sendMessage(c);return"success"}return"Unsupported format. Please check format"};l.addWelcomeMessage=function(b){if("object"===typeof b){if("undefined"===typeof b.sender||""===b.sender)return"Sender Field Required";if("undefined"===typeof b.messageContent||""===b.messageContent)return"Message Content Required";v.sendWelcomeMessage(b)}else return"Unsupported format. Please check format"};l.createGroup=function(b){if("object"===typeof b){if("function"===typeof b.callback){var a=
b.users;if("undefined"===typeof a||1>a.length){b.callback({status:"error",errorMessage:"Users list required"});return}if(a.length>O){b.callback({status:"error",errorMessage:"Users limit exceeds "+O+". Max number of users allowed is "+O+"."});return}if(!b.groupName){b.callback({status:"error",errorMessage:"Group name required"});return}if("undefined"===typeof b.type||""===b.type){b.callback({status:"error",errorMessage:"Group type required"});return}if(-1===vb.indexOf(b.type)){b.callback({status:"error",
errorMessage:"Invalid group type"});return}v.getGroup(b);return"success"}return"Callback function required"}return"Unsupported Format. Please check format"};l.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";if(b.length>O)return"Users limit exceeds "+O+". Max number of users allowed is "+O+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===vb.indexOf(a.type))return"Invalid group type";
v.getGroup(a);return"success"}return"Unsupported format. Please check format"};l.getTotalUnreadCount=function(){return X};l.subscribeToEvents=function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(l.events.onConnectFailed=a.onConnectFailed),"function"===typeof a.onConnect&&(l.events.onConnect=a.onConnect),"function"===typeof a.onMessageDelivered&&(l.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(l.events.onMessageRead=a.onMessageRead),"function"===
typeof a.onMessageDeleted&&(l.events.onMessageDeleted=a.onMessageDeleted),"function"===typeof a.onConversationDeleted&&(l.events.onConversationDeleted=a.onConversationDeleted),"function"===typeof a.onUserConnect&&(l.events.onUserConnect=a.onUserConnect),"function"===typeof a.onUserDisconnect&&(l.events.onUserDisconnect=a.onUserDisconnect),"function"===typeof a.onConversationReadFromOtherSource&&(l.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&
(l.events.onConversationRead=a.onConversationRead),"function"===typeof a.onMessageReceived&&(l.events.onMessageReceived=a.onMessageReceived),"function"===typeof a.onMessageSentUpdate&&(l.events.onMessageSentUpdate=a.onMessageSentUpdate),"function"===typeof a.onMessageSent&&(l.events.onMessageSent=a.onMessageSent),"function"===typeof a.onUserBlocked&&(l.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(l.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&
(l.events.onUserActivated=a.onUserActivated),"function"===typeof a.onUserDeactivated&&(l.events.onUserDeactivated=a.onUserDeactivated))};l.getConversation=function(a){v.getTopicId({conversationId:a.conversationId})}}g.applozic||(g.applozic=g.applozic?g.applozic:{},a.extend(!0,g.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var M={baseUrl:"https://chat.kommunicate.io",fileBaseUrl:"https://applozic.appspot.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",
launcher:"applozic-launcher",userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,groupUserCount:!1,desktopNotification:!1,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,isAnonymousChat:!0,labels:{"conversations.title":"Conversations","start.new":"Start New","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!",
"empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted",
"change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",
typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File",
"last.seen":"Last seen","last.seen.on":"Last seen on",ago:"ago","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",
GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},na={messageType:5,type:0};a.fn.applozic=function(c,g){var l=a("#mck-sidebox");"object"===a.type(c)&&(c=a.extend(!0,{},M,c));if("undefined"!==typeof l.data("applozic_instance"))if(l=l.data("applozic_instance"),"string"===a.type(c))switch(c){case "reInitialize":return l.reInit(g);case "loadConvTab":l.loadConvTab(g);
break;case "loadTab":l.loadTab(g);break;case "uploadFile":l.uploadFile(g);break;case "loadTabView":l.loadTabView(g);break;case "loadChat":l.loadChat(g);break;case "loadContextualTab":return l.loadTabWithTopic(g);case "audioAttach":l.audioAttach(g);break;case "addWelcomeMessage":l.addWelcomeMessage(g);break;case "loadContacts":l.loadContacts(g);break;case "sendMessage":return l.sendMessage(g);case "sendGroupMessage":return l.sendGroupMessage(g);case "createGroup":return l.createGroup(g);case "loadBroadcastTab":return g.groupName=
g.groupName?g.groupName:"Broadcast",g.type=5,l.initGroupTab(g);case "initBroadcastTab":return g.groupName=g.groupName?g.groupName:"Broadcast",g.type=5,l.initGroupTab(g);case "initGroupTab":return l.initGroupTab(g);case "loadGroupTab":return l.loadGroupTab(g);case "loadGroupTabByClientGroupId":return l.loadGroupTabByClientGroupId(g);case "setOffline":return l.setOffline(),"success";case "setOnline":return l.setOffline(),"success";case "logout":return l.logout(),"success";case "reset":l.reset(g);break;
case "getUserDetail":return l.getUserStatus(g),"success";case "getGroupList":return l.getGroupList(g),"success";case "leaveGroup":return l.leaveGroup(g);case "addGroupMember":return l.addGroupMember(g);case "removeGroupMember":return l.removeGroupMember(g);case "updateGroupInfo":return l.updateGroupInfo(g);case "getMessages":l.getMessages(g);break;case "messageList":return l.getMessageList(g);case "getMessageListByTopicId":return l.getMessageListByTopicId(g);case "getTotalUnreadCount":return l.getTotalUnreadCount();
case "subscribeToEvents":return l.subscribeToEvents(g);case "getConversation":return l.getConversation(g)}else"object"===a.type(c)&&l.reInit(c);else"object"===a.type(c)&&(c.userId&&c.appId&&""!==a.trim(c.userId)&&""!==a.trim(c.appId)?"undefined"!==typeof l.data("applozic_instance")?(l=l.data("applozic_instance"),l.reInit(c)):(jQuery="undefined"!==typeof c.ojq?$=c.ojq:$=a,"function"===typeof c.obsm?($.fn.modal=c.obsm,jQuery.fn.modal=c.obsm):"function"===typeof a.fn.modal?(g=a.fn.modal.noConflict(),
$.fn.modal=g,jQuery.fn.modal=g):"function"===typeof $.fn.modal&&(g=$.fn.modal.noConflict(),$.fn.modal=g,jQuery.fn.modal=g),"function"===typeof c.omckm?a.fn.mckModal=c.omckm:"function"===typeof a.fn.mckModal?a.fn.mckModal=a.fn.mckModal.noConflict():"function"===typeof $.fn.mckModal&&(a.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(a.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof a.fn.linkify&&($.fn.linkify=a.fn.linkify,jQuery.fn.linkify=a.fn.linkify),
"function"===typeof $.fn.emojiarea?a.fn.emojiarea=$.fn.emojiarea:"function"===typeof a.fn.emojiarea&&($.fn.emojiarea=a.fn.emojiarea,jQuery.fn.emojiarea=a.fn.emojiarea),"function"===typeof $.fn.locationpicker?a.fn.locationpicker=$.fn.locationpicker:"function"===typeof a.fn.locationpicker&&($.fn.locationpicker=a.fn.locationpicker,jQuery.fn.locationpicker=a.fn.locationpicker),c=new H(c),l.data("applozic_instance",c),c.init()):alert("Oops! looks like incorrect application id or user Id."))};a.fn.applozic.defaults=
M})($applozic,window,document);