var $applozic = jQuery.noConflict(true);
if (typeof $original !== 'undefined') {
    $ = $original;
    jQuery = $original;
    if (typeof $.fn.template === 'function') {
        $applozic.fn.template = $.fn.template;
        jQuery.fn.template = $.fn.template;
    } else if (typeof $applozic.fn.template === 'function') {
        $.fn.template = $applozic.fn.template;
        jQuery.fn.template = $applozic.fn.template;
    }
}

function MckCallingService(identity,token,callId,toUserDisplayName,isCallHost,callStartTime,mckMessageService,toUserImage,isAudioCall,ringTone){var _this=this;var $mckVidImageIcon=$applozic("#mck-vid-icon");var $mckSideBox=$applozic("#mck-sidebox");_this.callStartTime=callStartTime;_this.mckMessageService=mckMessageService;_this.identity=identity;_this.token=token;_this.callId=callId;_this.isCallHost=isCallHost;_this.toUserImage=toUserImage;_this.toUserDisplayName=toUserDisplayName;_this.isAudioCall=
isAudioCall;_this.disconectedByHost;_this.rejectedByReceiver;_this.twilioService;console.log("is AudioCall:"+isAudioCall);_this.ringTone=ringTone;var $mck_msg_to=$applozic("#mck-msg-to");var $mck_vid_box=$applozic(".applozic-vid-container");var $mck_side_box=$applozic("#mck-sidebox");var $mck_video_call_indicator=$applozic("#mck-video-call-indicator");var $mck_unmute_icon=$applozic("#mck-unmute-icon");var $mck_mute_icon=$applozic("#mck-mute-icon");var $mck_mute_btn=$applozic("#mck-microfone-mute-btn");
$applozic("#mck-microfone-mute-btn").off("click").on("click",function(){var toUser=$mck_msg_to.val();var room=_this.twilioService.activeRoom;if(room){var localMedia=room.localParticipant.media;if(localMedia.isMuted){$mck_unmute_icon.addClass("vis").removeClass("n-vis");$mck_mute_icon.addClass("n-vis").removeClass("vis");$mck_mute_btn.addClass("mck-unmuted").removeClass("mck-muted");localMedia.unmute()}else{$mck_mute_icon.addClass("vis").removeClass("n-vis");$mck_unmute_icon.addClass("n-vis").removeClass("vis");
$mck_mute_btn.addClass("mck-muted").removeClass("mck-unmuted");localMedia.mute()}}});$applozic("#mck-vid-disconnect").off("click").on("click",function(){var toUser=$mck_msg_to.val();if(isCallHost){_this.disconectedByHost=true;if(_this.twilioService.callReceivedAt){var callDurationInMilis=(new Date).getTime()-_this.twilioService.callReceivedAt.getTime();alMessageService.sendVideoCallEndMessage(callId,"CALL_END",103,false,callDurationInMilis,toUser,function(messagePxy){mckMessageService.sendMessage(messagePxy)})}else{_this.ringTone.stop();
alMessageService.sendVideoCallMessage(callId,"CALL_MISSED",103,false,toUser,function(messagePxy){mckMessageService.sendMessage(messagePxy)})}}_this.twilioService.leaveRoomIfJoined();_this.removeTracks(["#mck-vid-media \x3e video","#mck-vid-media \x3e audio","#local-media \x3e video","#local-media \x3e audio"]);$mck_vid_box.addClass("n-vis").removeClass("vis");$mck_video_call_indicator.addClass("n-vis").removeClass("vis")});_this.startVideoCall=function(){if(!navigator.webkitGetUserMedia&&!navigator.mozGetUserMedia)alert("WebRTC is not available in your browser. can not start video call");
if(!_this.token){alert("missing token.. can not make video call");$mck_vid_box.removeClass("vis").addClass("n-vis")}_this.twilioService=new TwilioService(_this.identity,_this.token,_this.callId,_this.ringTone,_this.isAudioCall,_this.mckMessageService,_this.isCallHost);var videoClient=_this.twilioService.InitializeVideoClient();if(isCallHost){$mckVidImageIcon.html(toUserImage+"\x3cspan\x3e Calling "+toUserDisplayName+"\x3c/span\x3e");$mckVidImageIcon.removeClass("n-vis").addClass("vis");setTimeout(function(){if(!_this.twilioService.isCallReceived&&
!_this.disconectedByHost&&!_this.rejectedByReceiver){console.log("call is not answered....");_this.ringTone.stop();alMessageService.sendVideoCallMessage(callId,"CALL_MISSED",103,isAudioCall,toUser,function(messagePxy){mckMessageService.sendMessage(messagePxy)});alert(toUserDisplayName+" not Available....");_this.twilioService.leaveRoomIfJoined();_this.removeTracks(["#mck-vid-media \x3e video","#mck-vid-media \x3e audio","#local-media \x3e video","#local-media \x3e audio"]);$mck_vid_box.addClass("n-vis").removeClass("vis")}},
7E4)}window.addEventListener("beforeunload",_this.twilioService.leaveRoomIfJoined);_this.twilioService.attachUserMedia(isCallHost,isAudioCall);_this.twilioService.joinCall(isAudioCall);$mck_vid_box.removeClass("n-vis").addClass("vis");$mck_unmute_icon.addClass("vis").removeClass("n-vis");$mck_mute_icon.addClass("n-vis").removeClass("vis");$mck_mute_btn.addClass("mck-unmuted").removeClass("mck-muted")};_this.removeTracks=function(selectors){$applozic.each(selectors,function(index,value){$applozic(value).remove()})}}
function TwilioService(identity,token,callId,ringTone,isAudioCall,mckMessageService,isCallHost){var _this=this;_this.identity=identity;_this.token=token;_this.callId=callId;_this.videoClient;_this.activeRoom;_this.previewMedia;_this.ringTone=ringTone;_this.isCallReceived;_this.callReceivedAt;_this.isAudioCall=isAudioCall;_this.mckMessageService=mckMessageService;_this.isCallHost=isCallHost;var $mck_msg_to=$applozic("#mck-msg-to");var $mckVidImageIcon=$applozic("#mck-vid-icon");var localMedia="#local-media";
var mckVidMedia="#mck-vid-media";var $mcklocalVideo=$applozic("#local-media \x3e video");var $mckRemoteVideo=$applozic("#mck-vid-media \x3e video");var $localMedia=$applozic("#local-media");var $mck_vid_box=$applozic(".applozic-vid-container");var $mck_side_box=$applozic("#mck-sidebox");var $mck_video_call_indicator=$applozic("#mck-video-call-indicator");_this.InitializeVideoClient=function(){_this.videoClient=new Twilio.Video.Client(_this.token)};_this.joinCall=function(isAudioCall){if(_this.videoClient)_this.videoClient.connect({to:_this.callId}).then(_this.roomJoined,
function(error){console.log("Could not connect to Twilio: "+error.message)})};_this.attachUserMedia=function(isCallHost,isAudioCall){if(!_this.previewMedia){_this.previewMedia=new Twilio.Video.LocalMedia;Twilio.Video.getUserMedia().then(function(mediaStream){_this.previewMedia.addStream(mediaStream);if(isCallHost){_this.previewMedia.attach(mckVidMedia);_this.ringTone.play()}else{_this.previewMedia.attach(localMedia);$localMedia.removeClass("n-vis").addClass("vis")}},function(error){console.error("Unable to access local media",
error);console.log("Unable to access Camera and Microphone")})}};_this.roomJoined=function(room){console.log("room detail : "+room);_this.activeRoom=room;if(!_this.previewMedia)room.localParticipant.media.attach(mckVidMedia);room.participants.forEach(function(participant){console.log("Already in Room: '"+participant.identity+"'");participant.media.attach("#mck-vid-media")});room.on("participantConnected",function(participant){console.log("participent- "+participant.identity+"connected to the room- "+
room);_this.isCallReceived=true;_this.callReceivedAt=new Date;console.log("callReceivedAt : "+_this.callReceivedAt);_this.ringTone.stop();$mckVidImageIcon.addClass("n-vis");$applozic("#mck-vid-media \x3e video").remove();$applozic("#mck-vid-media \x3e audio").remove();room.localParticipant.media.attach(localMedia);$localMedia.removeClass("n-vis").addClass("vis");participant.media.attach(mckVidMedia)});room.on("participantDisconnected",function(participant){console.log("Participant '"+participant.identity+
"' left the room");if(_this.isCallHost){var toUser=$mck_msg_to.val();var callDurationInMilis=(new Date).getTime();_this.callReceivedAt.getTime();alMessageService.sendVideoCallEndMessage(callId,"CALL_END",103,isAudioCall,callDurationInMilis,toUser,function(messagePxy){mckMessageService.sendMessage(messagePxy)})}participant.media.detach();_this.leaveRoomIfJoined();$mck_vid_box.addClass("n-vis").removeClass("vis");$mck_video_call_indicator.addClass("n-vis").removeClass("vis")});room.on("disconnected",
function(){console.log("Left");room.localParticipant.media.detach();room.participants.forEach(function(participant){participant.media.detach()});_this.activeRoom=null})};_this.leaveRoomIfJoined=function leaveRoomIfJoined(){if(_this.activeRoom)_this.activeRoom.disconnect();if(_this.previewMedia)_this.previewMedia.stop()}}
!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.SockJS=t()}}(function(){var t;return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code=
"MODULE_NOT_FOUND",c;}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return i(n?n:e)},l,l.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e){(function(n){var r=t("./transport-list");e.exports=t("./main")(r),"_sockjs_onload"in n&&setTimeout(n._sockjs_onload,1)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./main":14,
"./transport-list":16}],2:[function(t,e){function n(){i.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}var r=t("inherits"),i=t("./event");r(n,i),e.exports=n},{"./event":4,inherits:54}],3:[function(t,e){function n(){i.call(this)}var r=t("inherits"),i=t("./eventtarget");r(n,i),n.prototype.removeAllListeners=function(t){t?delete this._listeners[t]:this._listeners={}},n.prototype.once=function(t,e){function n(){r.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}
var r=this,i=!1;this.on(t,n)},n.prototype.emit=function(t){var e=this._listeners[t];if(e)for(var n=Array.prototype.slice.call(arguments,1),r=0;r<e.length;r++)e[r].apply(this,n)},n.prototype.on=n.prototype.addListener=i.prototype.addEventListener,n.prototype.removeListener=i.prototype.removeEventListener,e.exports.EventEmitter=n},{"./eventtarget":5,inherits:54}],4:[function(t,e){function n(t){this.type=t}n.prototype.initEvent=function(t,e,n){return this.type=t,this.bubbles=e,this.cancelable=n,this.timeStamp=
+new Date,this},n.prototype.stopPropagation=function(){},n.prototype.preventDefault=function(){},n.CAPTURING_PHASE=1,n.AT_TARGET=2,n.BUBBLING_PHASE=3,e.exports=n},{}],5:[function(t,e){function n(){this._listeners={}}n.prototype.addEventListener=function(t,e){t in this._listeners||(this._listeners[t]=[]);var n=this._listeners[t];-1===n.indexOf(e)&&(n=n.concat([e])),this._listeners[t]=n},n.prototype.removeEventListener=function(t,e){var n=this._listeners[t];if(n){var r=n.indexOf(e);return-1!==r?void(n.length>
1?this._listeners[t]=n.slice(0,r).concat(n.slice(r+1)):delete this._listeners[t]):void 0}},n.prototype.dispatchEvent=function(t){var e=t.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+e]&&this["on"+e].apply(this,n),e in this._listeners)for(var r=this._listeners[e],i=0;i<r.length;i++)r[i].apply(this,n)},e.exports=n},{}],6:[function(t,e){function n(t){i.call(this),this.initEvent("message",!1,!1),this.data=t}var r=t("inherits"),i=t("./event");r(n,i),e.exports=n},{"./event":4,inherits:54}],
7:[function(t,e){function n(t){this._transport=t,t.on("message",this._transportMessage.bind(this)),t.on("close",this._transportClose.bind(this))}var r=t("json3"),i=t("./utils/iframe");n.prototype._transportClose=function(t,e){i.postMessage("c",r.stringify([t,e]))},n.prototype._transportMessage=function(t){i.postMessage("t",t)},n.prototype._send=function(t){this._transport.send(t)},n.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},e.exports=n},{"./utils/iframe":47,
json3:55}],8:[function(t,e){var n=t("./utils/url"),r=t("./utils/event"),i=t("json3"),o=t("./facade"),s=t("./info-iframe-receiver"),a=t("./utils/iframe"),u=t("./location");e.exports=function(t,e){var c={};e.forEach(function(t){t.facadeTransport&&(c[t.facadeTransport.transportName]=t.facadeTransport)}),c[s.transportName]=s;var l;t.bootstrap_iframe=function(){var e;a.currentWindowId=u.hash.slice(1);var s=function(r){if(r.source===parent&&("undefined"==typeof l&&(l=r.origin),r.origin===l)){var s;try{s=
i.parse(r.data)}catch(f){return}if(s.windowId===a.currentWindowId)switch(s.type){case "s":var h;try{h=i.parse(s.data)}catch(f){break}var d=h[0],p=h[1],v=h[2],m=h[3];if(d!==t.version)throw new Error('Incompatibile SockJS! Main site uses: "'+d+'", the iframe: "'+t.version+'".');if(!n.isOriginEqual(v,u.href)||!n.isOriginEqual(m,u.href))throw new Error("Can't connect to different domain from within an iframe. ("+u.href+", "+v+", "+m+")");e=new o(new c[p](v,m));break;case "m":e._send(s.data);break;case "c":e&&
e._close(),e=null}}};r.attachEvent("message",s),a.postMessage("s")}}},{"./facade":7,"./info-iframe-receiver":10,"./location":13,"./utils/event":46,"./utils/iframe":47,"./utils/url":52,debug:void 0,json3:55}],9:[function(t,e){function n(t,e){r.call(this);var n=this,i=+new Date;this.xo=new e("GET",t),this.xo.once("finish",function(t,e){var r,a;if(200===t){if(a=+new Date-i,e)try{r=o.parse(e)}catch(u){}s.isObject(r)||(r={})}n.emit("finish",r,a),n.removeAllListeners()})}var r=t("events").EventEmitter,
i=t("inherits"),o=t("json3"),s=t("./utils/object");i(n,r),n.prototype.close=function(){this.removeAllListeners(),this.xo.close()},e.exports=n},{"./utils/object":49,debug:void 0,events:3,inherits:54,json3:55}],10:[function(t,e){function n(t){var e=this;i.call(this),this.ir=new a(t,s),this.ir.once("finish",function(t,n){e.ir=null,e.emit("message",o.stringify([t,n]))})}var r=t("inherits"),i=t("events").EventEmitter,o=t("json3"),s=t("./transport/sender/xhr-local"),a=t("./info-ajax");r(n,i),n.transportName=
"iframe-info-receiver",n.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},e.exports=n},{"./info-ajax":9,"./transport/sender/xhr-local":37,events:3,inherits:54,json3:55}],11:[function(t,e){(function(n){function r(t,e){var r=this;i.call(this);var o=function(){var n=r.ifr=new u(c.transportName,e,t);n.once("message",function(t){if(t){var e;try{e=s.parse(t)}catch(n){return r.emit("finish"),void r.close()}var i=e[0],o=e[1];r.emit("finish",i,o)}r.close()}),n.once("close",
function(){r.emit("finish"),r.close()})};n.document.body?o():a.attachEvent("load",o)}var i=t("events").EventEmitter,o=t("inherits"),s=t("json3"),a=t("./utils/event"),u=t("./transport/iframe"),c=t("./info-iframe-receiver");o(r,i),r.enabled=function(){return u.enabled()},r.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./info-iframe-receiver":10,
"./transport/iframe":22,"./utils/event":46,debug:void 0,events:3,inherits:54,json3:55}],12:[function(t,e){function n(t,e){var n=this;r.call(this),setTimeout(function(){n.doXhr(t,e)},0)}var r=t("events").EventEmitter,i=t("inherits"),o=t("./utils/url"),s=t("./transport/sender/xdr"),a=t("./transport/sender/xhr-cors"),u=t("./transport/sender/xhr-local"),c=t("./transport/sender/xhr-fake"),l=t("./info-iframe"),f=t("./info-ajax");i(n,r),n._getReceiver=function(t,e,n){return n.sameOrigin?new f(e,u):a.enabled?
new f(e,a):s.enabled&&n.sameScheme?new f(e,s):l.enabled()?new l(t,e):new f(e,c)},n.prototype.doXhr=function(t,e){var r=this,i=o.addPath(t,"/info");this.xo=n._getReceiver(t,i,e),this.timeoutRef=setTimeout(function(){r._cleanup(!1),r.emit("finish")},n.timeout),this.xo.once("finish",function(t,e){r._cleanup(!0),r.emit("finish",t,e)})},n.prototype._cleanup=function(t){clearTimeout(this.timeoutRef),this.timeoutRef=null,!t&&this.xo&&this.xo.close(),this.xo=null},n.prototype.close=function(){this.removeAllListeners(),
this._cleanup(!1)},n.timeout=8E3,e.exports=n},{"./info-ajax":9,"./info-iframe":11,"./transport/sender/xdr":34,"./transport/sender/xhr-cors":35,"./transport/sender/xhr-fake":36,"./transport/sender/xhr-local":37,"./utils/url":52,debug:void 0,events:3,inherits:54}],13:[function(t,e){(function(t){e.exports=t.location||{origin:"http://localhost:80",protocol:"http",host:"localhost",port:80,href:"http://localhost/",hash:""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=
typeof window?window:{})},{}],14:[function(t,e){(function(n){function r(t,e,n){if(!(this instanceof r))return new r(t,e,n);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");y.call(this),this.readyState=r.CONNECTING,this.extensions="",this.protocol="",n=n||{},n.protocols_whitelist&&m.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=n.transports;var i=n.sessionId||8;if("function"==typeof i)this._generateSessionId=
i;else{if("number"!=typeof i)throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._generateSessionId=function(){return c.string(i)}}this._server=n.server||c.numberString(1E3);var o=new s(t);if(!o.host||!o.protocol)throw new SyntaxError("The URL '"+t+"' is invalid");if(o.hash)throw new SyntaxError("The URL must not contain a fragment");if("http:"!==o.protocol&&"https:"!==o.protocol)throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+
o.protocol+"' is not allowed.");var a="https:"===o.protocol;if("https"===g.protocol&&!a)throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");e?Array.isArray(e)||(e=[e]):e=[];var u=e.sort();u.forEach(function(t,e){if(!t)throw new SyntaxError("The protocols entry '"+t+"' is invalid.");if(e<u.length-1&&t===u[e+1])throw new SyntaxError("The protocols entry '"+t+"' is duplicated.");});var l=f.getOrigin(g.href);this._origin=l?l.toLowerCase():
null,o.set("pathname",o.pathname.replace(/\/+$/,"")),this.url=o.href,this._urlInfo={nullOrigin:!v.hasDomain(),sameOrigin:f.isOriginEqual(this.url,g.href),sameScheme:f.isSchemeEqual(this.url,g.href)},this._ir=new _(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}function i(t){return 1E3===t||t>=3E3&&4999>=t}t("./shims");var o,s=t("url-parse"),a=t("inherits"),u=t("json3"),c=t("./utils/random"),l=t("./utils/escape"),f=t("./utils/url"),h=t("./utils/event"),d=t("./utils/transport"),
p=t("./utils/object"),v=t("./utils/browser"),m=t("./utils/log"),b=t("./event/event"),y=t("./event/eventtarget"),g=t("./location"),w=t("./event/close"),x=t("./event/trans-message"),_=t("./info-receiver");a(r,y),r.prototype.close=function(t,e){if(t&&!i(t))throw new Error("InvalidAccessError: Invalid code");if(e&&e.length>123)throw new SyntaxError("reason argument has an invalid length");if(this.readyState!==r.CLOSING&&this.readyState!==r.CLOSED){var n=!0;this._close(t||1E3,e||"Normal closure",n)}},
r.prototype.send=function(t){if("string"!=typeof t&&(t=""+t),this.readyState===r.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===r.OPEN&&this._transport.send(l.quote(t))},r.version=t("./version"),r.CONNECTING=0,r.OPEN=1,r.CLOSING=2,r.CLOSED=3,r.prototype._receiveInfo=function(t,e){if(this._ir=null,!t)return void this._close(1002,"Cannot connect to server");this._rto=this.countRTO(e),this._transUrl=t.base_url?t.base_url:this.url,t=p.extend(t,
this._urlInfo);var n=o.filterToEnabled(this._transportsWhitelist,t);this._transports=n.main,this._connect()},r.prototype._connect=function(){for(var t=this._transports.shift();t;t=this._transports.shift()){if(t.needBody&&(!n.document.body||"undefined"!=typeof n.document.readyState&&"complete"!==n.document.readyState&&"interactive"!==n.document.readyState))return this._transports.unshift(t),void h.attachEvent("load",this._connect.bind(this));var e=this._rto*t.roundTrips||5E3;this._transportTimeoutId=
setTimeout(this._transportTimeout.bind(this),e);var r=f.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),i=new t(r,this._transUrl);return i.on("message",this._transportMessage.bind(this)),i.once("close",this._transportClose.bind(this)),i.transportName=t.transportName,void(this._transport=i)}this._close(2E3,"All transports failed",!1)},r.prototype._transportTimeout=function(){this.readyState===r.CONNECTING&&this._transportClose(2007,"Transport timed out")},r.prototype._transportMessage=
function(t){var e,n=this,r=t.slice(0,1),i=t.slice(1);switch(r){case "o":return void this._open();case "h":return void this.dispatchEvent(new b("heartbeat"))}if(i)try{e=u.parse(i)}catch(o){}if("undefined"!=typeof e)switch(r){case "a":Array.isArray(e)&&e.forEach(function(t){n.dispatchEvent(new x(t))});break;case "m":this.dispatchEvent(new x(e));break;case "c":Array.isArray(e)&&2===e.length&&this._close(e[0],e[1],!0)}},r.prototype._transportClose=function(t,e){return this._transport&&(this._transport.removeAllListeners(),
this._transport=null,this.transport=null),i(t)||2E3===t||this.readyState!==r.CONNECTING?void this._close(t,e):void this._connect()},r.prototype._open=function(){this.readyState===r.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=r.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new b("open"))):this._close(1006,"Server lost session")},r.prototype._close=function(t,e,n){var i=!1;if(this._ir&&(i=!0,this._ir.close(),
this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===r.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=r.CLOSING,setTimeout(function(){this.readyState=r.CLOSED,i&&this.dispatchEvent(new b("error"));var o=new w("close");o.wasClean=n||!1,o.code=t||1E3,o.reason=e,this.dispatchEvent(o),this.onmessage=this.onclose=this.onerror=null}.bind(this),0)},r.prototype.countRTO=function(t){return t>100?4*
t:300+t},e.exports=function(e){return o=d(e),t("./iframe-bootstrap")(r,e),r}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./event/close":2,"./event/event":4,"./event/eventtarget":5,"./event/trans-message":6,"./iframe-bootstrap":8,"./info-receiver":12,"./location":13,"./shims":15,"./utils/browser":44,"./utils/escape":45,"./utils/event":46,"./utils/log":48,"./utils/object":49,"./utils/random":50,"./utils/transport":51,"./utils/url":52,
"./version":53,debug:void 0,inherits:54,json3:55,"url-parse":56}],15:[function(){function t(t){var e=+t;return e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e}function e(t){return t>>>0}function n(){}var r,i=Array.prototype,o=Object.prototype,s=Function.prototype,a=String.prototype,u=i.slice,c=o.toString,l=function(t){return"[object Function]"===o.toString.call(t)},f=function(t){return"[object Array]"===c.call(t)},h=function(t){return"[object String]"===c.call(t)},d=
Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch(t){return!1}}();r=d?function(t,e,n,r){!r&&e in t||Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(t,e,n,r){!r&&e in t||(t[e]=n)};var p=function(t,e,n){for(var i in e)o.hasOwnProperty.call(e,i)&&r(t,i,e[i],n)},v=function(t){if(null==t)throw new TypeError("can't convert "+t+" to object");return Object(t)};p(s,{bind:function(t){var e=this;if(!l(e))throw new TypeError("Function.prototype.bind called on incompatible "+
e);for(var r=u.call(arguments,1),i=function(){if(this instanceof c){var n=e.apply(this,r.concat(u.call(arguments)));return Object(n)===n?n:this}return e.apply(t,r.concat(u.call(arguments)))},o=Math.max(0,e.length-r.length),s=[],a=0;o>a;a++)s.push("$"+a);var c=Function("binder","return function ("+s.join(",")+"){ return binder.apply(this, arguments); }")(i);return e.prototype&&(n.prototype=e.prototype,c.prototype=new n,n.prototype=null),c}}),p(Array,{isArray:f});var m=Object("a"),b="a"!==m[0]||!(0 in
m),y=function(t){var e=!0,n=!0;return t&&(t.call("foo",function(t,n,r){"object"!=typeof r&&(e=!1)}),t.call([1],function(){n="string"==typeof this},"x")),!!t&&e&&n};p(i,{forEach:function(t){var e=v(this),n=b&&h(this)?this.split(""):e,r=arguments[1],i=-1,o=n.length>>>0;if(!l(t))throw new TypeError;for(;++i<o;)i in n&&t.call(r,n[i],i,e)}},!y(i.forEach));var g=Array.prototype.indexOf&&-1!==[0,1].indexOf(1,2);p(i,{indexOf:function(e){var n=b&&h(this)?this.split(""):v(this),r=n.length>>>0;if(!r)return-1;
var i=0;for(arguments.length>1&&(i=t(arguments[1])),i=i>=0?i:Math.max(0,r+i);r>i;i++)if(i in n&&n[i]===e)return i;return-1}},g);var w=a.split;2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?!function(){var t=void 0===/()??/.exec("")[1];a.split=function(n,r){var o=this;if(void 0===n&&0===r)return[];if("[object RegExp]"!==c.call(n))return w.call(this,n,r);var s,a,
u,l,f=[],h=(n.ignoreCase?"i":"")+(n.multiline?"m":"")+(n.extended?"x":"")+(n.sticky?"y":""),d=0;for(n=new RegExp(n.source,h+"g"),o+="",t||(s=new RegExp("^"+n.source+"$(?!\\s)",h)),r=void 0===r?-1>>>0:e(r);(a=n.exec(o))&&(u=a.index+a[0].length,!(u>d&&(f.push(o.slice(d,a.index)),!t&&a.length>1&&a[0].replace(s,function(){for(var t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(a[t]=void 0)}),a.length>1&&a.index<o.length&&i.push.apply(f,a.slice(1)),l=a[0].length,d=u,f.length>=r)));)n.lastIndex===
a.index&&n.lastIndex++;return d===o.length?(l||!n.test(""))&&f.push(""):f.push(o.slice(d)),f.length>r?f.slice(0,r):f}}():"0".split(void 0,0).length&&(a.split=function(t,e){return void 0===t&&0===e?[]:w.call(this,t,e)});var x="\t\n\x0B\f\r \u00a0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff",_="\u200b",E="["+x+"]",S=new RegExp("^"+E+E+"*"),O=new RegExp(E+E+"*$"),T=a.trim&&(x.trim()||!_.trim());p(a,{trim:function(){if(void 0===this||
null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(S,"").replace(O,"")}},T);var j=a.substr,C="".substr&&"b"!=="0b".substr(-1);p(a,{substr:function(t,e){return j.call(this,0>t&&(t=this.length+t)<0?0:t,e)}},C)},{}],16:[function(t,e){e.exports=[t("./transport/websocket"),t("./transport/xhr-streaming"),t("./transport/xdr-streaming"),t("./transport/eventsource"),t("./transport/lib/iframe-wrap")(t("./transport/eventsource")),t("./transport/htmlfile"),t("./transport/lib/iframe-wrap")(t("./transport/htmlfile")),
t("./transport/xhr-polling"),t("./transport/xdr-polling"),t("./transport/lib/iframe-wrap")(t("./transport/xhr-polling")),t("./transport/jsonp-polling")]},{"./transport/eventsource":20,"./transport/htmlfile":21,"./transport/jsonp-polling":23,"./transport/lib/iframe-wrap":26,"./transport/websocket":38,"./transport/xdr-polling":39,"./transport/xdr-streaming":40,"./transport/xhr-polling":41,"./transport/xhr-streaming":42}],17:[function(t,e){(function(n){function r(t,e,n,r){var o=this;i.call(this),setTimeout(function(){o._start(t,
e,n,r)},0)}var i=t("events").EventEmitter,o=t("inherits"),s=t("../../utils/event"),a=t("../../utils/url"),u=n.XMLHttpRequest;o(r,i),r.prototype._start=function(t,e,n,i){var o=this;try{this.xhr=new u}catch(c){}if(!this.xhr)return this.emit("finish",0,"no xhr support"),void this._cleanup();e=a.addQuery(e,"t\x3d"+ +new Date),this.unloadRef=s.unloadAdd(function(){o._cleanup(!0)});try{this.xhr.open(t,e,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){o.emit("finish",
0,""),o._cleanup(!1)})}catch(l){return this.emit("finish",0,""),void this._cleanup(!1)}if(i&&i.noCredentials||!r.supportsCORS||(this.xhr.withCredentials="true"),i&&i.headers)for(var f in i.headers)this.xhr.setRequestHeader(f,i.headers[f]);this.xhr.onreadystatechange=function(){if(o.xhr){var t,e,n=o.xhr;switch(n.readyState){case 3:try{e=n.status,t=n.responseText}catch(r){}1223===e&&(e=204),200===e&&t&&t.length>0&&o.emit("chunk",e,t);break;case 4:e=n.status,1223===e&&(e=204),(12005===e||12029===e)&&
(e=0),o.emit("finish",e,n.responseText),o._cleanup(!1)}}};try{o.xhr.send(n)}catch(l){o.emit("finish",0,""),o._cleanup(!1)}},r.prototype._cleanup=function(t){if(this.xhr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),t)try{this.xhr.abort()}catch(e){}this.unloadRef=this.xhr=null}},r.prototype.close=function(){this._cleanup(!0)},r.enabled=!!u;var c=["Active"].concat("Object").join("X");!r.enabled&&c in n&&
(u=function(){try{return new n[c]("Microsoft.XMLHTTP")}catch(t){return null}},r.enabled=!!new u);var l=!1;try{l="withCredentials"in new u}catch(f){}r.supportsCORS=l,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],18:[function(t,e){(function(t){e.exports=t.EventSource}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:
"undefined"!=typeof window?window:{})},{}],19:[function(t,e){(function(t){e.exports=t.WebSocket||t.MozWebSocket}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],20:[function(t,e){function n(t){if(!n.enabled())throw new Error("Transport created when disabled");i.call(this,t,"/eventsource",o,s)}var r=t("inherits"),i=t("./lib/ajax-based"),o=t("./receiver/eventsource"),s=t("./sender/xhr-cors"),a=t("eventsource");r(n,i),n.enabled=function(){return!!a},
n.transportName="eventsource",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/eventsource":29,"./sender/xhr-cors":35,eventsource:18,inherits:54}],21:[function(t,e){function n(t){if(!i.enabled)throw new Error("Transport created when disabled");s.call(this,t,"/htmlfile",i,o)}var r=t("inherits"),i=t("./receiver/htmlfile"),o=t("./sender/xhr-local"),s=t("./lib/ajax-based");r(n,s),n.enabled=function(t){return i.enabled&&t.sameOrigin},n.transportName="htmlfile",n.roundTrips=2,e.exports=n},
{"./lib/ajax-based":24,"./receiver/htmlfile":30,"./sender/xhr-local":37,inherits:54}],22:[function(t,e){function n(t,e,r){if(!n.enabled())throw new Error("Transport created when disabled");o.call(this);var i=this;this.origin=a.getOrigin(r),this.baseUrl=r,this.transUrl=e,this.transport=t,this.windowId=l.string(8);var s=a.addPath(r,"/iframe.html")+"#"+this.windowId;this.iframeObj=u.createIframe(s,function(t){i.emit("close",1006,"Unable to load an iframe ("+t+")"),i.close()}),this.onmessageCallback=
this._message.bind(this),c.attachEvent("message",this.onmessageCallback)}var r=t("inherits"),i=t("json3"),o=t("events").EventEmitter,s=t("../version"),a=t("../utils/url"),u=t("../utils/iframe"),c=t("../utils/event"),l=t("../utils/random");r(n,o),n.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){c.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch(t){}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},n.prototype._message=
function(t){if(a.isOriginEqual(t.origin,this.origin)){var e;try{e=i.parse(t.data)}catch(n){return}if(e.windowId===this.windowId)switch(e.type){case "s":this.iframeObj.loaded(),this.postMessage("s",i.stringify([s,this.transport,this.transUrl,this.baseUrl]));break;case "t":this.emit("message",e.data);break;case "c":var r;try{r=i.parse(e.data)}catch(n){return}this.emit("close",r[0],r[1]),this.close()}}},n.prototype.postMessage=function(t,e){this.iframeObj.post(i.stringify({windowId:this.windowId,type:t,
data:e||""}),this.origin)},n.prototype.send=function(t){this.postMessage("m",t)},n.enabled=function(){return u.iframeEnabled},n.transportName="iframe",n.roundTrips=2,e.exports=n},{"../utils/event":46,"../utils/iframe":47,"../utils/random":50,"../utils/url":52,"../version":53,debug:void 0,events:3,inherits:54,json3:55}],23:[function(t,e){(function(n){function r(t){if(!r.enabled())throw new Error("Transport created when disabled");o.call(this,t,"/jsonp",a,s)}var i=t("inherits"),o=t("./lib/sender-receiver"),
s=t("./receiver/jsonp"),a=t("./sender/jsonp");i(r,o),r.enabled=function(){return!!n.document},r.transportName="jsonp-polling",r.roundTrips=1,r.needBody=!0,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./lib/sender-receiver":28,"./receiver/jsonp":31,"./sender/jsonp":33,inherits:54}],24:[function(t,e){function n(t){return function(e,n,r){var i={};"string"==typeof n&&(i.headers={"Content-type":"text/plain"});var s=o.addPath(e,
"/xhr_send"),a=new t("POST",s,n,i);return a.once("finish",function(t){return a=null,200!==t&&204!==t?r(new Error("http status "+t)):void r()}),function(){a.close(),a=null;var t=new Error("Aborted");t.code=1E3,r(t)}}}function r(t,e,r,i){s.call(this,t,e,n(i),r,i)}var i=t("inherits"),o=t("../../utils/url"),s=t("./sender-receiver");i(r,s),e.exports=r},{"../../utils/url":52,"./sender-receiver":28,debug:void 0,inherits:54}],25:[function(t,e){function n(t,e){i.call(this),this.sendBuffer=[],this.sender=e,
this.url=t}var r=t("inherits"),i=t("events").EventEmitter;r(n,i),n.prototype.send=function(t){this.sendBuffer.push(t),this.sendStop||this.sendSchedule()},n.prototype.sendScheduleWait=function(){var t,e=this;this.sendStop=function(){e.sendStop=null,clearTimeout(t)},t=setTimeout(function(){e.sendStop=null,e.sendSchedule()},25)},n.prototype.sendSchedule=function(){var t=this;if(this.sendBuffer.length>0){var e="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,e,function(e){t.sendStop=
null,e?(t.emit("close",e.code||1006,"Sending error: "+e),t._cleanup()):t.sendScheduleWait()}),this.sendBuffer=[]}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.stop=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},e.exports=n},{debug:void 0,events:3,inherits:54}],26:[function(t,e){(function(n){var r=t("inherits"),i=t("../iframe"),o=t("../../utils/object");e.exports=function(t){function e(e,n){i.call(this,t.transportName,e,n)}return r(e,i),e.enabled=
function(e,r){if(!n.document)return!1;var s=o.extend({},r);return s.sameOrigin=!0,t.enabled(s)&&i.enabled()},e.transportName="iframe-"+t.transportName,e.needBody=!0,e.roundTrips=i.roundTrips+t.roundTrips-1,e.facadeTransport=t,e}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/object":49,"../iframe":22,inherits:54}],27:[function(t,e){function n(t,e,n){i.call(this),this.Receiver=t,this.receiveUrl=e,this.AjaxObject=n,this._scheduleReceiver()}
var r=t("inherits"),i=t("events").EventEmitter;r(n,i),n.prototype._scheduleReceiver=function(){var t=this,e=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);e.on("message",function(e){t.emit("message",e)}),e.once("close",function(n,r){t.poll=e=null,t.pollIsClosing||("network"===r?t._scheduleReceiver():(t.emit("close",n||1006,r),t.removeAllListeners()))})},n.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},e.exports=n},{debug:void 0,
events:3,inherits:54}],28:[function(t,e){function n(t,e,n,r,a){var u=i.addPath(t,e),c=this;o.call(this,t,n),this.poll=new s(r,u,a),this.poll.on("message",function(t){c.emit("message",t)}),this.poll.once("close",function(t,e){c.poll=null,c.emit("close",t,e),c.close()})}var r=t("inherits"),i=t("../../utils/url"),o=t("./buffered-sender"),s=t("./polling");r(n,o),n.prototype.close=function(){this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null),this.stop()},e.exports=n},{"../../utils/url":52,
"./buffered-sender":25,"./polling":27,debug:void 0,inherits:54}],29:[function(t,e){function n(t){i.call(this);var e=this,n=this.es=new o(t);n.onmessage=function(t){e.emit("message",decodeURI(t.data))},n.onerror=function(t){var r=2!==n.readyState?"network":"permanent";e._cleanup(),e._close(r)}}var r=t("inherits"),i=t("events").EventEmitter,o=t("eventsource");r(n,i),n.prototype.abort=function(){this._cleanup(),this._close("user")},n.prototype._cleanup=function(){var t=this.es;t&&(t.onmessage=t.onerror=
null,t.close(),this.es=null)},n.prototype._close=function(t){var e=this;setTimeout(function(){e.emit("close",null,t),e.removeAllListeners()},200)},e.exports=n},{debug:void 0,events:3,eventsource:18,inherits:54}],30:[function(t,e){(function(n){function r(t){a.call(this);var e=this;o.polluteGlobalNamespace(),this.id="a"+u.string(6),t=s.addQuery(t,"c\x3d"+decodeURIComponent(o.WPrefix+"."+this.id));var i=r.htmlfileEnabled?o.createHtmlfile:o.createIframe;n[o.WPrefix][this.id]={start:function(){e.iframeObj.loaded()},
message:function(t){e.emit("message",t)},stop:function(){e._cleanup(),e._close("network")}},this.iframeObj=i(t,function(){e._cleanup(),e._close("permanent")})}var i=t("inherits"),o=t("../../utils/iframe"),s=t("../../utils/url"),a=t("events").EventEmitter,u=t("../../utils/random");i(r,a),r.prototype.abort=function(){this._cleanup(),this._close("user")},r.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete n[o.WPrefix][this.id]},r.prototype._close=function(t){this.emit("close",
null,t),this.removeAllListeners()},r.htmlfileEnabled=!1;var c=["Active"].concat("Object").join("X");if(c in n)try{r.htmlfileEnabled=!!new n[c]("htmlfile")}catch(l){}r.enabled=r.htmlfileEnabled||o.iframeEnabled,e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/iframe":47,"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],31:[function(t,e){(function(n){function r(t){var e=this;c.call(this),
i.polluteGlobalNamespace(),this.id="a"+o.string(6);var s=a.addQuery(t,"c\x3d"+encodeURIComponent(i.WPrefix+"."+this.id));n[i.WPrefix][this.id]=this._callback.bind(this),this._createScript(s),this.timeoutId=setTimeout(function(){e._abort(new Error("JSONP script loaded abnormally (timeout)"))},r.timeout)}var i=t("../../utils/iframe"),o=t("../../utils/random"),s=t("../../utils/browser"),a=t("../../utils/url"),u=t("inherits"),c=t("events").EventEmitter;u(r,c),r.prototype.abort=function(){if(n[i.WPrefix][this.id]){var t=
new Error("JSONP user aborted read");t.code=1E3,this._abort(t)}},r.timeout=35E3,r.scriptErrorTimeout=1E3,r.prototype._callback=function(t){this._cleanup(),this.aborting||(t&&this.emit("message",t),this.emit("close",null,"network"),this.removeAllListeners())},r.prototype._abort=function(t){this._cleanup(),this.aborting=!0,this.emit("close",t.code,t.message),this.removeAllListeners()},r.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),
this.script2=null),this.script){var t=this.script;t.parentNode.removeChild(t),t.onreadystatechange=t.onerror=t.onload=t.onclick=null,this.script=null}delete n[i.WPrefix][this.id]},r.prototype._scriptError=function(){var t=this;this.errorTimer||(this.errorTimer=setTimeout(function(){t.loadedOkay||t._abort(new Error("JSONP script loaded abnormally (onerror)"))},r.scriptErrorTimeout))},r.prototype._createScript=function(t){var e,r=this,i=this.script=n.document.createElement("script");if(i.id="a"+o.string(8),
i.src=t,i.type="text/javascript",i.charset="UTF-8",i.onerror=this._scriptError.bind(this),i.onload=function(){r._abort(new Error("JSONP script loaded abnormally (onload)"))},i.onreadystatechange=function(){if(/loaded|closed/.test(i.readyState)){if(i&&i.htmlFor&&i.onclick){r.loadedOkay=!0;try{i.onclick()}catch(t){}}i&&r._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof i.async&&n.document.attachEvent)if(s.isOpera())e=this.script2=n.document.createElement("script"),
e.text="try{var a \x3d document.getElementById('"+i.id+"'); if(a)a.onerror();}catch(x){};",i.async=e.async=!1;else{try{i.htmlFor=i.id,i.event="onclick"}catch(a){}i.async=!0}"undefined"!=typeof i.async&&(i.async=!0);var u=n.document.getElementsByTagName("head")[0];u.insertBefore(i,u.firstChild),e&&u.insertBefore(e,u.firstChild)},e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/iframe":47,
"../../utils/random":50,"../../utils/url":52,debug:void 0,events:3,inherits:54}],32:[function(t,e){function n(t,e){i.call(this);var n=this;this.bufferPosition=0,this.xo=new e("POST",t,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(t,e){n._chunkHandler(t,e),n.xo=null;var r=200===t?"network":"permanent";n.emit("close",null,r),n._cleanup()})}var r=t("inherits"),i=t("events").EventEmitter;r(n,i),n.prototype._chunkHandler=function(t,e){if(200===t&&e)for(var n=-1;;this.bufferPosition+=
n+1){var r=e.slice(this.bufferPosition);if(n=r.indexOf("\n"),-1===n)break;var i=r.slice(0,n);i&&this.emit("message",i)}},n.prototype._cleanup=function(){this.removeAllListeners()},n.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},e.exports=n},{debug:void 0,events:3,inherits:54}],33:[function(t,e){(function(n){function r(t){try{return n.document.createElement('\x3ciframe name\x3d"'+t+'"\x3e')}catch(e){var r=n.document.createElement("iframe");
return r.name=t,r}}function i(){o=n.document.createElement("form"),o.style.display="none",o.style.position="absolute",o.method="POST",o.enctype="application/x-www-form-urlencoded",o.acceptCharset="UTF-8",s=n.document.createElement("textarea"),s.name="d",o.appendChild(s),n.document.body.appendChild(o)}var o,s,a=t("../../utils/random"),u=t("../../utils/url");e.exports=function(t,e,n){o||i();var c="a"+a.string(8);o.target=c,o.action=u.addQuery(u.addPath(t,"/jsonp_send"),"i\x3d"+c);var l=r(c);l.id=c,
l.style.display="none",o.appendChild(l);try{s.value=e}catch(f){}o.submit();var h=function(t){l.onerror&&(l.onreadystatechange=l.onerror=l.onload=null,setTimeout(function(){l.parentNode.removeChild(l),l=null},500),s.value="",n(t))};return l.onerror=function(){h()},l.onload=function(){h()},l.onreadystatechange=function(t){"complete"===l.readyState&&h()},function(){h(new Error("Aborted"))}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:
{})},{"../../utils/random":50,"../../utils/url":52,debug:void 0}],34:[function(t,e){(function(n){function r(t,e,n){var r=this;i.call(this),setTimeout(function(){r._start(t,e,n)},0)}var i=t("events").EventEmitter,o=t("inherits"),s=t("../../utils/event"),a=t("../../utils/browser"),u=t("../../utils/url");o(r,i),r.prototype._start=function(t,e,r){var i=this,o=new n.XDomainRequest;e=u.addQuery(e,"t\x3d"+ +new Date),o.onerror=function(){i._error()},o.ontimeout=function(){i._error()},o.onprogress=function(){i.emit("chunk",
200,o.responseText)},o.onload=function(){i.emit("finish",200,o.responseText),i._cleanup(!1)},this.xdr=o,this.unloadRef=s.unloadAdd(function(){i._cleanup(!0)});try{this.xdr.open(t,e),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(r)}catch(a){this._error()}},r.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},r.prototype._cleanup=function(t){if(this.xdr){if(this.removeAllListeners(),s.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=
this.xdr.onload=null,t)try{this.xdr.abort()}catch(e){}this.unloadRef=this.xdr=null}},r.prototype.close=function(){this._cleanup(!0)},r.enabled=!(!n.XDomainRequest||!a.hasDomain()),e.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../utils/browser":44,"../../utils/event":46,"../../utils/url":52,debug:void 0,events:3,inherits:54}],35:[function(t,e){function n(t,e,n,r){i.call(this,t,e,n,r)}var r=t("inherits"),i=t("../driver/xhr");
r(n,i),n.enabled=i.enabled&&i.supportsCORS,e.exports=n},{"../driver/xhr":17,inherits:54}],36:[function(t,e){function n(){var t=this;r.call(this),this.to=setTimeout(function(){t.emit("finish",200,"{}")},n.timeout)}var r=t("events").EventEmitter,i=t("inherits");i(n,r),n.prototype.close=function(){clearTimeout(this.to)},n.timeout=2E3,e.exports=n},{events:3,inherits:54}],37:[function(t,e){function n(t,e,n){i.call(this,t,e,n,{noCredentials:!0})}var r=t("inherits"),i=t("../driver/xhr");r(n,i),n.enabled=
i.enabled,e.exports=n},{"../driver/xhr":17,inherits:54}],38:[function(t,e){function n(t){if(!n.enabled())throw new Error("Transport created when disabled");s.call(this);var e=this,o=i.addPath(t,"/websocket");o="https"===o.slice(0,5)?"wss"+o.slice(5):"ws"+o.slice(4),this.url=o,this.ws=new a(this.url),this.ws.onmessage=function(t){e.emit("message",t.data)},this.unloadRef=r.unloadAdd(function(){e.ws.close()}),this.ws.onclose=function(t){e.emit("close",t.code,t.reason),e._cleanup()},this.ws.onerror=function(t){e.emit("close",
1006,"WebSocket connection broken"),e._cleanup()}}var r=t("../utils/event"),i=t("../utils/url"),o=t("inherits"),s=t("events").EventEmitter,a=t("./driver/websocket");o(n,s),n.prototype.send=function(t){var e="["+t+"]";this.ws.send(e)},n.prototype.close=function(){this.ws&&this.ws.close(),this._cleanup()},n.prototype._cleanup=function(){var t=this.ws;t&&(t.onmessage=t.onclose=t.onerror=null),r.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},n.enabled=function(){return!!a},
n.transportName="websocket",n.roundTrips=2,e.exports=n},{"../utils/event":46,"../utils/url":52,"./driver/websocket":19,debug:void 0,events:3,inherits:54}],39:[function(t,e){function n(t){if(!a.enabled)throw new Error("Transport created when disabled");i.call(this,t,"/xhr",s,a)}var r=t("inherits"),i=t("./lib/ajax-based"),o=t("./xdr-streaming"),s=t("./receiver/xhr"),a=t("./sender/xdr");r(n,i),n.enabled=o.enabled,n.transportName="xdr-polling",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,
"./sender/xdr":34,"./xdr-streaming":40,inherits:54}],40:[function(t,e){function n(t){if(!s.enabled)throw new Error("Transport created when disabled");i.call(this,t,"/xhr_streaming",o,s)}var r=t("inherits"),i=t("./lib/ajax-based"),o=t("./receiver/xhr"),s=t("./sender/xdr");r(n,i),n.enabled=function(t){return t.cookie_needed||t.nullOrigin?!1:s.enabled&&t.sameScheme},n.transportName="xdr-streaming",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xdr":34,inherits:54}],
41:[function(t,e){function n(t){if(!a.enabled&&!s.enabled)throw new Error("Transport created when disabled");i.call(this,t,"/xhr",o,s)}var r=t("inherits"),i=t("./lib/ajax-based"),o=t("./receiver/xhr"),s=t("./sender/xhr-cors"),a=t("./sender/xhr-local");r(n,i),n.enabled=function(t){return t.nullOrigin?!1:a.enabled&&t.sameOrigin?!0:s.enabled},n.transportName="xhr-polling",n.roundTrips=2,e.exports=n},{"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],
42:[function(t,e){(function(n){function r(t){if(!u.enabled&&!a.enabled)throw new Error("Transport created when disabled");o.call(this,t,"/xhr_streaming",s,a)}var i=t("inherits"),o=t("./lib/ajax-based"),s=t("./receiver/xhr"),a=t("./sender/xhr-cors"),u=t("./sender/xhr-local"),c=t("../utils/browser");i(r,o),r.enabled=function(t){return t.nullOrigin?!1:c.isOpera()?!1:a.enabled},r.transportName="xhr-streaming",r.roundTrips=2,r.needBody=!!n.document,e.exports=r}).call(this,"undefined"!=typeof global?global:
"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utils/browser":44,"./lib/ajax-based":24,"./receiver/xhr":32,"./sender/xhr-cors":35,"./sender/xhr-local":37,inherits:54}],43:[function(t,e){(function(t){e.exports.randomBytes=t.crypto&&t.crypto.getRandomValues?function(e){var n=new Uint8Array(e);return t.crypto.getRandomValues(n),n}:function(t){for(var e=new Array(t),n=0;t>n;n++)e[n]=Math.floor(256*Math.random());return e}}).call(this,"undefined"!=typeof global?global:"undefined"!=
typeof self?self:"undefined"!=typeof window?window:{})},{}],44:[function(t,e){(function(t){e.exports={isOpera:function(){return t.navigator&&/opera/i.test(t.navigator.userAgent)},isKonqueror:function(){return t.navigator&&/konqueror/i.test(t.navigator.userAgent)},hasDomain:function(){if(!t.document)return!0;try{return!!t.document.domain}catch(e){return!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(t,e){var n,
r=t("json3"),i=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,
o=function(t){var e,n={},r=[];for(e=0;65536>e;e++)r.push(String.fromCharCode(e));return t.lastIndex=0,r.join("").replace(t,function(t){return n[t]="\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4),""}),t.lastIndex=0,n};e.exports={quote:function(t){var e=r.stringify(t);return i.lastIndex=0,i.test(e)?(n||(n=o(i)),e.replace(i,function(t){return n[t]})):e}}},{json3:55}],46:[function(t,e){(function(n){var r=t("./random"),i={},o=!1,s=n.chrome&&n.chrome.app&&n.chrome.app.runtime;e.exports={attachEvent:function(t,
e){"undefined"!=typeof n.addEventListener?n.addEventListener(t,e,!1):n.document&&n.attachEvent&&(n.document.attachEvent("on"+t,e),n.attachEvent("on"+t,e))},detachEvent:function(t,e){"undefined"!=typeof n.addEventListener?n.removeEventListener(t,e,!1):n.document&&n.detachEvent&&(n.document.detachEvent("on"+t,e),n.detachEvent("on"+t,e))},unloadAdd:function(t){if(s)return null;var e=r.string(8);return i[e]=t,o&&setTimeout(this.triggerUnloadCallbacks,0),e},unloadDel:function(t){t in i&&delete i[t]},triggerUnloadCallbacks:function(){for(var t in i)i[t](),
delete i[t]}};var a=function(){o||(o=!0,e.exports.triggerUnloadCallbacks())};s||e.exports.attachEvent("unload",a)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./random":50}],47:[function(t,e){(function(n){var r=t("./event"),i=t("json3"),o=t("./browser");e.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){e.exports.WPrefix in n||(n[e.exports.WPrefix]={})},postMessage:function(t,r){n.parent!==n&&n.parent.postMessage(i.stringify({windowId:e.exports.currentWindowId,
type:t,data:r||""}),"*")},createIframe:function(t,e){var i,o,s=n.document.createElement("iframe"),a=function(){clearTimeout(i);try{s.onload=null}catch(t){}s.onerror=null},u=function(){s&&(a(),setTimeout(function(){s&&s.parentNode.removeChild(s),s=null},0),r.unloadDel(o))},c=function(t){s&&(u(),e(t))},l=function(t,e){try{setTimeout(function(){s&&s.contentWindow&&s.contentWindow.postMessage(t,e)},0)}catch(n){}};return s.src=t,s.style.display="none",s.style.position="absolute",s.onerror=function(){c("onerror")},
s.onload=function(){clearTimeout(i),i=setTimeout(function(){c("onload timeout")},2E3)},n.document.body.appendChild(s),i=setTimeout(function(){c("timeout")},15E3),o=r.unloadAdd(u),{post:l,cleanup:u,loaded:a}},createHtmlfile:function(t,i){var o,s,a,u=["Active"].concat("Object").join("X"),c=new n[u]("htmlfile"),l=function(){clearTimeout(o),a.onerror=null},f=function(){c&&(l(),r.unloadDel(s),a.parentNode.removeChild(a),a=c=null,CollectGarbage())},h=function(t){c&&(f(),i(t))},d=function(t,e){try{setTimeout(function(){a&&
a.contentWindow&&a.contentWindow.postMessage(t,e)},0)}catch(n){}};c.open(),c.write('\x3chtml\x3e\x3cscript\x3edocument.domain\x3d"'+n.document.domain+'";\x3c/script\x3e\x3c/html\x3e'),c.close(),c.parentWindow[e.exports.WPrefix]=n[e.exports.WPrefix];var p=c.createElement("div");return c.body.appendChild(p),a=c.createElement("iframe"),p.appendChild(a),a.src=t,a.onerror=function(){h("onerror")},o=setTimeout(function(){h("timeout")},15E3),s=r.unloadAdd(f),{post:d,cleanup:f,loaded:l}}},e.exports.iframeEnabled=
!1,n.document&&(e.exports.iframeEnabled=("function"==typeof n.postMessage||"object"==typeof n.postMessage)&&!o.isKonqueror())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./browser":44,"./event":46,debug:void 0,json3:55}],48:[function(t,e){(function(t){var n={};["log","debug","warn"].forEach(function(e){var r=t.console&&t.console[e]&&t.console[e].apply;n[e]=r?function(){return t.console[e].apply(t.console,arguments)}:"log"===
e?function(){}:n.log}),e.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(t,e){e.exports={isObject:function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},extend:function(t){if(!this.isObject(t))return t;for(var e,n,r=1,i=arguments.length;i>r;r++){e=arguments[r];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}}},{}],50:[function(t,e){var n=t("crypto"),r="abcdefghijklmnopqrstuvwxyz012345";
e.exports={string:function(t){for(var e=r.length,i=n.randomBytes(t),o=[],s=0;t>s;s++)o.push(r.substr(i[s]%e,1));return o.join("")},number:function(t){return Math.floor(Math.random()*t)},numberString:function(t){var e=(""+(t-1)).length,n=(new Array(e+1)).join("0");return(n+this.number(t)).slice(-e)}}},{crypto:43}],51:[function(t,e){e.exports=function(t){return{filterToEnabled:function(e,n){var r={main:[],facade:[]};return e?"string"==typeof e&&(e=[e]):e=[],t.forEach(function(t){t&&("websocket"!==t.transportName||
n.websocket!==!1)&&(e.length&&-1===e.indexOf(t.transportName)||t.enabled(n)&&(r.main.push(t),t.facadeTransport&&r.facade.push(t.facadeTransport)))}),r}}}},{debug:void 0}],52:[function(t,e){var n=t("url-parse");e.exports={getOrigin:function(t){if(!t)return null;var e=new n(t);if("file:"===e.protocol)return null;var r=e.port;return r||(r="https:"===e.protocol?"443":"80"),e.protocol+"//"+e.hostname+":"+r},isOriginEqual:function(t,e){var n=this.getOrigin(t)===this.getOrigin(e);return n},isSchemeEqual:function(t,
e){return t.split(":")[0]===e.split(":")[0]},addPath:function(t,e){var n=t.split("?");return n[0]+e+(n[1]?"?"+n[1]:"")},addQuery:function(t,e){return t+(-1===t.indexOf("?")?"?"+e:"\x26"+e)}}},{debug:void 0,"url-parse":56}],53:[function(t,e){e.exports="1.0.3"},{}],54:[function(t,e){e.exports="function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=
e.prototype,t.prototype=new n,t.prototype.constructor=t}},{}],55:[function(e,n,r){(function(e){(function(){function i(t,e){function n(t){if(n[t]!==m)return n[t];var i;if("bug-string-char-index"==t)i="a"!="a"[0];else if("json"==t)i=n("json-stringify")&&n("json-parse");else{var s,a='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var u=e.stringify,l="function"==typeof u&&g;if(l){(s=function(){return 1}).toJSON=s;try{l="0"===u(0)&&"0"===u(new r)&&'""'==u(new o)&&u(y)===m&&
u(m)===m&&u()===m&&"1"===u(s)&&"[1]"==u([s])&&"[null]"==u([m])&&"null"==u(null)&&"[null,null,null]"==u([m,y,null])&&u({a:[s,!0,!1,null,"\x00\b\n\f\r\t"]})==a&&"1"===u(null,s)&&"[\n 1,\n 2\n]"==u([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==u(new c(-864E13))&&'"+275760-09-13T00:00:00.000Z"'==u(new c(864E13))&&'"-000001-01-01T00:00:00.000Z"'==u(new c(-621987552E5))&&'"1969-12-31T23:59:59.999Z"'==u(new c(-1))}catch(f){l=!1}}i=l}if("json-parse"==t){var h=e.parse;if("function"==typeof h)try{if(0===
h("0")&&!h(!1)){s=h(a);var d=5==s.a.length&&1===s.a[0];if(d){try{d=!h('"\t"')}catch(f){}if(d)try{d=1!==h("01")}catch(f){}if(d)try{d=1!==h("1.")}catch(f){}}}}catch(f){d=!1}i=d}}return n[t]=!!i}t||(t=u.Object()),e||(e=u.Object());var r=t.Number||u.Number,o=t.String||u.String,a=t.Object||u.Object,c=t.Date||u.Date,l=t.SyntaxError||u.SyntaxError,f=t.TypeError||u.TypeError,h=t.Math||u.Math,d=t.JSON||u.JSON;"object"==typeof d&&d&&(e.stringify=d.stringify,e.parse=d.parse);var p,v,m,b=a.prototype,y=b.toString,
g=new c(-0xc782b5b800cec);try{g=-109252==g.getUTCFullYear()&&0===g.getUTCMonth()&&1===g.getUTCDate()&&10==g.getUTCHours()&&37==g.getUTCMinutes()&&6==g.getUTCSeconds()&&708==g.getUTCMilliseconds()}catch(w){}if(!n("json")){var x="[object Function]",_="[object Date]",E="[object Number]",S="[object String]",O="[object Array]",T="[object Boolean]",j=n("bug-string-char-index");if(!g)var C=h.floor,N=[0,31,59,90,120,151,181,212,243,273,304,334],A=function(t,e){return N[e]+365*(t-1970)+C((t-1969+(e=+(e>1)))/
4)-C((t-1901+e)/100)+C((t-1601+e)/400)};if((p=b.hasOwnProperty)||(p=function(t){var e,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?p=function(t){var e=this.__proto__,n=t in(this.__proto__=null,this);return this.__proto__=e,n}:(e=n.constructor,p=function(t){var n=(this.constructor||e).prototype;return t in this&&!(t in n&&this[t]===n[t])}),n=null,p.call(this,t)}),v=function(t,e){var n,r,i,o=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(i in r)p.call(r,i)&&
o++;return n=r=null,o?v=2==o?function(t,e){var n,r={},i=y.call(t)==x;for(n in t)i&&"prototype"==n||p.call(r,n)||!(r[n]=1)||!p.call(t,n)||e(n)}:function(t,e){var n,r,i=y.call(t)==x;for(n in t)i&&"prototype"==n||!p.call(t,n)||(r="constructor"===n)||e(n);(r||p.call(t,n="constructor"))&&e(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],v=function(t,e){var n,i,o=y.call(t)==x,a=!o&&"function"!=typeof t.constructor&&s[typeof t.hasOwnProperty]&&
t.hasOwnProperty||p;for(n in t)o&&"prototype"==n||!a.call(t,n)||e(n);for(i=r.length;n=r[--i];a.call(t,n)&&e(n));}),v(t,e)},!n("json-stringify")){var k={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},I="000000",L=function(t,e){return(I+(e||0)).slice(-t)},R="\\u00",U=function(t){for(var e='"',n=0,r=t.length,i=!j||r>10,o=i&&(j?t.split(""):t);r>n;n++){var s=t.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=k[s];break;default:if(32>s){e+=R+L(2,s.toString(16));
break}e+=i?o[n]:t.charAt(n)}}return e+'"'},P=function(t,e,n,r,i,o,s){var a,u,c,l,h,d,b,g,w,x,j,N,k,I,R,M;try{a=e[t]}catch(W){}if("object"==typeof a&&a)if(u=y.call(a),u!=_||p.call(a,"toJSON"))"function"==typeof a.toJSON&&(u!=E&&u!=S&&u!=O||p.call(a,"toJSON"))&&(a=a.toJSON(t));else if(a>-1/0&&1/0>a){if(A){for(h=C(a/864E5),c=C(h/365.2425)+1970-1;A(c+1,0)<=h;c++);for(l=C((h-A(c,0))/30.42);A(c,l+1)<=h;l++);h=1+h-A(c,l),d=(a%864E5+864E5)%864E5,b=C(d/36E5)%24,g=C(d/6E4)%60,w=C(d/1E3)%60,x=d%1E3}else c=a.getUTCFullYear(),
l=a.getUTCMonth(),h=a.getUTCDate(),b=a.getUTCHours(),g=a.getUTCMinutes(),w=a.getUTCSeconds(),x=a.getUTCMilliseconds();a=(0>=c||c>=1E4?(0>c?"-":"+")+L(6,0>c?-c:c):L(4,c))+"-"+L(2,l+1)+"-"+L(2,h)+"T"+L(2,b)+":"+L(2,g)+":"+L(2,w)+"."+L(3,x)+"Z"}else a=null;if(n&&(a=n.call(e,t,a)),null===a)return"null";if(u=y.call(a),u==T)return""+a;if(u==E)return a>-1/0&&1/0>a?""+a:"null";if(u==S)return U(""+a);if("object"==typeof a){for(I=s.length;I--;)if(s[I]===a)throw f();if(s.push(a),j=[],R=o,o+=i,u==O){for(k=0,
I=a.length;I>k;k++)N=P(k,a,n,r,i,o,s),j.push(N===m?"null":N);M=j.length?i?"[\n"+o+j.join(",\n"+o)+"\n"+R+"]":"["+j.join(",")+"]":"[]"}else v(r||a,function(t){var e=P(t,a,n,r,i,o,s);e!==m&&j.push(U(t)+":"+(i?" ":"")+e)}),M=j.length?i?"{\n"+o+j.join(",\n"+o)+"\n"+R+"}":"{"+j.join(",")+"}":"{}";return s.pop(),M}};e.stringify=function(t,e,n){var r,i,o,a;if(s[typeof e]&&e)if((a=y.call(e))==x)i=e;else if(a==O){o={};for(var u,c=0,l=e.length;l>c;u=e[c++],a=y.call(u),(a==S||a==E)&&(o[u]=1));}if(n)if((a=y.call(n))==
E){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else a==S&&(r=n.length<=10?n:n.slice(0,10));return P("",(u={},u[""]=t,u),i,o,r,"",[])}}if(!n("json-parse")){var M,W,q=o.fromCharCode,D={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},F=function(){throw M=W=null,l();},B=function(){for(var t,e,n,r,i,o=W,s=o.length;s>M;)switch(i=o.charCodeAt(M)){case 9:case 10:case 13:case 32:M++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=j?o.charAt(M):o[M],M++,t;case 34:for(t=
"@",M++;s>M;)if(i=o.charCodeAt(M),32>i)F();else if(92==i)switch(i=o.charCodeAt(++M)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=D[i],M++;break;case 117:for(e=++M,n=M+4;n>M;M++)i=o.charCodeAt(M),i>=48&&57>=i||i>=97&&102>=i||i>=65&&70>=i||F();t+=q("0x"+o.slice(e,M));break;default:F()}else{if(34==i)break;for(i=o.charCodeAt(M),e=M;i>=32&&92!=i&&34!=i;)i=o.charCodeAt(++M);t+=o.slice(e,M)}if(34==o.charCodeAt(M))return M++,t;F();default:if(e=M,45==i&&(r=!0,i=o.charCodeAt(++M)),
i>=48&&57>=i){for(48==i&&(i=o.charCodeAt(M+1),i>=48&&57>=i)&&F(),r=!1;s>M&&(i=o.charCodeAt(M),i>=48&&57>=i);M++);if(46==o.charCodeAt(M)){for(n=++M;s>n&&(i=o.charCodeAt(n),i>=48&&57>=i);n++);n==M&&F(),M=n}if(i=o.charCodeAt(M),101==i||69==i){for(i=o.charCodeAt(++M),(43==i||45==i)&&M++,n=M;s>n&&(i=o.charCodeAt(n),i>=48&&57>=i);n++);n==M&&F(),M=n}return+o.slice(e,M)}if(r&&F(),"true"==o.slice(M,M+4))return M+=4,!0;if("false"==o.slice(M,M+5))return M+=5,!1;if("null"==o.slice(M,M+4))return M+=4,null;F()}return"$"},
G=function(t){var e,n;if("$"==t&&F(),"string"==typeof t){if("@"==(j?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];t=B(),"]"!=t;n||(n=!0))n&&(","==t?(t=B(),"]"==t&&F()):F()),","==t&&F(),e.push(G(t));return e}if("{"==t){for(e={};t=B(),"}"!=t;n||(n=!0))n&&(","==t?(t=B(),"}"==t&&F()):F()),(","==t||"string"!=typeof t||"@"!=(j?t.charAt(0):t[0])||":"!=B())&&F(),e[t.slice(1)]=G(B());return e}F()}return t},J=function(t,e,n){var r=H(t,e,n);r===m?delete t[e]:t[e]=r},H=function(t,e,n){var r,i=t[e];
if("object"==typeof i&&i)if(y.call(i)==O)for(r=i.length;r--;)J(i,r,n);else v(i,function(t){J(i,t,n)});return n.call(t,e,i)};e.parse=function(t,e){var n,r;return M=0,W=""+t,n=G(B()),"$"!=B()&&F(),M=W=null,e&&y.call(e)==x?H((r={},r[""]=n,r),"",e):n}}}return e.runInContext=i,e}var o="function"==typeof t&&t.amd,s={"function":!0,object:!0},a=s[typeof r]&&r&&!r.nodeType&&r,u=s[typeof window]&&window||this,c=a&&s[typeof n]&&n&&!n.nodeType&&"object"==typeof e&&e;if(!c||c.global!==c&&c.window!==c&&c.self!==
c||(u=c),a&&!o)i(u,a);else{var l=u.JSON,f=u.JSON3,h=!1,d=i(u,u.JSON3={noConflict:function(){return h||(h=!0,u.JSON=l,u.JSON3=f,l=f=null),d}});u.JSON={parse:d.parse,stringify:d.stringify}}o&&t(function(){return d})}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],56:[function(t,e){function n(t,e,u){if(!(this instanceof n))return new n(t,e,u);var c,l,f,h,d=s.test(t),p=typeof e,v=this,m=0;for("object"!==p&&"string"!==
p&&(u=e,e=null),u&&"function"!=typeof u&&(u=o.parse),e=i(e);m<a.length;m++)l=a[m],c=l[0],h=l[1],c!==c?v[h]=t:"string"==typeof c?~(f=t.indexOf(c))&&("number"==typeof l[2]?(v[h]=t.slice(0,f),t=t.slice(f+l[2])):(v[h]=t.slice(f),t=t.slice(0,f))):(f=c.exec(t))&&(v[h]=f[1],t=t.slice(0,t.length-f[0].length)),v[h]=v[h]||(l[3]||"port"===h&&d?e[h]||"":""),l[4]&&(v[h]=v[h].toLowerCase());u&&(v.query=u(v.query)),r(v.port,v.protocol)||(v.host=v.hostname,v.port=""),v.username=v.password="",v.auth&&(l=v.auth.split(":"),
v.username=l[0]||"",v.password=l[1]||""),v.href=v.toString()}var r=t("requires-port"),i=t("./lolcation"),o=t("querystringify"),s=/^\/(?!\/)/,a=[["#","hash"],["?","query"],["//","protocol",2,1,1],["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/\:(\d+)$/,"port"],[NaN,"hostname",void 0,1,1]];n.prototype.set=function(t,e,n){var i=this;return"query"===t?("string"==typeof e&&(e=(n||o.parse)(e)),i[t]=e):"port"===t?(i[t]=e,r(e,i.protocol)?e&&(i.host=i.hostname+":"+e):(i.host=i.hostname,i[t]="")):
"hostname"===t?(i[t]=e,i.port&&(e+=":"+i.port),i.host=e):"host"===t?(i[t]=e,/\:\d+/.test(e)&&(e=e.split(":"),i.hostname=e[0],i.port=e[1])):i[t]=e,i.href=i.toString(),i},n.prototype.toString=function(t){t&&"function"==typeof t||(t=o.stringify);var e,n=this,r=n.protocol+"//";return n.username&&(r+=n.username,n.password&&(r+=":"+n.password),r+="@"),r+=n.hostname,n.port&&(r+=":"+n.port),r+=n.pathname,n.query&&(e="object"==typeof n.query?t(n.query):n.query,r+=("?"===e.charAt(0)?"":"?")+e),n.hash&&(r+=
n.hash),r},n.qs=o,n.location=i,e.exports=n},{"./lolcation":57,querystringify:58,"requires-port":59}],57:[function(t,e){(function(n){var r,i={hash:1,query:1};e.exports=function(e){e=e||n.location||{},r=r||t("./");var o,s={},a=typeof e;if("blob:"===e.protocol)s=new r(unescape(e.pathname),{});else if("string"===a){s=new r(e,{});for(o in i)delete s[o]}else if("object"===a)for(o in e)o in i||(s[o]=e[o]);return s}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=
typeof window?window:{})},{"./":56}],58:[function(t,e,n){function r(t){for(var e,n=/([^=?&]+)=([^&]*)/g,r={};e=n.exec(t);r[decodeURIComponent(e[1])]=decodeURIComponent(e[2]));return r}function i(t,e){e=e||"";var n=[];"string"!=typeof e&&(e="?");for(var r in t)o.call(t,r)&&n.push(encodeURIComponent(r)+"\x3d"+encodeURIComponent(t[r]));return n.length?e+n.join("\x26"):""}var o=Object.prototype.hasOwnProperty;n.stringify=i,n.parse=r},{}],59:[function(t,e){e.exports=function(t,e){if(e=e.split(":")[0],
t=+t,!t)return!1;switch(e){case "http":case "ws":return 80!==t;case "https":case "wss":return 443!==t;case "ftp":return 22!==t;case "gopher":return 70!==t;case "file":return!1}return 0!==t}},{}]},{},[1])(1)}),function(){var t,e,n,r,i={}.hasOwnProperty,o=[].slice;t={LF:"\n",NULL:"\x00"},n=function(){function e(t,e,n){this.command=t,this.headers=null!=e?e:{},this.body=null!=n?n:""}var n;return e.prototype.toString=function(){var n,r,o,s,a;n=[this.command],o=this.headers["content-length"]===!1?!0:!1,
o&&delete this.headers["content-length"],a=this.headers;for(r in a)i.call(a,r)&&(s=a[r],n.push(""+r+":"+s));return this.body&&!o&&n.push("content-length:"+e.sizeOfUTF8(this.body)),n.push(t.LF+this.body),n.join(t.LF)},e.sizeOfUTF8=function(t){return t?encodeURI(t).match(/%..|./g).length:0},n=function(n){var r,i,o,s,a,u,c,l,f,h,d,p,v,m,b,y,g;for(s=n.search(RegExp(""+t.LF+t.LF)),a=n.substring(0,s).split(t.LF),o=a.shift(),u={},p=function(t){return t.replace(/^\s+|\s+$/g,"")},y=a.reverse(),v=0,b=y.length;b>
v;v++)h=y[v],l=h.indexOf(":"),u[p(h.substring(0,l))]=p(h.substring(l+1));if(r="",d=s+2,u["content-length"])f=parseInt(u["content-length"]),r=(""+n).substring(d,d+f);else for(i=null,c=m=d,g=n.length;(g>=d?g>m:m>g)&&(i=n.charAt(c),i!==t.NULL);c=g>=d?++m:--m)r+=i;return new e(o,u,r)},e.unmarshall=function(e){var r;return function(){var i,o,s,a;for(s=e.split(RegExp(""+t.NULL+t.LF+"*")),a=[],i=0,o=s.length;o>i;i++)r=s[i],(null!=r?r.length:void 0)>0&&a.push(n(r));return a}()},e.marshall=function(n,r,i){var o;
return o=new e(n,r,i),o.toString()+t.NULL},e}(),e=function(){function e(t){this.ws=t,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1E4,incoming:1E4},this.maxWebSocketFrameSize=16384,this.subscriptions={}}var i;return e.prototype.debug=function(t){var e;return"undefined"!=typeof window&&null!==window?(null!=(e=window.console),void 0):void 0},i=function(){return Date.now?Date.now():(new Date).valueOf},e.prototype._transmit=function(t,e,r){var i;for(i=n.marshall(t,
e,r),"function"==typeof this.debug&&this.debug("\x3e\x3e\x3e "+i);;){if(!(i.length>this.maxWebSocketFrameSize))return this.ws.send(i);this.ws.send(i.substring(0,this.maxWebSocketFrameSize)),i=i.substring(this.maxWebSocketFrameSize),"function"==typeof this.debug&&this.debug("remaining \x3d "+i.length)}},e.prototype._setupHeartbeat=function(e){var n,o,s,a,u,c;if((u=e.version)===r.VERSIONS.V1_1||u===r.VERSIONS.V1_2)return c=function(){var t,n,r,i;for(r=e["heart-beat"].split(","),i=[],t=0,n=r.length;n>
t;t++)a=r[t],i.push(parseInt(a));return i}(),o=c[0],n=c[1],0!==this.heartbeat.outgoing&&0!==n&&(s=Math.max(this.heartbeat.outgoing,n),"function"==typeof this.debug&&this.debug("send PING every "+s+"ms"),this.pinger=r.setInterval(s,function(e){return function(){return e.ws.send(t.LF),"function"==typeof e.debug?e.debug("\x3e\x3e\x3e PING"):void 0}}(this))),0!==this.heartbeat.incoming&&0!==o?(s=Math.max(this.heartbeat.incoming,o),"function"==typeof this.debug&&this.debug("check PONG every "+s+"ms"),
this.ponger=r.setInterval(s,function(t){return function(){var e;return e=i()-t.serverActivity,e>2*s?("function"==typeof t.debug&&t.debug("did not receive server activity for the last "+e+"ms"),t.ws.close()):void 0}}(this))):void 0},e.prototype._parseConnect=function(){var t,e,n,r;switch(t=1<=arguments.length?o.call(arguments,0):[],r={},t.length){case 2:r=t[0],e=t[1];break;case 3:t[1]instanceof Function?(r=t[0],e=t[1],n=t[2]):(r.login=t[0],r.passcode=t[1],e=t[2]);break;case 4:r.login=t[0],r.passcode=
t[1],e=t[2],n=t[3];break;default:r.login=t[0],r.passcode=t[1],e=t[2],n=t[3],r.host=t[4]}return[r,e,n]},e.prototype.connect=function(){var e,s,a,u;return e=1<=arguments.length?o.call(arguments,0):[],u=this._parseConnect.apply(this,e),a=u[0],this.connectCallback=u[1],s=u[2],"function"==typeof this.debug&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(e){return function(r){var o,a,u,c,l,f,h,d,p,v,m,b;if(c="undefined"!=typeof ArrayBuffer&&r.data instanceof ArrayBuffer?(o=new Uint8Array(r.data),
"function"==typeof e.debug?e.debug("--- got data length: "+o.length):void 0,function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)a=o[t],n.push(String.fromCharCode(a));return n}().join("")):r.data,e.serverActivity=i(),c===t.LF)return void("function"==typeof e.debug&&e.debug("\x3c\x3c\x3c PONG"));for("function"==typeof e.debug&&e.debug("\x3c\x3c\x3c "+c),m=n.unmarshall(c),b=[],p=0,v=m.length;v>p;p++)switch(l=m[p],l.command){case "CONNECTED":"function"==typeof e.debug&&e.debug("connected to server "+
l.headers.server),e.connected=!0,e._setupHeartbeat(l.headers),b.push("function"==typeof e.connectCallback?e.connectCallback(l):void 0);break;case "MESSAGE":d=l.headers.subscription,h=e.subscriptions[d]||e.onreceive,h?(u=e,f=l.headers["message-id"],l.ack=function(t){return null==t&&(t={}),u.ack(f,d,t)},l.nack=function(t){return null==t&&(t={}),u.nack(f,d,t)},b.push(h(l))):b.push("function"==typeof e.debug?e.debug("Unhandled received MESSAGE: "+l):void 0);break;case "RECEIPT":b.push("function"==typeof e.onreceipt?
e.onreceipt(l):void 0);break;case "ERROR":b.push("function"==typeof s?s(l):void 0);break;default:b.push("function"==typeof e.debug?e.debug("Unhandled frame: "+l):void 0)}return b}}(this),this.ws.onclose=function(t){return function(){var e;return e="Whoops! Lost connection to "+t.ws.url,"function"==typeof t.debug&&t.debug(e),t._cleanUp(),"function"==typeof s?s(e):void 0}}(this),this.ws.onopen=function(t){return function(){return"function"==typeof t.debug&&t.debug("Web Socket Opened..."),a["accept-version"]=
r.VERSIONS.supportedVersions(),a["heart-beat"]=[t.heartbeat.outgoing,t.heartbeat.incoming].join(","),t._transmit("CONNECT",a)}}(this)},e.prototype.disconnect=function(t,e){return null==e&&(e={}),this._transmit("DISCONNECT",e),this.ws.onclose=null,this.ws.close(),this._cleanUp(),"function"==typeof t?t():void 0},e.prototype._cleanUp=function(){return this.connected=!1,this.pinger&&r.clearInterval(this.pinger),this.ponger?r.clearInterval(this.ponger):void 0},e.prototype.send=function(t,e,n){return null==
e&&(e={}),null==n&&(n=""),e.destination=t,this._transmit("SEND",e,n)},e.prototype.subscribe=function(t,e,n){var r;return null==n&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=t,this.subscriptions[n.id]=e,this._transmit("SUBSCRIBE",n),r=this,{id:n.id,unsubscribe:function(){return r.unsubscribe(n.id)}}},e.prototype.unsubscribe=function(t){return delete this.subscriptions[t],this._transmit("UNSUBSCRIBE",{id:t})},e.prototype.begin=function(t){var e,n;return n=t||"tx-"+this.counter++,this._transmit("BEGIN",
{transaction:n}),e=this,{id:n,commit:function(){return e.commit(n)},abort:function(){return e.abort(n)}}},e.prototype.commit=function(t){return this._transmit("COMMIT",{transaction:t})},e.prototype.abort=function(t){return this._transmit("ABORT",{transaction:t})},e.prototype.ack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("ACK",n)},e.prototype.nack=function(t,e,n){return null==n&&(n={}),n["message-id"]=t,n.subscription=e,this._transmit("NACK",n)},e}(),
r={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(t,n){var i,o;return null==n&&(n=["v10.stomp","v11.stomp"]),i=r.WebSocketClass||WebSocket,o=new i(t,n),new e(o)},over:function(t){return new e(t)},Frame:n},"undefined"!=typeof exports&&null!==exports&&(exports.Stomp=r),"undefined"!=typeof window&&null!==window?(r.setInterval=function(t,e){return window.setInterval(e,t)},r.clearInterval=function(t){return window.clearInterval(t)},window.Stomp=
r):exports||(self.Stomp=r)}.call(this);var w=window,d=document;var MCK_LABELS;var MCK_BASE_URL;var MCK_CURR_LATITIUDE=40.7324319;var MCK_CURR_LONGITUDE=-73.82480777777776;var mckUtils=new MckUtils;var mckDateUtils=new MckDateUtils;var mckContactUtils=new MckContactUtils;var mckMapUtils=new MckMapUtils;
function MckUtils(){var _this=this;var TEXT_NODE=3,ELEMENT_NODE=1,TAGS_BLOCK=["p","div","pre","form"];_this.init=function(){$applozic.ajax({url:MCK_BASE_URL?MCK_BASE_URL+"/v2/tab/initialize.page":"https://apps.applozic.com/v2/tab/initialize.page",contentType:"application/json",type:"OPTIONS"}).done(function(data){});$applozic.ajax({url:MCK_BASE_URL?MCK_BASE_URL+"/rest/ws/message/list":"https://apps.applozic.com/rest/ws/message/list",contentType:"application/json",type:"OPTIONS"}).done(function(data){})};
_this.showElement=function(element){if(element){element.classList.remove("n-vis");element.classList.add("vis")}};_this.hideElement=function(element){if(element){element.classList.remove("vis");element.classList.add("n-vis")}};_this.badgeCountOnLaucher=function(enablebadgecount,totalunreadCount){var element=document.getElementById("applozic-badge-count");if(enablebadgecount===true&&totalunreadCount>0){element.innerHTML=totalunreadCount;element.classList.add("mck-badge-count")}if(enablebadgecount===
true&&totalunreadCount===0){element.innerHTML="";element.classList.remove("mck-badge-count")}};_this.randomId=function(){return w.Math.random().toString(36).substring(7)};_this.textVal=function($element){var lines=[];var line=[];var flush=function(){lines.push(line.join(""));line=[]};var sanitizeNode=function(node){if(node.nodeType===TEXT_NODE)line.push(node.nodeValue);else if(node.nodeType===ELEMENT_NODE){var tagName=node.tagName.toLowerCase();var isBlock=TAGS_BLOCK.indexOf(tagName)!==-1;if(isBlock&&
line.length)flush();if(tagName==="img"){var alt=node.getAttribute("alt")||"";if(alt)line.push(alt);return}else if(tagName==="style")return;else if(tagName==="br")flush();var children=node.childNodes;for(var i=0;i<children.length;i++)sanitizeNode(children[i]);if(isBlock&&line.length)flush()}};var children=$element.childNodes;for(var i=0;i<children.length;i++)sanitizeNode(children[i]);if(line.length)flush();return lines.join("\n")};_this.mouseX=function(evt){if(evt.pageX)return evt.pageX;else if(evt.clientX)return evt.clientX+
(d.documentElement.scrollLeft?d.documentElement.scrollLeft:d.body.scrollLeft);else return null};_this.mouseY=function(evt){if(evt.pageY)return evt.pageY;else if(evt.clientY)return evt.clientY+(d.documentElement.scrollTop?d.documentElement.scrollTop:d.body.scrollTop);else return null};_this.startsWith=function(matcher,str){if(str===null||typeof matcher==="undefined")return false;var i=str.length;if(matcher.length<i)return false;for(--i;i>=0&&matcher[i]===str[i];--i)continue;return i<0};_this.setEndOfContenteditable=
function(contentEditableElement){var range,selection;if(document.createRange){range=document.createRange();range.selectNodeContents(contentEditableElement);range.collapse(false);selection=window.getSelection();selection.removeAllRanges();selection.addRange(range)}else if(document.selection){range=document.body.createTextRange();range.moveToElementText(contentEditableElement);range.collapse(false);range.select()}};this.encryptionKey=null;this.getEncryptionKey=function(){return this.encryptionKey};
this.setEncryptionKey=function(key){this.encryptionKey=key};_this.b64EncodeUnicode=function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))};_this.b64DecodeUnicode=function(str){return decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))};_this.ajax=function(options){var reqOptions=$applozic.extend({},{},options);if(this.getEncryptionKey()){var key=
aesjs.util.convertStringToBytes(this.getEncryptionKey());var iv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];if(reqOptions.type.toLowerCase()==="post"){while(options.data.length%16!=0)options.data+=" ";var aesCtr=new aesjs.ModeOfOperation.ecb(key);var bytes=aesjs.util.convertStringToBytes(options.data);var encryptedBytes=aesCtr.encrypt(bytes);var encryptedStr=String.fromCharCode.apply(null,encryptedBytes);reqOptions.data=btoa(encryptedStr)}reqOptions.success=function(data){var decodedData=atob(data);var arr=
[];for(var i=0;i<decodedData.length;i++)arr.push(decodedData.charCodeAt(i));var aesCtr=new aesjs.ModeOfOperation.ecb(key);var decryptedBytes=aesCtr.decrypt(arr);var res=aesjs.util.convertBytesToString(decryptedBytes);res=res.replace(/\\u0000/g,"").replace(/^\s*|\s*[\x00-\x10]*$/g,"");if(_this.isJsonString(res))options.success(JSON.parse(res));else options.success(res)}}$applozic.ajax(reqOptions)};_this.isJsonString=function(str){try{JSON.parse(str)}catch(e){return false}return true}}
function MckContactUtils(){var _this=this;_this.getContactId=function(contact){var contactId=contact.contactId;return _this.formatContactId(contactId)};_this.formatContactId=function(contactId){if(contactId.indexOf("+")===0)contactId=contactId.substring(1);contactId=decodeURIComponent(contactId);return $applozic.trim(contactId.replace(/\@/g,"AT").replace(/\./g,"DOT").replace(/\*/g,"STAR").replace(/\#/g,"HASH").replace(/\|/g,"VBAR").replace(/\+/g,"PLUS").replace(/\;/g,"SCOLON").replace(/\?/g,"QMARK").replace(/\,/g,
"COMMA").replace(/\:/g,"COLON"))}}function MckMapUtils(){var _this=this;_this.getCurrentLocation=function(succFunc,errFunc){w.navigator.geolocation.getCurrentPosition(succFunc,errFunc)};_this.getSelectedLocation=function(){return{lat:MCK_CURR_LATITIUDE,lon:MCK_CURR_LONGITUDE}}}
function MckDateUtils(){var _this=this;var fullDateFormat="mmm d, h:MM TT";var onlyDateFormat="mmm d";var onlyTimeFormat="h:MM TT";var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];_this.getDate=function(createdAtTime){var date=new Date(parseInt(createdAtTime,10));var currentDate=new Date;return currentDate.getDate()===date.getDate()&&currentDate.getMonth()===date.getMonth()&&currentDate.getYear()===date.getYear()?dateFormat(date,onlyTimeFormat,false):dateFormat(date,
fullDateFormat,false)};_this.getLastSeenAtStatus=function(lastSeenAtTime){var date=new Date(parseInt(lastSeenAtTime,10));var currentDate=new Date;if(currentDate.getDate()===date.getDate()&&currentDate.getMonth()===date.getMonth()&&currentDate.getYear()===date.getYear()){var hoursDiff=currentDate.getHours()-date.getHours();var timeDiff=w.Math.floor((currentDate.getTime()-date.getTime())/6E4);if(timeDiff<60)return timeDiff<=1?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS["min"]+" "+MCK_LABELS["ago"]:MCK_LABELS["last.seen"]+
" "+timeDiff+MCK_LABELS["mins"]+" "+MCK_LABELS["ago"];return hoursDiff===1?MCK_LABELS["last.seen"]+" 1 "+MCK_LABELS["hour"]+" "+MCK_LABELS["ago"]:MCK_LABELS["last.seen"]+" "+hoursDiff+MCK_LABELS["hours"]+" "+MCK_LABELS["ago"]}else if(currentDate.getDate()-date.getDate()===1&&currentDate.getMonth()===date.getMonth()&&currentDate.getYear()===date.getYear())return MCK_LABELS["last.seen.on"]+" "+MCK_LABELS["yesterday"];else return MCK_LABELS["last.seen.on"]+" "+dateFormat(date,onlyDateFormat,false)};
_this.getTimeOrDate=function(createdAtTime,timeFormat){var date=new Date(parseInt(createdAtTime,10));var currentDate=new Date;if(timeFormat)return currentDate.getDate()===date.getDate()&&currentDate.getMonth()===date.getMonth()&&currentDate.getYear()===date.getYear()?dateFormat(date,onlyTimeFormat,false):dateFormat(date,onlyDateFormat,false);else return dateFormat(date,fullDateFormat,false)};_this.getSystemDate=function(time){var date=new Date(parseInt(time,10));return dateFormat(date,fullDateFormat,
false)};_this.convertMilisIntoTime=function(millisec){var duration;var milliseconds=parseInt(millisec%1E3/100),seconds=parseInt(millisec/1E3%60),minutes=parseInt(millisec/(1E3*60)%60),hours=parseInt(millisec/(1E3*60*60)%24);if(hours>0)duration=hours+" Hr "+minutes+" Min "+seconds+" Sec";else if(minutes>0)duration=minutes+" Min "+seconds+" Sec";else duration=seconds+" Sec ";return duration};var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=
/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val};return function(date,mask,utc){var dF=dateFormat;if(arguments.length===1&&Object.prototype.toString.call(date)==="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}date=date?new Date(date):new Date;if(isNaN(date))throw SyntaxError("invalid date");
mask=String(mask);if(mask.slice(0,4)==="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||
12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?w.Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(w.Math.floor(w.Math.abs(o)/60)*100+w.Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!==10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"mmm d, yyyy h:MM TT",
fullDateFormat:"mmm d, yyyy h:MM TT",onlyDateFormat:"mmm d",onlyTimeFormat:"h:MM TT",mailDateFormat:"mmm d, yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday",
"Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]}}(function(window){function define_Applozic(){var Applozic={};Applozic.init=function(){};return Applozic}if(typeof Applozic==="undefined")window.Applozic=define_Applozic();else console.log("Applozic already defined.")})(window);
var ALStorage=function(win){var MCK_LATEST_MESSAGE_ARRAY=[];var MCK_MESSAGE_ARRAY=[];var MCK_MESSAGE_MAP=[];var MCK_CONTACT_NAME_ARRAY=[];var FRIEND_LIST_GROUP_NAME;var FRIEND_LIST_GROUP_TYPE;return{updateLatestMessage:function(message){var messageArray=[];messageArray.push(message);ALStorage.updateLatestMessageArray(messageArray);ALStorage.updateMckMessageArray(messageArray)},getLatestMessageArray:function(){return typeof w.sessionStorage!=="undefined"?$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray")):
MCK_LATEST_MESSAGE_ARRAY},getFriendListGroupName:function(){return typeof w.sessionStorage!=="undefined"?w.sessionStorage.getItem("friendListGroupName"):FRIEND_LIST_GROUP_NAME},setFriendListGroupName:function(friendListGroupName){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("friendListGroupName",friendListGroupName);else FRIEND_LIST_GROUP_NAME=friendListGroupName},setFriendListGroupType:function(friendListGroupType){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("friendListGroupType",
friendListGroupType);else FRIEND_LIST_GROUP_TYPE=friendListGroupType},getFriendListGroupType:function(){return typeof w.sessionStorage!=="undefined"?w.sessionStorage.getItem("friendListGroupType"):FRIEND_LIST_GROUP_TYPE},setLatestMessageArray:function(messages){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(messages));else MCK_LATEST_MESSAGE_ARRAY=messages},updateLatestMessageArray:function(mckMessageArray){if(typeof w.sessionStorage!=="undefined"){var mckLocalMessageArray=
$applozic.parseJSON(w.sessionStorage.getItem("mckLatestMessageArray"));if(mckLocalMessageArray!==null){mckLocalMessageArray=mckLocalMessageArray.concat(mckMessageArray);w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(mckLocalMessageArray))}else w.sessionStorage.setItem("mckLatestMessageArray",w.JSON.stringify(mckMessageArray));return mckMessageArray}else{MCK_LATEST_MESSAGE_ARRAY=MCK_LATEST_MESSAGE_ARRAY.concat(mckMessageArray);return MCK_LATEST_MESSAGE_ARRAY}},getMckMessageArray:function(){return typeof w.sessionStorage!==
"undefined"?$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray")):MCK_MESSAGE_ARRAY},clearMckMessageArray:function(){if(typeof w.sessionStorage!=="undefined"){w.sessionStorage.removeItem("mckMessageArray");w.sessionStorage.removeItem("mckLatestMessageArray")}else{MCK_MESSAGE_ARRAY.length=0;MCK_LATEST_MESSAGE_ARRAY.length=0}},clearAppHeaders:function(){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.removeItem("mckAppHeaders")},setAppHeaders:function(data){if(typeof w.sessionStorage!==
"undefined")w.sessionStorage.setItem("mckAppHeaders",w.JSON.stringify(data))},getAppHeaders:function(data){return typeof w.sessionStorage!=="undefined"?$applozic.parseJSON(w.sessionStorage.getItem("mckAppHeaders")):{}},getMessageByKey:function(key){return MCK_MESSAGE_MAP[key]},updateMckMessageArray:function(mckMessageArray){for(var i=0;i<mckMessageArray.length;i++){var message=mckMessageArray[i];MCK_MESSAGE_MAP[message.key]=message}if(typeof w.sessionStorage!=="undefined"){var mckLocalMessageArray=
$applozic.parseJSON(w.sessionStorage.getItem("mckMessageArray"));if(mckLocalMessageArray!==null){mckLocalMessageArray=mckLocalMessageArray.concat(mckMessageArray);w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(mckLocalMessageArray))}else w.sessionStorage.setItem("mckMessageArray",w.JSON.stringify(mckMessageArray));return mckMessageArray}else{MCK_MESSAGE_ARRAY=MCK_MESSAGE_ARRAY.concat(mckMessageArray);return MCK_MESSAGE_ARRAY}},getMckContactNameArray:function(){return typeof w.sessionStorage!==
"undefined"?$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray")):MCK_CONTACT_NAME_ARRAY},setMckContactNameArray:function(mckContactNameArray){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(mckContactNameArray));else MCK_CONTACT_NAME_ARRAY=mckContactNameArray},updateMckContactNameArray:function(mckContactNameArray){if(typeof w.sessionStorage!=="undefined"){var mckLocalcontactNameArray=$applozic.parseJSON(w.sessionStorage.getItem("mckContactNameArray"));
if(mckLocalcontactNameArray!==null)mckContactNameArray=mckContactNameArray.concat(mckLocalcontactNameArray);w.sessionStorage.setItem("mckContactNameArray",w.JSON.stringify(mckContactNameArray));return mckContactNameArray}else{MCK_CONTACT_NAME_ARRAY=MCK_CONTACT_NAME_ARRAY.concat(mckContactNameArray);return MCK_CONTACT_NAME_ARRAY}},clearMckContactNameArray:function(){if(typeof w.sessionStorage!=="undefined")w.sessionStorage.removeItem("mckContactNameArray");else MCK_CONTACT_NAME_ARRAY.length=0}}}(window);
(function(window){function define_ALApiService(getBaseUrl){var ALApiService={};var MCK_APP_ID="";var mckUtils=new MckUtils;var MCK_BASE_URL="https://apps.applozic.com";var INITIALIZE_APP_URL="/v2/tab/initialize.page";var MESSAGE_LIST_URL="/rest/ws/message/list";var MESSAGE_SEND_URL="/rest/ws/message/send";var GROUP_CREATE_URL="/rest/ws/group/create";var GROUP_LIST_URL="/rest/ws/group/list";var GROUP_INFO_URL="/rest/ws/group/v2/info";var GROUP_ADD_MEMBER_URL="/rest/ws/group/add/member";var GROUP_REMOVE_MEMBER_URL=
"/rest/ws/group/remove/member";var GROUP_LEFT_URL="/rest/ws/group/left";var GROUP_UPDATE_URL="/rest/ws/group/update";var GROUP_IS_USER_PRESENT_URL="/rest/ws/group/check/user";var GROUP_USER_COUNT_URL="/rest/ws/group/user/count";var FRIEND_LIST_URL="/rest/ws/group/";var GET_USER_DETAIL_URL="/rest/ws/user/v2/detail";var UPDATE_USER_DETAIL_URL="/rest/ws/user/update";var USER_FILTER="/rest/ws/user/filter";var LOGOUT="/rest/ws/device/logout";var USER_FILTER_BY_ROLE="/rest/ws/user/v3/filter";var USER_BLOCK_URL=
"/rest/ws/user/block";var USER_UNBLOCK_URL="/rest/ws/user/unblock";var UPDATE_PASSWORD_URL="/rest/ws/user/update/password";var UPDATE_REPLY_MAP="/rest/ws/message/detail";var MESSAGE_DELETE_URL="/rest/ws/message/delete";var MESSAGE_READ_UPDATE_URL="/rest/ws/message/read";var MESSAGE_DELIVERY_UPDATE_URL="/rest/ws/message/delivered";var CONVERSATION_CLOSE_UPDATE_URL="/rest/ws/conversation/close";var FILE_PREVIEW_URL="/rest/ws/aws/file";var FILE_UPLOAD_URL="/rest/ws/aws/file/url";var FILE_AWS_UPLOAD_URL=
"/rest/ws/upload/file";var FILE_DELETE_URL="/rest/ws/aws/file/delete";var MESSAGE_ADD_INBOX_URL="/rest/ws/message/add/inbox";var CONVERSATION_READ_UPDATE_URL="/rest/ws/message/read/conversation";var CONVERSATION_DELETE_URL="/rest/ws/message/delete/conversation";var ONE_TO_ONE_MUTE_URL="/rest/ws/user/chat/mute";var GROUP_MUTE_URL="/rest/ws/group/user/update";var REGISTER_CLIENT_URL="/rest/ws/register/client";var SYNC_MUTE_USER_URL="/rest/ws/user/chat/mute/list";var TOPIC_ID_URL="/rest/ws/conversation/topicId";
var CONTACT_NAME_URL="/rest/ws/user/info";var USER_STATUS_URL="/rest/ws/user/chat/status";var CONVERSATION_FETCH_URL="/rest/ws/conversation/get";var CONVERSATION_ID_URL="/rest/ws/conversation/id";var FILE_AWS_UPLOAD_URL="/rest/ws/upload/file";var ATTACHMENT_UPLOAD_URL="/rest/ws/upload/image";var MCK_SW_REGISTER_URL="/rest/ws/plugin/update/sw/id";var ACCESS_TOKEN;var DEVICE_KEY;var APP_MODULE_NAME;var AUTH_CODE;function getAsUriParameters(data){var url="";for(var prop in data)url+=encodeURIComponent(prop)+
"\x3d"+encodeURIComponent(data[prop])+"\x26";return url.substring(0,url.length-1)}ALApiService.initServerUrl=function(serverUrl){MCK_BASE_URL=serverUrl};ALApiService.login=function(options){MCK_APP_ID=options.data.alUser.applicationId;MCK_BASE_URL=options.data.baseUrl?options.data.baseUrl:"https://apps.applozic.com";ALApiService.ajax({url:MCK_BASE_URL+INITIALIZE_APP_URL,type:"post",async:typeof options.async!=="undefined"?options.async:true,data:JSON.stringify(options.data.alUser),contentType:"application/json",
headers:{"Application-Key":MCK_APP_ID},success:function(response){mckUtils.setEncryptionKey(response.encryptionKey);AUTH_CODE=btoa(response.userId+":"+response.deviceKey);DEVICE_KEY=response.deviceKey;ACCESS_TOKEN=options.data.alUser.password;APP_MODULE_NAME=options.data.alUser.appModuleName;ALApiService.setAjaxHeaders(AUTH_CODE,MCK_APP_ID,response.deviceKey,options.data.alUser.password,options.data.alUser.appModuleName);if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};
ALApiService.getAttachmentHeaders=function(){var headers={"UserId-Enabled":true,"Authorization":"Basic "+AUTH_CODE,"Application-Key":MCK_APP_ID,"Device-Key":DEVICE_KEY};if(ACCESS_TOKEN)headers["Access-Token"]=ACCESS_TOKEN;return headers},ALApiService.setAjaxHeaders=function(authcode,appId,devKey,accToken,modName){MCK_APP_ID=appId;AUTH_CODE=authcode;DEVICE_KEY=devKey;ACCESS_TOKEN=accToken;APP_MODULE_NAME=modName};ALApiService.ajax=function(options){function extend(){for(var i=1;i<arguments.length;i++)for(var key in arguments[i])if(arguments[i].hasOwnProperty(key))arguments[0][key]=
arguments[i][key];return arguments[0]}var reqOptions=extend({},{},options);if(mckUtils.getEncryptionKey()){var key=aesjs.util.convertStringToBytes(this.getEncryptionKey());var iv=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];if(reqOptions.type.toLowerCase()==="post"){while(options.data.length%16!=0)options.data+=" ";var aesCtr=new aesjs.ModeOfOperation.ecb(key);var bytes=aesjs.util.convertStringToBytes(options.data);var encryptedBytes=aesCtr.encrypt(bytes);var encryptedStr=String.fromCharCode.apply(null,encryptedBytes);
reqOptions.data=btoa(encryptedStr)}reqOptions.success=function(data){var decodedData=atob(data);var arr=[];for(var i=0;i<decodedData.length;i++)arr.push(decodedData.charCodeAt(i));var aesCtr=new aesjs.ModeOfOperation.ecb(key);var decryptedBytes=aesCtr.decrypt(arr);var res=aesjs.util.convertBytesToString(decryptedBytes);res=res.replace(/\\u0000/g,"").replace(/^\s*|\s*[\x00-\x10]*$/g,"");if(_this.isJsonString(res))options.success(JSON.parse(res));else options.success(res)}}var request=new XMLHttpRequest;
var responsedata;var asyn=true;var cttype;if(typeof reqOptions.async!=="undefined"||options.async)asyn=reqOptions.async;var typ=reqOptions.type.toUpperCase();if(typ==="GET"&&typeof reqOptions.data!=="undefined")reqOptions.url=reqOptions.url+"?"+reqOptions.data;request.open(typ,reqOptions.url,asyn);if(typ==="POST"||typ==="GET"){if(typeof reqOptions.contentType==="undefined")cttype="application/x-www-form-urlencoded; charset\x3dUTF-8";else cttype=reqOptions.contentType;request.setRequestHeader("Content-Type",
cttype)}MCK_BASE_URL=MCK_BASE_URL?MCK_BASE_URL:"https://apps.applozic.com";if(reqOptions.url.indexOf(MCK_BASE_URL)!==-1){request.setRequestHeader("UserId-Enabled",true);if(AUTH_CODE)request.setRequestHeader("Authorization","Basic "+AUTH_CODE);request.setRequestHeader("Application-Key",MCK_APP_ID);if(DEVICE_KEY)request.setRequestHeader("Device-Key",DEVICE_KEY);if(ACCESS_TOKEN)request.setRequestHeader("Access-Token",ACCESS_TOKEN);if(APP_MODULE_NAME)request.setRequestHeader("App-Module-Name",APP_MODULE_NAME)}if(typeof reqOptions.data===
"undefined")request.send();else request.send(reqOptions.data);request.onreadystatechange=function(){if(request.readyState===XMLHttpRequest.DONE)if(request.status===200){var contType=request.getResponseHeader("Content-Type");if(typeof contType==="undefined"||contType==="null"||contType===null)contType="";if(contType.toLowerCase().indexOf("text/html")!=-1)responsedata=request.responseXML;else if(contType.toLowerCase().indexOf("application/json")!=-1)responsedata=JSON.parse(request.responseText);else responsedata=
request.responseText;reqOptions.success(responsedata)}else reqOptions.error(responsedata)}};ALApiService.getMessages=function(options){if(options.data.userId||options.data.groupId){if(options.data.pageSize==="undefined")options.data.pageSize=30}else if(typeof options.data.mainPageSize==="undefined")options.data.mainPageSize=60;var data=getAsUriParameters(options.data);var response=new Object;ALApiService.ajax({url:MCK_BASE_URL+MESSAGE_LIST_URL+"?"+data,async:typeof options.async!=="undefined"?options.async:
true,type:"get",success:function(data){response.status="success";response.data=data;if(options.success)options.success(response);return},error:function(xhr,desc,err){response.status="error";if(options.error)options.error(response)}})};ALApiService.sendMessage=function(options){ALApiService.ajax({type:"POST",url:MCK_BASE_URL+MESSAGE_SEND_URL,global:false,data:JSON.stringify(options.data.message),async:typeof options.async!=="undefined"?options.async:true,contentType:"application/json",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.sendDeliveryUpdate=function(options){ALApiService.ajax({url:MCK_BASE_URL+MESSAGE_DELIVERY_UPDATE_URL,data:"key\x3d"+options.data.key,global:false,type:"get",async:typeof options.async!=="undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.sendReadUpdate=function(options){ALApiService.ajax({url:MCK_BASE_URL+
MESSAGE_READ_UPDATE_URL,data:"key\x3d"+options.data.key,global:false,type:"get",async:typeof options.async!=="undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.deleteMessage=function(options){ALApiService.ajax({url:MCK_BASE_URL+MESSAGE_DELETE_URL+"?key\x3d"+options.data.key,global:false,type:"get",async:typeof options.async!=="undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.updateReplyMessage=function(options){ALApiService.ajax({url:MCK_BASE_URL+UPDATE_REPLY_MAP+"?keys\x3d"+options.data.key,type:"get",async:typeof options.async!=="undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.deleteConversation=function(options){ALApiService.ajax({url:MCK_BASE_URL+
CONVERSATION_DELETE_URL,type:"get",async:typeof options.async!=="undefined"?options.async:true,global:false,data:getAsUriParameters(options.data),success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.createGroup=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_CREATE_URL,global:false,data:JSON.stringify(options.data.group),type:"post",async:typeof options.async!=="undefined"?options.async:
true,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.loadGroups=function(options){if(options.baseUrl)MCK_BASE_URL=options.baseUrl;ALApiService.ajax({url:MCK_BASE_URL+GROUP_LIST_URL,type:"get",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};
ALApiService.getGroupInfo=function(options){var groupId=options.data.group.groupId?"?groupId\x3d"+options.data.group.groupId:"?clientGroupId\x3d"+options.group.clientGroupId;ALApiService.ajax({url:MCK_BASE_URL+GROUP_INFO_URL+groupId,type:"get",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.addGroupMember=function(options){ALApiService.ajax({url:MCK_BASE_URL+
GROUP_ADD_MEMBER_URL,type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.removeGroupMember=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_REMOVE_MEMBER_URL,type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!==
"undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.groupLeave=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_LEFT_URL,type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.groupUpdate=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_UPDATE_URL,type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response,options.data.group)},error:function(response){if(options.error)options.error(response)}})};ALApiService.isUserPresentInGroup=
function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_IS_USER_PRESENT_URL+"?userId\x3d"+options.data.userId+"\x26clientGroupId\x3d"+options.data.clientGroupId,type:"get",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.groupUserCount=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_USER_COUNT_URL+"?clientGroupIds\x3d"+
options.data.clientGroupId,type:"get",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.groupDelete=function(options){ALApiService.ajax({url:MCK_BASE_URL+GROUP_LEFT_URL+"?clientGroupId\x3d"+options.data.clientGroupId,type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.createUserFriendList=function(options){ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.data.group.groupName+"/add/",type:"POST",async:typeof options.async!=="undefined"?options.async:true,global:false,data:JSON.stringify(options.data.group.groupMemberList),contentType:"application/json",success:function(response){if(options.success){options.success(response);ALStorage.setFriendListGroupName(options.data.group.groupName)}},
error:function(response){if(options.error)options.error(response)}})};ALApiService.createOpenFriendList=function(options){ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.data.group.groupName+"/add/members",type:"POST",data:JSON.stringify(options.data.group),async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success){options.success(response);ALStorage.setFriendListGroupName(options.data.group.groupName);
ALStorage.setFriendListGroupType(options.data.group.type)}},error:function(response){if(options.error)options.error(response)}})};ALApiService.getFriendList=function(options){var getFriendListUrl=options.data.type!=="null"?"/get?groupType\x3d9":"/get";options.data.url=options.data.url?options.data.url:getFriendListUrl;ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.data.groupName+options.data.url,type:"GET",async:typeof options.data.async!=="undefined"?options.data.async:true,global:false,
contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.removeUserFromFriendList=function(options){var getFriendListUrl=options.group.type?"/remove?userId\x3d"+options.group.userId+"\x26groupType\x3d9":"/remove?userId\x3d"+options.group.userId;ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.group.groupName+getFriendListUrl,type:"Post",contentType:"application/json",
async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.deleteFriendList=function(options){var getFriendListUrl=options.group.type?"/delete?groupType\x3d9":"/delete";ALApiService.ajax({url:MCK_BASE_URL+FRIEND_LIST_URL+options.group.groupName+getFriendListUrl,type:"GET",async:false,contentType:"application/json",async:typeof options.async!==
"undefined"?options.async:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.getUserDetail=function(options){ALApiService.ajax({url:MCK_BASE_URL+GET_USER_DETAIL_URL,data:JSON.stringify({userIdList:options.data.userIdList}),type:"POST",async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.updateUserDetail=function(options){ALApiService.ajax({url:MCK_BASE_URL+UPDATE_USER_DETAIL_URL,data:JSON.stringify(options.data),type:"POST",async:typeof options.async!=="undefined"?options.async:true,global:false,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.updatePassword=function(options){ALApiService.ajax({url:MCK_BASE_URL+
UPDATE_PASSWORD_URL+"?oldPassword\x3d"+options.data.oldPassword+"\x26newPassword\x3d"+options.data.newPassword,type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.getContactList=function(options){var baseurl=options.baseUrl?options.baseUrl:MCK_BASE_URL;ALApiService.ajax({url:options.baseUrl+USER_FILTER+options.url,
type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.userChatMute=function(options){ALApiService.ajax({url:MCK_BASE_URL+ONE_TO_ONE_MUTE_URL+"?userId\x3d"+options.data.userId+"\x26notificationAfterTime\x3d"+options.data.notificationAfterTime,type:"post",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.groupMute=function(options){var group={};group.clientGroupId=options.data.clientGroupId;group.notificationAfterTime=options.data.notificationAfterTime;ALApiService.ajax({url:MCK_BASE_URL+GROUP_MUTE_URL,type:"post",data:JSON.stringify(group),contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.syncMuteUserList=
function(options){ALApiService.ajax({url:MCK_BASE_URL+SYNC_MUTE_USER_URL,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.blockUser=function(options){ALApiService.ajax({url:MCK_BASE_URL+USER_BLOCK_URL+"?userId\x3d"+options.data.userId+"\x26block\x3d"+options.data.isBlock,type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.error(response)}})};ALApiService.unBlockUser=function(options){ALApiService.ajax({url:MCK_BASE_URL+USER_UNBLOCK_URL+"?userId\x3d"+options.data.userId,type:"GET",async:typeof options.async!=="undefined"?options.async:true,global:false,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.sendConversationCloseUpdate=function(options){var data="id\x3d"+
options.conversationId;ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_CLOSE_UPDATE_URL,data:data,global:false,type:"get",success:function(){},error:function(){}})};ALApiService.fileUpload=function(options){ALApiService.ajax({type:"GET",url:options.data.url,global:false,data:"data\x3d"+(new Date).getTime(),crosDomain:true,success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.sendAttachment=function(options){var data=
new FormData;var xhr=new XMLHttpRequest;xhr.addEventListener("load",function(e){var file=this.responseText;var message=options.data.messagePxy;if(file){message.fileMeta=JSON.parse(file);Applozic.ALApiService.sendMessage({data:{message},success:function(response){console.log(response)},error:function(){}})}});data.append("file",options.data.file);xhr.open("post",MCK_BASE_URL+ATTACHMENT_UPLOAD_URL,true);xhr.setRequestHeader("UserId-Enabled",true);xhr.setRequestHeader("Authorization","Basic "+AUTH_CODE);
xhr.setRequestHeader("Application-Key",MCK_APP_ID);xhr.setRequestHeader("Device-Key",DEVICE_KEY);if(ACCESS_TOKEN)xhr.setRequestHeader("Access-Token",ACCESS_TOKEN);xhr.send(data)};ALApiService.deleteFileMeta=function(options){ALApiService.ajax({url:options.data.url,type:"post",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.addMessageInbox=function(options){ALApiService.ajax({type:"GET",url:MCK_BASE_URL+
MESSAGE_ADD_INBOX_URL,global:false,data:"sender\x3d"+encodeURIComponent(options.data.sender)+"\x26messageContent\x3d"+encodeURIComponent(options.data.messageContent),contentType:"text/plain",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.conversationReadUpdate=function(options){ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_READ_UPDATE_URL,data:options.data,global:false,type:"get",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.success(response)}})};ALApiService.sendSubscriptionIdToServer=function(options){var subscriptionId=options.data.subscriptionId;ALApiService.ajax({url:MCK_BASE_URL+MCK_SW_REGISTER_URL,type:"post",data:"registrationId\x3d"+subscriptionId,success:function(data){},error:function(xhr,desc,err){if(xhr.status===401){sessionStorage.clear();console.log("Please reload page.")}}})};ALApiService.getTopicId=function(options){var conversationId="id\x3d"+options.data.conversationId;
ALApiService.ajax({url:MCK_BASE_URL+TOPIC_ID_URL+"?"+conversationId,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.getContactDisplayName=function(options){var userIdArray=options.data.userIdArray;if(userIdArray.length>0&&userIdArray[0]){var data="";var uniqueUserIdArray=userIdArray.filter(function(item,pos){return userIdArray.indexOf(item)===pos});for(var i=0;i<uniqueUserIdArray.length;i++){var userId=
uniqueUserIdArray[i];if(typeof MCK_CONTACT_NAME_MAP[userId]==="undefined")data+="userIds\x3d"+encodeURIComponent(userId)+"\x26"}if(data.lastIndexOf("\x26")===data.length-1)data=data.substring(0,data.length-1);if(data)ALApiService.ajax({url:MCK_BASE_URL+CONTACT_NAME_URL,data:data,global:false,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})}};ALApiService.getUserStatus=function(options){ALApiService.ajax({url:MCK_BASE_URL+
USER_STATUS_URL,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.fetchConversationByTopicId=function(options){var reqdata="topic\x3d"+options.data.topicId;if(options.data.tabId)reqdata+=""+options.data.isGroup==="true"?"\x26groupId\x3d"+options.data.tabId:"\x26userId\x3d"+encodeURIComponent(options.data.tabId);else if(options.data.clientGroupId)reqdata+="\x26clientGroupId\x3d"+options.data.clientGroupId;
else return false;if(options.data.pageSize)reqdata+="\x26pageSize\x3d"+options.data.pageSize;ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_FETCH_URL,data:reqdata,type:"get",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.getConversationId=function(options){ALApiService.ajax({url:MCK_BASE_URL+CONVERSATION_ID_URL,global:false,data:w.JSON.stringify(options.data),type:"post",contentType:"application/json",
success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.registerClientApi=function(options){ALApiService.ajax({url:MCK_BASE_URL+REGISTER_CLIENT_URL,type:"post",data:JSON.stringify(options.data.userPxy),contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.success(response)}})};ALApiService.logout=function(options){ALApiService.ajax({url:MCK_BASE_URL+
LOGOUT,type:"post",async:typeof options.async!=="undefined"?options.async:true,contentType:"application/json",success:function(response){if(options.success)options.success(response)},error:function(response){if(options.error)options.error(response)}})};ALApiService.getUsersByRole=function(options){var data=getAsUriParameters(options.data);ALApiService.ajax({url:MCK_BASE_URL+USER_FILTER_BY_ROLE+"?"+data,global:false,type:"get",contentType:"application/json",success:function(response){if(options.success)options.success(response)},
error:function(response){if(options.error)options.success(response)}})};return ALApiService}if(typeof ALApiService==="undefined")window.Applozic.ALApiService=define_ALApiService();else console.log("ALApiService already defined.")})(window);
(function(window){function define_ALSocket(){var ALSocket={};var MCK_APP_ID;var events={};var subscriber=null;ALSocket.stompClient=null;var TYPING_TAB_ID="";ALSocket.typingSubscriber=null;var openGroupSubscriber=[];var checkConnectedIntervalId;var sendConnectedStatusIntervalId;var OPEN_GROUP_SUBSCRIBER_MAP;var MCK_TYPING_STATUS;var SOCKET="";var MCK_WEBSOCKET_URL="https://apps.applozic.com";var MCK_TOKEN;var USER_DEVICE_KEY;var mckUtils=new MckUtils;ALSocket.init=function(appId,data,_events){if(appId)MCK_APP_ID=
appId;if(typeof data!=="undefined"){MCK_TOKEN=data.token;USER_DEVICE_KEY=data.deviceKey;MCK_WEBSOCKET_URL=data.websocketUrl}events=_events;if(typeof MCK_WEBSOCKET_URL!=="undefined"){var port=!mckUtils.startsWith(MCK_WEBSOCKET_URL,"https")?"15674":"15675";if(typeof SockJS==="function"){if(!SOCKET)SOCKET=new SockJS(MCK_WEBSOCKET_URL+":"+port+"/stomp");ALSocket.stompClient=Stomp.over(SOCKET);ALSocket.stompClient.heartbeat.outgoing=0;ALSocket.stompClient.heartbeat.incoming=0;ALSocket.stompClient.onclose=
function(){ALSocket.disconnect()};ALSocket.stompClient.connect("guest","guest",ALSocket.onConnect,ALSocket.onError,"/");window.addEventListener("beforeunload",function(e){ALSocket.disconnect()})}}};ALSocket.checkConnected=function(isFetchMessages){if(ALSocket.stompClient.connected){if(checkConnectedIntervalId)clearInterval(checkConnectedIntervalId);if(sendConnectedStatusIntervalId)clearInterval(sendConnectedStatusIntervalId);checkConnectedIntervalId=setInterval(function(){ALSocket.connectToSocket(isFetchMessages)},
6E5);sendConnectedStatusIntervalId=setInterval(function(){ALSocket.sendStatus(1)},12E5)}else ALSocket.connectToSocket(isFetchMessages)};ALSocket.connectToSocket=function(isFetchMessages){if(typeof events.connectToSocket==="function")events.connectToSocket(isFetchMessages)};ALSocket.stopConnectedCheck=function(){if(checkConnectedIntervalId)clearInterval(checkConnectedIntervalId);if(sendConnectedStatusIntervalId)clearInterval(sendConnectedStatusIntervalId);checkConnectedIntervalId="";sendConnectedStatusIntervalId=
"";ALSocket.disconnect()};ALSocket.disconnect=function(){if(ALSocket.stompClient&&ALSocket.stompClient.connected){ALSocket.sendStatus(0);ALSocket.stompClient.disconnect()}};ALSocket.unsubscibeToTypingChannel=function(){if(ALSocket.stompClient&&ALSocket.stompClient.connected)if(ALSocket.typingSubscriber){if(MCK_TYPING_STATUS===1)ALSocket.sendTypingStatus(0,TYPING_TAB_ID);ALSocket.typingSubscriber.unsubscribe()}ALSocket.typingSubscriber=null};ALSocket.unsubscibeToNotification=function(){if(ALSocket.stompClient&&
ALSocket.stompClient.connected)if(subscriber)subscriber.unsubscribe();subscriber=null};ALSocket.subscibeToTypingChannel=function(subscribeId){if(ALSocket.stompClient&&ALSocket.stompClient.connected)ALSocket.typingSubscriber=ALSocket.stompClient.subscribe("/topic/typing-"+MCK_APP_ID+"-"+subscribeId,ALSocket.onTypingStatus);else ALSocket.reconnect()};ALSocket.subscribeToOpenGroup=function(group){if(ALSocket.stompClient&&ALSocket.stompClient.connected){var subs=ALSocket.stompClient.subscribe("/topic/group-"+
MCK_APP_ID+"-"+group.contactId,ALSocket.onOpenGroupMessage);openGroupSubscriber.push(subs.id);OPEN_GROUP_SUBSCRIBER_MAP[group.contactId]=subs.id}else ALSocket.reconnect()};ALSocket.sendTypingStatus=function(status,mck_typing_status,MCK_USER_ID,tabId){MCK_TYPING_STATUS=mck_typing_status;if(ALSocket.stompClient&&ALSocket.stompClient.connected){if(status===1&&MCK_TYPING_STATUS===1)ALSocket.stompClient.send("/topic/typing-"+MCK_APP_ID+"-"+TYPING_TAB_ID,{"content-type":"text/plain"},MCK_APP_ID+","+MCK_USER_ID+
","+status);if(tabId){if(tabId===TYPING_TAB_ID&&status===MCK_TYPING_STATUS&&status===1)return;TYPING_TAB_ID=tabId;ALSocket.stompClient.send("/topic/typing-"+MCK_APP_ID+"-"+tabId,{"content-type":"text/plain"},MCK_APP_ID+","+MCK_USER_ID+","+status);setTimeout(function(){MCK_TYPING_STATUS=0},6E4)}else if(status===0)ALSocket.stompClient.send("/topic/typing-"+MCK_APP_ID+"-"+TYPING_TAB_ID,{"content-type":"text/plain"},MCK_APP_ID+","+MCK_USER_ID+","+status);MCK_TYPING_STATUS=status}};ALSocket.onTypingStatus=
function(resp){if(typeof events.onTypingStatus==="function")events.onTypingStatus(resp)};ALSocket.reconnect=function(){ALSocket.unsubscibeToTypingChannel();ALSocket.unsubscibeToNotification();ALSocket.disconnect();var data={};data.token=MCK_TOKEN;data.deviceKey=USER_DEVICE_KEY;data.websocketUrl=MCK_WEBSOCKET_URL;ALSocket.init(MCK_APP_ID,data,events)};ALSocket.onError=function(err){console.log("Error in channel notification. "+err);if(typeof events.onConnectFailed==="function")events.onConnectFailed()};
ALSocket.sendStatus=function(status){if(ALSocket.stompClient&&ALSocket.stompClient.connected)ALSocket.stompClient.send("/topic/status-v2",{"content-type":"text/plain"},MCK_TOKEN+","+USER_DEVICE_KEY+","+status)};ALSocket.onConnect=function(){if(ALSocket.stompClient.connected){if(subscriber)ALSocket.unsubscibeToNotification();subscriber=ALSocket.stompClient.subscribe("/topic/"+MCK_TOKEN,ALSocket.onMessage);ALSocket.sendStatus(1);ALSocket.checkConnected(true)}else setTimeout(function(){subscriber=ALSocket.stompClient.subscribe("/topic/"+
MCK_TOKEN,ALSocket.onMessage);ALSocket.sendStatus(1);ALSocket.checkConnected(true)},5E3);if(typeof events.onConnect==="function")events.onConnect()};ALSocket.onOpenGroupMessage=function(obj){if(typeof events.onOpenGroupMessage==="function")events.onOpenGroupMessage(obj)};ALSocket.onMessage=function(obj){if(subscriber!=null&&subscriber.id===obj.headers.subscription){var resp=JSON.parse(obj.body);var messageType=resp.type;if(typeof events.onMessage==="function")events.onMessage(resp);if(messageType===
"APPLOZIC_04"||messageType==="MESSAGE_DELIVERED")events.onMessageDelivered(resp);else if(messageType==="APPLOZIC_08"||messageType==="MT_MESSAGE_DELIVERED_READ")events.onMessageRead(resp);else if(messageType==="APPLOZIC_05")events.onMessageDeleted(resp);else if(messageType==="APPLOZIC_27")events.onConversationDeleted(resp);else if(messageType==="APPLOZIC_11")events.onUserConnect(resp.message);else if(messageType==="APPLOZIC_12"){var lastSeenAtTime=resp.message.split(",")[1];events.onUserDisconnect({"userId":userId,
"lastSeenAtTime":lastSeenAtTime})}else if(messageType==="APPLOZIC_29")events.onConversationReadFromOtherSource(resp);else if(messageType==="APPLOZIC_28")events.onConversationRead(resp);else if(messageType==="APPLOZIC_16"){var status=resp.message.split(":")[0];var userId=resp.message.split(":")[1];events.onUserBlocked({"status":status,"userId":userId})}else if(messageType==="APPLOZIC_17"){var status=resp.message.split(":")[0];var userId=resp.message.split(":")[1];events.onUserUnblocked({"status":status,
"userId":userId})}else if(messageType==="APPLOZIC_18")events.onUserActivated();else if(messageType==="APPLOZIC_19")events.onUserDeactivated();else{var message=resp.message;if(messageType==="APPLOZIC_03")events.onMessageSentUpdate({"messageKey":message.key});else if(messageType==="APPLOZIC_01"||messageType==="APPLOZIC_02"||messageType==="MESSAGE_RECEIVED")events.onMessageReceived({"message":messageFeed});else if(messageType==="APPLOZIC_02"){var messageFeed=mckMessageLayout.getMessageFeed(message);
events.onMessageSent({"message":messageFeed})}}}};return ALSocket}if(typeof ALSocket==="undefined")window.Applozic.ALSocket=define_ALSocket();else console.log("ALSocket already defined.")})(window);var mckNotificationUtils=new MckNotificationUtils;var alNotificationService=new AlNotificationService;
function AlNotificationService(){var _this=this;var IS_SW_NOTIFICATION_ENABLED;var MCK_GETUSERIMAGE;var MCK_NOTIFICATION_ICON_LINK;var IS_MCK_NOTIFICATION;var MCK_SW_SUBSCRIPTION;var MCK_SW_REGISTER_URL="/rest/ws/plugin/update/sw/id";var IS_MCK_TAB_FOCUSED=true;_this.init=function(optns){IS_SW_NOTIFICATION_ENABLED=typeof optns.swNotification==="boolean"?optns.swNotification:false;MCK_GETUSERIMAGE=optns.contactDisplayImage;MCK_NOTIFICATION_ICON_LINK=optns.notificationIconLink;IS_MCK_NOTIFICATION=typeof optns.desktopNotification===
"boolean"?optns.desktopNotification:false};_this.unsubscribeToServiceWorker=function(){if(MCK_SW_SUBSCRIPTION)navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){MCK_SW_SUBSCRIPTION.unsubscribe().then(function(successful){MCK_SW_SUBSCRIPTION=null;console.log("Unsubscribed to notification successfully")})})};_this.sendSubscriptionIdToServer=function(){if(MCK_SW_SUBSCRIPTION){var subscriptionId=MCK_SW_SUBSCRIPTION.endpoint.split("/").slice(-1)[0];if(subscriptionId)window.Applozic.ALApiService.sendSubscriptionIdToServer({data:{"subscriptionId":subscriptionId},
success:function(result){},error:function(){}})}};_this.subscribeToServiceWorker=function(){if(IS_SW_NOTIFICATION_ENABLED)if("serviceWorker"in navigator){navigator.serviceWorker.register("./service-worker.js",{scope:"./"});navigator.serviceWorker.ready.then(function(serviceWorkerRegistration){serviceWorkerRegistration.pushManager.subscribe({userVisibleOnly:true}).then(function(pushSubscription){console.log("The reg ID is:: ",pushSubscription.endpoint.split("/").slice(-1));MCK_SW_SUBSCRIPTION=pushSubscription;
_this.sendSubscriptionIdToServer()})})}}}
function MckNotificationUtils(){var _this=this;var PERMISSION_DEFAULT="default",PERMISSION_GRANTED="granted",PERMISSION_DENIED="denied",PERMISSION=[PERMISSION_GRANTED,PERMISSION_DEFAULT,PERMISSION_DENIED],isSupported=function(){var isSupported=false;try{isSupported=!!(w.Notification||w.webkitNotifications||navigator.mozNotification||w.external&&w.external.msIsSiteMode()!==undefined)}catch(e){}return isSupported}(),isFunction=function(value){return value&&value.constructor===Function},isString=function(value){return value&&
value.constructor===String},isObject=function(value){return value&&value.constructor===Object},ieVerification=Math.floor(Math.random()*10+1),noop=function(){};_this.permissionLevel=function(){var permission;if(!isSupported)return;if(w.Notification&&w.Notification.permissionLevel)permission=w.Notification.permissionLevel();else if(w.webkitNotifications&&w.webkitNotifications.checkPermission)permission=PERMISSION[w.webkitNotifications.checkPermission()];else if(w.Notification&&w.Notification.permission)permission=
w.Notification.permission;else if(navigator.mozNotification)permission=PERMISSION_GRANTED;else if(w.external&&w.external.msIsSiteMode()!==undefined)permission=w.external.msIsSiteMode()?PERMISSION_GRANTED:PERMISSION_DEFAULT;return permission};_this.requestPermission=function(callback){var callbackFunction=isFunction(callback)?callback:noop;if(w.webkitNotifications&&w.webkitNotifications.checkPermission)w.webkitNotifications.requestPermission(callbackFunction);else if(w.Notification&&w.Notification.requestPermission)w.Notification.requestPermission(callbackFunction)};
_this.isChrome=function(){return/chrom(e|ium)/.test(w.navigator.userAgent.toLowerCase())};_this.getNotification=function(displayName,iconLink,msg,notificationsound){if(notificationsound){notificationsound.play();setTimeout(function(){notificationsound.stop()},1E3)}var notification;if(w.Notification){var options={icon:iconLink,body:msg};notification=new w.Notification(displayName,options);notification.onclick=function(){w.focus();this.close()}}else if(w.webkitNotifications){notification=w.webkitNotifications.createNotification(iconLink,
displayName,msg);if(notificationsound)notification.show();if(_this.isChrome())notification.onclick=function(){w.focus();this.cancel()};notification.show();setTimeout(function(){notification.cancel()},3E4)}else if(navigator.mozNotification){notification=navigator.mozNotification.createNotification(displayName,msg,iconLink);notification.show()}else if(w.external&&w.external.msIsSiteMode()){w.external.msSiteModeClearIconOverlay();w.external.msSiteModeSetIconOverlay(iconLink,displayName);w.external.msSiteModeActivate();
notification={"ieVerification":ieVerification+1}}return notification};_this.sendDesktopNotification=function(displayName,iconLink,msg,notificationsound){if(_this.permissionLevel()!==PERMISSION_GRANTED)w.Notification.requestPermission();if(_this.permissionLevel()===PERMISSION_GRANTED){var notification;if(notificationsound)notification=_this.getNotification(displayName,iconLink,msg,notificationsound);else notification=_this.getNotification(displayName,iconLink,msg);var notificationWrapper=_this.getWrapper(notification);
if(notification&&!notification.ieVerification&&notification.addEventListener)notification.addEventListener("show",function(){var notification=notificationWrapper;w.setTimeout(function(){notification.close()},3E4)})}};_this.getWrapper=function(notification){return{close:function(){if(notification)if(notification.close)notification.close();else if(notification.cancel)notification.cancel();else if(w.external&&w.external.msIsSiteMode())if(notification.ieVerification===ieVerification)w.external.msSiteModeClearIconOverlay()}}}}
var mckGroupUtils=new MckGroupUtils;var mckGroupService=new MckGroupService;
function MckGroupUtils(){var _this=this;_this.getGroup=function(groupId){if(typeof MCK_GROUP_MAP[groupId]==="object")return MCK_GROUP_MAP[groupId];else return};_this.getGroupByClientGroupId=function(clientGroupId){if(typeof MCK_CLIENT_GROUP_MAP[clientGroupId]==="object")return MCK_CLIENT_GROUP_MAP[clientGroupId];else return};_this.addGroup=function(group){var name=group.name?group.name:group.id;var users=[];$applozic.each(group.groupUsers,function(i,user){if(user.userId)users[user.userId]=user});
var removedMembersId=typeof group.removedMembersId!=="undefined"?group.removedMembersId:[];var groupFeed={"contactId":group.id.toString(),"htmlId":mckContactUtils.formatContactId(""+group.id),"displayName":name,"value":group.id.toString(),"adminName":group.adminId?group.adminId:group.adminName,"type":group.type,"members":group.membersId?group.membersId:group.membersName,"imageUrl":group.imageUrl,"users":users,"userCount":group.userCount,"removedMembersId":removedMembersId,"clientGroupId":group.clientGroupId,
"isGroup":true,"deletedAtTime":group.deletedAtTime,"metadata":group.metadata};MCK_GROUP_MAP[group.id]=groupFeed;if(group.clientGroupId)MCK_CLIENT_GROUP_MAP[group.clientGroupId]=groupFeed;return groupFeed};_this.createGroup=function(groupId){var group={"contactId":groupId.toString(),"htmlId":mckContactUtils.formatContactId(""+groupId),"displayName":groupId.toString(),"value":groupId.toString(),"members":group.membersId?group.membersId:group.membersName,"type":2,"adminName":"","imageUrl":"","userCount":"",
"users":[],"removedMembersId":[],"clientGroupId":"","isGroup":true,"deletedAtTime":""};MCK_GROUP_MAP[groupId]=group;return group}}
function MckGroupService(){var _this=this;var IS_MCK_VISITOR;var MCK_USER_ID;var MCK_OPEN_GROUP_SETTINGS;var MCK_LAST_SEEN_AT_MAP=[];var MCK_BLOCKED_TO_MAP=[];var GROUP_LIST_URL="/rest/ws/group/list";var GROUP_FEED_URL="/rest/ws/group/info";var GROUP_LEAVE_URL="/rest/ws/group/left";var GROUP_UPDATE_INFO_URL="/rest/ws/group/update";var GROUP_ADD_MEMBER_URL="/rest/ws/group/add/member";var GROUP_REMOVE_MEMBER_URL="/rest/ws/group/remove/member";MCK_GROUP_ARRAY=new Array;_this.init=function(optns){IS_MCK_VISITOR=
optns.visitor;MCK_USER_ID=IS_MCK_VISITOR?"guest":$applozic.trim(optns.userId);MCK_OPEN_GROUP_SETTINGS=optns.openGroupSettings};_this.loadGroups=function(params){var response=new Object;window.Applozic.ALApiService.loadGroups({baseUrl:MCK_BASE_URL,success:function(data){if(data.status==="success"){response.status="success";response.data=data.response;if(params.apzCallback)params.apzCallback(response)}else response.status="error";if(params.callback)params.callback(response)},error:function(){console.log("Unable to load groups. Please reload page.");
response.status="error";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response)}})};_this.getGroupFeed=function(params){var group={};if(typeof params.callback==="function"||typeof params.apzCallback==="function")var response=new Object;else return;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{if(typeof params.callback==="function"){response.status="error";response.errorMessage="GroupId or Client GroupId Required";
params.callback(response)}return}if(params.conversationId)group.conversationId=params.conversationId;Applozic.ALApiService.getGroupInfo({data:{group},success:function(response){if(response.status==="success"){var groupFeed=response.response;if(groupFeed+""==="null"||typeof groupFeed!=="object"){response.status="error";response.errorMessage="GroupId not found"}else{var group=mckGroupUtils.addGroup(groupFeed);response.status="success";response.data=group}}else if(data.status==="error"){response.status=
"error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);if(params.apzCallback){if(response.status==="success")response.data=groupFeed;params.apzCallback(response,params)}},error:function(){console.log("Unable to load group. Please reload page.");response.status="error";response.errorMessage="Please reload page.";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response,params)}})};_this.leaveGroup=function(params){var group=
{};var response=new Object;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{response.status="error";response.errorMessage="GroupId or Client GroupId Required";if(params.callback)params.callback(response);return}Applozic.ALApiService.groupLeave({data:{group},success:function(data){if(data.status==="success"){if(params.clientGroupId){var groupInfo=mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);if(typeof groupInfo===
"object")params.groupInfo=groupInfo.contactId}response.status="success";response.data={groupId:params.groupId}}else{response.status="error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response,{groupId:params.groupId})},error:function(){console.log("Unable to process your request. Please reload page.");response.status="error";response.errorMessage="";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response)}})};
_this.removeGroupMemberFromChat=function(params){var group={};var response=new Object;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{response.status="error";response.errorMessage="GroupId or Client GroupId Required";if(typeof params.callback==="function")params.callback(response);return}group.userId=params.userId;Applozic.ALApiService.removeGroupMember({data:{group:group},success:function(response){if(response.status==="success"){if(params.clientGroupId){var group=
mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);if(typeof group==="object")params.groupId=group.contactId}response.status="success";response.data=data.response}else{response.status="error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response,params)},error:function(){console.log("Unable to process your request. Please reload page.");response.status="error";response.errorMessage="";if(params.callback)params.callback(response);
if(params.apzCallback)params.apzCallback(response);params.apzCallback(response)}})};_this.addGroupMember=function(params){var group={};var response=new Object;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{if(typeof params.callback==="function")params.callback(response);return}group.userId=params.userId;if(typeof params.role!=="undefined")group.role=params.role;Applozic.ALApiService.addGroupMember({data:{group:group},success:function(data){if(data.status===
"success"){if(params.clientGroupId){var group=mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);if(typeof group==="object")params.groupId=group.contactId}response.status="success";response.data=data.response}else{response.status="error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response,params)},error:function(){console.log("Unable to process your request. Please reload page.");response.status=
"error";response.errorMessage="";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response)}})};_this.updateGroupInfo=function(params){var group={};var response=new Object;if(params.groupId)group.groupId=params.groupId;else if(params.clientGroupId)group.clientGroupId=params.clientGroupId;else{if(typeof params.callback==="function"){response.status="error";response.errorMessage="GroupId or Client GroupId Required";params.callback(response)}return}if(params.name)group.newName=
params.name;if(params.imageUrl)group.imageUrl=params.imageUrl;if(params.users&&params.users.length>0)group.users=params.users;Applozic.ALApiService.groupUpdate({data:{group},success:function(data,group){if(data.status==="success"){if(params.clientGroupId){var group=mckGroupLayout.getGroupByClientGroupId(params.clientGroupId);if(typeof group==="object")params.groupId=group.contactId}response.status="success";response.data=data.response}else{response.status="error";response.errorMessage=data.errorResponse[0].description}if(params.callback)params.callback(response);
if(params.apzCallback)params.apzCallback(response,{groupId:params.groupId,groupInfo:group})},error:function(){console.log("Unable to process your request. Please reload page.");response.status="error";response.errorMessage="Unable to process your request. Please reload page.";if(params.callback)params.callback(response);if(params.apzCallback)params.apzCallback(response)}})};_this.sendGroupMessage=function(params){if(typeof params==="object"){params=$applozic.extend(true,{},message_default_options,
params);var message=params.message;if(!params.groupId&&!params.clientGroupId)return"groupId or clientGroupId required";if(typeof message==="undefined"||message==="")return"message field required";if(params.type>12)return"invalid message type";message=$applozic.trim(message);var messagePxy={"type":params.messageType,"contentType":params.type,"message":message};if(params.groupId)messagePxy.groupId=$applozic.trim(params.groupId);else if(params.clientGroupId){var group=mckGroupUtils.getGroupByClientGroupId(params.clientGroupId);
if(typeof group==="undefined")return"group not found";messagePxy.clientGroupId=$applozic.trim(params.clientGroupId)}mckMessageService.sendMessage(messagePxy);return"success"}else return"Unsupported format. Please check format"};_this.getContactFromGroupOfTwo=function(group,callback){var user;for(var i=0;i<group.members.length;i++){user=""+group.members[i];if(MCK_USER_ID===user)continue;if(typeof callback==="function")callback(user)}};_this.addGroupFromMessage=function(message,update,callback){var groupId=
message.groupId;var group=mckGroupUtils.getGroup(""+groupId);if(typeof group==="undefined"){group=mckGroupUtils.createGroup(groupId);mckGroupService.loadGroups({apzCallback:mckGroupLayout.loadGroups})}if(typeof callback==="function")callback(group,message,update)};_this.isGroupDeleted=function(tabId,isGroup){if(isGroup){var deletedAtTime=mckGroupLayout.getDeletedAtTime(tabId);return typeof deletedAtTime!=="undefined"&&deletedAtTime>0}return false};_this.loadGroupsCallback=function(response){var groups=
response.data;MCK_GROUP_ARRAY.length=0;$applozic.each(groups,function(i,group){if(typeof group.id!=="undefined"){var group=mckGroupUtils.addGroup(group);MCK_GROUP_ARRAY.push(group)}})};_this.getGroupDisplayName=function(groupId){if(typeof MCK_GROUP_MAP[groupId]==="object"){var group=MCK_GROUP_MAP[groupId];var displayName=group["displayName"];if(group.type===7){var contact=_this.getContactFromGroupOfTwo(group);if(typeof contact!=="undefined")displayName=mckMessageLayout.getTabDisplayName(contact.contactId,
false)}if(group.type===3)if(displayName.indexOf(MCK_USER_ID)!==-1){displayName=displayName.replace(MCK_USER_ID,"").replace(":","");if(typeof MCK_GETUSERNAME==="function"){var name=MCK_GETUSERNAME(displayName);displayName=name?name:displayName}}if(!displayName&&group.type===5)displayName="Broadcast";if(!displayName)displayName=group.contactId;return displayName}else return groupId};_this.getGroupImage=function(imageSrc){return imageSrc?'\x3cimg src\x3d"'+imageSrc+'"/\x3e':'\x3cimg src\x3d"'+MCK_BASE_URL+
'/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'};_this.getGroupDefaultIcon=function(){return'\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'};_this.addMemberToGroup=function(group,userId){if(typeof group.members==="object"){if(group.members.indexOf(userId)===-1)group.members.push(userId);if(typeof group.removedMembersId==="object"&&group.removedMembersId.indexOf(userId)!==-1)group.removedMembersId.splice(group.removedMembersId.indexOf(userId),1);MCK_GROUP_MAP[group.contactId]=
group}return group};_this.removeMemberFromGroup=function(group,userId){if(typeof group.removedMembersId!=="object"||group.removedMembersId.length<1){group.removedMembersId=[];group.removedMembersId.push(userId)}else if(group.removedMembersId.indexOf(userId)===-1)group.removedMembersId.push(userId);MCK_GROUP_MAP[group.contactId]=group;return group};_this.authenticateGroupUser=function(group){var isGroupLeft=mckGroupService.isGroupLeft(group);var isGroupMemeber=false;if(!isGroupLeft&&group.members.length>
0)for(var i=0;i<group.members.length;i++)if(MCK_USER_ID===""+group.members[i]){isGroupMemeber=true;return true}return isGroupMemeber};_this.isAppendOpenGroupContextMenu=function(group){if(MCK_OPEN_GROUP_SETTINGS.deleteChatAccess===0)return false;var isGroupMember=mckGroupService.authenticateGroupUser(group);if(!isGroupMember)return false;if(group.adminName===MCK_USER_ID)return true;if(MCK_OPEN_GROUP_SETTINGS.deleteChatAccess===2)return true;return false};_this.isGroupLeft=function(group){var isGroupLeft=
false;if(group.removedMembersId&&group.removedMembersId.length>0)$applozic.each(group.removedMembersId,function(i,removedMemberId){if(removedMemberId===MCK_USER_ID)isGroupLeft=true});return isGroupLeft}}var alUserService=new AlUserService;
function AlUserService(){var _this=this;var MCK_USER_DETAIL_MAP=[];var MCK_BLOCKED_TO_MAP=[];var MCK_GROUP_MEMBER_SEARCH_ARRAY=new Array;var USER_BLOCK_URL="/rest/ws/user/block";var USER_DETAIL_URL="/rest/ws/user/v2/detail";var USER_STATUS_URL="/rest/ws/user/chat/status";_this.updateUserStatus=function(params,callback){if(typeof MCK_USER_DETAIL_MAP[params.userId]==="object"){var userDetail=MCK_USER_DETAIL_MAP[params.userId];if(params.status===0){userDetail.connected=false;userDetail.lastSeenAtTime=
params.lastSeenAtTime}else if(params.status===1)userDetail.connected=true}else{var userIdArray=new Array;userIdArray.push(params.userId);if(typeof callback==="function")callback(userIdArray)}};_this.getUserDetail=function(userId){if(typeof MCK_USER_DETAIL_MAP[userId]==="object")return MCK_USER_DETAIL_MAP[userId];else return};_this.checkUserConnectedStatus=function(callback){var userIdArray=new Array;var otherUserIdArray=new Array;$applozic(".mck-user-ol-status").each(function(){var tabId=$applozic(this).data("mck-id");
if(typeof tabId!=="undefined"&&tabId!==""){userIdArray.push(tabId);var htmlId=mckContactUtils.formatContactId(""+tabId);$applozic(this).addClass(htmlId);$applozic(this).next().addClass(htmlId)}});if(userIdArray.length>0){$applozic.each(userIdArray,function(i,userId){if(typeof MCK_USER_DETAIL_MAP[userId]==="undefined")otherUserIdArray.push(userId)});if(typeof callback==="function")callback(otherUserIdArray)}};_this.loadUserProfile=function(userId){if(typeof userId!=="undefined"){var userIdArray=[];
var memberId=""+userId.split(",")[0];userIdArray.push(memberId);_this.loadUserProfiles(userIdArray)}};_this.loadUserProfiles=function(userIds,callback){var userIdArray=[];if(typeof callback==="function")callback(userIds,userIdArray)};_this.getUserStatus=function(params,callback){var response=new Object;window.Applozic.ALApiService.getUserStatus({success:function(data){if(data.users.length>0){MCK_GROUP_MEMBER_SEARCH_ARRAY=[];if(typeof callback==="function")callback(data)}response.status="success";
response.data=data;if(params.callback)params.callback(response);return},error:function(){response.status="error";if(params.callback)params.callback(response)}})};_this.blockUser=function(userId,isBlock,callback){if(!userId||typeof isBlock==="undefined")return;var data="userId\x3d"+userId+"\x26block\x3d"+isBlock;mckUtils.ajax({url:MCK_BASE_URL+USER_BLOCK_URL,type:"get",data:data,success:function(data){if(typeof data==="object")if(data.status==="success"){MCK_BLOCKED_TO_MAP[userId]=isBlock;if(typeof callback===
"function")callback(userId)}},error:function(){}})}}var alFileService=new AlFileService;
function AlFileService(){var _this=this;var ONE_KB=1024;var ONE_MB=1048576;var UPLOAD_VIA=["CREATE","UPDATE"];var FILE_PREVIEW_URL="/rest/ws/aws/file/";var FILE_UPLOAD_URL="/rest/ws/aws/file/url";var FILE_AWS_UPLOAD_URL="/rest/ws/upload/file";var FILE_DELETE_URL="/rest/ws/aws/file/delete";var MCK_STORAGE_URL;var MCK_FILE_URL;var MCK_MAP_STATIC_API_KEY;var MCK_CHECK_NEW_UPLOAD_SETTINGS;var MCK_APP_ID;var AUTH_CODE;var USER_DEVICE_KEY;var MCK_ACCESS_TOKEN;var MCK_APP_MODULE_NAME;_this.init=function(optns){MCK_FILE_URL=
optns.fileBaseUrl;AUTH_CODE=btoa(optns.userId+":"+optns.deviceKey);USER_DEVICE_KEY=optns.deviceKey};_this.get=function(optns){MCK_APP_ID=optns.appId;MCK_STORAGE_URL=optns.customUploadUrl;MCK_CHECK_NEW_UPLOAD_SETTINGS=optns.fileupload;MCK_MAP_STATIC_API_KEY=optns.mapStaticAPIkey;MCK_ACCESS_TOKEN=optns.accessToken;MCK_APP_MODULE_NAME=optns.appModuleName};_this.deleteFileMeta=function(blobKey){window.Applozic.ALApiService.deleteFileMeta({data:{blobKey:blobKey,url:MCK_FILE_URL+FILE_DELETE_URL+"?key\x3d"+
blobKey},success:function(response){console.log(response)},error:function(){}})};_this.getFilePreviewPath=function(fileMeta){return typeof fileMeta==="object"?'\x3ca href\x3d"'+MCK_FILE_URL+FILE_PREVIEW_URL+fileMeta.blobKey+'" target\x3d"_blank"\x3e'+fileMeta.name+"\x3c/a\x3e":""};_this.getFilePreviewSize=function(fileSize){if(fileSize)if(fileSize>ONE_MB)return"("+parseInt(fileSize/ONE_MB)+" MB)";else if(fileSize>ONE_KB)return"("+parseInt(fileSize/ONE_KB)+" KB)";else return"("+parseInt(fileSize)+
" B)";return""};_this.getFileurl=function(msg){if(typeof msg.fileMeta==="object")if(msg.fileMeta.hasOwnProperty("url"))if(msg.fileMeta.hasOwnProperty("thumbnailBlobKey")){console.log("check");_this.cloudupdate(msg.fileMeta.BlobKey)}else return""+msg.fileMeta.url;else if(msg.fileMeta.thumbnailUrl==="thumbnail_"+msg.fileMeta.name)return MCK_STORAGE_URL+"/files/"+msg.fileMeta.name;else return MCK_FILE_URL+FILE_PREVIEW_URL+msg.fileMeta.blobKey;return""};_this.getFilePath=function(msg){if(msg.contentType===
2)try{var geoLoc=$applozic.parseJSON(msg.message);if(geoLoc.lat&&geoLoc.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+geoLoc.lat+","+geoLoc.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+geoLoc.lat+","+geoLoc.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+geoLoc.lat+","+geoLoc.lon+"\x26key\x3d"+MCK_MAP_STATIC_API_KEY+'"/\x3e\x3c/a\x3e'}catch(ex){if(msg.message.indexOf(",")!==
-1)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+msg.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+msg.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+msg.message+"\x26key\x3d"+MCK_MAP_STATIC_API_KEY+'" /\x3e\x3c/a\x3e'}if(typeof msg.fileMeta==="object")if(msg.fileMeta.contentType.indexOf("image")!==-1)if(msg.fileMeta.contentType.indexOf("svg")!==-1)return'\x3cimg href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+
msg.fileMeta.contentType+'" data-url\x3d"'+_this.getFileurl(msg)+'" data-name\x3d"'+msg.fileMeta.name+'" src\x3d"'+_this.getFileurl(msg)+'" area-hidden\x3d"true"\x3e';else if(msg.contentType===5)return'\x3cimg href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+msg.fileMeta.contentType+'" data-url\x3d"'+msg.fileMeta.blobKey+'" data-name\x3d"'+msg.fileMeta.name+'" src\x3d"'+msg.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e';else if(msg.fileMeta.hasOwnProperty("url"))if(msg.fileMeta.hasOwnProperty("thumbnailBlobKey"))return'\x3cimg href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+
msg.fileMeta.contentType+'" data-url\x3d"'+_this.cloudupdate(msg.fileMeta.BlobKey)+'" data-name\x3d"'+msg.fileMeta.name+'" src\x3d"'+_this.cloudupdate(msg.fileMeta.thumbnailBlobKey)+'" area-hidden\x3d"true"\x3e';else return'\x3cimg href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+msg.fileMeta.contentType+'" data-url\x3d"'+_this.getFileurl(msg)+'" data-name\x3d"'+msg.fileMeta.name+'" src\x3d"'+msg.fileMeta.thumbnailUrl+'" area-hidden\x3d"true"\x3e';
else if(msg.fileMeta.thumbnailUrl==="thumbnail_"+msg.fileMeta.name)return'\x3cimg href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+msg.fileMeta.contentType+'" data-url\x3d"'+_this.getFileurl(msg)+'" data-name\x3d"'+msg.fileMeta.name+'" src\x3d"'+MCK_STORAGE_URL+"/files/thumbnail_"+msg.fileMeta.name+'" area-hidden\x3d"true"\x3e';else return'\x3cimg href\x3d"#" role\x3d"link" target\x3d"_self" class\x3d"file-preview-link fancybox-media imageview" data-type\x3d"'+
msg.fileMeta.contentType+'" data-url\x3d"'+_this.getFileurl(msg)+'" data-name\x3d"'+msg.fileMeta.name+'" src\x3d"'+msg.fileMeta.thumbnailUrl+'" area-hidden\x3d"true"\x3e';else if(msg.fileMeta.contentType.indexOf("video")!==-1)return'\x3ca href\x3d "#" target\x3d"_self"\x3e\x3cvideo controls class\x3d"mck-video-player"\x3e'+'\x3csource src\x3d"'+_this.getFileurl(msg)+'" type\x3d"video/mp4"\x3e'+'\x3csource src\x3d"'+_this.getFileurl(msg)+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e';else if(msg.fileMeta.contentType.indexOf("audio")!==
-1)return'\x3ca href\x3d"#" target\x3d"_self"\x3e\x3caudio controls class\x3d"mck-audio-player"\x3e'+'\x3csource src\x3d"'+_this.getFileurl(msg)+'" type\x3d"audio/ogg"\x3e'+'\x3csource src\x3d"'+_this.getFileurl(msg)+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e'+'\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e';else return'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e';return""};_this.getFileAttachment=function(msg){if(typeof msg.fileMeta==="object"){if(msg.fileMeta.contentType.indexOf("image")!==
-1||msg.fileMeta.contentType.indexOf("audio")!==-1||msg.fileMeta.contentType.indexOf("video")!==-1)return'\x3ca href\x3d"'+_this.getFileurl(msg)+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+msg.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+alFileService.getFilePreviewSize(msg.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e";
else return'\x3ca href\x3d"'+_this.getFileurl(msg)+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+msg.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+alFileService.getFilePreviewSize(msg.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e";return""}};_this.getFileIcon=function(msg){if(msg.fileMetaKey&&
typeof msg.fileMeta==="object")if(msg.fileMeta.contentType.indexOf("image")!==-1)return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eImage\x3c/span\x3e';else if(msg.fileMeta.contentType.indexOf("audio")!==-1)return'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eAudio\x3c/span\x3e';else if(msg.fileMeta.contentType.indexOf("video")!==-1)return'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eVideo\x3c/span\x3e';else return'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eFile\x3c/span\x3e';
else return""};_this.downloadfile=function(){var url=_this.getFileurl(msg);var link=document.createElement("a");link.download=thefilename;link.setAttribute("href",url);var uri="data:text/csv;charset\x3dutf-8;base64,"+someb64data;link.href=uri;document.body.appendChild(link);link.click();document.body.removeChild(link)};_this.cloudupdate=function(BlobKey){var url="https://googleupload.applozic.com/files/url?key\x3d"+BlobKey;mckUtils.ajax({type:"get",headers:{"Authorization":"Basic "+AUTH_CODE,"Application-Key":MCK_APP_ID,
"Device-Key":USER_DEVICE_KEY,"Access-Token":MCK_ACCESS_TOKEN,"App-Module-Name":MCK_APP_MODULE_NAME},url:url,success:function(result){console.log(result);return result},error:function(result){console.log("error while getting token"+result)}})}}var alMessageService=new AlMessageService;
function AlMessageService(){var _this=this;var IS_MCK_VISITOR;var MCK_USER_ID;var TOPIC_ID_URL="/rest/ws/conversation/topicId";var CONVERSATION_ID_URL="/rest/ws/conversation/id";var CONVERSATION_FETCH_URL="/rest/ws/conversation/get";var MESSAGE_ADD_INBOX_URL="/rest/ws/message/add/inbox";var CONVERSATION_CLOSE_UPDATE_URL="/rest/ws/conversation/close";var CONVERSATION_DELETE_URL="/rest/ws/message/delete/conversation";var CONVERSATION_READ_UPDATE_URL="/rest/ws/message/read/conversation";var offlineblk=
'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e';var refreshIntervalId;_this.init=function(optns){var IS_MCK_VISITOR=optns.visitor;var MCK_USER_ID=IS_MCK_VISITOR?"guest":$applozic.trim(optns.userId)};_this.addMessageToTab=function(messagePxy,
contact,callback){var message={"to":messagePxy.to,"groupId":messagePxy.groupId,"deviceKey":messagePxy.deviceKey,"contentType":messagePxy.contentType,"message":messagePxy.message,"conversationId":messagePxy.conversationId,"topicId":messagePxy.topicId,"sendToDevice":true,"createdAtTime":(new Date).getTime(),"key":messagePxy.key,"storeOnDevice":true,"sent":false,"read":true,"metadata":messagePxy.metadata?messagePxy.metadata:""};message.type=messagePxy.type?messagePxy.type:5;if(messagePxy.fileMeta)message.fileMeta=
messagePxy.fileMeta;if(typeof callback==="function")callback(message,contact)};_this.getMessages=function(params){var data={};if(params.startTime)data.endTime=params.startTime;if(typeof params.userId!=="undefined"&&params.userId!==""){if(params.isGroup)data.groupId=params.userId;else data.userId=params.userId;data.pageSize=30;if((IS_MCK_TOPIC_HEADER||IS_MCK_TOPIC_BOX)&&params.conversationId){data.conversationId=params.conversationId;if(typeof MCK_TAB_CONVERSATION_MAP[params.userId]==="undefined")data.conversationReq=
true}}else data.mainPageSize=100;window.Applozic.ALApiService.getMessages({data:data,success:params.callback,error:params.callback})};_this.getMessageList=function(params,callback){var tabId=params.id;var data={};var resp={};if(params.startTime)data.endTime=params.startTime;if(typeof params.clientGroupId!=="undefined"&&params.clientGroupId!==""){if(params.pageSize)data.pageSize=params.pageSize;else data.pageSize=50;data.clientGroupId=params.clientGroupId;resp={"clientGroupId":params.clientGroupId}}else if(typeof tabId!==
"undefined"&&tabId!==""){if(params.pageSize)data.pageSize=params.pageSize;else data.pageSize=50;if(""+params.isGroup==="true")data.groupId=tabId;else data.userId=tabId;resp={"id":tabId}}else{if(params.mainPageSize)data.mainPageSize=params.pageSize;else data.mainPageSize=50;resp={"id":""}}if(params.topicId&&(tabId||params.clientGroupId)){if(params.conversationId)data.conversationId=params.conversationId;if(params.topicId)resp["topicId"]=params.topicId}window.Applozic.ALApiService.getMessages({data:data,
success:function(response){var data=response.data;resp.status="success";if(typeof data.message==="undefined"||data.message.length===0)resp.messages=[];else{var messages=data.message;var messageFeeds=new Array;$applozic.each(messages,function(i,message){if(typeof callback==="function")callback(message)});resp.messages=messageFeeds}if(data.groupFeeds.length>0)resp.id=data.groupFeeds[0].id;params.callback(resp)},error:function(error){resp.status="error";params.callback(resp)}})};_this.getReplyMessageByKey=
function(msgkey){var replyMsg=ALStorage.getMessageByKey(msgkey);if(typeof replyMsg==="undefined")window.Applozic.ALApiService.updateReplyMessage({data:{key:msgkey},async:false,success:function(data){ALStorage.updateMckMessageArray(data)}});return ALStorage.getMessageByKey(msgkey)};_this.sendDeliveryUpdate=function(message){window.Applozic.ALApiService.sendDeliveryUpdate({data:{key:message.pairedMessageKey},success:function(){},error:function(){}})};_this.sendReadUpdate=function(key){if(typeof key!==
"undefined"&&key!=="")window.Applozic.ALApiService.sendReadUpdate({data:{key:key},success:function(){},error:function(){}})};_this.fetchConversationByTopicId=function(data,callback){window.Applozic.ALApiService.fetchConversationByTopicId({data,success:function(data){if(typeof data==="object"&&data.status==="success"){var conversationList=data.response;if(conversationList.length>0)$applozic.each(conversationList,function(i,conversationPxy){MCK_CONVERSATION_MAP[conversationPxy.id]=conversationPxy;MCK_TOPIC_CONVERSATION_MAP[conversationPxy.topicId]=
[conversationPxy.id];if(conversationPxy.topicDetail)try{MCK_TOPIC_DETAIL_MAP[conversationPxy.topicId]=$applozic.parseJSON(conversationPxy.topicDetail)}catch(ex){w.console.log("Incorect Topic Detail!")}if(params.tabId&&typeof MCK_TAB_CONVERSATION_MAP[params.tabId]!=="undefined"){var tabConvArray=MCK_TAB_CONVERSATION_MAP[params.tabId];tabConvArray.push(conversationPxy);MCK_TAB_CONVERSATION_MAP[params.tabId]=tabConvArray}});if(params.isExtMessageList)if(conversationList.length>0){params.conversationId=
conversationList[0].id;params.pageSize=50;if(typeof callback==="function")callback(params)}else if(typeof params.callback==="function"){var resp={};if(params.tabId){resp.id=params.tabId;resp.isGroup=params.isGroup}else if(params.clientGroupId)resp.clientGroupId=params.clientGroupId;resp.topicId=params.topicId;resp.status="success";resp.messages=[];params.callback(resp)}}else if(params.isExtMessageList&&typeof params.callback==="function"){var resp={};if(params.tabId)resp.id=params.tabId;else if(params.clientGroupId)resp.clientGroupId=
params.clientGroupId;resp.topicId=params.topicId;resp.status="error";resp.errorMessage="Unable to process request. Please try again.";params.callback(resp)}},error:function(){if(typeof params.callback==="function"){var resp={};if(params.tabId)resp.id=params.tabId;else if(params.clientGroupId)resp.clientGroupId=params.clientGroupId;resp.topicId=params.topicId;resp.status="error";resp.errorMessage="Unable to process request. Please try again.";params.callback(resp)}}})};_this.getTopicId=function(params,
callback){if(params.conversationId){var data="id\x3d"+params.conversationId;window.Applozic.ALApiService.getTopicId({data:{"conversationId":params.conversationId},success:function(result){if(typeof data==="object"&&data.status==="success"){var conversationPxy=data.response;if(typeof conversationPxy==="object"){MCK_TOPIC_CONVERSATION_MAP[conversationPxy.topicId]=[params.conversationId];MCK_CONVERSATION_MAP[params.conversationId]=conversationPxy;if(conversationPxy.topicDetail)try{MCK_TOPIC_DETAIL_MAP[conversationPxy.topicId]=
$applozic.parseJSON(conversationPxy.topicDetail)}catch(ex){w.console.log("Incorect Topic Detail!")}if(typeof MCK_PRICE_DETAIL==="function"&&params.priceText){MCK_PRICE_DETAIL({"custId":MCK_USER_ID,"suppId":params.suppId,"productId":conversationPxy.topicId,"price":params.priceText});_this.sendConversationCloseUpdate(params.conversationId)}if(params.messageType&&typeof params.message==="object"){var tabId=params.message.groupId?params.message.groupId:params.message.to;if(typeof MCK_TAB_CONVERSATION_MAP[tabId]!==
"undefined"){var tabConvArray=MCK_TAB_CONVERSATION_MAP[tabId];tabConvArray.push(conversationPxy);MCK_TAB_CONVERSATION_MAP[tabId]=tabConvArray}if(typeof params.populate!=="undefined"?params.populate:true)if(typeof callback==="function")callback(params)}if(typeof params.callback==="function")params.callback(conversationPxy)}}},error:function(){}})}};_this.sendConversationCloseUpdate=function(conversationId){if(conversationId){var data="id\x3d"+conversationId;window.Applozic.ALApiService.sendConversationCloseUpdate({conversationId:conversationId,
success:function(result){},error:function(){}})}};_this.dispatchMessage=function(params){if(params.messagePxy==="object"){var messagePxy=params.messagePxy;if(params.topicId){var topicDetail=MCK_TOPIC_DETAIL_MAP[params.topicId];if(typeof topicDetail==="object"&&topicDetail.title!=="undefined"){if(!messagePxy.message)messagePxy.message=$applozic.trim(topicDetail.title);if(params.conversationId)messagePxy.conversationId=params.conversationId;else if(params.topicId){var conversationPxy={"topicId":params.topicId};
if(typeof topicDetail==="object")conversationPxy.topicDetail=w.JSON.stringify(topicDetail);messagePxy.conversationPxy=conversationPxy}}if(!messagePxy.message&&topicDetail.link){var fileMeta={"blobKey":$applozic.trim(topicDetail.link),"contentType":"image/png"};messagePxy.fileMeta=fileMeta;messagePxy.contentType=5;FILE_META=[];FILE_META.push(fileMeta)}}if(params.isGroup)messagePxy.groupId=params.tabId;else messagePxy.to=params.tabId;mckMessageService.sendMessage(messagePxy)}};_this.sendVideoCallMessage=
function(callId,msgType,contentType,audioOnly,toUser,callback){var message=msgType=="CALL_MISSED"?"Missed Call":msgType=="CALL_REJECTED"?"Call Rejected":"";if(message==""||message==undefined)message="video message";var metadata={"MSG_TYPE":msgType,"CALL_ID":callId,"CALL_AUDIO_ONLY":audioOnly};var messagePxy={"to":toUser,"type":5,"contentType":contentType,"message":message,"metadata":metadata,"senderName":MCK_USER_ID};callback(messagePxy);return messagePxy};_this.sendVideoCallEndMessage=function(callId,
msgType,contentType,audioOnly,callDuration,toUser,callback){var callDurationStr="";if(callDuration)callDurationStr=mckDateUtils.convertMilisIntoTime(callDuration);var message=msgType=="CALL_MISSED"?"Missed Call":msgType=="CALL_REJECTED"?"Call Rejected":msgType=="CALL_END"?"Call End \n Duration: "+callDurationStr:"video message";if(message==""||message==undefined)message="video message";var metadata={"MSG_TYPE":msgType,"CALL_ID":callId,"CALL_AUDIO_ONLY":audioOnly,"CALL_DURATION":callDuration};var messagePxy=
{"to":toUser,"type":5,"contentType":contentType,"message":message,"metadata":metadata};callback(messagePxy);return messagePxy}};

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,f,c){a instanceof String&&(a=String(a));for(var n=a.length,r=0;r<n;r++){var v=a[r];if(f.call(c,v,r,a))return{i:r,v:v}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,f,c){a!=Array.prototype&&a!=Object.prototype&&(a[f]=c.value)};
$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,f,c,n){if(f){c=$jscomp.global;a=a.split(".");for(n=0;n<a.length-1;n++){var r=a[n];r in c||(c[r]={});c=c[r]}a=a[a.length-1];n=c[a];f=f(n);f!=n&&null!=f&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:f})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var f=0;return $jscomp.iteratorPrototype(function(){return f<a.length?{done:!1,value:a[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,f){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var c=0,n={next:function(){if(c<a.length){var r=c++;return{value:f(r,a[r]),done:!1}}n.next=function(){return{done:!0,value:void 0}};return n.next()}};n[Symbol.iterator]=function(){return n};return n};
$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6","es3");$jscomp.checkStringArgs=function(a,f,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var f=$jscomp.checkStringArgs(this,a,"startsWith");a+="";var r=f.length,v=a.length;c=Math.max(0,Math.min(c|0,f.length));for(var g=0;g<v&&c<r;)if(f[c++]!=a[g++])return!1;return g>=v}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(a){return a?a:function(a,c,n){var f=this.length||0;0>c&&(c=Math.max(0,f+c));if(null==n||n>f)n=f;n=Number(n);0>n&&(n=Math.max(0,f+n));for(c=Number(c||0);c<n;c++)this[c]=a;return this}},"es6","es3");
(function(a){function f(){return{ajax:function(a){var f=function(){for(var a=1;a<arguments.length;a++)for(var f in arguments[a])arguments[a].hasOwnProperty(f)&&(arguments[0][f]=arguments[a][f]);return arguments[0]}({},{},a),c=new XMLHttpRequest,v,g=!0;if("undefined"!==typeof f.async||a.async)g=f.async;a=f.type.toUpperCase();"GET"===a&&"undefined"!==typeof f.data&&(f.url=f.url+"?"+f.data);c.open(a,f.url,g);if("POST"===a||"GET"===a)g="undefined"===typeof f.contentType?"application/x-www-form-urlencoded; charset\x3dUTF-8":
f.contentType,c.setRequestHeader("Content-Type",g);"undefined"===typeof f.data?c.send():c.send(f.data);c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(200===c.status){var a=c.getResponseHeader("Content-Type");if("undefined"===typeof a||"null"===a||null===a)a="";v=-1!=a.toLowerCase().indexOf("text/html")?c.responseXML:-1!=a.toLowerCase().indexOf("application/json")?JSON.parse(c.responseText):c.responseText;f.success(v)}else f.error(v)}}}}"undefined"===typeof KMCommonUtils?
a.KMCommonUtils=f():console.log("KMCommonUtils already defined.")})(window);
(function(a){function f(){return{getArticles:function(a){var f="https://api.helpdocs.io/v1/article?key\x3d"+a.data.helpdocsAccessKey;a.data.query&&(f="https://api.helpdocs.io/v1/search?key\x3d"+a.data.helpdocsAccessKey+"\x26query\x3d"+a.data.query);var c={};KMCommonUtils.ajax({url:f,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(f){c.status="success";c.data=f;a.success&&a.success(c)},error:function(f,g,k){c.status="error";a.error&&a.error(c)}})},getArticle:function(a){var f=
{};KMCommonUtils.ajax({url:"https://api.helpdocs.io/v1/article/"+a.data.articleId+"?key\x3d"+a.data.helpdocsAccessKey,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(c){f.status="success";f.data=c;a.success&&a.success(f)},error:function(c,n,g){f.status="error";a.error&&a.error(f)}})}}}"undefined"===typeof Helpdocs?a.Helpdocs=f():console.log("Helpdocs already defined.")})(window);
(function(a){function f(){var a={},f="https://api.kommunicate.io";a.init=function(a){f=a};a.getArticles=function(f){try{var c=[];a.getFaqs({data:f.data,success:function(a){for(var g=0;g<a.data.length;g++){var n=a.data[g];c.push({articleId:n.id,title:n.name,description:n.content,status:n.status,body:n.content,source:"KOMMUNICATE"})}f.data.helpdocsAccessKey?Helpdocs.getArticles({data:f.data,success:function(a){a=a.data;for(var g=0;g<a.articles.length;g++){var k=a.articles[g];!0===k.is_published&&c.push({articleId:k.article_id,
title:k.title,description:k.description,body:k.description,url:k.url,source:"HELPDOCS"})}f.success&&(a={status:"success"},a.data=c,f.success(a))},error:function(a){c.length&&f.success?(a={status:"success"},a.data=c,f.success(a)):f.error&&f.error(a)}}):f.success&&(a={status:"success"},a.data=c,f.success(a))},error:function(a){"function"===typeof f.error&&f.err(a)}})}catch(g){f.error(g)}};a.getArticle=function(f){"HELPDOCS"==f.data.source?Helpdocs.getArticle({data:f.data,success:function(a){a=a.data.article;
a={articleId:a.article_id,title:a.title,description:a.description,body:a.body,url:a.url,source:"HELPDOCS"};if(f.success){var c={status:"success"};c.data=a;f.success(c)}},error:function(a){f.error(a)}}):a.getFaq({data:f.data,success:function(a){a=a.data.data[0];a={articleId:a.id,title:a.name,description:a.content,body:a.content,status:a.status,source:"KOMMUNICATE"};if(f.success){var c={status:"success"};c.data=a;f.success(c)}},error:function(a){f.error(a)}})};a.getFaqs=function(a){var c=f+"/kb/search?appId\x3d:appId".replace(":appId",
a.data.appId);a.data.query&&(c=c+"\x26query\x3d"+a.data.query);var g={};KMCommonUtils.ajax({url:c,async:"undefined"!==typeof a.async?a.async:!0,type:"get",success:function(f){g.status="success";g.data=f.data;a.success&&a.success(g)},error:function(f,c,n){g.status="error";a.error&&a.error(g)}})};a.getFaq=function(a){var c={},g=f+"/kb/search?appId\x3d:appId".replace(":appId",a.data.appId);a.data&&a.data.articleId&&(g+="\x26articleId\x3d"+a.data.articleId);KMCommonUtils.ajax({url:g,async:"undefined"!==
typeof a.async?a.async:!0,type:"get",success:function(f){c.status="success";c.data=f;a.success&&a.success(c)},error:function(f,g,n){c.status="error";a.error&&a.error(c)}})};return a}"undefined"===typeof KommunicateKB?a.KommunicateKB=f():console.log("KommunicateKB already defined.")})(window);
Kommunicate.client={getGroupDetailByType:function(a,f){$applozic.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:"type\x3d"+a.type+"\x26startIndex\x3d"+a.startIndex+"\x26limit\x3d"+a.limit,contentType:"application/json",success:function(a){f(null,a)},error:function(a){f(a)}})},createConversation:function(a,f){$applozic.fn.applozic("createGroup",{groupName:a.groupName,type:a.type,admin:a.agentId,users:a.users,clientGroupId:a.clientGroupId,metadata:{CREATE_GROUP_MESSAGE:"",REMOVE_MEMBER_MESSAGE:"",
ADD_MEMBER_MESSAGE:"",JOIN_MEMBER_MESSAGE:"",GROUP_NAME_CHANGE_MESSAGE:"",GROUP_ICON_CHANGE_MESSAGE:"",GROUP_LEFT_MESSAGE:"",CONVERSATION_STATUS:0,DELETED_GROUP_MESSAGE:"",GROUP_USER_ROLE_UPDATED_MESSAGE:"",GROUP_META_DATA_UPDATED_MESSAGE:"",CONVERSATION_ASSIGNEE:a.agentId,KM_CONVERSATION_TITLE:a.groupName,HIDE:"true"},callback:function(a){console.log("response",a);"success"===a.status&&a.data.clientGroupId&&f(a.data.value)}})},getThirdPartySettings:function(a,f){$applozic.ajax({url:Kommunicate.getBaseUrl()+
"/integration/settings/"+a.appId+"?type\x3d"+a.type,type:"get",contentType:"application/json",success:function(a){f(null,a)},error:function(a){f(a)}})}};
$applozic.extend(!0,Kommunicate,{getBaseUrl:function(){switch(MCK_BASE_URL){case "https://apps-test.applozic.com/":case "https://apps-test.applozic.com":return"https://api-test.kommunicate.io";default:return"https://api.kommunicate.io"}},setDefaultAgent:function(a){throw Error("not implemented");},getConversationOfParticipent:function(a,f){if("function"!==typeof f)throw Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");$applozic.ajax({url:Kommunicate.getBaseUrl()+
"/conversations/participent/"+a.userId,type:"get",success:function(a){f(null,a)},error:function(a){f(a)}})},startConversation:function(a,f){var c=[{userId:a.agentId,groupRole:1},{userId:"bot",groupRole:2}];if(a.botIds)for(var n=0;n<a.botIds.length;n++)c.push({userId:a.botIds[n],groupRole:2});Kommunicate.client.createConversation({groupName:a.groupName||kommunicate._globals.conversationTitle||kommunicate._globals.groupName||kommunicate._globals.agentId,type:10,agentId:a.agentId,users:c,clientGroupId:a.clientGroupId},
f)},openConversationList:function(){window.$applozic.fn.applozic("loadTab","");KommunicateUI.showChat()},openConversation:function(a){window.$applozic.fn.applozic("loadGroupTab",a)},openDirectConversation:function(a){window.$applozic.fn.applozic("loadTab",a);KommunicateUI.showChat()},loadConversation:function(a,f){var c=(a.agentIds||[]).sort(function(a,f){return a.toLowerCase()<f.toLowerCase()?-1:a.toLowerCase()>f.toLowerCase()?1:0});console.log("agent list ",c);var n=a.botIds||[];if(1>c.length)return a=
{code:"INVALID_PARAMETERS",message:"required parameter agentIds is missing."},"function"==typeof f?f(a):console.log("required parameter agentIds is missing.");a=kommunicate._globals.userId||KommunicateUtils.getCookie("kommunicate-id");var r=c.join("_"),v=n.join("_"),g=encodeURIComponent(v?[r,a,v].join("_"):[r,a].join("_"));if(256<g.length)return a={code:"MEMBER_LIMIT_EXCEEDS",message:"try adding fewer members"},"function"==typeof f?f(a):console.log("member limit exceeds. try adding fewer members");
mckGroupService.getGroupFeed({clientGroupId:g,apzCallback:function(a){if("error"==a.status&&"AL-G-01"==a.code)a=c.map(function(a){return{userId:a,groupRole:1}}),a.push({userId:"bot",groupRole:2}),a.push(n.map(function(a){return{userId:a,groupRole:2}})),a={groupName:kommunicate._globals.conversationTitle||kommunicate._globals.groupName||kommunicate._globals.agentId,type:10,agentId:a[0].userId,users:a,clientGroupId:decodeURIComponent(g)},Kommunicate.client.createConversation(a,function(a){if(f)return f(null,
a)});else if("success"==a.status)return $applozic.fn.applozic("loadGroupTab",a.data.id),f(null,a)}})},createGroupName:function(a){return a.sort().join().replace(/,/g,"_").substring(0,250)},openLastConversation:function(a){var f=[],c=[];c.push(a.agentId);c.push(kommunicate._globals.userId);f.push({userId:a.agentId,groupRole:1});f.push({userId:"bot",groupRole:2});if(a.botIds){console.log(a.botIds);for(var n=0;n<a.botIds.length;n++)f.push({userId:a.botIds[n],groupRole:2}),c.push(a.botIds[n])}f=Kommunicate.createGroupName(c);
c={};c.groupName=f;c.callback=function(f){0<f.data.groups.length?(console.log("already have a group"),Kommunicate.openConversation(f.data.groups[0].id)):(console.log("new user"),Kommunicate.startConversation(a,function(a){}))};window.$applozic.fn.applozic("getGroupListByFilter",c)},createNewConversation:function(a,f){if("function"!==typeof f)throw Error("invalid callback! expected: Kommunicate.startNewConversation(options, callback) ");a={groupId:a.groupId,participantUserId:a.participantUserId,createdBy:a.participantUserId,
defaultAgentId:a.defaultAgentId,applicationId:a.applicationId};$applozic.ajax({url:Kommunicate.getBaseUrl()+"/conversations",type:"post",data:JSON.stringify(a),contentType:"application/json",success:function(a){console.log("conversation started successfully");f(null,a)},error:function(a){console.log("err while starting Conversation");f(a)}})},logout:function(a,f){"undefined"!==typeof window.$kmApplozic&&"undefined"!==typeof window.$kmApplozic.fn&&"undefined"!==typeof window.$kmApplozic.fn.applozic&&
window.$kmApplozic.fn.applozic("getLoggedInUser")&&window.$kmApplozic.fn.applozic("logout");"undefined"!==typeof window.$applozic&&"undefined"!==typeof window.$applozic.fn&&"undefined"!==typeof window.$applozic.fn.applozic&&window.$applozic.fn.applozic("getLoggedInUser")&&window.$applozic.fn.applozic("logout");sessionStorage.clear();localStorage.clear()},launchConversation:function(){window.$applozic.fn.applozic("mckLaunchSideboxChat")},triggerEvent:function(a,f){$applozic.ajax({url:Kommunicate.getBaseUrl()+
"/applications/events?type\x3d"+a,type:"post",data:JSON.stringify({conversationId:f.groupId,applicationId:f.applicationId}),contentType:"application/json",success:function(a){console.log("conversation triggering event")},error:function(a){console.log("err while starting Conversation")}})},updateUser:function(a){window.$applozic.fn.applozic("updateUser",{data:a})},getAwayMessage:function(a,f){$applozic.ajax({url:Kommunicate.getBaseUrl()+"/applications/"+a.applicationId+"/awaymessage?conversationId\x3d"+
a.conversationId,type:"get",contentType:"application/json",success:function(a){console.debug("got away message data");"function"==typeof f?f(null,a):""},error:function(a){console.log("err while fetching away message");"function"==typeof f?f(a):""}})},updateUserIdentity:function(a){window.$applozic.fn.applozic("updateUserIdentity",{newUserId:a,callback:function(f){KommunicateUtils.setCookie("kommunicate-id",a);"success"==f&&window.$applozic.fn.applozic("reInitialize",{userId:a})}})},isRichTextMessage:function(a){return a&&
300==a.contentType},getConatainerTypeForRichMessage:function(a){if(a)switch(a.templateId){case "2":case "4":return"km-slick-container";case "6":return"km-border-less-container";default:return"km-fixed-container"}},processPaymentRequest:function(a){},sendMessage:function(a){var f=$applozic("#mck-message-cell .mck-message-inner"),c=$applozic("#mck-msg-to");!0===f.data("isgroup")?a.groupId=c.val():a.to=c.val();f=Kommunicate.getSettings("KM_CHAT_CONTEXT");c=a.metadata||{};f&&(c={KM_CHAT_CONTEXT:f});a.metadata=
c;$applozic.fn.applozic("sendGroupMessage",a)},getRichTextMessageTemplate:function(a){if(a)switch(a.templateId){case "1":return Kommunicate.markup.getHotelRoomPaxInfoTemplate();case "2":return Kommunicate.markup.getHotelCardContainerTemplate(JSON.parse(a.hotelList||"[]"),a.sessionId);case "3":return Kommunicate.markup.buttonContainerTemplate(a);case "5":return Kommunicate.markup.getPassangerDetail(a);case "4":return Kommunicate.markup.getRoomDetailsContainerTemplate(JSON.parse(a.hotelRoomDetail||
"[]"),a.sessionId);case "6":return Kommunicate.markup.quickRepliesContainerTemplate(a);case "7":return Kommunicate.markup.getListContainerMarkup(a);case "8":return Kommunicate.markup.getDialogboxContainer(a);default:return""}else return""},updateSettings:function(a){var f=KommunicateUtils.getDataFromKmSession("settings");f=f?JSON.parse(f):{};for(var c in a)f[c]=a[c];KommunicateUtils.storeDataIntoKmSession("settings",JSON.stringify(f))},getSettings:function(a){var f=KommunicateUtils.getDataFromKmSession("settings");
f=f?JSON.parse(f):null;return a&&f?f[a]:f?f:""}});
Kommunicate.markup={getSingleRoomPaxInfo:function(a){return'\x3cdiv class \x3d "km-single-pax-info"\x3e\n    \x3cdiv class\x3d"km-room-title-text"\x3eROOM '+(a||"1")+'\x3c/div\x3e\n    \x3cdiv class\x3d"km-room-selector"\x3e\n        \x3cdiv\x3eGuest :\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x3c/div\x3e\n        \x3cdiv id\x3d ""\x3e\n            \x3cinput class \x3d"km-decrement-guest-count" type\x3d"button" value\x3d"-" data-type\x3d"guest"\x3e\n            \x3cinput type\x3d"number" min\x3d"1" max\x3d"5" value\x3d"1" class\x3d"km-room-number-field" maxlength\x3d"1" disabled\x3e\n            \x3cinput class \x3d"km-increment-guest-count" type\x3d"button" value\x3d"+" data-type\x3d"guest"\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"km-person-selector n-vis"\x3e\n        \x3cdiv class\x3d"km-children-text-lable"\x3eChildren :\x3cspan\x3e(1-12 yrs)\x3c/span\x3e\x3c/div\x3e\n        \x3cdiv\x3e\n            \x3cinput class \x3d"km-decrement-guest-count" type\x3d"button" value\x3d"-" data-type\x3d"children"\x3e\n            \x3cinput type\x3d"number" min\x3d"0" max\x3d"2" value\x3d"0" class\x3d"km-person-number-field" maxlength\x3d"1" disabled \x3e\n            \x3cinput class \x3d"km-increment-guest-count" type\x3d"button" value\x3d"+" data-type\x3d"children"\x3e\n        \x3c/div\x3e \n    \x3c/div\x3e\n\x3c/div\x3e'},getHotelCardTemplate:function(a,
f){var c={star1:"km-star-empty",star2:"km-star-empty",star3:"km-star-empty",star4:"km-star-empty",star5:"km-star-empty"};if(a.StarRating)for(var n=0;n<a.StarRating;n++)c["star"+(n+1)]="km-star-filled";return'\n    \x3cdiv class\x3d"km-single-card-message"\x3e\n        \x3cdiv class\x3d"km-card-message-header"\x3e\n            \x3cdiv class\x3d"km-card-message-image-continer"\x3e\x3cimg class \x3d"km-card-message-img" src \x3d'+a.HotelPicture+' /\x3e\n                    \x3cdiv class\x3d"km-card-message-image-price-container"\x3e'+
(("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(1*a.Price.OfferedPrice))+'\x3c/div\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"km-card-message-body"\x3e\n            \x3ch1 class\x3d"km-card-message-body-title"\x3e'+a.HotelName+'\x3c/h1\x3e\n            \x3cdiv class\x3d"km-card-message-body-ratings"\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
c.star1+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+c.star2+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
c.star3+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+c.star4+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n                \x3cspan\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24" class\x3d"'+
c.star5+'"\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                        \x3cpath d\x3d"M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e\n            \x3c/div\x3e\n            \x3cdiv class\x3d"km-card-message-body-address"\x3e\n                \x3cspan class\x3d"km-card-message-body-address-icon"\x3e\n                    \x3csvg xmlns\x3d"http://www.w3.org/2000/svg"  height\x3d"24" viewBox\x3d"0 0 24 24" width\x3d"24"\x3e\n                        \x3cpath d\x3d"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/\x3e\n                        \x3cpath d\x3d"M0 0h24v24H0z" fill\x3d"none"/\x3e\n                    \x3c/svg\x3e\n                \x3c/span\x3e'+
a.HotelAddress+'\n            \x3c/div\x3e\n        \x3c/div\x3e\n        \x3cdiv class\x3d"km-card-message-footer"\x3e\n            \x3cbutton class\x3d"km-card-message-footer-button" data-resultindex\x3d '+a.ResultIndex+" data-sessionid\x3d "+f+" data-name\x3d "+a.HotelName.replace(" ","_")+" \x3e Get Room Details\x3c/button\x3e\n        \x3c/div\x3e\n    \x3c/div\x3e"},getRoomDetailTemplate:function(a,f){return'\x3cdiv class\x3d"km-single-card-message"\x3e\n                \x3cdiv class\x3d"message received km-blocked-room"\x3e\n                    \x3cdiv class\x3d"km-blocked-room-details"\x3e\n                    \x3cdiv class\x3d"km-card-message-image-continer"\x3e\x3cimg class \x3d"km-card-message-img" src\x3d'+
a.HotelPicture+" alt\x3d"+a.HotelName+'\x3e\x3c/div\x3e\n                        \x3cdiv class\x3d"km-blocked-room-text-container"\x3e\n                            \x3cdiv class\x3d"km-blocked-room-room-type"\x3e\n                                \x3cspan\x3eRoom Type: \x3c/span\x3e \x3cspan\x3e '+a.RoomTypeName+'\x3c/span\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-guests"\x3e\n                                \x3cspan\x3eGuests:\x3c/span\x3e\x3cspan\x3e'+
("undefined"==a.NoOfGuest?1:a.NoOfGuest)+' \x3c/span\x3e\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-price"\x3e\n                                \x3cp\x3ePrice:\x3cbr\x3e\x3cspan\x3e(Per Room Per Night)\x3c/span\x3e\x3c/p\x3e\n\n                                \x3cspan\x3e'+("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(a.DayRates.Amount?a.DayRates.Amount:a.Price.RoomPrice)+'\x3c/span\x3e\n\n                            \x3c/div\x3e\n                            \x3cdiv class\x3d"km-blocked-room-sub-total"\x3e\n                                \x3cp\x3eTotal:\x3cbr\x3e\x3cspan\x3e(1 Room for '+
a.NoOfNights+" Nights)\x3c/span\x3e\x3c/p\x3e\n                                \x3cspan\x3e "+("INR"==a.Price.CurrencyCode?"\x26#x20B9;":a.Price.CurrencyCode)+" "+Math.ceil(a.Price.RoomPrice)+' \x3c/span\x3e\n                            \x3c/div\x3e\n                        \x3c/div\x3e\n                        \x3cdiv class\x3d"km-blocked-room-button-container"\x3e\n                            \x3cbutton class\x3d"km-block-room-button" data-sessionId\x3d '+f+" data-roomIndex\x3d"+a.RoomIndex+" data-NoOfRooms\x3d"+
a.NoOfRooms+" data-NoOfNights\x3d"+a.NoOfNights+" data-HotelName\x3d "+a.HotelName.replace(" ","_")+" data-HotelResultIndex\x3d "+a.HotelResultIndex+" \x3eBook\x3c/button\x3e\n                        \x3c/div\x3e\n                    \x3c/div\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e"},getButtonTemplate:function(a,f){return"link"==a.type?'\x3cbutton data-eventhandlerid\x3d"'+a.handlerId+'" class\x3d"km-cta-button km-add-more-rooms km-undecorated-link '+f+'"\x3e\x3ca href \x3d"'+
a.url+'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e\x3c/button\x3e":'\x3cbutton data-eventhandlerid\x3d"'+a.handlerId+'" class\x3d"km-cta-button km-add-more-rooms '+f+'"\x3e'+a.name+"\x3c/button\x3e"},getQuickRepliesTemplate:function(a,f){return'\x3cbutton title\x3d"'+a.message+'" class\x3d"km-cta-button km-add-more-rooms km-quick-replies '+f+'"\x3e'+a.title+"\x3c/button\x3e"},getPassangerDetail:function(a){a.sessionId||console.log("sessionId not present in message..");return'  \x3cdiv class\x3d"km-guest-details-container km-rich-text-default-container"\x3e\n                \x3cdiv class\x3d"km-guest-detail-form"\x3e\n                    \x3cdiv class\x3d "km-select-title"\x3e    \n                        \x3cselect name\x3d"title" class\x3d"km-title-select"\x3e\n                            \x3coption value\x3d"0" disabled selected\x3eTitle *\x3c/option\x3e\n                            \x3coption value\x3d"Mr."\x3eMr.\x3c/option\x3e\n                            \x3coption value\x3d"Ms."\x3eMs.\x3c/option\x3e\n                            \x3coption value\x3d"Mrs."\x3eMrs.\x3c/option\x3e\n                        \x3c/select\x3e\n                    \x3c/div\x3e\n                    \x3cinput type\x3d"number" name\x3d"age"  class\x3d"km-input km-age-input n-vis" placeholder\x3d"Age *" min\x3d"0" max\x3d"150"\x3e\n                    \x3cinput type\x3d"text" name\x3d"first-name"  class\x3d"km-input first-name-input km-pxinfo-btn-left" placeholder\x3d"First Name *"  required\x3e\n                    \x3cinput type\x3d"text" name\x3d"middle-name"  class\x3d"km-input middle-name-input n-vis" placeholder\x3d"Middle Name (optional) "\x3e\n                    \x3cinput type\x3d"text" name\x3d"last-name"  class\x3d"km-input last-name-input km-pxinfo-btn-left" placeholder\x3d"Last Name *"  required\x3e\n                    \x3cinput type\x3d"email" name\x3d"email"  class\x3d"km-input e-mail-input km-pxinfo-btn-left" placeholder\x3d"Email Id *" required\x3e\n                    \x3cinput type\x3d"text" name\x3d"contact-no"  class\x3d"km-input number-input km-pxinfo-btn-left" placeholder\x3d"Contact Number *" required \x3e\n                    \x3cdiv class\x3d "km-mandatory-field-error n-vis"\x3e\x3cspan\x3e All fields are mandatory.\x3c/span\x3e\x3c/div\x3e\n                \x3c/div\x3e\n                \x3cdiv class\x3d"km-guest-button-container"\x3e\n                    \x3cbutton class\x3d"km-add-more-rooms km-submit-person-detail" data-sessionid\x3d '+
a.sessionId+"\x3eSubmit\x3c/button\x3e\n                \x3c/div\x3e\n            \x3c/div\x3e\n            "},getListMarkup:function(){return'\x3cdiv class\x3d"km-message km-received km-chat-faq-list" style\x3d""\x3e\n     \x3cdiv class\x3d"km-faq-list--container"  \x3e\n             \x3cdiv class\x3d"km-faq-list--header"\x3e\n                     {{{headerImgSrc}}}\n                     \x3cdiv class\x3d"km-faq-list--header_text-container"\x3e\n                                     {{{headerText}}}\n                         \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-list--body"\x3e\n             \x3cdiv class\x3d"km-faq-list--body_list-container"\x3e\n                 \x3cul class\x3d"km-faq-list--body_list {{elementClass}}"\x3e\n                     {{#elements}}\n                     \x3cli class \x3d{{hadlerClass}} data-type\x3d"{{dataType}}" data-reply \x3d "{{dataReply}}" data-articleid\x3d "{{dataArticleId}}" data-source\x3d"{{source}}"\x3e \x3ca href\x3d{{href}} target\x3d"_blank" class\x3d"km-undecorated-link" \x3e\n                             \x3cdiv class\x3d"km-faq-list--body_img"\x3e\n                                     {{{imgSrc}}}\n                             \x3c/div\x3e\n                         \x3cdiv class\x3d"km-faq-list--body_que-ans"\x3e\n                                 \x3cp class\x3d"km-faq-list--body_que"\x3e\n                                     {{title}}\n                                 \x3c/p\x3e\n                                 \x3cp class\x3d"km-faq-list--body_ans"\x3e\n                                     {{description}}\n                                 \x3c/p\x3e\n                             \x3c/div\x3e\n                         \x3c/a\x3e\n                     \x3c/li\x3e\n                     {{/elements}}\n                 \n                 \x3c/ul\x3e\n             \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-list--footer"\x3e\n                 \x3cdiv class\x3d"km-faq-list--footer_button-container"\x3e\n                         {{#buttons}}\n                         \x3cbutton class\x3d"km-cta-button km-add-more-rooms {{hadlerClass}}" data-type \x3d"{{dataType}}" data-reply\x3d"{{dataReply}}"\x3e\x3ca class \x3d"km-undecorated-link" href \x3d"{{href}}" target\x3d"_blank"\x3e{{name}}\x3c/a\x3e\x3c/button\x3e\n                         {{/buttons}}\n                     \n             \x3c/div\x3e\n         \x3c/div\x3e\n     \x3c/div\x3e'},
getDialogboxTemplate:function(){return'\x3cdiv class\x3d"km-message km-received km-faq-answer"\x3e\n     \x3cdiv class\x3d"km-faq-answer--container"\x3e\n         \x3cdiv class\x3d"km-faq-answer--body"\x3e\n             \x3cdiv class\x3d"km-faq-answer--body_container"\x3e\n                 \x3cp class\x3d"km-faq-answer--body_que"\x3e{{title}}\x3c/p\x3e\n                 \x3cp class\x3d"km-faq-answer--body_ans"\x3e {{{description}}} \x3c/p\x3e\n             \x3c/div\x3e\n         \x3c/div\x3e\n         \x3cdiv class\x3d"km-faq-answer--footer"\x3e\n             \x3cdiv class\x3d"km-faq-answer--footer_button-text-container"\x3e\n                 \x3cp\x3e{{buttonLabel}}\x3c/p\x3e\n                 {{#buttons}}\n                 \x3cbutton class\x3d"km-faq-dialog-button km-quick-replies km-cta-button km-add-more-rooms" data-reply\x3d"{{name}}"\x3e{{name}}\x3c/button\x3e\n                {{/buttons}}\n             \x3c/div\x3e\n         \x3c/div\x3e\n     \x3c/div\x3e\n \x3c/div\x3e'}};
Kommunicate.markup.buttonContainerTemplate=function(a){for(var f='\x3cdiv class\x3d"km-cta-multi-button-container"\x3e',c=JSON.parse(a.payload),n=c?JSON.parse(a.formData||"{}"):"",r=1==c.length?"km-cta-button-1":2==c.length?"km-cta-button-2":"km-cta-button-many",v=0;v<c.length;v++)f+=Kommunicate.markup.getButtonTemplate(c[v],r);if(n){f+="\x3cform method \x3d'post'  target\x3d'_blank' class\x3d km-btn-hidden-form action \x3d"+a.formAction+"\x3e";for(var g in n)n.hasOwnProperty(g)&&(f+='\x3cinput type\x3d"hidden" name \x3d"'+
g+'" value\x3d"'+n[g]+'" /\x3e');f+="\x3c/form\x3e"}return f+"\x3c/div\x3e"};Kommunicate.markup.quickRepliesContainerTemplate=function(a){var f='\x3cdiv class\x3d"km-cta-multi-button-container"\x3e';a=JSON.parse(a.payload);for(var c=1==a.length?"km-cta-button-1":2==a.length?"km-cta-button-2":"km-cta-button-many",n=0;n<a.length;n++)f+=Kommunicate.markup.getQuickRepliesTemplate(a[n],c);return f+"\x3c/div\x3e"};
Kommunicate.markup.getHotelRoomPaxInfoTemplate=function(a){return'\x3cdiv class \x3d "km-rich-text-default-container"\x3e\n            \x3cdiv class\x3d"km-room-person-selector-container"\x3e'+Kommunicate.markup.getSingleRoomPaxInfo(a)+'\x3c/div\x3e\n            \x3chr\x3e\n            \x3cdiv class\x3d"km-add-room-button-container"\x3e\n                \x3cbutton  class\x3d"km-add-more-rooms km-btn-add-more-rooms" data-roomcount\x3d1\x3eADD ROOM\x3c/button\x3e\n                \x3cbutton class\x3d" km-add-more-rooms km-done-button"\x3eDONE\x3c/button\x3e\n            \x3c/div\x3e\n        \x3c/div\x3e'};
Kommunicate.markup.getHotelCardContainerTemplate=function(a,f){for(var c="",n=0;n<a.length;n++)c+=Kommunicate.markup.getHotelCardTemplate(a[n],f);return'\x3cdiv class\x3d"km-card-message-container  km-div-slider"\x3e'+c+"\x3c/div\x3e"};Kommunicate.markup.getRoomDetailsContainerTemplate=function(a,f){a=a.HotelRoomsDetails;for(var c="",n=0;n<a.length;n++)c+=Kommunicate.markup.getRoomDetailTemplate(a[n],f);return'\x3cdiv class\x3d"km-card-room-detail-container  km-div-slider"\x3e'+c+"\x3c/div\x3e"};
Kommunicate.markup.getListContainerMarkup=function(a){return a&&a.payload?(a=JSON.parse(a.payload),a.headerImgSrc&&(a.headerImgSrc='\x3cdiv class\x3d"km-faq-list--header_text-img"\x3e\x3cimg src\x3d '+a.headerImgSrc+"/\x3e\x3c/div\x3e"),a.headerText&&(a.headerText='\x3cp class\x3d"km-faq-list--header_text"\x3e'+a.headerText+"\x3c/p\x3e"),a.elements&&a.elements.length?(a.elementClass="vis",a.elements=a.elements.map(function(a){a.imgSrc&&(a.imgSrc="\x3cimg src \x3d"+a.imgSrc+"/\x3e");a.action&&"link"==
a.action.type?a.href=a.action.url:(a.href="javascript:void(0)",a.hadlerClass="km-list-item-handler");a.action&&(a.dataType=a.action.type||"",a.dataReply=a.action.text||a.title||"");a.dataArticleId=a.articleId||"";a.dataSource=a.source||"";return a})):a.elementClass="n-vis",a.buttons&&a.buttons.length&&(a.buttons=a.buttons.map(function(a){a.action&&"quick_reply"!=a.action.type&&"submit"!=a.action.type?a.href=a.action.url:(a.href="javascript:void(0)",a.hadlerClass="km-list-button-item-handler");a.dataType=
a.action.type||"";a.dataReply=a.action.text||a.name||"";return a})),Mustache.to_html(Kommunicate.markup.getListMarkup(),a)):""};Kommunicate.markup.getDialogboxContainer=function(a){return a&&a.payload?(a=JSON.parse(a.payload),Mustache.to_html(Kommunicate.markup.getDialogboxTemplate(),a)):""};var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(a,f,c){function n(g){var k=this,n,p;MCK_GROUP_MAP=[];var O=[],ka,ib,Gb=!0,Ja=[],na=0;MCK_CLIENT_GROUP_MAP=[];var Ka=!1,ta=[],La=[],Da=90,ya=[],ba=[],ca=[],da=[],Hb=!0,X=0,Ib=g.mode;MCK_LABELS=g.labels;MCK_BASE_URL=g.baseUrl;var dc=g.customFileUrl,Ac=g.customUploadUrl,Z=g.appId,Jb=[],Kb=[0,1,2,3],Lb=[1,2,5,6,10],za=[],tb=!1,rb=g.launcher,jb=g.visitor,ec=g.userName,sb=g.locShare,Sa=g.video,Ma=g.fileBaseUrl,U=g.onInit,Mb=g.onTopicDetails,Bc=[0,1,2],Nb=g.onClose,Ob=g.displayText,N=g.password||
g.accessToken,kb=g.readConversation,oa=g.maxGroupSize,Pb=g.onTabClicked,fc=g.contactNumber,Aa=g.maxAttachmentSize,yb=g.appModuleName,Ta=g.getTopicDetail,Qb=g.contactDisplayName,Rb=g.validateMessage,Za=g.finalPriceResponse,$a=g.contactDisplayImage,Sb=g.priceWidget,pa=g.openGroupSettings,ua=g.offlineMessageDetail,zb=g.authenticationTypeId,Tb=g.getConversationDetail,Cc=g.notificationIconLink,gc=g.mapStaticAPIkey,Ub=g.unreadCountOnchatLauncher,hc=g.chatLauncherHtml,Na=g.fileupload,ic=g.notificationSoundLink?
g.notificationSoundLink:Kommunicate.getBaseUrl()+"/plugin/audio/notification_tone.mp3",C=jb?"guest":a.trim(g.userId),jc=sb?g.googleApiKey:"NO_ACCESS",Dc="undefined"===typeof g.source?1:g.source,ab="boolean"===typeof g.topicBox?g.topicBox:!1,Ab="boolean"===typeof g.olStatus?g.olStatus:!1,kc="boolean"===typeof g.messageBubbleAvator?g.messageBubbleAvator:!0,ub="boolean"===typeof g.showOfflineMessage?g.showOfflineMessage:!1,lc="boolean"===typeof g.hideGroupSubtitle?g.hideGroupSubtitle:!1,mc="undefined"===
typeof g.defaultMessageMetaData?{}:g.defaultMessageMetaData,Vb="boolean"===typeof g.groupUserCount?g.groupUserCount:!1,nc="boolean"===typeof g.checkUserBusyWithStatus?g.checkUserBusyWithStatus:!1,oc="boolean"===typeof g.resetUserStatus?g.resetUserStatus:!1,Oa="boolean"===typeof g.topicHeader?g.topicHeader:!1,pc=g.supportId?'data-mck-id\x3d"'+g.supportId+'"':"",Wb="boolean"===typeof g.loadOwnContacts?g.loadOwnContacts:!1,qc="boolean"===typeof g.desktopNotification?g.desktopNotification:!0,rc="boolean"===
typeof g.notification?g.notification:!0,sc="boolean"===typeof g.autoTypeSearchEnabled?g.autoTypeSearchEnabled:!0,Bb="boolean"===typeof g.launchOnNewMessage?g.launchOnNewMessage:!1,Xb="boolean"===typeof g.launchOnUnreadMessage?g.launchOnUnreadMessage:!1,tc="number"===typeof g.userTypeId?g.userTypeId:!1,R=["DEFAULT","NEW","OPEN"],uc=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],Y={},lb=[],bb=[],Ua={},Ea=[],Pa=[],cb=[],Fa=[],mb=new function(){var b=this,g=!1,x,k,W=a("#mck-file-menu"),vb=
a("#mck-message-cell .mck-message-inner");a("#mck-tab-individual");var F=Da;b.getLauncherHtml=function(){return hc?'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher launchershadow"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher"\x3e'+hc+"\x3c/a\x3e\x3c/div\x3e":'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher mck-button-launcher" '+("support"===Ib?pc:"")+'\x3e\x3cdiv\x3e\x3csvg xmlns\x3d"http://www.w3.org/2000/svg" xmlns:xlink\x3d"http://www.w3.org/1999/xlink" version\x3d"1.1" id\x3d"Layer_1" x\x3d"0px" y\x3d"0px" viewBox\x3d"0 0 500 500" style\x3d"enable-background:new 0 0 500 500;" xml:space\x3d"preserve"\x3e\n              \x3cstyle type\x3d"text/css"\x3e\n                  .km-launcher-logo-0{fill:url(#km-launcher-logo-gradient-1);}\n                  .km-launcher-logo-1{fill:#FFFFFF;}\n              \x3c/style\x3e\n              \x3cg\x3e\n                  \x3clinearGradient id\x3d"km-launcher-logo-gradient-1" gradientUnits\x3d"userSpaceOnUse" x1\x3d"3.367313e-08" y1\x3d"250" x2\x3d"500" y2\x3d"250"\x3e\n                      \x3cstop offset\x3d"0" style\x3d"stop-color:#3A3C80"/\x3e\n                      \x3cstop offset\x3d"0.1658" style\x3d"stop-color:#4B4C93"/\x3e\n                      \x3cstop offset\x3d"0.3516" style\x3d"stop-color:#5858A2"/\x3e\n                      \x3cstop offset\x3d"0.5063" style\x3d"stop-color:#5C5CA7"/\x3e\n                      \x3cstop offset\x3d"0.6795" style\x3d"stop-color:#53549D"/\x3e\n                      \x3cstop offset\x3d"0.9706" style\x3d"stop-color:#3D3E83"/\x3e\n                      \x3cstop offset\x3d"1" style\x3d"stop-color:#3A3C80"/\x3e\n                  \x3c/linearGradient\x3e\n                  \x3ccircle class\x3d"km-launcher-logo-0" cx\x3d"250" cy\x3d"250" r\x3d"250"/\x3e\n                  \x3cg\x3e\n                      \x3cpath class\x3d"km-launcher-logo-1" d\x3d"M377.5,379.6V237.1c0-51.4-41.7-93.1-93.1-93.1h-84.7c-51.4,0-93.1,41.7-93.1,93.1    c0,51.4,41.7,93.1,93.1,93.1h91.7c0,0,7.4,0.4,11.9,2.1c4.3,1.6,9.1,5.3,9.1,5.3l56.7,46.7c0,0,5.2,4.4,7,3.5    C377.9,386.9,377.5,379.6,377.5,379.6z M202.2,256.2c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-40    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V256.2z M254.1,275c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-77.8    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V275z M306,256.2c0,6.2-5.4,11.2-12.1,11.2c-6.7,0-12.1-5-12.1-11.2v-40    c0-6.2,5.4-11.2,12.1-11.2c6.7,0,12.1,5,12.1,11.2V256.2z"/\x3e\n                  \x3c/g\x3e\n              \x3c/g\x3e\n              \x3c/svg\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
b.initializeApp=function(f,c){g=c;c={applicationId:f.appId,userId:C};null!==ec&&(c.displayName=f.userName);null!==f.email&&(c.email=f.email);null!==fc&&(c.contactNumber=f.contactNumber);f.imageLink&&(c.imageLink=f.imageLink);f.appModuleName&&(c.appModuleName=f.appModuleName);N&&(c.password=f.accessToken);-1===Bc.indexOf(zb)&&(zb=0);oc&&(c.resetUserStatus=!0);"number"==typeof tc&&(c.userTypeId=tc);c.enableEncryption=!0;c.appVersionCode=108;c.authenticationTypeId=zb;c.chatNotificationMailSent=!0;ka=
p="";if(b.validateAppSession(c))Sa&&la.InitilizeVideoClient(C,ka);else if(f={name:"km-userName",email:"km-email",phone:"km-contact"},Yb||0===Ga.length)b.initialize(c);else{a("#km-userId").val(C);if(0<Ga.length)for(c=0;c<Ga.length;c++)a("#"+f[Ga[c]]).removeClass("n-vis").addClass("vis"),a("#"+f[Ga[c]]).prop("required",!0);a("#km-chat-login-modal").css("display","block")}};b.initialize=function(f){window.Applozic.ALApiService.login({data:{alUser:f,baseUrl:MCK_BASE_URL},success:function(c){Sa&&la.InitilizeVideoClient(c.userId,
c.deviceKey);"kommunicate"==window.applozic.PRODUCT_ID&&a("#km-chat-login-modal").css("display","none");ALStorage.clearMckMessageArray();ALStorage.clearMckContactNameArray();"INVALID_PASSWORD"===c?"function"===typeof U&&U({status:"error",errorMessage:"INVALID PASSWORD"}):"INVALID_APPID"===c?"function"===typeof U&&U({status:"error",errorMessage:"INVALID APPLICATION ID"}):"error"===c||"USER_NOT_FOUND"===c?"function"===typeof U&&U({status:"error",errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===
c?"function"===typeof U&&U({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof c&&null!==c&&c.token?(c.appId=f.applicationId,N&&(c.accessToken=f.password),b.onInitApp(c)):"function"===typeof U&&U({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})},error:function(){ALStorage.clearMckMessageArray();"function"===typeof U&&U({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})};b.onInitApp=function(c){b.appendLauncher();b.setLabels();a(".applozic-launcher").each(function(){a(this).hasClass("mck-msg-preview")||
a(this).show()});n=c.token;P.setEncryptionKey(c.encryptionKey);C=c.userId;ka=c.deviceKey;ib=c.websocketUrl;Da=c.websocketIdleTimeLimit;Ma=c.fileBaseUrl;tb=c.deactivated;p=btoa(c.userId+":"+c.deviceKey);window.Applozic.ALApiService.setAjaxHeaders(p,Z,ka,N,yb);X=c.totalUnreadCount;P.badgeCountOnLaucher(Ub,X);jb||"guest"===C||"0"===C||"C0"===C||(g?fa.reconnect():fa.init());m.createContactWithDetail({userId:C,displayName:c.displayName,photoLink:c.imageLink});a.ajaxPrefilter(function(a){a.beforeSend||
-1===a.url.indexOf(MCK_BASE_URL)||(a.beforeSend=function(a){b.setHeaders(a)})});if(c.betaPackage){var l="https://www.kommunicate.io/?utm_source\x3d"+f.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";a(".mck-running-on a").attr("href",l);a(".mck-running-on").removeClass("n-vis").addClass("vis")}l=ALStorage.getMckContactNameArray();if(null!==l&&0<l.length)for(var k=0;k<l.length;k++){var x=l[k];null!==x&&(Ea[x[0]]=x[1])}va.checkUserConnectedStatus(function(a){0<a.length?ea.getUsersDetail(a,
{setStatus:!0}):Ba.updateUserConnectedStatus()});"function"===typeof U&&U("success",c);mb.tabFocused();0<Qa.length&&0<X&&Qa.html(X);Xb&&A.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});I.init(c);ea.loadContacts();vc.subscribeToServiceWorker();ALStorage.setAppHeaders(c);y.loadGroups({apzCallback:w.loadGroups});Yb||a.fn.applozic("mckLaunchSideboxChat");Kommunicate.postPluginInitialization(null,c);f.dispatchEvent(new CustomEvent("kmInitilized",{detail:c,bubbles:!0,cancelable:!0}))};b.validateAppSession=
function(a){w.init();m.init();var f=ALStorage.getAppHeaders();if(f&&f.userId){if(a.applicationId===f.appId&&a.userId===f.userId&&a.password===f.accessToken)return b.onInitApp(f),!0;ALStorage.clearAppHeaders()}return!1};b.setHeaders=function(a){a.setRequestHeader("UserId-Enabled",!0);p&&a.setRequestHeader("Authorization","Basic "+p);a.setRequestHeader("Application-Key",Z);ka&&a.setRequestHeader("Device-Key",ka);N&&a.setRequestHeader("Access-Token",N);yb&&a.setRequestHeader("App-Module-Name",yb)};b.setLabels=
function(){a("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);a("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",MCK_LABELS["start.new"]);a("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]);a("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]);a("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",
MCK_LABELS["search.placeholder"]);a("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]);a("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]);a("#mck-no-messages").html(MCK_LABELS["empty.messages"]);a("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]);a("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]);a("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);a("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);a("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",
MCK_LABELS["create.group.title"]);a("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);a("#mck-msg-error").html(MCK_LABELS["group.deleted"]);a("#mck-gc-title-label").html(MCK_LABELS["group.title"]);a("#mck-gc-type-label").html(MCK_LABELS["group.type"]);a("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);a("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);a("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",
MCK_LABELS["members.title"]);a("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",MCK_LABELS["add.members.title"]);a("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);a("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);a("#mck-typing-label").html(MCK_LABELS.typing);a("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",
MCK_LABELS["clear.messages"]);a("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);a("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]);a("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);a("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);a("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);a(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);
a("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);a("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",MCK_LABELS.close);a("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send);a("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);a("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);a("#mck-group-name-save").attr("title",MCK_LABELS.save);a("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);a("#mck-group-name-edit").attr("title",
MCK_LABELS.edit)};a(c).on("click",".fancybox",function(b){b=a(this);if(-1!==b.data("type").indexOf("video")){var f=b.find(".mck-video-box").html(),c;b.fancybox({content:f,title:b.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){c=a(".fancybox-inner").find("video").get(0);c.load();c.play()}})}else b=b.data("url"),a(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:b,type:"image"})});
a(f).on("resize",function(){"block"===W.css("display")&&Zb.fileMenuReposition();if(0===vb.find(".mck-contact-list").length){var a=vb.get(0).scrollHeight;vb.height()<a&&vb.animate({scrollTop:vb.prop("scrollHeight")},0)}});b.appendLauncher=function(){a("#mck-sidebox-launcher").remove();a("body").append(b.getLauncherHtml());Cb.init()};b.tabFocused=function(){function a(a){var c={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};a=a||f.event;(Hb=a.type in c?c[a.type]:this.hidden?!1:!0)?
(1>F&&Gb&&fa.checkConnected(!0),b.stopIdleTimeCounter()):(1===na&&fa.sendTypingStatus(0),b.manageIdleTime())}"hidden"in c?c.addEventListener("visibilitychange",a):!1 in c?c.addEventListener("mozvisibilitychange",a):!1 in c?c.addEventListener("webkitvisibilitychange",a):!1 in c?c.addEventListener("msvisibilitychange",a):"onfocusin"in c?c.onfocusin=c.onfocusout=a:f.onpageshow=f.onpagehide=f.onfocus=f.onblur=a;void 0!==c.hidden&&a({type:c.hidden?"blur":"focus"})};b.manageIdleTime=function(){F=Da;x&&
clearInterval(x);x=setInterval(function(){0>--F&&(F=0,fa.stopConnectedCheck(),clearInterval(x),x="")},6E4)};b.stopIdleTimeCounter=function(){F=Da;x&&clearInterval(x);x=""};b.manageOfflineMessageTime=function(a){if("object"!==typeof ua||isNaN(ua.timeout))f.console.log("Offline message timeout required.");else{if(1===ua.type){if(!ua.userIds||0===ua.userIds.length){f.console.log("Offline message userIds required.");return}if(-1===ua.userIds.indexOf(a))return}k&&clearInterval(k);k=setTimeout(function(){clearInterval(k);
k="";m.showOfflineMessage()},5E3*parseInt(ua.timeout))}};b.stopOfflineMessageCounter=function(){k&&clearInterval(k);k=""}},P=new MckUtils,Zb=new function(){var b=this,c="",m="",g=!1,k=a("#mck-my-loc"),n=a("#mck-loc-box"),F=a("#mck-loc-lat"),S=a("#mck-loc-lon"),ia=a("#mck-btn-loc"),K=a("#mck-sidebox-ft"),H=a("#mck-file-menu"),p=a("#mck-btn-attach"),r=a("#mck-map-content"),w=a("#mck-loc-address");b.init=function(){sb&&f.google&&"object"===typeof f.google.maps&&(c=new f.google.maps.Geocoder,p.on("click",
function(){b.fileMenuToggle()}),ia.on("click",function(){g?n.mckModal():(mckMapUtils.getCurrentLocation(b.onGetCurrLocation,b.onErrorCurrLocation),g=!0)}));k.on("click",function(){mckMapUtils.getCurrentLocation(b.onGetMyCurrLocation,b.onErrorMyCurrLocation)})};b.fileMenuReposition=function(){var a=K.offset();a.bottom=f.innerHeight-a.top;H.css({bottom:51<a.bottom?a.bottom:51,right:0})};b.fileMenuToggle=function(){p.hasClass("on")?(p.removeClass("on"),H.hide()):(b.fileMenuReposition(),p.addClass("on"),
H.show())};b.onGetCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;b.openMapBox()};b.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;b.openMapBox()};b.onErrorMyCurrLocation=function(a){alert("Unable to retrieve your location. ERROR("+a.code+"): "+a.message)};b.onGetMyCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;F.val(MCK_CURR_LATITIUDE);S.val(MCK_CURR_LONGITUDE);
F.trigger("change");S.trigger("change");m?w.val(m):c&&c.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(a,b){"OK"===b&&a[1]&&(m=a[1].formatted_address)})};b.openMapBox=function(){r.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:F,longitudeInput:S,locationNameInput:w},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(a){MCK_CURR_LATITIUDE=a.latitude;MCK_CURR_LONGITUDE=
a.longitude}});n.on("shown.bs.mck-box",function(){r.locationpicker("autosize")});n.mckModal()}},Ba=new function(){var b=a("#mck-msg-form"),c=a("#mck-msg-error"),m=a("#mck-tab-title"),g=a("#mck-tab-status"),k=a(".mck-typing-box"),n=a("#mck-block-button"),p=a("#mck-message-cell .mck-message-inner");this.updateUserConnectedStatus=function(){a(".mck-user-ol-status").each(function(){var b=a(this),f=b.data("mck-id");if(f){var c=ya[f];"undefined"!==typeof ya[f]&&c.connected?(b.removeClass("n-vis").addClass("vis"),
b.next().html("("+MCK_LABELS.online+")")):(b.removeClass("vis").addClass("n-vis"),b.next().html("(Offline)"))}})};this.lastSeenOfGroupOfTwo=function(a){f.MCK_OL_MAP[a]?(g.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),g.removeClass("n-vis").addClass("vis")):ca[a]&&(a=mckDateUtils.getLastSeenAtStatus(ca[a]),g.html(a),g.attr("title",a),m.addClass("mck-tab-title-w-status"),g.removeClass("n-vis").addClass("vis"))};this.toggleBlockUser=function(a,l){l?(c.html(MCK_LABELS.blocked),c.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),
b.removeClass("vis").addClass("n-vis"),m.removeClass("mck-tab-title-w-status"),g.removeClass("vis").addClass("n-vis"),k.removeClass("vis").addClass("n-vis"),p.data("blocked",!0),n.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"])):(c.html(""),c.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),b.removeClass("n-vis").addClass("vis"),p.data("blocked",!1),n.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),La[a]||!f.MCK_OL_MAP[a]&&!ca[a]||(f.MCK_OL_MAP[a]?
g.attr("title",MCK_LABELS.online).html(MCK_LABELS.online):ca[a]&&(a=mckDateUtils.getLastSeenAtStatus(ca[a]),g.html(a),g.attr("title",a)),m.addClass("mck-tab-title-w-status"),g.removeClass("n-vis").addClass("vis")))}};new function(){var b=a("#mck-msg-to");a("#mck-btn-loc");var c=a("#mck-loc-box"),g=a("#mck-msg-sbmt"),m=a("#mck-msg-error"),k=a("#mck-loc-submit"),n=a("#mck-msg-response"),p=a("#mck_response_text"),S=a("#mck-message-cell .mck-message-inner");k.on("click",function(){var a={type:5,contentType:2,
message:f.JSON.stringify(mckMapUtils.getSelectedLocation())},l=S.data("mck-conversationid"),k=S.data("mck-topicid");l?a.conversationId=l:k&&(l={topicId:k},k=ba[k],"object"===typeof k&&(l.topicDetail=f.JSON.stringify(k)),a.conversationPxy=l);!0===S.data("isgroup")?a.groupId=b.val():a.to=b.val();g.attr("disabled",!0);m.removeClass("vis").addClass("n-vis");m.html("");p.html("");n.removeClass("vis").addClass("n-vis");A.sendMessage(a);c.mckModal("hide")})};var y=new MckGroupService,D=new MckGroupUtils,
w=new function(){var b=this,g={0:MCK_LABELS.user,1:MCK_LABELS.admin,2:MCK_LABELS.moderator,3:MCK_LABELS.member},k=document.getElementById("mck-group-create-type");k.options[k.options.length]=new Option(MCK_LABELS["public"],"1");k.options[k.options.length]=new Option(MCK_LABELS["private"],"2");k.options[k.options.length]=new Option(MCK_LABELS.open,"6");var n=a("#mck-msg-form"),W=a("#mck-msg-error"),p=a("#mck-tab-title"),F=a("#mck-tab-status"),S=a("#mck-no-gsm-text"),ia=a("#mck-gms-loading"),K=a("#mck-contact-loading");
a("#mck-tab-menu-box");a("#mck-search-loading");var H=a("#mck-group-info-tab"),r=a("#mck-sidebox-search");a("#mck-group-name-box");var Ec=a("#mck-group-back-link"),v=a("#mck-group-name-edit"),J=a("#mck-group-name-save"),I=a("#mck-sidebox-content"),Q=a("#mck-tab-option-panel"),u=a("#mck-btn-group-create"),ha=a("#mck-group-create-tab"),L=a("#mck-contacts-content"),Wa=a("#mck-btn-group-update"),M=a("#mck-group-create-type"),wb=a("#mck-group-icon-upload"),Fc=a("#mck-group-icon-change"),$b=a("#mck-group-member-list"),
O=a("#mck-group-update-panel"),X=a(".mck-tab-message-option"),Z=a("#mck-group-create-title"),db=a(".mck-group-menu-options"),Ca=a("#mck-group-member-search"),ra=a("#mck-btn-group-icon-save");a("#mck-group-info-icon-box");var Gc=a(".mck-group-admin-options"),Db=a("#mck-group-add-member-box"),aa=a("#mck-message-cell .mck-message-inner"),ma=a("#mck-group-name-sec .mck-group-title");a("#mck-group-create-icon-box");var Ra=a("#mck-group-info-icon-loading"),U=a("#mck-gm-search-box");a("#mck-group-member-search-list");
var R=a("#mck-group-create-icon-loading"),N=a("#mck-group-info-icon-box .mck-group-icon"),ja=a("#mck-group-create-icon-box .mck-group-icon"),Y=a("#mck-group-create-icon-box .mck-overlay-box"),ka=a("#mck-gc-overlay-label");a(".mck-group-name-box div[contenteditable]").keypress(function(f){if(8===f.which||37===f.keyCode||38===f.keyCode||39===f.keyCode||40===f.keyCode||f.ctrlKey&&97===f.which)return!0;if(13!==f.keyCode||f.shiftKey||f.ctrlKey)return 30>this.innerHTML.length;a(f.target).hasClass("mck-group-create-title")&&
b.submitCreateGroup();return!1}).on("paste",function(a){var b=this;setTimeout(function(){30<b.innerText.length&&(b.innerHTML=b.innerText.substring(0,30),P.setEndOfContenteditable(b));return!1},"fast")}).on("drop",function(a){a.preventDefault();a.stopPropagation()});a(c).on("click",".mck-btn-change-role",function(b){b.preventDefault();b=a(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var f=a(this).parents(".mck-li-group-member").data("role");b.find("select").val(f);b.removeClass("n-vis").addClass("vis");
O.removeClass("n-vis").addClass("vis")});Wa.on("click",function(){var b=[];a(".mck-group-change-role-box.vis").each(function(f,c){f=a(this);c=parseInt(f.find("select").val());var g=f.parents(".mck-li-group-member").data("role");c!==g&&(f={userId:f.parents(".mck-li-group-member").data("mck-id"),role:c},b.push(f))});if(0<b.length){var f=aa.data("mck-id"),c=aa.data("isgroup");f&&c&&(Wa.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),y.updateGroupInfo({groupId:f,users:b,apzCallback:w.onUpdateGroupInfo}))}});
a("#mck-group-info-icon-box .mck-overlay").on("click",function(a){Fc.trigger("click")});a("#mck-group-create-icon-box .mck-overlay").on("click",function(a){wb.trigger("click")});a(c).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var b=a(this);0===b.find(".mck-group-icon-default").length&&b.find(".mck-overlay-box").addClass("n-vis")});a(c).on("mouseenter",
".mck-group-info-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",function(){a(this).find(".mck-overlay-box").addClass("n-vis")});v.on("click",function(){ma.attr("contenteditable",!0).focus();P.setEndOfContenteditable(ma[0]);J.removeClass("n-vis").addClass("vis");v.removeClass("vis").addClass("n-vis")});J.on("click",function(){var b=a.trim(ma.text());if(0<b.length){var f=aa.data("mck-id"),c=aa.data("isgroup");
f&&c&&(v.removeClass("n-vis").addClass("vis"),J.removeClass("vis").addClass("n-vis"),ma.attr("contenteditable",!1),y.updateGroupInfo({groupId:f,name:b,apzCallback:w.onUpdateGroupInfo}))}else ma.addClass("mck-req-border")});ra.on("click",function(){var a=N.data("iconurl");if(a){var b=aa.data("mck-id"),f=aa.data("isgroup");b&&f&&(setTimeout(function(){ra.removeClass("vis").addClass("n-vis")},1E3),N.data("iconurl",""),y.updateGroupInfo({groupId:b,imageUrl:a,apzCallback:w.onUpdateGroupInfo}))}else ma.addClass("mck-req-border")});
u.on("click",function(){b.submitCreateGroup()});b.init=function(){a.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
a.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e')};
b.submitCreateGroup=function(){var b=a.trim(Z.text()),f=M.val(),c=ja.data("iconurl");0<b.length?(b={groupName:b},f&&(f=parseInt(f),-1!==Lb.indexOf(f)&&(b.type=f)),c&&(b.groupIcon=c),ja.data("iconurl",""),b.isInternal=!0,u.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),A.getGroup(b)):Z.addClass("mck-req-border")};b.loadGroups=function(b){b=b.data;lb.length=0;a.each(b,function(a,b){"undefined"!==typeof b.id&&(b=D.addGroup(b),lb.push(b))})};b.getDeletedAtTime=function(a){if("object"===typeof MCK_GROUP_MAP[a])return MCK_GROUP_MAP[a].deletedAtTime};
b.validateOpenGroupUser=function(a){if(6===a.type){if(!y.authenticateGroupUser(a)){if(pa.disableChatForNonGroupMember){var b=pa.defaultChatDisabledMessage;b||(b="Chat disabled");W.html(b);W.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");n.removeClass("vis").addClass("n-vis");p.removeClass("mck-tab-title-w-status");F.removeClass("vis").addClass("n-vis")}db.removeClass("vis").addClass("n-vis");X.removeClass("vis").addClass("n-vis");Q.removeClass("vis").addClass("n-vis");"undefined"===typeof Jb[a.contactId]&&
fa.subscribeToOpenGroup(a)}a.adminName===C?0===pa.deleteChatAccess&&X.removeClass("vis").addClass("n-vis"):(pa.allowInfoAccessGroupMembers||db.removeClass("vis").addClass("n-vis"),2!==pa.deleteChatAccess&&X.removeClass("vis").addClass("n-vis"),pa.allowInfoAccessGroupMembers||2===pa.deleteChatAccess||Q.removeClass("vis").addClass("n-vis"));return!1}return!0};b.addGroupStatus=function(a){var f=b.isGroupLeft(a);if(6!==a.type&&(f||lc)){if(f)w.onGroupLeft("",{groupId:a.contactId});p.removeClass("mck-tab-title-w-status");
F.removeClass("vis").addClass("n-vis")}else if(0<a.members.length){f="";for(var c=!1,g=30>=a.members.length?a.members.length:25,k=0;k<g;k++)if(C===""+a.members[k]||-1!==a.removedMembersId.indexOf(a.members[k]))c=!0;else{var l=m.fetchContact(""+a.members[k]);l=m.getTabDisplayName(l.contactId,!1);f+=" "+l+","}if(5!==a.type&&6!==a.type||c&&5!==a.type)f+=" You";30<a.members.length&&(f+=" and "+(a.members.length-25)+" more");f=f.replace(/,\s*$/,"");F.html(f);F.attr("title",f);F.removeClass("n-vis").addClass("vis");
p.addClass("mck-tab-title-w-status");db.removeClass("n-vis").addClass("vis")}else p.removeClass("mck-tab-title-w-status"),F.removeClass("vis").addClass("n-vis");7===a.type&&(F.html(""),db.removeClass("vis").addClass("n-vis"))};b.disableGroupTab=function(){W.html(MCK_LABELS["group.chat.disabled"]);W.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");n.removeClass("vis").addClass("n-vis");p.removeClass("mck-tab-title-w-status");F.removeClass("vis").addClass("n-vis")};b.isGroupLeft=function(b){var f=
!1;b.removedMembersId&&0<b.removedMembersId.length&&a.each(b.removedMembersId,function(a,b){b===C&&(f=!0)});return f};b.onGroupLeft=function(a,f){K.removeClass("vis").addClass("n-vis");if("object"===typeof a&&"error"===a.status)alert("Unable to process your request. "+a.errorMessage);else if(a=f.groupId,H.hasClass("vis"))f=H.data("mck-id"),a===f&&Ec.trigger("click");else if(I.hasClass("vis")){f=aa.data("mck-id");var c=aa.data("isgroup");f===a.toString()&&c&&(db.removeClass("vis").addClass("n-vis"),
b.disableGroupTab())}};b.onAddedGroupMember=function(f,c){K.removeClass("vis").addClass("n-vis");if("object"===typeof f&&"error"===f.status)alert("Unable to process your request. "+f.errorMessage);else{var g=c.groupId,k=c.userId;f="";g?f=D.getGroup(g):c.clientGroupId&&(f=D.getGroupByClientGroupId(c.clientGroupId));"object"===typeof f?(f=y.addMemberToGroup(f,k),H.hasClass("vis")?(c=H.data("mck-id"),g===c&&(g=m.fetchContact(""+k),0===a("#li-gm-"+g.htmlId).length&&b.addGroupMember(f,g),b.sortGroupMemberHtmlList(),
b.enableGroupAdminMenuToggle())):I.hasClass("vis")&&(c=aa.data("mck-id"),k=aa.data("isgroup"),c===g.toString()&&k&&b.addGroupStatus(f))):y.getGroupFeed({groupId:g,clientGroupId:c.clientGroupId,apzCallback:w.onGroupFeed})}};b.onRemovedGroupMember=function(f,c){K.removeClass("vis").addClass("n-vis");if("object"===typeof f&&"error"===f.status)alert("Unable to process your request. "+f.errorMessage);else{f=c.groupId;var g=c.userId,k="";f?k=D.getGroup(f):c.clientGroupId&&(k=D.getGroupByClientGroupId(c.clientGroupId));
"object"===typeof k?(k=y.removeMemberFromGroup(k,g),H.hasClass("vis")?(k=H.data("mck-id"),f===k&&(f=m.fetchContact(""+g),f=a("#li-gm-"+f.htmlId),0<f.length&&f.remove())):I.hasClass("vis")&&(c=aa.data("mck-id"),g=aa.data("isgroup"),c===f.toString()&&g&&b.addGroupStatus(k))):y.getGroupFeed({groupId:f,clientGroupId:c.clientGroupId,apzCallback:w.onGroupFeed})}};b.onGroupFeed=function(f,c){K.removeClass("vis").addClass("n-vis");if("success"===f.status){f=f.data;var g=f.conversationPxy,k=D.getGroup(f.id);
f.deletedAtTime&&(W.html(MCK_LABELS["group.deleted"]),W.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),n.removeClass("vis").addClass("n-vis"));var l=[];"object"===typeof g&&(da[g.id]=g,za[g.topicId]=[g.id],g.topicDetail&&(ba[g.topicId]=a.parseJSON(g.topicDetail)),l.push(g));0<l.length&&(Fa[c.groupId]=l);va.loadUserProfiles(f.membersId,function(b,f){a.each(b,function(a,b){"undefined"===typeof m.getContact(b)&&f.push(b)});ea.getUsersDetail(f,{async:!1})});c.isMessage&&"object"===typeof c.message&&
m.populateMessage(c.messageType,c.message,c.notifyUser);c.isReloadTab&&b.reloadGroupTab(k)}};b.onUpdateGroupInfo=function(f,c){K.removeClass("vis").addClass("n-vis");Wa.attr("disabled",!1).html("Update");O.removeClass("vis").addClass("n-vis");if("object"===typeof f&&"error"===f.status)alert("Unable to process your request. "+f.errorMessage);else{f=c.groupId;c=c.groupInfo;var g=D.getGroup(f);if("object"===typeof g){c.imageUrl&&(g.imageUrl=c.imageUrl);c.newName&&(g.displayName=c.newName);c.metadata&&
(g.metadata=c.metadata);c.users&&0<c.users.length&&a.each(c.users,function(a,b){b.userId&&(g.users[b.userId]=b)});if(H.hasClass("vis"))c.imageUrl&&N.html(y.getGroupImage(g.imageUrl)),ma.html(g.displayName),c.users&&0<c.users.length&&($b.html(""),b.addMembersToGroupInfoList(g),g.adminName===C?Db.removeClass("n-vis").addClass("vis"):Db.removeClass("vis").addClass("n-vis"));else if(I.hasClass("vis")){var m=aa.data("mck-id"),k=aa.data("isgroup");m===f.toString()&&k?p.html(g.displayName):0<a("#li-group-"+
g.htmlId).length&&(a("#li-group-"+g.htmlId+" .mck-cont-name strong").html(g.displayName),c.imageUrl&&a("#li-group-"+g.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+g.imageUrl+"'\x3e"))}MCK_GROUP_MAP[g.contactId]=g}}};b.getGroupFeedFromMessage=function(a){var b=a.message;if(b){a.groupId=b.groupId;a.isMessage=!0;if(b.conversationId){var f=da[b.conversationId];if("object"!==typeof f||"object"!==typeof ba[f.topicId])a.conversationId=b.conversationId}a.apzCallback=w.onGroupFeed;y.getGroupFeed(a)}};b.reloadGroupTab=
function(a){var f=aa.data("mck-id"),c=aa.data("isgroup");f===a.contactId.toString()&&c&&b.addGroupStatus(a)};b.loadGroupTab=function(b){"error"===b.status?alert("Unable to process your request. "+b.errorMessage):(m.loadTab({tabId:b.data.contactId,isGroup:!0}),a("#mck-search").val(""))};b.addMembersToGroupInfoList=function(f){var c=f.members;c.sort();$b.html("");a.each(c,function(c,g){g&&(c=m.fetchContact(""+g),0===a("#li-gm-"+c.htmlId).length&&b.addGroupMember(f,c))});b.sortGroupMemberHtmlList();
b.enableGroupAdminMenuToggle()};b.enableGroupAdminMenuToggle=function(){a(".mck-group-member-info").bind("mouseenter",function(){a(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",function(){a(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};b.addGroupMember=function(b,c){var k="n-vis",l="n-vis",M=b.users[c.contactId],u=MCK_LABELS.member,n=3;M&&"undefined"!==typeof M.role&&(n=M.role,u=g[M.role]);M=m.getTabDisplayName(c.contactId,!1);c.contactId===b.adminName&&
(k="vis");b.adminName===C&&(l="vis");c.contactId===C&&(M=MCK_LABELS.you,l="n-vis");b=m.getContactImageLink(c,M);var x="";ta[c.contactId]||(f.MCK_OL_MAP[c.contactId]?x=MCK_LABELS.online:ca[c.contactId]&&(x=mckDateUtils.getLastSeenAtStatus(ca[c.contactId])));c=[{roleExpr:u,roleVal:n,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:c.htmlId,contIdExpr:c.contactId,contImgExpr:b,contLastSeenExpr:x,contNameExpr:M,contFirstAlphaExpr:M.charAt(0).toUpperCase(),
isAdminExpr:k,enableAdminMenuExpr:l}];a.tmpl("groupMemberTemplate",c).appendTo("#mck-group-member-list")};b.addMembersToGroupSearchList=function(){var f=aa.data("mck-id");if(aa.data("isgroup")){var c=D.getGroup(f),g=cb,k=[];f=ALStorage.getFriendListGroupName();var l=ALStorage.getFriendListGroupType();f&&l&&(g=ea.getFriendList(f,l));f&&!l&&(g=ea.getFriendList(f));g=g.filter(function(a,b){return g.indexOf(a)===b});g.sort();var M=c.members;a.each(g,function(a,f){f&&(f="object"===typeof f&&f.contactId?
m.fetchContact(""+f.contactId):m.fetchContact(""+f),-1===M.indexOf(f.contactId)||-1!==M.indexOf(f.contactId)&&-1!==c.removedMembersId.indexOf(f.contactId))&&(b.addGroupSearchMember(f),k.push(f))});b.enableGroupAdminMenuToggle();0<k.length?S.removeClass("vis").addClass("n-vis"):S.removeClass("n-vis").addClass("vis");m.initAutoSuggest({contactsArray:k,$searchId:Ca,isContactSearch:!1})}ia.removeClass("vis").addClass("n-vis")};b.addGroupSearchMember=function(b){var c=m.getTabDisplayName(b.contactId,!1),
g=m.getContactImageLink(b,c),k="user-"+b.htmlId,l="";ta[b.contactId]||(f.MCK_OL_MAP[b.contactId]?l=MCK_LABELS.online:ca[b.contactId]&&(l=mckDateUtils.getLastSeenAtStatus(ca[b.contactId])));a.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:k,contIdExpr:b.contactId,contImgExpr:g,contLastSeenExpr:l,contNameExpr:c}]).appendTo("#mck-group-member-search-list")};b.loadCreateGroupTab=function(){L.removeClass("vis").addClass("n-vis");I.removeClass("vis").addClass("n-vis");r.removeClass("vis").addClass("n-vis");
H.removeClass("vis").addClass("n-vis");R.removeClass("vis").addClass("n-vis");ja.data("iconurl","");Z.html("");Y.removeClass("n-vis");ka.html(MCK_LABELS["add.group.icon"]);ja.html(y.getGroupDefaultIcon());ha.removeClass("n-vis").addClass("vis")};b.loadGroupInfo=function(a){if(a.groupId){ma.attr("contenteditable",!1);J.removeClass("vis").addClass("n-vis");v.removeClass("n-vis").addClass("vis");L.removeClass("vis").addClass("n-vis");I.removeClass("vis").addClass("n-vis");r.removeClass("vis").addClass("n-vis");
O.removeClass("vis").addClass("n-vis");ha.removeClass("vis").addClass("n-vis");ra.removeClass("vis").addClass("n-vis");Ra.removeClass("vis").addClass("n-vis");H.removeClass("n-vis").addClass("vis");H.data("mck-id",a.groupId);N.data("iconurl","");a.conversationId&&H.data("mck-conversation-id",a.conversationId);$b.html("");var f=D.getGroup(a.groupId);"object"===typeof f?(N.html(y.getGroupImage(f.imageUrl)),ma.html(f.displayName),b.addMembersToGroupInfoList(f),f.adminName===C?Db.removeClass("n-vis").addClass("vis"):
Db.removeClass("vis").addClass("n-vis")):y.getGroupFeed({groupId:a.groupId,apzCallback:w.onGroupFeed})}};b.sortGroupMemberHtmlList=function(){a("#mck-group-member-list .mck-li-group-member").sort(function(a,b){return a.dataset.alpha>b.dataset.alpha}).appendTo("#mck-group-member-list")};b.addGroupMemberFromSearch=function(a){var b=H.data("mck-id");if("undefined"!==typeof b&&"undefined"!==typeof a){var f=D.getGroup(b);"object"===typeof f&&C===f.adminName?(va.loadUserProfile(a),y.addGroupMember({groupId:b,
userId:a,apzCallback:w.onAddedGroupMember})):Gc.removeClass("vis").addClass("n-vis")}U.mckModal("hide")}},Fb=new function(){var b=this,f=["CREATE","UPDATE"],g=a("#mck-file-box"),k=a(".mck-overlay"),n=a("#mck-msg-sbmt"),r=a("#mck-text-box"),F=a("#mck-file-input"),S=a("#mck-autosuggest-search-input"),ia=a(".mck-overlay-box"),K=a(".mck-file-upload"),H=a("#mck-group-icon-upload"),w=a("#mck-group-icon-change"),y=a("#mck-group-info-icon-box"),C=a("#mck-btn-group-icon-save"),A=a("#mck-message-cell .mck-message-inner"),
D=a("#mck-group-create-icon-box"),v=a("#mck-group-info-icon-loading"),u=a("#mck-group-create-icon-loading"),ha=a("#mck-group-info-icon-box .mck-group-icon"),L=a("#mck-group-create-icon-box .mck-group-icon"),Wa=a("#mck-gc-overlay-label");b.init=function(){a.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"km-progress km-progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"km-progress-bar km-progress-bar-success km-bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-attach-icon mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
Kommunicate.attachEvents(a);K.on("click",function(){F.trigger("click")});H.on("change",function(){var c=a(this)[0].files[0];b.uplaodFileToAWS(c,f[0]);return!1});w.on("change",function(){var c=a(this)[0].files[0];b.uplaodFileToAWS(c,f[1]);return!1});F.on("change",function(){var f=a(this)[0].files[0],c={};c.file=f;c.name=f.name;"awsS3Server"===Na?b.uploadAttachment2AWS(c):"googleCloud"===Na?b.customFileUpload(c):b.uploadFile(c)});a(c).on("click",".mck-remove-file",function(){var b=a(this).parents(".mck-file-box"),
f=b.data("mckfile");b.remove();n.attr("disabled",!1);0===g.find(".mck-file-box").length&&(g.removeClass("vis").addClass("n-vis"),r.attr("required",""));"object"===typeof f&&(I.deleteFileMeta(f.blobKey),a.each(O,function(a,b){"undefined"!==typeof b&&b.blobKey===f.blobKey&&O.splice(a,1)}))});S.on("input",function(a){a.preventDefault();r.text(S.val());"KM_AUTO_SUGGEST"!=S.data("origin")&&""!=S.data("source-url")&&m.populateAutoSuggest({sourceUrl:S.data("source-url"),method:S.data("method"),headers:S.data("headers")})})};
b.audioRecoder=function(a){"awsS3Server"===Na?b.uploadAttachment2AWS(a):"googleCloud"===Na?b.customFileUpload(a):b.uploadFile(a)};b.customFileUpload=function(b){var f=b.file,c=new FormData,k=[];if("undefined"!==typeof f)if(4<a(".mck-file-box").length&&k.push("Can't upload more than 5 files at a time"),f.size>1048576*Aa&&k.push("file size can not be more than "+Aa+" MB"),0<k.length)alert(k.toString());else{k=P.randomId();var l=[{fileIdExpr:k,fileName:b.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+
b.name+"\x3c/a\x3e",fileSizeExpr:I.getFilePreviewSize(f.size)}];a.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var u=a(".mck-file-box."+k),M=a(".mck-file-box."+k+" .mck-file-lb"),x=a(".mck-file-box."+k+" .km-progress .km-bar"),L=a(".mck-file-box."+k+" .km-progress"),V=a(".mck-file-box."+k+" .mck-remove-file");x.css("width","0%");L.removeClass("n-vis").addClass("vis");V.attr("disabled",!0);K.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");if(b.name===a(".mck-file-box."+k+" .mck-file-lb a").html()){var W=
A.data("mck-id");Y[b.name+f.size]=W;n.attr("disabled",!0);c.append("files[]",f);b=new XMLHttpRequest;(b.upload||b).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);x.css("width",a+"%")});b.addEventListener("load",function(b){b=a.parseJSON(this.responseText);if("object"===typeof b){b=b.fileMeta;var f="object"===typeof b?'\x3ca href\x3d"'+b.url+'" target\x3d"_blank"\x3e'+b.name+"\x3c/a\x3e":"",c=b.name,g=b.size,k=A.data("mck-id");c+=g;g=Y[c];if(W!==k)m.updateDraftMessage(g,
b),delete Y[c];else return V.attr("disabled",!1),K.attr("disabled",!1),n.attr("disabled",!1),delete Y[c],M.html(f),L.removeClass("vis").addClass("n-vis"),a(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),O.push(b),u.data("mckfile",b),K.children("input").val(""),!1}else V.attr("disabled",!1),n.attr("disabled",!1),V.trigger("click")});b.open("post",dc+"/files/upload/",!0);b.setRequestHeader("UserId-Enabled",!0);b.setRequestHeader("Authorization","Basic "+p);
b.setRequestHeader("Application-Key",Z);b.setRequestHeader("Device-Key",ka);N&&b.setRequestHeader("Access-Token",N);b.send(c)}return!1}};b.uploadFile=function(b){var f=b.file,c=[];if("undefined"!==typeof f)if(4<a(".mck-file-box").length&&c.push("Can't upload more than 5 files at a time"),f.size>1048576*Aa&&c.push("file size can not be more than "+Aa+" MB"),0<c.length)alert(c.toString());else{c=P.randomId();var k=[{fileIdExpr:c,fileName:b.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+
b.name+"\x3c/a\x3e",fileSizeExpr:I.getFilePreviewSize(f.size)}];a.tmpl("fileboxTemplate",k).appendTo("#mck-file-box");var l=a(".mck-file-box."+c),u=a(".mck-file-box."+c+" .mck-file-lb"),x=a(".mck-file-box."+c+" .km-progress .km-bar"),M=a(".mck-file-box."+c+" .km-progress"),L=a(".mck-file-box."+c+" .mck-remove-file");x.css("width","0%");M.removeClass("n-vis").addClass("vis");L.attr("disabled",!0);K.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");if(b.name===a(".mck-file-box."+c+" .mck-file-lb a").html()){var V=
A.data("mck-id");Y[b.name+f.size]=V;n.attr("disabled",!0);b=[];b.push(f);var p=new XMLHttpRequest;(p.upload||p).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);x.css("width",a+"%")});p.addEventListener("load",function(b){b=a.parseJSON(this.responseText);if("object"===typeof b.fileMeta){b=b.fileMeta;var f=I.getFilePreviewPath(b),c=b.name,g=b.size,k=A.data("mck-id");c+=g;g=Y[c];if(V!==k)m.updateDraftMessage(g,b),delete Y[c];else return L.attr("disabled",!1),K.attr("disabled",
!1),n.attr("disabled",!1),delete Y[c],u.html(f),M.removeClass("vis").addClass("n-vis"),a(".mck-file-box .km-progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),O.push(b),l.data("mckfile",b),K.children("input").val(""),!1}else L.attr("disabled",!1),n.attr("disabled",!1),L.trigger("click")});a.ajax({type:"GET",url:Ma+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=new FormData;b.append("files[]",f);p.open("POST",a,!0);
p.send(b)},error:function(){}})}return!1}};b.uploadAttachment2AWS=function(b){var f=b.file,c=new FormData,k=[];if("undefined"!==typeof f)if(4<a(".mck-file-box").length&&k.push("Can't upload more than 5 files at a time"),f.size>1048576*Aa&&k.push("file size can not be more than "+Aa+" MB"),0<k.length)alert(k.toString());else{k=P.randomId();var l=[{fileIdExpr:k,fileName:b.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+b.name+"\x3c/a\x3e",fileSizeExpr:I.getFilePreviewSize(f.size)}];a.tmpl("fileboxTemplate",
l).appendTo("#mck-file-box");var u=a(".mck-file-box."+k),x=a(".mck-file-box."+k+" .mck-file-lb"),L=a(".mck-file-box."+k+" .km-progress .km-bar"),M=a(".mck-file-box."+k+" .km-progress"),V=a(".mck-file-box."+k+" .mck-remove-file");L.css("width","0%");M.removeClass("n-vis").addClass("vis");V.attr("disabled",!0);K.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");if(b.name===a(".mck-file-box."+k+" .mck-file-lb a").html()){var W=A.data("mck-id");Y[b.name+f.size]=W;n.attr("disabled",!0);c.append("file",
f);b=new XMLHttpRequest;(b.upload||b).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);L.css("width",a+"%")});b.addEventListener("load",function(b){b=a.parseJSON(this.responseText);if("object"===typeof b){var f="object"===typeof b?'\x3ca href\x3d"'+b.url+'" target\x3d"_blank"\x3e'+b.name+"\x3c/a\x3e":"",c=b.name,g=b.size,k=A.data("mck-id");c+=g;g=Y[c];if(W!==k)m.updateDraftMessage(g,b),delete Y[c];else return V.attr("disabled",!1),K.attr("disabled",!1),n.attr("disabled",
!1),delete Y[c],x.html(f),M.removeClass("vis").addClass("n-vis"),a(".mck-file-box .km-progress").removeClass("vis").addClass("n-vis"),r.removeAttr("required"),O.push(b),u.data("mckfile",b),K.children("input").val(""),!1}else V.attr("disabled",!1),n.attr("disabled",!1),V.trigger("click")});b.open("post",MCK_BASE_URL+"/rest/ws/upload/image",!0);b.setRequestHeader("UserId-Enabled",!0);b.setRequestHeader("Authorization","Basic "+p);b.setRequestHeader("Application-Key",Z);b.setRequestHeader("Device-Key",
ka);N&&b.setRequestHeader("Access-Token",N);b.send(c)}return!1}};b.uplaodFileToAWS=function(a,b){var c=new FormData,g=[];"undefined"!==typeof a&&(-1===a.type.indexOf("image")&&g.push("Please upload image file."),0<g.length?alert(g.toString()):(k.attr("disabled",!0),f[0]===b?(D.find(".mck-overlay-box").removeClass("n-vis"),D.removeClass("mck-hover-on"),u.removeClass("n-vis").addClass("vis")):(y.find(".mck-overlay-box").removeClass("n-vis"),y.removeClass("mck-hover-on"),v.removeClass("n-vis").addClass("vis")),
g=new XMLHttpRequest,g.addEventListener("load",function(a){if(a=this.responseText)f[0]===b?(L.html('\x3cimg src\x3d"'+a+'"/\x3e'),L.data("iconurl",a),Wa.html(MCK_LABELS["change.group.icon"]),u.removeClass("vis").addClass("n-vis"),D.addClass("mck-hover-on")):(ha.html('\x3cimg src\x3d"'+a+'"/\x3e'),ha.data("iconurl",a),v.removeClass("vis").addClass("n-vis"),y.addClass("mck-hover-on"),setTimeout(function(){C.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){ia.addClass("n-vis")},1500);
k.attr("disabled",!1);f[0]===b?H.val(""):w.val("");return!1}),c.append("file",a),g.open("post",MCK_BASE_URL+"/rest/ws/upload/file",!0),g.setRequestHeader("UserId-Enabled",!0),g.setRequestHeader("Authorization","Basic "+p),g.setRequestHeader("Application-Key",Z),g.setRequestHeader("Device-Key",ka),N&&g.setRequestHeader("Access-Token",N),g.send(c)))};b.addFileBox=function(b){var f=P.randomId(),c="";"object"===typeof b.fileMeta&&(f=b.fileMeta.createdAtTime,c=b.fileMeta.name);a.tmpl("fileboxTemplate",
[{fileNameExpr:b.filelb,fileSizeExpr:b.filesize,fileIdExpr:f,fileName:c}]).appendTo("#mck-file-box");f=a(".mck-file-box."+f);c=f.find(".mck-remove-file");var g=f.find(".progress");"object"===typeof b.fileMeta?(f.data("mckblob",b.fileMeta.blobKey),r.removeAttr("required"),n.attr("disabled",!1),c.attr("disabled",!1),g.removeClass("vis").addClass("n-vis"),O.push(b.fileMeta)):(n.attr("disabled",!0),c.attr("disabled",!0),g.removeClass("n-vis").addClass("vis"))}},m=new function(){var b=this,g="",k=a("#mck-search"),
n=a("#mck-msg-to"),p=a(".mck-file-lb"),r=a(".mck-file-sz"),F=a("#mck-sidebox"),S=a("#mck-file-box"),ia=a("#mck-msg-sbmt"),K=a("#mck-msg-form"),H=a("#mck-text-box"),Va=a("#mck-msg-error");a("#mck-show-more");var v=a("#mck-tab-title"),Z=a("#mck-tab-status"),N=a("#mck-message-cell"),U=a(".mck-typing-box"),Q=a("#mck-no-messages"),u=a("#mck-product-box"),ha=a(".mck-product-icon"),L=a(".mck-product-title"),Wa=a(".mck-product-subtitle"),M=a("#mck-product-box .mck-caret"),wb=a(".mck-product-rt-up .mck-product-key"),
R=a("#mck-contact-search-input-box"),Y=a(".mck-product-rt-up .mck-product-value"),ka=a(".mck-product-rt-down .mck-product-key"),la=a(".mck-product-rt-down .mck-product-value");a("#li-mck-group-info");a("#li-mck-leave-group");var na=a("#mck-group-info-tab"),db=a("#mck-group-search-tab"),Ca=a("#mck-no-search-groups"),ra=a("#mck-group-create-tab"),pa=a("#mck-group-search-list");a("#mck-group-search-tabview");var xa=a(".mck-group-menu-options"),aa=a(".mck-videocall-btn"),ma=a("#mck-group-search-input"),
Ra=a("#mck-group-search-input-box"),za=a("#mck-contact-search-list"),oa=a("#mck-contacts-content"),Aa=a("#mck-contact-search-tab");a("#mck-contact-search-tabview");var ja=a("#mck-contact-search-input"),Ha=a("#mck-autosuggest-search-input"),Ta=a("#mck-autosuggest-metadata");a("#mck-search-list");var Eb=a("#mck-no-search-contacts"),qa=a("#mck-search-tab-box li a"),Ga=a("#mck-search-tabview-box"),Xa=a("#mck-sidebox-search"),Ia=a("#mck-contact-loading"),fb=a("#mck-typing-label"),q=a("#mck-price-widget"),
gb=a("#mck-msg-response"),hb=a("#mck_response_text"),wa=a("#li-mck-block-user"),Da=a("#li-mck-video-call"),eb=a("#mck-search-loading"),Za=a("#mck-tab-individual"),Na=a("#mck-attachfile-box"),t=a("#mck-attachmenu-box"),G=a("#mck-sidebox-content"),T=a("#mck-tab-option-panel"),Ya=a("#mck-tab-conversation"),nb=a("#mck-conversation-header"),ac=a("#mck-no-conversations"),ob=a("#mck-conversation-list"),pb=a(".mck-tab-message-option"),xb=a(".mck-box-ft .mck-box-form"),wc=a("#mck-btn-clear-messages"),bc=a("#mck-offline-message-box"),
B=a("#mck-message-cell .mck-message-inner");a("#mck-msg-new");var cc=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);b.init=function(){a.template("convTemplate",'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"${nameTextExpr} ${showNameExpr} mck-conversation-name"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class \x3d"km-conversation-container-right"\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d"move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}"data-filename\x3d"${fileNameExpr}" data-fileurl\x3d"${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box-rich-text-container ${kmRichTextMarkupVisibility} ${containerType}"\x3e{{html kmRichTextMarkup}}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward ${msgForwardVisibleExpr}"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
a.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e')};
b.openConversation=function(){"none"===F.css("display")&&(a(".mckModal").mckModal("hide"),F.mckModal());n.focus()};b.initEmojis=function(){try{a("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(h){g||(g=setTimeout(function(){b.initEmojis()},3E4))}};b.loadTab=function(h,c){var E=B.data("mck-id");if(E)if(1<H.html().length||S.hasClass("vis")){var g={text:H.html(),files:[]};S.hasClass("vis")&&a(".mck-file-box").each(function(){var b=a(this),h={filelb:b.find(".mck-file-lb").html(),
filesize:b.find(".mck-file-sz").html()};b=b.data("mckfile");"object"===typeof b&&(h.fileMeta=b);g.files.push(h)});Ua[E]=g}else delete Ua[E];Ka=!0;b.clearMessageField(!1);b.addDraftMessage(h.tabId);Va.html("");Va.removeClass("vis").addClass("n-vis");hb.html("");gb.removeClass("vis").addClass("n-vis");K[0].reset();K.removeClass("n-vis").addClass("vis");B.html("");Va.removeClass("mck-no-mb");oa.removeClass("n-vis").addClass("vis");xb.removeClass("vis").addClass("n-vis");a("#mck-sidebox-ft").removeClass("vis").addClass("n-vis");
Xa.removeClass("vis").addClass("n-vis");na.removeClass("vis").addClass("n-vis");ra.removeClass("vis").addClass("n-vis");G.removeClass("n-vis").addClass("vis");u.removeClass("vis").addClass("n-vis");nb.addClass("n-vis");Ia.removeClass("vis").addClass("n-vis");B.removeClass("mck-group-inner");Z.removeClass("vis").addClass("n-vis");v.removeClass("mck-tab-title-w-status");v.removeClass("mck-tab-title-w-typing");U.removeClass("vis").addClass("n-vis");fb.html(MCK_LABELS.typing);B.data("isgroup",h.isGroup);
B.data("datetime","");if(h.tabId)n.val(h.tabId),B.data("mck-id",h.tabId),B.data("mck-conversationid",h.conversationId),B.data("mck-topicid",h.topicId),T.data("tabId",h.tabId),T.removeClass("n-vis").addClass("vis"),oa.removeClass("vis").addClass("n-vis"),xb.removeClass("n-vis").addClass("vis"),a("#mck-sidebox-ft").removeClass("n-vis").addClass("vis"),wc.removeClass("n-vis").addClass("vis"),xa.removeClass("vis").addClass("n-vis"),h.isGroup?(B.addClass("mck-group-inner"),wa.removeClass("vis").addClass("n-vis"),
Da.removeClass("vis").addClass("n-vis"),aa.removeClass("vis").addClass("n-vis")):(wa.removeClass("n-vis").addClass("vis"),Da.removeClass("n-vis").addClass("vis"),Sa&&aa.removeClass("n-vis").addClass("vis")),!h.topicId&&h.conversationId&&(E=da[h.conversationId],"object"===typeof E&&(h.topicId=E.topicId)),h.topicId&&(E=ba[h.topicId],"object"===typeof E&&(Oa?(B.data("mck-title",E.title),nb.html(E.title),nb.removeClass("n-vis")):ab&&(b.setProductProperties(E,h.topicId),M.addClass("n-vis"),u.addClass("mck-product-box-wc"),
ob.addClass("n-vis"),u.removeClass("n-vis").addClass("vis")))),sb&&f.google&&"object"===typeof f.google.maps?(Na.removeClass("vis").addClass("n-vis"),t.removeClass("n-vis").addClass("vis")):(t.removeClass("vis").addClass("n-vis"),Na.removeClass("n-vis").addClass("vis")),E=b.getTabDisplayName(h.tabId,h.isGroup,h.userName),b.isGroupDeleted(h.tabId,h.isGroup)&&(Va.html(MCK_LABELS["group.deleted"]),Va.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),K.removeClass("vis").addClass("n-vis")),v.html(E),
v.attr("title",E),Ya.removeClass("vis").addClass("n-vis"),Ga.removeClass("vis").addClass("n-vis"),Za.removeClass("n-vis").addClass("vis"),"support"===Ib&&a(".mck-tab-link").removeClass("vis").addClass("n-vis"),Sb&&(q.removeClass("n-vis").addClass("vis"),B.addClass("mck-msg-w-panel")),tb&&(Va.html("Deactivated"),Va.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),K.removeClass("vis").addClass("n-vis")),fa.subscibeToTypingChannel(h.isGroup?h.tabId:C),"function"===typeof Pb&&Pb({tabId:h.tabId,
isGroup:h.isGroup});else if(h.tabId="",ub&&m.hideOfflineMessage(),Za.removeClass("vis").addClass("n-vis"),Ya.removeClass("n-vis").addClass("vis"),Ga.removeClass("n-vis").addClass("vis"),u.removeClass("vis").addClass("n-vis"),B.data("mck-id",""),B.data("mck-conversationid",""),B.data("mck-topicid",""),q.removeClass("vis").addClass("n-vis"),B.removeClass("mck-msg-w-panel"),T.removeClass("vis").addClass("n-vis"),wc.removeClass("vis").addClass("n-vis"),n.val(""),E=ALStorage.getLatestMessageArray(),fa.unsubscibeToTypingChannel(),
null!==E&&0<E.length){h.isReload=!0;m.addContactsFromMessageList({message:E},h);b.openConversation();Ka=!1;return}A.loadMessageList(h,c);b.openConversation()};b.setProductProperties=function(a,f){L.html(a.title);ha.html(b.getTopicLink(a.link));Wa.html(a.subtitle?a.subtitle:"");var h=a.value1?":"+a.value1:"";wb.html(a.key1?a.key1:"");Y.html(h);h=a.value2?":"+a.value2:"";ka.html(a.key2?a.key2:"");la.html(h);"function"===typeof Mb&&(a.topicId=f,Mb(a))};b.getTopicLink=function(a){return a?'\x3cimg src\x3d"'+
a+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};b.processMessageList=function(h,f,c){var E=B.children("div[name\x3d'message']:first"),g=B.data("mck-id"),G=B.data("isgroup")?D.getGroup(g):m.fetchContact(g);if("undefined"===typeof h.message.length){g=[];g.push(h.message);ALStorage.updateMckMessageArray(g);b.addMessage(h.message,G,!1,!1,c);var t=h.createdAtTime}else ALStorage.updateMckMessageArray(h.message),a.each(h.message,function(a,h){"undefined"!==typeof h.to&&(b.addMessage(h,
G,!1,!1,c),t=h.createdAtTime)});T.data("datetime",t);!f&&0<E.length?B.scrollTop(E.offset().top-B.offset().top+B.scrollTop()):f&&B.animate({scrollTop:B.prop("scrollHeight")},"fast")};b.closeConversation=function(a){var b;if("function"===typeof Ob){var h=Ob();"object"===typeof h&&(b="BUSY_WITH_OTHER"===a?h.onBusyWithOtherUser:h.onConversationClose)}b||(b="Chat disabled with user");Va.html(b);Va.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");K.removeClass("vis").addClass("n-vis")};b.addTooltip=
function(b){a("."+b+" .mck-icon-time").attr("title","pending");a("."+b+" .mck-btn-trash").attr("title","delete");a("."+b+" .mck-icon-sent").attr("title","sent");a("."+b+" .mck-btn-forward").attr("title","forward message");a("."+b+" .mck-icon-delivered").attr("title","delivered");a("."+b+" .mck-icon-read").attr("title","delivered and read");a("."+b+" .msgtype-outbox-cr").attr("title","sent via Carrier");a("."+b+" .msgtype-outbox-mck").attr("title","sent");a("."+b+" .msgtype-inbox-cr").attr("title",
"received via Carrier");a("."+b+" .msgtype-inbox-mck").attr("title","recieved")};b.fetchContact=function(a){var h=b.getContact(a);"undefined"===typeof h&&(h=b.createContact(a));return h};b.getContact=function(a){if("object"===typeof Ja[a])return Ja[a]};b.getContactDisplayName=function(a){if("string"===typeof Ea[a])return Ea[a];if("undefined"===typeof Ea[a]&&(a=ya[a],"undefined"!==typeof a))return a.displayName};b.sendUserEmail=function(){if(1<document.getElementById("input-for-email").value.length){var b=
document.getElementById("input-for-email").value;ea.updateUser({data:{email:b},success:function(b){console.log("email updated successfully !");a("#input-for-email").after("\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cspan\x3eEmail Sent\x3c/span\x3e\x3c/div\x3e");a("#input-for-email").remove();a("#send-email-button").remove()},error:function(a){}})}else alert("No email")};b.updateMetadata=function(a,b){a=f.JSON.stringify({key:a,metadata:b});P.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",
global:!1,data:a,contentType:"application/json",success:function(a){console.log("metadata cleared successfully !")}})};b.addMessage=function(h,E,g,G,t){var k,T="",sa="",z="";var l="vis";var u="n-vis",n="",Ya="n-vis";if("object"===typeof h.metadata&&"undefined"!==typeof h.metadata.AL_REPLY&&(T=h.metadata.AL_REPLY,sa=J.getReplyMessageByKey(T),"undefined"!==typeof sa)){if(E.isGroup&&sa||!E.isGroup&&"undefined"===typeof sa.fileMeta)Ya="vis";n=5===sa.type?"You":m.getTabDisplayName(sa.to,!1);if("object"===
typeof sa.fileMeta||2===sa.contentType)z=b.getImageForReplyMessage(sa),l="n-vis",u="vis",Ya="n-vis"}if(6!==h.type&&7!==h.type&&!(h.metadata&&"HIDDEN"===h.metadata.category||102===h.contentType||h.metadata&&(h.metadata.KM_ASSIGN||h.metadata.KM_STATUS)||10===h.contentType&&h.metadata&&"true"===h.metadata.hide||0<a("#mck-message-cell ."+h.key).length)){Q.hasClass("vis")&&Q.removeClass("vis").addClass("n-vis");var x=h.message||h.fileMeta?"vis":"n-vis",L="mck-msg-right",M="mck-icon-time";if(0===h.type||
4===h.type||6===h.type)L="mck-msg-left";if(4===h.contentType||10===h.contentType||103===h.contentType)L="mck-msg-center";M=b.getStatusIconName(h);T=h.key;var ac="'"+h.deviceKey+"','"+h.to+"','"+h.to+"','"+T+"'",V="",p="",W="",xc="n-vis",K="";va.loadUserProfile(h.to);!h.groupId||4===h.contentType||7===E.type||0!==h.type&&4!==h.type&&6!==h.type||(V=b.getTabDisplayName(h.to,!1),xc="vis",W=b.getNameTextClassByAlphabet(V));if(kc){K="mck-msg-avator-bubble";var q="",ha=V;"mck-msg-right"===L?(q=m.fetchContact(C),
ha=b.getTabDisplayName(q.displayName,!1)):"mck-msg-left"===L&&(q=h.groupId?m.fetchContact(h.to):E);q&&(p=b.getContactImageLink(q,ha))}h.groupId&&10===h.contentType&&(W=p=V="");q="n-vis";var r=ha="",ia=h.message;"object"===typeof h.fileMeta&&(ha=h.fileMeta.name,r=h.fileMeta.size);"object"===typeof h.fileMeta&&(h.fileMeta.contentType.indexOf("audio")||h.fileMeta.contentType.indexOf("image")||h.fileMeta.contentType.indexOf("video"))&&(q="vis");var F="n-vis";Ab&&f.MCK_OL_MAP[h.to]&&10!==h.contentType&&
(F="vis");E=Kommunicate.isRichTextMessage(h.metadata);z=[{msgReply:sa?sa.message+"\n":"",msgReplyTo:sa?n+"\n":"",msgReplyDivExpr:sa?"vis":"n-vis",msgReplyToVisibleExpr:Ya,msgPreview:z?b.getImageForReplyMessage(sa):"",msgpreviewvisExpr:u,textreplyVisExpr:l,msgKeyExpr:h.key,msgDeliveredExpr:h.delivered,msgSentExpr:h.sent,msgCreatedAtTime:h.createdAtTime,msgTypeExpr:h.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"kommunicate"==
window.applozic.PRODUCT_ID?"n-vis":"vis",msgSourceExpr:h.source,statusIconExpr:M,contactExpr:"vis",toExpr:h.to,msgAvatorClassExpr:K,showNameExpr:xc,msgNameExpr:V,msgImgExpr:p,nameTextExpr:W,msgFloatExpr:L,replyIdExpr:T,createdAtTimeExpr:mckDateUtils.getDate(h.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:ac,downloadMediaUrlExpr:I.getFileAttachment(h),msgClassExpr:x,msgExpr:ia,selfDestructTimeExpr:h.timeToLive,fileMetaKeyExpr:h.fileMetaKey,downloadIconVisibleExpr:q,fileExpr:m.getFilePath(h),
fileUrlExpr:I.getFileurl(h),fileNameExpr:ha,fileSizeExpr:r,contOlExpr:F,kmRichTextMarkupVisibility:E?"vis":"n-vis",kmRichTextMarkup:E?Kommunicate.getRichTextMessageTemplate(h.metadata):"",containerType:Kommunicate.getConatainerTypeForRichMessage(h.metadata)}];g?a.tmpl("messageTemplate",z).appendTo("#mck-message-cell .mck-message-inner"):a.tmpl("messageTemplate",z).prependTo("#mck-message-cell .mck-message-inner");if((!h.metadata.obsolete||"true"!=h.metadata.obsolete)&&h.metadata.KM_AUTO_SUGGESTION){z=
{};try{z=JSON.parse(h.metadata.KM_AUTO_SUGGESTION)}catch(Ic){console.error("suggestionList should be an array")}Ha.addClass("mck-text-box").removeClass("n-vis");H.removeClass("mck-text-box").addClass("n-vis");Ha.attr("placeholder",z.placeholder?z.placeholder:"");Ha.data("prev-msgkey",h.key);z.source.constructor==Array?(Ha.data("origin","KM_AUTO_SUGGEST"),z.source.length&&m.populateAutoSuggest({source:z.source})):"object"===typeof z.source&&(Ha.data("source-url",z.source.url),Ha.data("method",z.source.method?
z.source.method:"get"),Ha.data("headers",z.source.headers?z.source.headers:{}))}if(23===h.contentType){if("BUTTON"===h.metadata.msg_type){l=[];if(h.metadata.payload){if(l=a.parseJSON(h.metadata.payload),l[0].hidden||(k="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+l[0].title+"\x3c/button\x3e\x3c/div\x3e"),1<l.length)for(z=1;z<l.length;z++)l[z].hidden||(k+="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+
l[z].title+"\x3c/button\x3e\x3c/div\x3e")}else console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d BUTTON"),k="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3eButton\x3c/button\x3e\x3c/div\x3e";a("div[data-msgkey\x3d'"+h.key+"'] .blk-lg-12").after(k)}"INPUT"===h.metadata.msg_type&&"false"===h.metadata.hidden&&(console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d INPUT"),
k="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput id\x3d'input-for-email' type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e\x3cbutton id\x3d'send-email-button' style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3eSubmit\x3c/button\x3e\x3c/div\x3e",a("div[data-msgkey\x3d'"+h.key+"'] .blk-lg-12").after(k),a("#send-email-button").click(function(){1<document.getElementById("input-for-email").value.length&&
(b.sendUserEmail(),b.updateMetadata(h.key,{hidden:"true"}))}));if("LIST"===h.metadata.msg_type&&(l=[],h.metadata.payload)){l=a.parseJSON(h.metadata.payload);console.log("msg.contentType \x3d\x3d\x3d 23 \x26\x26 metadata.msg_type \x3d\x3d\x3d LIST");k="";l[0].hidden||("button"===l[0].type.toLowerCase()?k="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+l[0].title+"\x3c/button\x3e\x3c/div\x3e":
"input"===l[0].type.toLowerCase()&&(k="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e"+("\x3cbutton style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3e"+l[0].title+"\x3c/button\x3e\x3c/div\x3e")));if(1<l.length)for(z=1;z<l.length;z++)l[z].hidden||("button"===l[z].type.toLowerCase()?k+="\x3cdiv style\x3d'width: 100px; margin: auto;'\x3e\x3cbutton style\x3d'height: 27px;color: #FFF;background-color: #000;border-radius: 10px; width: 100px; margin: 10px;'\x3e"+
l[z].title+"\x3c/button\x3e\x3c/div\x3e":"input"===l[z].type.toLowerCase()&&(k+="\x3cdiv style\x3d'float: left; margin: 13px; width: 100%'\x3e\x3cinput type\x3d'text' style\x3d'background-color: #FFF;width: 60%;height:35px;' placeholder\x3d'Enter your email...'/\x3e",k+="\x3cbutton style\x3d'height: 27px; width: 11%;color: #FFF;background-color: #000;border-radius: 0 10px 10px 0;'\x3e"+l[z].title+"\x3c/button\x3e\x3c/div\x3e"));a("div[data-msgkey\x3d'"+h.key+"'] .blk-lg-12").after(k)}}k="";h.message&&
(k=h.message.replace(/\n/g,"\x3cbr/\x3e"),null!==f.emoji&&"undefined"!==typeof f.emoji&&(k=f.emoji.replace_unified(k),k=f.emoji.replace_colons(k)));h.conversationId&&(z=da[h.conversationId],"object"!==typeof z&&J.getTopicId({conversationId:h.conversationId},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)}),g&&(B.data("mck-conversationid",h.conversationId),z&&(l=ba[z.topicId],"object"===typeof l&&(ab?b.setProductProperties(l,z.topicId):Oa&&nb.html(l.title)))));4===h.contentType&&
(z=k,k="Final agreed price: "+k,Sb||(k+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+z+'" data-mck-conversationid\x3d"'+h.conversationId+'"\x3eAccept\x3c/button\x3e'));l=a("."+T+" .mck-msg-content");if(-1===k.indexOf("emoji-inner")&&0===h.contentType)for(u=k.split("\x3cbr/\x3e"),z=0;z<u.length;z++)""===u[z]?k=c.createElement("BR"):(k=c.createElement("div"),k.appendChild(c.createTextNode(u[z])),u[z]&&u[z].match(cc)&&(k=a(k).linkify({target:"_blank"}))),l.append(k);else l.html(k),
l.linkify({target:"_blank"});E&&Kommunicate.richMsgEventHandler.initializeSlick(a("div[data-msgkey\x3d'"+h.key+"'] .km-div-slider"));h.fileMeta&&(a("."+T+" .mck-file-text a:first").trigger("click"),a("."+T+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===l.html()&&l.removeClass("vis").addClass("n-vis"));2===h.contentType&&(l.removeClass("vis").addClass("n-vis"),a("."+T+" .mck-file-text").removeClass("n-vis").addClass("vis"));G&&B.animate({scrollTop:B.prop("scrollHeight")},"fast");pb.hasClass("n-vis")&&
(h.groupId?6!==D.getGroup(h.groupId).type&&pb.removeClass("n-vis").addClass("vis"):pb.removeClass("n-vis").addClass("vis"));b.addTooltip(h.key);4!==h.contentType&&10!==h.contentType&&t&&b.messageContextMenu(h.key);h.groupId&&10===h.contentType&&g&&y.getGroupFeed({groupId:h.groupId,isReloadTab:!0,apzCallback:w.onGroupFeed})}};b.addContactForSearchList=function(h,c){var E=h.userCount,g=h.isGroup,G=b.getTabDisplayName(h.contactId,g),t=b.getContactImageLink(h,G),k=g?"gs-group-"+h.htmlId:"cs-user-"+h.htmlId,
m="",l=g&&Vb;a("#li-"+k+" .mck-group-count-text").html(E);g||ta[h.contactId]||(f.MCK_OL_MAP[h.contactId]?m=MCK_LABELS.online:ca[h.contactId]&&(m=mckDateUtils.getLastSeenAtStatus(ca[h.contactId])));a.tmpl("searchContactbox",[{contHtmlExpr:k,contIdExpr:h.contactId,contTabExpr:h.isGroup,contImgExpr:t,contLastSeenExpr:m,contNameExpr:G,groupUserCountExpr:h.userCount,displayGroupUserCountExpr:l?"vis":"n-vis"}]).prependTo("#"+c)};b.getFilePath=function(h){if(2===h.contentType)try{var f=a.parseJSON(h.message);
if(f.lat&&f.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+f.lat+","+f.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+f.lat+","+f.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+f.lat+","+f.lon+"\x26key\x3d"+gc+'"/\x3e\x3c/a\x3e'}catch(z){if(-1!==h.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+h.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
h.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+h.message+"\x26key\x3d"+gc+'" /\x3e\x3c/a\x3e'}return"object"===typeof h.fileMeta?-1!==h.fileMeta.contentType.indexOf("image")?-1!==h.fileMeta.contentType.indexOf("svg")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+h.fileMeta.contentType+'" data-url\x3d"'+I.getFileurl(h)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+Ma+"/rest/ws/aws/file/"+h.fileMeta.blobKey+
'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':5===h.contentType?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+h.fileMeta.contentType+'" data-url\x3d"'+h.fileMeta.blobKey+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+h.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':h.fileMeta.hasOwnProperty("url")?h.fileMeta.hasOwnProperty("thumbnailBlobKey")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
h.fileMeta.contentType+'" data-url\x3d"'+b.cloudupdate(h.fileMeta.BlobKey)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+b.cloudupdate(h.fileMeta.thumbnailBlobKey)+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+h.fileMeta.contentType+'" data-url\x3d"'+I.getFileurl(h)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+h.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':
h.fileMeta.thumbnailUrl==="thumbnail_"+h.fileMeta.name?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+h.fileMeta.contentType+'" data-url\x3d"'+I.getFileurl(h)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+Ac+"/files/thumbnail_"+h.fileMeta.name+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+
h.fileMeta.contentType+'" data-url\x3d"'+I.getFileurl(h)+'" data-name\x3d"'+h.fileMeta.name+'"\x3e\x3cimg src\x3d"'+h.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':-1!==h.fileMeta.contentType.indexOf("video")?'\x3ca href\x3d "#" target\x3d"_self"  \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+I.getFileurl(h)+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+I.getFileurl(h)+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e':-1!==h.fileMeta.contentType.indexOf("audio")?
'\x3ca href\x3d"#" target\x3d"_self" \x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+I.getFileurl(h)+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+I.getFileurl(h)+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e':""};b.getImageForMessagePreview=function(b){if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")?
'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+Ma+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" class\x3d"mck-image-reply move-right"/\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+I.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":
'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+I.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===b.contentType)return b=a.parseJSON(b.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+b.lat+","+
b.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.lat+","+b.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};b.getImageForReplyMessage=function(b){var h=m.getTabDisplayName(b.to,!1);if("object"===typeof b.fileMeta)return-1!==b.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+h+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+
I.getFileurl(b)+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+h+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+I.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":
'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+h+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+I.getFilePreviewSize(b.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===b.contentType)return b=a.parseJSON(b.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+h+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
b.lat+","+b.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+b.lat+","+b.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};b.getImageUrlForGroupType=function(a,f){return a.imageUrl?'\x3cimg src\x3d"'+a.imageUrl+'"/\x3e':b.getContactImageByAlphabet(f)};b.getContactImageLink=function(a,f){var h="";if(a.members&&10==a.type)h=b.getImageUrlForGroupType(a,f);else if(a.isGroup&&7!==a.type)h=y.getGroupImage(a.imageUrl);else{a.isGroup&&7===a.type&&1<a.members.length&&y.getContactFromGroupOfTwo(a,
function(b){a=m.fetchContact(b)});if("function"===typeof $a){var c=$a(a.contactId);c&&"undefined"!==typeof c&&(h='\x3cimg src\x3d"'+c+'"/\x3e')}h||(a.photoSrc?h='\x3cimg src\x3d"'+a.photoSrc+'"/\x3e':a.photoData?h='\x3cimg src\x3d"data:image/jpeg;base64,'+a.photoData+'"/\x3e':a.photoLink?h='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+a.photoLink+'"/\x3e':"bot"==a.contactId?h='\x3cimg src\x3d"https://api.kommunicate.io/img/logo02.svg"/\x3e':(f||(f=a.displayName),h=b.getContactImageByAlphabet(f)))}return h};
b.getContactImageByAlphabet=function(a){if("undefined"===typeof a||""===a)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';a=a.charAt(0);return a.match(/^[a-zA-Z0-9]+$/)?(a=a.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+a+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+a+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};
b.getNameTextClassByAlphabet=function(a){if("undefined"===typeof a||""===a)return"mck-text-user";a=a.toString();a=a.charAt(0);return a.match(/^[a-zA-Z0-9]+$/)?(a=a.toLowerCase(),"mck-text-"+a):"mck-text-user"};b.addContactsFromMessageList=function(f,c){Q.removeClass("vis").addClass("n-vis");if("null"===f+"")var h="";else ac.removeClass("vis").addClass("n-vis"),0==B.has(a("#mck-contact-list")).length&&B.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),
"undefined"===typeof f.message.length?(f.message.groupId?y.addGroupFromMessage(f.message,!1,function(a,f,h){b.updateRecentConversationList(a,f,h)}):b.addContactsFromMessage(f.message),h=f.message.createdAtTime):a.each(f.message,function(a,f){"undefined"!==typeof f.to&&(f.groupId?y.addGroupFromMessage(f,!0,function(a,f,h){b.updateRecentConversationList(a,f,h)}):b.addContactsFromMessage(f,!0),h=f.createdAtTime)}),B.data("datetime",h),c.isReload&&(f="",c.lastActiveTabId&&(c=c.isLastActiveTabGroup?"group-"+
c.lastActiveTabId:"user-"+mckContactUtils.formatContactId(c.lastActiveTabId),f=a("#li-"+c)),0<f.length?B.animate({scrollTop:f.offset().top-B.offset().top+B.scrollTop()},"fast"):B.animate({scrollTop:0},0))};b.addGroupFromMessageList=function(f,c){"null"!==f+""&&(c&&B.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof f.message.length?y.addGroupFromMessage(f.message,!1,function(a,f,h){b.updateRecentConversationList(a,
f,h)}):a.each(f.message,function(a,f){"undefined"!==typeof f.to&&y.addGroupFromMessage(f,!0,function(a,f,h){b.updateRecentConversationList(a,f,h)})}))};b.createContact=function(a){var f=b.getContactDisplayName(a);"undefined"===typeof f&&(f=a);f={contactId:a,htmlId:mckContactUtils.formatContactId(a),displayName:f,name:f+" \x3c"+a+"\x3e [Main]",value:a,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return Ja[a]=f};b.createContactWithDetail=function(a){var f=a.displayName,h=a.userId;
f||(f=b.getContactDisplayName(h));"undefined"===typeof f?f=h:Ea[h]=f;var c=a.photoLink?a.photoLink:"";c||(c=a.imageLink?a.imageLink:"");var g=a.imageData?a.imageData:"";a={contactId:h,htmlId:mckContactUtils.formatContactId(h),displayName:f,name:f+" \x3c"+h+"\x3e [Main]",value:h,photoLink:"",photoSrc:c,photoData:g,email:"",unsaved:!0,isGroup:!1,roleType:a.roleType};return Ja[h]=a};b.updateContactDetail=function(a,f){var h=f.displayName,c=f.userId;a.displayName&&a.displayName!==a.contactId||(h||(h=
b.getContactDisplayName(c)),"undefined"===typeof h?h=c:Ea[c]=h,a.displayName=h);(h=f.photoLink)||(h=f.imageLink?f.imageLink:"");h&&!a.photoSrc&&(a.photoSrc=h);(h=f.imageData?f.imageData:"")&&!a.photoData&&(a.photoData=h);f.roleType&&(a.roleType=f.roleType);return Ja[c]=a};b.addContactsFromMessage=function(a,f){var h=b.getUserIdFromMessage(a);if(0<h.length&&h[0])for(var c=0;c<h.length;c++){var g=b.fetchContact(""+h[c]);b.updateRecentConversationList(g,a,f)}};b.updateRecentConversationList=function(f,
c,g){0<a("#mck-contact-list #li-"+(f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId)).length?(a("#mck-contact-list #li-"+f.htmlId+" .mck-cont-msg-wrapper").is(":empty")||g)&&void 0!==c&&b.updateContact(f,c,"mck-contact-list"):b.addContact(f,"mck-contact-list",c)};b.addContactsToSearchList=function(){var f=[],c=[];a.each(bb,function(a,b){c.push(b.contactId)});if("undefined"!==typeof contactList){var g={async:!1};g.userIds=contactList;ea.getUsersDetail(g.userIds,g);c=contactList}g=c.filter(function(a,b){return c.indexOf(a)===
b});g.sort();eb.removeClass("vis").addClass("n-vis");0<g.length?a.each(g,function(h,c){c&&(h=b.fetchContact(""+c),f.push(h),0===a("#li-cs-user-"+h.htmlId).length&&b.addContactForSearchList(h,"mck-contact-search-list"))}):Eb.removeClass("n-vis").addClass("vis");b.initAutoSuggest({contactsArray:f,$searchId:ja,isContactSearch:!0})};b.populateAutoSuggest=function(a){Ha.mcktypeahead({order:"desc",hint:!1,minLength:3,wrapper:".mck-sidebox",backdropOnFocus:!0,menu:'\x3cul class\x3d"mcktypeahead mck-auto-suggest-menu mck-dropup-menu"\x3e\x3c/ul\x3e',
show:function(){var a=e.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});return this.$menu.css({left:a.left}),this.$menu.show(),this.shown=!0,this},source:a&&a.source?b.processAutosuggestData(a.source):function(f,h){P.ajax({url:a.sourceUrl+f,type:a.method,header:a.headers,success:function(a){a=b.processAutosuggestData(a.data);h(a)}})},items:8,updater:function(a){a=JSON.parse(a);0!=Object.keys(a.metadata).length&&Ta.val(JSON.stringify(a.metadata));H.text(a.displayMessage);return a.displayMessage},
matcher:function(a){return(new RegExp(this.query,"i")).test(a.searchKey)},highlighter:function(a){return JSON.parse(a.toString()).displayMessage}})};b.processAutosuggestData=function(a){var b=[];a.map(function(a){var f="string"===typeof a?{searchKey:a,message:a,metadata:{}}:a;b.push({searchKey:f.searchKey,toString:function(){return JSON.stringify({displayMessage:f.message,metadata:f.metadata?f.metadata:{}})},toLowerCase:function(){return f.searchKey.toLowerCase()},indexOf:function(a){return String.prototype.indexOf.apply(f.searchKey,
arguments)},replace:function(a){return String.prototype.replace.apply('\x3cdiv style\x3d"padding: 10px; font-size: 1.5em;"\x3e'+f.searchKey+"\x3c/div\x3e",arguments)}})});return b};b.initAutoSuggest=function(f){for(var h=f.contactsArray,c=f.$searchId,g=[],G,t={},k=[],l=0;l<h.length;l++){var T=h[l];T.displayName=b.getTabDisplayName(T.contactId,T.isGroup);G=T.displayName?a.trim(T.displayName):a.trim(T.contactId);if(!0===MCK_SELF_CHAT_DISABLE&&T.contactId!==C||!0!==MCK_SELF_CHAT_DISABLE)t[G]=T,g.push(G),
k.push(G)}h=function(a){a=t[a];var b=a.displayName.split(" "),f=b.length,h=b[0],c="",g="";2===f?g=b[1]:3<=f&&(g=b[f-1],c=b[f-2]);b=new RegExp(this.query,"i");return b.test(a.displayName)||b.test(a.contactId)||b.test(c)||b.test(g)||b.test(a.email)||b.test(h+" "+g)};G=function(a){return t[a].displayName};k=function(b){b=t[b];f.isContactSearch?(m.loadTab({tabId:b.contactId,isGroup:b.isGroup}),xb.removeClass("n-vis").addClass("vis"),a("#mck-sidebox-ft").removeClass("n-vis").addClass("n-vis")):w.addGroupMemberFromSearch(b.contactId)};
c.hasClass("mck-typeahead")?(c.mcktypeahead().data("mcktypeahead").source=g,c.mcktypeahead().data("mcktypeahead").matcher=h,c.mcktypeahead().data("mcktypeahead").highlighter=G,c.mcktypeahead().data("mcktypeahead").updater=k):(c.addClass("mck-typeahead"),c.mcktypeahead({source:g,matcher:h,highlighter:G,updater:k}))};b.initSearchAutoType=function(){sc&&(ja.keypress(function(a){13===a.which&&((a=ja.val())&&(!0===MCK_SELF_CHAT_DISABLE&&a!==C||!0!==MCK_SELF_CHAT_DISABLE)&&(a="undefined"!==typeof a&&""!==
a?a.toString():"")&&(m.loadTab({tabId:a,isGroup:!1,isSearch:!0}),xb.removeClass("n-vis").addClass("vis")),ja.val(""))}),ma.keypress(function(a){if(13===a.which)return!0}),a(c).on("click",".mck-group-search-link",function(a){a.preventDefault();return!0}),a(c).on("click",".mck-contact-search-link",function(b){b.preventDefault();b=ja.val();""!==b&&(!0===MCK_SELF_CHAT_DISABLE&&b!==C||!0!==MCK_SELF_CHAT_DISABLE)&&(m.loadTab({tabId:b,isGroup:!1,isSearch:!0}),xb.removeClass("n-vis").addClass("vis"),a("#mck-sidebox-ft").removeClass("n-vis").addClass("vis"));
ja.val("")}))};b.removeContact=function(b){a("#li-"+(b.isGroup?"group-"+b.htmlId:"user-"+b.htmlId)).remove()};b.updateContact=function(f,c,g){var h=f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId,G=a("#li-"+h),t=G.data("msg-time");if((!c.metadata||!c.metadata.action)&&c&&c.createdAtTime>t){t=b.getUnreadCount(c.groupId?"group_"+f.contactId:"user_"+f.contactId);f=b.getMessageTextForContactPreview(c,f,200);a("#li-"+h+" .mck-cont-msg-date").html("undefined"===typeof c.createdAtTime?"":mckDateUtils.getTimeOrDate(c?
c.createdAtTime:"",!0));var k=a("#li-"+h+" .mck-cont-msg-wrapper");k.html("");"object"===typeof f?k.append(f):k.html(f);c.conversationId&&(f=c.conversationId,k=da[f],"object"===typeof k&&(k=k.topicId)&&Oa&&(k=ba[k],"object"===typeof k&&a("#li-"+h+" .mck-conversation-topic").html(k.title)),a("#li-"+h+" a").data("mck-conversationid",f));0<t&&(a("#li-"+h+" .mck-unread-count-text").html(t),a("#li-"+h+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));h=a("#"+g+" li:nth-child(1)").data("msg-time");
G.data("msg-time",c.createdAtTime);("undefined"===typeof h||(c?c.createdAtTime:"")>=h)&&0!==a("#mck-contact-list li").index(G)&&a("#"+g+" li:nth-child(1)").before(G)}};b.clearContactMessageData=function(b,f){b=mckContactUtils.formatContactId(b);f=f?"group-"+b:"user-"+b;a("#li-"+f+" .mck-cont-msg-date").html("");a("#li-"+f+" .mck-cont-msg-wrapper").html("")};b.addContact=function(h,c,g){var G=b.getMessageTextForContactPreview(g,h,100),k=h.userCount,t="",E=!1;if("undefined"!==typeof g){if(g.conversationId){t=
g.conversationId;var l=da[t]}g.groupId&&(E=!0)}var T=b.getTabDisplayName(h.contactId,E),u=b.getContactImageLink(h,T),n=!1,Ya=b.getUnreadCount(E?"group_"+h.contactId:"user_"+h.contactId),z=0<Ya&&"mck-search-list"!==c?"vis":"n-vis",L="n-vis",x=E?"group-"+h.htmlId:"user-"+h.htmlId,B=E&&Vb;a("#li-"+x+" .mck-group-count-text").html(k);a("#li-"+x+" .mck-group-count-box").removeClass("n-vis").addClass("vis");E||ta[h.contactId]||La[h.contactId]||!Ab||!f.MCK_OL_MAP[h.contactId]||(L="vis",n=!0);if(7===h.type&&
1<h.members.length){var nb;x=D.getGroup(g.groupId);y.getContactFromGroupOfTwo(x,function(a){nb=m.fetchContact(a)});E&&Ab&&f.MCK_OL_MAP[nb.contactId]&&(L="vis",n=!0)}k="n-vis";if("object"===typeof l&&Oa&&(x=ba[l.topicId],"object"===typeof x)){k="vis";var V=x.title}x=E?"group-"+h.htmlId:"user-"+h.htmlId;h=[{contHtmlExpr:x,contIdExpr:h.contactId,contTabExpr:E,msgCreatedAtTimeExpr:g?g.createdAtTime:"",mckLauncherExpr:rb,contImgExpr:u,contOlExpr:L,onlineLabel:MCK_LABELS.online,contUnreadExpr:z,contUnreadCount:Ya,
contNameExpr:T,conversationExpr:t,contHeaderExpr:k,titleExpr:V,groupUserCountExpr:E?h.userCount:"",displayGroupUserCountExpr:B?"vis":"n-vis",msgCreatedDateExpr:g?mckDateUtils.getTimeOrDate(g.createdAtTime,!0):""}];V=a("#"+c+" li:nth-child(1)").data("msg-time");"undefined"===typeof V||(g?g.createdAtTime:"")>=V||-1!==c.indexOf("search")&&n?a.tmpl("contactTemplate",h).prependTo("#"+c):a.tmpl("contactTemplate",h).appendTo("#"+c);c=a("#li-"+x+" .msgTextExpr");"object"===typeof G?c.append(G):c.html(G)};
b.addContactsToContactSearchList=function(){Eb.removeClass("vis").addClass("n-vis");Ca.removeClass("vis").addClass("n-vis");Aa.hasClass("active")||(qa.removeClass("active"),Aa.addClass("active"));pa.removeClass("vis").addClass("n-vis");za.removeClass("n-vis").addClass("vis");Ra.removeClass("vis").addClass("n-vis");R.removeClass("n-vis").addClass("vis");za.html("");oa.removeClass("vis").addClass("n-vis");G.removeClass("vis").addClass("n-vis");na.removeClass("vis").addClass("n-vis");ra.removeClass("vis").addClass("n-vis");
Xa.removeClass("n-vis").addClass("vis");eb.removeClass("n-vis").addClass("vis");0!==bb.length?m.addContactsToSearchList():Wb?(eb.removeClass("vis").addClass("n-vis"),Eb.removeClass("n-vis").addClass("vis")):ea.loadContacts();ja.focus()};b.addGroupsToGroupSearchList=function(){var f=[],c=[];Eb.removeClass("vis").addClass("n-vis");Ca.removeClass("vis").addClass("n-vis");db.hasClass("active")||(qa.removeClass("active"),db.addClass("active"));za.removeClass("vis").addClass("n-vis");pa.removeClass("n-vis").addClass("vis");
R.removeClass("vis").addClass("n-vis");Ra.removeClass("n-vis").addClass("vis");pa.html("");oa.removeClass("vis").addClass("n-vis");G.removeClass("vis").addClass("n-vis");na.removeClass("vis").addClass("n-vis");ra.removeClass("vis").addClass("n-vis");Xa.removeClass("n-vis").addClass("vis");eb.removeClass("n-vis").addClass("vis");if(0<lb.length){a.each(lb,function(a,b){c.push(b.contactId)});var g=c.filter(function(a,b){return c.indexOf(a)===b});g.sort();a.each(g,function(c,h){h&&(c=D.getGroup(""+h),
f.push(c),0===a("#li-gs-group-"+c.htmlId).length&&b.addContactForSearchList(c,"mck-group-search-list"))})}else Ca.removeClass("n-vis").addClass("vis");b.initAutoSuggest({contactsArray:f,$searchId:ma,isContactSearch:!0});eb.removeClass("vis").addClass("n-vis")};b.addConversationMenu=function(b,f){var c=B.data("mck-id");ob.html("");b===c&&(c=Fa[b],"undefined"===typeof c||0===c.length||1===c.length?(M.addClass("n-vis"),u.addClass("mck-product-box-wc"),ob.addClass("n-vis")):(ob.removeClass("n-vis"),M.removeClass("n-vis"),
u.removeClass("mck-product-box-wc"),a.each(c,function(c,h){0===a("#mck-conversation-list #li-"+h.id).length&&(c="",h.topicDetail&&(c=a.parseJSON(h.topicDetail),c="object"===typeof c?c.title:h.topicDetail),c||(c=h.topicId),a.tmpl("convTemplate",[{convIdExpr:h.id,tabIdExpr:b,isGroupExpr:f,topicIdExpr:h.topicId,convTitleExpr:c,mckLauncherExpr:rb}]).appendTo(ob))}),2>a("#mck-conversation-list li").length&&(M.addClass("n-vis"),u.addClass("mck-product-box-wc"),ob.addClass("n-vis"))))};b.loadContacts=function(f){"null"!==
f+""&&"undefined"!==typeof f&&"undefined"!==typeof f.contacts&&0!==f.contacts.length&&(bb.length=0,cb.length=0,a.each(f.contacts,function(a,f){"undefined"!==typeof f.userId&&(a=b.getContact(""+f.userId),a="undefined"===typeof a?b.createContactWithDetail(f):b.updateContactDetail(a,f),bb.push(a),cb.push(a.contactId))}))};b.loadContactsForContactList=function(a){P.ajax({url:MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d"+(a.startIndex?a.startIndex:"0")+"\x26pageSize\x3d"+(a.pageSize?a.pageSize:"50")+
"\x26orderBy\x3d1",type:"get",global:!1,success:function(a){console.log(a)},error:function(){f.console.log("Unable to load contacts. Please reload page.")}})};b.getStatusIcon=function(a){return'\x3cspan class\x3d"'+b.getStatusIconName(a)+" move-right "+a.key+'_status status-icon"\x3e\x3c/span\x3e'};b.getStatusIconName=function(a){return 7===a.type||6===a.type||4===a.type||0===a.type?"":5===a.status?"mck-icon-read":4===a.status?"mck-icon-delivered":3===a.type||5===a.type||1===a.type&&(0===a.source||
1===a.source)?"mck-icon-sent":""};b.clearMessageField=function(a){H.html("");ia.attr("disabled",!1);S.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required","").html("");a?H.focus().select():(k.blur(),H.blur())};b.addDraftMessage=function(b){O=[];b&&"object"===typeof Ua[b]?(b=Ua[b],H.html(b.text),0<b.files.length&&(a.each(b.files,function(a,b){Fb.addFileBox(b)}),p.html(b.filelb),r.html(b.filesize),S.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):
O=[]};b.showOfflineMessage=function(){"object"===typeof ua&&ua.innerHTML?(bc.html(ua.innerHTML),bc.removeClass("n-vis").addClass("vis")):f.console.log("Offline message innerHTML required.")};b.hideOfflineMessage=function(){mb.stopOfflineMessageCounter();bc.removeClass("vis").addClass("n-vis")};b.removeConversationThread=function(b,f){ALStorage.clearMckMessageArray();var c=f?D.getGroup(b):m.getContact(b),h=B.data("mck-id"),g=B.data("isgroup");"undefined"===typeof h||""===h?(b="undefined"!==typeof c?
c.htmlId:mckContactUtils.formatContactId(b),a("#li-"+(f?"group-"+b:"user-"+b)).remove()):h===b&&g===f&&(T.data("datetime",""),Q.removeClass("n-vis").addClass("vis"),N.removeClass("n-vis").addClass("vis"),pb.removeClass("vis").addClass("n-vis"))};b.removedDeletedMessage=function(b,f,c){ALStorage.clearMckMessageArray();b=a("."+b);0<b.length?(b.remove(),B.is(":empty")&&(N.removeClass("n-vis").addClass("vis"),pb.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof f&&0<a("#mck-contact-list").length&&
J.updateContactList(f,c)};b.getMessageTextForContactPreview=function(a,b,g){var h="";if("undefined"!==typeof a){if(a.message){if("true"===a.metadata.hide||a.metadata&&(a.metadata.KM_ASSIGN||a.metadata.KM_STATUS))return;if(2===a.contentType)h='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';else{h=a.message;if(P.startsWith(h,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';null!==f.emoji&&"undefined"!==typeof f.emoji&&(h=f.emoji.replace_unified(h),
h=f.emoji.replace_colons(h),h=-1!==h.indexOf("\x3c/span\x3e")?h.substring(0,h.lastIndexOf("\x3c/span\x3e")):h.substring(0,g));b.isGroup||-1!==h.indexOf("emoji-inner")||0!==a.contentType||(g=c.createElement("p"),g.appendChild(c.createTextNode(h)),h=g)}}else a.fileMetaKey&&"object"===typeof a.fileMeta?h=I.getFileIcon(a):a.metadata&&a.metadata.messagePreview&&(h=a.metadata.messagePreview);b.isGroup&&3!==b.type&&7!==b.type&&10!==b.type&&(b=a.to.split(",")[0]===C?"Me":m.getTabDisplayName(a.to.split(",")[0],
!1),10!==a.contentType&&(h=b+": "+h),-1===h.indexOf("emoji-inner")&&a&&a.message&&0===a.contentType&&(g=c.createElement("p"),g.appendChild(c.createTextNode(h)),h=g))}return h};b.getTextForMessagePreview=function(b,f){var h="";if("undefined"!==typeof b){if(2===b.contentType)h="Shared location";else if(b.message)if(h=b.message,P.startsWith(h,"\x3cimg"))h="Image attachment";else{var g=c.createElement("div");g.innerHTML=h;h=a.trim(P.textVal(g));h=h.substring(0,50)}else b.fileMetaKey&&"object"===typeof b.fileMeta&&
(h=-1!==b.fileMeta.contentType.indexOf("image")?"Image attachment":"File attachment");f.isGroup&&3!==f.type&&7!==f.type&&(h=(b.to.split(",")[0]===C?"Me":m.getTabDisplayName(b.to.split(",")[0],!1))+": "+h)}return h};b.getUserIdFromMessage=function(a){a=a.to;a.lastIndexOf(",")===a.length-1&&(a=a.substring(0,a.length-1));return a.split(",")};b.getUserIdArrayFromMessageList=function(f){var c=[];"undefined"===typeof f.length?c.concat(b.getUserIdFromMessage(f)):a.each(f,function(a,f){"undefined"!==typeof f.to&&
(c=c.concat(b.getUserIdFromMessage(f)))});return c};b.messageContextMenu=function(b){var c=a("."+b+" .mck-msg-box");c.addEventListener?c.addEventListener("contextmenu",function(a){a.preventDefault()},!1):c.bind("contextmenu",function(c){c.preventDefault();a(".mck-context-menu").removeClass("vis").addClass("n-vis");a("."+b+" .mck-context-menu").removeClass("n-vis").addClass("vis");f.event.returnValue=!1})};b.isValidMetaData=function(a){return a.metadata?"HIDDEN"===a.metadata.category||"ARCHIVE"===
a.metadata.category||"true"==a.metadata.hide?!1:!0:!0};b.updateDraftMessage=function(b,f){if("object"===typeof f){var c={text:"",files:[]};var h={fileMeta:f,filelb:I.getFilePreviewPath(f),filesize:I.getFilePreviewSize(f.size)};"undefined"!==typeof b&&"object"===typeof Ua[b]&&(c=Ua[b],a.each(c.files,function(a,b){b.filelb===h.filelb&&c.files.splice(a,1)}));c.files.push(h)}Ua[b]=c};b.updateUnreadCount=function(a,f,c){var h=b.getUnreadCount(a);Pa[a]=f;if(c||0<Qa.length)X+=f-h,0>X&&(X=0),0<X?Qa.html(X):
Qa.html("");c&&P.badgeCountOnLaucher(Ub,X)};b.incrementUnreadCount=function(a){X+=1;Pa[a]="undefined"===typeof Pa[a]?1:Pa[a]+1;0<Qa.length&&Qa.html(X);P.badgeCountOnLaucher(Ub,X)};b.getUnreadCount=function(a){return"undefined"===typeof Pa[a]?Pa[a]=0:Pa[a]};b.isGroupDeleted=function(a,b){return b?(a=w.getDeletedAtTime(a),"undefined"!==typeof a&&0<a):!1};b.getTabDisplayName=function(a,f,c){var h="";if(f)return y.getGroupDisplayName(a);"function"===typeof Qb&&(h=Qb(a));"undefined"!==typeof c&&c&&(h=
c,Ea[a]=c);h||(h=b.getContactDisplayName(a));f=b.fetchContact(""+a);h?(f.displayName=h,Ja[f.contactId]=f):"undefined"!==typeof f.displayName&&(h=f.displayName);h||(h=a);return h};b.populateMessage=function(f,c,g){var h=mckDateUtils.convertMilisIntoTime(c.metadata.CALL_DURATION);va.loadUserProfile(c.to);103==c.contentType&&(4==c.type&&"CALL_REJECTED"==c.metadata.MSG_TYPE?c.message="you rejected a Video call from "+c.to:5==c.type&&"CALL_REJECTED"==c.metadata.MSG_TYPE?c.message=c.to+"rejected a Video call from you":
4==c.type&&"CALL_END"==c.metadata.MSG_TYPE?c.message="you were in a call with "+c.to+"\n call duration : "+h:5==c.type&&"CALL_END"==c.metadata.MSG_TYPE?c.message="you were in a call with "+c.to+"\n call duration : "+h:4==c.type&&"CALL_MISSED"==c.metadata.MSG_TYPE?c.message="you missed a Video call from "+c.to:5==c.type&&"CALL_MISSED"==c.metadata.MSG_TYPE&&(c.message=c.to+"missed a Video call from you"));var G=B.data("mck-id");var k=m.isValidMetaData(c);h=c.groupId?D.getGroup(c.groupId):m.getContact(c.to);
if("undefined"===typeof G||""===G){var t=a("#mck-contact-list").length;0<t&&k?c.groupId?y.addGroupFromMessage(c,!0,function(a,f,c){b.updateRecentConversationList(a,f,c)}):m.addContactsFromMessage(c,!0):m.addContactsFromMessageList({message:[c]},"");if("APPLOZIC_01"===f||"MESSAGE_RECEIVED"===f){"undefined"===typeof h&&(h=c.groupId?D.createGroup(c.groupId):m.createContact(c.to));if(Bb){m.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}f=c.groupId?"group_"+h.contactId:
"user_"+h.contactId;k&&(10!==c.contentType&&102!==c.contentType&&m.incrementUnreadCount(f),Cb.notifyUser(c));g=c.groupId?"group-"+h.htmlId:"user-"+h.htmlId;a("#li-"+g+" .mck-unread-count-text").html(m.getUnreadCount(f));0<m.getUnreadCount(f)&&a("#li-"+g+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");J.sendDeliveryUpdate(c)}}else if("undefined"===typeof h&&(h=c.groupId?D.createGroup(c.groupId):m.createContact(c.to)),"APPLOZIC_01"===f||"MESSAGE_RECEIVED"===f){if("undefined"!==typeof h&&
(f=B.data("isgroup"),("undefined"===typeof c.oldKey||0===a("."+c.oldKey).length)&&0===a("."+c.key).length||10===c.contentType)){if("undefined"===typeof G||G!==h.contactId||f!==h.isGroup||na.hasClass("vis")){if(Bb){m.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}if(k&&10!==c.contentType||102!==c.contentType)f=c.groupId?"group_"+h.contactId:"user_"+h.contactId,m.incrementUnreadCount(f);J.sendDeliveryUpdate(c)}else{k=!0;f&&6===h.type&&(k=y.isAppendOpenGroupContextMenu(h));
if(c.conversationId&&(Oa||ab))if((f=B.data("mck-conversationid"))&&f.toString()===c.conversationId.toString())c.metadata&&"HIDDEN"===c.metadata.category||m.addMessage(c,h,!0,!0,k),J.sendReadUpdate(c.pairedMessageKey);else{if(Bb){m.loadTab({tabId:h.contactId,isGroup:h.isGroup,conversationId:c.conversationId});return}}else{if(7===h.type){var l;f=D.getGroup(c.groupId);y.getContactFromGroupOfTwo(f,function(a){l=m.fetchContact(a)});Ba.lastSeenOfGroupOfTwo(l.contactId);m.addMessage(c,h,!0,!0,k)}(!c.metadata||
"HIDDEN"!==c.metadata.category&&"true"!==c.metadata.hide&&7!==h.type)&&m.addMessage(c,h,!0,!0,k);J.sendReadUpdate(c.pairedMessageKey)}c.groupId||(a("#mck-tab-status").html(MCK_LABELS.online),va.updateUserStatus({userId:c.to,status:1},function(a){ea.getUsersDetail(a,{})}))}g&&6!==h.type&&Cb.notifyUser(c)}}else"APPLOZIC_02"!==f||102!=!c.contentType||("undefined"!==typeof c.oldKey&&0!==a("."+c.oldKey).length||0!==a("."+c.key).length)&&10!==c.contentType||(0<t?m.addContactsFromMessage(c,!0):"undefined"!==
typeof h&&(f=B.data("isgroup"),"undefined"!==typeof G&&G===h.contactId&&f===h.isGroup&&(k=!0,f&&6===h.type&&(k=y.isAppendOpenGroupContextMenu(h)),c.metadata&&"HIDDEN"===c.metadata.category||m.addMessage(c,h,!0,!0,k),3===c.type&&(a("."+c.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),m.addTooltip(c.key)))));Ia.removeClass("vis").addClass("n-vis")};b.getMessageFeed=function(b){var f={};f.key=b.key;f.timeStamp=b.createdAtTime;f.message=b.message;f.from=4===b.type?
b.to:C;f.to=b.groupId?b.groupId:5===b.type?b.to:C;f.status="read";f.type=4===b.type?"inbox":"outbox";5===b.type&&(3===b.status?f.status="sent":4===b.status&&(f.status="delivered"));if("object"===typeof b.fileMeta){var c=a.extend({},b.fileMeta);if("undefined"===typeof c.url||""===c.url)c.url=Ma+"/rest/ws/aws/file/"+b.fileMeta.blobKey;delete c.blobKey;f.file=c}f.source=b.source;f.metadata=b.metadata;return f};b.updateUnreadCountonChatIcon=function(b){if(Xb&&0<b.length){var f=null,c=0;0<b.length&&(a.each(b,
function(a,b){!(0<b.unreadCount&&null!==f)&&0<b.unreadCount&&(f=b.userId,c=b.unreadCount)}),0<X&&"none"===F.css("display")&&(null!==f&&c===X?m.loadTab({tabId:f,isGroup:!1}):m.loadTab({tabId:"",isGroup:!1})))}};b.loadMessageListOnUserDetailFetch=function(b){Ia.removeClass("vis").addClass("n-vis");var f=B.data("mck-id"),c=B.data("isgroup");if("undefined"===typeof f||b.tabId===f&&""+c===""+b.isGroup)f=D.getGroup(b.tabId),w.addGroupStatus(f),c=!0,6===f.type&&(w.validateOpenGroupUser(f),c=y.isAppendOpenGroupContextMenu(f)),
b.isMessages?(Q.removeClass("vis").addClass("n-vis"),m.processMessageList(b.messageData,!0,c),6!==f.type&&pb.removeClass("n-vis").addClass("vis"),"function"===typeof kb&&kb(b.tabId)):0===a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(pb.removeClass("vis").addClass("n-vis"),Q.removeClass("n-vis").addClass("vis"))}},A=new function(){var b=this,g=a("#mck-search"),k=a("#mck-msg-to"),n=a("#mck-msg-new");a("#mck-audio");a("#mck-mike-btn");var W=a("#mck-sidebox"),r=a("#mck-file-box"),
F=a("#mck-text-box"),S=a("#mck-msg-form"),ia=a("#mck-msg-sbmt"),K=a("#mck-new-group"),H=a("#mck-tab-title"),v=a("#mck-msg-error"),I=a("#mck-btn-attach"),X=a("#mck-tab-status"),U=a("#mck-message-cell"),Y=a(".mck-typing-box"),Q=a("#mck-gms-loading"),u=a("#mck-group-title"),ha=a("#mck-contact-loading"),L=a("#mck-no-messages"),Wa=a(".mck-group-search");a(".mck-city-search");var M=a("#mck-msg-response"),wb=a("#mck-msg-form #mck-file-input"),pa=a("#mck-block-button"),la=a("#li-mck-block-user"),oa=a("#li-mck-group-info"),
ua=a("#li-mck-video-call"),xa=a("#mck_response_text"),Aa=a(".mck-contact-search"),Ca=a("#mck-group-info-tab"),ra=a("#mck-price-text-box");a("#mck-sidebox-search");var Ea=a("#mck-group-info-btn");Ca=a("#mck-group-info-tab");var Ga=a("#mck-btn-group-exit"),aa=a("#mck-group-back-link"),ma=a("#mck-btn-leave-group"),Ra=a(".mck-sidebox-content"),wa=a("#mck-no-more-messages"),Da=a("#mck-btn-group-create");a("#mck-group-create-tab");var Na=a("#mck-group-add-member");a("#mck-contacts-content");var ja=a("#mck-tab-option-panel"),
Ha=a("#mck-no-conversations"),Pa=a("#mck-group-create-title"),Ja=a(".mck-group-menu-options"),qa=a(".mck-tab-message-option"),Qa=a(".mck-group-admin-options"),Xa=a("#mck-group-member-search"),Ia=a("#mck-autosuggest-search-input"),Sa=a("#mck-autosuggest-metadata"),q=a("#mck-message-cell .mck-message-inner");a("#mck-search-cell .mck-message-inner");var Ma=a("#mck-no-more-conversations"),$a=a("#mck-gm-search-box"),lb=a("#mck-group-member-search-list"),qb=a("#mck-no-gsm-text"),eb,ib=a("#mck-minutes"),
jb=a("#mck-seconds");b.createNewConversation=function(a,b){Kommunicate.startConversation(a,b)};b.loadConversationWithAgents=function(b,f){"kommunicate"==window.applozic.PRODUCT_ID&&ma.removeClass("vis").addClass("n-vis");Kommunicate.client.getGroupDetailByType({type:10,startIndex:0,limit:10},function(b,c){b?console.log("error while fetching group detail by type",b):0==c.response.length?A.createNewConversation({groupName:fb,agentId:gb,botIds:hb},function(a){f()}):(1==c.response.length?a.fn.applozic("loadGroupTab",
c.response[0].id):a.fn.applozic("loadTab"),f())})};b.timer=function(){var a=0,b=this;eb=setInterval(function(){++a;jb.html(b.pad(a%60));ib.html(b.pad(parseInt(a/60)))},1E3);b.pad=function(a){a+="";return 2>a.length?"0"+a:a}};b.stoptimer=function(){jb.html("0");ib.html("0");clearInterval(eb)};a(c).on("click",".mck-message-delete",function(){b.deleteMessage(a(this).parents(".mck-m-b").data("msgkey"))});a(c).on("click",".mck-message-reply",function(){b.replyMessage(a(this).parents(".mck-m-b").data("msgkey"))});
a(c).on("click",".mck-message-forward",function(){n.data("forwardMessageKey",a(this).parents(".mck-m-b").data("msgkey"));n.trigger("click")});a(".mck-minimize-icon").click(function(){a(".mck-box-md,.mck-box-ft").animate({height:"toggle"});Ra.hasClass("minimized")?(Ra.css("height","100%"),Ra.removeClass("minimized")):(Ra.css("height","0%"),Ra.addClass("minimized"))});b.init=function(){a.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');
ALStorage.clearMckMessageArray();a(c).on("click","."+rb,function(){a(this).hasClass("mck-msg-preview")&&a(this).hide()});m.initSearchAutoType();Aa.click(function(){A.createNewConversation({groupName:fb,agentId:gb,botIds:hb},function(a){})});a(c).on("click","#talk-to-human-link",function(){""===a("#km-faq-search-input").val()?(A.createNewConversation({groupName:fb,agentId:gb,botIds:hb},function(a){}),KommunicateUI.showChat()):A.createNewConversation({groupName:fb,agentId:gb,botIds:hb},function(a){KommunicateUI.sendFaqQueryAsMsg(a);
KommunicateUI.showChat()});a("#mck-contact-list").removeClass("vis").addClass("n-vis")});Wa.click(function(){m.addGroupsToGroupSearchList()});F.keydown(function(a){F.hasClass("mck-text-req")&&F.removeClass("mck-text-req");if(13===a.keyCode&&(a.shiftKey||a.ctrlKey)){if(a.preventDefault(),f.getSelection){a=f.getSelection();var b=a.getRangeAt(0),g=c.createElement("br"),k=c.createTextNode("\u00a0");b.deleteContents();b.insertNode(g);b.collapse(!1);b.insertNode(k);b.selectNodeContents(k);a.removeAllRanges();
a.addRange(b);F.animate({scrollTop:F.prop("scrollHeight")},0);return!1}}else 13===a.keyCode?(a.preventDefault(),1===na&&fa.sendTypingStatus(0,q.data("mck-id")),ia.is(":disabled")&&r.hasClass("vis")?alert("Please wait file is uploading."):S.submit()):0===na&&fa.sendTypingStatus(1,q.data("mck-id"))});a(c).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&A.deleteConversation()});a(c).on("click",".applozic-tm-launcher",function(b){b.preventDefault();var f=a(this).data("mck-id");
f="undefined"!==typeof f&&""!==f?f.toString():"";var c=a(this).data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():"";b=a(this).data("mck-supportid");b="undefined"!==typeof b&&""!==b?b.toString():"";var g=a(this).data("mck-topicid");g="undefined"!==typeof g&&""!==g?g.toString():"";var k=a(this).data("mck-msg");k="undefined"!==typeof k&&""!==k?k.toString():"";if("function"===typeof Ta&&g){var G=Ta(g);"object"===typeof G&&"undefined"!==G.title&&(ba[g]=G)}f={topicId:g,tabId:f,userName:c,isMessage:!0};
f.messagePxy={type:5,contentType:0,message:k};b?(f.isGroup=!0,f.supportId=b,A.getConversationId(f)):(f.isGroup=!1,m.loadTab(f,J.dispatchMessage))});a(c).on("click",".applozic-wt-launcher",function(b){b.preventDefault();b=a(this).data("mck-id");b="undefined"!==typeof b&&""!==b?b.toString():"";var f=a(this).data("mck-name");f="undefined"!==typeof f&&""!==f?f.toString():"";var c=a(this).data("mck-topicid");c="undefined"!==typeof c&&""!==c?c.toString():"";var g=a(this).data("mck-topic-status");g=g?-1===
R.indexOf(g)?R[0]:g.toString():R[0];if("function"===typeof Ta){var k=Ta(c);"object"===typeof k&&"undefined"!==k.title&&(ba[c]=k)}A.getConversationId({tabId:b,isGroup:!1,userName:f,topicId:c,topicStatus:g,isMessage:!1})});a(c).on("click",".applozic-ct-launcher",function(b){b.preventDefault();var f=a(this).data("mck-id");f="undefined"!==typeof f&&""!==f?f.toString():"";var c=a(this).data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():"";b=a(this).data("mck-topicid");b="undefined"!==typeof b&&
""!==b?b.toString():"";var g=a(this).data("mck-topic-status");g=g?-1===R.indexOf(g)?R[0]:g.toString():R[0];f={tabId:f,isGroup:!1,userName:c,topicId:b,topicStatus:g,isMessage:!1};"function"===typeof Tb&&(c=Tb(b),"object"===typeof c&&(c.topicDetail&&"object"===typeof c.topicDetail&&"undefined"!==c.topicDetail.title&&(ba[b]=c.topicDetail),c.fallBackTemplatesList&&0<c.fallBackTemplatesList.length&&(f.fallBackTemplatesList=c.fallBackTemplatesList)));A.getConversationId(f)});a(c).on("click","."+rb+", .mck-contact-list ."+
rb,function(b){b.preventDefault();b=a(this);var f=this;b.data("mck-id")?b.parents(".mck-search-list").length?(g.bind("blur"),setTimeout(function(){A.openChat(f)},600)):A.openChat(f):a.fn.applozic("mckLaunchSideboxChat")});a("#km-form-chat-login").submit(function(a){var b=$("#km-submit-chat-login"),f=$("#km-error-chat-login"),c=$("#km-userId").val();a=$("#km-email").val();var g=$("#km-userName").val(),k=$("#km-contact").val();k&&(c=k);a&&(c=a);b.attr("disabled",!0);b.html("Initiating chat...");f.removeClass("show").addClass("hide");
f.html("");b={userId:c,applicationId:Z,onInit:t,baseUrl:MCK_BASE_URL,locShare:sb,googleApiKey:jc};a&&(b.email=a);g&&(b.displayName=g);k&&(b.contactNumber=k);mb.initialize(b);return!1});var t=function(){"kommunicate"===window.applozic.PRODUCT_ID&&ma.removeClass("vis").addClass("n-vis");A.loadConversationWithAgents({groupName:fb,agentId:gb,botIds:hb})};a(".km-login-model-close").on("click",function(b){a("#km-chat-login-modal").css("display","none")});a(c).on("click",".mck-conversation-tab-link",function(b){b.preventDefault();
a(this);b=q.data("mck-id");var f=q.data("isgroup");KommunicateUI.hideAwayMessage();KommunicateUI.hideLeadCollectionTemplate();m.loadTab({tabId:"",isGroup:!1,lastActiveTabId:b,isLastActiveTabGroup:f})});a(c).on("click",".mck-close-sidebox",function(b){b.preventDefault();W.mckModal("hide");a("#mck-sidebox-launcher").removeClass("n-vis").addClass("vis");b=q.data("mck-conversationid");q.data("mck-id","");q.data("mck-topicid","");q.data("mck-name","");q.data("mck-conversationid","");b&&(b=da[b],"object"===
typeof b&&(b=b.topicId,"function"===typeof Nb&&Nb(C,b)));fa.unsubscibeToTypingChannel()});a(c).on("click",".mck-price-submit",function(a){a.preventDefault();b.sendPriceMessage()});ra.keydown(function(a){13===a.keyCode&&b.sendPriceMessage()});q.bind("scroll",function(){if(0<q.find(".mck-contact-list").length){if(q.scrollTop()+q.innerHeight()>=q[0].scrollHeight){var a=q.data("datetime");0<a&&!Ka&&A.loadMessageList({tabId:"",isGroup:!1,startTime:a})}}else if(0===q.scrollTop()){var b=q.data("mck-id");
if("undefined"!==typeof b&&""!==b){var f=q.data("isgroup"),c=q.data("mck-conversationid");c=c?c.toString():"";a=ja.data("datetime");0<a&&!Ka&&A.loadMessageList({tabId:b,isGroup:f,conversationId:c,startTime:a})}}});ra.on("click",function(a){a.preventDefault();ra.removeClass("mck-text-req")});pa.on("click",function(a){a.preventDefault();a=q.data("mck-id");var b=q.data("isgroup"),f=!q.data("blocked");b?(la.removeClass("vis").addClass("n-vis"),ua.removeClass("vis").addClass("n-vis")):confirm(f?MCK_LABELS["block.user.alert"]:
MCK_LABELS["unblock.user.alert"])&&va.blockUser(a,f,function(a){Ba.toggleBlockUser(a,f)})});ma.on("click",function(a){a.preventDefault();a=q.data("mck-id");q.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&y.leaveGroup({apzCallback:w.onGroupLeft,groupId:a}):Ja.removeClass("vis").addClass("n-vis")});a(c).on("click",".mck-add-to-group",function(b){b.preventDefault();b=a(this).data("mck-id");"undefined"!==typeof b&&w.addGroupMemberFromSearch(b);$a.mckModal("hide")});a(c).on("click",".mck-btn-remove-member",
function(b){b.stopPropagation();b=a(this).parents(".mck-li-group-member").data("mck-id");var f=Ca.data("mck-id");if("undefined"!==typeof f&&"undefined"!==typeof b){var c=D.getGroup(f);"object"===typeof c&&C===c.adminName?confirm(MCK_LABELS["remove.member.alert"])&&y.removeGroupMember({groupId:f,userId:b,apzCallback:w.onRemovedGroupMember}):Qa.removeClass("vis").addClass("n-vis")}});Ga.on("click",function(a){a.preventDefault();(a=Ca.data("mck-id"))?confirm(MCK_LABELS["exit.group.alert"])&&y.leaveGroup({groupId:a,
apzCallback:w.onGroupLeft}):m.loadTab({tabId:"",isGroup:!1})});Ea.on("click",function(a){a.preventDefault();a=q.data("mck-id");if(q.data("isgroup")){a={groupId:a};var b=q.data("mck-conversationid");b&&(a.conversationId=b);w.loadGroupInfo(a)}else Ja.removeClass("vis").addClass("n-vis")});K.on("click",function(a){a.preventDefault();w.loadCreateGroupTab()});aa.on("click",function(a){a.preventDefault();var b=Ca.data("mck-id");a=Ca.data("mck-conversation-id");b?(b={tabId:b,isGroup:!0},a&&(b.conversationId=
a),m.loadTab(b)):m.loadTab({tabId:"",isGroup:!1})});Na.on("click",function(b){b.preventDefault();if(b=Ca.data("mck-id"))(b=D.getGroup(b))&&b.adminName===C?(lb.html(""),$a.mckModal(),Q.removeClass("n-vis").addClass("vis"),0<cb.length?w.addMembersToGroupSearchList():Wb?0<bb.length?(a.each(bb,function(a,b){cb.push(b.contactId)}),w.addMembersToGroupSearchList()):(Q.removeClass("vis").addClass("n-vis"),qb.removeClass("n-vis").addClass("vis")):va.getUserStatus({callback:w.addMembersToGroupSearchList},function(b){a.each(b.users,
function(a,b){a=m.getContact(""+b.userId);a="undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b);cb.push(a.contactId)})})):Qa.removeClass("vis").addClass("n-vis")});Xa.keypress(function(a){if(13===a.which)return a=Xa.val(),""!==a&&w.addGroupMemberFromSearch(a),Xa.val(""),!0});a(c).on("click",".mck-group-member-search-link",function(a){a.preventDefault();a=Xa.val();""!==a&&w.addGroupMemberFromSearch(a);Xa.val("")});a(c).on("click",".mck-show-more",function(b){b.preventDefault();
var f=a(this);b=f.data("tabId");var c=q.data("isgroup"),g=q.data("mck-conversationid");g=g?g.toString():"";f=f.data("datetime");A.loadMessageList({tabId:b,isGroup:c,conversationId:g,startTime:f})});a(c).on("click",".mck-accept",function(b){b=a(this).data("mck-conversationid");var f=a(this).data("mck-topic-price");if("function"===typeof Za&&f&&b){var c=da[b],g=k.val();g=y.getGroupDisplayName(g);"object"===typeof c?(Za({custId:C,suppId:g,productId:c.topicId,price:f}),J.sendConversationCloseUpdate(b)):
J.getTopicId({conversationId:b,suppId:g,priceText:f},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)})}});S.submit(function(){1===na&&fa.sendTypingStatus(0,q.data("mck-id"));var c=a.trim(P.textVal(F[0]));r.hasClass("n-vis")&&0<O.length&&(O=[]);if(0===c.length&&0===O.length)return F.addClass("mck-text-req"),!1;if("function"===typeof Rb&&!Rb(c))return!1;c={type:5,contentType:0,message:c};var g=Kommunicate.getSettings("KM_CHAT_CONTEXT");g&&(c.metadata={KM_CHAT_CONTEXT:g});var t=q.data("mck-conversationid");
g=q.data("mck-topicid");t?c.conversationId=t:g&&(t={topicId:g},g=ba[g],"object"===typeof g&&(t.topicDetail=f.JSON.stringify(g)),c.conversationPxy=t);(g=Sa.val())&&""!=g&&(c.metadata={suggestMessageMetadata:g},Sa.val(""));""!=Ia.data("prev-msgkey")&&"undefined"!=typeof Ia.data("prev-msgkey")&&(A.updateMessageMetadata({key:Ia.data("prev-msgkey"),metadata:{obsolete:!0}}),Ia.data("prev-msgkey",""));Ia.hasClass("mck-text-box")&&(Ia.addClass("n-vis").removeClass("mck-text-box").val(""),F.removeClass("n-vis").addClass("mck-text-box"),
Ia.data("source-url",""),a(".mck-dropup-menu").hide());!0===q.data("isgroup")?c.groupId=k.val():c.to=k.val();ia.attr("disabled",!0);v.removeClass("vis").addClass("n-vis");v.html("");xa.html("");M.removeClass("vis").addClass("n-vis");if(1==a("[data-msgtype\x3d5]").length&&KommunicateUI.isLeadCollectionEnabled&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId&&!KommunicateUI.validateEmail(c.message))return!1;b.sendMessage(c);return!1});wb.on("click",function(){a(this).val("");
v.removeClass("vis").addClass("n-vis");M.removeClass("vis").addClass("n-vis")});a(c).bind("click",function(b){a(".mck-context-menu").removeClass("vis").addClass("n-vis");!I.hasClass("on")||a(b.target).hasClass("mck-icon-upload")||a(b.target).hasClass("mck-btn-attach")||Zb.fileMenuToggle();F.removeClass("mck-text-req");c.activeElement&&c.activeElement!==F&&1===na&&fa.sendTypingStatus(0,q.data("mck-id"));c.activeElement&&"mck-group-name-save"!==c.activeElement.id&&u.removeClass("mck-req-border");c.activeElement&&
"mck-btn-group-create"!==c.activeElement.id&&Pa.removeClass("mck-req-border");a(".mcktypeahead.mck-dropdown-menu").hide()});a(".mck-tabview-item").click(function(){a(".mck-tabview-item").removeClass("active");a(this).addClass("active")})};a(".mck-sidebox").on("click","#mck-mike-btn",function(){a(this).removeClass("vis").addClass("n-vis");$(".mck-stop-btn").addClass("vis").removeClass("n-vis");Fr.voice.record(!1,function(){$("#mck-audio").removeClass("n-vis").addClass("vis");A.timer()})});a(".mck-sidebox").on("click",
"#mck-stop-recording",function(){$("#mck-mike-btn").addClass("vis").removeClass("n-vis");$(".mck-stop-btn").addClass("n-vis").removeClass("vis");$("#mck-audio").removeClass("vis").addClass("n-vis");A.stoptimer();Fr.voice.export(function(b){var f={};f.file=b;f.name="blob";a.fn.applozic("audioAttach",f)},"blob");Fr.voice.stop()});b.openChat=function(b){var f=a(b);b=f.data("mck-id");b="undefined"!==typeof b&&""!==b?b.toString():"";var c=f.data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():
"";var k=f.data("mck-topicid");k="undefined"!==typeof k&&""!==k?k.toString():"";var t=!0===f.data("isgroup");f=f.data("mck-conversationid");f="undefined"!==typeof f&&""!==f?f.toString():"";k&&!f?(f=(f=a(elem).data("mck-topic-status"))?-1===R.indexOf(f)?R[0]:f.toString():R[0],A.getConversationId({tabId:b,isGroup:t,userName:c,topicId:k,topicStatus:f,isMessage:!1})):m.loadTab({tabId:b,isGroup:t,userName:c,conversationId:f,topicId:k});g.val("")};b.sendMessage=function(f){if(void 0!==$("#mck-message-cell .mck-message-inner div[name\x3d'message']:last-child").data("msgkey")){var c=
$("#mck-message-cell .mck-message-inner div[name\x3d'message']:last-child").data("msgkey");c=J.getReplyMessageByKey(c)}if("object"===typeof f)if(f.to&&ya[f.to]&&(ya[f.to].deletedAtTime||!0===Hc))v.html(MCK_LABELS["user.delete"]).removeClass("n-vis").addClass("vis"),a("#mck-tab-status").removeClass("vis").addClass("n-vis"),S.removeClass("vis").addClass("n-vis"),la.removeClass("vis").addClass("n-vis");else{var g=f.metadata?f.metadata:{};var k=a("#mck-text-box").data("AL_REPLY");"undefined"===typeof k||
""===k||f.forward||(g.AL_REPLY=k);f.metadata=g;if("undefined"!==typeof f.message&&0!==f.message.length||0!==O.length){c&&c.metadata.altype&&(0===c.type||4===c.type||6===c.type)&&(g.altype=c.metadata.altype);if(f.conversationId&&(c=da[f.conversationId],"undefined"!==c&&c.closed)){m.closeConversation();ia.attr("disabled",!1);return}if(q.data("blocked")&&!f.groupId)Ba.toggleBlockUser(l,!0),ia.attr("disabled",!1);else{var t="";f.groupId?(t=D.getGroup(f.groupId),"undefined"===typeof t&&(t=D.createGroup(f.groupId))):
t=f.clientGroupId?D.getGroupByClientGroupId(f.clientGroupId):m.fetchContact(f.to);0<a("#mck-message-cell .mck-no-data-text").length&&a(".mck-no-data-text").remove();if(f.message&&0===O.length){g=qa.hasClass("n-vis");var l=q.data("mck-id");var u=P.randomId();f.key=u;12!==f.contentType&&l&&l.toString()===t.contactId&&102!==f.contentType&&J.addMessageToTab(f,t,function(a,b){m.addMessage(a,b,!0,!0,!1)});l={tabId:t.contactId,isTopPanelAdded:g};b.submitMessage(f,l)}else!f.message||0===O.length||1!==f.contentType&&
2!==f.contentType?0<O.length&&a.each(O,function(a,c){a=qa.hasClass("n-vis");var g=q.data("mck-id"),k=P.randomId();f.key=k;f.fileMeta=c;f.contentType=1;12!==f.contentType&&g&&g.toString()===t.contactId&&J.addMessageToTab(f,t,function(a,b){m.addMessage(a,b,!0,!0,!1)});b.submitMessage(f,{tabId:t.contactId,isTopPanelAdded:a})}):(g=qa.hasClass("n-vis"),l=q.data("mck-id"),u=P.randomId(),f.key=u,c={},f.groupId?c.groupId=f.groupId:c.to=f.to,c.type=f.type,c.key=P.randomId(),c.message=f.message,c.contentType=
f.contentType,f.contentType=1,f.fileMeta=O[0],f.message="",12!==f.contentType&&l&&l.toString()===t.contactId&&(J.addMessageToTab(f,t,function(a,b){m.addMessage(a,b,!0,!0,!1)}),J.addMessageToTab(c,t,function(a,b){m.addMessage(a,b,!0,!0,!1)})),l={tabId:t.contactId,isTopPanelAdded:g},b.submitMessage(f,l),b.submitMessage(c,l));F.removeClass("mck-text-req");ia.attr("disabled",!1);a("."+u+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");m.addTooltip(u);m.clearMessageField(!0);
O=[];delete Ua[t.contactId]}}else F.addClass("mck-text-req")}};b.sendForwardMessage=function(a){var c=ALStorage.getMessageByKey(a);if("undefined"!==typeof c){c.fileMeta&&O.push(c.fileMeta);a={type:5,contentType:c.contentType,message:c.message,forward:"forward"};c.metadata&&(c.metadata.AL_REPLY&&(c.metadata.AL_REPLY=""),a.metadata=c.metadata);var g=q.data("mck-conversationid");c=q.data("mck-topicid");g?a.conversationId=g:c&&(g={topicId:c},c=ba[c],"object"===typeof c&&(g.topicDetail=f.JSON.stringify(c)),
a.conversationPxy=g);!0===q.data("isgroup")?a.groupId=k.val():a.to=k.val();b.sendMessage(a)}};b.sendWelcomeMessage=function(a){var b=P.randomId(),f=q.data("mck-id"),c=q.data("isgroup");b={key:b,type:4,contentType:0,to:a.sender,message:a.messageContent};f&&f.toString()===a.sender&&!c&&(f=m.fetchContact(f),J.addMessageToTab(b,f,function(a,b){m.addMessage(a,b,!0,!0,!1)}));P.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+encodeURIComponent(a.sender)+"\x26messageContent\x3d"+
encodeURIComponent(a.messageContent),contentType:"text/plain",success:function(b){a.callback&&a.callback(b)}})};b.submitMessage=function(b,c){var g=b.key,k=b.metadata?b.metadata:{};nc&&(b.metadata={userStatus:4});var l=a("#mck-text-box").data("AL_REPLY");"undefined"===typeof l||""===l||b.forward||(k.AL_REPLY=l,a("#mck-text-box").data("AL_REPLY",""));b.source=Dc;var t=a("#mck-message-cell .mck-message-inner div[name\x3d'message']."+g);102!=b.contentType&&103!=b.contentType&&(b.metadata=mc);b.metadata=
k;P.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:f.JSON.stringify(b),contentType:"application/json",success:function(f){var k=q.data("mck-id");if("object"===typeof f){var l=f.messageKey;if(k&&k.toString()===c.tabId){var u=f.conversationId;q.data("mck-conversationid",u);t.removeClass(g).addClass(l);t.data("msgkey",l);a("."+l+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title","sent");m.addTooltip(l);c.isTopPanelAdded&&ja.data("datetime",
f.createdAt);f=!0;b.groupId&&6===D.getGroup(b.groupId).type&&(f=!1);f&&m.messageContextMenu(l)}b.conversationPxy&&(l=b.conversationPxy,b.topicId&&(za[b.topicId]=[u]),da[u]=l)}else"CONVERSATION_CLOSED"===f||"BUSY_WITH_OTHER"===f?(ia.attr("disabled",!1),m.closeConversation(f),t.remove(),c.isTopPanelAdded&&qa.removeClass("vis").addClass("n-vis")):"error"===f&&(ia.attr("disabled",!1),v.html("Unable to process your request. Please try again"),v.removeClass("n-vis").addClass("vis"),t.remove(),c.isTopPanelAdded&&
qa.removeClass("vis").addClass("n-vis"));u=a("[data-msgtype\x3d5]").length;1==u&&KommunicateUI.isLeadCollectionEnabled&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId&&KommunicateUI.displayLeadCollectionTemplate(null);1<u&&a("#mck-email-collection-box").removeClass("vis").addClass("n-vis");u=m.getTabDisplayName(k,!1);ya[k]||k===u||(ea.updateDisplayName(k,u),k={userId:k,userName:u},ya[k.userId]=k)},error:function(){v.html("Unable to process your request. Please try again.");
v.removeClass("n-vis").addClass("vis");t&&t.remove();c.isTopPanelAdded&&qa.removeClass("vis").addClass("n-vis")}});$("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};b.updateMessageMetadata=function(a){a.metadata||a.messageKey?P.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/update/metadata",global:!1,data:f.JSON.stringify(a),contentType:"application/json",success:function(a){console.log("metadata updated: ",a)},error:function(){}}):console.log("empty metadata")};b.downloadImage=function(a){window.open(a,
"_blank")};b.replyMessage=function(b){q.data("mck-id");var f=J.getReplyMessageByKey(b);F.focus().select();$("#mck-reply-to-div").removeClass("n-vis").addClass("vis");var c=5===f.type?"You":m.getTabDisplayName(f.to,!1);$("#mck-reply-to").html(c);"object"===typeof f.fileMeta||2===f.contentType?$("#mck-reply-msg").html(m.getImageForMessagePreview(f)):$("#mck-reply-msg").html(f.message);a("#mck-text-box").data("AL_REPLY",b)};$("#close").click(function(){$("#mck-reply-to-div").removeClass("vis").addClass("n-vis");
a("#mck-text-box").data("AL_REPLY","")});b.deleteMessage=function(b){var c=q.data("mck-id");"undefined"!==typeof c&&P.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+b,type:"get",success:function(g){"success"===g?(q.data("mck-id")===c&&(a("."+b).remove(),q.is(":empty")&&qa.removeClass("vis").addClass("n-vis")),ALStorage.clearMckMessageArray()):f.console.log("Unable to delete message. Please reload page.")}})};b.deleteConversation=function(){var a=q.data("mck-id"),b=q.data("isgroup"),f=q.data("mck-conversationid");
if("undefined"!==typeof a){var c={};b?c.groupId=a:c.userId=a;f&&(c.conversationId=f);Ka=!0;window.Applozic.ALApiService.deleteConversation({data:c,success:function(){q.data("mck-id")===a&&(q.html(""),ja.data("datetime",""),U.removeClass("n-vis").addClass("vis"),L.removeClass("n-vis").addClass("vis"),qa.removeClass("vis").addClass("n-vis"),Ka=!1)},error:function(){}})}};b.loadMessageList=function(b,c){var g=!1,k=!1,l="";"undefined"!==typeof b.tabId&&""!==b.tabId?(l=b.isGroup?"\x26groupId\x3d"+b.tabId:
"\x26userId\x3d"+encodeURIComponent(b.tabId),g=!0,b.startTime&&(l+="\x26endTime\x3d"+b.startTime),l+="\x26pageSize\x3d30",(Oa||ab)&&b.conversationId&&(l+="\x26conversationId\x3d"+b.conversationId,"undefined"===typeof Fa[b.tabId]?(k=!0,l+="\x26conversationReq\x3dtrue"):m.addConversationMenu(b.tabId,b.isGroup)),b.isGroup&&Kommunicate.getAwayMessage({applicationId:Z,conversationId:b.tabId},KommunicateUI.populateAwayMessage)):(Ka=!0,b.startTime&&(l+="\x26endTime\x3d"+b.startTime),l+="\x26mainPageSize\x3d60");
b.startTime||q.html("");ha.removeClass("n-vis").addClass("vis");P.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+l,type:"get",global:!1,success:function(l){var u=!0;KommunicateUI.displayLeadCollectionTemplate(l.message);var t=q.data("mck-id"),x=q.data("isgroup");b.isGroup&&!b.startTime||ha.removeClass("vis").addClass("n-vis");Ka=!1;if("undefined"===typeof t||b.tabId===t&&""+x===""+b.isGroup){if("null"===l+""||"undefined"===typeof l.message||0===l.message.length)u=!1,g?b.startTime?
(wa.removeClass("n-vis").addClass("vis"),wa.fadeOut(5E3,function(){wa.removeClass("vis").addClass("n-vis")}),ja.data("datetime","")):b.isGroup||0!==a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||(qa.removeClass("vis").addClass("n-vis"),Ha.removeClass("vis").addClass("n-vis"),L.removeClass("n-vis").addClass("vis")):(L.removeClass("vis").addClass("n-vis"),b.startTime?(Ma.removeClass("n-vis").addClass("vis"),Ma.fadeOut(5E3,function(){Ma.removeClass("vis").addClass("n-vis")})):
(L.removeClass("vis").addClass("n-vis"),Ha.removeClass("n-vis").addClass("vis")),q.data("datetime",""));if("null"!==l+""&&"error"!==l.status)if(g){u&&(0<b.startTime?m.processMessageList(l,!1,!0):b.isGroup||(m.processMessageList(l,!0,!0),qa.removeClass("n-vis").addClass("vis")));0< !b.startTime&&!b.isGroup&&"function"===typeof kb&&kb(b.tabId);0<l.userDetails.length&&a.each(l.userDetails,function(a,c){ya[c.userId]=c;b.isGroup||(c.connected?f.MCK_OL_MAP[c.userId]=!0:(f.MCK_OL_MAP[c.userId]=!1,"undefined"!==
typeof c.lastSeenAtTime&&(ca[c.userId]=c.lastSeenAtTime)),tb||b.isGroup||(c.blockedByThis?(ta[c.userId]=!0,Ba.toggleBlockUser(b.tabId,!0)):c.blockedByOther?(La[c.userId]=!0,H.removeClass("mck-tab-title-w-status"),X.removeClass("vis").addClass("n-vis"),Y.removeClass("vis").addClass("n-vis"),q.data("blocked",!1)):Ba.toggleBlockUser(b.tabId,!1)),c.userName&&!b.startTime&&(a=m.getTabDisplayName(b.tabId,b.isGroup,c.userName),H.html(a),H.attr("title",a)))});!ub||b.isGroup||b.startTime||f.MCK_OL_MAP[b.tabId]||
mb.manageOfflineMessageTime(b.tabId);if(0<l.conversationPxys.length){var V=[];a.each(l.conversationPxys,function(b,c){if("object"===typeof c&&(V.push(c),da[c.id]=c,za[c.topicId]=[c.id],c.topicDetail))try{ba[c.topicId]=a.parseJSON(c.topicDetail)}catch(cc){f.console.log("Incorect Topic Detail!")}});k&&(Fa[b.tabId]=V,m.addConversationMenu(b.tabId,b.isGroup))}b.conversationId&&(t=da[b.conversationId],"object"===typeof t&&t.closed&&m.closeConversation());b.startTime||(b.isGroup?(w.addGroupStatus(D.getGroup(b.tabId)),
m.updateUnreadCount("group_"+b.tabId,0,!0)):m.updateUnreadCount("user_"+b.tabId,0,!0),"function"===typeof c&&c(b));0<l.groupFeeds.length&&a.each(l.groupFeeds,function(f,c){f=D.addGroup(c);if(!b.startTime){var g=[];a.each(c.membersId,function(a,b){"undefined"===typeof m.getContact(b)&&g.push(b)});if(0<g.length)b.isMessages=u,b.messageData=l,b.isLoadMessageList=!0,ea.getUsersDetail(g,b);else{w.addGroupStatus(f);c=!0;var h;7===f.type&&(oa.removeClass("vis").addClass("n-vis"),y.getContactFromGroupOfTwo(f,
function(a){h=m.fetchContact(a)}),Ba.lastSeenOfGroupOfTwo(h.contactId));"kommunicate"==window.applozic.PRODUCT_ID&&(3!==f.users[C].role&&2!==f.users[C].role&&0!==f.users[C].role||oa.removeClass("vis").addClass("n-vis"));6===f.type&&(w.validateOpenGroupUser(f),c=y.isAppendOpenGroupContextMenu(f));ha.removeClass("vis").addClass("n-vis");u?(L.removeClass("vis").addClass("n-vis"),m.processMessageList(l,!0,c),6!==f.type&&qa.removeClass("n-vis").addClass("vis")):0===a("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&
(qa.removeClass("vis").addClass("n-vis"),L.removeClass("n-vis").addClass("vis"));"function"===typeof kb&&kb(b.tabId)}}})}else b.startTime||(f.MCK_OL_MAP=[]),0<l.userDetails.length&&a.each(l.userDetails,function(a,b){ya[b.userId]=b;b.connected?f.MCK_OL_MAP[b.userId]=!0:(f.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(ca[b.userId]=b.lastSeenAtTime));m.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):
m.updateContactDetail(a,b)}),0<l.groupFeeds.length&&a.each(l.groupFeeds,function(a,b){m.updateUnreadCount("group_"+b.id,b.unreadCount,!1);D.addGroup(b)}),0<l.blockedUserPxyList.blockedToUserList.length&&a.each(l.blockedUserPxyList.blockedToUserList,function(a,b){b.userBlocked&&(ta[b.blockedTo]=!0)}),0<l.blockedUserPxyList.blockedByUserList.length&&a.each(l.blockedUserPxyList.blockedByUserList,function(a,b){b.userBlocked&&(La[b.blockedBy]=!0)}),0<l.conversationPxys.length&&a.each(l.conversationPxys,
function(b,c){da[c.id]=c;za[c.topicId]=[c.id];if(c.topicDetail)try{ba[c.topicId]=a.parseJSON(c.topicDetail)}catch(cc){f.console.log("Incorect Topic Detail!")}}),u?(b.startTime?b.startTime&&(b.isReload=!1,g||ALStorage.updateLatestMessageArray(l.message)):(b.isReload=!0,g||ALStorage.setLatestMessageArray(l.message)),g&&ALStorage.updateMckMessageArray(l.message),m.addContactsFromMessageList(l,b)):q.data("datetime",""),b.isLaunch&&m.updateUnreadCountonChatIcon(l.userDetails)}t=n.data("forwardMessageKey");
"undefined"!==typeof t&&(A.sendForwardMessage(t),n.data("forwardMessageKey",""))},error:function(a,b,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));Ka=!1;ha.removeClass("vis").addClass("n-vis");f.console.log("Unable to load messages. Please reload page.")}})};b.updateContactList=function(a,f){var c={};f?c.groupId=a:c.userId=a;c.pageSize=1;window.Applozic.ALApiService.getMessages({data:c,success:function(c){c=c.data;"null"===c+""||"undefined"===typeof c.message||0===
c.message.length?m.clearContactMessageData(a,f):(c=c.message[0],"undefined"!==typeof c&&(c.groupId?y.addGroupFromMessage(c,!0,function(a,f,c){b.updateRecentConversationList(a,f,c)}):m.addContactsFromMessage(c,!0)))},error:function(b){m.clearContactMessageData(a,f)}})};b.conversationReadUpdate=function(a){var b=a.tabId,f=a.isGroup?"group_"+b:"user_"+b;b&&0<m.getUnreadCount(f)&&window.Applozic.ALApiService.conversationReadUpdate({data:"true"===""+a.isGroup?"groupId\x3d"+b:"userId\x3d"+b,success:function(a){m.updateUnreadCount(f,
0,!0)},error:function(){}})};b.getConversationId=function(b){var c;if(!b.isGroup&&!b.isMessage&&b.topicStatus!==R[1]&&(c=za[b.topicId])&&(c=da[c],"object"===typeof c)){q.data("mck-conversationid",c.id);b.conversationId=c.id;if("undefined"!==typeof Fa[b.tabId]){var g=Fa[b.tabId];g.push(c);Fa[b.tabId]=g}m.loadTab(b);return}b.topicId&&(c={topicId:b.topicId,userId:b.tabId,status:b.topicStatus},b.isGroup?c.groupId=b.groupId:c.userId=b.tabId,g=ba[b.topicId],"object"===typeof g&&(c.topicDetail=f.JSON.stringify(g)),
b.fallBackTemplatesList&&0<b.fallBackTemplatesList.length&&(c.fallBackTemplatesList=b.fallBackTemplatesList),window.Applozic.ALApiService.getConversationId({data:c,success:function(c){if("object"===typeof c&&"success"===c.status){var g=c.response;if("object"===typeof g&&"undefined"!==g.conversationPxy){c=g.conversationPxy;da[c.id]=c;za[c.topicId]=[c.id];if(c.topicDetail)try{ba[c.topicId]=a.parseJSON(c.topicDetail)}catch(ob){f.console.log("Incorect Topic Detail!")}q.data("mck-conversationid",c.id);
b.conversationId=c.id;if("undefined"!==typeof Fa[b.tabId]){var k=Fa[b.tabId];k.push(c);Fa[b.tabId]=k}b.isGroup&&(g=D.addGroup(g),b.tabId=g.contactId);b.isMessage&&c.created?m.loadTab(b,J.dispatchMessage):m.loadTab(b)}}},error:function(){}}))};b.sendPriceMessage=function(){var f=ra.val();if(""===f)ra.addClass("mck-text-req");else{f=a.trim(f);var c=k.val();var g=q.data("mck-conversationid",g);var l={type:5,contentType:4,message:f};!0===q.data("isgroup")?l.groupId=c:l.to=c;if(q.data("mck-conversationid")){g=
q.data("mck-conversationid");l.conversationId=g;var u=da[g];"object"!==u?J.getTopicId({conversationId:g,suppId:c,priceText:f},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)}):"function"===typeof Za&&Za({custId:C,suppId:c,productId:u.topicId,price:f});ra.val("")}b.sendMessage(l)}};b.getGroup=function(b){var c=[];a.each(b.users,function(a,b){"undefined"!==typeof b.userId&&("undefined"!==typeof b.groupRole&&-1===Kb.indexOf(b.groupRole)||c.push(b))});var g={groupName:a.trim(b.groupName),
users:c,type:b.type};b.admin&&(g.admin=b.admin);b.clientGroupId&&(g.clientGroupId=b.clientGroupId);b.groupIcon&&(g.imageUrl=b.groupIcon);g.metadata=b.metadata?b.metadata:MCK_LABELS["group.metadata"];var k={},l={"UserId-Enabled":!0,Authorization:"Basic "+p,"Application-Key":Z,"Device-Key":ka,"Access-Token":N};P.ajax({url:MCK_BASE_URL+"/rest/ws/group/v2.1/create",global:!1,data:f.JSON.stringify(g),type:"post",headers:l,contentType:"application/json",success:function(c){b.isInternal&&Da.attr("disabled",
!1).html(MCK_LABELS["create.group.title"]);if("object"===typeof c&&"success"===c.status){var g=c.response;if("object"===typeof g){var l=D.addGroup(g);0<g.users.length&&a.each(g.users,function(a,b){ya[b.userId]=b;b.connected?f.MCK_OL_MAP[b.userId]=!0:(f.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(ca[b.userId]=b.lastSeenAtTime));m.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,
b)});b.tabId=l.contactId;b.isGroup=!0;b.isMessage?m.loadTab(b,J.dispatchMessage):b.isInternal?(q.data("mck-id",l.contactId),q.data("isgroup",!0),w.loadGroupInfo({groupId:l.contactId})):m.loadTab(b);"function"===typeof b.callback&&(k.updated=c.updated?c.updated:!1,k.status="success",k.data=l,b.callback(k))}}else"error"===c.status&&"function"===typeof b.callback&&(k.status="error",k.errorMessage=c.errorResponse[0].description,b.callback(k))},error:function(){b.isInternal&&Da.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);
"function"===typeof b.callback&&(k.status="error",k.errorMessage="Unable to process request.",b.callback(k))}})}},ea=new function(){a("#mck-search-list");var b=a("#mck-sidebox-search"),c=a("#mck-search-loading");a("#mck-search-cell .mck-message-inner");a("#mck-message-cell .mck-message-inner");a(".mck-tab-message-option");a("#mck-contact-loading");this.getContactDisplayName=function(a){var b=[];window.Applozic.ALApiService.getContactDisplayName({data:{userIdArray:a},success:function(a){for(var f in a)a.hasOwnProperty(f)&&
(b.push([f,a[f]]),Ea[f]=a[f],m.fetchContact(f).displayName=a[f]);ALStorage.updateMckContactNameArray(b)},error:function(){}})};this.loadContacts=function(){var g=[];window.Applozic.ALApiService.getContactList({url:"?startIndex\x3d0\x26pageSize\x3d50\x26orderBy\x3d1",baseUrl:MCK_BASE_URL,success:function(c){b.hasClass("vis")&&("object"===typeof c&&0<c.users.length&&(a.each(c.users,function(a,b){"undefined"!==typeof b.userId&&(a=m.getContact(""+b.userId),a="undefined"===typeof a?m.createContactWithDetail(b):
m.updateContactDetail(a,b),bb.push(a),g.push([b.userId,a.displayName]),b.connected?f.MCK_OL_MAP[b.userId]=!0:(f.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(ca[b.userId]=b.lastSeenAtTime)))}),ea.getUsersDetail(contactNameArray,{async:!1}),0<g.length&&ALStorage.updateMckContactNameArray(g)),m.addContactsToSearchList(),w.addMembersToGroupSearchList())},error:function(){c.removeClass("vis").addClass("n-vis");f.console.log("Unable to load contacts. Please reload page.")}})};this.getUsersDetail=
function(b,c){if(!("undefined"===typeof b||1>b.length)){for(var g="undefined"!==typeof c.cached?c.cached:!0,k=[],l=b.filter(function(a,f){return b.indexOf(a)===f}),n=0;n<l.length;n++){var x=l[n];g&&"undefined"!==typeof ya[x]||k.push(x)}if(0===k.length)c.setStatus?Ba.updateUserConnectedStatus():c.message?m.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(c);else{var p={};window.Applozic.ALApiService.getUserDetail({data:{userIdList:k},success:function(b){"success"===
b.status&&0<b.response.length&&a.each(b.response,function(a,b){ya[b.userId]=b;f.MCK_OL_MAP[b.userId]=b.connected;a=m.getContact(""+b.userId);"undefined"===typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b)});c.setStatus?Ba.updateUserConnectedStatus():c.message?m.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(c);p.status="success";p.data=b;c.callback&&c.callback(p)},error:function(){c.setStatus?Ba.updateUserConnectedStatus():
c.message?m.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&m.loadMessageListOnUserDetailFetch(c);p.status="error";c.callback&&c.callback(p)}})}}};this.updateUserIdentity=function(a){if(null!==a.newUserId&&""!==a.newUserId){var b="newUserId\x3d"+encodeURIComponent(a.newUserId);P.ajax({url:MCK_BASE_URL+"/rest/ws/user/change/identifier",type:"get",data:b,contentType:"application/json",success:function(b){"object"===typeof b&&"success"===b.status&&a.callback&&a.callback(b)},
error:function(b){a.callback&&a.callback({response:"error"})}})}};this.updateUser=function(a){P.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/user/update",data:f.JSON.stringify(a.data),contentType:"application/json",success:function(b){a.success&&a.success(b)},error:function(b){a.error&&a.error(b)}})};this.updateDisplayName=function(b,f){""!==b&&""!==f&&a.ajax({url:MCK_BASE_URL+"/rest/ws/user/name",type:"get",data:"userId\x3d"+b+"\x26displayName\x3d"+f,success:function(a){if("object"===typeof a&&"success"===
a.status)return"success"},error:function(){}})}},Cb=new function(){var b=this,f,c,g,k,n,p,r;b.init=function(){a("#mck-sidebox");c=a("#mck-msg-preview");n=a("#mck-group-info-tab");a("#mck-sidebox-launcher");f=a("#mck-message-cell .mck-message-inner");g=a("#mck-msg-preview .mck-preview-icon");k=a("#mck-msg-preview .mck-preview-cont-name");p=a("#mck-msg-preview .mck-preview-msg-content");r=a("#mck-msg-preview .mck-preview-file-content")};b.notifyUser=function(a){if(!1!==a.alert&&7!==a.type&&!1!==a.metadata.alert){var f=
a.groupId?D.getGroup(""+a.groupId):m.fetchContact(""+a.to.split(",")[0]),c=!1;a.groupId&&(c=!0);va.loadUserProfile(a.to);c=m.getTabDisplayName(f.contactId,c);var g=yc;b.showNewMessageNotification(a,f,c);if(qc&&!Hb){var k=Cc;a=m.getTextForMessagePreview(a,f);"function"!==typeof $a||f.isGroup||(f=$a(f.contactId))&&"undefined"!==typeof f&&(k=f);g?zc.sendDesktopNotification(c,k,a,g):zc.sendDesktopNotification(c,k,a)}}};b.showNewMessageNotification=function(a,b,l){if(rc&&102!==a.contentType){var x=f.data("mck-id"),
W=f.data("isgroup");if(x===b.contactId&&W===b.isGroup&&!n.hasClass("vis"))if(a.conversationId&&(Oa||ab)){if(x=f.data("mck-conversationid"),x="undefined"!==typeof x&&""!==x?x.toString():"",x===a.conversationId.toString())return}else return;c.data("isgroup",b.isGroup);c.data("mck-conversationid",a.conversationId?a.conversationId:"");x=m.getContactImageLink(b,l);a.message?(W=m.getMessageTextForContactPreview(a,b,100),p.html(""),"object"===typeof W?p.append(W):p.html(W),p.removeClass("n-vis").addClass("vis")):
p.html("");a.fileMetaKey?(r.html(I.getFileIcon(a)),r.removeClass("n-vis").addClass("vis"),""===p.html()&&p.removeClass("vis").addClass("n-vis")):(r.html(""),r.removeClass("vis").addClass("n-vis"));!0===b.isGroup&&10!==b.type&&k.html(l);g.html(x);c.data("mck-id",b.contactId);c.show();setTimeout(function(){c.fadeOut(3E3)},1E4)}}},J=new AlMessageService,I=new AlFileService,zc=new MckNotificationUtils,vc=new AlNotificationService,va=new AlUserService,Qa=a(".chat-launcher-icon"),la=new function(){var b=
this,f;b.token=null;b.Identity=null;b.outgoingCallServices=null;b.incomingCallServices=null;var c=a(".mck-videocall-btn"),g=a(".applozic-vid-container"),k=a("#mck-sidebox"),n=a("#mck-video-call-indicator"),p=a("#mck-video-box");b.hideVideoBox=function(){g.addClass("n-vis").removeClass("vis");k.addClass("vis").removeClass("n-vis");n.addClass("n-vis").removeClass("vis")};b.init=function(){p.mckModal();wa.loop=!0;b.token=null!==ALStorage.getAppHeaders()?ALStorage.getAppHeaders().videoToken:void 0;b.ringToneForHost=
qb.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",wa);a("#mck-btn-video-call").on("click",function(c){if(b.token){var g=$mck_msg_to.val();c=C+(new Date).getTime().toString()+Math.random().toString(36).slice(2);g=J.sendVideoCallMessage(c,"CALL_DIALED",102,!1,g,function(a){A.sendMessage(a)});var k=m.fetchContact(g.to);g=m.getTabDisplayName(k.contactId,!1);k=m.getContactImageLink(k,g);var l=new Date;b.outgoingCallServices=new MckCallingService(C,la.token,
c,g,!0,l,A,k,!1,b.ringToneForHost);b.outgoingCallServices.startVideoCall();a("#mck-btn-video-call").data("isCallHost",!0);a("#mck-btn-video-call").data("callStartTime",l)}else"INSUFFICIENT_FUNDS"===f?alert("Video calling is not available at the moment. For details, contact support."):alert("missing token... please refresh page..")});a("#mck-vid-receive-btn").on("click",function(b){console.log("call received");$("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");c.removeClass("vis").addClass("n-vis");
b=a("#mck-video-call-indicator").data("call-id");var f=a("#mck-video-call-indicator").data("isAudioCall");a("#mck-video-call-indicator").data("callReceived",!0);a("#mck-video-call-indicator").addClass("n-vis");la.callReceived(b,f)});a("#mck-vid-reject-btn").on("click",function(b){console.log("call rejected");b=a("#mck-video-call-indicator").data("call-id");var f=a("#mck-video-call-indicator").data("isAudioCall");la.callRejected(b,f);a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};
b.InitilizeVideoClient=function(c,g){b.Identity=c;a.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:c,device:g},success:function(a){if(null!=a&&""!=a){b.token=a.token;var c=ALStorage.getAppHeaders();c.videoToken=a.token;ALStorage.setAppHeaders(c)}a.hasOwnProperty("errorResponse")&&(f=a.errorResponse[0].description)},error:function(a){console.log("error while getting token"+a)}})};b.callReceived=function(a,f){var c=$mck_msg_to.val();
console.log("_this.callReceived");xa&&xa.stop();J.sendVideoCallMessage(a,"CALL_ANSWERED",102,f,c,function(a){A.sendMessage(a)});b.incomingCallServices=new MckCallingService(b.Identity,b.token,a,null,!1,null,A,null,f);b.incomingCallServices.startVideoCall()};b.callRejected=function(a,b){xa&&xa.stop();J.sendVideoCallMessage(a,"CALL_REJECTED",102,b,toUser,function(a){A.sendMessage(a)})}},yc=null,wa={},qb,Hc=!1,xa=null,Yb=g.isAnonymousChat,Ga=g.askUserDetails,fb=g.conversationTitle,gb=g.agentId,hb=g.botIds;
f.MCK_OL_MAP=[];k.mckLaunchSideboxChat=function(){a("#mck-sidebox-launcher").removeClass("vis").addClass("n-vis");KommunicateUI.showChat();a("#mck-away-msg-box").removeClass("vis").addClass("n-vis");A.loadConversationWithAgents({groupName:fb,agentId:gb,botIds:hb},function(){console.log("conversation created successfully")})};k.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},
onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};k.loadConversationWithAgent=function(a){if(a&&a.agentId)console.log("setting default agent inside Applozic"),A.loadConversationWithAgents(a);else throw Error("params are empty");
};var fa=new function(b){var c=this,g=b.events,k=null,p=null,r="",v=null,I=[],O,K,H="",X=a("#mck-sidebox"),N=a("#mck-tab-title"),U=a(".mck-typing-box"),R=a("#mck-tab-status");a("#mck-offline-message-box");var Y=a("#mck-typing-label"),Q=a("#mck-message-cell .mck-message-inner");c.init=function(){if("undefined"!==typeof ib){var a=P.startsWith(ib,"https")?"15675":"15674";"function"===typeof f.SockJS&&(H||(H=new SockJS(ib+":"+a+"/stomp")),p=f.Stomp.over(H),p.heartbeat.outgoing=0,p.heartbeat.incoming=
0,p.onclose=function(){c.disconnect()},p.connect("guest","guest",c.onConnect,c.onError,"/"),f.addEventListener("beforeunload",function(a){c.disconnect()}))}};c.checkConnected=function(a){p.connected?(O&&clearInterval(O),K&&clearInterval(K),O=setInterval(function(){c.connectToSocket(a)},6E5),K=setInterval(function(){c.sendStatus(1)},12E5)):c.connectToSocket(a)};c.connectToSocket=function(a){if(!p.connected){if(a&&"block"===X.css("display"))if(a=Q.data("mck-id")){var b=Q.data("isgroup"),f=Q.data("mck-conversationid"),
g=Q.data("mck-topicid");ALStorage.clearMckMessageArray();m.loadTab({tabId:a,isGroup:b,conversationId:f,topicId:g})}else ALStorage.clearMckMessageArray(),m.loadTab({tabId:"",isGroup:!1});c.init()}};c.stopConnectedCheck=function(){O&&clearInterval(O);K&&clearInterval(K);K=O="";c.disconnect()};c.disconnect=function(){clearInterval(void 0);p&&p.connected&&(c.sendStatus(0),p.disconnect(),H.close(),H="")};c.unsubscibeToTypingChannel=function(){p&&p.connected&&v&&(1===na&&c.sendTypingStatus(0,r),v.unsubscribe());
v=null};c.unsubscibeToNotification=function(){p&&p.connected&&k&&k.unsubscribe();k=null};c.subscibeToTypingChannel=function(a,b){a=b?a:C;p&&p.connected?v=p.subscribe("/topic/typing-"+Z+"-"+a,c.onTypingStatus):c.reconnect()};c.subscribeToOpenGroup=function(a){if(p&&p.connected){var b=p.subscribe("/topic/group-"+Z+"-"+a.contactId,c.onOpenGroupMessage);I.push(b.id);Jb[a.contactId]=b.id}else c.reconnect()};c.sendTypingStatus=function(a,b){if(p&&p.connected){1===a&&1===na&&p.send("/topic/typing-"+Z+"-"+
r,{"content-type":"text/plain"},Z+","+C+","+a);if(b){if(b===r&&a===na&&1===a)return;r=b;p.send("/topic/typing-"+Z+"-"+b,{"content-type":"text/plain"},Z+","+C+","+a);setTimeout(function(){na=0},6E4)}else 0===a&&p.send("/topic/typing-"+Z+"-"+r,{"content-type":"text/plain"},Z+","+C+","+a);na=a}};c.onTypingStatus=function(a){if(null!=v&&v.id===a.headers.subscription){var b=a.body,c=b.split(",")[1];b=Number(b.split(",")[2]);var f=a.headers.destination.substring(a.headers.destination.lastIndexOf("-")+1,
a.headers.destination.length),g=Q.data("mck-id");a=Q.data("isgroup");var k=D.getGroup(g);if(!ta[c]&&!La[c])if(1===b){if(!(C===c&&a||g!==c&&g!==f)){if(a=Q.data("isgroup")){if(c!==C){if(y.authenticateGroupUser(k)||6===k.type&&!pa.disableChatForNonGroupMember)N.addClass("mck-tab-title-w-typing"),R.removeClass("vis").addClass("n-vis"),c=m.getTabDisplayName(c,!1),c=c.split(" ")[0],Y.html(c+" "+MCK_LABELS["is.typing"]);7===k.type&&(N.addClass("mck-tab-title-w-typing"),Y.html(MCK_LABELS["is.typing"]),R.html(""))}}else N.addClass("mck-tab-title-w-typing"),
R.removeClass("vis").addClass("n-vis"),Y.html(MCK_LABELS.typing);U.removeClass("n-vis").addClass("vis");setTimeout(function(){N.removeClass("mck-tab-title-w-typing");U.removeClass("vis").addClass("n-vis");N.hasClass("undefined"===typeof k||7!=k.type)&&R.removeClass("n-vis").addClass("vis");Y.html(MCK_LABELS.typing)},6E4)}}else N.removeClass("mck-tab-title-w-typing"),U.removeClass("vis").addClass("n-vis"),!N.hasClass("mck-tab-title-w-status")||"undefined"!==typeof k&&7==k.type||R.removeClass("n-vis").addClass("vis"),
Y.html(MCK_LABELS.typing)}};c.reconnect=function(){c.unsubscibeToTypingChannel();c.unsubscibeToNotification();c.disconnect();c.init()};c.onError=function(a){f.console.log("Error in channel notification. "+a);g.onConnectFailed()};c.sendStatus=function(a){p&&p.connected&&p.send("/topic/status-v2",{"content-type":"text/plain"},n+","+ka+","+a)};c.onConnect=function(){p.connected?(k&&c.unsubscibeToNotification(),k=p.subscribe("/topic/"+n,c.onMessage),c.sendStatus(1),c.checkConnected(!0)):setTimeout(function(){k=
p.subscribe("/topic/"+n,c.onMessage);c.sendStatus(1);c.checkConnected(!0)},5E3);g.onConnect()};c.onOpenGroupMessage=function(b){if(-1!==I.indexOf(b.headers.subscription)){var c=a.parseJSON(b.body),f=c.type;b=c.message;if("APPLOZIC_03"===f)ALStorage.updateLatestMessage(b),0!==b.type&&4!==b.type&&(a("."+b.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),m.addTooltip(b.key)),g.onMessageSentUpdate({messageKey:b.key});else if("APPLOZIC_01"===f||"APPLOZIC_02"===f||"MESSAGE_RECEIVED"===
f){ALStorage.updateLatestMessage(b);var k=b.groupId?D.getGroup(b.groupId):m.getContact(b.to);a("#mck-sidebox-content");Q.data("mck-id");if("APPLOZIC_01"===f||"MESSAGE_RECEIVED"===f){var l=m.getMessageFeed(b);g.onMessageReceived({message:l})}else"APPLOZIC_02"===f&&(l=m.getMessageFeed(b),g.onMessageSent({message:l}));b.conversationId&&(l=da[b.conversationId],!Oa&&!ab||"object"===typeof l&&"object"===typeof ba[l.topicId]||J.getTopicId({conversationId:b.conversationId,messageType:f,message:b,notifyUser:c.notifyUser,
async:!1,populate:!1},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)}));"undefined"===typeof k?(c={message:b,messageType:f,notifyUser:c.notifyUser},b.groupId?w.getGroupFeedFromMessage(c):(f=[],f.push(b.to),ea.getUsersDetail(f,c))):m.populateMessage(f,b,c.notifyUser)}}};c.onMessage=function(b){if(null!=k&&k.id===b.headers.subscription){b=a.parseJSON(b.body);var c=b.type;if("APPLOZIC_04"===c||"MESSAGE_DELIVERED"===c)a("."+b.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),
m.addTooltip(b.message.split(",")[0]),g.onMessageDelivered({messageKey:b.message.split(",")[0]});else if("APPLOZIC_08"===c||"MT_MESSAGE_DELIVERED_READ"===c)a("."+b.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),m.addTooltip(b.message.split(",")[0]),g.onMessageRead({messageKey:b.message.split(",")[0]});else if("APPLOZIC_05"===c){var l=b.message.split(",")[0];var n=b.message.split(",")[1];
var p="1"===b.message.split(",")[2]?!0:!1;m.removedDeletedMessage(l,n,p);b={messageKey:b.message.split(",")[0]};p?b.groupId=n:b.userKey=n;g.onMessageDeleted(b)}else if("APPLOZIC_27"===c)l=b.message.split(",")[0],b=b.message.split(",")[1],"undefined"!==typeof l&&(m.removeConversationThread(l,!1),m.updateUnreadCount("user_"+l,0,!0),p={userId:l},b&&(p.topicId=b),g.onConversationDeleted(p));else if("APPLOZIC_11"===c){l=b.message;p=m.fetchContact(l);n=Q.data("mck-id");if(!ta[l]&&!La[l]){if(n!==p.contactId||
Q.data("isgroup")){var r=mckContactUtils.formatContactId(l);a("#li-user-"+r+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else a("#mck-tab-status").html(MCK_LABELS.online),ub&&m.hideOfflineMessage();a(".mck-user-ol-status."+r).removeClass("n-vis").addClass("vis");a(".mck-user-ol-status."+r).next().html("("+MCK_LABELS.online+")");f.MCK_OL_MAP[l]=!0;va.updateUserStatus({userId:b.message,status:1},function(a){ea.getUsersDetail(a,{})})}g.onUserConnect({userId:b.message})}else if("APPLOZIC_12"===
c)l=b.message.split(",")[0],b=b.message.split(",")[1],p=m.fetchContact(l),f.MCK_OL_MAP[l]=!1,b&&(ca[l]=b),ta[l]||La[l]||(n=Q.data("mck-id"),n!==p.contactId||Q.data("isgroup")||(a("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(b)),ub&&mb.manageOfflineMessageTime(n)),a(".mck-user-ol-status."+p.htmlId).removeClass("vis").addClass("n-vis"),a(".mck-user-ol-status."+p.htmlId).next().html("(Offline)"),a("#li-user-"+r+" .mck-ol-status").removeClass("vis").addClass("n-vis"),va.updateUserStatus({userId:l,
status:0,lastSeenAtTime:b},function(a){ea.getUsersDetail(a,{})})),g.onUserDisconnect({userId:l,lastSeenAtTime:b});else if("APPLOZIC_29"===c){l=b.message.split(",")[0];b=b.message.split(",")[1];p=m.fetchContact(l);m.updateUnreadCount("user_"+p.contactId,0,!0);n=Q.data("mck-id");if("undefined"===typeof n||""===n)a("#li-user-"+p.htmlId+" .mck-unread-count-text").html(m.getUnreadCount("user_"+p.contactId)),a("#li-user-"+p.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");p={userId:l};
b&&(p.topicId=b);g.onConversationReadFromOtherSource(p)}else if("APPLOZIC_28"===c)l=b.message.split(",")[0],b=b.message.split(",")[1],n=Q.data("mck-id"),n===l&&(a(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),a(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),p=m.getContact(l),"undefined"===typeof p&&(p=[],p.push(l),ea.getUsersDetail(p,{}))),p={userId:l},b&&(p.topicId=
b),g.onConversationRead(p);else if("APPLOZIC_16"===c)c=b.message.split(":")[0],l=b.message.split(":")[1],p=m.fetchContact(l),n=Q.data("mck-id"),n===p.contactId?c===uc[0]?(ta[p.contactId]=!0,Ba.toggleBlockUser(n,!0)):(La[p.contactId]=!0,N.removeClass("mck-tab-title-w-status"),R.removeClass("vis").addClass("n-vis"),U.removeClass("vis").addClass("n-vis")):a("#li-user-"+p.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),g.onUserBlocked({status:c,userId:l});else if("APPLOZIC_17"===c){c=b.message.split(":")[0];
l=b.message.split(":")[1];p=m.fetchContact(l);n=Q.data("mck-id");if(n===p.contactId)if(c===uc[2])ta[p.contactId]=!1,Ba.toggleBlockUser(n,!1);else{if(f.MCK_OL_MAP[n]||ca[n])La[p.contactId]=!1,ta[n]||(f.MCK_OL_MAP[n]?R.html(MCK_LABELS.online):ca[n]&&R.html(mckDateUtils.getLastSeenAtStatus(ca[n])),N.addClass("mck-tab-title-w-status"),R.removeClass("n-vis").addClass("vis"))}else f.MCK_OL_MAP[n]&&a("#li-user-"+p.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis");g.onUserUnblocked({status:c,
userId:l})}else if("APPLOZIC_18"===c)tb=!1,g.onUserActivated();else if("APPLOZIC_19"===c)tb=!0,g.onUserDeactivated();else if(l=b.message,"APPLOZIC_03"===c)ALStorage.updateLatestMessage(l),0!==l.type&&4!==l.type&&(a("."+l.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),m.addTooltip(l.key)),g.onMessageSentUpdate({messageKey:l.key});else if("APPLOZIC_01"===c||"APPLOZIC_02"===c||"MESSAGE_RECEIVED"===c)ALStorage.updateLatestMessage(l),p=l.groupId?D.getGroup(l.groupId):
m.getContact(l.to),a("#mck-sidebox-content"),n=Q.data("mck-id"),"APPLOZIC_01"===c||"MESSAGE_RECEIVED"===c?(n=m.getMessageFeed(l),g.onMessageReceived({message:n})):"APPLOZIC_02"===c&&(n=m.getMessageFeed(l),g.onMessageSent({message:n})),l.conversationId&&(n=da[l.conversationId],!Oa&&!ab||"object"===typeof n&&"object"===typeof ba[n.topicId]||J.getTopicId({conversationId:l.conversationId,messageType:c,message:l,notifyUser:b.notifyUser,async:!1,populate:!1},function(a){m.populateMessage(a.messageType,
a.message,a.notifyUser)})),"undefined"===typeof p?(b={message:l,messageType:c,notifyUser:b.notifyUser},l.groupId?w.getGroupFeedFromMessage(b):(p=[],p.push(l.to),ea.getUsersDetail(p,b))):(102==l.contentType&&Sa&&(b.notifyUser=!1,4==l.type&&"CALL_DIALED"==l.metadata.MSG_TYPE?(p=m.fetchContact(l.to),n=m.getTabDisplayName(p.contactId,!1),p=m.getContactImageLink(p,n),a("#mck-video-call-indicator").data("call-id",l.metadata.CALL_ID),a("#mck-video-call-indicator").data("isAudioCall",l.metadata.CALL_AUDIO_ONLY),
a("#mck-video-call-indicator-txt").html(n+" calling..."),a("#mck-video-call-icon").html(p),a("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),xa.play(),setTimeout(function(){a("#mck-video-call-indicator").data("callReceived")||(console.log("call is not answered"),xa.stop(),a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==l.type&&"CALL_REJECTED"==l.metadata.MSG_TYPE&&a("#mck-btn-video-call").data("isCallHost")&&(p=$mck_msg_to.val(),J.sendVideoCallMessage(l.metadata.CALL_ID,
"CALL_REJECTED",103,!1,p,function(a){A.sendMessage(a)}),la.ringToneForHost.stop(),la.outgoingCallServices.twilioService.leaveRoomIfJoined(),la.hideVideoBox(),la.outgoingCallServices&&(la.outgoingCallServices.rejectedByReceiver=!0))),103==l.contentType?4==l.type&&"CALL_MISSED"==l.metadata.MSG_TYPE&&(a("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),xa&&xa.stop()):m.populateMessage(c,l,b.notifyUser))}}}(k);k.getOptions=function(){return g};k.init=function(){window.Applozic.ALApiService.initServerUrl(MCK_BASE_URL);
I.get(g);J.init(g);vc.init(g);m.init();wa.loop=!1;ic&&(qb=new RingToneService,yc=qb.loadRingTone(ic,wa));A.init();Fb.init();w.init();mb.initializeApp(g,!1);Cb.init();Zb.init();m.initEmojis();Sa&&(wa.loop=!0,qb=new RingToneService,xa=qb.loadRingTone(Kommunicate.BASE_URL[MCK_BASE_URL]+"/plugin/audio/applozic_video_call_ring_tone.mp3",wa),la.init())};k.reInit=function(b){KommunicateUtils.storeDataIntoKmSession("appOptions",b);"object"===a.type(b)&&(b=a.extend(!0,{},r,b),g.conversationTitle=g.conversationTitle||
g.groupName,g.accessToken=g.password||g.accessToken,a.fn.applozic("reset",b),b.userId&&b.appId&&""!==a.trim(b.userId)&&""!==a.trim(b.appId)?(mb.initializeApp(b,!0),g=b):f.console("Oops! looks like incorrect application id or user Id."))};k.loadTabView=function(b){"undefined"===typeof b.isGroup&&(b.isGroup=!1);m.loadTab(b);a("#mck-search").val("")};k.loadTab=function(b,c){m.loadTab({tabId:b,isGroup:!1},c);a("#mck-search").val("")};k.loadChat=function(b){if(!("undefined"!==typeof b.userId&&""!==b.userId||
"undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId))return"UserId or groupId or clientGroupId required";var c={};b.userId&&(c.tabId=userId,c.isGroup=!1);b.displayName&&(c.userName=b.displayName);b.convId&&(c.conversationId=b.convId);if(b.groupId||b.clientGroupId)if(c.isGroup=!0,b.clientGroupId){c.clientGroupId=b.clientGroupId;var f=D.getGroupByClientGroupId(b.clientGroupId);if("object"===typeof f)c.tabId=f.contactId;else{y.getGroupFeed({clientGroupId:c.clientGroupId,
apzCallback:w.onGroupFeed,callback:w.loadGroupTab});a("#mck-search").val("");return}}else if(f=D.getGroup(b.groupId),"object"===typeof f)c.tabId=b.groupId;else{y.getGroupFeed({groupId:b.groupId,apzCallback:w.onGroupFeed,callback:w.loadGroupTab});a("#mck-search").val("");return}m.loadTab(c);a("#mck-search").val("")};k.uploadFile=function(a){Fb.uploadFile(a)};k.audioAttach=function(a){Fb.audioRecoder(a)};k.loadGroupTab=function(b){if("undefined"===typeof b||""===b)return"GroupId required";"object"===
typeof D.getGroup(b)?(m.loadTab({tabId:b,isGroup:!0}),a("#mck-search").val("")):y.getGroupFeed({groupId:b,apzCallback:w.onGroupFeed,callback:w.loadGroupTab})};k.loadGroupTabByClientGroupId=function(b){if("undefined"===typeof b.clientGroupId||""===b.clientGroupId)return"Client Group Id Required";var c=D.getGroupByClientGroupId(b.clientGroupId);"object"===typeof c?(m.loadTab({tabId:c.contactId,isGroup:!0}),a("#mck-search").val("")):y.getGroupFeed({clientGroupId:b.clientGroupId,apzCallback:w.onGroupFeed,
callback:w.loadGroupTab})};k.loadConvTab=function(a){"object"===typeof a&&a.userId&&a.convId&&m.loadTab({tabId:a.userId,conversationId:a.convId,isGroup:!1})};k.loadTabWithTopic=function(a){if("object"===typeof a&&(a.userId||a.groupId)&&a.topicId){var b={tabId:a.userId,topicId:a.topicId};a.userName&&(b.userName=a.userName);b.topicStatus=a.topicStatus?-1===R.indexOf(a.topicStatus)?R[0]:a.topicStatus.toString():R[0];if("function"===typeof Ta||a.topicDetail){var c=a.topicDetail?a.topicDetail:Ta(a.topicId);
"object"===typeof c&&"undefined"!==c.title&&(ba[a.topicId]=c)}a.message?(b.messagePxy={type:5,contentType:0,message:message},b.isMessage=!0):b.isMessage=!1;a.supportId?(b.isGroup=!0,b.supportId=supportId):(b.isGroup=!1,b.userId=a.userId);A.getConversationId(b)}else{if(!a.userId||!a.groupId)return"UserId required";if(!a.topicId)return"TopicId required"}};k.loadContacts=function(a){m.loadContacts(a)};k.loadContactsForContactList=function(a){m.loadContactsForContactList(a)};k.setOffline=function(){"undefined"!==
typeof fa&&fa.sendStatus(0)};k.reset=function(b){f.sessionStorage.clear();p=n="";O=[];MCK_GROUP_MAP=[];Gb=!0;Ja=[];ka="";Ib=b.mode;ta=[];La=[];Ka=!1;Da=90;Z=b.appId;ca=[];da=[];ba=[];MCK_CLIENT_GROUP_MAP=[];Hb=!0;MCK_LABELS=b.labels;X=0;MCK_BASE_URL=b.baseUrl;Na=b.fileupload;dc=b.customFileUrl;Y={};lb=[];rb=b.launcher;Jb=[];ec=b.userName;jb=b.visitor;za=[];bb=[];Ua={};Ma=b.fileBaseUrl;sb=b.locShare;Sa=g.video;U=b.onInit;Mb=b.onTopicDetails;Ea=[];Pa=[];Nb=b.onClose;N=b.accessToken;Ob=b.displayText;
kb=b.readConversation;oa=b.maxGroupSize;Fa=[];Pb=b.onTabClicked;fc=b.contactNumber;yb=b.appModuleName;Ta=b.getTopicDetail;Aa=b.maxAttachmentSize;Rb=b.validateMessage;Qb=b.contactDisplayName;cb=[];Za=b.finalPriceResponse;$a=b.contactDisplayImage;Sb=b.priceWidget;pa=g.openGroupSettings;ua=b.offlineMessageDetail;Tb=b.getConversationDetail;zb=b.authenticationTypeId;C=jb?"guest":a.trim(b.userId);jc=sb?b.googleApiKey:"NO_ACCESS";Ab="boolean"===typeof b.olStatus?b.olStatus:!1;ab="boolean"===typeof b.topicBox?
b.topicBox:!1;ub="boolean"===typeof b.showOfflineMessage?b.showOfflineMessage:!1;Oa="boolean"===typeof b.topicHeader?b.topicHeader:!1;rc="boolean"===typeof b.notification?b.notification:!0;pc=b.supportId?'data-mck-id\x3d"'+b.supportId+'"':"";lc="boolean"===typeof b.hideGroupSubtitle?b.hideGroupSubtitle:!1;mc="undefined"===typeof b.defaultMessageMetaData?{}:b.defaultMessageMetaData;Vb="boolean"===typeof b.groupUserCount?b.groupUserCount:!1;qc="boolean"===typeof b.desktopNotification?b.desktopNotification:
!1;Wb="boolean"===typeof b.loadOwnContacts?b.loadOwnContacts:!1;kc="boolean"===typeof b.messageBubbleAvator?b.messageBubbleAvator:!1;oc="boolean"===typeof g.resetUserStatus?g.resetUserStatus:!1;Bb="boolean"===typeof b.launchOnNewMessage?b.launchOnNewMessage:!1;sc="boolean"===typeof b.autoTypeSearchEnabled?b.autoTypeSearchEnabled:!0;nc="boolean"===typeof b.checkUserBusyWithStatus?b.checkUserBusyWithStatus:!1;Xb="boolean"===typeof b.launchOnUnreadMessage?b.launchOnUnreadMessage:!1;Yb=g.isAnonymousChat;
Ga=g.askUserDetails};k.logout=function(){"undefined"!==typeof fa&&(fa.disconnect(),ALStorage.clearMckMessageArray(),a.fn.applozic("reset",g),a("#mck-sidebox").hide(),a("#mck-sidebox-launcher").hide());Gb=!1};k.setOnline=function(){"undefined"!==typeof fa&&fa.sendStatus(1)};k.getUserStatus=function(b){"function"===typeof b.callback&&("undefined"!==typeof b.userIds?ea.getUsersDetail(b.userIds,b):va.getUserStatus(b,function(b){a.each(b.users,function(a,b){a=m.getContact(""+b.userId);a="undefined"===
typeof a?m.createContactWithDetail(b):m.updateContactDetail(a,b);cb.push(a.contactId)})}))};k.getGroupList=function(a){return"function"===typeof a.callback?(a.apzCallback=w.loadGroups,y.loadGroups(a),"success"):"Callback Function Required"};k.leaveGroup=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback){if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)return a.apzCallback=
w.onGroupLeft,y.leaveGroup(a),"success";a.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};k.addGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});
else if("undefined"!==typeof a.role&&-1===Kb.indexOf(a.role))a.callback({status:"error",errorMessage:"Incorrect member role"});else return va.loadUserProfile(a.userId),a.apzCallback=w.onAddedGroupMember,y.addGroupMember(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};k.removeGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==
typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else return a.apzCallback=w.onRemovedGroupMember,y.removeGroupMemberFromChat(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};k.updateGroupInfo=function(b){if("object"!==typeof b)return"Unsupported format. Please check format";
if("function"===typeof b.callback)if("undefined"!==typeof b.groupId&&""!==b.groupId||"undefined"!==typeof b.clientGroupId&&""!==b.clientGroupId){if("undefined"!==typeof b.name&&""!==b.name||"undefined"!==typeof b.imageUrl&&""!==b.imageUrl||b.users&&0!==b.users.length){if(b.users&&0<b.users.length){var c=[];a.each(b.users,function(a,b){b.userId&&"undefined"!==typeof b.role&&-1!==Kb.indexOf(b.role)&&c.push(b)});if(0===c.length){b.callback({status:"error",errorMessage:"Incorrect users detail"});return}}c=
[];a(".mck-group-change-role-box.vis").each(function(b,f){b=a(this);f=parseInt(b.find("select").val());var g=b.parents(".mck-li-group-member").data("role");f!==g&&(b={userId:b.parents(".mck-li-group-member").data("mck-id"),role:f},c.push(b))});b.apzCallback=w.onUpdateGroupInfo;y.updateGroupInfo(b);return"success"}b.callback({status:"error",errorMessage:"Group properties required"})}else b.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};
k.getMessages=function(a){"function"===typeof a.callback&&J.getMessages(a)};k.getMessageList=function(a){return"undefined"!==typeof a&&"function"===typeof a.callback?(J.getMessageList(a,function(a){if("undefined"!==typeof a.to||"undefined"!==typeof a.groupId)a=m.getMessageFeed(a),messageFeeds.push(a)}),"success"):"Callback function required"};k.getMessageListByTopicId=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==
typeof a.id&&""!==a.id||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if(a.id&&"boolean"!==typeof a.isGroup)a.callback({status:"error",errorMessage:"IsGroup parameter required"});else{if(a.topicId){a.id&&(a.tabId=a.id);a.topicStatus=R[0];var b=za[a.topicId];b&&"object"===typeof da[b]?(a.conversationId=b,J.getMessageList(a,function(a){if("undefined"!==typeof a.to||"undefined"!==typeof a.groupId)a=m.getMessageFeed(a),messageFeeds.push(a)})):(a.isExtMessageList=!0,a.pageSize=1,J.fetchConversationByTopicId(a,
function(a){A.getMessageList(a)}));return"success"}a.callback("TopicId required")}else a.callback({status:"error",errorMessage:"Id or clientGroupId required"});else return"Callback function required."};k.sendMessage=function(b){if("object"===typeof b){b=a.extend(!0,{},v,b);var c=b.message;if(!b.to)return"To field required";if("undefined"===typeof c||""===c)return"Message field required";if(12<b.type)return"Invalid message type";c=a.trim(c);b={to:a.trim(b.to),type:b.messageType,contentType:b.type,
message:c,metadata:b.metadata};A.sendMessage(b);return"success"}return"Unsupported format. Please check format"};k.updateUserIdentity=function(a){ea.updateUserIdentity(a)};k.updateUser=function(a){ea.updateUser(a)};k.getGroupListByFilter=function(a){y.getGroupByFilter(a)};k.updateMessageMetadata=function(a){A.updateMessageMetadata(a)};k.sendGroupMessage=function(b){if("object"===typeof b){b=a.extend(!0,{},v,b);var c=b.message;if(!b.groupId&&!b.clientGroupId)return"groupId or clientGroupId required";
if("undefined"===typeof c||""===c)return"message field required";if(12<b.type)return"invalid message type";c=a.trim(c);c={type:b.messageType,contentType:b.type,message:c,metadata:b.metadata||{}};if(b.groupId)c.groupId=a.trim(b.groupId);else if(b.clientGroupId){if("undefined"===typeof D.getGroupByClientGroupId(b.clientGroupId))return"group not found";c.clientGroupId=a.trim(b.clientGroupId)}A.sendMessage(c);return"success"}return"Unsupported format. Please check format"};k.addWelcomeMessage=function(a){if("object"===
typeof a){if("undefined"===typeof a.sender||""===a.sender)return"Sender Field Required";if("undefined"===typeof a.messageContent||""===a.messageContent)return"Message Content Required";A.sendWelcomeMessage(a)}else return"Unsupported format. Please check format"};k.createGroup=function(a){if("object"===typeof a){if("function"===typeof a.callback){var b=a.users;if("undefined"===typeof b||1>b.length){a.callback({status:"error",errorMessage:"Users list required"});return}if(b.length>oa){a.callback({status:"error",
errorMessage:"Users limit exceeds "+oa+". Max number of users allowed is "+oa+"."});return}if(!a.groupName){a.callback({status:"error",errorMessage:"Group name required"});return}if("undefined"===typeof a.type||""===a.type){a.callback({status:"error",errorMessage:"Group type required"});return}if(-1===Lb.indexOf(a.type)){a.callback({status:"error",errorMessage:"Invalid group type"});return}A.getGroup(a);return"success"}return"Callback function required"}return"Unsupported Format. Please check format"};
k.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";if(b.length>oa)return"Users limit exceeds "+oa+". Max number of users allowed is "+oa+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===Lb.indexOf(a.type))return"Invalid group type";A.getGroup(a);return"success"}return"Unsupported format. Please check format"};k.getTotalUnreadCount=function(){return X};k.subscribeToEvents=
function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(k.events.onConnectFailed=a.onConnectFailed),"function"===typeof a.onConnect&&(k.events.onConnect=a.onConnect),"function"===typeof a.onMessageDelivered&&(k.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(k.events.onMessageRead=a.onMessageRead),"function"===typeof a.onMessageDeleted&&(k.events.onMessageDeleted=a.onMessageDeleted),"function"===typeof a.onConversationDeleted&&(k.events.onConversationDeleted=
a.onConversationDeleted),"function"===typeof a.onUserConnect&&(k.events.onUserConnect=a.onUserConnect),"function"===typeof a.onUserDisconnect&&(k.events.onUserDisconnect=a.onUserDisconnect),"function"===typeof a.onConversationReadFromOtherSource&&(k.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&(k.events.onConversationRead=a.onConversationRead),"function"===typeof a.onMessageReceived&&(k.events.onMessageReceived=a.onMessageReceived),
"function"===typeof a.onMessageSentUpdate&&(k.events.onMessageSentUpdate=a.onMessageSentUpdate),"function"===typeof a.onMessageSent&&(k.events.onMessageSent=a.onMessageSent),"function"===typeof a.onUserBlocked&&(k.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(k.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&(k.events.onUserActivated=a.onUserActivated),"function"===typeof a.onUserDeactivated&&(k.events.onUserDeactivated=a.onUserDeactivated))};
k.getConversation=function(a){J.getTopicId({conversationId:a.conversationId},function(a){m.populateMessage(a.messageType,a.message,a.notifyUser)})}}f.applozic||(f.applozic=f.applozic?f.applozic:{},a.extend(!0,f.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var r={baseUrl:"https://chat.kommunicate.io",fileBaseUrl:"https://applozic.appspot.com",customFileUrl:"https://googleupload.applozic.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",
launcher:"applozic-launcher",userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,groupUserCount:!1,desktopNotification:!0,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,isAnonymousChat:!0,groupName:"Kommunicate",agentId:"",agentName:"",labels:{"conversations.title":"Conversations","start.new":"Start New Conversation","search.contacts":"Contacts",
"search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update",
"group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?",
"remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send",
"send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",hour:" hour",min:" min",yesterday:"yesterday",hours:" hours",mins:" mins","user.delete":"This user has been deleted",ago:"ago",admin:"Admin",user:"User",moderator:"Moderator",member:"Member","public":"Public","private":"Private",open:"Open",you:"You","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",
REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,
disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},v={messageType:5,type:0};a.fn.applozic=function(c,f,v){var g=a("#mck-sidebox");"object"===a.type(c)&&(KommunicateUtils.storeDataIntoKmSession("appOptions",c),c=a.extend(!0,{},r,c),c.conversationTitle=c.conversationTitle||c.groupName,c.accessToken=c.password||c.accessToken);if("undefined"!==typeof g.data("applozic_instance"))if(g=g.data("applozic_instance"),"string"===a.type(c))switch(c){case "reInitialize":return g.reInit(f);
case "loadConvTab":g.loadConvTab(f);break;case "loadTab":g.loadTab(f,v);break;case "uploadFile":g.uploadFile(f);break;case "loadTabView":g.loadTabView(f);break;case "loadChat":g.loadChat(f);break;case "loadContextualTab":return g.loadTabWithTopic(f);case "audioAttach":g.audioAttach(f);break;case "addWelcomeMessage":g.addWelcomeMessage(f);break;case "loadContacts":g.loadContacts(f);break;case "sendMessage":return g.sendMessage(f);case "sendGroupMessage":return g.sendGroupMessage(f);case "createGroup":return g.createGroup(f);
case "loadBroadcastTab":return f.groupName=f.groupName?f.groupName:"Broadcast",f.type=5,g.initGroupTab(f);case "initBroadcastTab":return f.groupName=f.groupName?f.groupName:"Broadcast",f.type=5,g.initGroupTab(f);case "initGroupTab":return g.initGroupTab(f);case "loadGroupTab":return g.loadGroupTab(f);case "loadGroupTabByClientGroupId":return g.loadGroupTabByClientGroupId(f);case "setOffline":return g.setOffline(),"success";case "setOnline":return g.setOffline(),"success";case "logout":return g.logout(),
"success";case "reset":g.reset(f);break;case "getUserDetail":return g.getUserStatus(f),"success";case "getGroupList":return g.getGroupList(f),"success";case "leaveGroup":return g.leaveGroup(f);case "addGroupMember":return g.addGroupMember(f);case "removeGroupMember":return g.removeGroupMember(f);case "updateGroupInfo":return g.updateGroupInfo(f);case "getMessages":g.getMessages(f);break;case "messageList":return g.getMessageList(f);case "getMessageListByTopicId":return g.getMessageListByTopicId(f);
case "getTotalUnreadCount":return g.getTotalUnreadCount();case "subscribeToEvents":return g.subscribeToEvents(f);case "getConversation":return g.getConversation(f);case "loadConversationWithAgent":return g.loadConversationWithAgent(f);case "updateUserIdentity":return g.updateUserIdentity(f);case "updateUser":return g.updateUser(f);case "getGroupListByFilter":return g.getGroupListByFilter(f);case "updateMessageMetadata":return g.updateMessageMetadata(f);case "mckLaunchSideboxChat":return g.mckLaunchSideboxChat()}else"object"===
a.type(c)&&g.reInit(c);else"object"===a.type(c)&&(c.userId&&c.appId&&""!==a.trim(c.userId)&&""!==a.trim(c.appId)?"undefined"!==typeof g.data("applozic_instance")?(g=g.data("applozic_instance"),g.reInit(c)):(jQuery="undefined"!==typeof c.ojq?$=c.ojq:$=a,"function"===typeof c.obsm?($.fn.modal=c.obsm,jQuery.fn.modal=c.obsm):"function"===typeof a.fn.modal?(f=a.fn.modal.noConflict(),$.fn.modal=f,jQuery.fn.modal=f):"function"===typeof $.fn.modal&&(f=$.fn.modal.noConflict(),$.fn.modal=f,jQuery.fn.modal=
f),"function"===typeof c.omckm?a.fn.mckModal=c.omckm:"function"===typeof a.fn.mckModal?a.fn.mckModal=a.fn.mckModal.noConflict():"function"===typeof $.fn.mckModal&&(a.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(a.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof a.fn.linkify&&($.fn.linkify=a.fn.linkify,jQuery.fn.linkify=a.fn.linkify),"function"===typeof $.fn.emojiarea?a.fn.emojiarea=$.fn.emojiarea:"function"===typeof a.fn.emojiarea&&($.fn.emojiarea=
a.fn.emojiarea,jQuery.fn.emojiarea=a.fn.emojiarea),"function"===typeof $.fn.locationpicker?a.fn.locationpicker=$.fn.locationpicker:"function"===typeof a.fn.locationpicker&&($.fn.locationpicker=a.fn.locationpicker,jQuery.fn.locationpicker=a.fn.locationpicker),c=new n(c),g.data("applozic_instance",c),c.init()):alert("Oops! looks like incorrect application id or user Id."))};a.fn.applozic.defaults=r})($applozic,window,document);
Kommunicate.attachEvents=function(a){a("#mck-message-cell").on("click",".km-increment-guest-count",Kommunicate.richMsgEventHandler.incrementGuestCount);a("#mck-message-cell").on("click",".km-decrement-guest-count",Kommunicate.richMsgEventHandler.decrementGuestCount);a("#mck-message-cell").on("click",".km-btn-add-more-rooms",Kommunicate.richMsgEventHandler.addMoreRoom);a("#mck-message-cell").on("click",".km-done-button",Kommunicate.richMsgEventHandler.processSelectedRoom);a("#mck-message-cell").on("click",
".km-card-message-footer-button",Kommunicate.richMsgEventHandler.processHotelBookClick);a("#mck-message-cell").on("click",".km-cta-button",Kommunicate.richMsgEventHandler.handlleRichButtonClick);a("#mck-message-cell").on("click",".km-submit-person-detail",Kommunicate.richMsgEventHandler.handlleSubmitPersonDetail);a("#mck-message-cell").on("click",".km-block-room-button",Kommunicate.richMsgEventHandler.processBookRoomClick);a("#mck-message-cell").on("click",".km-quick-replies",Kommunicate.richMsgEventHandler.processQuickReplies);
a("#mck-message-cell").on("click",".km-list-item-handler",Kommunicate.richMsgEventHandler.processClickOnListItem);a("#mck-message-cell").on("click",".km-list-button-item-handler",Kommunicate.richMsgEventHandler.processClickOnButtonItem);a("#mck-message-cell").on("click",".km-faq-dialog-button",Kommunicate.richMsgEventHandler.processClickOnDialogButton)};
Kommunicate.richMsgEventHandler={initializeSlick:function(a){0<a.length&&tns({container:a[0],items:1,slideBy:"page",mouseDrag:!0,arrowKeys:!0,onInit:function(){console.log("tiny-slider initilized");document.querySelector(".km-slick-container .tns-controls button:first-child").innerHTML="\x3c";document.querySelector(".km-slick-container .tns-controls button:last-child").innerHTML="\x3e"}})},decrementGuestCount:function(a){a=a.target||a.srcElement;var f=a.dataset.type;"guest"==f?a.parentElement.getElementsByClassName("km-room-number-field")[0].stepDown():
"children"==f&&a.parentElement.getElementsByClassName("km-person-number-field")[0].stepDown()},incrementGuestCount:function(a){a=a.target||a.srcElement;var f=a.dataset.type;"guest"==f?a.parentElement.getElementsByClassName("km-room-number-field")[0].stepUp():"children"==f&&a.parentElement.getElementsByClassName("km-person-number-field")[0].stepUp()},decrementPersonCount:function(){document.getElementById("km-person-number-field").stepDown()},incrementPersonCount:function(){document.getElementById("km-person-number-field").stepUp()},
addMoreRoom:function(a){var f=a.target.parentElement.parentElement.parentElement,c=Number(a.target.dataset.roomcount)+1;a.target.setAttribute("data-roomcount",c);a=document.createElement("div");a.innerHTML=Kommunicate.markup.getSingleRoomPaxInfo(c);f.getElementsByClassName("km-room-person-selector-container")[0].appendChild(a)},processSelectedRoom:function(a){var f=[],c=$(a.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-room-number-field");a=
$(a.target).closest(".mck-msg-box-rich-text-container").find(".km-room-person-selector-container input.km-person-number-field");for(var n="",r=0;r<c.length;r++){var v=a[r].value,g=Array(1*v).fill(10);f.push({NoOfAdults:c[r].value,NoOfChild:v,ChildAge:g});n+="Room "+(r+1)+" Guest "+c[r].value+"\n"}f={message:n,metadata:{isRoomGuestJSON:!0,roomGuestJson:JSON.stringify(f),guestTypeId:"ADULTS"}};Kommunicate.sendMessage(f)},processHotelBookClick:function(a){a=a.target||a.srcElement;var f=a.dataset.sessionid,
c=a.dataset.resultindex;a={message:"Get room detail of "+a.dataset.name.replace("_"," "),metadata:{hotelSelected:!0,sessionId:f,resultIndex:c,skipDialogflow:!0}};Kommunicate.sendMessage(a)},processBookRoomClick:function(a){a=a.target||a.srcElement;var f=a.dataset.sessionid,c=a.dataset.roomindex,n=a.dataset.noofrooms,r=a.dataset.hotelresultindex;a={message:"Book "+("undefined"==a.dataset.hotelname?"":a.dataset.hotelname).replace("_"," "),metadata:{sessionId:f,RoomIndex:c,NoOfRooms:n,blockHotelRoom:!0,
skipDialogflow:!0,HotelResultIndex:r}};f=$applozic("#mck-message-cell .mck-message-inner");c=$applozic("#mck-msg-to");!0===f.data("isgroup")?a.groupId=c.val():a.to=c.val();$applozic.fn.applozic("sendGroupMessage",a)},handlleRichButtonClick:function(a){a=a.target||a.srcElement;"km-eh-001"==a.dataset.eventhandlerid&&a.parentElement.getElementsByClassName("km-btn-hidden-form")[0].submit()},handlleSubmitPersonDetail:function(a){var f=$applozic(a.target).closest(".km-guest-details-container").find(".km-title-select option:selected").text(),
c=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.km-age-input"),n=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.first-name-input"),r=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.middle-name-input"),v=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.last-name-input"),g=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.e-mail-input"),
k=$applozic(a.target).closest(".km-guest-details-container").find(".km-guest-detail-form input.number-input");""==n[0].value||""==v[0].value||""==g[0].value||""==k[0].value?$applozic(a.target).closest(".km-guest-details-container").find(".km-mandatory-field-error").removeClass("n-vis").addClass("vis"):(f={Title:"title"===f?"":f,Age:c[0].value,FirstName:n[0].value,MiddleName:r[0].value,LastName:v[0].value,EmailId:g[0].value,PhoneNo:k[0].value},a={message:f.Title+" "+f.FirstName+" "+f.LastName+"\n"+
f.EmailId+"\n"+f.PhoneNo,metadata:{sessionId:(a.target||a.srcElement).dataset.sessionid,guestDetail:!0,skipDialogflow:!0,personInfo:JSON.stringify(f)}},Kommunicate.sendMessage(a),console.log("passenger detail submitted"))},processQuickReplies:function(a){Kommunicate.sendMessage({message:a.target.title,metadata:{}})},processClickOnListItem:function(a){var f=a.currentTarget;a=f.dataset.reply;var c=f.dataset.type,n=f.dataset.articleid;f=f.dataset.source;c&&"quick_reply"==c&&Kommunicate.sendMessage({message:a,
metadata:{KM_FAQ_ID:n,source:f}})},processClickOnButtonItem:function(a){var f=a.currentTarget;a=f.dataset.reply;(f=f.dataset.type)&&"quick_reply"==f&&Kommunicate.sendMessage({message:a,metadata:{KM_BUTTON_CLICKED:!0}})},processClickOnDialogButton:function(a){Kommunicate.sendMessage({message:a.currentTarget.dataset.reply,metadata:{skipBot:!0}})}};
KommunicateUI={awayMessageInfo:{},isLeadCollectionEnabled:!1,CONSTS:{},populateAwayMessage:function(a,f){var c=$applozic("#mck-tab-individual").hasClass("n-vis");!a&&"SUCCESS"==f.code&&0<f.data.messageList.length&&!c?(KommunicateUI.isLeadCollectionEnabled=f.data.collectEmail,KommunicateUI.awayMessageInfo.isEnabled=!0,KommunicateUI.awayMessageInfo.eventId=f.data.messageList[0].eventId,awayMessage=f.data.messageList[0].message,$applozic("#mck-away-msg").html(awayMessage),$applozic("#mck-away-msg-box").removeClass("n-vis").addClass("vis")):
$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis")},hideAwayMessage:function(){$applozic("#mck-away-msg").html("");$applozic("#mck-away-msg-box").removeClass("vis").addClass("n-vis")},displayLeadCollectionTemplate:function(a){if(a&&a.length){for(var f=0,c=0;c<a.length&&(5!=a[c].type||(f++,2!=f));c++);1==f?KommunicateUI.isLeadCollectionEnabled&&KommunicateUI.awayMessageInfo.isEnabled&&1==KommunicateUI.awayMessageInfo.eventId&&this.populateLeadCollectionTemplate():this.hideLeadCollectionTemplate()}else null==
a&&this.populateLeadCollectionTemplate()},populateLeadCollectionTemplate:function(){$applozic("#mck-email-collection-box").removeClass("n-vis").addClass("vis");$applozic("#mck-btn-attach-box").removeClass("vis").addClass("n-vis");$applozic("#mck-btn-smiley-box").removeClass("vis").addClass("n-vis");$applozic("#mck-text-box").blur();$applozic("#mck-text-box").attr("data-text","Your email ID")},hideLeadCollectionTemplate:function(){$applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis");
$applozic("#mck-email-error-alert-box").removeClass("vis").addClass("n-vis");$applozic("#mck-btn-attach-box").removeClass("n-vis").addClass("vis");$applozic("#mck-btn-smiley-box").removeClass("n-vis").addClass("vis");$applozic("#mck-text-box").attr("data-text","Enter your message here...")},validateEmail:function(a){if(a.match(/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/))return $applozic("#mck-email-error-alert-box").removeClass("vis").addClass("n-vis"),
this.hideLeadCollectionTemplate(),window.$applozic.fn.applozic("updateUser",{data:{email:a}}),!0;$applozic("#mck-email-error-alert-box").removeClass("n-vis").addClass("vis");$applozic("#mck-email-collection-box").removeClass("vis").addClass("n-vis");return!1},faqEvents:function(a,f){var c;$applozic(d).on("click","#mck-msg-preview",function(){KommunicateUI.showChat()});$applozic(d).on("click",".km-faq-list",function(){$applozic("#km-faqanswer").empty();var c=$(this).attr("data-articleid"),r=$(this).attr("data-source");
KommunicateKB.getArticle({data:{appId:a.appId,articleId:c,source:r,helpdocsAccessKey:f},success:function(a){0==$applozic("#km-faqanswer .km-faqanswer-list").length&&($applozic("#km-faqanswer").append('\x3cdiv class\x3d"km-faqanswer-list km-faqanswerscroll"\x3e\x3cdiv class\x3d"km-faqquestion"\x3e'+a.data.title+'\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor km-faqanswer"\x3e'+a.data.body+"\x3c/div\x3e\x3c/div\x3e"),$applozic("#km-contact-search-input-box").removeClass("vis").addClass("n-vis"),$applozic("#km-faqdiv").removeClass("vis").addClass("n-vis"),
$applozic("#km-faqanswer").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-individual").removeClass("n-vis").addClass("vis"),$applozic("#mck-tab-conversation").removeClass("vis").addClass("n-vis"),$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis"))},error:function(){}})});$applozic(d).on("click","#km-faq",function(){KommunicateUI.showHeader();$applozic("#km-faq").removeClass("vis").addClass("n-vis");$applozic("#mck-no-conversations").removeClass("vis").addClass("n-vis");
$applozic(".faq-common").removeClass("n-vis").addClass("vis");$applozic(".mck-conversation ").removeClass("vis").addClass("n-vis");$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis");$applozic(".mck-conversation-back-btn").removeClass("n-vis").addClass("vis");$applozic("#mck-tab-title").html("FAQ").removeClass("n-vis").addClass("vis");$applozic("#mck-away-msg-box").addClass("n-vis").removeClass("vis");$applozic("#mck-sidebox-ft").addClass("n-vis").removeClass("vis");$applozic("#mck-contacts-content").addClass("n-vis").removeClass("vis")});
$applozic(d).on("click","#km-faqanswer a",function(a){a.preventDefault();window.open(a.target.href)});$applozic("#km-faq-search-input").keydown(function(n){clearTimeout(c);c=setTimeout(function(){KommunicateKB.getArticles({data:{appId:a.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:f},success:function(a){a.data&&0===a.data.length&&$applozic(".km-no-results-found-container").hasClass("n-vis")?($applozic(".km-no-results-found-container").addClass("vis").removeClass("n-vis"),
$applozic(".km-talk-to-human-div p").text("We are here to help.")):($applozic(".km-no-results-found-container").addClass("n-vis").removeClass("vis"),$applozic(".km-talk-to-human-div p").text("Looking for something else? "));$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis");$applozic("#km-faqdiv").empty();$applozic.each(a.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cdiv class\x3d"km-faqimage"\x3e\x3c/div\x3e\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor"\x3e'+
c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")})},error:function(){}})},2E3);32!=n.which&&13!=n.which||KommunicateKB.getArticles({data:{appId:a.appId,query:document.getElementById("km-faq-search-input").value,helpdocsAccessKey:f},success:function(a){a.data&&0===a.data.length&&$applozic(".km-no-results-found-container").hasClass("n-vis")?($applozic(".km-no-results-found-container").addClass("vis").removeClass("n-vis"),$applozic(".km-talk-to-human-div p").text("We are here to help. ")):($applozic(".km-no-results-found-container").addClass("n-vis").removeClass("vis"),
$applozic(".km-talk-to-human-div p").text("Looking for something else? "));$applozic(".km-talk-to-human-div").addClass("vis").removeClass("n-vis");$applozic("#km-faqdiv").empty();$applozic.each(a.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cspan class\x3d"km-faqimage"/ \x3e\x3c/span\x3e \x3cdiv class\x3d"km-faqanchor "\x3e'+c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")})},
error:function(){}})});$applozic(d).on("click","#mck-conversation-back-btn",function(){$applozic(".km-kb-container").hasClass("vis")&&($applozic("#km-faqanswer").hasClass("vis")?(KommunicateUI.showHeader(),$applozic("#km-faqdiv").removeClass("n-vis").addClass("vis"),$applozic("#km-faqanswer").removeClass("vis").addClass("n-vis"),$applozic("#km-contact-search-input-box").removeClass("n-vis").addClass("vis")):$applozic("#km-faqdiv").hasClass("vis")?($applozic("#mck-tab-individual").removeClass("vis").addClass("n-vis"),
$applozic("#mck-tab-conversation").removeClass("n-vis").addClass("vis"),$applozic(".faq-common").removeClass("vis").addClass("n-vis"),$applozic(".mck-conversation ").removeClass("n-vis").addClass("vis"),$applozic("#km-faq").removeClass("n-vis").addClass("vis"),$applozic(".km-talk-to-human-div").addClass("n-vis").removeClass("vis")):$applozic(".mck-conversation").hasClass("vis")&&$applozic("#km-faq").removeClass("n-vis").addClass("vis"))})},showChat:function(){$applozic(".faq-common").removeClass("vis").addClass("n-vis");
$applozic(".mck-conversation ").removeClass("n-vis").addClass("vis");$applozic("#km-faq").removeClass("n-vis").addClass("vis");$applozic("#mck-tab-conversation").hasClass("vis")},showHeader:function(){$applozic("#mck-tab-individual").removeClass("n-vis").addClass("vis");$applozic("#mck-tab-conversation").removeClass("vis").addClass("n-vis")},sendFaqQueryAsMsg:function(a){var f=$applozic("#km-faq-search-input").val();""!==f&&$applozic.fn.applozic("sendGroupMessage",{groupId:a,type:5,contentType:0,
message:'Hi, I have a query regarding \n"'+f+'"\n\n Can you help me out?'})}};
Kommunicate.postPluginInitialization=function(a,f){$applozic.fn.applozic("subscribeToEvents",{onMessageReceived:function(a){a=a&&a.message;var c=a.metadata&&"HIDDEN"!=a.metadata.category&&"true"!=a.metadata.hide;a.metadata&&!c||KommunicateUI.hideAwayMessage()}});KommunicateKB.init(Kommunicate.getBaseUrl());var c=KommunicateUtils.getDataFromKmSession("HELPDOCS_KEY");null==c||""==c?Kommunicate.client.getThirdPartySettings({appId:f.appId,type:1},function(a,r){a?console.log("err : ",a):r&&"SUCCESS"==
r.code&&((a=r.message.find(function(a){return a.type==KommunicateConstants.THIRD_PARTY_APPLICATION.HELPDOCS}))?(c=a.accessKey,KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY",a.accessKey)):KommunicateUtils.storeDataIntoKmSession("HELPDOCS_KEY","null"),Kommunicate.helpdocsInitialization(f,c))}):Kommunicate.helpdocsInitialization(f,c)};
Kommunicate.helpdocsInitialization=function(a,f){"null"==f&&(f=null);KommunicateKB.getArticles({data:{appId:a.appId,query:"",helpdocsAccessKey:f},success:function(c){c.data&&0<c.data.length&&$applozic(".km-kb-container").hasClass("n-vis")&&$applozic(".km-kb-container").removeClass("n-vis").addClass("vis");$applozic.each(c.data,function(a,c){$applozic("#km-faqdiv").append('\x3cli class\x3d"km-faq-list" data-source\x3d"'+c.source+'" data-articleId\x3d"'+c.articleId+'"\x3e\x3ca class\x3d"km-faqdisplay"\x3e \x3cdiv\x3e\x3cdiv class\x3d"km-faqimage"\x3e\x3c/div\x3e\x3c/div\x3e \x3cdiv class\x3d"km-faqanchor"\x3e'+
c.title+"\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e")});KommunicateUI.faqEvents(a,f)},error:function(){}})};function RingToneService(){this.loadRingTone=function(a,f){return new Howl({src:[a],loop:f.loop})}};