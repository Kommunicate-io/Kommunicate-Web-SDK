var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(b,h,n){b instanceof String&&(b=String(b));for(var H=b.length,M=0;M<H;M++){var ea=b[M];if(h.call(n,ea,M,b))return{i:M,v:ea}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,h,n){b!=Array.prototype&&b!=Object.prototype&&(b[h]=n.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,h,n,H){if(h){n=$jscomp.global;b=b.split(".");for(H=0;H<b.length-1;H++){var M=b[H];M in n||(n[M]={});n=n[M]}b=b[b.length-1];H=n[b];h=h(H);h!=H&&null!=h&&$jscomp.defineProperty(n,b,{configurable:!0,writable:!0,value:h})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(b,n){return $jscomp.findInternal(this,b,n).v}},"es6","es3");$jscomp.checkStringArgs=function(b,h,n){if(null==b)throw new TypeError("The 'this' value for String.prototype."+n+" must not be null or undefined");if(h instanceof RegExp)throw new TypeError("First argument to String.prototype."+n+" must not be a regular expression");return b+""};
$jscomp.polyfill("String.prototype.startsWith",function(b){return b?b:function(b,n){var h=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var M=h.length,ea=b.length;n=Math.max(0,Math.min(n|0,h.length));for(var c=0;c<ea&&n<M;)if(h[n++]!=b[c++])return!1;return c>=ea}},"es6","es3");var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(b,h,n){function H(c){var l=this,y,H;MCK_GROUP_MAP=[];var D=[],fa,kb,rb=!0,ra=[],ma=0;MCK_CLIENT_GROUP_MAP=[];var Ea=!1,na=[],Fa=[],xa=90,ha=[],I=[],U=[],N=[],sb=!0,K=0,tb=c.mode;MCK_LABELS=c.labels;MCK_BASE_URL=c.baseUrl;var V=c.appId,ub=[],vb=[0,1,2,3],wb=[1,2,5,6,10],sa=[],fb=!1,ab=c.launcher,lb=c.visitor,Ob=c.userName,bb=c.locShare,Oa=c.video,E=c.fileBaseUrl,F=c.onInit,xb=c.onTopicDetails,ic=[0,1,2],yb=c.onClose,zb=c.displayText,O=c.accessToken,Wa=c.readConversation,ta=c.maxGroupSize,
Ab=c.onTabClicked,Pb=c.contactNumber,ya=c.maxAttachmentSize,Bb=c.appModuleName,za=c.getTopicDetail,Xa=c.contactDisplayName,Cb=c.validateMessage,Ja=c.finalPriceResponse,Pa=c.contactDisplayImage,Db=c.priceWidget,ia=c.openGroupSettings,ba=c.offlineMessageDetail,mb=c.authenticationTypeId,Eb=c.getConversationDetail,jc=c.notificationIconLink,Qb=c.mapStaticAPIkey,kc=c.notificationSoundLink?c.notificationSoundLink:MCK_BASE_URL+"/resources/sidebox/audio/notification_tone.mp3",z=lb?"guest":b.trim(c.userId),
Rb=bb?c.googleApiKey:"NO_ACCESS",lc="undefined"===typeof c.source?1:c.source,Ka="boolean"===typeof c.topicBox?c.topicBox:!1,nb="boolean"===typeof c.olStatus?c.olStatus:!1,Sb="boolean"===typeof c.messageBubbleAvator?c.messageBubbleAvator:!0,gb="boolean"===typeof c.showOfflineMessage?c.showOfflineMessage:!1,Tb="boolean"===typeof c.hideGroupSubtitle?c.hideGroupSubtitle:!1,Ub="undefined"===typeof c.defaultMessageMetaData?{}:c.defaultMessageMetaData,Fb="boolean"===typeof c.groupUserCount?c.groupUserCount:
!1,Vb="boolean"===typeof c.checkUserBusyWithStatus?c.checkUserBusyWithStatus:!1,Wb="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1,Aa="boolean"===typeof c.topicHeader?c.topicHeader:!1,Xb=c.supportId?'data-mck-id\x3d"'+c.supportId+'"':"",Gb="boolean"===typeof c.loadOwnContacts?c.loadOwnContacts:!1,Yb="boolean"===typeof c.desktopNotification?c.desktopNotification:!0,Zb="boolean"===typeof c.notification?c.notification:!0,$b="boolean"===typeof c.swNotification?c.swNotification:!1,ac="boolean"===
typeof c.autoTypeSearchEnabled?c.autoTypeSearchEnabled:!0,ob="boolean"===typeof c.launchOnNewMessage?c.launchOnNewMessage:!1,Hb="boolean"===typeof c.launchOnUnreadMessage?c.launchOnUnreadMessage:!1,bc="number"===typeof c.userTypeId?c.userTypeId:!1,Y=["DEFAULT","NEW","OPEN"],cc=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],A=new function(){var a=this,e=[],c=[],x=[],f=[];a.updateLatestMessage=function(b){var e=[];e.push(b);a.updateLatestMessageArray(e);a.updateMckMessageArray(e)};a.getLatestMessageArray=
function(){return"undefined"!==typeof h.sessionStorage?b.parseJSON(h.sessionStorage.getItem("mckLatestMessageArray")):e};a.setLatestMessageArray=function(b){"undefined"!==typeof h.sessionStorage?h.sessionStorage.setItem("mckLatestMessageArray",h.JSON.stringify(b)):e=b};a.updateLatestMessageArray=function(a){if("undefined"!==typeof h.sessionStorage){var f=b.parseJSON(h.sessionStorage.getItem("mckLatestMessageArray"));null!==f?(f=f.concat(a),h.sessionStorage.setItem("mckLatestMessageArray",h.JSON.stringify(f))):
h.sessionStorage.setItem("mckLatestMessageArray",h.JSON.stringify(a));return a}return e=e.concat(a)};a.getMckMessageArray=function(){return"undefined"!==typeof h.sessionStorage?b.parseJSON(h.sessionStorage.getItem("mckMessageArray")):c};a.clearMckMessageArray=function(){"undefined"!==typeof h.sessionStorage?(h.sessionStorage.removeItem("mckMessageArray"),h.sessionStorage.removeItem("mckLatestMessageArray")):(c.length=0,e.length=0)};a.clearAppHeaders=function(){"undefined"!==typeof h.sessionStorage&&
h.sessionStorage.removeItem("mckAppHeaders")};a.setAppHeaders=function(b){"undefined"!==typeof h.sessionStorage&&h.sessionStorage.setItem("mckAppHeaders",h.JSON.stringify(b))};a.getAppHeaders=function(a){return"undefined"!==typeof h.sessionStorage?b.parseJSON(h.sessionStorage.getItem("mckAppHeaders")):{}};a.getMessageByKey=function(b){return x[b]};a.updateMckMessageArray=function(a){for(var e=0;e<a.length;e++){var f=a[e];x[f.key]=f}return"undefined"!==typeof h.sessionStorage?(e=b.parseJSON(h.sessionStorage.getItem("mckMessageArray")),
null!==e?(e=e.concat(a),h.sessionStorage.setItem("mckMessageArray",h.JSON.stringify(e))):h.sessionStorage.setItem("mckMessageArray",h.JSON.stringify(a)),a):c=c.concat(a)};a.getMckContactNameArray=function(){return"undefined"!==typeof h.sessionStorage?b.parseJSON(h.sessionStorage.getItem("mckContactNameArray")):f};a.setMckContactNameArray=function(b){"undefined"!==typeof h.sessionStorage?h.sessionStorage.setItem("mckContactNameArray",h.JSON.stringify(b)):f=b};a.updateMckContactNameArray=function(a){if("undefined"!==
typeof h.sessionStorage){var e=b.parseJSON(h.sessionStorage.getItem("mckContactNameArray"));null!==e&&(a=a.concat(e));h.sessionStorage.setItem("mckContactNameArray",h.JSON.stringify(a));return a}return f=f.concat(a)};a.clearMckContactNameArray=function(){"undefined"!==typeof h.sessionStorage?h.sessionStorage.removeItem("mckContactNameArray"):f.length=0}},oa={},Qa=[],Ra=[],La={},ua=[],Ga=[],Sa=[],Z=[],cb=new function(){var a=this,k=!1,c,x,f=b("#mck-file-menu"),l=b("#mck-message-cell .mck-message-inner");
b("#mck-tab-individual");var q=xa;a.getLauncherHtml=function(){return'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher mck-button-launcher" '+("support"===tb?Xb:"")+'\x3e\x3cspan class\x3d"mck-icon-chat"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
a.initializeApp=function(e,f){k=f;var c={applicationId:e.appId,userId:z};null!==Ob&&(c.displayName=e.userName);null!==e.email&&(c.email=e.email);null!==Pb&&(c.contactNumber=e.contactNumber);e.imageLink&&(c.imageLink=e.imageLink);e.appModuleName&&(c.appModuleName=e.appModuleName);O&&(c.password=e.accessToken);-1===ic.indexOf(mb)&&(mb=0);Wb&&(c.resetUserStatus=!0);"number"==typeof bc&&(c.userTypeId=bc);c.enableEncryption=!0;c.appVersionCode=108;c.authenticationTypeId=mb;fa=H="";a.validateAppSession(c)?
Oa&&da.InitilizeVideoClient(z,fa):b.ajax({url:MCK_BASE_URL+"/v2/tab/initialize.page",type:"post",data:h.JSON.stringify(c),contentType:"application/json",headers:{"Application-Key":V},success:function(e){Oa&&da.InitilizeVideoClient(e.userId,e.deviceKey);"kommunicate"==window.applozic.PRODUCT_ID&&b("#km-chatLoginModal").removeClass("vis").addClass("n-vis");A.clearMckMessageArray();A.clearMckContactNameArray();"INVALID_PASSWORD"===e?"function"===typeof F&&F({status:"error",errorMessage:"INVALID PASSWORD"}):
"INVALID_APPID"===e?"function"===typeof F&&F({status:"error",errorMessage:"INVALID APPLICATION ID"}):"error"===e||"USER_NOT_FOUND"===e?"function"===typeof F&&F({status:"error",errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===e?"function"===typeof F&&F({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof e&&null!==e&&e.token?(e.appId=c.applicationId,O&&(e.accessToken=c.password),a.onInitApp(e)):"function"===typeof F&&F({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})},
error:function(){A.clearMckMessageArray();"function"===typeof F&&F({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})};a.onInitApp=function(f){a.appendLauncher();a.setLabels();b(".applozic-launcher").each(function(){b(this).hasClass("mck-msg-preview")||b(this).show()});y=f.token;mckUtils.setEncryptionKey(f.encryptionKey);z=f.userId;fa=f.deviceKey;kb=f.websocketUrl;xa=f.websocketIdleTimeLimit;E=f.fileBaseUrl;fb=f.deactivated;H=btoa(f.userId+":"+f.deviceKey);K=f.totalUnreadCount;lb||"guest"===
z||"0"===z||"C0"===z||(k?W.reconnect():W.init());e.createContactWithDetail({userId:z,displayName:f.displayName,photoLink:f.imageLink});b.ajaxPrefilter(function(b){b.beforeSend||-1===b.url.indexOf(MCK_BASE_URL)||(b.beforeSend=function(b){a.setHeaders(b)})});if(f.betaPackage){var c="https://www.kommunicate.io/?utm_source\x3d"+h.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";b(".mck-running-on a").attr("href",c);b(".mck-running-on").removeClass("n-vis").addClass("vis")}c=A.getMckContactNameArray();
if(null!==c&&0<c.length)for(var l=0;l<c.length;l++){var x=c[l];null!==x&&(ua[x[0]]=x[1])}T.checkUserConnectedStatus();"function"===typeof F&&F("success",f);cb.tabFocused();0<Ha.length&&0<K&&Ha.html(K);Hb&&v.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});hb.subscribeToServiceWorker();A.setAppHeaders(f);mckGroupService.loadGroups({apzCallback:t.loadGroups})};a.validateAppSession=function(b){var e=A.getAppHeaders();if(e&&e.userId){if(b.applicationId===e.appId&&b.userId===e.userId&&b.password===e.accessToken)return a.onInitApp(e),
!0;A.clearAppHeaders()}return!1};a.setHeaders=function(b){b.setRequestHeader("UserId-Enabled",!0);H&&b.setRequestHeader("Authorization","Basic "+H);b.setRequestHeader("Application-Key",V);fa&&b.setRequestHeader("Device-Key",fa);O&&b.setRequestHeader("Access-Token",O);Bb&&b.setRequestHeader("App-Module-Name",Bb)};a.setLabels=function(){b("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);b("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",
MCK_LABELS["start.new"]);b("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]);b("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]);b("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]);b("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]);b("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]);
b("#mck-no-messages").html(MCK_LABELS["empty.messages"]);b("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]);b("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]);b("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);b("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);b("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]);b("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);
b("#mck-msg-error").html(MCK_LABELS["group.deleted"]);b("#mck-gc-title-label").html(MCK_LABELS["group.title"]);b("#mck-gc-type-label").html(MCK_LABELS["group.type"]);b("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);b("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);b("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]);b("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",
MCK_LABELS["add.members.title"]);b("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);b("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);b("#mck-typing-label").html(MCK_LABELS.typing);b("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]);b("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);
b("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]);b("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);b("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);b("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);b(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);b("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);b("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",
MCK_LABELS.close);b("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send);b("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);b("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);b("#mck-group-name-save").attr("title",MCK_LABELS.save);b("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);b("#mck-group-name-edit").attr("title",MCK_LABELS.edit)};b(n).on("click",".fancybox",function(a){a=b(this);if(-1!==a.data("type").indexOf("video")){var e=a.find(".mck-video-box").html(),
f;a.fancybox({content:e,title:a.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){f=b(".fancybox-inner").find("video").get(0);f.load();f.play()}})}else a=a.data("url"),b(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:a,type:"image"})});b(h).on("resize",function(){"block"===f.css("display")&&Ib.fileMenuReposition();if(0===l.find(".mck-contact-list").length){var b=l.get(0).scrollHeight;
l.height()<b&&l.animate({scrollTop:l.prop("scrollHeight")},0)}});a.appendLauncher=function(){b("#mck-sidebox-launcher").remove();b("body").append(a.getLauncherHtml());hb.init()};a.tabFocused=function(){function b(b){var e={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};b=b||h.event;(sb=b.type in e?e[b.type]:this.hidden?!1:!0)?(1>q&&rb&&W.checkConnected(!0),a.stopIdleTimeCounter()):(1===ma&&W.sendTypingStatus(0),a.manageIdleTime())}"hidden"in n?n.addEventListener("visibilitychange",
b):!1 in n?n.addEventListener("mozvisibilitychange",b):!1 in n?n.addEventListener("webkitvisibilitychange",b):!1 in n?n.addEventListener("msvisibilitychange",b):"onfocusin"in n?n.onfocusin=n.onfocusout=b:h.onpageshow=h.onpagehide=h.onfocus=h.onblur=b;void 0!==n.hidden&&b({type:n.hidden?"blur":"focus"})};a.manageIdleTime=function(){q=xa;c&&clearInterval(c);c=setInterval(function(){0>--q&&(q=0,W.stopConnectedCheck(),clearInterval(c),c="")},6E4)};a.stopIdleTimeCounter=function(){q=xa;c&&clearInterval(c);
c=""};a.manageOfflineMessageTime=function(b){if("object"!==typeof ba||isNaN(ba.timeout))h.console.log("Offline message timeout required.");else{if(1===ba.type){if(!ba.userIds||0===ba.userIds.length){h.console.log("Offline message userIds required.");return}if(-1===ba.userIds.indexOf(b))return}x&&clearInterval(x);x=setTimeout(function(){clearInterval(x);x="";e.showOfflineMessage()},5E3*parseInt(ba.timeout))}};a.stopOfflineMessageCounter=function(){x&&clearInterval(x);x=""}},Ib=new function(){var a=
this,e="",c="",l=!1,f=b("#mck-my-loc"),G=b("#mck-loc-box"),q=b("#mck-loc-lat"),n=b("#mck-loc-lon"),ca=b("#mck-btn-loc"),B=b("#mck-sidebox-ft"),P=b("#mck-file-menu"),t=b("#mck-btn-attach"),v=b("#mck-map-content"),y=b("#mck-loc-address");a.init=function(){bb&&h.google&&"object"===typeof h.google.maps&&(e=new h.google.maps.Geocoder,t.on("click",function(){a.fileMenuToggle()}),ca.on("click",function(){l?G.mckModal():(mckMapUtils.getCurrentLocation(a.onGetCurrLocation,a.onErrorCurrLocation),l=!0)}));f.on("click",
function(){mckMapUtils.getCurrentLocation(a.onGetMyCurrLocation,a.onErrorMyCurrLocation)})};a.fileMenuReposition=function(){var b=B.offset();b.bottom=h.innerHeight-b.top;P.css({bottom:51<b.bottom?b.bottom:51,right:0})};a.fileMenuToggle=function(){t.hasClass("on")?(t.removeClass("on"),P.hide()):(a.fileMenuReposition(),t.addClass("on"),P.show())};a.onGetCurrLocation=function(b){MCK_CURR_LATITIUDE=b.coords.latitude;MCK_CURR_LONGITUDE=b.coords.longitude;a.openMapBox()};a.onErrorCurrLocation=function(){MCK_CURR_LATITIUDE=
46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;a.openMapBox()};a.onErrorMyCurrLocation=function(b){alert("Unable to retrieve your location. ERROR("+b.code+"): "+b.message)};a.onGetMyCurrLocation=function(b){MCK_CURR_LATITIUDE=b.coords.latitude;MCK_CURR_LONGITUDE=b.coords.longitude;q.val(MCK_CURR_LATITIUDE);n.val(MCK_CURR_LONGITUDE);q.trigger("change");n.trigger("change");c?y.val(c):e&&e.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(b,a){"OK"===a&&b[1]&&(c=b[1].formatted_address)})};
a.openMapBox=function(){v.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:q,longitudeInput:n,locationNameInput:y},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(b){MCK_CURR_LATITIUDE=b.latitude;MCK_CURR_LONGITUDE=b.longitude}});G.on("shown.bs.mck-box",function(){v.locationpicker("autosize")});G.mckModal()}},T=new function(){var a=this,e=b("#mck-msg-form"),c=b("#mck-msg-error"),l=b("#mck-tab-title"),
f=b("#mck-tab-status"),n=b(".mck-typing-box"),q=b("#mck-block-button"),t=b("#mck-message-cell .mck-message-inner");a.updateUserStatus=function(b){if("object"===typeof ha[b.userId]){var a=ha[b.userId];0===b.status?(a.connected=!1,a.lastSeenAtTime=b.lastSeenAtTime):1===b.status&&(a.connected=!0)}else a=[],a.push(b.userId),aa.getUsersDetail(a,{})};a.getUserDetail=function(b){if("object"===typeof ha[b])return ha[b]};a.checkUserConnectedStatus=function(){var e=[],f=[];b(".mck-user-ol-status").each(function(){var a=
b(this).data("mck-id");"undefined"!==typeof a&&""!==a&&(e.push(a),a=mckContactUtils.formatContactId(""+a),b(this).addClass(a),b(this).next().addClass(a))});0<e.length&&(b.each(e,function(b,a){"undefined"===typeof ha[a]&&f.push(a)}),0<f.length?aa.getUsersDetail(f,{setStatus:!0}):a.updateUserConnectedStatus())};a.updateUserConnectedStatus=function(){b(".mck-user-ol-status").each(function(){var a=b(this),e=a.data("mck-id");if(e){var f=ha[e];"undefined"!==typeof ha[e]&&f.connected?(a.removeClass("n-vis").addClass("vis"),
a.next().html("("+MCK_LABELS.online+")")):(a.removeClass("vis").addClass("n-vis"),a.next().html("(Offline)"))}})};a.lastSeenOfGroupOfTwo=function(b){h.MCK_OL_MAP[b]?(f.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),f.removeClass("n-vis").addClass("vis")):U[b]&&(b=mckDateUtils.getLastSeenAtStatus(U[b]),f.html(b),f.attr("title",b),l.addClass("mck-tab-title-w-status"),f.removeClass("n-vis").addClass("vis"))};a.toggleBlockUser=function(b,a){a?(c.html(MCK_LABELS.blocked),c.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),
e.removeClass("vis").addClass("n-vis"),l.removeClass("mck-tab-title-w-status"),f.removeClass("vis").addClass("n-vis"),n.removeClass("vis").addClass("n-vis"),t.data("blocked",!0),q.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"])):(c.html(""),c.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),e.removeClass("n-vis").addClass("vis"),t.data("blocked",!1),q.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),Fa[b]||!h.MCK_OL_MAP[b]&&!U[b]||(h.MCK_OL_MAP[b]?
f.attr("title",MCK_LABELS.online).html(MCK_LABELS.online):U[b]&&(b=mckDateUtils.getLastSeenAtStatus(U[b]),f.html(b),f.attr("title",b)),l.addClass("mck-tab-title-w-status"),f.removeClass("n-vis").addClass("vis")))}};new function(){var a=b("#mck-msg-to");b("#mck-btn-loc");var e=b("#mck-loc-box"),c=b("#mck-msg-sbmt"),l=b("#mck-msg-error"),f=b("#mck-loc-submit"),n=b("#mck-msg-response"),q=b("#mck_response_text"),t=b("#mck-message-cell .mck-message-inner");f.on("click",function(){var b={type:5,contentType:2,
message:h.JSON.stringify(mckMapUtils.getSelectedLocation())},f=t.data("mck-conversationid"),k=t.data("mck-topicid");f?b.conversationId=f:k&&(f={topicId:k},k=I[k],"object"===typeof k&&(f.topicDetail=h.JSON.stringify(k)),b.conversationPxy=f);!0===t.data("isgroup")?b.groupId=a.val():b.to=a.val();c.attr("disabled",!0);l.removeClass("vis").addClass("n-vis");l.html("");q.html("");n.removeClass("vis").addClass("n-vis");v.sendMessage(b);e.mckModal("hide")})};var t=new function(){var a=this,c={0:"User",1:"Admin",
2:"Moderator",3:"Member"},l=b("#mck-msg-form"),x=b("#mck-msg-error"),f=b("#mck-tab-title"),G=b("#mck-tab-status"),q=b("#mck-no-gsm-text"),y=b("#mck-gms-loading"),ca=b("#mck-contact-loading");b("#mck-tab-menu-box");b("#mck-search-loading");var B=b("#mck-group-info-tab"),P=b("#mck-sidebox-search");b("#mck-group-name-box");var X=b("#mck-group-back-link"),Ba=b("#mck-group-name-edit"),Ta=b("#mck-group-name-save"),A=b("#mck-sidebox-content"),D=b("#mck-tab-option-panel"),C=b("#mck-btn-group-create"),m=b("#mck-group-create-tab"),
Q=b("#mck-contacts-content"),L=b("#mck-btn-group-update"),R=b("#mck-group-create-type"),Ma=b("#mck-group-icon-upload"),Jb=b("#mck-group-icon-change"),Kb=b("#mck-group-member-list"),H=b("#mck-group-update-panel"),E=b(".mck-tab-message-option"),M=b("#mck-group-create-title"),Ia=b(".mck-group-menu-options"),mc=b("#mck-group-member-search"),pa=b("#mck-btn-group-icon-save");b("#mck-group-info-icon-box");var ib=b(".mck-group-admin-options"),pb=b("#mck-group-add-member-box"),S=b("#mck-message-cell .mck-message-inner"),
qa=b("#mck-group-name-sec .mck-group-title");b("#mck-group-create-icon-box");var nc=b("#mck-group-info-icon-loading"),V=b("#mck-gm-search-box");b("#mck-group-member-search-list");var F=b("#mck-group-create-icon-loading"),T=b("#mck-group-info-icon-box .mck-group-icon"),K=b("#mck-group-create-icon-box .mck-group-icon"),Y=b("#mck-group-create-icon-box .mck-overlay-box"),ha=b("#mck-gc-overlay-label");b.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
b.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b(".mck-group-name-box div[contenteditable]").keypress(function(e){if(8===e.which||37===e.keyCode||38===e.keyCode||39===e.keyCode||40===e.keyCode||e.ctrlKey&&97===e.which)return!0;if(13!==e.keyCode||e.shiftKey||e.ctrlKey)return 30>this.innerHTML.length;b(e.target).hasClass("mck-group-create-title")&&a.submitCreateGroup();return!1}).on("paste",function(b){var a=this;setTimeout(function(){30<a.innerText.length&&(a.innerHTML=a.innerText.substring(0,30),mckUtils.setEndOfContenteditable(a));return!1},
"fast")}).on("drop",function(b){b.preventDefault();b.stopPropagation()});b(n).on("click",".mck-btn-change-role",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var e=b(this).parents(".mck-li-group-member").data("role");a.find("select").val(e);a.removeClass("n-vis").addClass("vis");H.removeClass("n-vis").addClass("vis")});L.on("click",function(){var a=[];b(".mck-group-change-role-box.vis").each(function(e,db){e=b(this);db=parseInt(e.find("select").val());
var f=e.parents(".mck-li-group-member").data("role");db!==f&&(e={userId:e.parents(".mck-li-group-member").data("mck-id"),role:db},a.push(e))});if(0<a.length){var e=S.data("mck-id"),f=S.data("isgroup");e&&f&&(L.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),mckGroupService.updateGroupInfo({groupId:e,users:a,apzCallback:t.onUpdateGroupInfo}))}});b("#mck-group-info-icon-box .mck-overlay").on("click",function(b){Jb.trigger("click")});b("#mck-group-create-icon-box .mck-overlay").on("click",
function(b){Ma.trigger("click")});b(n).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var a=b(this);0===a.find(".mck-group-icon-default").length&&a.find(".mck-overlay-box").addClass("n-vis")});b(n).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",
function(){b(this).find(".mck-overlay-box").addClass("n-vis")});Ba.on("click",function(){qa.attr("contenteditable",!0).focus();mckUtils.setEndOfContenteditable(qa[0]);Ta.removeClass("n-vis").addClass("vis");Ba.removeClass("vis").addClass("n-vis")});Ta.on("click",function(){var a=b.trim(qa.text());if(0<a.length){var e=S.data("mck-id"),f=S.data("isgroup");e&&f&&(Ba.removeClass("n-vis").addClass("vis"),Ta.removeClass("vis").addClass("n-vis"),qa.attr("contenteditable",!1),mckGroupService.updateGroupInfo({groupId:e,
name:a,apzCallback:t.onUpdateGroupInfo}))}else qa.addClass("mck-req-border")});pa.on("click",function(){var b=T.data("iconurl");if(b){var a=S.data("mck-id"),e=S.data("isgroup");a&&e&&(setTimeout(function(){pa.removeClass("vis").addClass("n-vis")},1E3),T.data("iconurl",""),mckGroupService.updateGroupInfo({groupId:a,imageUrl:b,apzCallback:t.onUpdateGroupInfo}))}else qa.addClass("mck-req-border")});C.on("click",function(){a.submitCreateGroup()});a.submitCreateGroup=function(){var a=b.trim(M.text()),
e=R.val(),f=K.data("iconurl");0<a.length?(a={groupName:a},e&&(e=parseInt(e),-1!==wb.indexOf(e)&&(a.type=e)),f&&(a.groupIcon=f),K.data("iconurl",""),a.isInternal=!0,C.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),v.getGroup(a)):M.addClass("mck-req-border")};a.loadGroups=function(a){a=a.data;Qa.length=0;b.each(a,function(b,a){"undefined"!==typeof a.id&&(a=mckGroupUtils.addGroup(a),Qa.push(a))})};a.getDeletedAtTime=function(b){if("object"===typeof MCK_GROUP_MAP[b])return MCK_GROUP_MAP[b].deletedAtTime};
a.getGroupDisplayName=function(b){if("object"===typeof MCK_GROUP_MAP[b]){b=MCK_GROUP_MAP[b];var a=b.displayName;if(7===b.type){var f=e.getContactFromGroupOfTwo(b);"undefined"!==typeof f&&(a=e.getTabDisplayName(f.contactId,!1))}3===b.type&&-1!==a.indexOf(z)&&(a=a.replace(z,"").replace(":",""),"function"===typeof Xa&&(a=(f=Xa(a))?f:a));a||5!==b.type||(a="Broadcast");a||(a=b.contactId);return a}return b};a.getGroupImage=function(b){return b?'\x3cimg src\x3d"'+b+'"/\x3e':'\x3cimg src\x3d"'+MCK_BASE_URL+
'/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'};a.getGroupDefaultIcon=function(){return'\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'};a.addMemberToGroup=function(b,a){"object"===typeof b.members&&(-1===b.members.indexOf(a)&&b.members.push(a),"object"===typeof b.removedMembersId&&-1!==b.removedMembersId.indexOf(a)&&b.removedMembersId.splice(b.removedMembersId.indexOf(a),1),MCK_GROUP_MAP[b.contactId]=b);return b};a.removeMemberFromGroup=function(b,a){"object"!==typeof b.removedMembersId||
1>b.removedMembersId.length?(b.removedMembersId=[],b.removedMembersId.push(a)):-1===b.removedMembersId.indexOf(a)&&b.removedMembersId.push(a);return MCK_GROUP_MAP[b.contactId]=b};a.authenticateGroupUser=function(b){if(!a.isGroupLeft(b)&&0<b.members.length)for(var e=0;e<b.members.length;e++)if(z===""+b.members[e])return!0;return!1};a.isAppendOpenGroupContextMenu=function(b){return 0!==ia.deleteChatAccess&&a.authenticateGroupUser(b)?b.adminName===z||2===ia.deleteChatAccess?!0:!1:!1};a.validateOpenGroupUser=
function(b){if(6===b.type){if(!a.authenticateGroupUser(b)){if(ia.disableChatForNonGroupMember){var e=ia.defaultChatDisabledMessage;e||(e="Chat disabled");x.html(e);x.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");f.removeClass("mck-tab-title-w-status");G.removeClass("vis").addClass("n-vis")}Ia.removeClass("vis").addClass("n-vis");E.removeClass("vis").addClass("n-vis");D.removeClass("vis").addClass("n-vis");"undefined"===typeof ub[b.contactId]&&W.subscribeToOpenGroup(b)}b.adminName===
z?0===ia.deleteChatAccess&&E.removeClass("vis").addClass("n-vis"):(ia.allowInfoAccessGroupMembers||Ia.removeClass("vis").addClass("n-vis"),2!==ia.deleteChatAccess&&E.removeClass("vis").addClass("n-vis"),ia.allowInfoAccessGroupMembers||2===ia.deleteChatAccess||D.removeClass("vis").addClass("n-vis"));return!1}return!0};a.addGroupStatus=function(b){var c=a.isGroupLeft(b);if(6!==b.type&&(c||Tb)){if(c)t.onGroupLeft("",{groupId:b.contactId});f.removeClass("mck-tab-title-w-status");G.removeClass("vis").addClass("n-vis")}else if(0<
b.members.length){c="";for(var h=!1,m=30>=b.members.length?b.members.length:25,k=0;k<m;k++)if(z===""+b.members[k]||-1!==b.removedMembersId.indexOf(b.members[k]))h=!0;else{var l=e.fetchContact(""+b.members[k]);l=e.getTabDisplayName(l.contactId,!1);c+=" "+l+","}if(5!==b.type&&6!==b.type||h&&5!==b.type)c+=" You";30<b.members.length&&(c+=" and "+(b.members.length-25)+" more");c=c.replace(/,\s*$/,"");G.html(c);G.attr("title",c);G.removeClass("n-vis").addClass("vis");f.addClass("mck-tab-title-w-status");
Ia.removeClass("n-vis").addClass("vis")}else f.removeClass("mck-tab-title-w-status"),G.removeClass("vis").addClass("n-vis");7===b.type&&(G.html(""),Ia.removeClass("vis").addClass("n-vis"))};a.disableGroupTab=function(){x.html(MCK_LABELS["group.chat.disabled"]);x.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");f.removeClass("mck-tab-title-w-status");G.removeClass("vis").addClass("n-vis")};a.isGroupLeft=function(a){var e=!1;a.removedMembersId&&0<a.removedMembersId.length&&
b.each(a.removedMembersId,function(b,a){a===z&&(e=!0)});return e};a.onGroupLeft=function(b,e){ca.removeClass("vis").addClass("n-vis");if("object"===typeof b&&"error"===b.status)alert("Unable to process your request. "+b.errorMessage);else if(b=e.groupId,B.hasClass("vis"))e=B.data("mck-id"),b===e&&X.trigger("click");else if(A.hasClass("vis")){e=S.data("mck-id");var f=S.data("isgroup");e===b.toString()&&f&&(Ia.removeClass("vis").addClass("n-vis"),a.disableGroupTab())}};a.onAddedGroupMember=function(f,
c){ca.removeClass("vis").addClass("n-vis");if("object"===typeof f&&"error"===f.status)alert("Unable to process your request. "+f.errorMessage);else{var h=c.groupId,k=c.userId;f="";h?f=mckGroupUtils.getGroup(h):c.clientGroupId&&(f=mckGroupUtils.getGroupByClientGroupId(c.clientGroupId));"object"===typeof f?(f=a.addMemberToGroup(f,k),B.hasClass("vis")?(c=B.data("mck-id"),h===c&&(h=e.fetchContact(""+k),0===b("#li-gm-"+h.htmlId).length&&a.addGroupMember(f,h),a.sortGroupMemberHtmlList(),a.enableGroupAdminMenuToggle())):
A.hasClass("vis")&&(c=S.data("mck-id"),k=S.data("isgroup"),c===h.toString()&&k&&a.addGroupStatus(f))):mckGroupService.getGroupFeed({groupId:h,clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed})}};a.onRemovedGroupMember=function(f,c){ca.removeClass("vis").addClass("n-vis");if("object"===typeof f&&"error"===f.status)alert("Unable to process your request. "+f.errorMessage);else{f=c.groupId;var h=c.userId,k="";f?k=mckGroupUtils.getGroup(f):c.clientGroupId&&(k=mckGroupUtils.getGroupByClientGroupId(c.clientGroupId));
"object"===typeof k?(k=a.removeMemberFromGroup(k,h),B.hasClass("vis")?(k=B.data("mck-id"),f===k&&(f=e.fetchContact(""+h),f=b("#li-gm-"+f.htmlId),0<f.length&&f.remove())):A.hasClass("vis")&&(c=S.data("mck-id"),h=S.data("isgroup"),c===f.toString()&&h&&a.addGroupStatus(k))):mckGroupService.getGroupFeed({groupId:f,clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed})}};a.onGroupFeed=function(f,c){ca.removeClass("vis").addClass("n-vis");if("success"===f.status){f=f.data;var h=f.conversationPxy,k=mckGroupUtils.getGroup(f.id);
f.deletedAtTime&&(x.html(MCK_LABELS["group.deleted"]),x.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),l.removeClass("vis").addClass("n-vis"));var m=[];"object"===typeof h&&(N[h.id]=h,sa[h.topicId]=[h.id],h.topicDetail&&(I[h.topicId]=b.parseJSON(h.topicDetail)),m.push(h));0<m.length&&(Z[c.groupId]=m);aa.loadUserProfiles(f.membersId);c.isMessage&&"object"===typeof c.message&&e.populateMessage(c.messageType,c.message,c.notifyUser);c.isReloadTab&&a.reloadGroupTab(k)}};a.onUpdateGroupInfo=
function(e,c){ca.removeClass("vis").addClass("n-vis");L.attr("disabled",!1).html("Update");H.removeClass("vis").addClass("n-vis");if("object"===typeof e&&"error"===e.status)alert("Unable to process your request. "+e.errorMessage);else{e=c.groupId;c=c.groupInfo;var h=mckGroupUtils.getGroup(e);if("object"===typeof h){c.imageUrl&&(h.imageUrl=c.imageUrl);c.newName&&(h.displayName=c.newName);c.users&&0<c.users.length&&b.each(c.users,function(b,a){a.userId&&(h.users[a.userId]=a)});if(B.hasClass("vis"))c.imageUrl&&
T.html(a.getGroupImage(h.imageUrl)),qa.html(h.displayName),c.users&&0<c.users.length&&(Kb.html(""),a.addMembersToGroupInfoList(h),h.adminName===z?pb.removeClass("n-vis").addClass("vis"):pb.removeClass("vis").addClass("n-vis"));else if(A.hasClass("vis")){var k=S.data("mck-id"),m=S.data("isgroup");k===e.toString()&&m?f.html(h.displayName):0<b("#li-group-"+h.htmlId).length&&(b("#li-group-"+h.htmlId+" .mck-cont-name strong").html(h.displayName),c.imageUrl&&b("#li-group-"+h.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+
h.imageUrl+"'\x3e"))}MCK_GROUP_MAP[h.contactId]=h}}};a.getGroupFeedFromMessage=function(b){var a=b.message;if(a){b.groupId=a.groupId;b.isMessage=!0;if(a.conversationId){var e=N[a.conversationId];if("object"!==typeof e||"object"!==typeof I[e.topicId])b.conversationId=a.conversationId}b.apzCallback=t.onGroupFeed;mckGroupService.getGroupFeed(b)}};a.reloadGroupTab=function(b){var e=S.data("mck-id"),f=S.data("isgroup");e===b.contactId.toString()&&f&&a.addGroupStatus(b)};a.loadGroupTab=function(a){"error"===
a.status?alert("Unable to process your request. "+a.errorMessage):(e.loadTab({tabId:a.data.contactId,isGroup:!0}),b("#mck-search").val(""))};a.addMembersToGroupInfoList=function(f){var c=f.members;c.sort();Kb.html("");b.each(c,function(c,h){h&&(c=e.fetchContact(""+h),0===b("#li-gm-"+c.htmlId).length&&a.addGroupMember(f,c))});a.sortGroupMemberHtmlList();a.enableGroupAdminMenuToggle()};a.enableGroupAdminMenuToggle=function(){b(".mck-group-member-info").bind("mouseenter",function(){b(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",
function(){b(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};a.addGroupMember=function(a,f){var k="n-vis",m="n-vis",l=a.users[f.contactId],R="Member",L=3;l&&"undefined"!==typeof l.role&&(L=l.role,R=c[l.role]);l=e.getTabDisplayName(f.contactId,!1);f.contactId===a.adminName&&(k="vis");a.adminName===z&&(m="vis");f.contactId===z&&(l="You",m="n-vis");a=e.getContactImageLink(f,l);var x="";na[f.contactId]||(h.MCK_OL_MAP[f.contactId]?x=MCK_LABELS.online:U[f.contactId]&&(x=mckDateUtils.getLastSeenAtStatus(U[f.contactId])));
f=[{roleExpr:R,roleVal:L,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:f.htmlId,contIdExpr:f.contactId,contImgExpr:a,contLastSeenExpr:x,contNameExpr:l,contFirstAlphaExpr:l.charAt(0).toUpperCase(),isAdminExpr:k,enableAdminMenuExpr:m}];b.tmpl("groupMemberTemplate",f).appendTo("#mck-group-member-list")};a.addMembersToGroupSearchList=function(){var f=S.data("mck-id");if(S.data("isgroup")){var c=mckGroupUtils.getGroup(f),h=Sa,k=[];h=h.filter(function(b,
a){return h.indexOf(b)===a});h.sort();var m=c.members;b.each(h,function(b,f){f&&(b=e.fetchContact(""+f),-1===m.indexOf(b.contactId)||-1!==m.indexOf(b.contactId)&&-1!==c.removedMembersId.indexOf(b.contactId))&&(a.addGroupSearchMember(b),k.push(b))});a.enableGroupAdminMenuToggle();0<k.length?q.removeClass("vis").addClass("n-vis"):q.removeClass("n-vis").addClass("vis");e.initAutoSuggest({contactsArray:k,$searchId:mc,isContactSearch:!1})}y.removeClass("vis").addClass("n-vis")};a.addGroupSearchMember=
function(a){var f=e.getTabDisplayName(a.contactId,!1),c=e.getContactImageLink(a,f),k="user-"+a.htmlId,m="";na[a.contactId]||(h.MCK_OL_MAP[a.contactId]?m=MCK_LABELS.online:U[a.contactId]&&(m=mckDateUtils.getLastSeenAtStatus(U[a.contactId])));b.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:k,contIdExpr:a.contactId,contImgExpr:c,contLastSeenExpr:m,contNameExpr:f}]).appendTo("#mck-group-member-search-list")};a.loadCreateGroupTab=function(){Q.removeClass("vis").addClass("n-vis");A.removeClass("vis").addClass("n-vis");
P.removeClass("vis").addClass("n-vis");B.removeClass("vis").addClass("n-vis");F.removeClass("vis").addClass("n-vis");K.data("iconurl","");M.html("");Y.removeClass("n-vis");ha.html(MCK_LABELS["add.group.icon"]);K.html(a.getGroupDefaultIcon());m.removeClass("n-vis").addClass("vis")};a.loadGroupInfo=function(b){if(b.groupId){qa.attr("contenteditable",!1);Ta.removeClass("vis").addClass("n-vis");Ba.removeClass("n-vis").addClass("vis");Q.removeClass("vis").addClass("n-vis");A.removeClass("vis").addClass("n-vis");
P.removeClass("vis").addClass("n-vis");H.removeClass("vis").addClass("n-vis");m.removeClass("vis").addClass("n-vis");pa.removeClass("vis").addClass("n-vis");nc.removeClass("vis").addClass("n-vis");B.removeClass("n-vis").addClass("vis");B.data("mck-id",b.groupId);T.data("iconurl","");b.conversationId&&B.data("mck-conversation-id",b.conversationId);Kb.html("");var e=mckGroupUtils.getGroup(b.groupId);"object"===typeof e?(T.html(a.getGroupImage(e.imageUrl)),qa.html(e.displayName),a.addMembersToGroupInfoList(e),
e.adminName===z?pb.removeClass("n-vis").addClass("vis"):pb.removeClass("vis").addClass("n-vis")):mckGroupService.getGroupFeed({groupId:b.groupId,apzCallback:t.onGroupFeed})}};a.sortGroupMemberHtmlList=function(){b("#mck-group-member-list .mck-li-group-member").sort(function(b,a){return b.dataset.alpha>a.dataset.alpha}).appendTo("#mck-group-member-list")};a.addGroupMemberFromSearch=function(b){var a=B.data("mck-id");if("undefined"!==typeof a&&"undefined"!==typeof b){var e=mckGroupUtils.getGroup(a);
"object"===typeof e&&z===e.adminName?(aa.loadUserProfile(b),mckGroupService.addGroupMember({groupId:a,userId:b,apzCallback:t.onAddedGroupMember})):ib.removeClass("vis").addClass("n-vis")}V.mckModal("hide")}},ka=new function(){var a=this,c=["CREATE","UPDATE"],h=b("#mck-file-box"),l=b(".mck-overlay"),f=b("#mck-msg-sbmt"),G=b("#mck-text-box"),q=b("#mck-file-input"),t=b(".mck-overlay-box"),y=b(".mck-file-upload"),B=b("#mck-group-icon-upload"),P=b("#mck-group-icon-change"),v=b("#mck-group-info-icon-box"),
z=b("#mck-btn-group-icon-save"),A=b("#mck-message-cell .mck-message-inner"),I=b("#mck-group-create-icon-box"),N=b("#mck-group-info-icon-loading"),C=b("#mck-group-create-icon-loading"),m=b("#mck-group-info-icon-box .mck-group-icon"),Q=b("#mck-group-create-icon-box .mck-group-icon"),L=b("#mck-gc-overlay-label");b.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"progress progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"progress-bar progress-bar-success bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
a.init=function(){y.on("click",function(){q.trigger("click")});B.on("change",function(){var e=b(this)[0].files[0];a.uplaodFileToAWS(e,c[0]);return!1});P.on("change",function(){var e=b(this)[0].files[0];a.uplaodFileToAWS(e,c[1]);return!1});q.on("change",function(){var e=b(this)[0].files[0],f={};f.file=e;f.name=e.name;a.uploadFile(f)});b(n).on("click",".mck-remove-file",function(){var e=b(this).parents(".mck-file-box"),c=e.data("mckfile");e.remove();f.attr("disabled",!1);0===h.find(".mck-file-box").length&&
(h.removeClass("vis").addClass("n-vis"),G.attr("required",""));"object"===typeof c&&(a.deleteFileMeta(c.blobKey),b.each(D,function(b,a){"undefined"!==typeof a&&a.blobKey===c.blobKey&&D.splice(b,1)}))})};a.audioRecoder=function(c){var k=c.file,m=[];if("undefined"!==typeof k)if(4<b(".mck-file-box").length&&m.push("Can't upload more than 5 files at a time"),k.size>1048576*ya&&m.push("file size can not be more than "+ya+" MB"),0<m.length)alert(m.toString());else{m=mckUtils.randomId();var l=[{fileIdExpr:m,
fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:a.getFilePreviewSize(k.size)}];b.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var L=b(".mck-file-box."+m),R=b(".mck-file-box."+m+" .mck-file-lb"),x=b(".mck-file-box."+m+" .progress .bar"),q=b(".mck-file-box."+m+" .progress"),n=b(".mck-file-box."+m+" .mck-remove-file");x.css("width","0%");q.removeClass("n-vis").addClass("vis");n.attr("disabled",!0);y.attr("disabled",!0);h.removeClass("n-vis").addClass("vis");
if(c.name===b(".mck-file-box."+m+" .mck-file-lb a").html()){var B=A.data("mck-id");oa[c.name+k.size]=B;f.attr("disabled",!0);c=[];c.push(k);var Q=new XMLHttpRequest;(Q.upload||Q).addEventListener("progress",function(b){b=parseInt(b.loaded/b.total*100,10);x.css("width",b+"%")});Q.addEventListener("load",function(c){c=b.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var h=a.getFilePreviewPath(c),m=c.name,k=c.size,l=A.data("mck-id");m+=k;k=oa[m];if(B!==l)e.updateDraftMessage(k,
c),delete oa[m];else return n.attr("disabled",!1),y.attr("disabled",!1),f.attr("disabled",!1),delete oa[m],R.html(h),q.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),G.removeAttr("required"),D.push(c),L.data("mckfile",c),y.children("input").val(""),!1}else n.attr("disabled",!1),f.attr("disabled",!1),n.trigger("click")});b.ajax({type:"GET",url:E+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(b){var a=
new FormData;a.append("files[]",k);Q.open("POST",b,!0);Q.send(a)},error:function(){}})}return!1}};a.uploadFile=function(c){var m=c.file,k=[];if("undefined"!==typeof m)if(4<b(".mck-file-box").length&&k.push("Can't upload more than 5 files at a time"),m.size>1048576*ya&&k.push("file size can not be more than "+ya+" MB"),0<k.length)alert(k.toString());else{k=mckUtils.randomId();var l=[{fileIdExpr:k,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:a.getFilePreviewSize(m.size)}];
b.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var L=b(".mck-file-box."+k),x=b(".mck-file-box."+k+" .mck-file-lb"),q=b(".mck-file-box."+k+" .progress .bar"),R=b(".mck-file-box."+k+" .progress"),n=b(".mck-file-box."+k+" .mck-remove-file");q.css("width","0%");R.removeClass("n-vis").addClass("vis");n.attr("disabled",!0);y.attr("disabled",!0);h.removeClass("n-vis").addClass("vis");if(c.name===b(".mck-file-box."+k+" .mck-file-lb a").html()){var Q=A.data("mck-id");oa[c.name+m.size]=Q;f.attr("disabled",
!0);c=[];c.push(m);var B=new XMLHttpRequest;(B.upload||B).addEventListener("progress",function(b){b=parseInt(b.loaded/b.total*100,10);q.css("width",b+"%")});B.addEventListener("load",function(c){c=b.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var h=a.getFilePreviewPath(c),k=c.name,m=c.size,l=A.data("mck-id");k+=m;m=oa[k];if(Q!==l)e.updateDraftMessage(m,c),delete oa[k];else return n.attr("disabled",!1),y.attr("disabled",!1),f.attr("disabled",!1),delete oa[k],x.html(h),
R.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),G.removeAttr("required"),D.push(c),L.data("mckfile",c),y.children("input").val(""),!1}else n.attr("disabled",!1),f.attr("disabled",!1),n.trigger("click")});b.ajax({type:"GET",url:E+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(b){var a=new FormData;a.append("files[]",m);B.open("POST",b,!0);B.send(a)},error:function(){}})}return!1}};a.uplaodFileToAWS=
function(b,a){var e=new FormData,f=[];"undefined"!==typeof b&&(-1===b.type.indexOf("image")&&f.push("Please upload image file."),0<f.length?alert(f.toString()):(l.attr("disabled",!0),c[0]===a?(I.find(".mck-overlay-box").removeClass("n-vis"),I.removeClass("mck-hover-on"),C.removeClass("n-vis").addClass("vis")):(v.find(".mck-overlay-box").removeClass("n-vis"),v.removeClass("mck-hover-on"),N.removeClass("n-vis").addClass("vis")),f=new XMLHttpRequest,f.addEventListener("load",function(b){if(b=this.responseText)c[0]===
a?(Q.html('\x3cimg src\x3d"'+b+'"/\x3e'),Q.data("iconurl",b),L.html(MCK_LABELS["change.group.icon"]),C.removeClass("vis").addClass("n-vis"),I.addClass("mck-hover-on")):(m.html('\x3cimg src\x3d"'+b+'"/\x3e'),m.data("iconurl",b),N.removeClass("vis").addClass("n-vis"),v.addClass("mck-hover-on"),setTimeout(function(){z.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){t.addClass("n-vis")},1500);l.attr("disabled",!1);c[0]===a?B.val(""):P.val("");return!1}),e.append("file",b),f.open("post",
MCK_BASE_URL+"/rest/ws/upload/file",!0),f.setRequestHeader("UserId-Enabled",!0),f.setRequestHeader("Authorization","Basic "+H),f.setRequestHeader("Application-Key",V),f.setRequestHeader("Device-Key",fa),O&&f.setRequestHeader("Access-Token",O),f.send(e)))};a.deleteFileMeta=function(b){mckUtils.ajax({url:E+"/rest/ws/aws/file/delete?key\x3d"+b,type:"post",success:function(){},error:function(){}})};a.getFilePreviewPath=function(b){return"object"===typeof b?'\x3ca href\x3d"'+E+"/rest/ws/aws/file"+b.blobKey+
'" target\x3d"_blank"\x3e'+b.name+"\x3c/a\x3e":""};a.getFilePreviewSize=function(b){return b?1048576<b?"("+parseInt(b/1048576)+" MB)":1024<b?"("+parseInt(b/1024)+" KB)":"("+parseInt(b)+" B)":""};a.addFileBox=function(a){var e=mckUtils.randomId(),c="";"object"===typeof a.fileMeta&&(e=a.fileMeta.createdAtTime,c=a.fileMeta.name);b.tmpl("fileboxTemplate",[{fileNameExpr:a.filelb,fileSizeExpr:a.filesize,fileIdExpr:e,fileName:c}]).appendTo("#mck-file-box");e=b(".mck-file-box."+e);c=e.find(".mck-remove-file");
var h=e.find(".progress");"object"===typeof a.fileMeta?(e.data("mckblob",a.fileMeta.blobKey),G.removeAttr("required"),f.attr("disabled",!1),c.attr("disabled",!1),h.removeClass("vis").addClass("n-vis"),D.push(a.fileMeta)):(f.attr("disabled",!0),c.attr("disabled",!0),h.removeClass("n-vis").addClass("vis"))}},e=new function(){var a=this,c="",l=b("#mck-search"),x=b("#mck-msg-to"),f=b(".mck-file-lb"),G=b(".mck-file-sz"),q=b("#mck-sidebox"),y=b("#mck-file-box"),ca=b("#mck-msg-sbmt"),B=b("#mck-msg-form"),
P=b("#mck-text-box"),X=b("#mck-msg-error");b("#mck-show-more");var Ba=b("#mck-tab-title"),Ta=b("#mck-tab-status"),H=b("#mck-message-cell"),M=b(".mck-typing-box"),C=b("#mck-no-messages"),m=b("#mck-product-box"),Q=b(".mck-product-icon"),L=b(".mck-product-title"),R=b(".mck-product-subtitle"),Ma=b("#mck-product-box .mck-caret"),Jb=b(".mck-product-rt-up .mck-product-key"),V=b("#mck-contact-search-input-box"),F=b(".mck-product-rt-up .mck-product-value"),Y=b(".mck-product-rt-down .mck-product-key"),ia=b(".mck-product-rt-down .mck-product-value");
b("#li-mck-group-info");b("#li-mck-leave-group");var Ia=b("#mck-group-info-tab"),da=b("#mck-group-search-tab"),pa=b("#mck-no-search-groups"),ib=b("#mck-group-create-tab"),ma=b("#mck-group-search-list");b("#mck-group-search-tabview");var S=b(".mck-group-menu-options"),qa=b(".mck-videocall-btn"),sa=b("#mck-group-search-input"),oa=b("#mck-group-search-input-box"),la=b("#mck-contact-search-list"),ea=b("#mck-contacts-content"),fa=b("#mck-contact-search-tab");b("#mck-contact-search-tabview");var va=b("#mck-contact-search-input");
b("#mck-search-list");var O=b("#mck-no-search-contacts"),db=b("#mck-search-tab-box li a"),ta=b("#mck-search-tabview-box"),ja=b("#mck-sidebox-search"),za=b("#mck-contact-loading"),Ja=b("#mck-typing-label"),r=b("#mck-price-widget"),Ca=b("#mck-msg-response"),xa=b("#mck_response_text"),ya=b("#li-mck-block-user"),Va=b("#li-mck-video-call"),Ua=b("#mck-search-loading"),Da=b("#mck-tab-individual"),dc=b("#mck-attachfile-box"),d=b("#mck-attachmenu-box"),p=b("#mck-sidebox-content"),u=b("#mck-tab-option-panel"),
wa=b("#mck-tab-conversation"),Ya=b("#mck-conversation-header"),eb=b("#mck-no-conversations"),Za=b("#mck-conversation-list"),$a=b(".mck-tab-message-option"),jb=b(".mck-box-ft .mck-box-form"),ec=b("#mck-btn-clear-messages"),Lb=b("#mck-offline-message-box"),w=b("#mck-message-cell .mck-message-inner");b("#mck-msg-new");var Mb=new RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);b.template("convTemplate",'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}" data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d "move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${nameTextExpr} ${showNameExpr}"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}" data-filename\x3d"${fileNameExpr}" data-fileurl\x3d "${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward ${msgForwardVisibleExpr}"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
b.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.openConversation=function(){"none"===q.css("display")&&(b(".mckModal").mckModal("hide"),q.mckModal());x.focus()};a.initEmojis=function(){try{b("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(g){c||(c=setTimeout(function(){a.initEmojis()},3E4))}};a.loadTab=function(g,J){var c=w.data("mck-id");if(c)if(1<P.html().length||y.hasClass("vis")){var f={text:P.html(),files:[]};y.hasClass("vis")&&b(".mck-file-box").each(function(){var a=b(this),g={filelb:a.find(".mck-file-lb").html(),
filesize:a.find(".mck-file-sz").html()};a=a.data("mckfile");"object"===typeof a&&(g.fileMeta=a);f.files.push(g)});La[c]=f}else delete La[c];Ea=!0;a.clearMessageField(!1);a.addDraftMessage(g.tabId);X.html("");X.removeClass("vis").addClass("n-vis");xa.html("");Ca.removeClass("vis").addClass("n-vis");B[0].reset();B.removeClass("n-vis").addClass("vis");w.html("");X.removeClass("mck-no-mb");ea.removeClass("n-vis").addClass("vis");jb.removeClass("vis").addClass("n-vis");ja.removeClass("vis").addClass("n-vis");
Ia.removeClass("vis").addClass("n-vis");ib.removeClass("vis").addClass("n-vis");p.removeClass("n-vis").addClass("vis");m.removeClass("vis").addClass("n-vis");Ya.addClass("n-vis");za.removeClass("vis").addClass("n-vis");w.removeClass("mck-group-inner");Ta.removeClass("vis").addClass("n-vis");Ba.removeClass("mck-tab-title-w-status");Ba.removeClass("mck-tab-title-w-typing");M.removeClass("vis").addClass("n-vis");Ja.html(MCK_LABELS.typing);w.data("isgroup",g.isGroup);w.data("datetime","");if(g.tabId)x.val(g.tabId),
w.data("mck-id",g.tabId),w.data("mck-conversationid",g.conversationId),w.data("mck-topicid",g.topicId),u.data("tabId",g.tabId),u.removeClass("n-vis").addClass("vis"),ea.removeClass("vis").addClass("n-vis"),jb.removeClass("n-vis").addClass("vis"),ec.removeClass("n-vis").addClass("vis"),S.removeClass("vis").addClass("n-vis"),g.isGroup?(w.addClass("mck-group-inner"),ya.removeClass("vis").addClass("n-vis"),Va.removeClass("vis").addClass("n-vis"),qa.removeClass("vis").addClass("n-vis")):(ya.removeClass("n-vis").addClass("vis"),
Va.removeClass("n-vis").addClass("vis"),Oa&&qa.removeClass("n-vis").addClass("vis")),!g.topicId&&g.conversationId&&(c=N[g.conversationId],"object"===typeof c&&(g.topicId=c.topicId)),g.topicId&&(c=I[g.topicId],"object"===typeof c&&(Aa?(w.data("mck-title",c.title),Ya.html(c.title),Ya.removeClass("n-vis")):Ka&&(a.setProductProperties(c,g.topicId),Ma.addClass("n-vis"),m.addClass("mck-product-box-wc"),Za.addClass("n-vis"),m.removeClass("n-vis").addClass("vis")))),bb&&h.google&&"object"===typeof h.google.maps?
(dc.removeClass("vis").addClass("n-vis"),d.removeClass("n-vis").addClass("vis")):(d.removeClass("vis").addClass("n-vis"),dc.removeClass("n-vis").addClass("vis")),c=a.getTabDisplayName(g.tabId,g.isGroup,g.userName),a.isGroupDeleted(g.tabId,g.isGroup)&&(X.html(MCK_LABELS["group.deleted"]),X.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),B.removeClass("vis").addClass("n-vis")),Ba.html(c),Ba.attr("title",c),wa.removeClass("vis").addClass("n-vis"),ta.removeClass("vis").addClass("n-vis"),Da.removeClass("n-vis").addClass("vis"),
"support"===tb&&b(".mck-tab-link").removeClass("vis").addClass("n-vis"),Db&&(r.removeClass("n-vis").addClass("vis"),w.addClass("mck-msg-w-panel")),fb&&(X.html("Deactivated"),X.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),B.removeClass("vis").addClass("n-vis")),W.subscibeToTypingChannel(g.tabId,g.isGroup),"function"===typeof Ab&&Ab({tabId:g.tabId,isGroup:g.isGroup});else if(g.tabId="",gb&&e.hideOfflineMessage(),Da.removeClass("vis").addClass("n-vis"),wa.removeClass("n-vis").addClass("vis"),
ta.removeClass("n-vis").addClass("vis"),m.removeClass("vis").addClass("n-vis"),w.data("mck-id",""),w.data("mck-conversationid",""),w.data("mck-topicid",""),r.removeClass("vis").addClass("n-vis"),w.removeClass("mck-msg-w-panel"),u.removeClass("vis").addClass("n-vis"),ec.removeClass("vis").addClass("n-vis"),x.val(""),c=A.getLatestMessageArray(),W.unsubscibeToTypingChannel(),null!==c&&0<c.length){g.isReload=!0;e.addContactsFromMessageList({message:c},g);a.openConversation();Ea=!1;return}v.loadMessageList(g,
J);a.openConversation()};a.setProductProperties=function(b,d){L.html(b.title);Q.html(a.getTopicLink(b.link));R.html(b.subtitle?b.subtitle:"");var g=b.value1?":"+b.value1:"";Jb.html(b.key1?b.key1:"");F.html(g);g=b.value2?":"+b.value2:"";Y.html(b.key2?b.key2:"");ia.html(g);"function"===typeof xb&&(b.topicId=d,xb(b))};a.getTopicLink=function(b){return b?'\x3cimg src\x3d"'+b+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};a.processMessageList=function(g,d,p){var c=w.children("div[name\x3d'message']:first"),
J=w.data("mck-id"),f=w.data("isgroup")?mckGroupUtils.getGroup(J):e.fetchContact(J);if("undefined"===typeof g.message.length){J=[];J.push(g.message);A.updateMckMessageArray(J);a.addMessage(g.message,f,!1,!1,p);var h=g.createdAtTime}else A.updateMckMessageArray(g.message),b.each(g.message,function(b,g){"undefined"!==typeof g.to&&(a.addMessage(g,f,!1,!1,p),h=g.createdAtTime)});u.data("datetime",h);!d&&0<c.length?w.scrollTop(c.offset().top-w.offset().top+w.scrollTop()):d&&w.animate({scrollTop:w.prop("scrollHeight")},
"fast")};a.closeConversation=function(b){if("function"===typeof zb){var a=zb();if("object"===typeof a)var g="BUSY_WITH_OTHER"===b?a.onBusyWithOtherUser:a.onConversationClose}g||(g="Chat disabled with user");X.html(g);X.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");B.removeClass("vis").addClass("n-vis")};a.addTooltip=function(a){b("."+a+" .mck-icon-time").attr("title","pending");b("."+a+" .mck-btn-trash").attr("title","delete");b("."+a+" .mck-icon-sent").attr("title","sent");b("."+a+" .mck-btn-forward").attr("title",
"forward message");b("."+a+" .mck-icon-delivered").attr("title","delivered");b("."+a+" .mck-icon-read").attr("title","delivered and read");b("."+a+" .msgtype-outbox-cr").attr("title","sent via Carrier");b("."+a+" .msgtype-outbox-mck").attr("title","sent");b("."+a+" .msgtype-inbox-cr").attr("title","received via Carrier");b("."+a+" .msgtype-inbox-mck").attr("title","recieved")};a.fetchContact=function(b){var g=a.getContact(b);"undefined"===typeof g&&(g=a.createContact(b));return g};a.getContact=function(b){if("object"===
typeof ra[b])return ra[b]};a.getContactDisplayName=function(b){if("string"===typeof ua[b])return ua[b];if("undefined"===typeof ua[b]&&(b=ha[b],"undefined"!==typeof b))return b.displayName};a.addMessage=function(g,d,p,c,f){var J="",u="",k="vis",m="n-vis",wa="",Nb="n-vis";if("object"===typeof g.metadata&&"undefined"!==typeof g.metadata.AL_REPLY){var Na=g.metadata.AL_REPLY;J=v.getReplyMessageByKey(Na);if("undefined"!==typeof J){if(d.isGroup&&J||!d.isGroup&&"undefined"===typeof J.fileMeta)Nb="vis";wa=
5===J.type?"You":e.getTabDisplayName(J.to,!1);if("object"===typeof J.fileMeta||2===J.contentType)u=a.getImageForReplyMessage(J),k="n-vis",m="vis",Nb="n-vis"}}if(6!==g.type&&7!==g.type&&!(g.metadata&&"HIDDEN"===g.metadata.category||102===g.contentType||10===g.contentType&&g.metadata&&"true"===g.metadata.hide||0<b("#mck-message-cell ."+g.key).length)){C.hasClass("vis")&&C.removeClass("vis").addClass("n-vis");var l="mck-msg-right";if(0===g.type||4===g.type||6===g.type)l="mck-msg-left";if(4===g.contentType||
10===g.contentType||103===g.contentType)l="mck-msg-center";var L=a.getStatusIconName(g);Na=g.key;var x="'"+g.deviceKey+"','"+g.to+"','"+g.to+"','"+Na+"'",q="",eb="",B="",Q="n-vis",G="";aa.loadUserProfile(g.to);!g.groupId||4===g.contentType||7===d.type||0!==g.type&&4!==g.type&&6!==g.type||(q=a.getTabDisplayName(g.to,!1),Q="vis",B=a.getNameTextClassByAlphabet(q));if(Sb){G="mck-msg-avator-bubble";var R="",r=q;"mck-msg-right"===l?(R=e.fetchContact(z),r=a.getTabDisplayName(R.displayName,!1)):"mck-msg-left"===
l&&(R=g.groupId?e.fetchContact(g.to):d);R&&(eb=a.getContactImageLink(R,r))}g.groupId&&10===g.contentType&&(B=eb=q="");d="n-vis";r=R="";var y=g.message;"object"===typeof g.fileMeta&&(R=g.fileMeta.name,r=g.fileMeta.size);"object"===typeof g.fileMeta&&(g.fileMeta.contentType.indexOf("audio")||g.fileMeta.contentType.indexOf("image")||g.fileMeta.contentType.indexOf("video"))&&(d="vis");var fc="n-vis";nb&&h.MCK_OL_MAP[g.to]&&10!==g.contentType&&(fc="vis");u=[{msgReply:J?J.message+"\n":"",msgReplyTo:J?wa+
"\n":"",msgReplyDivExpr:J?"vis":"n-vis",msgReplyToVisibleExpr:Nb,msgPreview:u?a.getImageForReplyMessage(J):"",msgpreviewvisExpr:m,textreplyVisExpr:k,msgKeyExpr:g.key,msgDeliveredExpr:g.delivered,msgSentExpr:g.sent,msgCreatedAtTime:g.createdAtTime,msgTypeExpr:g.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"kommunicate"==window.applozic.PRODUCT_ID?"n-vis":"vis",msgSourceExpr:g.source,statusIconExpr:L,contactExpr:"vis",
toExpr:g.to,msgAvatorClassExpr:G,showNameExpr:Q,msgNameExpr:q,msgImgExpr:eb,nameTextExpr:B,msgFloatExpr:l,replyIdExpr:Na,createdAtTimeExpr:mckDateUtils.getDate(g.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:x,downloadMediaUrlExpr:a.getFileAttachment(g),msgClassExpr:"",msgExpr:y,selfDestructTimeExpr:g.timeToLive,fileMetaKeyExpr:g.fileMetaKey,downloadIconVisibleExpr:d,fileExpr:a.getFilePath(g),fileUrlExpr:a.getFileurl(g),fileNameExpr:R,fileSizeExpr:r,contOlExpr:fc}];p?b.tmpl("messageTemplate",
u).appendTo("#mck-message-cell .mck-message-inner"):b.tmpl("messageTemplate",u).prependTo("#mck-message-cell .mck-message-inner");u="";g.message&&(u=g.message.replace(/\n/g,"\x3cbr/\x3e"),null!==h.emoji&&"undefined"!==typeof h.emoji&&(u=h.emoji.replace_unified(u),u=h.emoji.replace_colons(u)));g.conversationId&&(k=N[g.conversationId],"object"!==typeof k&&v.getTopicId({conversationId:g.conversationId}),p&&(w.data("mck-conversationid",g.conversationId),k&&(m=I[k.topicId],"object"===typeof m&&(Ka?a.setProductProperties(m,
k.topicId):Aa&&Ya.html(m.title)))));4===g.contentType&&(k=u,u="Final agreed price: "+u,Db||(u+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+k+'" data-mck-conversationid\x3d"'+g.conversationId+'"\x3eAccept\x3c/button\x3e'));k=b("."+Na+" .mck-msg-content");if(-1===u.indexOf("emoji-inner")&&0===g.contentType)for(u=u.split("\x3cbr/\x3e"),m=0;m<u.length;m++)wa=n.createElement("div"),wa.appendChild(n.createTextNode(u[m])),u[m]&&u[m].match(Mb)&&(wa=b(wa).linkify({target:"_blank"})),
k.append(wa);else k.html(u),k.linkify({target:"_blank"});g.fileMeta&&(b("."+Na+" .mck-file-text a:first").trigger("click"),b("."+Na+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===k.html()&&k.removeClass("vis").addClass("n-vis"));2===g.contentType&&(k.removeClass("vis").addClass("n-vis"),b("."+Na+" .mck-file-text").removeClass("n-vis").addClass("vis"));c&&w.animate({scrollTop:w.prop("scrollHeight")},"fast");$a.hasClass("n-vis")&&(g.groupId?6!==mckGroupUtils.getGroup(g.groupId).type&&
$a.removeClass("n-vis").addClass("vis"):$a.removeClass("n-vis").addClass("vis"));a.addTooltip(g.key);4!==g.contentType&&10!==g.contentType&&f&&a.messageContextMenu(g.key);g.groupId&&10===g.contentType&&p&&mckGroupService.getGroupFeed({groupId:g.groupId,isReloadTab:!0,apzCallback:t.onGroupFeed})}};a.addContactForSearchList=function(g,d){var e=g.userCount,p=g.isGroup,c=a.getTabDisplayName(g.contactId,p),J=a.getContactImageLink(g,c),f=p?"gs-group-"+g.htmlId:"cs-user-"+g.htmlId,u="",k=p&&Fb;b("#li-"+
f+" .mck-group-count-text").html(e);p||na[g.contactId]||(h.MCK_OL_MAP[g.contactId]?u=MCK_LABELS.online:U[g.contactId]&&(u=mckDateUtils.getLastSeenAtStatus(U[g.contactId])));b.tmpl("searchContactbox",[{contHtmlExpr:f,contIdExpr:g.contactId,contTabExpr:g.isGroup,contImgExpr:J,contLastSeenExpr:u,contNameExpr:c,groupUserCountExpr:g.userCount,displayGroupUserCountExpr:k?"vis":"n-vis"}]).prependTo("#"+d)};a.getFileurl=function(b){return"object"===typeof b.fileMeta?E+"/rest/ws/aws/file/"+b.fileMeta.blobKey:
""};a.getFilePath=function(a){if(2===a.contentType)try{var g=b.parseJSON(a.message);if(g.lat&&g.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+g.lat+","+g.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+g.lat+","+g.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+g.lat+","+g.lon+"\x26key\x3d"+Qb+'"/\x3e\x3c/a\x3e'}catch(Na){if(-1!==a.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+
a.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+a.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.message+"\x26key\x3d"+Qb+'" /\x3e\x3c/a\x3e'}return"object"===typeof a.fileMeta?-1!==a.fileMeta.contentType.indexOf("image")?-1!==a.fileMeta.contentType.indexOf("svg")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+a.fileMeta.contentType+
'" data-url\x3d"'+E+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+E+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':5===a.contentType?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+a.fileMeta.contentType+'" data-url\x3d"'+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+a.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':
'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+a.fileMeta.contentType+'" data-url\x3d"'+E+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+a.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':-1!==a.fileMeta.contentType.indexOf("video")?'\x3ca href\x3d "#" target\x3d"_self"  \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+E+
"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+E+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3ca href\x3d"#" target\x3d"_self" \x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+E+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+E+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':
'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e':""};a.getImageForMessagePreview=function(a){if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+E+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" class\x3d"mck-image-reply move-right"/\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ka.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ka.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===a.contentType)return a=b.parseJSON(a.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
a.lat+","+a.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.lat+","+a.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};a.getImageForReplyMessage=function(a){var g=e.getTabDisplayName(a.to,!1);if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+g+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+
E+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+g+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ka.getFilePreviewSize(a.fileMeta.size)+
"\x3c/span\x3e\x3c/span\x3e":'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+g+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ka.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===a.contentType)return a=b.parseJSON(a.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+
g+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+a.lat+","+a.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.lat+","+a.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};a.getFileAttachment=function(b){if("object"===typeof b.fileMeta)return-1!==
b.fileMeta.contentType.indexOf("image")||-1!==b.fileMeta.contentType.indexOf("audio")||b.fileMeta.contentType.indexOf("video"),'\x3ca href\x3d"'+E+"/rest/ws/aws/file/"+b.fileMeta.blobKey+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+b.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+ka.getFilePreviewSize(b.fileMeta.size)+
"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e"};a.getFileIcon=function(b){return b.fileMetaKey&&"object"===typeof b.fileMeta?-1!==b.fileMeta.contentType.indexOf("image")?'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eImage\x3c/span\x3e':-1!==b.fileMeta.contentType.indexOf("audio")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eAudio\x3c/span\x3e':-1!==b.fileMeta.contentType.indexOf("video")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eVideo\x3c/span\x3e':
'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eFile\x3c/span\x3e':""};a.getContactFromGroupOfTwo=function(b){for(var a=0;a<b.members.length;a++)if(z!==""+b.members[a])return e.fetchContact(""+b.members[a])};a.getContactImageLink=function(b,d){var g="";if(b.isGroup&&7!==b.type)g=t.getGroupImage(b.imageUrl);else{b.isGroup&&7===b.type&&1<b.members.length&&(b=a.getContactFromGroupOfTwo(b));if("function"===typeof Pa){var e=Pa(b.contactId);e&&"undefined"!==typeof e&&(g='\x3cimg src\x3d"'+
e+'"/\x3e')}g||(b.photoSrc?g='\x3cimg src\x3d"'+b.photoSrc+'"/\x3e':b.photoData?g='\x3cimg src\x3d"data:image/jpeg;base64,'+b.photoData+'"/\x3e':b.photoLink?g='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+b.photoLink+'"/\x3e':"bot"==b.contactId?g='\x3cimg src\x3d"https://www.kommunicate.io/android-chrome-192x192.png"/\x3e':(d||(d=b.displayName),g=a.getContactImageByAlphabet(d)))}return g};a.getContactImageByAlphabet=function(b){if("undefined"===typeof b||""===b)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';
b=b.charAt(0);return b.match(/^[a-zA-Z0-9]+$/)?(b=b.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+b+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+b+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};a.getNameTextClassByAlphabet=function(b){if("undefined"===typeof b||""===b)return"mck-text-user";b=b.toString();b=b.charAt(0);return b.match(/^[a-zA-Z0-9]+$/)?(b=b.toLowerCase(),"mck-text-"+
b):"mck-text-user"};a.addContactsFromMessageList=function(g,d){C.removeClass("vis").addClass("n-vis");if("null"===g+"")var e="";else eb.removeClass("vis").addClass("n-vis"),0==w.has(b("#mck-contact-list")).length&&w.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof g.message.length?(g.message.groupId?a.addGroupFromMessage(g.message):a.addContactsFromMessage(g.message),e=g.message.createdAtTime):b.each(g.message,
function(b,g){"undefined"!==typeof g.to&&(g.groupId?a.addGroupFromMessage(g,!0):a.addContactsFromMessage(g,!0),e=g.createdAtTime)}),w.data("datetime",e),d.isReload&&(g="",d.lastActiveTabId&&(d=d.isLastActiveTabGroup?"group-"+d.lastActiveTabId:"user-"+mckContactUtils.formatContactId(d.lastActiveTabId),g=b("#li-"+d)),0<g.length?w.animate({scrollTop:g.offset().top-w.offset().top+w.scrollTop()},"fast"):w.animate({scrollTop:0},0))};a.addGroupFromMessageList=function(g,d){"null"!==g+""&&(d&&w.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),
"undefined"===typeof g.message.length?a.addGroupFromMessage(g.message):b.each(g.message,function(b,g){"undefined"!==typeof g.to&&a.addGroupFromMessage(g,!0)}))};a.createContact=function(b){var g=a.getContactDisplayName(b);"undefined"===typeof g&&(g=b);g={contactId:b,htmlId:mckContactUtils.formatContactId(b),displayName:g,name:g+" \x3c"+b+"\x3e [Main]",value:b,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return ra[b]=g};a.createContactWithDetail=function(b){var g=b.displayName,
d=b.userId;g||(g=a.getContactDisplayName(d));"undefined"===typeof g?g=d:ua[d]=g;var e=b.photoLink?b.photoLink:"";e||(e=b.imageLink?b.imageLink:"");b=b.imageData?b.imageData:"";g={contactId:d,htmlId:mckContactUtils.formatContactId(d),displayName:g,name:g+" \x3c"+d+"\x3e [Main]",value:d,photoLink:"",photoSrc:e,photoData:b,email:"",unsaved:!0,isGroup:!1};return ra[d]=g};a.updateContactDetail=function(b,d){var g=d.displayName,e=d.userId;b.displayName&&b.displayName!==b.contactId||(g||(g=a.getContactDisplayName(e)),
"undefined"===typeof g?g=e:ua[e]=g,b.displayName=g);(g=d.photoLink)||(g=d.imageLink?d.imageLink:"");g&&!b.photoSrc&&(b.photoSrc=g);(d=d.imageData?d.imageData:"")&&!b.photoData&&(b.photoData=d);return ra[e]=b};a.addContactsFromMessage=function(b,d){var g=a.getUserIdFromMessage(b);if(0<g.length&&g[0])for(var e=0;e<g.length;e++){var p=a.fetchContact(""+g[e]);a.updateRecentConversationList(p,b,d)}};a.addGroupFromMessage=function(b,d){var g=b.groupId,e=mckGroupUtils.getGroup(""+g);"undefined"===typeof e&&
(e=mckGroupUtils.createGroup(g),mckGroupService.loadGroups({apzCallback:t.loadGroups}));a.updateRecentConversationList(e,b,d)};a.updateRecentConversationList=function(g,d,e){0<b("#mck-contact-list #li-"+(g.isGroup?"group-"+g.htmlId:"user-"+g.htmlId)).length?(b("#mck-contact-list #li-"+g.htmlId+" .mck-cont-msg-wrapper").is(":empty")||e)&&void 0!==d&&a.updateContact(g,d,"mck-contact-list"):a.addContact(g,"mck-contact-list",d)};a.addContactsToSearchList=function(){var g=[],d=[];b.each(Ra,function(b,
a){d.push(a.contactId)});var e=d.filter(function(b,a){return d.indexOf(b)===a});e.sort();Ua.removeClass("vis").addClass("n-vis");0<e.length?b.each(e,function(d,e){e&&(d=a.fetchContact(""+e),g.push(d),0===b("#li-cs-user-"+d.htmlId).length&&a.addContactForSearchList(d,"mck-contact-search-list"))}):O.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:g,$searchId:va,isContactSearch:!0})};a.initAutoSuggest=function(g){for(var d=g.contactsArray,p=g.$searchId,c=[],f,u={},h=[],k=0;k<d.length;k++){var m=
d[k];m.displayName=a.getTabDisplayName(m.contactId,m.isGroup);f=m.displayName?b.trim(m.displayName):b.trim(m.contactId);u[f]=m;c.push(f);h.push(f)}d=function(b){b=u[b];var a=b.displayName.split(" "),g=a.length,d=a[0],e="",p="";2===g?p=a[1]:3<=g&&(p=a[g-1],e=a[g-2]);a=new RegExp(this.query,"i");return a.test(b.displayName)||a.test(b.contactId)||a.test(e)||a.test(p)||a.test(b.email)||a.test(d+" "+p)};f=function(b){return u[b].displayName};h=function(b){b=u[b];g.isContactSearch?(e.loadTab({tabId:b.contactId,
isGroup:b.isGroup}),jb.removeClass("n-vis").addClass("vis")):t.addGroupMemberFromSearch(b.contactId)};p.hasClass("mck-typeahead")?(p.mcktypeahead().data("mcktypeahead").source=c,p.mcktypeahead().data("mcktypeahead").matcher=d,p.mcktypeahead().data("mcktypeahead").highlighter=f,p.mcktypeahead().data("mcktypeahead").updater=h):(p.addClass("mck-typeahead"),p.mcktypeahead({source:c,matcher:d,highlighter:f,updater:h}))};a.initSearchAutoType=function(){ac&&(va.keypress(function(b){if(13===b.which){if(b=
va.val())if(b="undefined"!==typeof b&&""!==b?b.toString():"")e.loadTab({tabId:b,isGroup:!1,isSearch:!0}),jb.removeClass("n-vis").addClass("vis");va.val("")}}),sa.keypress(function(b){if(13===b.which)return!0}),b(n).on("click",".mck-group-search-link",function(b){b.preventDefault();return!0}),b(n).on("click",".mck-contact-search-link",function(b){b.preventDefault();b=va.val();""!==b&&(e.loadTab({tabId:b,isGroup:!1,isSearch:!0}),jb.removeClass("n-vis").addClass("vis"));va.val("")}))};a.removeContact=
function(a){b("#li-"+(a.isGroup?"group-"+a.htmlId:"user-"+a.htmlId)).remove()};a.updateContact=function(g,d,e){var p=g.isGroup?"group-"+g.htmlId:"user-"+g.htmlId,c=b("#li-"+p),f=c.data("msg-time");if(d&&d.createdAtTime>f){f=a.getUnreadCount(d.groupId?"group_"+g.contactId:"user_"+g.contactId);g=a.getMessageTextForContactPreview(d,g,15);b("#li-"+p+" .mck-cont-msg-date").html("undefined"===typeof d.createdAtTime?"":mckDateUtils.getTimeOrDate(d?d.createdAtTime:"",!0));var u=b("#li-"+p+" .mck-cont-msg-wrapper");
u.html("");"object"===typeof g?u.append(g):u.html(g);d.conversationId&&(g=d.conversationId,u=N[g],"object"===typeof u&&(u=u.topicId)&&Aa&&(u=I[u],"object"===typeof u&&b("#li-"+p+" .mck-conversation-topic").html(u.title)),b("#li-"+p+" a").data("mck-conversationid",g));0<f&&(b("#li-"+p+" .mck-unread-count-text").html(f),b("#li-"+p+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));p=b("#"+e+" li:nth-child(1)").data("msg-time");c.data("msg-time",d.createdAtTime);("undefined"===typeof p||
(d?d.createdAtTime:"")>=p)&&0!==b("#mck-contact-list li").index(c)&&b("#"+e+" li:nth-child(1)").before(c)}};a.clearContactMessageData=function(a,d){a=mckContactUtils.formatContactId(a);d=d?"group-"+a:"user-"+a;b("#li-"+d+" .mck-cont-msg-date").html("");b("#li-"+d+" .mck-cont-msg-wrapper").html("")};a.addContact=function(d,p,c){var g=a.getMessageTextForContactPreview(c,d,100),f=d.userCount,u="",k=!1;if("undefined"!==typeof c){if(c.conversationId){u=c.conversationId;var m=N[u]}c.groupId&&(k=!0)}var J=
a.getTabDisplayName(d.contactId,k),wa=a.getContactImageLink(d,J),l=!1,L=a.getUnreadCount(k?"group_"+d.contactId:"user_"+d.contactId),Ya=0<L&&"mck-search-list"!==p?"vis":"n-vis",q="n-vis",w=k?"group-"+d.htmlId:"user-"+d.htmlId,x=k&&Fb;b("#li-"+w+" .mck-group-count-text").html(f);b("#li-"+w+" .mck-group-count-box").removeClass("n-vis").addClass("vis");k||na[d.contactId]||Fa[d.contactId]||!nb||!h.MCK_OL_MAP[d.contactId]||(q="vis",l=!0);7===d.type&&1<d.members.length&&(w=mckGroupUtils.getGroup(c.groupId),
w=e.getContactFromGroupOfTwo(w),k&&nb&&h.MCK_OL_MAP[w.contactId]&&(q="vis",l=!0));f="n-vis";if("object"===typeof m&&Aa&&(m=I[m.topicId],"object"===typeof m)){f="vis";var n=m.title}w=k?"group-"+d.htmlId:"user-"+d.htmlId;d=[{contHtmlExpr:w,contIdExpr:d.contactId,contTabExpr:k,msgCreatedAtTimeExpr:c?c.createdAtTime:"",mckLauncherExpr:ab,contImgExpr:wa,contOlExpr:q,onlineLabel:MCK_LABELS.online,contUnreadExpr:Ya,contUnreadCount:L,contNameExpr:J,conversationExpr:u,contHeaderExpr:f,titleExpr:n,groupUserCountExpr:k?
d.userCount:"",displayGroupUserCountExpr:x?"vis":"n-vis",msgCreatedDateExpr:c?mckDateUtils.getTimeOrDate(c.createdAtTime,!0):""}];u=b("#"+p+" li:nth-child(1)").data("msg-time");"undefined"===typeof u||(c?c.createdAtTime:"")>=u||-1!==p.indexOf("search")&&l?b.tmpl("contactTemplate",d).prependTo("#"+p):b.tmpl("contactTemplate",d).appendTo("#"+p);p=b("#li-"+w+" .msgTextExpr");"object"===typeof g?p.append(g):p.html(g)};a.addContactsToContactSearchList=function(){O.removeClass("vis").addClass("n-vis");
pa.removeClass("vis").addClass("n-vis");fa.hasClass("active")||(db.removeClass("active"),fa.addClass("active"));ma.removeClass("vis").addClass("n-vis");la.removeClass("n-vis").addClass("vis");oa.removeClass("vis").addClass("n-vis");V.removeClass("n-vis").addClass("vis");la.html("");ea.removeClass("vis").addClass("n-vis");p.removeClass("vis").addClass("n-vis");Ia.removeClass("vis").addClass("n-vis");ib.removeClass("vis").addClass("n-vis");ja.removeClass("n-vis").addClass("vis");Ua.removeClass("n-vis").addClass("vis");
0!==Ra.length?e.addContactsToSearchList():Gb?(Ua.removeClass("vis").addClass("n-vis"),O.removeClass("n-vis").addClass("vis")):aa.loadContacts();va.focus()};a.addGroupsToGroupSearchList=function(){var d=[],e=[];O.removeClass("vis").addClass("n-vis");pa.removeClass("vis").addClass("n-vis");da.hasClass("active")||(db.removeClass("active"),da.addClass("active"));la.removeClass("vis").addClass("n-vis");ma.removeClass("n-vis").addClass("vis");V.removeClass("vis").addClass("n-vis");oa.removeClass("n-vis").addClass("vis");
ma.html("");ea.removeClass("vis").addClass("n-vis");p.removeClass("vis").addClass("n-vis");Ia.removeClass("vis").addClass("n-vis");ib.removeClass("vis").addClass("n-vis");ja.removeClass("n-vis").addClass("vis");Ua.removeClass("n-vis").addClass("vis");if(0<Qa.length){b.each(Qa,function(b,a){e.push(a.contactId)});var c=e.filter(function(b,a){return e.indexOf(b)===a});c.sort();b.each(c,function(g,e){e&&(g=mckGroupUtils.getGroup(""+e),d.push(g),0===b("#li-gs-group-"+g.htmlId).length&&a.addContactForSearchList(g,
"mck-group-search-list"))})}else pa.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:d,$searchId:sa,isContactSearch:!0});Ua.removeClass("vis").addClass("n-vis")};a.addConversationMenu=function(a,d){var g=w.data("mck-id");Za.html("");a===g&&(g=Z[a],"undefined"===typeof g||0===g.length||1===g.length?(Ma.addClass("n-vis"),m.addClass("mck-product-box-wc"),Za.addClass("n-vis")):(Za.removeClass("n-vis"),Ma.removeClass("n-vis"),m.removeClass("mck-product-box-wc"),b.each(g,function(g,
e){0===b("#mck-conversation-list #li-"+e.id).length&&(g="",e.topicDetail&&(g=b.parseJSON(e.topicDetail),g="object"===typeof g?g.title:e.topicDetail),g||(g=e.topicId),b.tmpl("convTemplate",[{convIdExpr:e.id,tabIdExpr:a,isGroupExpr:d,topicIdExpr:e.topicId,convTitleExpr:g,mckLauncherExpr:ab}]).appendTo(Za))}),2>b("#mck-conversation-list li").length&&(Ma.addClass("n-vis"),m.addClass("mck-product-box-wc"),Za.addClass("n-vis"))))};a.loadContacts=function(d){"null"!==d+""&&"undefined"!==typeof d&&"undefined"!==
typeof d.contacts&&0!==d.contacts.length&&(Ra.length=0,Sa.length=0,b.each(d.contacts,function(b,d){"undefined"!==typeof d.userId&&(b=a.getContact(""+d.userId),b="undefined"===typeof b?a.createContactWithDetail(d):a.updateContactDetail(b,d),Ra.push(b),Sa.push(b.contactId))}))};a.getStatusIcon=function(b){return'\x3cspan class\x3d"'+a.getStatusIconName(b)+" move-right "+b.key+'_status status-icon"\x3e\x3c/span\x3e'};a.getStatusIconName=function(b){return 7===b.type||6===b.type||4===b.type||0===b.type?
"":5===b.status?"mck-icon-read":4===b.status?"mck-icon-delivered":3===b.type||5===b.type||1===b.type&&(0===b.source||1===b.source)?"mck-icon-sent":""};a.clearMessageField=function(b){P.html("");ca.attr("disabled",!1);y.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required","").html("");b?P.focus().select():(l.blur(),P.blur())};a.addDraftMessage=function(a){D=[];a&&"object"===typeof La[a]?(a=La[a],P.html(a.text),0<a.files.length&&(b.each(a.files,function(b,a){ka.addFileBox(a)}),
f.html(a.filelb),G.html(a.filesize),y.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):D=[]};a.showOfflineMessage=function(){"object"===typeof ba&&ba.innerHTML?(Lb.html(ba.innerHTML),Lb.removeClass("n-vis").addClass("vis")):h.console.log("Offline message innerHTML required.")};a.hideOfflineMessage=function(){cb.stopOfflineMessageCounter();Lb.removeClass("vis").addClass("n-vis")};a.removeConversationThread=function(a,d){A.clearMckMessageArray();var g=d?mckGroupUtils.getGroup(a):
e.getContact(a),p=w.data("mck-id"),c=w.data("isgroup");"undefined"===typeof p||""===p?(a="undefined"!==typeof g?g.htmlId:mckContactUtils.formatContactId(a),b("#li-"+(d?"group-"+a:"user-"+a)).remove()):p===a&&c===d&&(u.data("datetime",""),C.removeClass("n-vis").addClass("vis"),H.removeClass("n-vis").addClass("vis"),$a.removeClass("vis").addClass("n-vis"))};a.removedDeletedMessage=function(a,d,e){A.clearMckMessageArray();a=b("."+a);0<a.length?(a.remove(),w.is(":empty")&&(H.removeClass("n-vis").addClass("vis"),
$a.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof d&&0<b("#mck-contact-list").length&&v.updateContactList(d,e)};a.getMessageTextForContactPreview=function(b,a,d){var g="";if("undefined"!==typeof b){if(b.message)if(2===b.contentType)g='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';else{g=b.message;if(mckUtils.startsWith(g,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';null!==h.emoji&&"undefined"!==typeof h.emoji&&
(g=h.emoji.replace_unified(g),g=h.emoji.replace_colons(g),g=-1!==g.indexOf("\x3c/span\x3e")?g.substring(0,g.lastIndexOf("\x3c/span\x3e")):g.substring(0,d));a.isGroup||-1!==g.indexOf("emoji-inner")||0!==b.contentType||(d=n.createElement("p"),d.appendChild(n.createTextNode(g)),g=d)}else b.fileMetaKey&&"object"===typeof b.fileMeta&&(g=e.getFileIcon(b));a.isGroup&&3!==a.type&&7!==a.type&&(a=b.to.split(",")[0]===z?"Me":e.getTabDisplayName(b.to.split(",")[0],!1),10!==b.contentType&&(g=a+": "+g),-1===g.indexOf("emoji-inner")&&
b&&b.message&&0===b.contentType&&(d=n.createElement("p"),d.appendChild(n.createTextNode(g)),g=d))}return g};a.getTextForMessagePreview=function(a,d){var g="";if("undefined"!==typeof a){if(2===a.contentType)g="Shared location";else if(a.message)if(g=a.message,mckUtils.startsWith(g,"\x3cimg"))g="Image attachment";else{var p=n.createElement("div");p.innerHTML=g;g=b.trim(mckUtils.textVal(p));g=g.substring(0,50)}else a.fileMetaKey&&"object"===typeof a.fileMeta&&(g=-1!==a.fileMeta.contentType.indexOf("image")?
"Image attachment":"File attachment");d.isGroup&&3!==d.type&&7!==d.type&&(g=(a.to.split(",")[0]===z?"Me":e.getTabDisplayName(a.to.split(",")[0],!1))+": "+g)}return g};a.getUserIdFromMessage=function(b){b=b.to;b.lastIndexOf(",")===b.length-1&&(b=b.substring(0,b.length-1));return b.split(",")};a.getUserIdArrayFromMessageList=function(d){var g=[];"undefined"===typeof d.length?g.concat(a.getUserIdFromMessage(d)):b.each(d,function(b,d){"undefined"!==typeof d.to&&(g=g.concat(a.getUserIdFromMessage(d)))});
return g};a.messageContextMenu=function(a){var d=b("."+a+" .mck-msg-box");d.addEventListener?d.addEventListener("contextmenu",function(b){b.preventDefault()},!1):d.bind("contextmenu",function(d){d.preventDefault();b(".mck-context-menu").removeClass("vis").addClass("n-vis");b("."+a+" .mck-context-menu").removeClass("n-vis").addClass("vis");h.event.returnValue=!1})};a.isValidMetaData=function(b){return b.metadata?"HIDDEN"===b.metadata.category||"ARCHIVE"===b.metadata.category?!1:!0:!0};a.updateDraftMessage=
function(a,d){if("object"===typeof d){var g={text:"",files:[]},e={fileMeta:d,filelb:ka.getFilePreviewPath(d),filesize:ka.getFilePreviewSize(d.size)};"undefined"!==typeof a&&"object"===typeof La[a]&&(g=La[a],b.each(g.files,function(b,a){a.filelb===e.filelb&&g.files.splice(b,1)}));g.files.push(e)}La[a]=g};a.updateUnreadCount=function(b,d,e){var g=a.getUnreadCount(b);Ga[b]=d;if(e||0<Ha.length)K+=d-g,0>K&&(K=0),0<K?Ha.html(K):Ha.html("")};a.incrementUnreadCount=function(b){K+=1;Ga[b]="undefined"===typeof Ga[b]?
1:Ga[b]+1;0<Ha.length&&Ha.html(K)};a.getUnreadCount=function(b){return"undefined"===typeof Ga[b]?Ga[b]=0:Ga[b]};a.isGroupDeleted=function(b,a){return a?(b=t.getDeletedAtTime(b),"undefined"!==typeof b&&0<b):!1};a.getTabDisplayName=function(b,d,e){var g="";if(d)return t.getGroupDisplayName(b);"function"===typeof Xa&&(g=Xa(b));"undefined"!==typeof e&&e&&(g=e,ua[b]=e);g||(g=a.getContactDisplayName(b));d=a.fetchContact(""+b);g?(d.displayName=g,ra[d.contactId]=d):"undefined"!==typeof d.displayName&&(g=
d.displayName);g||(g=b);return g};a.populateMessage=function(a,d,p){var g=mckDateUtils.convertMilisIntoTime(d.metadata.CALL_DURATION);aa.loadUserProfile(d.to);103==d.contentType&&(4==d.type&&"CALL_REJECTED"==d.metadata.MSG_TYPE?d.message="you rejected a Video call from "+d.to:5==d.type&&"CALL_REJECTED"==d.metadata.MSG_TYPE?d.message=d.to+"rejected a Video call from you":4==d.type&&"CALL_END"==d.metadata.MSG_TYPE?d.message="you were in a call with "+d.to+"\n call duration : "+g:5==d.type&&"CALL_END"==
d.metadata.MSG_TYPE?d.message="you were in a call with "+d.to+"\n call duration : "+g:4==d.type&&"CALL_MISSED"==d.metadata.MSG_TYPE?d.message="you missed a Video call from "+d.to:5==d.type&&"CALL_MISSED"==d.metadata.MSG_TYPE&&(d.message=d.to+"missed a Video call from you"));var c=w.data("mck-id"),f=e.isValidMetaData(d);g=d.groupId?mckGroupUtils.getGroup(d.groupId):e.getContact(d.to);if("undefined"===typeof c||""===c){var u=b("#mck-contact-list").length;0<u&&f&&(d.groupId?e.addGroupFromMessage(d,!0):
e.addContactsFromMessage(d,!0));if("APPLOZIC_01"===a||"MESSAGE_RECEIVED"===a){"undefined"===typeof g&&(g=d.groupId?mckGroupUtils.createGroup(d.groupId):e.createContact(d.to));if(ob){e.loadTab({tabId:g.contactId,isGroup:g.isGroup,conversationId:d.conversationId});return}a=d.groupId?"group_"+g.contactId:"user_"+g.contactId;f&&(10!==d.contentType&&102!==d.contentType&&e.incrementUnreadCount(a),hb.notifyUser(d));p=d.groupId?"group-"+g.htmlId:"user-"+g.htmlId;b("#li-"+p+" .mck-unread-count-text").html(e.getUnreadCount(a));
0<e.getUnreadCount(a)&&b("#li-"+p+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");v.sendDeliveryUpdate(d)}}else if("undefined"===typeof g&&(g=d.groupId?mckGroupUtils.createGroup(d.groupId):e.createContact(d.to)),"APPLOZIC_01"===a||"MESSAGE_RECEIVED"===a){if("undefined"!==typeof g&&(a=w.data("isgroup"),0===b("."+d.oldKey).length&&0===b("."+d.key).length||10===d.contentType)){if("undefined"===typeof c||c!==g.contactId||a!==g.isGroup||Ia.hasClass("vis")){if(ob){e.loadTab({tabId:g.contactId,
isGroup:g.isGroup,conversationId:d.conversationId});return}if(f&&10!==d.contentType||102!==d.contentType)a=d.groupId?"group_"+g.contactId:"user_"+g.contactId,e.incrementUnreadCount(a);v.sendDeliveryUpdate(d)}else{f=!0;a&&6===g.type&&(f=t.isAppendOpenGroupContextMenu(g));if(d.conversationId&&(Aa||Ka))if((a=w.data("mck-conversationid"))&&a.toString()===d.conversationId.toString())d.metadata&&"HIDDEN"===d.metadata.category||e.addMessage(d,g,!0,!0,f),v.sendReadUpdate(d.pairedMessageKey);else{if(ob){e.loadTab({tabId:g.contactId,
<<<<<<< Updated upstream
isGroup:g.isGroup,conversationId:d.conversationId});return}}else if(7===g.type&&(a=mckGroupUtils.getGroup(d.groupId),a=e.getContactFromGroupOfTwo(a),T.lastSeenOfGroupOfTwo(a.contactId),e.addMessage(d,g,!0,!0,f)),console.log(d),console.log("group/contact"),console.log(g),!d.metadata||"HIDDEN"!==d.metadata.category&&"true"!==d.metadata.hide&&7!==g.type)e.addMessage(d,g,!0,!0,f),v.sendReadUpdate(d.pairedMessageKey);d.groupId||(b("#mck-tab-status").html(MCK_LABELS.online),T.updateUserStatus({userId:d.to,
status:1}))}p&&6!==g.type&&hb.notifyUser(d)}}else"APPLOZIC_02"===a&&102==!d.contentType&&(0===b("."+d.oldKey).length&&0===b("."+d.key).length||10===d.contentType)&&(0<u?e.addContactsFromMessage(d,!0):"undefined"!==typeof g&&(a=w.data("isgroup"),"undefined"!==typeof c&&c===g.contactId&&a===g.isGroup&&(f=!0,a&&6===g.type&&(f=t.isAppendOpenGroupContextMenu(g)),d.metadata&&"HIDDEN"===d.metadata.category||e.addMessage(d,g,!0,!0,f),3===d.type&&(b("."+d.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),
e.addTooltip(d.key)))));za.removeClass("vis").addClass("n-vis")};a.getMessageFeed=function(a){var d={};d.key=a.key;d.timeStamp=a.createdAtTime;d.message=a.message;d.from=4===a.type?a.to:z;d.to=a.groupId?a.groupId:5===a.type?a.to:z;d.status="read";d.type=4===a.type?"inbox":"outbox";5===a.type&&(3===a.status?d.status="sent":4===a.status&&(d.status="delivered"));if("object"===typeof a.fileMeta){var e=b.extend({},a.fileMeta);if("undefined"===typeof e.url||""===e.url)e.url=E+"/rest/ws/aws/file/"+a.fileMeta.blobKey;
delete e.blobKey;d.file=e}d.source=a.source;d.metadata=a.metadata;return d};a.updateUnreadCountonChatIcon=function(a){if(Hb&&0<a.length){var d=null,g=0;0<a.length&&(b.each(a,function(b,a){!(0<a.unreadCount&&null!==d)&&0<a.unreadCount&&(d=a.userId,g=a.unreadCount)}),0<K&&"none"===q.css("display")&&(null!==d&&g===K?e.loadTab({tabId:d,isGroup:!1}):e.loadTab({tabId:"",isGroup:!1})))}};a.loadMessageListOnUserDetailFetch=function(a){za.removeClass("vis").addClass("n-vis");var d=w.data("mck-id"),g=w.data("isgroup");
if("undefined"===typeof d||a.tabId===d&&""+g===""+a.isGroup)d=mckGroupUtils.getGroup(a.tabId),t.addGroupStatus(d),g=!0,6===d.type&&(t.validateOpenGroupUser(d),g=t.isAppendOpenGroupContextMenu(d)),a.isMessages?(C.removeClass("vis").addClass("n-vis"),e.processMessageList(a.messageData,!0,g),6!==d.type&&$a.removeClass("n-vis").addClass("vis"),"function"===typeof Wa&&Wa(a.tabId)):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&($a.removeClass("vis").addClass("n-vis"),C.removeClass("n-vis").addClass("vis"))}},
v=new function(){var a=this,c=b("#mck-search"),l=b("#mck-msg-to"),x=b("#mck-msg-new");b("#mck-audio");b("#mck-mike-btn");var f=b("#mck-sidebox"),G=b("#mck-file-box"),q=b("#mck-text-box"),y=b("#mck-msg-form"),ca=b("#mck-msg-sbmt"),B=b("#mck-new-group"),P=b("#mck-tab-title"),X=b("#mck-msg-error"),Ba=b("#mck-btn-attach"),Ta=b("#mck-tab-status"),H=b("#mck-message-cell"),E=b(".mck-typing-box"),C=b("#mck-gms-loading"),m=b("#mck-group-title"),Q=b("#mck-contact-loading"),L=b("#mck-no-messages"),R=b(".mck-group-search"),
Ma=b("#mck-msg-response"),M=b("#mck-msg-form input"),K=b("#mck-block-button"),F=b("#li-mck-block-user"),da=b("#li-mck-group-info"),ea=b("#li-mck-video-call"),ia=b("#mck_response_text"),la=b(".mck-contact-search"),pa=b("#mck-group-info-tab"),O=b("#mck-price-text-box");b("#mck-sidebox-search");var oa=b("#mck-group-info-btn");pa=b("#mck-group-info-tab");var S=b("#mck-btn-group-exit"),qa=b("#mck-group-back-link"),fa=b("#mck-btn-leave-group"),ba=b(".mck-sidebox-content"),ka=b("#mck-no-more-messages"),
ta=b("#mck-btn-group-create");b("#mck-group-create-tab");var ua=b("#mck-group-add-member");b("#mck-contacts-content");var va=b("#mck-tab-option-panel"),ya=b("#mck-no-conversations"),Ga=b("#mck-group-create-title"),Ca=b(".mck-group-menu-options"),ja=b(".mck-tab-message-option"),Da=b(".mck-group-admin-options"),ra=b("#mck-group-member-search"),r=b("#mck-message-cell .mck-message-inner");b("#mck-search-cell .mck-message-inner");var xa=b("#mck-no-more-conversations"),Ha=b("#mck-gm-search-box"),Oa=b("#mck-group-member-search-list"),
=======
isGroup:g.isGroup,conversationId:d.conversationId});return}}else 7===g.type&&(a=mckGroupUtils.getGroup(d.groupId),a=e.getContactFromGroupOfTwo(a),T.lastSeenOfGroupOfTwo(a.contactId),e.addMessage(d,g,!0,!0,f)),(!d.metadata||"HIDDEN"!==d.metadata.category&&7!==g.type)&&e.addMessage(d,g,!0,!0,f),v.sendReadUpdate(d.pairedMessageKey);d.groupId||(b("#mck-tab-status").html(MCK_LABELS.online),T.updateUserStatus({userId:d.to,status:1}))}p&&6!==g.type&&hb.notifyUser(d)}}else"APPLOZIC_02"===a&&102==!d.contentType&&
(0===b("."+d.oldKey).length&&0===b("."+d.key).length||10===d.contentType)&&(0<u?e.addContactsFromMessage(d,!0):"undefined"!==typeof g&&(a=w.data("isgroup"),"undefined"!==typeof c&&c===g.contactId&&a===g.isGroup&&(f=!0,a&&6===g.type&&(f=t.isAppendOpenGroupContextMenu(g)),d.metadata&&"HIDDEN"===d.metadata.category||e.addMessage(d,g,!0,!0,f),3===d.type&&(b("."+d.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(d.key)))));za.removeClass("vis").addClass("n-vis")};
a.getMessageFeed=function(a){var d={};d.key=a.key;d.timeStamp=a.createdAtTime;d.message=a.message;d.from=4===a.type?a.to:z;d.to=a.groupId?a.groupId:5===a.type?a.to:z;d.status="read";d.type=4===a.type?"inbox":"outbox";5===a.type&&(3===a.status?d.status="sent":4===a.status&&(d.status="delivered"));if("object"===typeof a.fileMeta){var e=b.extend({},a.fileMeta);if("undefined"===typeof e.url||""===e.url)e.url=E+"/rest/ws/aws/file/"+a.fileMeta.blobKey;delete e.blobKey;d.file=e}d.source=a.source;d.metadata=
a.metadata;return d};a.updateUnreadCountonChatIcon=function(a){if(Hb&&0<a.length){var d=null,g=0;0<a.length&&(b.each(a,function(b,a){!(0<a.unreadCount&&null!==d)&&0<a.unreadCount&&(d=a.userId,g=a.unreadCount)}),0<K&&"none"===q.css("display")&&(null!==d&&g===K?e.loadTab({tabId:d,isGroup:!1}):e.loadTab({tabId:"",isGroup:!1})))}};a.loadMessageListOnUserDetailFetch=function(a){za.removeClass("vis").addClass("n-vis");var d=w.data("mck-id"),g=w.data("isgroup");if("undefined"===typeof d||a.tabId===d&&""+
g===""+a.isGroup)d=mckGroupUtils.getGroup(a.tabId),t.addGroupStatus(d),g=!0,6===d.type&&(t.validateOpenGroupUser(d),g=t.isAppendOpenGroupContextMenu(d)),a.isMessages?(C.removeClass("vis").addClass("n-vis"),e.processMessageList(a.messageData,!0,g),6!==d.type&&$a.removeClass("n-vis").addClass("vis"),"function"===typeof Wa&&Wa(a.tabId)):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&($a.removeClass("vis").addClass("n-vis"),C.removeClass("n-vis").addClass("vis"))}},v=new function(){var a=
this,c=b("#mck-search"),l=b("#mck-msg-to"),x=b("#mck-msg-new");b("#mck-audio");b("#mck-mike-btn");var f=b("#mck-sidebox"),G=b("#mck-file-box"),q=b("#mck-text-box"),y=b("#mck-msg-form"),ca=b("#mck-msg-sbmt"),B=b("#mck-new-group"),P=b("#mck-tab-title"),X=b("#mck-msg-error"),Ba=b("#mck-btn-attach"),Ta=b("#mck-tab-status"),H=b("#mck-message-cell"),E=b(".mck-typing-box"),C=b("#mck-gms-loading"),m=b("#mck-group-title"),Q=b("#mck-contact-loading"),L=b("#mck-no-messages"),R=b(".mck-group-search"),Ma=b("#mck-msg-response"),
M=b("#mck-msg-form input"),K=b("#mck-block-button"),F=b("#li-mck-block-user"),da=b("#li-mck-group-info"),ea=b("#li-mck-video-call"),ia=b("#mck_response_text"),la=b(".mck-contact-search"),pa=b("#mck-group-info-tab"),O=b("#mck-price-text-box");b("#mck-sidebox-search");var oa=b("#mck-group-info-btn");pa=b("#mck-group-info-tab");var S=b("#mck-btn-group-exit"),qa=b("#mck-group-back-link"),fa=b("#mck-btn-leave-group"),ba=b(".mck-sidebox-content"),ka=b("#mck-no-more-messages"),ta=b("#mck-btn-group-create");
b("#mck-group-create-tab");var ua=b("#mck-group-add-member");b("#mck-contacts-content");var va=b("#mck-tab-option-panel"),ya=b("#mck-no-conversations"),Ga=b("#mck-group-create-title"),Ca=b(".mck-group-menu-options"),ja=b(".mck-tab-message-option"),Da=b(".mck-group-admin-options"),ra=b("#mck-group-member-search"),r=b("#mck-message-cell .mck-message-inner");b("#mck-search-cell .mck-message-inner");var xa=b("#mck-no-more-conversations"),Ha=b("#mck-gm-search-box"),Oa=b("#mck-group-member-search-list"),
>>>>>>> Stashed changes
Xa=b("#mck-no-gsm-text");b.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');var Ua,Pa=b("#mck-minutes"),Qa=b("#mck-seconds");a.createNewConversation=function(a,e){b.fn.applozic("createGroup",{groupName:a.groupName,type:10,admin:a.agentId,users:[{userId:"bot",groupRole:2},{userId:a.agentId,groupRole:1}],
metadata:{CREATE_GROUP_MESSAGE:"",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Conversation name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Conversation icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted Conversation",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",HIDE:"true"},callback:function(b){console.log("response",
b);"success"===b.status&&b.data.clientGroupId&&Kommunicate.createNewConversation({groupId:b.data.clientGroupId,participentUserId:z,defaultAgentId:Va},function(a,d){console.log(a,d);a||e(b.data.clientGroupId)})}})};a.loadConversationWithAgents=function(a,e){"kommunicate"==window.applozic.PRODUCT_ID&&fa.removeClass("vis").addClass("n-vis");b.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:"type\x3d10\x26startIndex\x3d0\x26limit\x3d10",contentType:"application/json",success:function(a){0<
a.response.length?(a=a.response[0].id,"true"==Cookies.get("_km-f-vis_")&&b.fn.applozic("loadGroupTab",a),b.fn.applozic("loadTab")):v.createNewConversation({groupName:qb,agentId:Va},e)}})};a.timer=function(){var b=0,a=this;Ua=setInterval(function(){++b;Qa.html(a.pad(b%60));Pa.html(a.pad(parseInt(b/60)))},1E3);a.pad=function(b){b+="";return 2>b.length?"0"+b:b}};a.stoptimer=function(){Qa.html("0");Pa.html("0");clearInterval(Ua)};b(n).on("click",".mck-message-delete",function(){a.deleteMessage(b(this).parents(".mck-m-b").data("msgkey"))});
b(n).on("click",".mck-message-reply",function(){a.replyMessage(b(this).parents(".mck-m-b").data("msgkey"))});b(n).on("click",".mck-message-forward",function(){x.data("forwardMessageKey",b(this).parents(".mck-m-b").data("msgkey"));x.trigger("click")});b(".mck-minimize-icon").click(function(){b(".mck-box-md,.mck-box-ft").animate({height:"toggle"});ba.hasClass("minimized")?(ba.css("height","100%"),ba.removeClass("minimized")):(ba.css("height","0%"),ba.addClass("minimized"))});a.init=function(){A.clearMckMessageArray();
b(n).on("click","."+ab,function(){b(this).hasClass("mck-msg-preview")&&b(this).hide()});e.initSearchAutoType();la.click(function(){v.createNewConversation({groupName:qb,agentId:Va},function(b){Kommunicate.triggerEvent("1",{groupId:b,applicationId:V})})});R.click(function(){e.addGroupsToGroupSearchList()});q.keydown(function(b){q.hasClass("mck-text-req")&&q.removeClass("mck-text-req");if(13===b.keyCode&&(b.shiftKey||b.ctrlKey)){if(b.preventDefault(),h.getSelection){b=h.getSelection();var a=b.getRangeAt(0),
d=n.createElement("br"),e=n.createTextNode("\u00a0");a.deleteContents();a.insertNode(d);a.collapse(!1);a.insertNode(e);a.selectNodeContents(e);b.removeAllRanges();b.addRange(a);q.animate({scrollTop:q.prop("scrollHeight")},0);return!1}}else 13===b.keyCode?(b.preventDefault(),1===ma&&W.sendTypingStatus(0,r.data("mck-id")),ca.is(":disabled")&&G.hasClass("vis")?alert("Please wait file is uploading."):y.submit()):0===ma&&W.sendTypingStatus(1,r.data("mck-id"))});b(n).on("click",".mck-btn-clear-messages",
function(){confirm(MCK_LABELS["clear.messages.alert"])&&v.deleteConversation()});b(n).on("click",".applozic-tm-launcher",function(a){a.preventDefault();var d=b(this).data("mck-id");d="undefined"!==typeof d&&""!==d?d.toString():"";var c=b(this).data("mck-name");c="undefined"!==typeof c&&""!==c?c.toString():"";a=b(this).data("mck-supportid");a="undefined"!==typeof a&&""!==a?a.toString():"";var p=b(this).data("mck-topicid");p="undefined"!==typeof p&&""!==p?p.toString():"";var f=b(this).data("mck-msg");
f="undefined"!==typeof f&&""!==f?f.toString():"";if("function"===typeof za&&p){var k=za(p);"object"===typeof k&&"undefined"!==k.title&&(I[p]=k)}d={topicId:p,tabId:d,userName:c,isMessage:!0};d.messagePxy={type:5,contentType:0,message:f};a?(d.isGroup=!0,d.supportId=a,v.getConversationId(d)):(d.isGroup=!1,e.loadTab(d,v.dispatchMessage))});b(n).on("click",".applozic-wt-launcher",function(a){a.preventDefault();a=b(this).data("mck-id");a="undefined"!==typeof a&&""!==a?a.toString():"";var d=b(this).data("mck-name");
d="undefined"!==typeof d&&""!==d?d.toString():"";var e=b(this).data("mck-topicid");e="undefined"!==typeof e&&""!==e?e.toString():"";var c=b(this).data("mck-topic-status");c=c?-1===Y.indexOf(c)?Y[0]:c.toString():Y[0];if("function"===typeof za){var p=za(e);"object"===typeof p&&"undefined"!==p.title&&(I[e]=p)}v.getConversationId({tabId:a,isGroup:!1,userName:d,topicId:e,topicStatus:c,isMessage:!1})});b(n).on("click",".applozic-ct-launcher",function(a){a.preventDefault();var d=b(this).data("mck-id");d=
"undefined"!==typeof d&&""!==d?d.toString():"";var e=b(this).data("mck-name");e="undefined"!==typeof e&&""!==e?e.toString():"";a=b(this).data("mck-topicid");a="undefined"!==typeof a&&""!==a?a.toString():"";var c=b(this).data("mck-topic-status");c=c?-1===Y.indexOf(c)?Y[0]:c.toString():Y[0];d={tabId:d,isGroup:!1,userName:e,topicId:a,topicStatus:c,isMessage:!1};"function"===typeof Eb&&(e=Eb(a),"object"===typeof e&&(e.topicDetail&&"object"===typeof e.topicDetail&&"undefined"!==e.topicDetail.title&&(I[a]=
e.topicDetail),e.fallBackTemplatesList&&0<e.fallBackTemplatesList.length&&(d.fallBackTemplatesList=e.fallBackTemplatesList)));v.getConversationId(d)});b(n).on("click","."+ab+", .mck-contact-list ."+ab,function(d){d.preventDefault();b("#mck-sidebox-launcher").removeClass("vis").addClass("n-vis");Cookies.get("_km-f-vis_")?Cookies.set("_km-f-vis_","false"):Cookies.set("_km-f-vis_","true");if("false"===gc)b("#km-chatLoginModal").removeClass("n-vis").addClass("vis"),b("#km-chatLoginModal").css("display",
"block");else if("true"==Cookies.get("_km-f-vis_"))v.loadConversationWithAgents({groupName:qb,agentId:Va},function(b){Kommunicate.triggerEvent("1",{groupId:b,applicationId:V})});else{var e=this;b(this).parents(".mck-search-list").length?(c.bind("blur"),setTimeout(function(){a.openChat(e)},600)):a.openChat(this)}});b("#km-form-chat-login").submit(function(a){a=$("#km-submit-chat-login");var e=$("#km-error-chat-login"),c=$("#km-userName").val();$("#km-email").val();a.attr("disabled",!0);a.html("Initiating chat...");
e.removeClass("show").addClass("hide");e.html("");b.fn.applozic("reInitialize",{userId:c,appId:V,onInit:d,baseUrl:MCK_BASE_URL,locShare:bb,googleApiKey:Rb});return!1});var d=function(){"kommunicate"===window.applozic.PRODUCT_ID&&fa.removeClass("vis").addClass("n-vis");v.loadConversationWithAgents({groupName:qb,agentId:Va})};b(".km-login-model-close").on("click",function(a){b("#km-chatLoginModal").removeClass("vis").addClass("n-vis")});b(n).on("click",".mck-conversation-tab-link",function(a){a.preventDefault();
b(this);a=r.data("mck-id");var d=r.data("isgroup");e.loadTab({tabId:"",isGroup:!1,lastActiveTabId:a,isLastActiveTabGroup:d})});b(n).on("click",".mck-close-sidebox",function(a){a.preventDefault();f.mckModal("hide");b("#mck-sidebox-launcher").removeClass("n-vis").addClass("vis");a=r.data("mck-conversationid");r.data("mck-id","");r.data("mck-topicid","");r.data("mck-name","");r.data("mck-conversationid","");a&&(a=N[a],"object"===typeof a&&(a=a.topicId,"function"===typeof yb&&yb(z,a)));W.unsubscibeToTypingChannel()});
b(n).on("click",".mck-price-submit",function(b){b.preventDefault();a.sendPriceMessage()});O.keydown(function(b){13===b.keyCode&&a.sendPriceMessage()});r.bind("scroll",function(){if(0<r.find(".mck-contact-list").length){if(r.scrollTop()+r.innerHeight()>=r[0].scrollHeight){var b=r.data("datetime");0<b&&!Ea&&v.loadMessageList({tabId:"",isGroup:!1,startTime:b})}}else if(0===r.scrollTop()){var a=r.data("mck-id");if("undefined"!==typeof a&&""!==a){var d=r.data("isgroup"),e=r.data("mck-conversationid");
e=e?e.toString():"";b=va.data("datetime");0<b&&!Ea&&v.loadMessageList({tabId:a,isGroup:d,conversationId:e,startTime:b})}}});O.on("click",function(b){b.preventDefault();O.removeClass("mck-text-req")});K.on("click",function(b){b.preventDefault();b=r.data("mck-id");var a=r.data("isgroup"),d=!r.data("blocked");a?(F.removeClass("vis").addClass("n-vis"),ea.removeClass("vis").addClass("n-vis")):confirm(d?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"])&&aa.blockUser(b,d)});fa.on("click",
function(b){b.preventDefault();b=r.data("mck-id");r.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({apzCallback:t.onGroupLeft,groupId:b}):Ca.removeClass("vis").addClass("n-vis")});b(n).on("click",".mck-add-to-group",function(a){a.preventDefault();a=b(this).data("mck-id");"undefined"!==typeof a&&t.addGroupMemberFromSearch(a);Ha.mckModal("hide")});b(n).on("click",".mck-btn-remove-member",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").data("mck-id");
var d=pa.data("mck-id");if("undefined"!==typeof d&&"undefined"!==typeof a){var e=mckGroupUtils.getGroup(d);"object"===typeof e&&z===e.adminName?confirm(MCK_LABELS["remove.member.alert"])&&mckGroupService.removeGroupMember({groupId:d,userId:a,apzCallback:t.onRemovedGroupMember}):Da.removeClass("vis").addClass("n-vis")}});S.on("click",function(b){b.preventDefault();(b=pa.data("mck-id"))?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({groupId:b,apzCallback:t.onGroupLeft}):e.loadTab({tabId:"",
isGroup:!1})});oa.on("click",function(b){b.preventDefault();b=r.data("mck-id");if(r.data("isgroup")){b={groupId:b};var a=r.data("mck-conversationid");a&&(b.conversationId=a);t.loadGroupInfo(b)}else Ca.removeClass("vis").addClass("n-vis")});B.on("click",function(b){b.preventDefault();t.loadCreateGroupTab()});qa.on("click",function(b){b.preventDefault();var a=pa.data("mck-id");b=pa.data("mck-conversation-id");a?(a={tabId:a,isGroup:!0},b&&(a.conversationId=b),e.loadTab(a)):e.loadTab({tabId:"",isGroup:!1})});
ua.on("click",function(a){a.preventDefault();if(a=pa.data("mck-id"))(a=mckGroupUtils.getGroup(a))&&a.adminName===z?(Oa.html(""),Ha.mckModal(),C.removeClass("n-vis").addClass("vis"),0<Sa.length?t.addMembersToGroupSearchList():Gb?0<Ra.length?(b.each(Ra,function(b,a){Sa.push(a.contactId)}),t.addMembersToGroupSearchList()):(C.removeClass("vis").addClass("n-vis"),Xa.removeClass("n-vis").addClass("vis")):aa.getUserStatus({callback:t.addMembersToGroupSearchList})):Da.removeClass("vis").addClass("n-vis")});
ra.keypress(function(b){if(13===b.which)return b=ra.val(),""!==b&&t.addGroupMemberFromSearch(b),ra.val(""),!0});b(n).on("click",".mck-group-member-search-link",function(b){b.preventDefault();b=ra.val();""!==b&&t.addGroupMemberFromSearch(b);ra.val("")});b(n).on("click",".mck-show-more",function(a){a.preventDefault();var d=b(this);a=d.data("tabId");var e=r.data("isgroup"),c=r.data("mck-conversationid");c=c?c.toString():"";d=d.data("datetime");v.loadMessageList({tabId:a,isGroup:e,conversationId:c,startTime:d})});
b(n).on("click",".mck-accept",function(a){a=b(this).data("mck-conversationid");var d=b(this).data("mck-topic-price");if("function"===typeof Ja&&d&&a){var e=N[a],c=l.val();c=t.getGroupDisplayName(c);"object"===typeof e?(Ja({custId:z,suppId:c,productId:e.topicId,price:d}),v.sendConversationCloseUpdate(a)):v.getTopicId({conversationId:a,suppId:c,priceText:d})}});y.submit(function(){1===ma&&W.sendTypingStatus(0,r.data("mck-id"));var d=b.trim(mckUtils.textVal(q[0]));G.hasClass("n-vis")&&0<D.length&&(D=
[]);if(0===d.length&&0===D.length)return q.addClass("mck-text-req"),!1;if("function"===typeof Cb&&!Cb(d))return!1;d={type:5,contentType:0,message:d};var e=r.data("mck-conversationid"),c=r.data("mck-topicid");e?d.conversationId=e:c&&(e={topicId:c},c=I[c],"object"===typeof c&&(e.topicDetail=h.JSON.stringify(c)),d.conversationPxy=e);!0===r.data("isgroup")?d.groupId=l.val():d.to=l.val();ca.attr("disabled",!0);X.removeClass("vis").addClass("n-vis");X.html("");ia.html("");Ma.removeClass("vis").addClass("n-vis");
a.sendMessage(d);return!1});M.on("click",function(){b(this).val("");X.removeClass("vis").addClass("n-vis");Ma.removeClass("vis").addClass("n-vis")});b(n).bind("click",function(a){b(".mck-context-menu").removeClass("vis").addClass("n-vis");!Ba.hasClass("on")||b(a.target).hasClass("mck-icon-upload")||b(a.target).hasClass("mck-btn-attach")||Ib.fileMenuToggle();q.removeClass("mck-text-req");n.activeElement&&n.activeElement!==q&&1===ma&&W.sendTypingStatus(0,r.data("mck-id"));n.activeElement&&"mck-group-name-save"!==
n.activeElement.id&&m.removeClass("mck-req-border");n.activeElement&&"mck-btn-group-create"!==n.activeElement.id&&Ga.removeClass("mck-req-border");b(".mcktypeahead.mck-dropdown-menu").hide()});b(".mck-tabview-item").click(function(){b(".mck-tabview-item").removeClass("active");b(this).addClass("active")})};b(".mck-sidebox").on("click","#mck-mike-btn",function(){b(this).removeClass("vis").addClass("n-vis");$(".mck-stop-btn").addClass("vis").removeClass("n-vis");Fr.voice.record(!1,function(){$("#mck-audio").removeClass("n-vis").addClass("vis");
v.timer()})});b(".mck-sidebox").on("click","#mck-stop-recording",function(){$("#mck-mike-btn").addClass("vis").removeClass("n-vis");$(".mck-stop-btn").addClass("n-vis").removeClass("vis");$("#mck-audio").removeClass("vis").addClass("n-vis");v.stoptimer();Fr.voice.export(function(a){var d={};d.file=a;d.name="blob";b.fn.applozic("audioAttach",d)},"blob");Fr.voice.stop()});a.openChat=function(a){var d=b(a);a=d.data("mck-id");a="undefined"!==typeof a&&""!==a?a.toString():"";var f=d.data("mck-name");f=
"undefined"!==typeof f&&""!==f?f.toString():"";var k=d.data("mck-topicid");k="undefined"!==typeof k&&""!==k?k.toString():"";var h=!0===d.data("isgroup");d=d.data("mck-conversationid");d="undefined"!==typeof d&&""!==d?d.toString():"";k&&!d?(d=(d=b(elem).data("mck-topic-status"))?-1===Y.indexOf(d)?Y[0]:d.toString():Y[0],v.getConversationId({tabId:a,isGroup:h,userName:f,topicId:k,topicStatus:d,isMessage:!1})):e.loadTab({tabId:a,isGroup:h,userName:f,conversationId:d,topicId:k});c.val("")};a.sendMessage=
function(d){if("object"===typeof d){var c=d.metadata?d.metadata:{},f=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof f||""===f||d.forward||(c.AL_REPLY=f);d.metadata=c;if("undefined"!==typeof d.message&&0!==d.message.length||0!==D.length){if(d.conversationId&&(c=N[d.conversationId],"undefined"!==c&&c.closed)){e.closeConversation();ca.attr("disabled",!1);return}if(r.data("blocked"))T.toggleBlockUser(h,!0),ca.attr("disabled",!1);else{var k="";d.groupId?(k=mckGroupUtils.getGroup(d.groupId),"undefined"===
typeof k&&(k=mckGroupUtils.createGroup(d.groupId))):k=d.clientGroupId?mckGroupUtils.getGroupByClientGroupId(d.clientGroupId):e.fetchContact(d.to);0<b("#mck-message-cell .mck-no-data-text").length&&b(".mck-no-data-text").remove();if(d.message&&0===D.length){c=ja.hasClass("n-vis");var h=r.data("mck-id"),m=mckUtils.randomId();d.key=m;12!==d.contentType&&h&&h.toString()===k.contactId&&102!==d.contentType&&a.addMessageToTab(d,k);a.submitMessage(d,{tabId:k.contactId,isTopPanelAdded:c})}else 0<D.length&&
b.each(D,function(b,e){b=ja.hasClass("n-vis");var c=r.data("mck-id"),f=mckUtils.randomId();d.key=f;d.fileMeta=e;d.contentType=1;12!==d.contentType&&c&&c.toString()===k.contactId&&a.addMessageToTab(d,k);a.submitMessage(d,{tabId:k.contactId,isTopPanelAdded:b})});q.removeClass("mck-text-req");ca.attr("disabled",!1);b("."+m+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");e.addTooltip(m);e.clearMessageField(!0);D=[];delete La[k.contactId]}}else q.addClass("mck-text-req")}};
a.addMessageToTab=function(b,a){var d={to:b.to,groupId:b.groupId,deviceKey:b.deviceKey,contentType:b.contentType,message:b.message,conversationId:b.conversationId,topicId:b.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:b.key,storeOnDevice:!0,sent:!1,read:!0,metadata:b.metadata?b.metadata:""};d.type=b.type?b.type:5;b.fileMeta&&(d.fileMeta=b.fileMeta);e.addMessage(d,a,!0,!0,!1)};a.sendForwardMessage=function(b){var d=A.getMessageByKey(b);if("undefined"!==typeof d){d.fileMeta&&D.push(d.fileMeta);
b={type:5,contentType:d.contentType,message:d.message,forward:"forward"};d.metadata&&(d.metadata.AL_REPLY&&(d.metadata.AL_REPLY=""),b.metadata=d.metadata);var e=r.data("mck-conversationid");d=r.data("mck-topicid");e?b.conversationId=e:d&&(e={topicId:d},d=I[d],"object"===typeof d&&(e.topicDetail=h.JSON.stringify(d)),b.conversationPxy=e);!0===r.data("isgroup")?b.groupId=l.val():b.to=l.val();a.sendMessage(b)}};a.sendWelcomeMessage=function(b){var d=mckUtils.randomId(),c=r.data("mck-id"),f=r.data("isgroup");
d={key:d,type:4,contentType:0,to:b.sender,message:b.messageContent};c&&c.toString()===b.sender&&!f&&(c=e.fetchContact(c),a.addMessageToTab(d,c));mckUtils.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+encodeURIComponent(b.sender)+"\x26messageContent\x3d"+encodeURIComponent(b.messageContent),contentType:"text/plain",success:function(a){b.callback&&b.callback(a)}})};a.submitMessage=function(a,c){var d=a.key,f=a.metadata?a.metadata:{};Vb&&(a.metadata={userStatus:4});
var k=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof k||""===k||a.forward||(f.AL_REPLY=k,b("#mck-text-box").data("AL_REPLY",""));a.source=lc;var m=b("#mck-message-cell .mck-message-inner div[name\x3d'message']."+d);102!=a.contentType&&103!=a.contentType&&(a.metadata=Ub);a.metadata=f;mckUtils.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:h.JSON.stringify(a),contentType:"application/json",success:function(f){var k=r.data("mck-id");if("object"===typeof f){var h=
f.messageKey;if(k&&k.toString()===c.tabId){var p=f.conversationId;r.data("mck-conversationid",p);m.removeClass(d).addClass(h);m.data("msgkey",h);b("."+h+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title","sent");e.addTooltip(h);c.isTopPanelAdded&&va.data("datetime",f.createdAt);f=!0;a.groupId&&6===mckGroupUtils.getGroup(a.groupId).type&&(f=!1);f&&e.messageContextMenu(h)}a.conversationPxy&&(h=a.conversationPxy,a.topicId&&(sa[a.topicId]=[p]),N[p]=h)}else"CONVERSATION_CLOSED"===
f||"BUSY_WITH_OTHER"===f?(ca.attr("disabled",!1),e.closeConversation(f),m.remove(),c.isTopPanelAdded&&ja.removeClass("vis").addClass("n-vis")):"error"===f&&(ca.attr("disabled",!1),X.html("Unable to process your request. Please try again"),X.removeClass("n-vis").addClass("vis"),m.remove(),c.isTopPanelAdded&&ja.removeClass("vis").addClass("n-vis"))},error:function(){X.html("Unable to process your request. Please try again.");X.removeClass("n-vis").addClass("vis");m&&m.remove();c.isTopPanelAdded&&ja.removeClass("vis").addClass("n-vis")}});
$("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};a.downloadImage=function(b){window.open(b,"_blank")};a.replyMessage=function(a){r.data("mck-id");var d=v.getReplyMessageByKey(a);q.focus().select();$("#mck-reply-to-div").removeClass("n-vis").addClass("vis");var c=5===d.type?"You":e.getTabDisplayName(d.to,!1);$("#mck-reply-to").html(c);"object"===typeof d.fileMeta||2===d.contentType?$("#mck-reply-msg").html(e.getImageForMessagePreview(d)):$("#mck-reply-msg").html(d.message);b("#mck-text-box").data("AL_REPLY",
a)};$("#close").click(function(){$("#mck-reply-to-div").removeClass("vis").addClass("n-vis");b("#mck-text-box").data("AL_REPLY","")});a.deleteMessage=function(a){var d=r.data("mck-id");"undefined"!==typeof d&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+a,type:"get",success:function(e){"success"===e?(r.data("mck-id")===d&&(b("."+a).remove(),r.is(":empty")&&ja.removeClass("vis").addClass("n-vis")),A.clearMckMessageArray()):h.console.log("Unable to delete message. Please reload page.")}})};
a.deleteConversation=function(){var b=r.data("mck-id"),a=r.data("isgroup"),e=r.data("mck-conversationid");"undefined"!==typeof b&&(a=a?"groupId\x3d"+b:"userId\x3d"+encodeURIComponent(b),e&&(a+="\x26conversationId\x3d"+e),Ea=!0,mckUtils.ajax({type:"get",url:MCK_BASE_URL+"/rest/ws/message/delete/conversation",global:!1,data:a,success:function(){r.data("mck-id")===b&&(r.html(""),va.data("datetime",""),H.removeClass("n-vis").addClass("vis"),L.removeClass("n-vis").addClass("vis"),ja.removeClass("vis").addClass("n-vis"),
Ea=!1)},error:function(){}}))};a.getMessages=function(b){var a="";"undefined"!==typeof b.userId&&""!==b.userId?(a=b.isGroup?"\x26groupId\x3d"+b.userId:"\x26userId\x3d"+encodeURIComponent(b.userId),b.startTime&&(a+="\x26endTime\x3d"+b.startTime),a+="\x26pageSize\x3d30",(Aa||Ka)&&b.conversationId&&(a+="\x26conversationId\x3d"+b.conversationId,"undefined"===typeof Z[b.userId]&&(a+="\x26conversationReq\x3dtrue"))):(b.startTime&&(a+="\x26endTime\x3d"+b.startTime),a+="\x26mainPageSize\x3d100");var d={};
mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+a,type:"get",success:function(a){d.status="success";d.data=a;b.callback&&b.callback(d)},error:function(a,e,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));d.status="error";b.callback&&b.callback(d)}})};a.getMessageList=function(a){var d=a.id;if("undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){var c=a.pageSize?"\x26pageSize\x3d"+a.pageSize:"\x26pageSize\x3d50";c+="\x26clientGroupId\x3d"+
a.clientGroupId;a.startTime&&(c+="\x26endTime\x3d"+a.startTime);var f={clientGroupId:a.clientGroupId}}else"undefined"!==typeof d&&""!==d?(c=a.pageSize?"\x26pageSize\x3d"+a.pageSize:"\x26pageSize\x3d50",c+="true"===""+a.isGroup?"\x26groupId\x3d"+d:"\x26userId\x3d"+d,a.startTime&&(c+="\x26endTime\x3d"+a.startTime),f={id:d}):(c=a.pageSize?"\x26mainPageSize\x3d"+a.pageSize:"\x26mainPageSize\x3d50",a.startTime&&(c+="\x26endTime\x3d"+a.startTime),f={id:""});a.topicId&&(d||a.clientGroupId)&&(a.conversationId&&
(c+="\x26conversationId\x3d"+a.conversationId),a.topicId&&(f.topicId=a.topicId));mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+c,type:"get",global:!1,success:function(d){f.status="success";if("undefined"===typeof d.message||0===d.message.length)f.messages=[];else{var c=[];b.each(d.message,function(b,a){if("undefined"!==typeof a.to||"undefined"!==typeof a.groupId)b=e.getMessageFeed(a),c.push(b)});f.messages=c}0<d.groupFeeds.length&&(f.id=d.groupFeeds[0].id);a.callback(f)},
error:function(b,d,e){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));f.status="error";a.callback(f)}})};a.getReplyMessageByKey=function(b){"undefined"===typeof A.getMessageByKey(b)&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/detail",async:!1,type:"get",data:"keys\x3d"+b,success:function(b){A.updateMckMessageArray(b)}});return A.getMessageByKey(b)};a.loadMessageList=function(a,c){var d=!1,f=!1,k="";"undefined"!==typeof a.tabId&&""!==a.tabId?(k=a.isGroup?"\x26groupId\x3d"+
a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId),d=!0,a.startTime&&(k+="\x26endTime\x3d"+a.startTime),k+="\x26pageSize\x3d30",(Aa||Ka)&&a.conversationId&&(k+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof Z[a.tabId]?(f=!0,k+="\x26conversationReq\x3dtrue"):e.addConversationMenu(a.tabId,a.isGroup))):(Ea=!0,a.startTime&&(k+="\x26endTime\x3d"+a.startTime),k+="\x26mainPageSize\x3d60");a.startTime||r.html("");Q.removeClass("n-vis").addClass("vis");mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+
k,type:"get",global:!1,success:function(k){var m=!0,l=r.data("mck-id"),p=r.data("isgroup");a.isGroup&&!a.startTime||Q.removeClass("vis").addClass("n-vis");Ea=!1;if("undefined"===typeof l||a.tabId===l&&""+p===""+a.isGroup){if("null"===k+""||"undefined"===typeof k.message||0===k.message.length)m=!1,d?a.startTime?(ka.removeClass("n-vis").addClass("vis"),ka.fadeOut(5E3,function(){ka.removeClass("vis").addClass("n-vis")}),va.data("datetime","")):a.isGroup||0!==b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||
(ja.removeClass("vis").addClass("n-vis"),ya.removeClass("vis").addClass("n-vis"),L.removeClass("n-vis").addClass("vis")):(L.removeClass("vis").addClass("n-vis"),a.startTime?(xa.removeClass("n-vis").addClass("vis"),xa.fadeOut(5E3,function(){xa.removeClass("vis").addClass("n-vis")})):(L.removeClass("vis").addClass("n-vis"),ya.removeClass("n-vis").addClass("vis")),r.data("datetime",""));if("null"!==k+""&&"error"!==k.status)if(d){m&&(0<a.startTime?e.processMessageList(k,!1,!0):a.isGroup||(e.processMessageList(k,
!0,!0),ja.removeClass("n-vis").addClass("vis")));0< !a.startTime&&!a.isGroup&&"function"===typeof Wa&&Wa(a.tabId);0<k.userDetails.length&&b.each(k.userDetails,function(b,d){ha[d.userId]=d;a.isGroup||(d.connected?h.MCK_OL_MAP[d.userId]=!0:(h.MCK_OL_MAP[d.userId]=!1,"undefined"!==typeof d.lastSeenAtTime&&(U[d.userId]=d.lastSeenAtTime)),fb||a.isGroup||(d.blockedByThis?(na[d.userId]=!0,T.toggleBlockUser(a.tabId,!0)):d.blockedByOther?(Fa[d.userId]=!0,P.removeClass("mck-tab-title-w-status"),Ta.removeClass("vis").addClass("n-vis"),
E.removeClass("vis").addClass("n-vis"),r.data("blocked",!1)):T.toggleBlockUser(a.tabId,!1)),d.userName&&!a.startTime&&(b=e.getTabDisplayName(a.tabId,a.isGroup,d.userName),P.html(b),P.attr("title",b)))});!gb||a.isGroup||a.startTime||h.MCK_OL_MAP[a.tabId]||cb.manageOfflineMessageTime(a.tabId);if(0<k.conversationPxys.length){var u=[];b.each(k.conversationPxys,function(a,d){if("object"===typeof d&&(u.push(d),N[d.id]=d,sa[d.topicId]=[d.id],d.topicDetail))try{I[d.topicId]=b.parseJSON(d.topicDetail)}catch(Mb){h.console.log("Incorect Topic Detail!")}});
f&&(Z[a.tabId]=u,e.addConversationMenu(a.tabId,a.isGroup))}a.conversationId&&(l=N[a.conversationId],"object"===typeof l&&l.closed&&e.closeConversation());a.startTime||(a.isGroup?(t.addGroupStatus(mckGroupUtils.getGroup(a.tabId)),e.updateUnreadCount("group_"+a.tabId,0,!0)):e.updateUnreadCount("user_"+a.tabId,0,!0),"function"===typeof c&&c(a));0<k.groupFeeds.length&&b.each(k.groupFeeds,function(d,c){d=mckGroupUtils.addGroup(c);if(!a.startTime){var f=[];b.each(c.membersId,function(b,a){"undefined"===
typeof e.getContact(a)&&f.push(a)});if(0<f.length)a.isMessages=m,a.messageData=k,a.isLoadMessageList=!0,aa.getUsersDetail(f,a);else{t.addGroupStatus(d);c=!0;if(7===d.type){da.removeClass("vis").addClass("n-vis");var g=e.getContactFromGroupOfTwo(d);T.lastSeenOfGroupOfTwo(g.contactId)}"kommunicate"!=window.applozic.PRODUCT_ID||3!==d.users[z].role&&2!==d.users[z].role&&0!==d.users[z].role||da.removeClass("vis").addClass("n-vis");6===d.type&&(t.validateOpenGroupUser(d),c=t.isAppendOpenGroupContextMenu(d));
Q.removeClass("vis").addClass("n-vis");m?(L.removeClass("vis").addClass("n-vis"),e.processMessageList(k,!0,c),6!==d.type&&ja.removeClass("n-vis").addClass("vis")):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(ja.removeClass("vis").addClass("n-vis"),L.removeClass("n-vis").addClass("vis"));"function"===typeof Wa&&Wa(a.tabId)}}})}else a.startTime||(h.MCK_OL_MAP=[]),0<k.userDetails.length&&b.each(k.userDetails,function(a,b){ha[b.userId]=b;b.connected?h.MCK_OL_MAP[b.userId]=
!0:(h.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(U[b.userId]=b.lastSeenAtTime));e.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=e.getContact(""+b.userId);"undefined"===typeof a?e.createContactWithDetail(b):e.updateContactDetail(a,b)}),0<k.groupFeeds.length&&b.each(k.groupFeeds,function(b,a){e.updateUnreadCount("group_"+a.id,a.unreadCount,!1);mckGroupUtils.addGroup(a)}),0<k.blockedUserPxyList.blockedToUserList.length&&b.each(k.blockedUserPxyList.blockedToUserList,function(b,
a){a.userBlocked&&(na[a.blockedTo]=!0)}),0<k.blockedUserPxyList.blockedByUserList.length&&b.each(k.blockedUserPxyList.blockedByUserList,function(b,a){a.userBlocked&&(Fa[a.blockedBy]=!0)}),0<k.conversationPxys.length&&b.each(k.conversationPxys,function(a,d){N[d.id]=d;sa[d.topicId]=[d.id];if(d.topicDetail)try{I[d.topicId]=b.parseJSON(d.topicDetail)}catch(Mb){h.console.log("Incorect Topic Detail!")}}),m?(a.startTime?a.startTime&&(a.isReload=!1,d||A.updateLatestMessageArray(k.message)):(a.isReload=!0,
d||A.setLatestMessageArray(k.message)),d&&A.updateMckMessageArray(k.message),e.addContactsFromMessageList(k,a)):r.data("datetime",""),a.isLaunch&&e.updateUnreadCountonChatIcon(k.userDetails)}l=x.data("forwardMessageKey");"undefined"!==typeof l&&(v.sendForwardMessage(l),x.data("forwardMessageKey",""))},error:function(b,a,d){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));Ea=!1;Q.removeClass("vis").addClass("n-vis");h.console.log("Unable to load messages. Please reload page.")}})};
a.updateContactList=function(b,a){var d=a?"groupId\x3d"+b:"userId\x3d"+encodeURIComponent(b);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list",data:"startIndex\x3d0\x26pageSize\x3d1\x26"+d,global:!1,type:"get",success:function(d){"null"===d+""||"undefined"===typeof d.message||0===d.message.length?e.clearContactMessageData(b,a):(d=d.message[0],"undefined"!==typeof d&&(d.groupId?e.addGroupFromMessage(d,!0):e.addContactsFromMessage(d,!0)))},error:function(d,c,f){401===d.status&&(sessionStorage.clear(),
console.log("Please reload page."));e.clearContactMessageData(b,a)}})};a.sendDeliveryUpdate=function(b){mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delivered",data:"key\x3d"+b.pairedMessageKey,global:!1,type:"get",success:function(){},error:function(){}})};a.sendReadUpdate=function(b){"undefined"!==typeof b&&""!==b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read",data:"key\x3d"+b,global:!1,type:"get",success:function(){},error:function(){}})};a.conversationReadUpdate=function(b,a){var d=
a?"group_"+b:"user_"+b;b&&0<e.getUnreadCount(d)&&(b=a?"groupId\x3d"+b:"userId\x3d"+encodeURIComponent(b),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read/conversation",data:b,global:!1,type:"get",success:function(){e.updateUnreadCount(d,0,!0)},error:function(){}}))};a.getConversationId=function(d){if(!d.isGroup&&!d.isMessage&&d.topicStatus!==Y[1]){var c=sa[d.topicId];if(c&&(c=N[c],"object"===typeof c)){r.data("mck-conversationid",c.id);d.conversationId=c.id;if("undefined"!==typeof Z[d.tabId]){var f=
Z[d.tabId];f.push(c);Z[d.tabId]=f}e.loadTab(d);return}}d.topicId&&(c={topicId:d.topicId,userId:d.tabId,status:d.topicStatus},d.isGroup&&(c.supportIds=[],c.supportIds.push(d.supportId)),f=I[d.topicId],"object"===typeof f&&(c.topicDetail=h.JSON.stringify(f)),d.fallBackTemplatesList&&0<d.fallBackTemplatesList.length&&(c.fallBackTemplatesList=d.fallBackTemplatesList),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/id",global:!1,data:h.JSON.stringify(c),type:"post",contentType:"application/json",
success:function(c){if("object"===typeof c&&"success"===c.status){var f=c.response;if("object"===typeof f&&"undefined"!==f.conversationPxy){c=f.conversationPxy;N[c.id]=c;sa[c.topicId]=[c.id];if(c.topicDetail)try{I[c.topicId]=b.parseJSON(c.topicDetail)}catch(Za){h.console.log("Incorect Topic Detail!")}r.data("mck-conversationid",c.id);d.conversationId=c.id;if("undefined"!==typeof Z[d.tabId]){var k=Z[d.tabId];k.push(c);Z[d.tabId]=k}d.isGroup&&(f=mckGroupUtils.addGroup(f),d.tabId=f.contactId);d.isMessage&&
c.created?e.loadTab(d,a.dispatchMessage):e.loadTab(d)}}},error:function(){}}))};a.fetchConversationByTopicId=function(a){var d="topic\x3d"+a.topicId;if(a.tabId)d+="true"===""+a.isGroup?"\x26groupId\x3d"+a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId);else if(a.clientGroupId)d+="\x26clientGroupId\x3d"+a.clientGroupId;else return!1;a.pageSize&&(d+="\x26pageSize\x3d"+a.pageSize);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/get",data:d,type:"get",success:function(d){"object"===typeof d&&
"success"===d.status?(d=d.response,0<d.length&&b.each(d,function(d,e){N[e.id]=e;sa[e.topicId]=[e.id];if(e.topicDetail)try{I[e.topicId]=b.parseJSON(e.topicDetail)}catch(eb){h.console.log("Incorect Topic Detail!")}a.tabId&&"undefined"!==typeof Z[a.tabId]&&(d=Z[a.tabId],d.push(e),Z[a.tabId]=d)}),a.isExtMessageList&&(0<d.length?(a.conversationId=d[0].id,a.pageSize=50,v.getMessageList(a)):"function"===typeof a.callback&&(d={},a.tabId?(d.id=a.tabId,d.isGroup=a.isGroup):a.clientGroupId&&(d.clientGroupId=
a.clientGroupId),d.topicId=a.topicId,d.status="success",d.messages=[],a.callback(d)))):a.isExtMessageList&&"function"===typeof a.callback&&(d={},a.tabId?d.id=a.tabId:a.clientGroupId&&(d.clientGroupId=a.clientGroupId),d.topicId=a.topicId,d.status="error",d.errorMessage="Unable to process request. Please try again.",a.callback(d))},error:function(){if("function"===typeof a.callback){var b={};a.tabId?b.id=a.tabId:a.clientGroupId&&(b.clientGroupId=a.clientGroupId);b.topicId=a.topicId;b.status="error";
b.errorMessage="Unable to process request. Please try again.";a.callback(b)}}})};a.getTopicId=function(d){d.conversationId&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/topicId",data:"id\x3d"+d.conversationId,global:!1,type:"get",async:"undefined"!==typeof d.async?d.async:!0,success:function(c){if("object"===typeof c&&"success"===c.status&&(c=c.response,"object"===typeof c)){sa[c.topicId]=[d.conversationId];N[d.conversationId]=c;if(c.topicDetail)try{I[c.topicId]=b.parseJSON(c.topicDetail)}catch(Ya){h.console.log("Incorect Topic Detail!")}"function"===
typeof Ja&&d.priceText&&(Ja({custId:z,suppId:d.suppId,productId:c.topicId,price:d.priceText}),a.sendConversationCloseUpdate(d.conversationId));if(d.messageType&&"object"===typeof d.message){var f=d.message.groupId?d.message.groupId:d.message.to;if("undefined"!==typeof Z[f]){var k=Z[f];k.push(c);Z[f]=k}("undefined"!==typeof d.populate?d.populate:1)&&e.populateMessage(d.messageType,d.message,d.notifyUser)}"function"===typeof d.callback&&d.callback(c)}},error:function(){}})};a.sendConversationCloseUpdate=
function(a){a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/close",data:"id\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};a.sendPriceMessage=function(){var d=O.val();if(""===d)O.addClass("mck-text-req");else{d=b.trim(d);var e=l.val();r.data("mck-conversationid",f);var c={type:5,contentType:4,message:d};!0===r.data("isgroup")?c.groupId=e:c.to=e;if(r.data("mck-conversationid")){var f=r.data("mck-conversationid");c.conversationId=f;var k=N[f];"object"!==k?a.getTopicId({conversationId:f,
suppId:e,priceText:d}):"function"===typeof Ja&&Ja({custId:z,suppId:e,productId:k.topicId,price:d});O.val("")}a.sendMessage(c)}};a.dispatchMessage=function(d){if("object"===d.messagePxy){var e=d.messagePxy;if(d.topicId){var c=I[d.topicId];if("object"===typeof c&&"undefined"!==c.title)if(e.message||(e.message=b.trim(c.title)),d.conversationId)e.conversationId=d.conversationId;else if(d.topicId){var f={topicId:d.topicId};"object"===typeof c&&(f.topicDetail=h.JSON.stringify(c));e.conversationPxy=f}!e.message&&
c.link&&(c={blobKey:b.trim(c.link),contentType:"image/png"},e.fileMeta=c,e.contentType=5,D=[],D.push(c))}d.isGroup?e.groupId=d.tabId:e.to=d.tabId;a.sendMessage(e)}};a.getGroup=function(d){var c=[];b.each(d.users,function(a,b){"undefined"===typeof b.userId||"undefined"!==typeof b.groupRole&&-1===vb.indexOf(b.groupRole)||c.push(b)});var f={groupName:b.trim(d.groupName),users:c,type:d.type};d.admin&&(f.admin=d.admin);d.clientGroupId&&(f.clientGroupId=d.clientGroupId);d.groupIcon&&(f.imageUrl=d.groupIcon);
f.metadata=d.metadata?d.metadata:MCK_LABELS["group.metadata"];var k={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/group/v2.1/create",global:!1,data:h.JSON.stringify(f),type:"post",contentType:"application/json",success:function(c){d.isInternal&&ta.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);if("object"===typeof c&&"success"===c.status){if(c=c.response,"object"===typeof c){var f=mckGroupUtils.addGroup(c);0<c.users.length&&b.each(c.users,function(a,b){ha[b.userId]=b;b.connected?h.MCK_OL_MAP[b.userId]=
!0:(h.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(U[b.userId]=b.lastSeenAtTime));e.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);a=e.getContact(""+b.userId);"undefined"===typeof a?e.createContactWithDetail(b):e.updateContactDetail(a,b)});d.tabId=f.contactId;d.isGroup=!0;d.isMessage?e.loadTab(d,a.dispatchMessage):d.isInternal?(r.data("mck-id",f.contactId),r.data("isgroup",!0),t.loadGroupInfo({groupId:f.contactId})):e.loadTab(d);"function"===typeof d.callback&&(k.status="success",
k.data=f,d.callback(k))}}else"error"===c.status&&"function"===typeof d.callback&&(k.status="error",k.errorMessage=c.errorResponse[0].description,d.callback(k))},error:function(){d.isInternal&&ta.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);"function"===typeof d.callback&&(k.status="error",k.errorMessage="Unable to process request.",d.callback(k))}})};a.sendVideoCallMessage=function(b,e,c,f){var d="CALL_MISSED"==e?"Missed Call":"CALL_REJECTED"==e?"Call Rejected":"";if(""==d||void 0==
d)d="video message";b={to:l.val(),type:5,contentType:c,message:d,metadata:{MSG_TYPE:e,CALL_ID:b,CALL_AUDIO_ONLY:f},senderName:z};a.sendMessage(b);return b};a.sendVideoCallEndMessage=function(b,e,c,f,k){var d="";k&&(d=mckDateUtils.convertMilisIntoTime(k));d="CALL_MISSED"==e?"Missed Call":"CALL_REJECTED"==e?"Call Rejected":"CALL_END"==e?"Call End \n Duration: "+d:"video message";if(""==d||void 0==d)d="video message";b={to:l.val(),type:5,contentType:c,message:d,metadata:{MSG_TYPE:e,CALL_ID:b,CALL_AUDIO_ONLY:f,
CALL_DURATION:k}};a.sendMessage(b);return b}},aa=new function(){var a=this;b("#mck-search-list");var c=b("#mck-sidebox-search"),l=b("#mck-search-loading");b("#mck-search-cell .mck-message-inner");b("#mck-message-cell .mck-message-inner");b(".mck-tab-message-option");b("#mck-contact-loading");a.getContactDisplayName=function(b){var a=[];if(0<b.length&&b[0]){for(var c="",k=b.filter(function(a,c){return b.indexOf(a)===c}),h=0;h<k.length;h++){var l=k[h];"undefined"===typeof ua[l]&&(c+="userIds\x3d"+encodeURIComponent(l)+
"\x26")}c.lastIndexOf("\x26")===c.length-1&&(c=c.substring(0,c.length-1));c&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/info",data:c,global:!1,type:"get",success:function(b){for(var c in b)b.hasOwnProperty(c)&&(a.push([c,b[c]]),ua[c]=b[c],e.fetchContact(c).displayName=b[c]);A.updateMckContactNameArray(a)},error:function(){}})}};a.loadContacts=function(){var a=[];mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d0\x26pageSize\x3d30\x26orderBy\x3d1",type:"get",global:!1,success:function(f){c.hasClass("vis")&&
("object"===typeof f&&0<f.users.length&&(b.each(f.users,function(b,c){"undefined"!==typeof c.userId&&(b=e.getContact(""+c.userId),b="undefined"===typeof b?e.createContactWithDetail(c):e.updateContactDetail(b,c),Ra.push(b),a.push([c.userId,b.displayName]),c.connected?h.MCK_OL_MAP[c.userId]=!0:(h.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(U[c.userId]=c.lastSeenAtTime)))}),0<a.length&&A.updateMckContactNameArray(a)),e.addContactsToSearchList())},error:function(){l.removeClass("vis").addClass("n-vis");
h.console.log("Unable to load contacts. Please reload page.")}})};a.loadUserProfile=function(b){if("undefined"!==typeof b){var c=[];b=""+b.split(",")[0];c.push(b);a.loadUserProfiles(c)}};a.loadUserProfiles=function(c){var f=[];b.each(c,function(b,a){"undefined"===typeof e.getContact(a)&&f.push(a)});a.getUsersDetail(f,{async:!1})};a.getUsersDetail=function(a,c){if(!("undefined"===typeof a||1>a.length)){for(var f="undefined"!==typeof c.cached?c.cached:!0,k=[],l=a.filter(function(b,c){return a.indexOf(b)===
c}),n=0;n<l.length;n++){var x=l[n];f&&"undefined"!==typeof ha[x]||k.push(x)}if(0===k.length)c.setStatus?T.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);else{var y={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/v2/detail",type:"post",async:"undefined"!==typeof c.async?c.async:!0,data:JSON.stringify({userIdList:k}),contentType:"application/json",success:function(a){"success"===a.status&&0<a.response.length&&
b.each(a.response,function(b,a){ha[a.userId]=a;h.MCK_OL_MAP[a.userId]=a.connected;b=e.getContact(""+a.userId);"undefined"===typeof b?e.createContactWithDetail(a):e.updateContactDetail(b,a)});c.setStatus?T.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);y.status="success";y.data=a;c.callback&&c.callback(y)},error:function(){c.setStatus?T.updateUserConnectedStatus():c.message?e.populateMessage(c.messageType,
c.message,c.notifyUser):c.isLoadMessageList&&e.loadMessageListOnUserDetailFetch(c);y.status="error";c.callback&&c.callback(y)}})}}};a.getUserStatus=function(a){var c={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/chat/status",type:"get",success:function(f){0<f.users.length&&(Sa=[],b.each(f.users,function(a,b){a=e.getContact(""+b.userId);a="undefined"===typeof a?e.createContactWithDetail(b):e.updateContactDetail(a,b);Sa.push(a.contactId)}));c.status="success";c.data=f;a.callback&&a.callback(c)},
error:function(){c.status="error";a.callback&&a.callback(c)}})};a.blockUser=function(a,b){a&&"undefined"!==typeof b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:"userId\x3d"+a+"\x26block\x3d"+b,success:function(c){"object"===typeof c&&"success"===c.status&&(na[a]=b,T.toggleBlockUser(a,b))},error:function(){}})};a.updateUserIdentity=function(a){null!==a.newUserId&&""!==a.newUserId&&mckUtils.ajax({url:MCK_BASE_URL+"rest/ws/user/change/identifier",type:"get",data:{newUserId:a.newUserId},
success:function(b){"object"===typeof b&&"success"===b.status&&(console.log(b),z=a.newUserId,a.callback&&a.callback(b))},error:function(b){a.callback&&a.callback(b)}})}},hb=new function(){var a=this,c,h,l,f,n,q,y,t;a.init=function(){b("#mck-sidebox");h=b("#mck-msg-preview");n=b("#mck-group-info-tab");b("#mck-sidebox-launcher");c=b("#mck-message-cell .mck-message-inner");l=b("#mck-msg-preview .mck-preview-icon");f=b("#mck-msg-preview .mck-preview-cont-name");y=b("#mck-msg-preview .mck-preview-msg-content");
t=b("#mck-msg-preview .mck-preview-file-content")};a.notifyUser=function(b){if(7!==b.type){var c=b.groupId?mckGroupUtils.getGroup(""+b.groupId):e.fetchContact(""+b.to.split(",")[0]),f=!1;b.groupId&&(f=!0);aa.loadUserProfile(b.to);f=e.getTabDisplayName(c.contactId,f);var k=hc;a.showNewMessageNotification(b,c,f);if(Yb&&!sb){var h=jc;b=e.getTextForMessagePreview(b,c);"function"!==typeof Pa||c.isGroup||(c=Pa(c.contactId))&&"undefined"!==typeof c&&(h=c);mckNotificationUtils.sendDesktopNotification(f,h,
b,k)}}};a.showNewMessageNotification=function(b,a,k){if(Zb&&102!==b.contentType){var q=c.data("mck-id"),x=c.data("isgroup");if(q===a.contactId&&x===a.isGroup&&!n.hasClass("vis"))if(b.conversationId&&(Aa||Ka)){if(q=c.data("mck-conversationid"),q="undefined"!==typeof q&&""!==q?q.toString():"",q===b.conversationId.toString())return}else return;h.data("isgroup",a.isGroup);h.data("mck-conversationid",b.conversationId?b.conversationId:"");q=e.getContactImageLink(a,k);b.message?(x=e.getMessageTextForContactPreview(b,
a,50),y.html(""),"object"===typeof x?y.append(x):y.html(x),y.removeClass("n-vis").addClass("vis")):y.html("");b.fileMetaKey?(t.html(e.getFileIcon(b)),t.removeClass("n-vis").addClass("vis"),""===y.html()&&y.removeClass("vis").addClass("n-vis")):(t.html(""),t.removeClass("vis").addClass("n-vis"));f.html(k);l.html(q);h.data("mck-id",a.contactId);h.show();setTimeout(function(){h.fadeOut(3E3)},1E4)}};a.unsubscribeToServiceWorker=function(){q&&navigator.serviceWorker.ready.then(function(b){q.unsubscribe().then(function(b){q=
null;console.log("Unsubscribed to notification successfully")})})};a.sendSubscriptionIdToServer=function(){if(q){var b=q.endpoint.split("/").slice(-1)[0];b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/plugin/update/sw/id",type:"post",data:"registrationId\x3d"+b,success:function(b){},error:function(b,a,c){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."))}})}};a.subscribeToServiceWorker=function(){$b&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",
{scope:"./"}),navigator.serviceWorker.ready.then(function(b){b.pushManager.subscribe({userVisibleOnly:!0}).then(function(b){console.log("The reg ID is:: ",b.endpoint.split("/").slice(-1));q=b;a.sendSubscriptionIdToServer()})}))}},Ha=b(".chat-launcher-icon"),da=new function(){var a=this;a.token=null;a.Identity=null;a.outgoingCallServices=null;a.incomingCallServices=null;var c=b(".mck-videocall-btn"),h=b(".applozic-vid-container"),l=b("#mck-sidebox"),f=b("#mck-video-call-indicator");a.hideVideoBox=
function(){h.addClass("n-vis").removeClass("vis");l.addClass("vis").removeClass("n-vis");f.addClass("n-vis").removeClass("vis")};a.init=function(){Ca.loop=!0;a.token=null!==A.getAppHeaders()?A.getAppHeaders().videoToken:void 0;a.ringToneForHost=Da.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",Ca);b("#mck-btn-video-call").on("click",function(c){if(a.token){c=z+(new Date).getTime().toString()+Math.random().toString(36).slice(2);var f=v.sendVideoCallMessage(c,
"CALL_DIALED",102,!1),k=e.fetchContact(f.to);f=e.getTabDisplayName(k.contactId,!1);k=e.getContactImageLink(k,f);var h=new Date;a.outgoingCallServices=new MckCallingService(z,da.token,c,f,!0,h,v,k,!1,a.ringToneForHost);a.outgoingCallServices.startVideoCall();b("#mck-btn-video-call").data("isCallHost",!0);b("#mck-btn-video-call").data("callStartTime",h)}else alert("missing token... please refresh page..")});b("#mck-vid-receive-btn").on("click",function(a){console.log("call received");$("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");
c.removeClass("vis").addClass("n-vis");a=b("#mck-video-call-indicator").data("call-id");var e=b("#mck-video-call-indicator").data("isAudioCall");b("#mck-video-call-indicator").data("callReceived",!0);b("#mck-video-call-indicator").addClass("n-vis");da.callReceived(a,e)});b("#mck-vid-reject-btn").on("click",function(a){console.log("call rejected");a=b("#mck-video-call-indicator").data("call-id");var c=b("#mck-video-call-indicator").data("isAudioCall");da.callRejected(a,c);b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};
a.InitilizeVideoClient=function(c,e){a.Identity=c;b.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:c,device:e},success:function(b){if(null!=b&&""!=b){a.token=b.token;var c=A.getAppHeaders();c.videoToken=b.token;A.setAppHeaders(c)}},error:function(b){console.log("error while getting token"+b)}})};a.callReceived=function(b,c){console.log("_this.callReceived");la&&la.stop();v.sendVideoCallMessage(b,"CALL_ANSWERED",102,c);a.incomingCallServices=
new MckCallingService(a.Identity,a.token,b,null,!1,null,v,null,c);a.incomingCallServices.startVideoCall()};a.callRejected=function(b,a){la&&la.stop();v.sendVideoCallMessage(b,"CALL_REJECTED",102,a)}},hc=null,Ca={},Da,la=null,gc=c.isAnonymousChat,qb=c.groupName,Va=c.agentId;h.MCK_OL_MAP=[];l.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},
onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};l.loadConversationWithAgent=function(b){if(b&&b.agentId)console.log("setting default agent inside Applozic"),v.loadConversationWithAgents(b);else throw Error("params are empty");};var W=
new function(a){var c=this,l=a.events,n=null,f=null,G="",q=null,H=[],E,B,P="",M=b("#mck-sidebox"),D=b("#mck-tab-title"),K=b(".mck-typing-box"),F=b("#mck-tab-status");b("#mck-offline-message-box");var O=b("#mck-typing-label"),C=b("#mck-message-cell .mck-message-inner");c.init=function(){if("undefined"!==typeof kb){var b=mckUtils.startsWith(kb,"https")?"15675":"15674";"function"===typeof h.SockJS&&(P||(P=new SockJS(kb+":"+b+"/stomp")),f=h.Stomp.over(P),f.heartbeat.outgoing=0,f.heartbeat.incoming=0,
f.onclose=function(){c.disconnect()},f.connect("guest","guest",c.onConnect,c.onError,"/"),h.addEventListener("beforeunload",function(b){c.disconnect()}))}};c.checkConnected=function(b){f.connected?(E&&clearInterval(E),B&&clearInterval(B),E=setInterval(function(){c.connectToSocket(b)},6E5),B=setInterval(function(){c.sendStatus(1)},12E5)):c.connectToSocket(b)};c.connectToSocket=function(b){if(!f.connected){if(b&&"block"===M.css("display"))if(b=C.data("mck-id")){var a=C.data("isgroup"),k=C.data("mck-conversationid"),
h=C.data("mck-topicid");A.clearMckMessageArray();e.loadTab({tabId:b,isGroup:a,conversationId:k,topicId:h})}else A.clearMckMessageArray(),e.loadTab({tabId:"",isGroup:!1});c.init()}};c.stopConnectedCheck=function(){E&&clearInterval(E);B&&clearInterval(B);B=E="";c.disconnect()};c.disconnect=function(){f&&f.connected&&(c.sendStatus(0),f.disconnect())};c.unsubscibeToTypingChannel=function(){f&&f.connected&&q&&(1===ma&&c.sendTypingStatus(0,G),q.unsubscribe());q=null};c.unsubscibeToNotification=function(){f&&
f.connected&&n&&n.unsubscribe();n=null};c.subscibeToTypingChannel=function(b,a){b=a?b:z;f&&f.connected?q=f.subscribe("/topic/typing-"+V+"-"+b,c.onTypingStatus):c.reconnect()};c.subscribeToOpenGroup=function(b){if(f&&f.connected){var a=f.subscribe("/topic/group-"+V+"-"+b.contactId,c.onOpenGroupMessage);H.push(a.id);ub[b.contactId]=a.id}else c.reconnect()};c.sendTypingStatus=function(b,a){if(f&&f.connected){1===b&&1===ma&&f.send("/topic/typing-"+V+"-"+G,{"content-type":"text/plain"},V+","+z+","+b);
if(a){if(a===G&&b===ma&&1===b)return;G=a;f.send("/topic/typing-"+V+"-"+a,{"content-type":"text/plain"},V+","+z+","+b);setTimeout(function(){ma=0},6E4)}else 0===b&&f.send("/topic/typing-"+V+"-"+G,{"content-type":"text/plain"},V+","+z+","+b);ma=b}};c.onTypingStatus=function(b){if(null!=q&&q.id===b.headers.subscription){var a=b.body,c=a.split(",")[1];a=Number(a.split(",")[2]);b=b.headers.destination.substring(b.headers.destination.lastIndexOf("-")+1,b.headers.destination.length);var f=C.data("mck-id"),
k=C.data("isgroup"),h=mckGroupUtils.getGroup(f);if(!na[c]&&!Fa[c])if(1===a){if(!(z===c&&k||f!==c&&f!==b)){if(k=C.data("isgroup")){if(c!==z){if(t.authenticateGroupUser(h)||6===h.type&&!ia.disableChatForNonGroupMember)D.addClass("mck-tab-title-w-typing"),F.removeClass("vis").addClass("n-vis"),c=e.getTabDisplayName(c,!1),c=c.split(" ")[0],O.html(c+" "+MCK_LABELS["is.typing"]);7===h.type&&(D.addClass("mck-tab-title-w-typing"),O.html(MCK_LABELS["is.typing"]),F.html(""))}}else D.addClass("mck-tab-title-w-typing"),
F.removeClass("vis").addClass("n-vis"),O.html(MCK_LABELS.typing);K.removeClass("n-vis").addClass("vis");setTimeout(function(){D.removeClass("mck-tab-title-w-typing");K.removeClass("vis").addClass("n-vis");D.hasClass("undefined"===typeof h||7!=h.type)&&F.removeClass("n-vis").addClass("vis");O.html(MCK_LABELS.typing)},6E4)}}else D.removeClass("mck-tab-title-w-typing"),K.removeClass("vis").addClass("n-vis"),!D.hasClass("mck-tab-title-w-status")||"undefined"!==typeof h&&7==h.type||F.removeClass("n-vis").addClass("vis"),
O.html(MCK_LABELS.typing)}};c.reconnect=function(){c.unsubscibeToTypingChannel();c.unsubscibeToNotification();c.disconnect();c.init()};c.onError=function(b){h.console.log("Error in channel notification. "+b);l.onConnectFailed()};c.sendStatus=function(b){f&&f.connected&&f.send("/topic/status-v2",{"content-type":"text/plain"},y+","+fa+","+b)};c.onConnect=function(){f.connected?(n&&c.unsubscibeToNotification(),n=f.subscribe("/topic/"+y,c.onMessage),c.sendStatus(1),c.checkConnected(!0)):setTimeout(function(){n=
f.subscribe("/topic/"+y,c.onMessage);c.sendStatus(1);c.checkConnected(!0)},5E3);l.onConnect()};c.onOpenGroupMessage=function(a){if(-1!==H.indexOf(a.headers.subscription)){var c=b.parseJSON(a.body),f=c.type;a=c.message;if("APPLOZIC_03"===f)A.updateLatestMessage(a),0!==a.type&&4!==a.type&&(b("."+a.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(a.key)),l.onMessageSentUpdate({messageKey:a.key});else if("APPLOZIC_01"===f||"APPLOZIC_02"===f||"MESSAGE_RECEIVED"===
f){A.updateLatestMessage(a);var k=a.groupId?mckGroupUtils.getGroup(a.groupId):e.getContact(a.to);b("#mck-sidebox-content");C.data("mck-id");if("APPLOZIC_01"===f||"MESSAGE_RECEIVED"===f){var h=e.getMessageFeed(a);l.onMessageReceived({message:h})}else"APPLOZIC_02"===f&&(h=e.getMessageFeed(a),l.onMessageSent({message:h}));a.conversationId&&(h=N[a.conversationId],!Aa&&!Ka||"object"===typeof h&&"object"===typeof I[h.topicId]||v.getTopicId({conversationId:a.conversationId,messageType:f,message:a,notifyUser:c.notifyUser,
async:!1,populate:!1}));"undefined"===typeof k?(c={message:a,messageType:f,notifyUser:c.notifyUser},a.groupId?t.getGroupFeedFromMessage(c):(f=[],f.push(a.to),aa.getUsersDetail(f,c))):e.populateMessage(f,a,c.notifyUser)}}};c.onMessage=function(a){if(null!=n&&n.id===a.headers.subscription){a=b.parseJSON(a.body);var c=a.type;if("APPLOZIC_04"===c||"MESSAGE_DELIVERED"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),
e.addTooltip(a.message.split(",")[0]),l.onMessageDelivered({messageKey:a.message.split(",")[0]});else if("APPLOZIC_08"===c||"MT_MESSAGE_DELIVERED_READ"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),e.addTooltip(a.message.split(",")[0]),l.onMessageRead({messageKey:a.message.split(",")[0]});else if("APPLOZIC_05"===c){var f=a.message.split(",")[0],k=a.message.split(",")[1],
m="1"===a.message.split(",")[2]?!0:!1;e.removedDeletedMessage(f,k,m);a={messageKey:a.message.split(",")[0]};m?a.groupId=k:a.userKey=k;console.log(a);l.onMessageDeleted(a)}else if("APPLOZIC_27"===c)f=a.message.split(",")[0],a=a.message.split(",")[1],"undefined"!==typeof f&&(e.removeConversationThread(f,!1),e.updateUnreadCount("user_"+f,0,!0),k={userId:f},a&&(k.topicId=a),l.onConversationDeleted(k));else if("APPLOZIC_11"===c){f=a.message;m=e.fetchContact(f);k=C.data("mck-id");if(!na[f]&&!Fa[f]){if(k!==
m.contactId||C.data("isgroup")){var y=mckContactUtils.formatContactId(f);b("#li-user-"+y+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else b("#mck-tab-status").html(MCK_LABELS.online),gb&&e.hideOfflineMessage();b(".mck-user-ol-status."+y).removeClass("n-vis").addClass("vis");b(".mck-user-ol-status."+y).next().html("("+MCK_LABELS.online+")");h.MCK_OL_MAP[f]=!0;T.updateUserStatus({userId:a.message,status:1})}l.onUserConnect({userId:a.message})}else if("APPLOZIC_12"===c)f=a.message.split(",")[0],
a=a.message.split(",")[1],m=e.fetchContact(f),h.MCK_OL_MAP[f]=!1,a&&(U[f]=a),na[f]||Fa[f]||(k=C.data("mck-id"),k!==m.contactId||C.data("isgroup")||(b("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(a)),gb&&cb.manageOfflineMessageTime(k)),b(".mck-user-ol-status."+m.htmlId).removeClass("vis").addClass("n-vis"),b(".mck-user-ol-status."+m.htmlId).next().html("(Offline)"),b("#li-user-"+y+" .mck-ol-status").removeClass("vis").addClass("n-vis"),T.updateUserStatus({userId:f,status:0,lastSeenAtTime:a})),
l.onUserDisconnect({userId:f,lastSeenAtTime:a});else if("APPLOZIC_29"===c){f=a.message.split(",")[0];a=a.message.split(",")[1];m=e.fetchContact(f);e.updateUnreadCount("user_"+m.contactId,0,!0);k=C.data("mck-id");if("undefined"===typeof k||""===k)b("#li-user-"+m.htmlId+" .mck-unread-count-text").html(e.getUnreadCount("user_"+m.contactId)),b("#li-user-"+m.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");k={userId:f};a&&(k.topicId=a);l.onConversationReadFromOtherSource(k)}else if("APPLOZIC_28"===
c)f=a.message.split(",")[0],a=a.message.split(",")[1],k=C.data("mck-id"),k===f&&(b(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),b(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),m=e.getContact(f),"undefined"===typeof m&&(k=[],k.push(f),aa.getUsersDetail(k,{}))),k={userId:f},a&&(k.topicId=a),l.onConversationRead(k);else if("APPLOZIC_16"===c)c=a.message.split(":")[0],
f=a.message.split(":")[1],m=e.fetchContact(f),k=C.data("mck-id"),k===m.contactId?c===cc[0]?(na[m.contactId]=!0,T.toggleBlockUser(k,!0)):(Fa[m.contactId]=!0,D.removeClass("mck-tab-title-w-status"),F.removeClass("vis").addClass("n-vis"),K.removeClass("vis").addClass("n-vis")):b("#li-user-"+m.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),l.onUserBlocked({status:c,userId:f});else if("APPLOZIC_17"===c){c=a.message.split(":")[0];f=a.message.split(":")[1];m=e.fetchContact(f);k=C.data("mck-id");
if(k===m.contactId)if(c===cc[2])na[m.contactId]=!1,T.toggleBlockUser(k,!1);else{if(h.MCK_OL_MAP[k]||U[k])Fa[m.contactId]=!1,na[k]||(h.MCK_OL_MAP[k]?F.html(MCK_LABELS.online):U[k]&&F.html(mckDateUtils.getLastSeenAtStatus(U[k])),D.addClass("mck-tab-title-w-status"),F.removeClass("n-vis").addClass("vis"))}else h.MCK_OL_MAP[k]&&b("#li-user-"+m.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis");l.onUserUnblocked({status:c,userId:f})}else if("APPLOZIC_18"===c)fb=!1,l.onUserActivated();else if("APPLOZIC_19"===
c)fb=!0,l.onUserDeactivated();else if(f=a.message,"APPLOZIC_03"===c)A.updateLatestMessage(f),0!==f.type&&4!==f.type&&(b("."+f.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),e.addTooltip(f.key)),l.onMessageSentUpdate({messageKey:f.key});else if("APPLOZIC_01"===c||"APPLOZIC_02"===c||"MESSAGE_RECEIVED"===c)A.updateLatestMessage(f),m=f.groupId?mckGroupUtils.getGroup(f.groupId):e.getContact(f.to),b("#mck-sidebox-content"),k=C.data("mck-id"),"APPLOZIC_01"===c||"MESSAGE_RECEIVED"===
c?(k=e.getMessageFeed(f),l.onMessageReceived({message:k})):"APPLOZIC_02"===c&&(k=e.getMessageFeed(f),l.onMessageSent({message:k})),f.conversationId&&(k=N[f.conversationId],!Aa&&!Ka||"object"===typeof k&&"object"===typeof I[k.topicId]||v.getTopicId({conversationId:f.conversationId,messageType:c,message:f,notifyUser:a.notifyUser,async:!1,populate:!1})),"undefined"===typeof m?(a={message:f,messageType:c,notifyUser:a.notifyUser},f.groupId?t.getGroupFeedFromMessage(a):(k=[],k.push(f.to),aa.getUsersDetail(k,
a))):(102==f.contentType&&Oa&&(a.notifyUser=!1,4==f.type&&"CALL_DIALED"==f.metadata.MSG_TYPE?(m=e.fetchContact(f.to),k=e.getTabDisplayName(m.contactId,!1),m=e.getContactImageLink(m,k),b("#mck-video-call-indicator").data("call-id",f.metadata.CALL_ID),b("#mck-video-call-indicator").data("isAudioCall",f.metadata.CALL_AUDIO_ONLY),b("#mck-video-call-indicator-txt").html(k+" calling..."),b("#mck-video-call-icon").html(m),b("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),la.play(),setTimeout(function(){b("#mck-video-call-indicator").data("callReceived")||
(console.log("call is not answered"),la.stop(),b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==f.type&&"CALL_REJECTED"==f.metadata.MSG_TYPE&&b("#mck-btn-video-call").data("isCallHost")&&(v.sendVideoCallMessage(f.metadata.CALL_ID,"CALL_REJECTED",103,!1),da.ringToneForHost.stop(),da.outgoingCallServices.twilioService.leaveRoomIfJoined(),da.hideVideoBox(),da.outgoingCallServices&&(da.outgoingCallServices.rejectedByReceiver=!0))),103==f.contentType?4==f.type&&"CALL_MISSED"==
f.metadata.MSG_TYPE&&(b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),la&&la.stop()):e.populateMessage(c,f,a.notifyUser))}}}(l);l.getOptions=function(){return c};l.init=function(){Ca.loop=!1;Da=new RingToneService;hc=Da.loadRingTone(kc,Ca);v.init();ka.init();cb.initializeApp(c,!1);hb.init();Ib.init();e.initEmojis();Oa&&(Ca.loop=!0,Da=new RingToneService,la=Da.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",Ca),da.init())};l.reInit=function(a){"object"===
b.type(a)&&(a=b.extend(!0,{},M,a),b.fn.applozic("reset",a),a.userId&&a.appId&&""!==b.trim(a.userId)&&""!==b.trim(a.appId)?(cb.initializeApp(a,!0),c=a):h.console("Oops! looks like incorrect application id or user Id."))};l.loadTabView=function(a){"undefined"===typeof a.isGroup&&(a.isGroup=!1);e.loadTab(a);b("#mck-search").val("")};l.loadTab=function(a){e.loadTab({tabId:a,isGroup:!1});b("#mck-search").val("")};l.loadChat=function(a){if(!("undefined"!==typeof a.userId&&""!==a.userId||"undefined"!==typeof a.groupId&&
""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId))return"UserId or groupId or clientGroupId required";var c={};a.userId&&(c.tabId=userId,c.isGroup=!1);a.displayName&&(c.userName=a.displayName);a.convId&&(c.conversationId=a.convId);if(a.groupId||a.clientGroupId)if(c.isGroup=!0,a.clientGroupId){c.clientGroupId=a.clientGroupId;var h=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);if("object"===typeof h)c.tabId=h.contactId;else{mckGroupService.getGroupFeed({clientGroupId:c.clientGroupId,
apzCallback:t.onGroupFeed,callback:t.loadGroupTab});b("#mck-search").val("");return}}else if(h=mckGroupUtils.getGroup(a.groupId),"object"===typeof h)c.tabId=a.groupId;else{mckGroupService.getGroupFeed({groupId:a.groupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});b("#mck-search").val("");return}e.loadTab(c);b("#mck-search").val("")};l.uploadFile=function(a){ka.uploadFile(a)};l.audioAttach=function(a){ka.audioRecoder(a)};l.loadGroupTab=function(a){if("undefined"===typeof a||""===a)return"GroupId required";
"object"===typeof mckGroupUtils.getGroup(a)?(e.loadTab({tabId:a,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({groupId:a,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};l.loadGroupTabByClientGroupId=function(a){if("undefined"===typeof a.clientGroupId||""===a.clientGroupId)return"Client Group Id Required";var c=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);"object"===typeof c?(e.loadTab({tabId:c.contactId,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({clientGroupId:a.clientGroupId,
apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};l.loadConvTab=function(a){"object"===typeof a&&a.userId&&a.convId&&e.loadTab({tabId:a.userId,conversationId:a.convId,isGroup:!1})};l.loadTabWithTopic=function(a){if("object"===typeof a&&a.userId&&a.topicId){var b={tabId:a.userId,topicId:a.topicId};a.userName&&(b.userName=a.userName);b.topicStatus=a.topicStatus?-1===Y.indexOf(a.topicStatus)?Y[0]:a.topicStatus.toString():Y[0];if("function"===typeof za){var c=za(a.topicId);"object"===typeof c&&"undefined"!==
c.title&&(I[a.topicId]=c)}a.message?(b.messagePxy={type:5,contentType:0,message:message},b.isMessage=!0):b.isMessage=!1;a.supportId?(b.isGroup=!0,b.supportId=supportId):b.isGroup=!1;v.getConversationId(b)}else{if(!a.userId)return"UserId required";if(!a.topicId)return"TopicId required"}};l.loadContacts=function(a){e.loadContacts(a)};l.setOffline=function(){"undefined"!==typeof W&&W.sendStatus(0)};l.reset=function(a){h.sessionStorage.clear();H=y="";D=[];MCK_GROUP_MAP=[];rb=!0;ra=[];fa="";tb=a.mode;
na=[];Fa=[];Ea=!1;xa=90;V=a.appId;U=[];N=[];I=[];MCK_CLIENT_GROUP_MAP=[];sb=!0;MCK_LABELS=a.labels;K=0;MCK_BASE_URL=a.baseUrl;oa={};Qa=[];ab=a.launcher;ub=[];Ob=a.userName;lb=a.visitor;sa=[];Ra=[];La={};E=a.fileBaseUrl;bb=a.locShare;Oa=c.video;F=a.onInit;xb=a.onTopicDetails;ua=[];Ga=[];yb=a.onClose;O=a.accessToken;zb=a.displayText;Wa=a.readConversation;ta=a.maxGroupSize;Z=[];Ab=a.onTabClicked;Pb=a.contactNumber;Bb=a.appModuleName;za=a.getTopicDetail;ya=a.maxAttachmentSize;Cb=a.validateMessage;Xa=
a.contactDisplayName;Sa=[];Ja=a.finalPriceResponse;Pa=a.contactDisplayImage;Db=a.priceWidget;ia=c.openGroupSettings;ba=a.offlineMessageDetail;Eb=a.getConversationDetail;mb=a.authenticationTypeId;z=lb?"guest":b.trim(a.userId);Rb=bb?a.googleApiKey:"NO_ACCESS";nb="boolean"===typeof a.olStatus?a.olStatus:!1;Ka="boolean"===typeof a.topicBox?a.topicBox:!1;gb="boolean"===typeof a.showOfflineMessage?a.showOfflineMessage:!1;Aa="boolean"===typeof a.topicHeader?a.topicHeader:!1;Zb="boolean"===typeof a.notification?
a.notification:!0;$b="boolean"===typeof a.swNotification?a.swNotification:!1;Xb=a.supportId?'data-mck-id\x3d"'+a.supportId+'"':"";Tb="boolean"===typeof a.hideGroupSubtitle?a.hideGroupSubtitle:!1;Ub="undefined"===typeof a.defaultMessageMetaData?{}:a.defaultMessageMetaData;Fb="boolean"===typeof a.groupUserCount?a.groupUserCount:!1;Yb="boolean"===typeof a.desktopNotification?a.desktopNotification:!1;Gb="boolean"===typeof a.loadOwnContacts?a.loadOwnContacts:!1;Sb="boolean"===typeof a.messageBubbleAvator?
a.messageBubbleAvator:!1;Wb="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1;ob="boolean"===typeof a.launchOnNewMessage?a.launchOnNewMessage:!1;ac="boolean"===typeof a.autoTypeSearchEnabled?a.autoTypeSearchEnabled:!0;Vb="boolean"===typeof a.checkUserBusyWithStatus?a.checkUserBusyWithStatus:!1;Hb="boolean"===typeof a.launchOnUnreadMessage?a.launchOnUnreadMessage:!1;gc=c.isAnonymousChat};l.logout=function(){"undefined"!==typeof W&&(W.disconnect(),A.clearMckMessageArray(),b.fn.applozic("reset",
c),b("#mck-sidebox").hide(),b("#mck-sidebox-launcher").hide());rb=!1};l.setOnline=function(){"undefined"!==typeof W&&W.sendStatus(1)};l.getUserStatus=function(a){"function"===typeof a.callback&&("undefined"!==typeof a.userIds?aa.getUsersDetail(a.userIds,a):aa.getUserStatus(a))};l.getGroupList=function(a){return"function"===typeof a.callback?(a.apzCallback=t.loadGroups,mckGroupService.loadGroups(a),"success"):"Callback Function Required"};l.leaveGroup=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";
if("function"===typeof a.callback){if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)return a.apzCallback=t.onGroupLeft,mckGroupService.leaveGroup(a),"success";a.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};l.addGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&
""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else if("undefined"!==typeof a.role&&-1===vb.indexOf(a.role))a.callback({status:"error",errorMessage:"Incorrect member role"});else return aa.loadUserProfile(a.userId),a.apzCallback=t.onAddedGroupMember,mckGroupService.addGroupMember(a),"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});
else return"Callback function required"};l.removeGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else return a.apzCallback=t.onRemovedGroupMember,mckGroupService.removeGroupMember(a),"success";else a.callback({status:"error",
errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.updateGroupInfo=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){if("undefined"!==typeof a.name&&""!==a.name||"undefined"!==typeof a.imageUrl&&""!==a.imageUrl||a.users&&0!==a.users.length){if(a.users&&0<a.users.length){var c=[];
b.each(a.users,function(a,b){b.userId&&"undefined"!==typeof b.role&&-1!==vb.indexOf(b.role)&&c.push(b)});if(0===c.length){a.callback({status:"error",errorMessage:"Incorrect users detail"});return}}c=[];b(".mck-group-change-role-box.vis").each(function(a,e){a=b(this);e=parseInt(a.find("select").val());var f=a.parents(".mck-li-group-member").data("role");e!==f&&(a={userId:a.parents(".mck-li-group-member").data("mck-id"),role:e},c.push(a))});a.apzCallback=t.onUpdateGroupInfo;mckGroupService.updateGroupInfo(a);
return"success"}a.callback({status:"error",errorMessage:"Group properties required"})}else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.getMessages=function(a){"function"===typeof a.callback&&v.getMessages(a)};l.getMessageList=function(a){return"undefined"!==typeof a&&"function"===typeof a.callback?(v.getMessageList(a),"success"):"Callback function required"};l.getMessageListByTopicId=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";
if("function"===typeof a.callback)if("undefined"!==typeof a.id&&""!==a.id||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if(a.id&&"boolean"!==typeof a.isGroup)a.callback({status:"error",errorMessage:"IsGroup parameter required"});else{if(a.topicId){a.id&&(a.tabId=a.id);a.topicStatus=Y[0];var b=sa[a.topicId];b&&"object"===typeof N[b]?(a.conversationId=b,v.getMessageList(a)):(a.isExtMessageList=!0,a.pageSize=1,v.fetchConversationByTopicId(a));return"success"}a.callback("TopicId required")}else a.callback({status:"error",
errorMessage:"Id or clientGroupId required"});else return"Callback function required."};l.sendMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},ea,a);var c=a.message;if(!a.to)return"To field required";if("undefined"===typeof c||""===c)return"Message field required";if(12<a.type)return"Invalid message type";c=b.trim(c);a={to:b.trim(a.to),type:a.messageType,contentType:a.type,message:c};v.sendMessage(a);return"success"}return"Unsupported format. Please check format"};l.updateUserIdentity=
function(a){aa.updateUserIdentity(a)};l.sendGroupMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},ea,a);var c=a.message;if(!a.groupId&&!a.clientGroupId)return"groupId or clientGroupId required";if("undefined"===typeof c||""===c)return"message field required";if(12<a.type)return"invalid message type";c=b.trim(c);c={type:a.messageType,contentType:a.type,message:c};if(a.groupId)c.groupId=b.trim(a.groupId);else if(a.clientGroupId){if("undefined"===typeof mckGroupUtils.getGroupByClientGroupId(a.clientGroupId))return"group not found";
c.clientGroupId=b.trim(a.clientGroupId)}v.sendMessage(c);return"success"}return"Unsupported format. Please check format"};l.addWelcomeMessage=function(a){if("object"===typeof a){if("undefined"===typeof a.sender||""===a.sender)return"Sender Field Required";if("undefined"===typeof a.messageContent||""===a.messageContent)return"Message Content Required";v.sendWelcomeMessage(a)}else return"Unsupported format. Please check format"};l.createGroup=function(a){if("object"===typeof a){if("function"===typeof a.callback){var b=
a.users;if("undefined"===typeof b||1>b.length){a.callback({status:"error",errorMessage:"Users list required"});return}if(b.length>ta){a.callback({status:"error",errorMessage:"Users limit exceeds "+ta+". Max number of users allowed is "+ta+"."});return}if(!a.groupName){a.callback({status:"error",errorMessage:"Group name required"});return}if("undefined"===typeof a.type||""===a.type){a.callback({status:"error",errorMessage:"Group type required"});return}if(-1===wb.indexOf(a.type)){a.callback({status:"error",
errorMessage:"Invalid group type"});return}v.getGroup(a);return"success"}return"Callback function required"}return"Unsupported Format. Please check format"};l.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";if(b.length>ta)return"Users limit exceeds "+ta+". Max number of users allowed is "+ta+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===wb.indexOf(a.type))return"Invalid group type";
v.getGroup(a);return"success"}return"Unsupported format. Please check format"};l.getTotalUnreadCount=function(){return K};l.subscribeToEvents=function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(l.events.onConnectFailed=a.onConnectFailed),"function"===typeof a.onConnect&&(l.events.onConnect=a.onConnect),"function"===typeof a.onMessageDelivered&&(l.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(l.events.onMessageRead=a.onMessageRead),"function"===
typeof a.onMessageDeleted&&(l.events.onMessageDeleted=a.onMessageDeleted),"function"===typeof a.onConversationDeleted&&(l.events.onConversationDeleted=a.onConversationDeleted),"function"===typeof a.onUserConnect&&(l.events.onUserConnect=a.onUserConnect),"function"===typeof a.onUserDisconnect&&(l.events.onUserDisconnect=a.onUserDisconnect),"function"===typeof a.onConversationReadFromOtherSource&&(l.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&
(l.events.onConversationRead=a.onConversationRead),"function"===typeof a.onMessageReceived&&(l.events.onMessageReceived=a.onMessageReceived),"function"===typeof a.onMessageSentUpdate&&(l.events.onMessageSentUpdate=a.onMessageSentUpdate),"function"===typeof a.onMessageSent&&(l.events.onMessageSent=a.onMessageSent),"function"===typeof a.onUserBlocked&&(l.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(l.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&
(l.events.onUserActivated=a.onUserActivated),"function"===typeof a.onUserDeactivated&&(l.events.onUserDeactivated=a.onUserDeactivated))};l.getConversation=function(a){v.getTopicId({conversationId:a.conversationId})}}h.applozic||(h.applozic=h.applozic?h.applozic:{},b.extend(!0,h.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var M={baseUrl:"https://chat.kommunicate.io",fileBaseUrl:"https://applozic.appspot.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",
launcher:"applozic-launcher",userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,groupUserCount:!1,desktopNotification:!0,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,isAnonymousChat:!0,groupName:"Kommunicate",agentId:"",agentName:"",labels:{"conversations.title":"Conversations","start.new":"Start New Conversation","search.contacts":"Contacts",
"search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!","empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update",
"group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted","change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?",
"remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send",
"send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File","last.seen":"Last seen","last.seen.on":"Last seen on",ago:"ago","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",
GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},ea={messageType:5,type:0};b.fn.applozic=function(c,h){var l=b("#mck-sidebox");"object"===b.type(c)&&(c=b.extend(!0,{},M,c));if("undefined"!==typeof l.data("applozic_instance"))if(l=
l.data("applozic_instance"),"string"===b.type(c))switch(c){case "reInitialize":return l.reInit(h);case "loadConvTab":l.loadConvTab(h);break;case "loadTab":l.loadTab(h);break;case "uploadFile":l.uploadFile(h);break;case "loadTabView":l.loadTabView(h);break;case "loadChat":l.loadChat(h);break;case "loadContextualTab":return l.loadTabWithTopic(h);case "audioAttach":l.audioAttach(h);break;case "addWelcomeMessage":l.addWelcomeMessage(h);break;case "loadContacts":l.loadContacts(h);break;case "sendMessage":return l.sendMessage(h);
case "sendGroupMessage":return l.sendGroupMessage(h);case "createGroup":return l.createGroup(h);case "loadBroadcastTab":return h.groupName=h.groupName?h.groupName:"Broadcast",h.type=5,l.initGroupTab(h);case "initBroadcastTab":return h.groupName=h.groupName?h.groupName:"Broadcast",h.type=5,l.initGroupTab(h);case "initGroupTab":return l.initGroupTab(h);case "loadGroupTab":return l.loadGroupTab(h);case "loadGroupTabByClientGroupId":return l.loadGroupTabByClientGroupId(h);case "setOffline":return l.setOffline(),
"success";case "setOnline":return l.setOffline(),"success";case "logout":return l.logout(),"success";case "reset":l.reset(h);break;case "getUserDetail":return l.getUserStatus(h),"success";case "getGroupList":return l.getGroupList(h),"success";case "leaveGroup":return l.leaveGroup(h);case "addGroupMember":return l.addGroupMember(h);case "removeGroupMember":return l.removeGroupMember(h);case "updateGroupInfo":return l.updateGroupInfo(h);case "getMessages":l.getMessages(h);break;case "messageList":return l.getMessageList(h);
case "getMessageListByTopicId":return l.getMessageListByTopicId(h);case "getTotalUnreadCount":return l.getTotalUnreadCount();case "subscribeToEvents":return l.subscribeToEvents(h);case "getConversation":return l.getConversation(h);case "loadConversationWithAgent":return l.loadConversationWithAgent(h);case "updateUserIdentity":return l.updateUserIdentity(h)}else"object"===b.type(c)&&l.reInit(c);else"object"===b.type(c)&&(c.userId&&c.appId&&""!==b.trim(c.userId)&&""!==b.trim(c.appId)?"undefined"!==
typeof l.data("applozic_instance")?(l=l.data("applozic_instance"),l.reInit(c)):(jQuery="undefined"!==typeof c.ojq?$=c.ojq:$=b,"function"===typeof c.obsm?($.fn.modal=c.obsm,jQuery.fn.modal=c.obsm):"function"===typeof b.fn.modal?(h=b.fn.modal.noConflict(),$.fn.modal=h,jQuery.fn.modal=h):"function"===typeof $.fn.modal&&(h=$.fn.modal.noConflict(),$.fn.modal=h,jQuery.fn.modal=h),"function"===typeof c.omckm?b.fn.mckModal=c.omckm:"function"===typeof b.fn.mckModal?b.fn.mckModal=b.fn.mckModal.noConflict():
"function"===typeof $.fn.mckModal&&(b.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(b.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof b.fn.linkify&&($.fn.linkify=b.fn.linkify,jQuery.fn.linkify=b.fn.linkify),"function"===typeof $.fn.emojiarea?b.fn.emojiarea=$.fn.emojiarea:"function"===typeof b.fn.emojiarea&&($.fn.emojiarea=b.fn.emojiarea,jQuery.fn.emojiarea=b.fn.emojiarea),"function"===typeof $.fn.locationpicker?b.fn.locationpicker=$.fn.locationpicker:
"function"===typeof b.fn.locationpicker&&($.fn.locationpicker=b.fn.locationpicker,jQuery.fn.locationpicker=b.fn.locationpicker),c=new H(c),l.data("applozic_instance",c),c.init()):alert("Oops! looks like incorrect application id or user Id."))};b.fn.applozic.defaults=M})($applozic,window,document);