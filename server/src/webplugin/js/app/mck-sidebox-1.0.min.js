var MCK_GROUP_MAP=[],MCK_CLIENT_GROUP_MAP=[];
(function(b,g,r){function kb(c){var l=this,ba,p;MCK_GROUP_MAP=[];var F=[],ga,Ha,lb=!0,Aa=[],qa=0;MCK_CLIENT_GROUP_MAP=[];var Ba=!1,ha=[],Ca=[],ra=90,ca=[],J=[],T=[],M=[],mb=!0,K=0,nb=c.mode;MCK_LABELS=c.labels;MCK_BASE_URL=c.baseUrl;var Q=c.appId,ob=[],pb=[0,1,2,3],qb=[1,2,5,6,10],ia=[],ab=!1,Wa=c.launcher,fb=c.visitor,Hb=c.userName,Xa=c.locShare,Ka=c.video,G=c.fileBaseUrl,N=c.onInit,rb=c.onTopicDetails,kb=[0,1,2],sb=c.onClose,tb=c.displayText,ja=c.accessToken,Ta=c.readConversation,Z=c.maxGroupSize,
ub=c.onTabClicked,Ib=c.contactNumber,va=c.maxAttachmentSize,vb=c.appModuleName,ua=c.getTopicDetail,Ua=c.contactDisplayName,wb=c.validateMessage,Da=c.finalPriceResponse,La=c.contactDisplayImage,xb=c.priceWidget,da=c.openGroupSettings,aa=c.offlineMessageDetail,gb=c.authenticationTypeId,yb=c.getConversationDetail,dc=c.notificationIconLink,Jb=c.mapStaticAPIkey,ec=c.notificationSoundLink?c.notificationSoundLink:MCK_BASE_URL+"/resources/sidebox/audio/notification_tone.mp3",w=fb?"guest":b.trim(c.userId),
Kb=Xa?c.googleApiKey:"NO_ACCESS",fc="undefined"===typeof c.source?1:c.source,Ia="boolean"===typeof c.topicBox?c.topicBox:!1,hb="boolean"===typeof c.olStatus?c.olStatus:!1,Lb="boolean"===typeof c.messageBubbleAvator?c.messageBubbleAvator:!1,bb="boolean"===typeof c.showOfflineMessage?c.showOfflineMessage:!1,Mb="boolean"===typeof c.hideGroupSubtitle?c.hideGroupSubtitle:!1,Nb="undefined"===typeof c.defaultMessageMetaData?{}:c.defaultMessageMetaData,zb="boolean"===typeof c.groupUserCount?c.groupUserCount:
!1,Ob="boolean"===typeof c.checkUserBusyWithStatus?c.checkUserBusyWithStatus:!1,Pb="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1,wa="boolean"===typeof c.topicHeader?c.topicHeader:!1,Qb=c.supportId?'data-mck-id\x3d"'+c.supportId+'"':"",Ab="boolean"===typeof c.loadOwnContacts?c.loadOwnContacts:!1,Rb="boolean"===typeof c.desktopNotification?c.desktopNotification:!1,Sb="boolean"===typeof c.notification?c.notification:!0,Tb="boolean"===typeof c.swNotification?c.swNotification:!1,Ub="boolean"===
typeof c.autoTypeSearchEnabled?c.autoTypeSearchEnabled:!0,ib="boolean"===typeof c.launchOnNewMessage?c.launchOnNewMessage:!1,Bb="boolean"===typeof c.launchOnUnreadMessage?c.launchOnUnreadMessage:!1,Vb="number"===typeof c.userTypeId?c.userTypeId:!1,V=["DEFAULT","NEW","OPEN"],Wb=["BLOCKED_TO","BLOCKED_BY","UNBLOCKED_TO","UNBLOCKED_BY"],A=new function(){var a=this,d=[],c=[],l=[],e=[];a.updateLatestMessage=function(b){var d=[];d.push(b);a.updateLatestMessageArray(d);a.updateMckMessageArray(d)};a.getLatestMessageArray=
function(){return"undefined"!==typeof g.sessionStorage?b.parseJSON(g.sessionStorage.getItem("mckLatestMessageArray")):d};a.setLatestMessageArray=function(a){"undefined"!==typeof g.sessionStorage?g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(a)):d=a};a.updateLatestMessageArray=function(a){if("undefined"!==typeof g.sessionStorage){var e=b.parseJSON(g.sessionStorage.getItem("mckLatestMessageArray"));null!==e?(e=e.concat(a),g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(e))):
g.sessionStorage.setItem("mckLatestMessageArray",g.JSON.stringify(a));return a}return d=d.concat(a)};a.getMckMessageArray=function(){return"undefined"!==typeof g.sessionStorage?b.parseJSON(g.sessionStorage.getItem("mckMessageArray")):c};a.clearMckMessageArray=function(){"undefined"!==typeof g.sessionStorage?(g.sessionStorage.removeItem("mckMessageArray"),g.sessionStorage.removeItem("mckLatestMessageArray")):(c.length=0,d.length=0)};a.clearAppHeaders=function(){"undefined"!==typeof g.sessionStorage&&
g.sessionStorage.removeItem("mckAppHeaders")};a.setAppHeaders=function(a){"undefined"!==typeof g.sessionStorage&&g.sessionStorage.setItem("mckAppHeaders",g.JSON.stringify(a))};a.getAppHeaders=function(a){return"undefined"!==typeof g.sessionStorage?b.parseJSON(g.sessionStorage.getItem("mckAppHeaders")):{}};a.getMessageByKey=function(a){return l[a]};a.updateMckMessageArray=function(a){for(var d=0;d<a.length;d++){var e=a[d];l[e.key]=e}return"undefined"!==typeof g.sessionStorage?(d=b.parseJSON(g.sessionStorage.getItem("mckMessageArray")),
null!==d?(d=d.concat(a),g.sessionStorage.setItem("mckMessageArray",g.JSON.stringify(d))):g.sessionStorage.setItem("mckMessageArray",g.JSON.stringify(a)),a):c=c.concat(a)};a.getMckContactNameArray=function(){return"undefined"!==typeof g.sessionStorage?b.parseJSON(g.sessionStorage.getItem("mckContactNameArray")):e};a.setMckContactNameArray=function(a){"undefined"!==typeof g.sessionStorage?g.sessionStorage.setItem("mckContactNameArray",g.JSON.stringify(a)):e=a};a.updateMckContactNameArray=function(a){if("undefined"!==
typeof g.sessionStorage){var d=b.parseJSON(g.sessionStorage.getItem("mckContactNameArray"));null!==d&&(a=a.concat(d));g.sessionStorage.setItem("mckContactNameArray",g.JSON.stringify(a));return a}return e=e.concat(a)};a.clearMckContactNameArray=function(){"undefined"!==typeof g.sessionStorage?g.sessionStorage.removeItem("mckContactNameArray"):e.length=0}},H={},Ma=[],Na=[],Ja={},ka=[],Ea=[],Oa=[],W=[],Ya=new function(){var a=this,h=!1,c,l,e=b("#mck-file-menu"),x=b("#mck-message-cell .mck-message-inner");
b("#mck-tab-individual");var n=ra;a.getLauncherHtml=function(){return'\x3cdiv id\x3d"mck-sidebox-launcher" class\x3d"mck-sidebox-launcher"\x3e\x3ca href\x3d"#" target\x3d"_self" class\x3d"applozic-launcher mck-button-launcher" '+("support"===nb?Qb:"")+'\x3e\x3cspan class\x3d"mck-icon-chat"\x3e\x3c/span\x3e\x3c/a\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview" class\x3d"mck-msg-preview applozic-launcher"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-3 mck-preview-icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row mck-truncate mck-preview-content"\x3e\x3cstrong class\x3d"mck-preview-cont-name"\x3e\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row mck-preview-content"\x3e\x3cdiv class\x3d"mck-preview-msg-content"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-preview-file-content mck-msg-text notranslate blk-lg-12 mck-attachment n-vis"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-msg-preview-btns" class\x3d"n-vis"\x3e\x3cbutton id\x3d"mck-vid-call-accept"\x3eAccept\x3c/button\x3e\x3cbutton id\x3d"mck-vid-call-reject"\x3ereject\x3c/reject\x3e\x3c/div\x3e\x3c/div\x3e'};
a.initializeApp=function(d,e){h=e;var c={applicationId:d.appId,userId:w};null!==Hb&&(c.displayName=d.userName);null!==d.email&&(c.email=d.email);null!==Ib&&(c.contactNumber=d.contactNumber);d.imageLink&&(c.imageLink=d.imageLink);d.appModuleName&&(c.appModuleName=d.appModuleName);ja&&(c.password=d.accessToken);-1===kb.indexOf(gb)&&(gb=0);Pb&&(c.resetUserStatus=!0);"number"==typeof Vb&&(c.userTypeId=Vb);c.enableEncryption=!0;c.appVersionCode=108;c.authenticationTypeId=gb;ga=p="";a.validateAppSession(c)?
Ka&&ea.InitilizeVideoClient(w,ga):b.ajax({url:MCK_BASE_URL+"/v2/tab/initialize.page",type:"post",data:g.JSON.stringify(c),contentType:"application/json",headers:{"Application-Key":Q},success:function(d){Ka&&ea.InitilizeVideoClient(d.userId,d.deviceKey);"kommunicate"==window.applozic.PRODUCT_ID&&b("#km-chatLoginModal").removeClass("vis").addClass("n-vis");A.clearMckMessageArray();A.clearMckContactNameArray();"INVALID_PASSWORD"===d?"function"===typeof N&&N({status:"error",errorMessage:"INVALID PASSWORD"}):
"INVALID_APPID"===d?"function"===typeof N&&N({status:"error",errorMessage:"INVALID APPLICATION ID"}):"error"===d||"USER_NOT_FOUND"===d?"function"===typeof N&&N({status:"error",errorMessage:"USER NOT FOUND"}):"APPMODULE_NOT_FOUND"===d?"function"===typeof N&&N({status:"error",errorMessage:"APPMODULE NOT FOUND"}):"object"===typeof d&&null!==d&&d.token?(d.appId=c.applicationId,ja&&(d.accessToken=c.password),a.onInitApp(d)):"function"===typeof N&&N({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})},
error:function(){A.clearMckMessageArray();"function"===typeof N&&N({status:"error",errorMessage:"UNABLE TO PROCESS REQUEST"})}})};a.onInitApp=function(e){a.appendLauncher();a.setLabels();b(".applozic-launcher").each(function(){b(this).hasClass("mck-msg-preview")||b(this).show()});ba=e.token;mckUtils.setEncryptionKey(e.encryptionKey);w=e.userId;ga=e.deviceKey;Ha=e.websocketUrl;ra=e.websocketIdleTimeLimit;G=e.fileBaseUrl;ab=e.deactivated;p=btoa(e.userId+":"+e.deviceKey);K=e.totalUnreadCount;fb||"guest"===
w||"0"===w||"C0"===w||(h?O.reconnect():O.init());d.createContactWithDetail({userId:w,displayName:e.displayName,photoLink:e.imageLink});b.ajaxPrefilter(function(b){b.beforeSend||-1===b.url.indexOf(MCK_BASE_URL)||(b.beforeSend=function(b){a.setHeaders(b)})});if(e.betaPackage){var c="https://www.applozic.com/?utm_source\x3d"+g.location.href+"\x26utm_medium\x3dwebplugin\x26utm_campaign\x3dpoweredby";b(".mck-running-on a").attr("href",c);b(".mck-running-on").removeClass("n-vis").addClass("vis")}c=A.getMckContactNameArray();
if(null!==c&&0<c.length)for(var v=0;v<c.length;v++){var l=c[v];null!==l&&(ka[l[0]]=l[1])}X.checkUserConnectedStatus();"function"===typeof N&&N("success",e);Ya.tabFocused();0<Fa.length&&0<K&&Fa.html(K);Bb&&u.loadMessageList({tabId:"",isGroup:!1,isLaunch:!0});cb.subscribeToServiceWorker();A.setAppHeaders(e);mckGroupService.loadGroups({apzCallback:t.loadGroups})};a.validateAppSession=function(b){var d=A.getAppHeaders();if(d&&d.userId){if(b.applicationId===d.appId&&b.userId===d.userId&&b.password===d.accessToken)return a.onInitApp(d),
!0;A.clearAppHeaders()}return!1};a.setHeaders=function(a){a.setRequestHeader("UserId-Enabled",!0);p&&a.setRequestHeader("Authorization","Basic "+p);a.setRequestHeader("Application-Key",Q);ga&&a.setRequestHeader("Device-Key",ga);ja&&a.setRequestHeader("Access-Token",ja);vb&&a.setRequestHeader("App-Module-Name",vb)};a.setLabels=function(){b("#mck-conversation-title").html(MCK_LABELS["conversations.title"]).attr("title",MCK_LABELS["conversations.title"]);b("#mck-msg-new, #mck-sidebox-search .mck-box-title").html(MCK_LABELS["start.new"]).attr("title",
MCK_LABELS["start.new"]);b("#mck-contact-search-tab strong").html(MCK_LABELS["search.contacts"]).attr("title",MCK_LABELS["search.contacts"]);b("#mck-group-search-tab strong").html(MCK_LABELS["search.groups"]).attr("title",MCK_LABELS["search.groups"]);b("#mck-contact-search-input, #mck-group-search-input, #mck-group-member-search").attr("placeholder",MCK_LABELS["search.placeholder"]);b("#mck-loc-address").attr("placeholder",MCK_LABELS["location.placeholder"]);b("#mck-no-conversations").html(MCK_LABELS["empty.conversations"]);
b("#mck-no-messages").html(MCK_LABELS["empty.messages"]);b("#mck-no-more-conversations").html(MCK_LABELS["no.more.conversations"]);b("#mck-no-more-messages").html(MCK_LABELS["no.more.messages"]);b("#mck-no-search-contacts").html(MCK_LABELS["empty.contacts"]);b("#mck-no-search-groups").html(MCK_LABELS["empty.groups"]);b("#mck-new-group, #mck-group-create-tab .mck-box-title, #mck-btn-group-create").html(MCK_LABELS["create.group.title"]).attr("title",MCK_LABELS["create.group.title"]);b("#mck-gc-overlay-label").html(MCK_LABELS["add.group.icon"]);
b("#mck-msg-error").html(MCK_LABELS["group.deleted"]);b("#mck-gc-title-label").html(MCK_LABELS["group.title"]);b("#mck-gc-type-label").html(MCK_LABELS["group.type"]);b("#mck-group-info-btn, #mck-group-info-tab .mck-box-title").html(MCK_LABELS["group.info.title"]).attr("title",MCK_LABELS["group.info.title"]);b("#mck-gi-overlay-label").html(MCK_LABELS["change.group.icon"]);b("#mck-group-member-title").html(MCK_LABELS["members.title"]).attr("title",MCK_LABELS["members.title"]);b("#mck-group-add-member .blk-lg-9, #mck-gm-search-box .mck-box-title").html(MCK_LABELS["add.members.title"]).attr("title",
MCK_LABELS["add.members.title"]);b("#mck-btn-group-update").html(MCK_LABELS["group.info.update"]).attr("title",MCK_LABELS["group.info.update"]);b("#mck-btn-leave-group, #mck-btn-group-exit").html(MCK_LABELS["exit.group"]).attr("title",MCK_LABELS["exit.group"]);b("#mck-typing-label").html(MCK_LABELS.typing);b("#mck-btn-clear-messages").html(MCK_LABELS["clear.messages"]).attr("title",MCK_LABELS["clear.messages"]);b("#mck-block-button").html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]);
b("#mck-loc-box .mck-box-title, #mck-share-loc-label").html(MCK_LABELS["location.share.title"]).attr("title",MCK_LABELS["location.share.title"]);b("#mck-btn-loc").attr("title",MCK_LABELS["location.share.title"]);b("#mck-file-up-label").html(MCK_LABELS["file.attachment"]);b("#mck-file-up").attr("title",MCK_LABELS["file.attachment"]);b(".mck-file-attach-label").attr("title",MCK_LABELS["file.attach.title"]);b("#mck-my-loc").html(MCK_LABELS["my.location"]).attr("title",MCK_LABELS["my.location"]);b("#mck-btn-close-loc-box").html(MCK_LABELS.close).attr("title",
MCK_LABELS.close);b("#mck-loc-submit").html(MCK_LABELS.send).attr("title",MCK_LABELS.send);b("#mck-msg-sbmt").attr("title",MCK_LABELS["send.message"]);b("#mck-btn-smiley").attr("title",MCK_LABELS.smiley);b("#mck-group-name-save").attr("title",MCK_LABELS.save);b("#mck-btn-group-icon-save").attr("title",MCK_LABELS.save);b("#mck-group-name-edit").attr("title",MCK_LABELS.edit)};b(r).on("click",".fancybox",function(a){a=b(this);if(-1!==a.data("type").indexOf("video")){var d=a.find(".mck-video-box").html(),
e;a.fancybox({content:d,title:a.data("name"),padding:0,openEffect:"none",closeEffect:"none",helpers:{overlay:{locked:!1,css:{background:"rgba(0, 0, 0, 0.8)"}}},beforeShow:function(){e=b(".fancybox-inner").find("video").get(0);e.load();e.play()}})}else a=a.data("url"),b(this).fancybox({openEffect:"none",closeEffect:"none",padding:0,href:a,type:"image"})});b(g).on("resize",function(){"block"===e.css("display")&&Cb.fileMenuReposition();if(0===x.find(".mck-contact-list").length){var a=x.get(0).scrollHeight;
x.height()<a&&x.animate({scrollTop:x.prop("scrollHeight")},0)}});a.appendLauncher=function(){b("#mck-sidebox-launcher").remove();b("body").append(a.getLauncherHtml());cb.init()};a.tabFocused=function(){function b(e){var c={focus:!0,focusin:!0,pageshow:!0,blur:!1,focusout:!1,pagehide:!1};e=e||g.event;(mb=e.type in c?c[e.type]:this[d]?!1:!0)?(1>n&&lb&&O.checkConnected(!0),a.stopIdleTimeCounter()):(1===qa&&O.sendTypingStatus(0),a.manageIdleTime())}var d="hidden";d in r?r.addEventListener("visibilitychange",
b):("mozHidden"===d)in r?r.addEventListener("mozvisibilitychange",b):("webkitHidden"===d)in r?r.addEventListener("webkitvisibilitychange",b):("msHidden"===d)in r?r.addEventListener("msvisibilitychange",b):"onfocusin"in r?r.onfocusin=r.onfocusout=b:g.onpageshow=g.onpagehide=g.onfocus=g.onblur=b;void 0!==r[d]&&b({type:r[d]?"blur":"focus"})};a.manageIdleTime=function(){n=ra;c&&clearInterval(c);c=setInterval(function(){0>--n&&(n=0,O.stopConnectedCheck(),clearInterval(c),c="")},6E4)};a.stopIdleTimeCounter=
function(){n=ra;c&&clearInterval(c);c=""};a.manageOfflineMessageTime=function(a){if("object"!==typeof aa||isNaN(aa.timeout))g.console.log("Offline message timeout required.");else{if(1===aa.type){if(!aa.userIds||0===aa.userIds.length){g.console.log("Offline message userIds required.");return}if(-1===aa.userIds.indexOf(a))return}l&&clearInterval(l);l=setTimeout(function(){clearInterval(l);l="";d.showOfflineMessage()},5E3*parseInt(aa.timeout))}};a.stopOfflineMessageCounter=function(){l&&clearInterval(l);
l=""}},Cb=new function(){var a=this,d="",c="",l=!1,e=b("#mck-my-loc"),x=b("#mck-loc-box"),n=b("#mck-loc-lat"),L=b("#mck-loc-lon"),xa=b("#mck-btn-loc"),v=b("#mck-sidebox-ft"),y=b("#mck-file-menu"),p=b("#mck-btn-attach"),t=b("#mck-map-content"),r=b("#mck-loc-address");a.init=function(){Xa&&g.google&&"object"===typeof g.google.maps&&(d=new g.google.maps.Geocoder,p.on("click",function(){a.fileMenuToggle()}),xa.on("click",function(){l?x.mckModal():(mckMapUtils.getCurrentLocation(a.onGetCurrLocation,a.onErrorCurrLocation),
l=!0)}));e.on("click",function(){mckMapUtils.getCurrentLocation(a.onGetMyCurrLocation,a.onErrorMyCurrLocation)})};a.fileMenuReposition=function(){var a=v.offset();a.bottom=g.innerHeight-a.top;y.css({bottom:51<a.bottom?a.bottom:51,right:0})};a.fileMenuToggle=function(){p.hasClass("on")?(p.removeClass("on"),y.hide()):(a.fileMenuReposition(),p.addClass("on"),y.show())};a.onGetCurrLocation=function(b){MCK_CURR_LATITIUDE=b.coords.latitude;MCK_CURR_LONGITUDE=b.coords.longitude;a.openMapBox()};a.onErrorCurrLocation=
function(){MCK_CURR_LATITIUDE=46.15242437752303;MCK_CURR_LONGITUDE=2.7470703125;a.openMapBox()};a.onErrorMyCurrLocation=function(a){alert("Unable to retrieve your location. ERROR("+a.code+"): "+a.message)};a.onGetMyCurrLocation=function(a){MCK_CURR_LATITIUDE=a.coords.latitude;MCK_CURR_LONGITUDE=a.coords.longitude;n.val(MCK_CURR_LATITIUDE);L.val(MCK_CURR_LONGITUDE);n.trigger("change");L.trigger("change");c?r.val(c):d&&d.geocode({location:{lat:MCK_CURR_LATITIUDE,lng:MCK_CURR_LONGITUDE}},function(a,
b){"OK"===b&&a[1]&&(c=a[1].formatted_address)})};a.openMapBox=function(){t.locationpicker({location:{latitude:MCK_CURR_LATITIUDE,longitude:MCK_CURR_LONGITUDE},radius:0,scrollwheel:!0,inputBinding:{latitudeInput:n,longitudeInput:L,locationNameInput:r},enableAutocomplete:!0,enableReverseGeocode:!0,onchanged:function(a){MCK_CURR_LATITIUDE=a.latitude;MCK_CURR_LONGITUDE=a.longitude}});x.on("shown.bs.mck-box",function(){t.locationpicker("autosize")});x.mckModal()}},X=new function(){var a=this,d=b("#mck-msg-form"),
c=b("#mck-msg-error"),l=b("#mck-tab-title"),e=b("#mck-tab-status"),x=b(".mck-typing-box"),n=b("#mck-block-button"),L=b("#mck-message-cell .mck-message-inner");a.updateUserStatus=function(a){if("object"===typeof ca[a.userId]){var b=ca[a.userId];0===a.status?(b.connected=!1,b.lastSeenAtTime=a.lastSeenAtTime):1===a.status&&(b.connected=!0)}else b=[],b.push(a.userId),Y.getUsersDetail(b,{})};a.getUserDetail=function(a){if("object"===typeof ca[a])return ca[a]};a.checkUserConnectedStatus=function(){var d=
[],e=[];b(".mck-user-ol-status").each(function(){var a=b(this).data("mck-id");"undefined"!==typeof a&&""!==a&&(d.push(a),a=mckContactUtils.formatContactId(""+a),b(this).addClass(a),b(this).next().addClass(a))});0<d.length&&(b.each(d,function(a,b){"undefined"===typeof ca[b]&&e.push(b)}),0<e.length?Y.getUsersDetail(e,{setStatus:!0}):a.updateUserConnectedStatus())};a.updateUserConnectedStatus=function(){b(".mck-user-ol-status").each(function(){var a=b(this),d=a.data("mck-id");if(d){var e=ca[d];"undefined"!==
typeof ca[d]&&e.connected?(a.removeClass("n-vis").addClass("vis"),a.next().html("("+MCK_LABELS.online+")")):(a.removeClass("vis").addClass("n-vis"),a.next().html("(Offline)"))}})};a.lastSeenOfGroupOfTwo=function(a){g.MCK_OL_MAP[a]?(e.attr("title",MCK_LABELS.online).html(MCK_LABELS.online),e.removeClass("n-vis").addClass("vis")):T[a]&&(a=mckDateUtils.getLastSeenAtStatus(T[a]),e.html(a),e.attr("title",a),l.addClass("mck-tab-title-w-status"),e.removeClass("n-vis").addClass("vis"))};a.toggleBlockUser=
function(a,b){if(b)c.html(MCK_LABELS.blocked),c.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),d.removeClass("vis").addClass("n-vis"),l.removeClass("mck-tab-title-w-status"),e.removeClass("vis").addClass("n-vis"),x.removeClass("vis").addClass("n-vis"),L.data("blocked",!0),n.html(MCK_LABELS["unblock.user"]).attr("title",MCK_LABELS["unblock.user"]);else if(c.html(""),c.removeClass("vis").addClass("n-vis").removeClass("mck-no-mb"),d.removeClass("n-vis").addClass("vis"),L.data("blocked",!1),
n.html(MCK_LABELS["block.user"]).attr("title",MCK_LABELS["block.user"]),!Ca[a]&&(g.MCK_OL_MAP[a]||T[a])){if(g.MCK_OL_MAP[a])e.attr("title",MCK_LABELS.online).html(MCK_LABELS.online);else if(T[a]){var y=mckDateUtils.getLastSeenAtStatus(T[a]);e.html(y);e.attr("title",y)}l.addClass("mck-tab-title-w-status");e.removeClass("n-vis").addClass("vis")}}};new function(){var a=b("#mck-msg-to");b("#mck-btn-loc");var d=b("#mck-loc-box"),c=b("#mck-msg-sbmt"),l=b("#mck-msg-error"),e=b("#mck-loc-submit"),x=b("#mck-msg-response"),
n=b("#mck_response_text"),L=b("#mck-message-cell .mck-message-inner");e.on("click",function(){var b={type:5,contentType:2,message:g.JSON.stringify(mckMapUtils.getSelectedLocation())},e=L.data("mck-conversationid"),y=L.data("mck-topicid");e?b.conversationId=e:y&&(e={topicId:y},y=J[y],"object"===typeof y&&(e.topicDetail=g.JSON.stringify(y)),b.conversationPxy=e);!0===L.data("isgroup")?b.groupId=a.val():b.to=a.val();c.attr("disabled",!0);l.removeClass("vis").addClass("n-vis");l.html("");n.html("");x.removeClass("vis").addClass("n-vis");
u.sendMessage(b);d.mckModal("hide")})};var t=new function(){var a=this,c={0:"User",1:"Admin",2:"Moderator",3:"Member"},l=b("#mck-msg-form"),R=b("#mck-msg-error"),e=b("#mck-tab-title"),x=b("#mck-tab-status"),n=b("#mck-no-gsm-text"),L=b("#mck-gms-loading"),p=b("#mck-contact-loading");b("#mck-tab-menu-box");b("#mck-search-loading");var v=b("#mck-group-info-tab"),y=b("#mck-sidebox-search");b("#mck-group-name-box");var U=b("#mck-group-back-link"),ya=b("#mck-group-name-edit"),Pa=b("#mck-group-name-save"),
A=b("#mck-sidebox-content"),F=b("#mck-tab-option-panel"),D=b("#mck-btn-group-create"),k=b("#mck-group-create-tab"),I=b("#mck-contacts-content"),C=b("#mck-btn-group-update"),P=b("#mck-group-create-type"),sa=b("#mck-group-icon-upload"),Db=b("#mck-group-icon-change"),Eb=b("#mck-group-member-list"),G=b("#mck-group-update-panel"),K=b(".mck-tab-message-option"),N=b("#mck-group-create-title"),Ga=b(".mck-group-menu-options"),gc=b("#mck-group-member-search"),la=b("#mck-btn-group-icon-save");b("#mck-group-info-icon-box");
var db=b(".mck-group-admin-options"),jb=b("#mck-group-add-member-box"),S=b("#mck-message-cell .mck-message-inner"),ma=b("#mck-group-name-sec .mck-group-title");b("#mck-group-create-icon-box");var X=b("#mck-group-info-icon-loading"),V=b("#mck-gm-search-box");b("#mck-group-member-search-list");var ca=b("#mck-group-create-icon-loading"),Q=b("#mck-group-info-icon-box .mck-group-icon"),ba=b("#mck-group-create-icon-box .mck-group-icon"),na=b("#mck-group-create-icon-box .mck-overlay-box"),aa=b("#mck-gc-overlay-label");
b.template("groupMemberTemplate",'\x3cli id\x3d"li-gm-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}" data-role\x3d"${roleVal}" data-alpha\x3d"${contFirstAlphaExpr}"\x3e\x3cdiv class\x3d"mck-row mck-group-member-info" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-text move-right vis"\x3e\x3cspan\x3e${roleExpr}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-4 mck-group-admin-options move-right ${enableAdminMenuExpr}"\x3e\x3cdiv class\x3d"mck-menu-box n-vis"\x3e\x3cdiv class\x3d"mck-dropdown-toggle mck-group-admin-menu-toggle mck-text-center" data-toggle\x3d"mckdropdown" aria-expanded\x3d"true"\x3e\x3cspan class\x3d"mck-caret"\x3e\x3c/span\x3e\x3c/div\x3e\x3cul id\x3d"mck-group-admin-menu" class\x3d"mck-dropdown-menu mck-group-admin-menu mck-tab-menu-box menu-right" role\x3d"menu"\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-remove-member menu-item" title\x3d"${removeMemberLabel}"\x3e${removeMemberLabel}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" target\x3d"_self"  class\x3d"mck-btn-change-role menu-item" title\x3d"${changeRoleLabel}"\x3e${changeRoleLabel}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"mck-group-change-role-box" class\x3d"mck-row mck-group-change-role-box n-vis"\x3e\x3cdiv class\x3d"blk-lg-4"\x3e\x3cdiv class\x3d"mck-label"\x3eSelect role \x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-8 move-right"\x3e\x3cselect id\x3d"mck-change-role-type" class\x3d"mck-select"\x3e\x3coption value\x3d"0"\x3eUser\x3c/option\x3e\x3coption value\x3d"1"\x3eAdmin\x3c/option\x3e\x3coption value\x3d"2"\x3eModerator\x3c/option\x3e\x3coption value\x3d"3" selected\x3eMember\x3c/option\x3e\x3c/select\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
b.template("groupMemberSearchTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr} mck-li-group-member" data-mck-id\x3d"${contIdExpr}"\x3e\x3ca class\x3d"mck-add-to-group" href\x3d"#" data-mck-id\x3d"${contIdExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-truncate mck-last-seen-status" title\x3d"${contLastSeenExpr}"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b(".mck-group-name-box div[contenteditable]").keypress(function(d){if(8===d.which||37===d.keyCode||38===d.keyCode||39===d.keyCode||40===d.keyCode||d.ctrlKey&&97===d.which)return!0;if(13!==d.keyCode||d.shiftKey||d.ctrlKey)return 30>this.innerHTML.length;b(d.target).hasClass("mck-group-create-title")&&a.submitCreateGroup();return!1}).on("paste",function(a){var b=this;setTimeout(function(){30<b.innerText.length&&(b.innerHTML=b.innerText.substring(0,30),mckUtils.setEndOfContenteditable(b));return!1},
"fast")}).on("drop",function(a){a.preventDefault();a.stopPropagation()});b(r).on("click",".mck-btn-change-role",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").find(".mck-group-change-role-box");var d=b(this).parents(".mck-li-group-member").data("role");a.find("select").val(d);a.removeClass("n-vis").addClass("vis");G.removeClass("n-vis").addClass("vis")});C.on("click",function(){var a=[];b(".mck-group-change-role-box.vis").each(function(d,e){var c=b(this),Qa=parseInt(c.find("select").val()),
k=c.parents(".mck-li-group-member").data("role");Qa!==k&&(c={userId:c.parents(".mck-li-group-member").data("mck-id"),role:Qa},a.push(c))});if(0<a.length){var d=S.data("mck-id"),e=S.data("isgroup");d&&e&&(C.attr("disabled",!0).html(MCK_LABELS["group.info.updating"]),mckGroupService.updateGroupInfo({groupId:d,users:a,apzCallback:t.onUpdateGroupInfo}))}});b("#mck-group-info-icon-box .mck-overlay").on("click",function(a){Db.trigger("click")});b("#mck-group-create-icon-box .mck-overlay").on("click",function(a){sa.trigger("click")});
b(r).on("mouseenter",".mck-group-create-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-create-icon-box.mck-hover-on",function(){var a=b(this);0===a.find(".mck-group-icon-default").length&&a.find(".mck-overlay-box").addClass("n-vis")});b(r).on("mouseenter",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").removeClass("n-vis")}).on("mouseleave",".mck-group-info-icon-box.mck-hover-on",function(){b(this).find(".mck-overlay-box").addClass("n-vis")});
ya.on("click",function(){ma.attr("contenteditable",!0).focus();mckUtils.setEndOfContenteditable(ma[0]);Pa.removeClass("n-vis").addClass("vis");ya.removeClass("vis").addClass("n-vis")});Pa.on("click",function(){var a=b.trim(ma.text());if(0<a.length){var d=S.data("mck-id"),e=S.data("isgroup");d&&e&&(ya.removeClass("n-vis").addClass("vis"),Pa.removeClass("vis").addClass("n-vis"),ma.attr("contenteditable",!1),mckGroupService.updateGroupInfo({groupId:d,name:a,apzCallback:t.onUpdateGroupInfo}))}else ma.addClass("mck-req-border")});
la.on("click",function(){var a=Q.data("iconurl");if(a){var b=S.data("mck-id"),d=S.data("isgroup");b&&d&&(setTimeout(function(){la.removeClass("vis").addClass("n-vis")},1E3),Q.data("iconurl",""),mckGroupService.updateGroupInfo({groupId:b,imageUrl:a,apzCallback:t.onUpdateGroupInfo}))}else ma.addClass("mck-req-border")});D.on("click",function(){a.submitCreateGroup()});a.submitCreateGroup=function(){var a=b.trim(N.text()),d=P.val(),e=ba.data("iconurl");0<a.length?(a={groupName:a},d&&(d=parseInt(d),-1!==
qb.indexOf(d)&&(a.type=d)),e&&(a.groupIcon=e),ba.data("iconurl",""),a.isInternal=!0,D.attr("disabled",!0).html(MCK_LABELS["group.create.submit"]),u.getGroup(a)):N.addClass("mck-req-border")};a.loadGroups=function(a){a=a.data;Ma.length=0;b.each(a,function(a,b){"undefined"!==typeof b.id&&(b=mckGroupUtils.addGroup(b),Ma.push(b))})};a.getDeletedAtTime=function(a){if("object"===typeof MCK_GROUP_MAP[a])return MCK_GROUP_MAP[a].deletedAtTime};a.getGroupDisplayName=function(a){if("object"===typeof MCK_GROUP_MAP[a]){a=
MCK_GROUP_MAP[a];var b=a.displayName;if("undefined"!==typeof a&&10===a.type){b=[];if(0<a.members.length)for(var e=0;e<a.members.length;e++)b.push(a.members[e]);if(0===a.users[w].role||3===a.users[w].role)b="Kommunicate";else{for(var c,e=0;e<b.length;e++){var k=b[e];3===a.users[k].role&&(c=k)}b=d.getTabDisplayName(c,!1)}}7===a.type&&(c=d.getContactFromGroupOfTwo(a),"undefined"!==typeof c&&(b=d.getTabDisplayName(c.contactId,!1)));3===a.type&&-1!==b.indexOf(w)&&(b=b.replace(w,"").replace(":",""),"function"===
typeof Ua&&(b=(c=Ua(b))?c:b));b||5!==a.type||(b="Broadcast");b||(b=a.contactId);return b}return a};a.getGroupImage=function(a){return a?'\x3cimg src\x3d"'+a+'"/\x3e':'\x3cimg src\x3d"'+MCK_BASE_URL+'/resources/sidebox/css/app/images/mck-icon-group.png"/\x3e'};a.getGroupDefaultIcon=function(){return'\x3cdiv class\x3d"mck-group-icon-default"\x3e\x3c/div\x3e'};a.addMemberToGroup=function(a,b){"object"===typeof a.members&&(-1===a.members.indexOf(b)&&a.members.push(b),"object"===typeof a.removedMembersId&&
-1!==a.removedMembersId.indexOf(b)&&a.removedMembersId.splice(a.removedMembersId.indexOf(b),1),MCK_GROUP_MAP[a.contactId]=a);return a};a.removeMemberFromGroup=function(a,b){"object"!==typeof a.removedMembersId||1>a.removedMembersId.length?(a.removedMembersId=[],a.removedMembersId.push(b)):-1===a.removedMembersId.indexOf(b)&&a.removedMembersId.push(b);return MCK_GROUP_MAP[a.contactId]=a};a.authenticateGroupUser=function(b){if(!a.isGroupLeft(b)&&0<b.members.length)for(var d=0;d<b.members.length;d++)if(w===
""+b.members[d])return!0;return!1};a.isAppendOpenGroupContextMenu=function(b){return 0!==da.deleteChatAccess&&a.authenticateGroupUser(b)?b.adminName===w||2===da.deleteChatAccess?!0:!1:!1};a.validateOpenGroupUser=function(b){if(6===b.type){if(!a.authenticateGroupUser(b)){if(da.disableChatForNonGroupMember){var d=da.defaultChatDisabledMessage;d||(d="Chat disabled");R.html(d);R.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");l.removeClass("vis").addClass("n-vis");e.removeClass("mck-tab-title-w-status");
x.removeClass("vis").addClass("n-vis")}Ga.removeClass("vis").addClass("n-vis");K.removeClass("vis").addClass("n-vis");F.removeClass("vis").addClass("n-vis");"undefined"===typeof ob[b.contactId]&&O.subscribeToOpenGroup(b)}b.adminName===w?0===da.deleteChatAccess&&K.removeClass("vis").addClass("n-vis"):(da.allowInfoAccessGroupMembers||Ga.removeClass("vis").addClass("n-vis"),2!==da.deleteChatAccess&&K.removeClass("vis").addClass("n-vis"),da.allowInfoAccessGroupMembers||2===da.deleteChatAccess||F.removeClass("vis").addClass("n-vis"));
return!1}return!0};a.addGroupStatus=function(b){var c=a.isGroupLeft(b);if(6!==b.type&&(c||Mb)){if(c)t.onGroupLeft("",{groupId:b.contactId});e.removeClass("mck-tab-title-w-status");x.removeClass("vis").addClass("n-vis")}else if(0<b.members.length){for(var c="",k=!1,h=30>=b.members.length?b.members.length:25,g=0;g<h;g++)if(w===""+b.members[g]||-1!==b.removedMembersId.indexOf(b.members[g]))k=!0;else var l=d.fetchContact(""+b.members[g]),l=d.getTabDisplayName(l.contactId,!1),c=c+(" "+l+",");if(5!==b.type&&
6!==b.type||k&&5!==b.type)c+=" You";30<b.members.length&&(c+=" and "+(b.members.length-25)+" more");c=c.replace(/,\s*$/,"");x.html(c);x.attr("title",c);x.removeClass("n-vis").addClass("vis");e.addClass("mck-tab-title-w-status");Ga.removeClass("n-vis").addClass("vis")}else e.removeClass("mck-tab-title-w-status"),x.removeClass("vis").addClass("n-vis");7===b.type&&(x.html(""),Ga.removeClass("vis").addClass("n-vis"))};a.disableGroupTab=function(){R.html(MCK_LABELS["group.chat.disabled"]);R.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");
l.removeClass("vis").addClass("n-vis");e.removeClass("mck-tab-title-w-status");x.removeClass("vis").addClass("n-vis")};a.isGroupLeft=function(a){var d=!1;a.removedMembersId&&0<a.removedMembersId.length&&b.each(a.removedMembersId,function(a,b){b===w&&(d=!0)});return d};a.onGroupLeft=function(b,d){p.removeClass("vis").addClass("n-vis");if("object"===typeof b&&"error"===b.status)alert("Unable to process your request. "+b.errorMessage);else{var e=d.groupId;if(v.hasClass("vis")){var c=v.data("mck-id");
e===c&&U.trigger("click")}else if(A.hasClass("vis")){var c=S.data("mck-id"),k=S.data("isgroup");c===e.toString()&&k&&(Ga.removeClass("vis").addClass("n-vis"),a.disableGroupTab())}}};a.onAddedGroupMember=function(e,c){p.removeClass("vis").addClass("n-vis");if("object"===typeof e&&"error"===e.status)alert("Unable to process your request. "+e.errorMessage);else{var k=c.groupId,g=c.userId,h="";k?h=mckGroupUtils.getGroup(k):c.clientGroupId&&(h=mckGroupUtils.getGroupByClientGroupId(c.clientGroupId));if("object"===
typeof h)if(h=a.addMemberToGroup(h,g),v.hasClass("vis")){var l=v.data("mck-id");k===l&&(k=d.fetchContact(""+g),0===b("#li-gm-"+k.htmlId).length&&a.addGroupMember(h,k),a.sortGroupMemberHtmlList(),a.enableGroupAdminMenuToggle())}else A.hasClass("vis")&&(g=S.data("mck-id"),l=S.data("isgroup"),g===k.toString()&&l&&a.addGroupStatus(h));else mckGroupService.getGroupFeed({groupId:k,clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed})}};a.onRemovedGroupMember=function(e,c){p.removeClass("vis").addClass("n-vis");
if("object"===typeof e&&"error"===e.status)alert("Unable to process your request. "+e.errorMessage);else{var k=c.groupId,h=c.userId,g="";k?g=mckGroupUtils.getGroup(k):c.clientGroupId&&(g=mckGroupUtils.getGroupByClientGroupId(c.clientGroupId));if("object"===typeof g)if(g=a.removeMemberFromGroup(g,h),v.hasClass("vis"))g=v.data("mck-id"),k===g&&(k=d.fetchContact(""+h),k=b("#li-gm-"+k.htmlId),0<k.length&&k.remove());else{if(A.hasClass("vis")){var h=S.data("mck-id"),l=S.data("isgroup");h===k.toString()&&
l&&a.addGroupStatus(g)}}else mckGroupService.getGroupFeed({groupId:k,clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed})}};a.onGroupFeed=function(e,c){p.removeClass("vis").addClass("n-vis");if("success"===e.status){var k=e.data,g=k.conversationPxy,h=mckGroupUtils.getGroup(k.id);k.deletedAtTime&&(R.html(MCK_LABELS["group.deleted"]),R.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),l.removeClass("vis").addClass("n-vis"));var P=[];"object"===typeof g&&(M[g.id]=g,ia[g.topicId]=[g.id],
g.topicDetail&&(J[g.topicId]=b.parseJSON(g.topicDetail)),P.push(g));0<P.length&&(W[c.groupId]=P);Y.loadUserProfiles(k.membersId);c.isMessage&&"object"===typeof c.message&&d.populateMessage(c.messageType,c.message,c.notifyUser);c.isReloadTab&&a.reloadGroupTab(h)}};a.onUpdateGroupInfo=function(d,c){p.removeClass("vis").addClass("n-vis");C.attr("disabled",!1).html("Update");G.removeClass("vis").addClass("n-vis");if("object"===typeof d&&"error"===d.status)alert("Unable to process your request. "+d.errorMessage);
else{var k=c.groupId,g=c.groupInfo,h=mckGroupUtils.getGroup(k);if("object"===typeof h){g.imageUrl&&(h.imageUrl=g.imageUrl);g.newName&&(h.displayName=g.newName);g.users&&0<g.users.length&&b.each(g.users,function(a,b){b.userId&&(h.users[b.userId]=b)});if(v.hasClass("vis"))g.imageUrl&&Q.html(a.getGroupImage(h.imageUrl)),ma.html(h.displayName),g.users&&0<g.users.length&&(Eb.html(""),a.addMembersToGroupInfoList(h),h.adminName===w?jb.removeClass("n-vis").addClass("vis"):jb.removeClass("vis").addClass("n-vis"));
else if(A.hasClass("vis")){var l=S.data("mck-id"),P=S.data("isgroup");l===k.toString()&&P?e.html(h.displayName):0<b("#li-group-"+h.htmlId).length&&(b("#li-group-"+h.htmlId+" .mck-cont-name strong").html(h.displayName),g.imageUrl&&b("#li-group-"+h.htmlId+" .blk-lg-3").html("\x3cimg src\x3d' "+h.imageUrl+"'\x3e"))}MCK_GROUP_MAP[h.contactId]=h}}};a.getGroupFeedFromMessage=function(a){var b=a.message;if(b){a.groupId=b.groupId;a.isMessage=!0;if(b.conversationId){var d=M[b.conversationId];if("object"!==
typeof d||"object"!==typeof J[d.topicId])a.conversationId=b.conversationId}a.apzCallback=t.onGroupFeed;mckGroupService.getGroupFeed(a)}};a.reloadGroupTab=function(b){var d=S.data("mck-id"),e=S.data("isgroup");d===b.contactId.toString()&&e&&a.addGroupStatus(b)};a.loadGroupTab=function(a){"error"===a.status?alert("Unable to process your request. "+a.errorMessage):(d.loadTab({tabId:a.data.contactId,isGroup:!0}),b("#mck-search").val(""))};a.addMembersToGroupInfoList=function(e){var c=e.members;c.sort();
Eb.html("");b.each(c,function(c,k){if(k){var g=d.fetchContact(""+k);0===b("#li-gm-"+g.htmlId).length&&a.addGroupMember(e,g)}});a.sortGroupMemberHtmlList();a.enableGroupAdminMenuToggle()};a.enableGroupAdminMenuToggle=function(){b(".mck-group-member-info").bind("mouseenter",function(){b(this).find(".mck-menu-box").removeClass("n-vis")}).bind("mouseleave",function(){b(this).find(".mck-menu-box").removeClass("open").addClass("n-vis")})};a.addGroupMember=function(a,e){var k="n-vis",l="n-vis",P=a.users[e.contactId],
C="Member",n=3;P&&"undefined"!==typeof P.role&&(n=P.role,C=c[P.role]);P=d.getTabDisplayName(e.contactId,!1);e.contactId===a.adminName&&(k="vis");a.adminName===w&&(l="vis");e.contactId===w&&(P="You",l="n-vis");var sa=d.getContactImageLink(e,P),x="";ha[e.contactId]||(g.MCK_OL_MAP[e.contactId]?x=MCK_LABELS.online:T[e.contactId]&&(x=mckDateUtils.getLastSeenAtStatus(T[e.contactId])));k=[{roleExpr:C,roleVal:n,removeMemberLabel:MCK_LABELS["remove.member"],changeRoleLabel:MCK_LABELS["change.role"],contHtmlExpr:e.htmlId,
contIdExpr:e.contactId,contImgExpr:sa,contLastSeenExpr:x,contNameExpr:P,contFirstAlphaExpr:P.charAt(0).toUpperCase(),isAdminExpr:k,enableAdminMenuExpr:l}];b.tmpl("groupMemberTemplate",k).appendTo("#mck-group-member-list")};a.addMembersToGroupSearchList=function(){var e=S.data("mck-id");if(S.data("isgroup")){var c=mckGroupUtils.getGroup(e),k=Oa,g=[],k=k.filter(function(a,b){return k.indexOf(a)===b});k.sort();var h=c.members;b.each(k,function(b,e){if(e){var k=d.fetchContact(""+e);if(-1===h.indexOf(k.contactId)||
-1!==h.indexOf(k.contactId)&&-1!==c.removedMembersId.indexOf(k.contactId))a.addGroupSearchMember(k),g.push(k)}});a.enableGroupAdminMenuToggle();0<g.length?n.removeClass("vis").addClass("n-vis"):n.removeClass("n-vis").addClass("vis");d.initAutoSuggest({contactsArray:g,$searchId:gc,isContactSearch:!1})}L.removeClass("vis").addClass("n-vis")};a.addGroupSearchMember=function(a){var e=d.getTabDisplayName(a.contactId,!1),c=d.getContactImageLink(a,e),k="user-"+a.htmlId,h="";ha[a.contactId]||(g.MCK_OL_MAP[a.contactId]?
h=MCK_LABELS.online:T[a.contactId]&&(h=mckDateUtils.getLastSeenAtStatus(T[a.contactId])));b.tmpl("groupMemberSearchTemplate",[{contHtmlExpr:k,contIdExpr:a.contactId,contImgExpr:c,contLastSeenExpr:h,contNameExpr:e}]).appendTo("#mck-group-member-search-list")};a.loadCreateGroupTab=function(){I.removeClass("vis").addClass("n-vis");A.removeClass("vis").addClass("n-vis");y.removeClass("vis").addClass("n-vis");v.removeClass("vis").addClass("n-vis");ca.removeClass("vis").addClass("n-vis");ba.data("iconurl",
"");N.html("");na.removeClass("n-vis");aa.html(MCK_LABELS["add.group.icon"]);ba.html(a.getGroupDefaultIcon());k.removeClass("n-vis").addClass("vis")};a.loadGroupInfo=function(b){if(b.groupId){ma.attr("contenteditable",!1);Pa.removeClass("vis").addClass("n-vis");ya.removeClass("n-vis").addClass("vis");I.removeClass("vis").addClass("n-vis");A.removeClass("vis").addClass("n-vis");y.removeClass("vis").addClass("n-vis");G.removeClass("vis").addClass("n-vis");k.removeClass("vis").addClass("n-vis");la.removeClass("vis").addClass("n-vis");
X.removeClass("vis").addClass("n-vis");v.removeClass("n-vis").addClass("vis");v.data("mck-id",b.groupId);Q.data("iconurl","");b.conversationId&&v.data("mck-conversation-id",b.conversationId);Eb.html("");var d=mckGroupUtils.getGroup(b.groupId);"object"===typeof d?(Q.html(a.getGroupImage(d.imageUrl)),ma.html(d.displayName),a.addMembersToGroupInfoList(d),d.adminName===w?jb.removeClass("n-vis").addClass("vis"):jb.removeClass("vis").addClass("n-vis")):mckGroupService.getGroupFeed({groupId:b.groupId,apzCallback:t.onGroupFeed})}};
a.sortGroupMemberHtmlList=function(){b("#mck-group-member-list .mck-li-group-member").sort(function(a,b){return a.dataset.alpha>b.dataset.alpha}).appendTo("#mck-group-member-list")};a.addGroupMemberFromSearch=function(a){var b=v.data("mck-id");if("undefined"!==typeof b&&"undefined"!==typeof a){var d=mckGroupUtils.getGroup(b);"object"===typeof d&&w===d.adminName?(Y.loadUserProfile(a),mckGroupService.addGroupMember({groupId:b,userId:a,apzCallback:t.onAddedGroupMember})):db.removeClass("vis").addClass("n-vis")}V.mckModal("hide")}},
oa=new function(){var a=this,c=["CREATE","UPDATE"],g=b("#mck-file-box"),l=b(".mck-overlay"),e=b("#mck-msg-sbmt"),x=b("#mck-text-box"),n=b("#mck-file-input"),L=b(".mck-overlay-box"),t=b(".mck-file-upload"),v=b("#mck-group-icon-upload"),y=b("#mck-group-icon-change"),u=b("#mck-group-info-icon-box"),w=b("#mck-btn-group-icon-save"),A=b("#mck-message-cell .mck-message-inner"),J=b("#mck-group-create-icon-box"),M=b("#mck-group-info-icon-loading"),D=b("#mck-group-create-icon-loading"),k=b("#mck-group-info-icon-box .mck-group-icon"),
I=b("#mck-group-create-icon-box .mck-group-icon"),C=b("#mck-gc-overlay-label");b.template("fileboxTemplate",'\x3cdiv id\x3d"mck-filebox-${fileIdExpr}" class\x3d"mck-file-box ${fileIdExpr}"\x3e\x3cdiv class\x3d"mck-file-expr"\x3e\x3cspan class\x3d"mck-file-content blk-lg-8"\x3e\x3cspan class\x3d"mck-file-lb"\x3e{{html fileNameExpr}}\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"mck-file-sz"\x3e${fileSizeExpr}\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"progress progress-striped active blk-lg-3" role\x3d"progressbar" aria-valuemin\x3d"0" aria-valuemax\x3d"100" aria-valuenow\x3d"0"\x3e\x3cspan class\x3d"progress-bar progress-bar-success bar" stye\x3e\x3c/span\x3e\x3c/span\x3e\x3cspan class\x3d"move-right"\x3e\x3cbutton type\x3d"button" class\x3d"mck-box-close mck-remove-file" data-dismiss\x3d"div" aria-hidden\x3d"true"\x3ex\x3c/button\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e');
a.init=function(){t.on("click",function(){n.trigger("click")});v.on("change",function(){var d=b(this)[0].files[0];a.uplaodFileToAWS(d,c[0]);return!1});y.on("change",function(){var d=b(this)[0].files[0];a.uplaodFileToAWS(d,c[1]);return!1});n.on("change",function(){var d=b(this)[0].files[0],e={};e.file=d;e.name=d.name;a.uploadFile(e)});b(r).on("click",".mck-remove-file",function(){var d=b(this).parents(".mck-file-box"),c=d.data("mckfile");d.remove();e.attr("disabled",!1);0===g.find(".mck-file-box").length&&
(g.removeClass("vis").addClass("n-vis"),x.attr("required",""));"object"===typeof c&&(a.deleteFileMeta(c.blobKey),b.each(F,function(a,b){"undefined"!==typeof b&&b.blobKey===c.blobKey&&F.splice(a,1)}))})};a.audioRecoder=function(c){var k=c.file,h=[];if("undefined"!==typeof k)if(4<b(".mck-file-box").length&&h.push("Can't upload more than 5 files at a time"),k.size>1048576*va&&h.push("file size can not be more than "+va+" MB"),0<h.length)alert(h.toString());else{var h=mckUtils.randomId(),l=[{fileIdExpr:h,
fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:a.getFilePreviewSize(k.size)}];b.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var C=b(".mck-file-box."+h),n=b(".mck-file-box."+h+" .mck-file-lb"),v=b(".mck-file-box."+h+" .progress .bar"),y=b(".mck-file-box."+h+" .progress"),I=b(".mck-file-box."+h+" .mck-remove-file");v.css("width","0%");y.removeClass("n-vis").addClass("vis");I.attr("disabled",!0);t.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");
if(c.name===b(".mck-file-box."+h+" .mck-file-lb a").html()){var R=A.data("mck-id");H[c.name+k.size]=R;e.attr("disabled",!0);c=[];c.push(k);var p=new XMLHttpRequest;(p.upload||p).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);v.css("width",a+"%")});p.addEventListener("load",function(c){c=b.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var k=a.getFilePreviewPath(c),g=c.name,h=c.size,l=A.data("mck-id"),g=g+h,h=H[g];if(R!==l)d.updateDraftMessage(h,
c),delete H[g];else return I.attr("disabled",!1),t.attr("disabled",!1),e.attr("disabled",!1),delete H[g],n.html(k),y.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),x.removeAttr("required"),F.push(c),C.data("mckfile",c),t.children("input").val(""),!1}else I.attr("disabled",!1),e.attr("disabled",!1),I.trigger("click")});b.ajax({type:"GET",url:G+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=
new FormData;b.append("files[]",k);p.open("POST",a,!0);p.send(b)},error:function(){}})}return!1}};a.uploadFile=function(c){var k=c.file,h=[];if("undefined"!==typeof k)if(4<b(".mck-file-box").length&&h.push("Can't upload more than 5 files at a time"),k.size>1048576*va&&h.push("file size can not be more than "+va+" MB"),0<h.length)alert(h.toString());else{var h=mckUtils.randomId(),l=[{fileIdExpr:h,fileName:c.name,fileNameExpr:'\x3ca href\x3d"#" target\x3d"_self" \x3e'+c.name+"\x3c/a\x3e",fileSizeExpr:a.getFilePreviewSize(k.size)}];
b.tmpl("fileboxTemplate",l).appendTo("#mck-file-box");var C=b(".mck-file-box."+h),n=b(".mck-file-box."+h+" .mck-file-lb"),v=b(".mck-file-box."+h+" .progress .bar"),y=b(".mck-file-box."+h+" .progress"),I=b(".mck-file-box."+h+" .mck-remove-file");v.css("width","0%");y.removeClass("n-vis").addClass("vis");I.attr("disabled",!0);t.attr("disabled",!0);g.removeClass("n-vis").addClass("vis");if(c.name===b(".mck-file-box."+h+" .mck-file-lb a").html()){var p=A.data("mck-id");H[c.name+k.size]=p;e.attr("disabled",
!0);c=[];c.push(k);var R=new XMLHttpRequest;(R.upload||R).addEventListener("progress",function(a){a=parseInt(a.loaded/a.total*100,10);v.css("width",a+"%")});R.addEventListener("load",function(c){c=b.parseJSON(this.responseText);if("object"===typeof c.fileMeta){c=c.fileMeta;var k=a.getFilePreviewPath(c),h=c.name,g=c.size,l=A.data("mck-id"),h=h+g,g=H[h];if(p!==l)d.updateDraftMessage(g,c),delete H[h];else return I.attr("disabled",!1),t.attr("disabled",!1),e.attr("disabled",!1),delete H[h],n.html(k),
y.removeClass("vis").addClass("n-vis"),b(".mck-file-box .progress").removeClass("vis").addClass("n-vis"),x.removeAttr("required"),F.push(c),C.data("mckfile",c),t.children("input").val(""),!1}else I.attr("disabled",!1),e.attr("disabled",!1),I.trigger("click")});b.ajax({type:"GET",url:G+"/rest/ws/aws/file/url",global:!1,data:"data\x3d"+(new Date).getTime(),crosDomain:!0,success:function(a){var b=new FormData;b.append("files[]",k);R.open("POST",a,!0);R.send(b)},error:function(){}})}return!1}};a.uplaodFileToAWS=
function(a,b){var d=new FormData,e=[];"undefined"!==typeof a&&(-1===a.type.indexOf("image")&&e.push("Please upload image file."),0<e.length?alert(e.toString()):(l.attr("disabled",!0),c[0]===b?(J.find(".mck-overlay-box").removeClass("n-vis"),J.removeClass("mck-hover-on"),D.removeClass("n-vis").addClass("vis")):(u.find(".mck-overlay-box").removeClass("n-vis"),u.removeClass("mck-hover-on"),M.removeClass("n-vis").addClass("vis")),e=new XMLHttpRequest,e.addEventListener("load",function(a){if(a=this.responseText)c[0]===
b?(I.html('\x3cimg src\x3d"'+a+'"/\x3e'),I.data("iconurl",a),C.html(MCK_LABELS["change.group.icon"]),D.removeClass("vis").addClass("n-vis"),J.addClass("mck-hover-on")):(k.html('\x3cimg src\x3d"'+a+'"/\x3e'),k.data("iconurl",a),M.removeClass("vis").addClass("n-vis"),u.addClass("mck-hover-on"),setTimeout(function(){w.removeClass("n-vis").addClass("vis")},1500)),setTimeout(function(){L.addClass("n-vis")},1500);l.attr("disabled",!1);c[0]===b?v.val(""):y.val("");return!1}),d.append("file",a),e.open("post",
MCK_BASE_URL+"/rest/ws/upload/file",!0),e.setRequestHeader("UserId-Enabled",!0),e.setRequestHeader("Authorization","Basic "+p),e.setRequestHeader("Application-Key",Q),e.setRequestHeader("Device-Key",ga),ja&&e.setRequestHeader("Access-Token",ja),e.send(d)))};a.deleteFileMeta=function(a){mckUtils.ajax({url:G+"/rest/ws/aws/file/delete?key\x3d"+a,type:"post",success:function(){},error:function(){}})};a.getFilePreviewPath=function(a){return"object"===typeof a?'\x3ca href\x3d"'+G+"/rest/ws/aws/file"+a.blobKey+
'" target\x3d"_blank"\x3e'+a.name+"\x3c/a\x3e":""};a.getFilePreviewSize=function(a){return a?1048576<a?"("+parseInt(a/1048576)+" MB)":1024<a?"("+parseInt(a/1024)+" KB)":"("+parseInt(a)+" B)":""};a.addFileBox=function(a){var d=mckUtils.randomId(),c="";"object"===typeof a.fileMeta&&(d=a.fileMeta.createdAtTime,c=a.fileMeta.name);b.tmpl("fileboxTemplate",[{fileNameExpr:a.filelb,fileSizeExpr:a.filesize,fileIdExpr:d,fileName:c}]).appendTo("#mck-file-box");var d=b(".mck-file-box."+d),c=d.find(".mck-remove-file"),
k=d.find(".progress");"object"===typeof a.fileMeta?(d.data("mckblob",a.fileMeta.blobKey),x.removeAttr("required"),e.attr("disabled",!1),c.attr("disabled",!1),k.removeClass("vis").addClass("n-vis"),F.push(a.fileMeta)):(e.attr("disabled",!0),c.attr("disabled",!0),k.removeClass("n-vis").addClass("vis"))}},d=new function(){var a=this,c="",l=b("#mck-search"),R=b("#mck-msg-to"),e=b(".mck-file-lb"),x=b(".mck-file-sz"),n=b("#mck-sidebox"),p=b("#mck-file-box"),xa=b("#mck-msg-sbmt"),v=b("#mck-msg-form"),y=
b("#mck-text-box"),U=b("#mck-msg-error");b("#mck-show-more");var ya=b("#mck-tab-title"),Pa=b("#mck-tab-status"),Q=b("#mck-message-cell"),N=b(".mck-typing-box"),D=b("#mck-no-messages"),k=b("#mck-product-box"),I=b(".mck-product-icon"),C=b(".mck-product-title"),P=b(".mck-product-subtitle"),sa=b("#mck-product-box .mck-caret"),Db=b(".mck-product-rt-up .mck-product-key"),ba=b("#mck-contact-search-input-box"),V=b(".mck-product-rt-up .mck-product-value"),da=b(".mck-product-rt-down .mck-product-key"),ea=b(".mck-product-rt-down .mck-product-value");
b("#li-mck-group-info");b("#li-mck-leave-group");var Ga=b("#mck-group-info-tab"),qa=b("#mck-group-search-tab"),la=b("#mck-no-search-groups"),db=b("#mck-group-create-tab"),ia=b("#mck-group-search-list");b("#mck-group-search-tabview");var S=b(".mck-group-menu-options"),ma=b(".mck-videocall-btn"),H=b("#mck-group-search-input"),pa=b("#mck-group-search-input-box"),ga=b("#mck-contact-search-list"),ja=b("#mck-contacts-content"),Z=b("#mck-contact-search-tab");b("#mck-contact-search-tabview");var na=b("#mck-contact-search-input");
b("#mck-search-list");var ua=b("#mck-no-search-contacts"),Da=b("#mck-search-tab-box li a"),Qa=b("#mck-search-tabview-box"),fa=b("#mck-sidebox-search"),ta=b("#mck-contact-loading"),hc=b("#mck-typing-label"),s=b("#mck-price-widget"),ra=b("#mck-msg-response"),va=b("#mck_response_text"),za=b("#li-mck-block-user"),Ha=b("#li-mck-video-call"),Ra=b("#mck-search-loading"),Yb=b("#mck-tab-individual"),Zb=b("#mck-attachfile-box"),f=b("#mck-attachmenu-box"),E=b("#mck-sidebox-content"),q=b("#mck-tab-option-panel"),
B=b("#mck-tab-conversation"),Za=b("#mck-conversation-header"),Sa=b("#mck-no-conversations"),$a=b("#mck-conversation-list"),Va=b(".mck-tab-message-option"),eb=b(".mck-box-ft .mck-box-form"),$b=b("#mck-btn-clear-messages"),Fb=b("#mck-offline-message-box"),z=b("#mck-message-cell .mck-message-inner");b("#mck-msg-new");var ic=RegExp(/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi);b.template("convTemplate",'\x3cli id\x3d"li-${convIdExpr}" class\x3d"${convIdExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${convIdExpr}" data-mck-id\x3d"${tabIdExpr}" data-isgroup\x3d"${isGroupExpr}" data-mck-topicid\x3d"${topicIdExpr}" data-isconvtab\x3d"true"\x3e\x3cdiv class\x3d"mck-row mck-truncate" title\x3d"${convTitleExpr}"\x3e${convTitleExpr}\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("messageTemplate",'\x3cdiv name\x3d"message" data-msgdelivered\x3d"${msgDeliveredExpr}" data-msgsent\x3d"${msgSentExpr}" data-msgtype\x3d"${msgTypeExpr}" data-msgtime\x3d"${msgCreatedAtTime}" data-msgcontent\x3d"${replyIdExpr}" data-msgkey\x3d"${msgKeyExpr}" data-contact\x3d"${toExpr}" class\x3d"mck-m-b ${msgKeyExpr} ${msgFloatExpr} ${msgAvatorClassExpr}"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12"\x3e\x3cdiv class\x3d"mck-msg-avator blk-lg-3"\x3e{{html msgImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-box ${msgClassExpr}"\x3e\x3cdiv class\x3d "move-right mck-msg-text"\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyToVisibleExpr}"\x3e\x3cdiv class\x3d"mck-msgto"\x3e${msgReplyTo} \x3c/div\x3e\x3c/div\x3e\x3cdiv class \x3d"mck-msg-reply mck-verticalLine ${msgReplyDivExpr}"\x3e\x3cdiv class\x3d"mck-msgreply-border ${textreplyVisExpr}"\x3e${msgReply}\x3c/div\x3e\x3cdiv class\x3d"mck-msgreply-border ${msgpreviewvisExpr}"\x3e{{html msgPreview}}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${nameTextExpr} ${showNameExpr}"\x3e\x3cspan class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/span\x3e${msgNameExpr}\x3c/div\x3e\x3cdiv class\x3d"mck-file-text notranslate mck-attachment downloadimage ${downloadIconVisibleExpr}" data-filemetakey\x3d"${fileMetaKeyExpr}" data-filename\x3d"${fileNameExpr}" data-fileurl\x3d "${fileUrlExpr}" data-filesize\x3d"${fileSizeExpr}"\x3e\x3cdiv\x3e{{html fileExpr}}\x3c/div\x3e {{html downloadMediaUrlExpr}}\x3c/div\x3e\x3cdiv class\x3d"mck-msg-text mck-msg-content"\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"${msgFloatExpr}-muted mck-text-light mck-text-muted mck-text-xs mck-t-xs"\x3e${createdAtTimeExpr} \x3cspan class\x3d"${statusIconExpr} mck-message-status"\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"n-vis mck-context-menu"\x3e\x3cul\x3e\x3cli\x3e\x3ca class\x3d"mck-message-forward ${msgForwardVisibleExpr}"\x3e${msgForwardExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-delete"\x3e${msgDeleteExpr}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca class\x3d"mck-message-reply"\x3e${msgReplyExpr}\x3c/a\x3e\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/div\x3e');
b.template("contactTemplate",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}" data-msg-time\x3d"${msgCreatedAtTimeExpr}"\x3e\x3ca class\x3d"${mckLauncherExpr}" href\x3d"#" data-mck-conversationid\x3d"${conversationExpr}" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"mck-conversation-topic mck-truncate ${contHeaderExpr}"\x3e${titleExpr}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-8 mck-cont-name mck-truncate"\x3e\x3cdiv class\x3d"mck-ol-status ${contOlExpr}"\x3e\x3cspan class\x3d"mck-ol-icon" title\x3d"${onlineLabel}"\x3e\x3c/span\x3e\x26nbsp;\x3c/div\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-text-muted move-right mck-cont-msg-date mck-truncate blk-lg-4"\x3e${msgCreatedDateExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"mck-cont-msg-wrapper blk-lg-6 mck-truncate msgTextExpr"\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-unread-count-box move-right mck-truncate ${contUnreadExpr}"\x3e\x3cspan class\x3d"mck-unread-count-text"\x3e{{html contUnreadCount}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
b.template("searchContactbox",'\x3cli id\x3d"li-${contHtmlExpr}" class\x3d"${contIdExpr}"\x3e\x3ca class\x3d"applozic-launcher" href\x3d"#" data-mck-id\x3d"${contIdExpr}" data-isgroup\x3d"${contTabExpr}"\x3e\x3cdiv class\x3d"mck-row" title\x3d"${contNameExpr}"\x3e\x3cdiv class\x3d"blk-lg-3"\x3e{{html contImgExpr}}\x3c/div\x3e\x3cdiv class\x3d"blk-lg-9"\x3e\x3cdiv class\x3d"mck-row"\x3e\x3cdiv class\x3d"blk-lg-12 mck-cont-name mck-truncate"\x3e\x3cstrong\x3e${contNameExpr}\x3c/strong\x3e\x3cdiv class\x3d"move-right mck-group-count-box mck-group-count-text ${displayGroupUserCountExpr}"\x3e${groupUserCountExpr}\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-muted"\x3e${contLastSeenExpr}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/a\x3e\x3c/li\x3e');
a.openConversation=function(){"none"===n.css("display")&&(b(".mckModal").mckModal("hide"),n.mckModal());R.focus()};a.initEmojis=function(){try{b("#mck-text-box").emojiarea({button:"#mck-btn-smiley",wysiwyg:!0,menuPosition:"top"})}catch(m){c||(c=setTimeout(function(){a.initEmojis()},3E4))}};a.loadTab=function(m,jc){var c=z.data("mck-id");if(c)if(1<y.html().length||p.hasClass("vis")){var e={text:y.html(),files:[]};p.hasClass("vis")&&b(".mck-file-box").each(function(){var a=b(this),m={filelb:a.find(".mck-file-lb").html(),
filesize:a.find(".mck-file-sz").html()},a=a.data("mckfile");"object"===typeof a&&(m.fileMeta=a);e.files.push(m)});Ja[c]=e}else delete Ja[c];Ba=!0;a.clearMessageField(!1);a.addDraftMessage(m.tabId);U.html("");U.removeClass("vis").addClass("n-vis");va.html("");ra.removeClass("vis").addClass("n-vis");v[0].reset();v.removeClass("n-vis").addClass("vis");z.html("");U.removeClass("mck-no-mb");ja.removeClass("n-vis").addClass("vis");eb.removeClass("vis").addClass("n-vis");fa.removeClass("vis").addClass("n-vis");
Ga.removeClass("vis").addClass("n-vis");db.removeClass("vis").addClass("n-vis");E.removeClass("n-vis").addClass("vis");k.removeClass("vis").addClass("n-vis");Za.addClass("n-vis");ta.removeClass("vis").addClass("n-vis");z.removeClass("mck-group-inner");Pa.removeClass("vis").addClass("n-vis");ya.removeClass("mck-tab-title-w-status");ya.removeClass("mck-tab-title-w-typing");N.removeClass("vis").addClass("n-vis");hc.html(MCK_LABELS.typing);z.data("isgroup",m.isGroup);z.data("datetime","");if(m.tabId)R.val(m.tabId),
z.data("mck-id",m.tabId),z.data("mck-conversationid",m.conversationId),z.data("mck-topicid",m.topicId),q.data("tabId",m.tabId),q.removeClass("n-vis").addClass("vis"),ja.removeClass("vis").addClass("n-vis"),eb.removeClass("n-vis").addClass("vis"),$b.removeClass("n-vis").addClass("vis"),S.removeClass("vis").addClass("n-vis"),m.isGroup?(z.addClass("mck-group-inner"),za.removeClass("vis").addClass("n-vis"),Ha.removeClass("vis").addClass("n-vis"),ma.removeClass("vis").addClass("n-vis")):(za.removeClass("n-vis").addClass("vis"),
Ha.removeClass("n-vis").addClass("vis"),Ka&&ma.removeClass("n-vis").addClass("vis")),!m.topicId&&m.conversationId&&(c=M[m.conversationId],"object"===typeof c&&(m.topicId=c.topicId)),m.topicId&&(c=J[m.topicId],"object"===typeof c&&(wa?(z.data("mck-title",c.title),Za.html(c.title),Za.removeClass("n-vis")):Ia&&(a.setProductProperties(c,m.topicId),sa.addClass("n-vis"),k.addClass("mck-product-box-wc"),$a.addClass("n-vis"),k.removeClass("n-vis").addClass("vis")))),Xa&&g.google&&"object"===typeof g.google.maps?
(Zb.removeClass("vis").addClass("n-vis"),f.removeClass("n-vis").addClass("vis")):(f.removeClass("vis").addClass("n-vis"),Zb.removeClass("n-vis").addClass("vis")),c=a.getTabDisplayName(m.tabId,m.isGroup,m.userName),a.isGroupDeleted(m.tabId,m.isGroup)&&(U.html(MCK_LABELS["group.deleted"]),U.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),v.removeClass("vis").addClass("n-vis")),ya.html(c),ya.attr("title",c),B.removeClass("vis").addClass("n-vis"),Qa.removeClass("vis").addClass("n-vis"),Yb.removeClass("n-vis").addClass("vis"),
"support"===nb&&b(".mck-tab-link").removeClass("vis").addClass("n-vis"),xb&&(s.removeClass("n-vis").addClass("vis"),z.addClass("mck-msg-w-panel")),ab&&(U.html("Deactivated"),U.removeClass("n-vis").addClass("vis").addClass("mck-no-mb"),v.removeClass("vis").addClass("n-vis")),O.subscibeToTypingChannel(m.tabId,m.isGroup),"function"===typeof ub&&ub({tabId:m.tabId,isGroup:m.isGroup});else if(m.tabId="",bb&&d.hideOfflineMessage(),Yb.removeClass("vis").addClass("n-vis"),B.removeClass("n-vis").addClass("vis"),
Qa.removeClass("n-vis").addClass("vis"),k.removeClass("vis").addClass("n-vis"),z.data("mck-id",""),z.data("mck-conversationid",""),z.data("mck-topicid",""),s.removeClass("vis").addClass("n-vis"),z.removeClass("mck-msg-w-panel"),q.removeClass("vis").addClass("n-vis"),$b.removeClass("vis").addClass("n-vis"),R.val(""),c=A.getLatestMessageArray(),O.unsubscibeToTypingChannel(),null!==c&&0<c.length){m.isReload=!0;d.addContactsFromMessageList({message:c},m);a.openConversation();Ba=!1;return}u.loadMessageList(m,
jc);a.openConversation()};a.setProductProperties=function(b,f){C.html(b.title);I.html(a.getTopicLink(b.link));P.html(b.subtitle?b.subtitle:"");var d=b.value1?":"+b.value1:"";Db.html(b.key1?b.key1:"");V.html(d);d=b.value2?":"+b.value2:"";da.html(b.key2?b.key2:"");ea.html(d);"function"===typeof rb&&(b.topicId=f,rb(b))};a.getTopicLink=function(a){return a?'\x3cimg src\x3d"'+a+'"\x3e':'\x3cspan class\x3d"mck-icon-no-image"\x3e\x3c/span\x3e'};a.processMessageList=function(m,f,c){var e,k=z.children("div[name\x3d'message']:first"),
h=z.data("mck-id"),g=z.data("isgroup")?mckGroupUtils.getGroup(h):d.fetchContact(h);"undefined"===typeof m.message.length?(h=[],h.push(m.message),A.updateMckMessageArray(h),a.addMessage(m.message,g,!1,!1,c),e=m.createdAtTime):(A.updateMckMessageArray(m.message),b.each(m.message,function(b,m){"undefined"!==typeof m.to&&(a.addMessage(m,g,!1,!1,c),e=m.createdAtTime)}));q.data("datetime",e);!f&&0<k.length?z.scrollTop(k.offset().top-z.offset().top+z.scrollTop()):f&&z.animate({scrollTop:z.prop("scrollHeight")},
"fast")};a.closeConversation=function(a){if("function"===typeof tb){var b=tb();if("object"===typeof b)var f="BUSY_WITH_OTHER"===a?b.onBusyWithOtherUser:b.onConversationClose}f||(f="Chat disabled with user");U.html(f);U.removeClass("n-vis").addClass("vis").addClass("mck-no-mb");v.removeClass("vis").addClass("n-vis")};a.addTooltip=function(a){b("."+a+" .mck-icon-time").attr("title","pending");b("."+a+" .mck-btn-trash").attr("title","delete");b("."+a+" .mck-icon-sent").attr("title","sent");b("."+a+" .mck-btn-forward").attr("title",
"forward message");b("."+a+" .mck-icon-delivered").attr("title","delivered");b("."+a+" .mck-icon-read").attr("title","delivered and read");b("."+a+" .msgtype-outbox-cr").attr("title","sent via Carrier");b("."+a+" .msgtype-outbox-mck").attr("title","sent");b("."+a+" .msgtype-inbox-cr").attr("title","received via Carrier");b("."+a+" .msgtype-inbox-mck").attr("title","recieved")};a.fetchContact=function(b){var f=a.getContact(b);"undefined"===typeof f&&(f=a.createContact(b));return f};a.getContact=function(a){if("object"===
typeof Aa[a])return Aa[a]};a.getContactDisplayName=function(a){if("string"===typeof ka[a])return ka[a];if("undefined"===typeof ka[a]&&(a=ca[a],"undefined"!==typeof a))return a.displayName};a.addMessage=function(m,f,c,q,e){var k="",h="",B="",E="vis",l="n-vis",C="",Sa="n-vis";if("object"===typeof m.metadata&&"undefined"!==typeof m.metadata.AL_REPLY&&(k=m.metadata.AL_REPLY,h=u.getReplyMessageByKey(k),"undefined"!==typeof h)){if(f.isGroup&&h||!f.isGroup&&"undefined"===typeof h.fileMeta)Sa="vis";C=5===
h.type?"You":d.getTabDisplayName(h.to,!1);if("object"===typeof h.fileMeta||2===h.contentType)B=a.getImageForReplyMessage(h),E="n-vis",l="vis",Sa="n-vis"}if(6!==m.type&&7!==m.type&&!(m.metadata&&"HIDDEN"===m.metadata.category||102===m.contentType||10===m.contentType&&m.metadata&&"true"===m.metadata.hide||0<b("#mck-message-cell ."+m.key).length)){D.hasClass("vis")&&D.removeClass("vis").addClass("n-vis");var n="mck-msg-right",x="mck-icon-time";if(0===m.type||4===m.type||6===m.type)n="mck-msg-left";if(4===
m.contentType||10===m.contentType||103===m.contentType)n="mck-msg-center";var x=a.getStatusIconName(m),k=m.key,P="'"+m.deviceKey+"','"+m.to+"','"+m.to+"','"+k+"'",v="",I="",p="",y="n-vis",R="";Y.loadUserProfile(m.to);!m.groupId||4===m.contentType||7===f.type||0!==m.type&&4!==m.type&&6!==m.type||(v=a.getTabDisplayName(m.to,!1),y="vis",p=a.getNameTextClassByAlphabet(v));if(Lb){var R="mck-msg-avator-bubble",s="",L=v;"mck-msg-right"===n?(s=d.fetchContact(w),L=a.getTabDisplayName(s.displayName,!1)):"mck-msg-left"===
n&&(s=m.groupId?d.fetchContact(m.to):f);s&&(I=a.getContactImageLink(s,L))}m.groupId&&10===m.contentType&&(p=I=v="");f="n-vis";var L=s="",sa=m.message;"object"===typeof m.fileMeta&&(s=m.fileMeta.name,L=m.fileMeta.size);"object"===typeof m.fileMeta&&(m.fileMeta.contentType.indexOf("audio")||m.fileMeta.contentType.indexOf("image")||m.fileMeta.contentType.indexOf("video"))&&(f="vis");var Xb="n-vis";hb&&g.MCK_OL_MAP[m.to]&&10!==m.contentType&&(Xb="vis");B=[{msgReply:h?h.message+"\n":"",msgReplyTo:h?C+
"\n":"",msgReplyDivExpr:h?"vis":"n-vis",msgReplyToVisibleExpr:Sa,msgPreview:B?a.getImageForReplyMessage(h):"",msgpreviewvisExpr:l,textreplyVisExpr:E,msgKeyExpr:m.key,msgDeliveredExpr:m.delivered,msgSentExpr:m.sent,msgCreatedAtTime:m.createdAtTime,msgTypeExpr:m.type,msgDeleteExpr:MCK_LABELS["delete"],msgReplyExpr:MCK_LABELS.reply,msgForwardExpr:MCK_LABELS.forward,msgForwardVisibleExpr:"kommunicate"==window.applozic.PRODUCT_ID?"n-vis":"vis",msgSourceExpr:m.source,statusIconExpr:x,contactExpr:"vis",
toExpr:m.to,msgAvatorClassExpr:R,showNameExpr:y,msgNameExpr:v,msgImgExpr:I,nameTextExpr:p,msgFloatExpr:n,replyIdExpr:k,createdAtTimeExpr:mckDateUtils.getDate(m.createdAtTime),msgFeatExpr:"n-vis",replyMessageParametersExpr:P,downloadMediaUrlExpr:a.getFileAttachment(m),msgClassExpr:"",msgExpr:sa,selfDestructTimeExpr:m.timeToLive,fileMetaKeyExpr:m.fileMetaKey,downloadIconVisibleExpr:f,fileExpr:a.getFilePath(m),fileUrlExpr:a.getFileurl(m),fileNameExpr:s,fileSizeExpr:L,contOlExpr:Xb}];c?b.tmpl("messageTemplate",
B).appendTo("#mck-message-cell .mck-message-inner"):b.tmpl("messageTemplate",B).prependTo("#mck-message-cell .mck-message-inner");B="";m.message&&(B=m.message.replace(/\n/g,"\x3cbr/\x3e"),null!==g.emoji&&"undefined"!==typeof g.emoji&&(B=g.emoji.replace_unified(B),B=g.emoji.replace_colons(B)));m.conversationId&&(E=M[m.conversationId],"object"!==typeof E&&u.getTopicId({conversationId:m.conversationId}),c&&(z.data("mck-conversationid",m.conversationId),E&&(l=J[E.topicId],"object"===typeof l&&(Ia?a.setProductProperties(l,
E.topicId):wa&&Za.html(l.title)))));4===m.contentType&&(E=B,B="Final agreed price: "+B,xb||(B+='\x3cbr/\x3e\x3cbutton class\x3d"mck-accept" data-mck-topic-price\x3d"'+E+'" data-mck-conversationid\x3d"'+m.conversationId+'"\x3eAccept\x3c/button\x3e'));E=b("."+k+" .mck-msg-content");if(-1===B.indexOf("emoji-inner")&&0===m.contentType)for(B=B.split("\x3cbr/\x3e"),l=0;l<B.length;l++)C=r.createElement("div"),C.appendChild(r.createTextNode(B[l])),B[l]&&B[l].match(ic)&&(C=b(C).linkify({target:"_blank"})),
E.append(C);else E.html(B),E.linkify({target:"_blank"});m.fileMeta&&(b("."+k+" .mck-file-text a:first").trigger("click"),b("."+k+" .mck-file-text").removeClass("n-vis").addClass("vis"),""===E.html()&&E.removeClass("vis").addClass("n-vis"));2===m.contentType&&(E.removeClass("vis").addClass("n-vis"),b("."+k+" .mck-file-text").removeClass("n-vis").addClass("vis"));q&&z.animate({scrollTop:z.prop("scrollHeight")},"fast");Va.hasClass("n-vis")&&(m.groupId?6!==mckGroupUtils.getGroup(m.groupId).type&&Va.removeClass("n-vis").addClass("vis"):
Va.removeClass("n-vis").addClass("vis"));a.addTooltip(m.key);4!==m.contentType&&10!==m.contentType&&e&&a.messageContextMenu(m.key);m.groupId&&10===m.contentType&&c&&mckGroupService.getGroupFeed({groupId:m.groupId,isReloadTab:!0,apzCallback:t.onGroupFeed})}};a.addContactForSearchList=function(m,f){var d=m.userCount,c=m.isGroup,q=a.getTabDisplayName(m.contactId,c),e=a.getContactImageLink(m,q),k=c?"gs-group-"+m.htmlId:"cs-user-"+m.htmlId,h="",B=c&&zb;b("#li-"+k+" .mck-group-count-text").html(d);c||ha[m.contactId]||
(g.MCK_OL_MAP[m.contactId]?h=MCK_LABELS.online:T[m.contactId]&&(h=mckDateUtils.getLastSeenAtStatus(T[m.contactId])));b.tmpl("searchContactbox",[{contHtmlExpr:k,contIdExpr:m.contactId,contTabExpr:m.isGroup,contImgExpr:e,contLastSeenExpr:h,contNameExpr:q,groupUserCountExpr:m.userCount,displayGroupUserCountExpr:B?"vis":"n-vis"}]).prependTo("#"+f)};a.getFileurl=function(a){return"object"===typeof a.fileMeta?G+"/rest/ws/aws/file/"+a.fileMeta.blobKey:""};a.getFilePath=function(a){if(2===a.contentType)try{var f=
b.parseJSON(a.message);if(f.lat&&f.lon)return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+f.lat+","+f.lon+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+f.lat+","+f.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+f.lat+","+f.lon+"\x26key\x3d"+Jb+'"/\x3e\x3c/a\x3e'}catch(d){if(-1!==a.message.indexOf(","))return'\x3ca href\x3d"http://maps.google.com/maps?z\x3d17\x26t\x3dm\x26q\x3dloc:'+
a.message+'" target\x3d"_blank"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+a.message+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.message+"\x26key\x3d"+Jb+'" /\x3e\x3c/a\x3e'}return"object"===typeof a.fileMeta?-1!==a.fileMeta.contentType.indexOf("image")?-1!==a.fileMeta.contentType.indexOf("svg")?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+a.fileMeta.contentType+
'" data-url\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':5===a.contentType?'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+a.fileMeta.contentType+'" data-url\x3d"'+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+a.fileMeta.blobKey+'" area-hidden\x3d"true"\x3e\x3c/img\x3e\x3c/a\x3e':
'\x3ca href\x3d"#" target\x3d"_self"  role\x3d"link" class\x3d"file-preview-link fancybox-media fancybox" data-type\x3d"'+a.fileMeta.contentType+'" data-url\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" data-name\x3d"'+a.fileMeta.name+'"\x3e\x3cimg src\x3d"'+a.fileMeta.thumbnailUrl+'" area-hidden\x3d"true" \x3e\x3c/img\x3e\x3c/a\x3e':-1!==a.fileMeta.contentType.indexOf("video")?'\x3ca href\x3d "#" target\x3d"_self"  \x3e\x3cvideo controls class\x3d"mck-video-player"\x3e\x3csource src\x3d"'+G+
"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"video/mp4"\x3e\x3csource src\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"video/ogg"\x3e\x3c/video\x3e\x3c/a\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3ca href\x3d"#" target\x3d"_self" \x3e\x3caudio controls class\x3d"mck-audio-player"\x3e\x3csource src\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"audio/ogg"\x3e\x3csource src\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" type\x3d"audio/mpeg"\x3e\x3c/audio\x3e\x3cp class\x3d"mck-file-tag"\x3e\x3c/p\x3e\x3c/a\x3e':
'\x3ca href\x3d"#" role\x3d"link" class\x3d"file-preview-link" target\x3d"_blank"\x3e\x3c/a\x3e':""};a.getImageForMessagePreview=function(a){if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan\x3ephoto\x3c/span\x3e \x3cimg src\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" class\x3d"mck-image-reply move-right"/\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan\x3eaudio\x3c/span\x3e\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+
a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+oa.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e":'\x3cspan class\x3d"mck-file-detail move-right"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+oa.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===a.contentType)return a=b.parseJSON(a.message),'\x3cspan\x3elocation\x3c/span\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+
a.lat+","+a.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.lat+","+a.lon+'" class\x3d"mck-image-reply move-right"/\x3e'};a.getImageForReplyMessage=function(a){var f=d.getTabDisplayName(a.to,!1);if("object"===typeof a.fileMeta)return-1!==a.fileMeta.contentType.indexOf("image")?'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+f+'\x3c/div\x3e\x3cdiv\x3e\x3cspan class\x3d"mck-icon-camera mck-camera"\x3e\x3c/span\x3e\x3cspan\x3ePhoto\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"'+
G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" class\x3d"mck-image-reply mck-msg-text mck-msg-content"/\x3e\x3c/div\x3e\x3c/div\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+f+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail mck-msg-text mck-msg-content"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+oa.getFilePreviewSize(a.fileMeta.size)+
"\x3c/span\x3e\x3c/span\x3e":'\x3cdiv class\x3d"mck-attachmentmsgto"\x3e'+f+'\x3c/div\x3e\x3cspan class\x3d"mck-file-detail"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+oa.getFilePreviewSize(a.fileMeta.size)+"\x3c/span\x3e\x3c/span\x3e";if(2===a.contentType)return a=b.parseJSON(a.message),'\x3cdiv\x3e\x3cdiv class\x3d"mck-imagereply mck-margin"\x3e\x3cdiv class\x3d"mck-msgto"\x3e'+
f+'\x3c/div\x3e\x3cspan class\x3d"mck-icon-marker mck-location-icon"\x3e\x3c/span\x3e\x3cspan\x3eLocation\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d"mck-imagereply"\x3e\x3cimg src\x3d"https://maps.googleapis.com/maps/api/staticmap?zoom\x3d17\x26size\x3d200x150\x26center\x3d'+a.lat+","+a.lon+"\x26maptype\x3droadmap\x26markers\x3dcolor:red|"+a.lat+","+a.lon+'" class\x3d"mck-image-reply mck-msg-text "/\x3e\x3c/div\x3e\x3c/div\x3e'};a.getFileAttachment=function(a){if("object"===typeof a.fileMeta)return-1!==
a.fileMeta.contentType.indexOf("image")||-1!==a.fileMeta.contentType.indexOf("audio")||a.fileMeta.contentType.indexOf("video"),'\x3ca href\x3d"'+G+"/rest/ws/aws/file/"+a.fileMeta.blobKey+'" role\x3d"link" target\x3d"_self"  class\x3d"file-preview-link"\x3e\x3cspan class\x3d"file-detail mck-image-download"\x3e\x3cspan class\x3d"mck-file-name"\x3e\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;'+a.fileMeta.name+'\x3c/span\x3e\x26nbsp;\x3cspan class\x3d"file-size"\x3e'+oa.getFilePreviewSize(a.fileMeta.size)+
"\x3c/span\x3e\x3c/span\x3e\x3c/a\x3e"};a.getFileIcon=function(a){return a.fileMetaKey&&"object"===typeof a.fileMeta?-1!==a.fileMeta.contentType.indexOf("image")?'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eImage\x3c/span\x3e':-1!==a.fileMeta.contentType.indexOf("audio")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eAudio\x3c/span\x3e':-1!==a.fileMeta.contentType.indexOf("video")?'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eVideo\x3c/span\x3e':
'\x3cspan class\x3d"mck-icon-attachment"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eFile\x3c/span\x3e':""};a.getContactFromGroupOfTwo=function(a){for(var b=0;b<a.members.length;b++)if(w!==""+a.members[b])return d.fetchContact(""+a.members[b])};a.getContactImageLink=function(b,f){var d="";if(b.isGroup&&7!==b.type)d=t.getGroupImage(b.imageUrl);else{b.isGroup&&7===b.type&&1<b.members.length&&(b=a.getContactFromGroupOfTwo(b));if("function"===typeof La){var c=La(b.contactId);c&&"undefined"!==typeof c&&(d='\x3cimg src\x3d"'+
c+'"/\x3e')}d||(b.photoSrc?d='\x3cimg src\x3d"'+b.photoSrc+'"/\x3e':b.photoData?d='\x3cimg src\x3d"data:image/jpeg;base64,'+b.photoData+'"/\x3e':b.photoLink?d='\x3cimg src\x3d"'+MCK_BASE_URL+"/contact.image?photoLink\x3d"+b.photoLink+'"/\x3e':(f||(f=b.displayName),d=a.getContactImageByAlphabet(f)))}return d};a.getContactImageByAlphabet=function(a){if("undefined"===typeof a||""===a)return'\x3cdiv class\x3d"mck-alpha-contact-image mck-alpha-user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e';
a=a.charAt(0);return a.match(/^[a-zA-Z]+$/)?(a=a.toUpperCase(),'\x3cdiv class\x3d"mck-videocall-image alpha_'+a+'"\x3e\x3cspan class\x3d"mck-contact-icon"\x3e'+a+"\x3c/span\x3e\x3c/div\x3e"):'\x3cdiv class\x3d"mck-videocall-image alpha_user"\x3e\x3cspan class\x3d"mck-icon-user"\x3e\x3c/span\x3e\x3c/div\x3e'};a.getNameTextClassByAlphabet=function(a){if("undefined"===typeof a||""===a)return"mck-text-user";a=a.toString();a=a.charAt(0);return a.match(/^[a-zA-Z]+$/)?(a=a.toLowerCase(),"mck-text-"+a):"mck-text-user"};
a.addContactsFromMessageList=function(m,f){var d;D.removeClass("vis").addClass("n-vis");if("null"===m+"")d="";else if(Sa.removeClass("vis").addClass("n-vis"),0==z.has(b("#mck-contact-list")).length&&z.html('\x3cul id\x3d"mck-contact-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),"undefined"===typeof m.message.length?(m.message.groupId?a.addGroupFromMessage(m.message):a.addContactsFromMessage(m.message),d=m.message.createdAtTime):b.each(m.message,function(b,
f){"undefined"!==typeof f.to&&(f.groupId?a.addGroupFromMessage(f,!0):a.addContactsFromMessage(f,!0),d=f.createdAtTime)}),z.data("datetime",d),f.isReload){var c="";f.lastActiveTabId&&(c=f.isLastActiveTabGroup?"group-"+f.lastActiveTabId:"user-"+mckContactUtils.formatContactId(f.lastActiveTabId),c=b("#li-"+c));0<c.length?z.animate({scrollTop:c.offset().top-z.offset().top+z.scrollTop()},"fast"):z.animate({scrollTop:0},0)}};a.addGroupFromMessageList=function(f,d){"null"!==f+""&&(d&&z.html('\x3cul id\x3d"mck-group-list" class\x3d"mck-contact-list mck-nav mck-nav-tabs mck-nav-stacked"\x3e\x3c/ul\x3e'),
"undefined"===typeof f.message.length?a.addGroupFromMessage(f.message):b.each(f.message,function(b,f){"undefined"!==typeof f.to&&a.addGroupFromMessage(f,!0)}))};a.createContact=function(b){var f=a.getContactDisplayName(b);"undefined"===typeof f&&(f=b);f={contactId:b,htmlId:mckContactUtils.formatContactId(b),displayName:f,name:f+" \x3c"+b+"\x3e [Main]",value:b,photoLink:"",photoSrc:"",photoData:"",email:"",unsaved:!0,isGroup:!1};return Aa[b]=f};a.createContactWithDetail=function(b){var f=b.displayName,
d=b.userId;f||(f=a.getContactDisplayName(d));"undefined"===typeof f?f=d:ka[d]=f;var c=b.photoLink?b.photoLink:"";c||(c=b.imageLink?b.imageLink:"");b=b.imageData?b.imageData:"";f={contactId:d,htmlId:mckContactUtils.formatContactId(d),displayName:f,name:f+" \x3c"+d+"\x3e [Main]",value:d,photoLink:"",photoSrc:c,photoData:b,email:"",unsaved:!0,isGroup:!1};return Aa[d]=f};a.updateContactDetail=function(b,f){var d=f.displayName,c=f.userId;b.displayName&&b.displayName!==b.contactId||(d||(d=a.getContactDisplayName(c)),
"undefined"===typeof d?d=c:ka[c]=d,b.displayName=d);(d=f.photoLink)||(d=f.imageLink?f.imageLink:"");d&&!b.photoSrc&&(b.photoSrc=d);(d=f.imageData?f.imageData:"")&&!b.photoData&&(b.photoData=d);return Aa[c]=b};a.addContactsFromMessage=function(b,f){var d=a.getUserIdFromMessage(b);if(0<d.length&&d[0])for(var c=0;c<d.length;c++){var q=a.fetchContact(""+d[c]);a.updateRecentConversationList(q,b,f)}};a.addGroupFromMessage=function(b,f){var d=b.groupId,c=mckGroupUtils.getGroup(""+d);"undefined"===typeof c&&
(c=mckGroupUtils.createGroup(d),mckGroupService.loadGroups({apzCallback:t.loadGroups}));a.updateRecentConversationList(c,b,f)};a.updateRecentConversationList=function(f,d,c){0<b("#mck-contact-list #li-"+(f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId)).length?(b("#mck-contact-list #li-"+f.htmlId+" .mck-cont-msg-wrapper").is(":empty")||c)&&void 0!==d&&a.updateContact(f,d,"mck-contact-list"):a.addContact(f,"mck-contact-list",d)};a.addContactsToSearchList=function(){var f=[],d=[];b.each(Na,function(a,
b){d.push(b.contactId)});var c=d.filter(function(a,b){return d.indexOf(a)===b});c.sort();Ra.removeClass("vis").addClass("n-vis");0<c.length?b.each(c,function(d,c){if(c){var q=a.fetchContact(""+c);f.push(q);0===b("#li-cs-user-"+q.htmlId).length&&a.addContactForSearchList(q,"mck-contact-search-list")}}):ua.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:f,$searchId:na,isContactSearch:!0})};a.initAutoSuggest=function(f){for(var c=f.contactsArray,q=f.$searchId,e=[],k,h={},B=[],E=
0;E<c.length;E++){var g=c[E];g.displayName=a.getTabDisplayName(g.contactId,g.isGroup);k=g.displayName?b.trim(g.displayName):b.trim(g.contactId);h[k]=g;e.push(k);B.push(k)}c=function(a){a=h[a];var b=a.displayName.split(" "),f=b.length,d=b[0],m="",c="";2===f?c=b[1]:3<=f&&(c=b[f-1],m=b[f-2]);b=RegExp(this.query,"i");return b.test(a.displayName)||b.test(a.contactId)||b.test(m)||b.test(c)||b.test(a.email)||b.test(d+" "+c)};k=function(a){return h[a].displayName};B=function(a){a=h[a];f.isContactSearch?(d.loadTab({tabId:a.contactId,
isGroup:a.isGroup}),eb.removeClass("n-vis").addClass("vis")):t.addGroupMemberFromSearch(a.contactId)};q.hasClass("mck-typeahead")?(q.mcktypeahead().data("mcktypeahead").source=e,q.mcktypeahead().data("mcktypeahead").matcher=c,q.mcktypeahead().data("mcktypeahead").highlighter=k,q.mcktypeahead().data("mcktypeahead").updater=B):(q.addClass("mck-typeahead"),q.mcktypeahead({source:e,matcher:c,highlighter:k,updater:B}))};a.initSearchAutoType=function(){Ub&&(na.keypress(function(a){if(13===a.which){if(a=
na.val())if(a="undefined"!==typeof a&&""!==a?a.toString():"")d.loadTab({tabId:a,isGroup:!1,isSearch:!0}),eb.removeClass("n-vis").addClass("vis");na.val("")}}),H.keypress(function(a){if(13===a.which)return!0}),b(r).on("click",".mck-group-search-link",function(a){a.preventDefault();return!0}),b(r).on("click",".mck-contact-search-link",function(a){a.preventDefault();a=na.val();""!==a&&(d.loadTab({tabId:a,isGroup:!1,isSearch:!0}),eb.removeClass("n-vis").addClass("vis"));na.val("")}))};a.removeContact=
function(a){b("#li-"+(a.isGroup?"group-"+a.htmlId:"user-"+a.htmlId)).remove()};a.updateContact=function(f,d,c){var q=f.isGroup?"group-"+f.htmlId:"user-"+f.htmlId,e=b("#li-"+q),k=e.data("msg-time");if(d&&d.createdAtTime>k){k=a.getUnreadCount(d.groupId?"group_"+f.contactId:"user_"+f.contactId);f=a.getMessageTextForContactPreview(d,f,15);b("#li-"+q+" .mck-cont-msg-date").html("undefined"===typeof d.createdAtTime?"":mckDateUtils.getTimeOrDate(d?d.createdAtTime:"",!0));var h=b("#li-"+q+" .mck-cont-msg-wrapper");
h.html("");"object"===typeof f?h.append(f):h.html(f);d.conversationId&&(f=d.conversationId,h=M[f],"object"===typeof h&&(h=h.topicId)&&wa&&(h=J[h],"object"===typeof h&&b("#li-"+q+" .mck-conversation-topic").html(h.title)),b("#li-"+q+" a").data("mck-conversationid",f));0<k&&(b("#li-"+q+" .mck-unread-count-text").html(k),b("#li-"+q+" .mck-unread-count-box").removeClass("n-vis").addClass("vis"));q=b("#"+c+" li:nth-child(1)").data("msg-time");e.data("msg-time",d.createdAtTime);("undefined"===typeof q||
(d?d.createdAtTime:"")>=q)&&0!==b("#mck-contact-list li").index(e)&&b("#"+c+" li:nth-child(1)").before(e)}};a.clearContactMessageData=function(a,f){var d=mckContactUtils.formatContactId(a),d=f?"group-"+d:"user-"+d;b("#li-"+d+" .mck-cont-msg-date").html("");b("#li-"+d+" .mck-cont-msg-wrapper").html("")};a.addContact=function(f,c,q){var e=a.getMessageTextForContactPreview(q,f,100),k=f.userCount,h="",B=!1;if("undefined"!==typeof q){if(q.conversationId)var h=q.conversationId,E=M[h];q.groupId&&(B=!0)}var l=
a.getTabDisplayName(f.contactId,B),Za=a.getContactImageLink(f,l),C=!1,Sa=a.getUnreadCount(B?"group_"+f.contactId:"user_"+f.contactId),n=0<Sa&&"mck-search-list"!==c?"vis":"n-vis",z="n-vis",x=B?"group-"+f.htmlId:"user-"+f.htmlId,v=B&&zb;b("#li-"+x+" .mck-group-count-text").html(k);b("#li-"+x+" .mck-group-count-box").removeClass("n-vis").addClass("vis");B||ha[f.contactId]||Ca[f.contactId]||!hb||!g.MCK_OL_MAP[f.contactId]||(z="vis",C=!0);7===f.type&&1<f.members.length&&(x=mckGroupUtils.getGroup(q.groupId),
x=d.getContactFromGroupOfTwo(x),B&&hb&&g.MCK_OL_MAP[x.contactId]&&(z="vis",C=!0));k="n-vis";if("object"===typeof E&&wa&&(E=J[E.topicId],"object"===typeof E))var k="vis",I=E.title;x=B?"group-"+f.htmlId:"user-"+f.htmlId;f=[{contHtmlExpr:x,contIdExpr:f.contactId,contTabExpr:B,msgCreatedAtTimeExpr:q?q.createdAtTime:"",mckLauncherExpr:Wa,contImgExpr:Za,contOlExpr:z,onlineLabel:MCK_LABELS.online,contUnreadExpr:n,contUnreadCount:Sa,contNameExpr:l,conversationExpr:h,contHeaderExpr:k,titleExpr:I,groupUserCountExpr:B?
f.userCount:"",displayGroupUserCountExpr:v?"vis":"n-vis",msgCreatedDateExpr:q?mckDateUtils.getTimeOrDate(q.createdAtTime,!0):""}];h=b("#"+c+" li:nth-child(1)").data("msg-time");"undefined"===typeof h||(q?q.createdAtTime:"")>=h||-1!==c.indexOf("search")&&C?b.tmpl("contactTemplate",f).prependTo("#"+c):b.tmpl("contactTemplate",f).appendTo("#"+c);c=b("#li-"+x+" .msgTextExpr");"object"===typeof e?c.append(e):c.html(e)};a.addContactsToContactSearchList=function(){ua.removeClass("vis").addClass("n-vis");
la.removeClass("vis").addClass("n-vis");Z.hasClass("active")||(Da.removeClass("active"),Z.addClass("active"));ia.removeClass("vis").addClass("n-vis");ga.removeClass("n-vis").addClass("vis");pa.removeClass("vis").addClass("n-vis");ba.removeClass("n-vis").addClass("vis");ga.html("");ja.removeClass("vis").addClass("n-vis");E.removeClass("vis").addClass("n-vis");Ga.removeClass("vis").addClass("n-vis");db.removeClass("vis").addClass("n-vis");fa.removeClass("n-vis").addClass("vis");Ra.removeClass("n-vis").addClass("vis");
0!==Na.length?d.addContactsToSearchList():Ab?(Ra.removeClass("vis").addClass("n-vis"),ua.removeClass("n-vis").addClass("vis")):Y.loadContacts();na.focus()};a.addGroupsToGroupSearchList=function(){var f=[],d=[];ua.removeClass("vis").addClass("n-vis");la.removeClass("vis").addClass("n-vis");qa.hasClass("active")||(Da.removeClass("active"),qa.addClass("active"));ga.removeClass("vis").addClass("n-vis");ia.removeClass("n-vis").addClass("vis");ba.removeClass("vis").addClass("n-vis");pa.removeClass("n-vis").addClass("vis");
ia.html("");ja.removeClass("vis").addClass("n-vis");E.removeClass("vis").addClass("n-vis");Ga.removeClass("vis").addClass("n-vis");db.removeClass("vis").addClass("n-vis");fa.removeClass("n-vis").addClass("vis");Ra.removeClass("n-vis").addClass("vis");if(0<Ma.length){b.each(Ma,function(a,b){d.push(b.contactId)});var c=d.filter(function(a,b){return d.indexOf(a)===b});c.sort();b.each(c,function(d,c){if(c){var q=mckGroupUtils.getGroup(""+c);f.push(q);0===b("#li-gs-group-"+q.htmlId).length&&a.addContactForSearchList(q,
"mck-group-search-list")}})}else la.removeClass("n-vis").addClass("vis");a.initAutoSuggest({contactsArray:f,$searchId:H,isContactSearch:!0});Ra.removeClass("vis").addClass("n-vis")};a.addConversationMenu=function(a,f){var d=z.data("mck-id");$a.html("");a===d&&(d=W[a],"undefined"===typeof d||0===d.length||1===d.length?(sa.addClass("n-vis"),k.addClass("mck-product-box-wc"),$a.addClass("n-vis")):($a.removeClass("n-vis"),sa.removeClass("n-vis"),k.removeClass("mck-product-box-wc"),b.each(d,function(d,
c){if(0===b("#mck-conversation-list #li-"+c.id).length){var q="";c.topicDetail&&(q=b.parseJSON(c.topicDetail),q="object"===typeof q?q.title:c.topicDetail);q||(q=c.topicId);b.tmpl("convTemplate",[{convIdExpr:c.id,tabIdExpr:a,isGroupExpr:f,topicIdExpr:c.topicId,convTitleExpr:q,mckLauncherExpr:Wa}]).appendTo($a)}}),2>b("#mck-conversation-list li").length&&(sa.addClass("n-vis"),k.addClass("mck-product-box-wc"),$a.addClass("n-vis"))))};a.loadContacts=function(f){"null"!==f+""&&"undefined"!==typeof f&&
"undefined"!==typeof f.contacts&&0!==f.contacts.length&&(Na.length=0,Oa.length=0,b.each(f.contacts,function(b,f){if("undefined"!==typeof f.userId){var d=a.getContact(""+f.userId),d="undefined"===typeof d?a.createContactWithDetail(f):a.updateContactDetail(d,f);Na.push(d);Oa.push(d.contactId)}}))};a.getStatusIcon=function(b){return'\x3cspan class\x3d"'+a.getStatusIconName(b)+" move-right "+b.key+'_status status-icon"\x3e\x3c/span\x3e'};a.getStatusIconName=function(a){return 7===a.type||6===a.type||
4===a.type||0===a.type?"":5===a.status?"mck-icon-read":4===a.status?"mck-icon-delivered":3===a.type||5===a.type||1===a.type&&(0===a.source||1===a.source)?"mck-icon-sent":""};a.clearMessageField=function(a){y.html("");xa.attr("disabled",!1);p.removeClass("vis").removeClass("mck-text-req").addClass("n-vis").attr("required","").html("");a?y.focus().select():(l.blur(),y.blur())};a.addDraftMessage=function(a){F=[];a&&"object"===typeof Ja[a]?(a=Ja[a],y.html(a.text),0<a.files.length&&(b.each(a.files,function(a,
b){oa.addFileBox(b)}),e.html(a.filelb),x.html(a.filesize),p.removeClass("n-vis").removeClass("mck-text-req").addClass("vis").removeAttr("required"))):F=[]};a.showOfflineMessage=function(){"object"===typeof aa&&aa.innerHTML?(Fb.html(aa.innerHTML),Fb.removeClass("n-vis").addClass("vis")):g.console.log("Offline message innerHTML required.")};a.hideOfflineMessage=function(){Ya.stopOfflineMessageCounter();Fb.removeClass("vis").addClass("n-vis")};a.removeConversationThread=function(a,f){A.clearMckMessageArray();
var c=f?mckGroupUtils.getGroup(a):d.getContact(a),e=z.data("mck-id"),k=z.data("isgroup");"undefined"===typeof e||""===e?(c="undefined"!==typeof c?c.htmlId:mckContactUtils.formatContactId(a),b("#li-"+(f?"group-"+c:"user-"+c)).remove()):e===a&&k===f&&(q.data("datetime",""),D.removeClass("n-vis").addClass("vis"),Q.removeClass("n-vis").addClass("vis"),Va.removeClass("vis").addClass("n-vis"))};a.removedDeletedMessage=function(a,f,d){A.clearMckMessageArray();a=b("."+a);0<a.length?(a.remove(),z.is(":empty")&&
(Q.removeClass("n-vis").addClass("vis"),Va.removeClass("vis").addClass("n-vis"))):"undefined"!==typeof f&&0<b("#mck-contact-list").length&&u.updateContactList(f,d)};a.getMessageTextForContactPreview=function(a,b,f){var c="";if("undefined"!==typeof a){if(a.message)if(2===a.contentType)c='\x3cspan class\x3d"mck-icon-marker"\x3e\x3c/span\x3e';else{c=a.message;if(mckUtils.startsWith(c,"\x3cimg"))return'\x3cspan class\x3d"mck-icon-camera"\x3e\x3c/span\x3e\x26nbsp;\x3cspan\x3eimage\x3c/span\x3e';null!==
g.emoji&&"undefined"!==typeof g.emoji&&(c=g.emoji.replace_unified(c),c=g.emoji.replace_colons(c),c=-1!==c.indexOf("\x3c/span\x3e")?c.substring(0,c.lastIndexOf("\x3c/span\x3e")):c.substring(0,f));b.isGroup||-1!==c.indexOf("emoji-inner")||0!==a.contentType||(f=r.createElement("p"),f.appendChild(r.createTextNode(c)),c=f)}else a.fileMetaKey&&"object"===typeof a.fileMeta&&(c=d.getFileIcon(a));b.isGroup&&3!==b.type&&7!==b.type&&(b=a.to.split(",")[0]===w?"Me":d.getTabDisplayName(a.to.split(",")[0],!1),10!==
a.contentType&&(c=b+": "+c),-1===c.indexOf("emoji-inner")&&a&&a.message&&0===a.contentType&&(f=r.createElement("p"),f.appendChild(r.createTextNode(c)),c=f))}return c};a.getTextForMessagePreview=function(a,f){var c="";if("undefined"!==typeof a){if(2===a.contentType)c="Shared location";else if(a.message)if(c=a.message,mckUtils.startsWith(c,"\x3cimg"))c="Image attachment";else{var q=r.createElement("div");q.innerHTML=c;c=b.trim(mckUtils.textVal(q));c=c.substring(0,50)}else a.fileMetaKey&&"object"===
typeof a.fileMeta&&(c=-1!==a.fileMeta.contentType.indexOf("image")?"Image attachment":"File attachment");f.isGroup&&3!==f.type&&7!==f.type&&(c=(a.to.split(",")[0]===w?"Me":d.getTabDisplayName(a.to.split(",")[0],!1))+": "+c)}return c};a.getUserIdFromMessage=function(a){a=a.to;a.lastIndexOf(",")===a.length-1&&(a=a.substring(0,a.length-1));return a.split(",")};a.getUserIdArrayFromMessageList=function(f){var d=[];"undefined"===typeof f.length?d.concat(a.getUserIdFromMessage(f)):b.each(f,function(b,f){"undefined"!==
typeof f.to&&(d=d.concat(a.getUserIdFromMessage(f)))});return d};a.messageContextMenu=function(a){var f=b("."+a+" .mck-msg-box");f.addEventListener?f.addEventListener("contextmenu",function(a){a.preventDefault()},!1):f.bind("contextmenu",function(f){f.preventDefault();b(".mck-context-menu").removeClass("vis").addClass("n-vis");b("."+a+" .mck-context-menu").removeClass("n-vis").addClass("vis");g.event.returnValue=!1})};a.isValidMetaData=function(a){return a.metadata?"HIDDEN"===a.metadata.category||
"ARCHIVE"===a.metadata.category?!1:!0:!0};a.updateDraftMessage=function(a,f){if("object"===typeof f){var d={text:"",files:[]},c={fileMeta:f,filelb:oa.getFilePreviewPath(f),filesize:oa.getFilePreviewSize(f.size)};"undefined"!==typeof a&&"object"===typeof Ja[a]&&(d=Ja[a],b.each(d.files,function(a,b){b.filelb===c.filelb&&d.files.splice(a,1)}));d.files.push(c)}Ja[a]=d};a.updateUnreadCount=function(b,f,d){var c=a.getUnreadCount(b);Ea[b]=f;if(d||0<Fa.length)K+=f-c,0>K&&(K=0),0<K?Fa.html(K):Fa.html("")};
a.incrementUnreadCount=function(a){K+=1;Ea[a]="undefined"===typeof Ea[a]?1:Ea[a]+1;0<Fa.length&&Fa.html(K)};a.getUnreadCount=function(a){return"undefined"===typeof Ea[a]?Ea[a]=0:Ea[a]};a.isGroupDeleted=function(a,b){if(b){var f=t.getDeletedAtTime(a);return"undefined"!==typeof f&&0<f}return!1};a.getTabDisplayName=function(b,f,d){var c="";if(f)return t.getGroupDisplayName(b);"function"===typeof Ua&&(c=Ua(b));"undefined"!==typeof d&&d&&(c=d,ka[b]=d);c||(c=a.getContactDisplayName(b));f=a.fetchContact(""+
b);c?(f.displayName=c,Aa[f.contactId]=f):"undefined"!==typeof f.displayName&&(c=f.displayName);c||(c=b);return c};a.populateMessage=function(a,f,c){var q=mckDateUtils.convertMilisIntoTime(f.metadata.CALL_DURATION);Y.loadUserProfile(f.to);103==f.contentType&&(4==f.type&&"CALL_REJECTED"==f.metadata.MSG_TYPE?f.message="you rejected a Video call from "+f.to:5==f.type&&"CALL_REJECTED"==f.metadata.MSG_TYPE?f.message=f.to+"rejected a Video call from you":4==f.type&&"CALL_END"==f.metadata.MSG_TYPE?f.message=
"you were in a call with "+f.to+"\n call duration : "+q:5==f.type&&"CALL_END"==f.metadata.MSG_TYPE?f.message="you were in a call with "+f.to+"\n call duration : "+q:4==f.type&&"CALL_MISSED"==f.metadata.MSG_TYPE?f.message="you missed a Video call from "+f.to:5==f.type&&"CALL_MISSED"==f.metadata.MSG_TYPE&&(f.message=f.to+"missed a Video call from you"));var e=z.data("mck-id"),k=d.isValidMetaData(f),q=f.groupId?mckGroupUtils.getGroup(f.groupId):d.getContact(f.to);if("undefined"===typeof e||""===e){var h=
b("#mck-contact-list").length;0<h&&k&&(f.groupId?d.addGroupFromMessage(f,!0):d.addContactsFromMessage(f,!0));if("APPLOZIC_01"===a||"MESSAGE_RECEIVED"===a){"undefined"===typeof q&&(q=f.groupId?mckGroupUtils.createGroup(f.groupId):d.createContact(f.to));if(ib){d.loadTab({tabId:q.contactId,isGroup:q.isGroup,conversationId:f.conversationId});return}a=f.groupId?"group_"+q.contactId:"user_"+q.contactId;k&&(10!==f.contentType&&102!==f.contentType&&d.incrementUnreadCount(a),cb.notifyUser(f));c=f.groupId?
"group-"+q.htmlId:"user-"+q.htmlId;b("#li-"+c+" .mck-unread-count-text").html(d.getUnreadCount(a));0<d.getUnreadCount(a)&&b("#li-"+c+" .mck-unread-count-box").removeClass("n-vis").addClass("vis");u.sendDeliveryUpdate(f)}}else if("undefined"===typeof q&&(q=f.groupId?mckGroupUtils.createGroup(f.groupId):d.createContact(f.to)),"APPLOZIC_01"===a||"MESSAGE_RECEIVED"===a){if("undefined"!==typeof q&&(a=z.data("isgroup"),0===b("."+f.oldKey).length&&0===b("."+f.key).length||10===f.contentType)){if("undefined"===
typeof e||e!==q.contactId||a!==q.isGroup||Ga.hasClass("vis")){if(ib){d.loadTab({tabId:q.contactId,isGroup:q.isGroup,conversationId:f.conversationId});return}if(k&&10!==f.contentType||102!==f.contentType)a=f.groupId?"group_"+q.contactId:"user_"+q.contactId,d.incrementUnreadCount(a);u.sendDeliveryUpdate(f)}else{k=!0;a&&6===q.type&&(k=t.isAppendOpenGroupContextMenu(q));if(f.conversationId&&(wa||Ia))if((a=z.data("mck-conversationid"))&&a.toString()===f.conversationId.toString())f.metadata&&"HIDDEN"===
f.metadata.category||d.addMessage(f,q,!0,!0,k),u.sendReadUpdate(f.pairedMessageKey);else{if(ib){d.loadTab({tabId:q.contactId,isGroup:q.isGroup,conversationId:f.conversationId});return}}else 7===q.type&&(a=mckGroupUtils.getGroup(f.groupId),a=d.getContactFromGroupOfTwo(a),X.lastSeenOfGroupOfTwo(a.contactId),d.addMessage(f,q,!0,!0,k)),(!f.metadata||"HIDDEN"!==f.metadata.category&&7!==q.type)&&d.addMessage(f,q,!0,!0,k),u.sendReadUpdate(f.pairedMessageKey);f.groupId||(b("#mck-tab-status").html(MCK_LABELS.online),
X.updateUserStatus({userId:f.to,status:1}))}c&&6!==q.type&&cb.notifyUser(f)}}else"APPLOZIC_02"===a&&102==!f.contentType&&(0===b("."+f.oldKey).length&&0===b("."+f.key).length||10===f.contentType)&&(0<h?d.addContactsFromMessage(f,!0):"undefined"!==typeof q&&(a=z.data("isgroup"),"undefined"!==typeof e&&e===q.contactId&&a===q.isGroup&&(k=!0,a&&6===q.type&&(k=t.isAppendOpenGroupContextMenu(q)),f.metadata&&"HIDDEN"===f.metadata.category||d.addMessage(f,q,!0,!0,k),3===f.type&&(b("."+f.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),
d.addTooltip(f.key)))));ta.removeClass("vis").addClass("n-vis")};a.getMessageFeed=function(a){var f={};f.key=a.key;f.timeStamp=a.createdAtTime;f.message=a.message;f.from=4===a.type?a.to:w;f.to=a.groupId?a.groupId:5===a.type?a.to:w;f.status="read";f.type=4===a.type?"inbox":"outbox";5===a.type&&(3===a.status?f.status="sent":4===a.status&&(f.status="delivered"));if("object"===typeof a.fileMeta){var d=b.extend({},a.fileMeta);if("undefined"===typeof d.url||""===d.url)d.url=G+"/rest/ws/aws/file/"+a.fileMeta.blobKey;
delete d.blobKey;f.file=d}f.source=a.source;f.metadata=a.metadata;return f};a.updateUnreadCountonChatIcon=function(a){if(Bb&&0<a.length){var f=null,c=0;0<a.length&&(b.each(a,function(a,b){!(0<b.unreadCount&&null!==f)&&0<b.unreadCount&&(f=b.userId,c=b.unreadCount)}),0<K&&"none"===n.css("display")&&(null!==f&&c===K?d.loadTab({tabId:f,isGroup:!1}):d.loadTab({tabId:"",isGroup:!1})))}};a.loadMessageListOnUserDetailFetch=function(a){ta.removeClass("vis").addClass("n-vis");var f=z.data("mck-id"),c=z.data("isgroup");
if("undefined"===typeof f||a.tabId===f&&""+c===""+a.isGroup)f=mckGroupUtils.getGroup(a.tabId),t.addGroupStatus(f),c=6===f.type?!1:!0,c=!0,6===f.type&&(t.validateOpenGroupUser(f),c=t.isAppendOpenGroupContextMenu(f)),a.isMessages?(D.removeClass("vis").addClass("n-vis"),d.processMessageList(a.messageData,!0,c),6!==f.type&&Va.removeClass("n-vis").addClass("vis"),"function"===typeof Ta&&Ta(a.tabId)):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(Va.removeClass("vis").addClass("n-vis"),
D.removeClass("n-vis").addClass("vis"))}},u=new function(){var a=this,c=b("#mck-search"),l=b("#mck-msg-to"),p=b("#mck-msg-new");b("#mck-audio");b("#mck-mike-btn");var e=b("#mck-sidebox"),x=b("#mck-file-box"),n=b("#mck-text-box"),L=b("#mck-msg-form"),xa=b("#mck-msg-sbmt"),v=b("#mck-new-group"),y=b("#mck-tab-title"),U=b("#mck-msg-error"),ya=b("#mck-btn-attach"),Pa=b("#mck-tab-status"),G=b("#mck-message-cell"),N=b(".mck-typing-box"),D=b("#mck-gms-loading"),k=b("#mck-group-title"),I=b("#mck-contact-loading"),
C=b("#mck-no-messages"),P=b(".mck-group-search"),sa=b("#mck-msg-response"),K=b("#mck-msg-form input"),ba=b("#mck-block-button"),da=b("#li-mck-block-user"),aa=b("#li-mck-group-info"),ea=b("#li-mck-video-call"),ga=b("#mck_response_text"),ja=b(".mck-contact-search"),la=b("#mck-group-info-tab"),H=b("#mck-price-text-box");b("#mck-sidebox-search");var pa=b("#mck-group-info-btn"),la=b("#mck-group-info-tab"),S=b("#mck-btn-group-exit"),ma=b("#mck-group-back-link"),oa=b("#mck-btn-leave-group"),Z=b(".mck-sidebox-content"),
ka=b("#mck-no-more-messages"),ta=b("#mck-btn-group-create");b("#mck-group-create-tab");var Ea=b("#mck-group-add-member");b("#mck-contacts-content");var na=b("#mck-tab-option-panel"),za=b("#mck-no-conversations"),Ha=b("#mck-group-create-title"),Qa=b(".mck-group-menu-options"),fa=b(".mck-tab-message-option"),Aa=b(".mck-group-admin-options"),ra=b("#mck-group-member-search"),s=b("#mck-message-cell .mck-message-inner");b("#mck-search-cell .mck-message-inner");var va=b("#mck-no-more-conversations"),Fa=
b("#mck-gm-search-box"),Ka=b("#mck-group-member-search-list"),Ua=b("#mck-no-gsm-text");b.template("oflTemplate",'\x3cdiv id\x3d"mck-ofl-blk" class\x3d"mck-m-b"\x3e\x3cdiv class\x3d"mck-clear"\x3e\x3cdiv class\x3d"blk-lg-12 mck-text-light mck-text-muted mck-test-center"\x3e${userIdExpr} is offline now\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e');var Ra,La=b("#mck-minutes"),Ma=b("#mck-seconds");a.timer=function(){var a=0,b=this;Ra=setInterval(function(){++a;Ma.html(b.pad(a%60));La.html(b.pad(parseInt(a/60)))},
1E3);b.pad=function(a){a+="";return 2>a.length?"0"+a:a}};a.stoptimer=function(){Ma.html("0");La.html("0");clearInterval(Ra)};b(r).on("click",".mck-message-delete",function(){a.deleteMessage(b(this).parents(".mck-m-b").data("msgkey"))});b(r).on("click",".mck-message-reply",function(){a.replyMessage(b(this).parents(".mck-m-b").data("msgkey"))});b(r).on("click",".mck-message-forward",function(){p.data("forwardMessageKey",b(this).parents(".mck-m-b").data("msgkey"));p.trigger("click")});b(".mck-minimize-icon").click(function(){b(".mck-box-md,.mck-box-ft").animate({height:"toggle"});
Z.hasClass("minimized")?(Z.css("height","100%"),Z.removeClass("minimized")):(Z.css("height","0%"),Z.addClass("minimized"))});a.init=function(){A.clearMckMessageArray();b(r).on("click","."+Wa,function(){b(this).hasClass("mck-msg-preview")&&b(this).hide()});d.initSearchAutoType();ja.click(function(){d.addContactsToContactSearchList()});P.click(function(){d.addGroupsToGroupSearchList()});n.keydown(function(a){n.hasClass("mck-text-req")&&n.removeClass("mck-text-req");if(13===a.keyCode&&(a.shiftKey||a.ctrlKey)){if(a.preventDefault(),
g.getSelection){a=g.getSelection();var b=a.getRangeAt(0),f=r.createElement("br"),d=r.createTextNode("\u00a0");b.deleteContents();b.insertNode(f);b.collapse(!1);b.insertNode(d);b.selectNodeContents(d);a.removeAllRanges();a.addRange(b);n.animate({scrollTop:n.prop("scrollHeight")},0);return!1}}else 13===a.keyCode?(a.preventDefault(),1===qa&&O.sendTypingStatus(0,s.data("mck-id")),xa.is(":disabled")&&x.hasClass("vis")?alert("Please wait file is uploading."):L.submit()):0===qa&&O.sendTypingStatus(1,s.data("mck-id"))});
b(r).on("click",".mck-btn-clear-messages",function(){confirm(MCK_LABELS["clear.messages.alert"])&&u.deleteConversation()});b(r).on("click",".applozic-tm-launcher",function(a){a.preventDefault();var f=b(this).data("mck-id"),f="undefined"!==typeof f&&""!==f?f.toString():"",c=b(this).data("mck-name"),c="undefined"!==typeof c&&""!==c?c.toString():"";a=b(this).data("mck-supportid");a="undefined"!==typeof a&&""!==a?a.toString():"";var e=b(this).data("mck-topicid"),e="undefined"!==typeof e&&""!==e?e.toString():
"",k=b(this).data("mck-msg"),k="undefined"!==typeof k&&""!==k?k.toString():"";if("function"===typeof ua&&e){var h=ua(e);"object"===typeof h&&"undefined"!==h.title&&(J[e]=h)}f={topicId:e,tabId:f,userName:c,isMessage:!0};f.messagePxy={type:5,contentType:0,message:k};a?(f.isGroup=!0,f.supportId=a,u.getConversationId(f)):(f.isGroup=!1,d.loadTab(f,u.dispatchMessage))});b(r).on("click",".applozic-wt-launcher",function(a){a.preventDefault();a=b(this).data("mck-id");a="undefined"!==typeof a&&""!==a?a.toString():
"";var f=b(this).data("mck-name"),f="undefined"!==typeof f&&""!==f?f.toString():"",d=b(this).data("mck-topicid"),d="undefined"!==typeof d&&""!==d?d.toString():"",c=b(this).data("mck-topic-status"),c=c?-1===V.indexOf(c)?V[0]:c.toString():V[0];if("function"===typeof ua){var e=ua(d);"object"===typeof e&&"undefined"!==e.title&&(J[d]=e)}u.getConversationId({tabId:a,isGroup:!1,userName:f,topicId:d,topicStatus:c,isMessage:!1})});b(r).on("click",".applozic-ct-launcher",function(a){a.preventDefault();var f=
b(this).data("mck-id"),f="undefined"!==typeof f&&""!==f?f.toString():"",d=b(this).data("mck-name"),d="undefined"!==typeof d&&""!==d?d.toString():"";a=b(this).data("mck-topicid");a="undefined"!==typeof a&&""!==a?a.toString():"";var c=b(this).data("mck-topic-status"),c=c?-1===V.indexOf(c)?V[0]:c.toString():V[0],f={tabId:f,isGroup:!1,userName:d,topicId:a,topicStatus:c,isMessage:!1};"function"===typeof yb&&(d=yb(a),"object"===typeof d&&(d.topicDetail&&"object"===typeof d.topicDetail&&"undefined"!==d.topicDetail.title&&
(J[a]=d.topicDetail),d.fallBackTemplatesList&&0<d.fallBackTemplatesList.length&&(f.fallBackTemplatesList=d.fallBackTemplatesList)));u.getConversationId(f)});b(r).on("click","."+Wa+", .mck-contact-list ."+Wa,function(f){f.preventDefault();if("kommunicate"==window.applozic.PRODUCT_ID)"false"===ac?(b("#km-chatLoginModal").removeClass("n-vis").addClass("vis"),b("#km-chatLoginModal").css("display","block")):E();else{var d=this;b(this).parents(".mck-search-list").length?(c.bind("blur"),setTimeout(function(){a.openChat(d)},
600)):a.openChat(this)}});b("#km-form-chat-login").submit(function(a){a=$("#km-submit-chat-login");var f=$("#km-error-chat-login"),d=$("#km-userName").val();$("#km-email").val();a.attr("disabled",!0);a.html("Initiating chat...");f.removeClass("show").addClass("hide");f.html("");b.fn.applozic("reInitialize",{userId:d,appId:Q,onInit:E,baseUrl:MCK_BASE_URL,locShare:Xa,googleApiKey:Kb});return!1});var f=function(a){JSON.parse(sessionStorage.mckAppHeaders);console.log("topic url",topicUrl);console.log("users",
response.users);a&&b.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:formData,contentType:"application/json",success:function(a){}})},E=function(){"kommunicate"==window.applozic.PRODUCT_ID&&(oa.removeClass("vis").addClass("n-vis"),$(".mck-conversation-tab-link").removeClass("vis").addClass("n-vis"));b.ajax({url:MCK_BASE_URL+"/rest/ws/group/bytype",type:"get",data:"type\x3d10\x26startIndex\x3d0\x26limit\x3d10",contentType:"application/json",success:function(a){0<a.response.length?b.fn.applozic("loadGroupTab",
a.response[0].id):b.fn.applozic("createGroup",{groupName:"Kommnicate",type:10,admin:"Agent",users:[{userId:"Bot",displayName:"Bot",groupRole:2,roleName:"APPLICATION_WEB_ADMIN"},{userId:"Agent",displayName:"Agent",groupRole:1,roleName:"APPLICATION_WEB_ADMIN"}],metadata:{CREATE_GROUP_MESSAGE:"",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",
GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"false",HIDE:"true"},callback:function(a){var b={};a&&"success"==a.status&&(b=a.data.users.find(function(a){if("bot"===a.userId)return!0}),console.log("got bot details",b),f(b))}})}})};b(".km-login-model-close").on("click",function(a){b("#km-chatLoginModal").removeClass("vis").addClass("n-vis")});b(r).on("click",".mck-conversation-tab-link",
function(a){a.preventDefault();b(this);a=s.data("mck-id");var f=s.data("isgroup");d.loadTab({tabId:"",isGroup:!1,lastActiveTabId:a,isLastActiveTabGroup:f})});b(r).on("click",".mck-close-sidebox",function(a){a.preventDefault();e.mckModal("hide");a=s.data("mck-conversationid");s.data("mck-id","");s.data("mck-topicid","");s.data("mck-name","");s.data("mck-conversationid","");a&&(a=M[a],"object"===typeof a&&(a=a.topicId,"function"===typeof sb&&sb(w,a)));O.unsubscibeToTypingChannel()});b(r).on("click",
".mck-price-submit",function(b){b.preventDefault();a.sendPriceMessage()});H.keydown(function(b){13===b.keyCode&&a.sendPriceMessage()});s.bind("scroll",function(){if(0<s.find(".mck-contact-list").length){if(s.scrollTop()+s.innerHeight()>=s[0].scrollHeight){var a=s.data("datetime");0<a&&!Ba&&u.loadMessageList({tabId:"",isGroup:!1,startTime:a})}}else if(0===s.scrollTop()){var b=s.data("mck-id");if("undefined"!==typeof b&&""!==b){var f=s.data("isgroup"),d=s.data("mck-conversationid"),d=d?d.toString():
"",a=na.data("datetime");0<a&&!Ba&&u.loadMessageList({tabId:b,isGroup:f,conversationId:d,startTime:a})}}});H.on("click",function(a){a.preventDefault();H.removeClass("mck-text-req")});ba.on("click",function(a){a.preventDefault();a=s.data("mck-id");var b=s.data("isgroup"),f=!s.data("blocked");b?(da.removeClass("vis").addClass("n-vis"),ea.removeClass("vis").addClass("n-vis")):confirm(f?MCK_LABELS["block.user.alert"]:MCK_LABELS["unblock.user.alert"])&&Y.blockUser(a,f)});oa.on("click",function(a){a.preventDefault();
a=s.data("mck-id");s.data("isgroup")?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({apzCallback:t.onGroupLeft,groupId:a}):Qa.removeClass("vis").addClass("n-vis")});b(r).on("click",".mck-add-to-group",function(a){a.preventDefault();a=b(this).data("mck-id");"undefined"!==typeof a&&t.addGroupMemberFromSearch(a);Fa.mckModal("hide")});b(r).on("click",".mck-btn-remove-member",function(a){a.preventDefault();a=b(this).parents(".mck-li-group-member").data("mck-id");var f=la.data("mck-id");
if("undefined"!==typeof f&&"undefined"!==typeof a){var d=mckGroupUtils.getGroup(f);"object"===typeof d&&w===d.adminName?confirm(MCK_LABELS["remove.member.alert"])&&mckGroupService.removeGroupMember({groupId:f,userId:a,apzCallback:t.onRemovedGroupMember}):Aa.removeClass("vis").addClass("n-vis")}});S.on("click",function(a){a.preventDefault();(a=la.data("mck-id"))?confirm(MCK_LABELS["exit.group.alert"])&&mckGroupService.leaveGroup({groupId:a,apzCallback:t.onGroupLeft}):d.loadTab({tabId:"",isGroup:!1})});
pa.on("click",function(a){a.preventDefault();a=s.data("mck-id");if(s.data("isgroup")){a={groupId:a};var b=s.data("mck-conversationid");b&&(a.conversationId=b);t.loadGroupInfo(a)}else Qa.removeClass("vis").addClass("n-vis")});v.on("click",function(a){a.preventDefault();t.loadCreateGroupTab()});ma.on("click",function(a){a.preventDefault();var b=la.data("mck-id");a=la.data("mck-conversation-id");b?(b={tabId:b,isGroup:!0},a&&(b.conversationId=a),d.loadTab(b)):d.loadTab({tabId:"",isGroup:!1})});Ea.on("click",
function(a){a.preventDefault();if(a=la.data("mck-id"))(a=mckGroupUtils.getGroup(a))&&a.adminName===w?(Ka.html(""),Fa.mckModal(),D.removeClass("n-vis").addClass("vis"),0<Oa.length?t.addMembersToGroupSearchList():Ab?0<Na.length?(b.each(Na,function(a,b){Oa.push(b.contactId)}),t.addMembersToGroupSearchList()):(D.removeClass("vis").addClass("n-vis"),Ua.removeClass("n-vis").addClass("vis")):Y.getUserStatus({callback:t.addMembersToGroupSearchList})):Aa.removeClass("vis").addClass("n-vis")});ra.keypress(function(a){if(13===
a.which)return a=ra.val(),""!==a&&t.addGroupMemberFromSearch(a),ra.val(""),!0});b(r).on("click",".mck-group-member-search-link",function(a){a.preventDefault();a=ra.val();""!==a&&t.addGroupMemberFromSearch(a);ra.val("")});b(r).on("click",".mck-show-more",function(a){a.preventDefault();var f=b(this);a=f.data("tabId");var d=s.data("isgroup"),c=s.data("mck-conversationid"),c=c?c.toString():"",f=f.data("datetime");u.loadMessageList({tabId:a,isGroup:d,conversationId:c,startTime:f})});b(r).on("click",".mck-accept",
function(a){a=b(this).data("mck-conversationid");var f=b(this).data("mck-topic-price");if("function"===typeof Da&&f&&a){var d=M[a],c=l.val(),c=t.getGroupDisplayName(c);"object"===typeof d?(Da({custId:w,suppId:c,productId:d.topicId,price:f}),u.sendConversationCloseUpdate(a)):u.getTopicId({conversationId:a,suppId:c,priceText:f})}});L.submit(function(){1===qa&&O.sendTypingStatus(0,s.data("mck-id"));var f=b.trim(mckUtils.textVal(n[0]));x.hasClass("n-vis")&&0<F.length&&(F=[]);if(0===f.length&&0===F.length)return n.addClass("mck-text-req"),
!1;if("function"===typeof wb&&!wb(f))return!1;var f={type:5,contentType:0,message:f},d=s.data("mck-conversationid"),c=s.data("mck-topicid");d?f.conversationId=d:c&&(d={topicId:c},c=J[c],"object"===typeof c&&(d.topicDetail=g.JSON.stringify(c)),f.conversationPxy=d);!0===s.data("isgroup")?f.groupId=l.val():f.to=l.val();xa.attr("disabled",!0);U.removeClass("vis").addClass("n-vis");U.html("");ga.html("");sa.removeClass("vis").addClass("n-vis");a.sendMessage(f);return!1});K.on("click",function(){b(this).val("");
U.removeClass("vis").addClass("n-vis");sa.removeClass("vis").addClass("n-vis")});b(r).bind("click",function(a){b(".mck-context-menu").removeClass("vis").addClass("n-vis");!ya.hasClass("on")||b(a.target).hasClass("mck-icon-upload")||b(a.target).hasClass("mck-btn-attach")||Cb.fileMenuToggle();n.removeClass("mck-text-req");r.activeElement&&r.activeElement!==n&&1===qa&&O.sendTypingStatus(0,s.data("mck-id"));r.activeElement&&"mck-group-name-save"!==r.activeElement.id&&k.removeClass("mck-req-border");r.activeElement&&
"mck-btn-group-create"!==r.activeElement.id&&Ha.removeClass("mck-req-border");b(".mcktypeahead.mck-dropdown-menu").hide()});b(".mck-tabview-item").click(function(){b(".mck-tabview-item").removeClass("active");b(this).addClass("active")})};b(".mck-sidebox").on("click","#mck-mike-btn",function(){b(this).removeClass("vis").addClass("n-vis");$(".mck-stop-btn").addClass("vis").removeClass("n-vis");Fr.voice.record(!1,function(){$("#mck-audio").removeClass("n-vis").addClass("vis");u.timer()})});b(".mck-sidebox").on("click",
"#mck-stop-recording",function(){$("#mck-mike-btn").addClass("vis").removeClass("n-vis");$(".mck-stop-btn").addClass("n-vis").removeClass("vis");$("#mck-audio").removeClass("vis").addClass("n-vis");u.stoptimer();Fr.voice.export(function(a){var d={};d.file=a;d.name="blob";b.fn.applozic("audioAttach",d)},"blob");Fr.voice.stop()});a.openChat=function(a){var e=b(a);a=e.data("mck-id");a="undefined"!==typeof a&&""!==a?a.toString():"";var k=e.data("mck-name"),k="undefined"!==typeof k&&""!==k?k.toString():
"",g=e.data("mck-topicid"),g="undefined"!==typeof g&&""!==g?g.toString():"",l=!0===e.data("isgroup"),e=e.data("mck-conversationid"),e="undefined"!==typeof e&&""!==e?e.toString():"";g&&!e?(e=(e=b(elem).data("mck-topic-status"))?-1===V.indexOf(e)?V[0]:e.toString():V[0],u.getConversationId({tabId:a,isGroup:l,userName:k,topicId:g,topicStatus:e,isMessage:!1})):d.loadTab({tabId:a,isGroup:l,userName:k,conversationId:e,topicId:g});c.val("")};a.sendMessage=function(f){if("object"===typeof f){var c=f.metadata?
f.metadata:{},e=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof e||""===e||f.forward||(c.AL_REPLY=e);f.metadata=c;if("undefined"!==typeof f.message&&0!==f.message.length||0!==F.length){if(f.conversationId&&(c=M[f.conversationId],"undefined"!==c&&c.closed)){d.closeConversation();xa.attr("disabled",!1);return}if(s.data("blocked"))X.toggleBlockUser(h,!0),xa.attr("disabled",!1);else{var k="";f.groupId?(k=mckGroupUtils.getGroup(f.groupId),"undefined"===typeof k&&(k=mckGroupUtils.createGroup(f.groupId))):
k=f.clientGroupId?mckGroupUtils.getGroupByClientGroupId(f.clientGroupId):d.fetchContact(f.to);0<b("#mck-message-cell .mck-no-data-text").length&&b(".mck-no-data-text").remove();if(f.message&&0===F.length){var c=fa.hasClass("n-vis"),h=s.data("mck-id"),g=mckUtils.randomId();f.key=g;12!==f.contentType&&h&&h.toString()===k.contactId&&102!==f.contentType&&a.addMessageToTab(f,k);a.submitMessage(f,{tabId:k.contactId,isTopPanelAdded:c})}else 0<F.length&&b.each(F,function(b,d){var c=fa.hasClass("n-vis"),e=
s.data("mck-id"),h=mckUtils.randomId();f.key=h;f.fileMeta=d;f.contentType=1;12!==f.contentType&&e&&e.toString()===k.contactId&&a.addMessageToTab(f,k);a.submitMessage(f,{tabId:k.contactId,isTopPanelAdded:c})});n.removeClass("mck-text-req");xa.attr("disabled",!1);b("."+g+" .mck-message-status").removeClass("mck-icon-sent").addClass("mck-icon-time");d.addTooltip(g);d.clearMessageField(!0);F=[];delete Ja[k.contactId]}}else n.addClass("mck-text-req")}};a.addMessageToTab=function(a,b){var c={to:a.to,groupId:a.groupId,
deviceKey:a.deviceKey,contentType:a.contentType,message:a.message,conversationId:a.conversationId,topicId:a.topicId,sendToDevice:!0,createdAtTime:(new Date).getTime(),key:a.key,storeOnDevice:!0,sent:!1,read:!0,metadata:a.metadata?a.metadata:""};c.type=a.type?a.type:5;a.fileMeta&&(c.fileMeta=a.fileMeta);d.addMessage(c,b,!0,!0,!1)};a.sendForwardMessage=function(b){var d=A.getMessageByKey(b);if("undefined"!==typeof d){d.fileMeta&&F.push(d.fileMeta);b={type:5,contentType:d.contentType,message:d.message,
forward:"forward"};d.metadata&&(d.metadata.AL_REPLY&&(d.metadata.AL_REPLY=""),b.metadata=d.metadata);var c=s.data("mck-conversationid"),d=s.data("mck-topicid");c?b.conversationId=c:d&&(c={topicId:d},d=J[d],"object"===typeof d&&(c.topicDetail=g.JSON.stringify(d)),b.conversationPxy=c);!0===s.data("isgroup")?b.groupId=l.val():b.to=l.val();a.sendMessage(b)}};a.sendWelcomeMessage=function(b){var c=mckUtils.randomId(),e=s.data("mck-id"),k=s.data("isgroup"),c={key:c,type:4,contentType:0,to:b.sender,message:b.messageContent};
e&&e.toString()===b.sender&&!k&&(e=d.fetchContact(e),a.addMessageToTab(c,e));mckUtils.ajax({type:"GET",url:MCK_BASE_URL+"/rest/ws/message/add/inbox",global:!1,data:"sender\x3d"+encodeURIComponent(b.sender)+"\x26messageContent\x3d"+encodeURIComponent(b.messageContent),contentType:"text/plain",success:function(a){b.callback&&b.callback(a)}})};a.submitMessage=function(a,c){var e=a.key,k=a.metadata?a.metadata:{};Ob&&(a.metadata={userStatus:4});var h=b("#mck-text-box").data("AL_REPLY");"undefined"===typeof h||
""===h||a.forward||(k.AL_REPLY=h,b("#mck-text-box").data("AL_REPLY",""));a.source=fc;var l=b("#mck-message-cell .mck-message-inner div[name\x3d'message']."+e);102!=a.contentType&&103!=a.contentType&&(a.metadata=Nb);a.metadata=k;mckUtils.ajax({type:"POST",url:MCK_BASE_URL+"/rest/ws/message/send",global:!1,data:g.JSON.stringify(a),contentType:"application/json",success:function(k){var h=s.data("mck-id");if("object"===typeof k){var g=k.messageKey;if(h&&h.toString()===c.tabId){var C=k.conversationId;
s.data("mck-conversationid",C);l.removeClass(e).addClass(g);l.data("msgkey",g);b("."+g+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent").attr("title","sent");d.addTooltip(g);c.isTopPanelAdded&&na.data("datetime",k.createdAt);k=!0;a.groupId&&6===mckGroupUtils.getGroup(a.groupId).type&&(k=!1);k&&d.messageContextMenu(g)}a.conversationPxy&&(g=a.conversationPxy,a.topicId&&(ia[a.topicId]=[C]),M[C]=g)}else"CONVERSATION_CLOSED"===k||"BUSY_WITH_OTHER"===k?(xa.attr("disabled",!1),
d.closeConversation(k),l.remove(),c.isTopPanelAdded&&fa.removeClass("vis").addClass("n-vis")):"error"===k&&(xa.attr("disabled",!1),U.html("Unable to process your request. Please try again"),U.removeClass("n-vis").addClass("vis"),l.remove(),c.isTopPanelAdded&&fa.removeClass("vis").addClass("n-vis"))},error:function(){U.html("Unable to process your request. Please try again.");U.removeClass("n-vis").addClass("vis");l&&l.remove();c.isTopPanelAdded&&fa.removeClass("vis").addClass("n-vis")}});$("#mck-reply-to-div").removeClass("vis").addClass("n-vis")};
a.downloadImage=function(a){window.open(a,"_blank")};a.replyMessage=function(a){var c="";s.data("mck-id");var e=u.getReplyMessageByKey(a);n.focus().select();$("#mck-reply-to-div").removeClass("n-vis").addClass("vis");c=5===e.type?"You":d.getTabDisplayName(e.to,!1);$("#mck-reply-to").html(c);"object"===typeof e.fileMeta||2===e.contentType?$("#mck-reply-msg").html(d.getImageForMessagePreview(e)):$("#mck-reply-msg").html(e.message);b("#mck-text-box").data("AL_REPLY",a)};$("#close").click(function(){$("#mck-reply-to-div").removeClass("vis").addClass("n-vis");
b("#mck-text-box").data("AL_REPLY","")});a.deleteMessage=function(a){var d=s.data("mck-id");"undefined"!==typeof d&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delete?key\x3d"+a,type:"get",success:function(c){"success"===c?(s.data("mck-id")===d&&(b("."+a).remove(),s.is(":empty")&&fa.removeClass("vis").addClass("n-vis")),A.clearMckMessageArray()):g.console.log("Unable to delete message. Please reload page.")}})};a.deleteConversation=function(){var a=s.data("mck-id"),b=s.data("isgroup"),d=s.data("mck-conversationid");
"undefined"!==typeof a&&(b=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a),d&&(b+="\x26conversationId\x3d"+d),Ba=!0,mckUtils.ajax({type:"get",url:MCK_BASE_URL+"/rest/ws/message/delete/conversation",global:!1,data:b,success:function(){s.data("mck-id")===a&&(s.html(""),na.data("datetime",""),G.removeClass("n-vis").addClass("vis"),C.removeClass("n-vis").addClass("vis"),fa.removeClass("vis").addClass("n-vis"),Ba=!1)},error:function(){}}))};a.getMessages=function(a){var b="";"undefined"!==typeof a.userId&&
""!==a.userId?(b=a.isGroup?"\x26groupId\x3d"+a.userId:"\x26userId\x3d"+encodeURIComponent(a.userId),a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26pageSize\x3d30",(wa||Ia)&&a.conversationId&&(b+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof W[a.userId]&&(b+="\x26conversationReq\x3dtrue"))):(a.startTime&&(b+="\x26endTime\x3d"+a.startTime),b+="\x26mainPageSize\x3d100");var d={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+b,type:"get",success:function(b){d.status=
"success";d.data=b;a.callback&&a.callback(d)},error:function(b,c,e){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));d.status="error";a.callback&&a.callback(d)}})};a.getMessageList=function(a){var c=a.id;if("undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){var e=a.pageSize?"\x26pageSize\x3d"+a.pageSize:"\x26pageSize\x3d50",e=e+("\x26clientGroupId\x3d"+a.clientGroupId);a.startTime&&(e+="\x26endTime\x3d"+a.startTime);var k={clientGroupId:a.clientGroupId}}else"undefined"!==
typeof c&&""!==c?(e=a.pageSize?"\x26pageSize\x3d"+a.pageSize:"\x26pageSize\x3d50",e+="true"===""+a.isGroup?"\x26groupId\x3d"+c:"\x26userId\x3d"+c,a.startTime&&(e+="\x26endTime\x3d"+a.startTime),k={id:c}):(e=a.pageSize?"\x26mainPageSize\x3d"+a.pageSize:"\x26mainPageSize\x3d50",a.startTime&&(e+="\x26endTime\x3d"+a.startTime),k={id:""});a.topicId&&(c||a.clientGroupId)&&(a.conversationId&&(e+="\x26conversationId\x3d"+a.conversationId),a.topicId&&(k.topicId=a.topicId));mckUtils.ajax({url:MCK_BASE_URL+
"/rest/ws/message/list?startIndex\x3d0"+e,type:"get",global:!1,success:function(c){k.status="success";if("undefined"===typeof c.message||0===c.message.length)k.messages=[];else{var e=[];b.each(c.message,function(a,b){if("undefined"!==typeof b.to||"undefined"!==typeof b.groupId){var f=d.getMessageFeed(b);e.push(f)}});k.messages=e}0<c.groupFeeds.length&&(k.id=c.groupFeeds[0].id);a.callback(k)},error:function(b,d,c){401===b.status&&(sessionStorage.clear(),console.log("Please reload page."));k.status=
"error";a.callback(k)}})};a.getReplyMessageByKey=function(a){"undefined"===typeof A.getMessageByKey(a)&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/detail",async:!1,type:"get",data:"keys\x3d"+a,success:function(a){A.updateMckMessageArray(a)}});return A.getMessageByKey(a)};a.loadMessageList=function(a,c){var e=!1,k=!1,h="";"undefined"!==typeof a.tabId&&""!==a.tabId?(h=a.isGroup?"\x26groupId\x3d"+a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId),e=!0,a.startTime&&(h+="\x26endTime\x3d"+a.startTime),
h+="\x26pageSize\x3d30",(wa||Ia)&&a.conversationId&&(h+="\x26conversationId\x3d"+a.conversationId,"undefined"===typeof W[a.tabId]?(k=!0,h+="\x26conversationReq\x3dtrue"):d.addConversationMenu(a.tabId,a.isGroup))):(Ba=!0,a.startTime&&(h+="\x26endTime\x3d"+a.startTime),h+="\x26mainPageSize\x3d60");a.startTime||s.html("");I.removeClass("n-vis").addClass("vis");mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list?startIndex\x3d0"+h,type:"get",global:!1,success:function(h){var l=!0,n=s.data("mck-id"),
x=s.data("isgroup");a.isGroup&&!a.startTime||I.removeClass("vis").addClass("n-vis");Ba=!1;if("undefined"===typeof n||a.tabId===n&&""+x===""+a.isGroup){if("null"===h+""||"undefined"===typeof h.message||0===h.message.length)l=!1,e?a.startTime?(ka.removeClass("n-vis").addClass("vis"),ka.fadeOut(5E3,function(){ka.removeClass("vis").addClass("n-vis")}),na.data("datetime","")):a.isGroup||0!==b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length||(fa.removeClass("vis").addClass("n-vis"),
za.removeClass("vis").addClass("n-vis"),C.removeClass("n-vis").addClass("vis")):(C.removeClass("vis").addClass("n-vis"),a.startTime?(va.removeClass("n-vis").addClass("vis"),va.fadeOut(5E3,function(){va.removeClass("vis").addClass("n-vis")})):(C.removeClass("vis").addClass("n-vis"),za.removeClass("n-vis").addClass("vis")),s.data("datetime",""));if("null"!==h+""&&"error"!==h.status)if(e){l&&(0<a.startTime?d.processMessageList(h,!1,!0):a.isGroup||(d.processMessageList(h,!0,!0),fa.removeClass("n-vis").addClass("vis")));
0<!a.startTime&&!a.isGroup&&"function"===typeof Ta&&Ta(a.tabId);0<h.userDetails.length&&b.each(h.userDetails,function(b,c){ca[c.userId]=c;if(!a.isGroup&&(c.connected?g.MCK_OL_MAP[c.userId]=!0:(g.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(T[c.userId]=c.lastSeenAtTime)),ab||a.isGroup||(c.blockedByThis?(ha[c.userId]=!0,X.toggleBlockUser(a.tabId,!0)):c.blockedByOther?(Ca[c.userId]=!0,y.removeClass("mck-tab-title-w-status"),Pa.removeClass("vis").addClass("n-vis"),N.removeClass("vis").addClass("n-vis"),
s.data("blocked",!1)):X.toggleBlockUser(a.tabId,!1)),c.userName&&!a.startTime)){var e=d.getTabDisplayName(a.tabId,a.isGroup,c.userName);y.html(e);y.attr("title",e)}});!bb||a.isGroup||a.startTime||g.MCK_OL_MAP[a.tabId]||Ya.manageOfflineMessageTime(a.tabId);if(0<h.conversationPxys.length){var v=[];b.each(h.conversationPxys,function(a,f){if("object"===typeof f&&(v.push(f),M[f.id]=f,ia[f.topicId]=[f.id],f.topicDetail))try{J[f.topicId]=b.parseJSON(f.topicDetail)}catch(c){g.console.log("Incorect Topic Detail!")}});
k&&(W[a.tabId]=v,d.addConversationMenu(a.tabId,a.isGroup))}a.conversationId&&(n=M[a.conversationId],"object"===typeof n&&n.closed&&d.closeConversation());a.startTime||(a.isGroup?(t.addGroupStatus(mckGroupUtils.getGroup(a.tabId)),d.updateUnreadCount("group_"+a.tabId,0,!0)):d.updateUnreadCount("user_"+a.tabId,0,!0),"function"===typeof c&&c(a));0<h.groupFeeds.length&&b.each(h.groupFeeds,function(c,e){var k=mckGroupUtils.addGroup(e);if(!a.startTime){var g=[];b.each(e.membersId,function(a,b){"undefined"===
typeof d.getContact(b)&&g.push(b)});if(0<g.length)a.isMessages=l,a.messageData=h,a.isLoadMessageList=!0,Y.getUsersDetail(g,a);else{t.addGroupStatus(k);var q=!0;if(7===k.type){aa.removeClass("vis").addClass("n-vis");var n=d.getContactFromGroupOfTwo(k);X.lastSeenOfGroupOfTwo(n.contactId)}"kommunicate"==window.applozic.PRODUCT_ID&&(3!==k.users[w].role&&2!==k.users[w].role&&0!==k.users[w].role||aa.removeClass("vis").addClass("n-vis"));6===k.type&&(t.validateOpenGroupUser(k),q=t.isAppendOpenGroupContextMenu(k));
I.removeClass("vis").addClass("n-vis");l?(C.removeClass("vis").addClass("n-vis"),d.processMessageList(h,!0,q),6!==k.type&&fa.removeClass("n-vis").addClass("vis")):0===b("#mck-message-cell .mck-message-inner div[name\x3d'message']").length&&(fa.removeClass("vis").addClass("n-vis"),C.removeClass("n-vis").addClass("vis"));"function"===typeof Ta&&Ta(a.tabId)}}})}else a.startTime||(g.MCK_OL_MAP=[]),0<h.userDetails.length&&b.each(h.userDetails,function(a,b){ca[b.userId]=b;b.connected?g.MCK_OL_MAP[b.userId]=
!0:(g.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(T[b.userId]=b.lastSeenAtTime));d.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);var f=d.getContact(""+b.userId);"undefined"===typeof f?d.createContactWithDetail(b):d.updateContactDetail(f,b)}),0<h.groupFeeds.length&&b.each(h.groupFeeds,function(a,b){d.updateUnreadCount("group_"+b.id,b.unreadCount,!1);mckGroupUtils.addGroup(b)}),0<h.blockedUserPxyList.blockedToUserList.length&&b.each(h.blockedUserPxyList.blockedToUserList,
function(a,b){b.userBlocked&&(ha[b.blockedTo]=!0)}),0<h.blockedUserPxyList.blockedByUserList.length&&b.each(h.blockedUserPxyList.blockedByUserList,function(a,b){b.userBlocked&&(Ca[b.blockedBy]=!0)}),0<h.conversationPxys.length&&b.each(h.conversationPxys,function(a,f){M[f.id]=f;ia[f.topicId]=[f.id];if(f.topicDetail)try{J[f.topicId]=b.parseJSON(f.topicDetail)}catch(c){g.console.log("Incorect Topic Detail!")}}),l?(a.startTime?a.startTime&&(a.isReload=!1,e||A.updateLatestMessageArray(h.message)):(a.isReload=
!0,e||A.setLatestMessageArray(h.message)),e&&A.updateMckMessageArray(h.message),d.addContactsFromMessageList(h,a)):s.data("datetime",""),a.isLaunch&&d.updateUnreadCountonChatIcon(h.userDetails)}n=p.data("forwardMessageKey");"undefined"!==typeof n&&(u.sendForwardMessage(n),p.data("forwardMessageKey",""))},error:function(a,b,f){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."));Ba=!1;I.removeClass("vis").addClass("n-vis");g.console.log("Unable to load messages. Please reload page.")}})};
a.updateContactList=function(a,b){var c="startIndex\x3d0\x26pageSize\x3d1\x26"+(b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a));mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/list",data:c,global:!1,type:"get",success:function(c){"null"===c+""||"undefined"===typeof c.message||0===c.message.length?d.clearContactMessageData(a,b):(c=c.message[0],"undefined"!==typeof c&&(c.groupId?d.addGroupFromMessage(c,!0):d.addContactsFromMessage(c,!0)))},error:function(c,e,k){401===c.status&&(sessionStorage.clear(),
console.log("Please reload page."));d.clearContactMessageData(a,b)}})};a.sendDeliveryUpdate=function(a){mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/delivered",data:"key\x3d"+a.pairedMessageKey,global:!1,type:"get",success:function(){},error:function(){}})};a.sendReadUpdate=function(a){"undefined"!==typeof a&&""!==a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read",data:"key\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};a.conversationReadUpdate=function(a,b){var c=
b?"group_"+a:"user_"+a;if(a&&0<d.getUnreadCount(c)){var e=b?"groupId\x3d"+a:"userId\x3d"+encodeURIComponent(a);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/message/read/conversation",data:e,global:!1,type:"get",success:function(){d.updateUnreadCount(c,0,!0)},error:function(){}})}};a.getConversationId=function(f){if(!f.isGroup&&!f.isMessage&&f.topicStatus!==V[1]){var c=ia[f.topicId];if(c&&(c=M[c],"object"===typeof c)){s.data("mck-conversationid",c.id);f.conversationId=c.id;if("undefined"!==typeof W[f.tabId]){var e=
W[f.tabId];e.push(c);W[f.tabId]=e}d.loadTab(f);return}}f.topicId&&(c={topicId:f.topicId,userId:f.tabId,status:f.topicStatus},f.isGroup&&(c.supportIds=[],c.supportIds.push(f.supportId)),e=J[f.topicId],"object"===typeof e&&(c.topicDetail=g.JSON.stringify(e)),f.fallBackTemplatesList&&0<f.fallBackTemplatesList.length&&(c.fallBackTemplatesList=f.fallBackTemplatesList),mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/id",global:!1,data:g.JSON.stringify(c),type:"post",contentType:"application/json",
success:function(c){if("object"===typeof c&&"success"===c.status){var e=c.response;if("object"===typeof e&&"undefined"!==e.conversationPxy){c=e.conversationPxy;M[c.id]=c;ia[c.topicId]=[c.id];if(c.topicDetail)try{J[c.topicId]=b.parseJSON(c.topicDetail)}catch(k){g.console.log("Incorect Topic Detail!")}s.data("mck-conversationid",c.id);f.conversationId=c.id;if("undefined"!==typeof W[f.tabId]){var h=W[f.tabId];h.push(c);W[f.tabId]=h}f.isGroup&&(e=mckGroupUtils.addGroup(e),f.tabId=e.contactId);f.isMessage&&
c.created?d.loadTab(f,a.dispatchMessage):d.loadTab(f)}}},error:function(){}}))};a.fetchConversationByTopicId=function(a){var c="topic\x3d"+a.topicId;if(a.tabId)c+="true"===""+a.isGroup?"\x26groupId\x3d"+a.tabId:"\x26userId\x3d"+encodeURIComponent(a.tabId);else if(a.clientGroupId)c+="\x26clientGroupId\x3d"+a.clientGroupId;else return!1;a.pageSize&&(c+="\x26pageSize\x3d"+a.pageSize);mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/get",data:c,type:"get",success:function(c){"object"===typeof c&&
"success"===c.status?(c=c.response,0<c.length&&b.each(c,function(c,d){M[d.id]=d;ia[d.topicId]=[d.id];if(d.topicDetail)try{J[d.topicId]=b.parseJSON(d.topicDetail)}catch(e){g.console.log("Incorect Topic Detail!")}if(a.tabId&&"undefined"!==typeof W[a.tabId]){var k=W[a.tabId];k.push(d);W[a.tabId]=k}}),a.isExtMessageList&&(0<c.length?(a.conversationId=c[0].id,a.pageSize=50,u.getMessageList(a)):"function"===typeof a.callback&&(c={},a.tabId?(c.id=a.tabId,c.isGroup=a.isGroup):a.clientGroupId&&(c.clientGroupId=
a.clientGroupId),c.topicId=a.topicId,c.status="success",c.messages=[],a.callback(c)))):a.isExtMessageList&&"function"===typeof a.callback&&(c={},a.tabId?c.id=a.tabId:a.clientGroupId&&(c.clientGroupId=a.clientGroupId),c.topicId=a.topicId,c.status="error",c.errorMessage="Unable to process request. Please try again.",a.callback(c))},error:function(){if("function"===typeof a.callback){var b={};a.tabId?b.id=a.tabId:a.clientGroupId&&(b.clientGroupId=a.clientGroupId);b.topicId=a.topicId;b.status="error";
b.errorMessage="Unable to process request. Please try again.";a.callback(b)}}})};a.getTopicId=function(c){c.conversationId&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/topicId",data:"id\x3d"+c.conversationId,global:!1,type:"get",async:"undefined"!==typeof c.async?c.async:!0,success:function(e){if("object"===typeof e&&"success"===e.status&&(e=e.response,"object"===typeof e)){ia[e.topicId]=[c.conversationId];M[c.conversationId]=e;if(e.topicDetail)try{J[e.topicId]=b.parseJSON(e.topicDetail)}catch(k){g.console.log("Incorect Topic Detail!")}"function"===
typeof Da&&c.priceText&&(Da({custId:w,suppId:c.suppId,productId:e.topicId,price:c.priceText}),a.sendConversationCloseUpdate(c.conversationId));if(c.messageType&&"object"===typeof c.message){var h=c.message.groupId?c.message.groupId:c.message.to;if("undefined"!==typeof W[h]){var l=W[h];l.push(e);W[h]=l}("undefined"!==typeof c.populate?c.populate:1)&&d.populateMessage(c.messageType,c.message,c.notifyUser)}"function"===typeof c.callback&&c.callback(e)}},error:function(){}})};a.sendConversationCloseUpdate=
function(a){a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/conversation/close",data:"id\x3d"+a,global:!1,type:"get",success:function(){},error:function(){}})};a.sendPriceMessage=function(){var c=H.val();if(""===c)H.addClass("mck-text-req");else{var c=b.trim(c),d=l.val(),e=s.data("mck-conversationid",e),k={type:5,contentType:4,message:c};!0===s.data("isgroup")?k.groupId=d:k.to=d;if(s.data("mck-conversationid")){e=s.data("mck-conversationid");k.conversationId=e;var h=M[e];"object"!==h?a.getTopicId({conversationId:e,
suppId:d,priceText:c}):"function"===typeof Da&&Da({custId:w,suppId:d,productId:h.topicId,price:c});H.val("")}a.sendMessage(k)}};a.dispatchMessage=function(c){if("object"===c.messagePxy){var d=c.messagePxy;if(c.topicId){var e=J[c.topicId];if("object"===typeof e&&"undefined"!==e.title)if(d.message||(d.message=b.trim(e.title)),c.conversationId)d.conversationId=c.conversationId;else if(c.topicId){var k={topicId:c.topicId};"object"===typeof e&&(k.topicDetail=g.JSON.stringify(e));d.conversationPxy=k}!d.message&&
e.link&&(e={blobKey:b.trim(e.link),contentType:"image/png"},d.fileMeta=e,d.contentType=5,F=[],F.push(e))}c.isGroup?d.groupId=c.tabId:d.to=c.tabId;a.sendMessage(d)}};a.getGroup=function(c){var e=[];b.each(c.users,function(a,b){"undefined"!==typeof b.userId&&("undefined"!==typeof b.groupRole&&-1===pb.indexOf(b.groupRole)||e.push(b))});var k={groupName:b.trim(c.groupName),users:e,type:c.type};c.admin&&(k.admin=c.admin);c.clientGroupId&&(k.clientGroupId=c.clientGroupId);c.groupIcon&&(k.imageUrl=c.groupIcon);
k.metadata=c.metadata?c.metadata:MCK_LABELS["group.metadata"];var h={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/group/v2.1/create",global:!1,data:g.JSON.stringify(k),type:"post",contentType:"application/json",success:function(e){c.isInternal&&ta.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);if("object"===typeof e&&"success"===e.status){if(e=e.response,"object"===typeof e){var k=mckGroupUtils.addGroup(e);0<e.users.length&&b.each(e.users,function(a,b){ca[b.userId]=b;b.connected?g.MCK_OL_MAP[b.userId]=
!0:(g.MCK_OL_MAP[b.userId]=!1,"undefined"!==typeof b.lastSeenAtTime&&(T[b.userId]=b.lastSeenAtTime));d.updateUnreadCount("user_"+b.userId,b.unreadCount,!1);var c=d.getContact(""+b.userId);"undefined"===typeof c?d.createContactWithDetail(b):d.updateContactDetail(c,b)});c.tabId=k.contactId;c.isGroup=!0;c.isMessage?d.loadTab(c,a.dispatchMessage):c.isInternal?(s.data("mck-id",k.contactId),s.data("isgroup",!0),t.loadGroupInfo({groupId:k.contactId})):d.loadTab(c);"function"===typeof c.callback&&(h.status=
"success",h.data=k,c.callback(h))}}else"error"===e.status&&"function"===typeof c.callback&&(h.status="error",h.errorMessage=e.errorResponse[0].description,c.callback(h))},error:function(){c.isInternal&&ta.attr("disabled",!1).html(MCK_LABELS["create.group.title"]);"function"===typeof c.callback&&(h.status="error",h.errorMessage="Unable to process request.",c.callback(h))}})};a.sendVideoCallMessage=function(b,c,d,e){var k="CALL_MISSED"==c?"Missed Call":"CALL_REJECTED"==c?"Call Rejected":"";if(""==k||
void 0==k)k="video message";b={to:l.val(),type:5,contentType:d,message:k,metadata:{MSG_TYPE:c,CALL_ID:b,CALL_AUDIO_ONLY:e},senderName:w};a.sendMessage(b);return b};a.sendVideoCallEndMessage=function(b,c,d,e,k){var h="";k&&(h=mckDateUtils.convertMilisIntoTime(k));h="CALL_MISSED"==c?"Missed Call":"CALL_REJECTED"==c?"Call Rejected":"CALL_END"==c?"Call End \n Duration: "+h:"video message";if(""==h||void 0==h)h="video message";b={to:l.val(),type:5,contentType:d,message:h,metadata:{MSG_TYPE:c,CALL_ID:b,
CALL_AUDIO_ONLY:e,CALL_DURATION:k}};a.sendMessage(b);return b}},Y=new function(){var a=this;b("#mck-search-list");var c=b("#mck-sidebox-search"),l=b("#mck-search-loading");b("#mck-search-cell .mck-message-inner");b("#mck-message-cell .mck-message-inner");b(".mck-tab-message-option");b("#mck-contact-loading");a.getContactDisplayName=function(a){var b=[];if(0<a.length&&a[0]){for(var c="",h=a.filter(function(b,c){return a.indexOf(b)===c}),g=0;g<h.length;g++){var l=h[g];"undefined"===typeof ka[l]&&(c+=
"userIds\x3d"+encodeURIComponent(l)+"\x26")}c.lastIndexOf("\x26")===c.length-1&&(c=c.substring(0,c.length-1));c&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/info",data:c,global:!1,type:"get",success:function(a){for(var c in a)a.hasOwnProperty(c)&&(b.push([c,a[c]]),ka[c]=a[c],d.fetchContact(c).displayName=a[c]);A.updateMckContactNameArray(b)},error:function(){}})}};a.loadContacts=function(){var a=[];mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/filter?startIndex\x3d0\x26pageSize\x3d30\x26orderBy\x3d1",
type:"get",global:!1,success:function(e){c.hasClass("vis")&&("object"===typeof e&&0<e.users.length&&(b.each(e.users,function(b,c){if("undefined"!==typeof c.userId){var e=d.getContact(""+c.userId),e="undefined"===typeof e?d.createContactWithDetail(c):d.updateContactDetail(e,c);Na.push(e);a.push([c.userId,e.displayName]);c.connected?g.MCK_OL_MAP[c.userId]=!0:(g.MCK_OL_MAP[c.userId]=!1,"undefined"!==typeof c.lastSeenAtTime&&(T[c.userId]=c.lastSeenAtTime))}}),0<a.length&&A.updateMckContactNameArray(a)),
d.addContactsToSearchList())},error:function(){l.removeClass("vis").addClass("n-vis");g.console.log("Unable to load contacts. Please reload page.")}})};a.loadUserProfile=function(b){if("undefined"!==typeof b){var c=[];b=""+b.split(",")[0];c.push(b);a.loadUserProfiles(c)}};a.loadUserProfiles=function(c){var e=[];b.each(c,function(a,b){"undefined"===typeof d.getContact(b)&&e.push(b)});a.getUsersDetail(e,{async:!1})};a.getUsersDetail=function(a,c){if(!("undefined"===typeof a||1>a.length)){for(var h=
"undefined"!==typeof c.cached?c.cached:!0,l=[],p=a.filter(function(b,c){return a.indexOf(b)===c}),t=0;t<p.length;t++){var v=p[t];h&&"undefined"!==typeof ca[v]||l.push(v)}if(0===l.length)c.setStatus?X.updateUserConnectedStatus():c.message?d.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&d.loadMessageListOnUserDetailFetch(c);else{var y={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/v2/detail",type:"post",async:"undefined"!==typeof c.async?c.async:!0,data:JSON.stringify({userIdList:l}),
contentType:"application/json",success:function(a){"success"===a.status&&0<a.response.length&&b.each(a.response,function(a,b){ca[b.userId]=b;g.MCK_OL_MAP[b.userId]=b.connected;var c=d.getContact(""+b.userId);"undefined"===typeof c?d.createContactWithDetail(b):d.updateContactDetail(c,b)});c.setStatus?X.updateUserConnectedStatus():c.message?d.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&d.loadMessageListOnUserDetailFetch(c);y.status="success";y.data=a;c.callback&&c.callback(y)},
error:function(){c.setStatus?X.updateUserConnectedStatus():c.message?d.populateMessage(c.messageType,c.message,c.notifyUser):c.isLoadMessageList&&d.loadMessageListOnUserDetailFetch(c);y.status="error";c.callback&&c.callback(y)}})}}};a.getUserStatus=function(a){var c={};mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/chat/status",type:"get",success:function(h){0<h.users.length&&(Oa=[],b.each(h.users,function(a,b){var c=d.getContact(""+b.userId),c="undefined"===typeof c?d.createContactWithDetail(b):
d.updateContactDetail(c,b);Oa.push(c.contactId)}));c.status="success";c.data=h;a.callback&&a.callback(c)},error:function(){c.status="error";a.callback&&a.callback(c)}})};a.blockUser=function(a,b){a&&"undefined"!==typeof b&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/user/block",type:"get",data:"userId\x3d"+a+"\x26block\x3d"+b,success:function(c){"object"===typeof c&&"success"===c.status&&(ha[a]=b,X.toggleBlockUser(a,b))},error:function(){}})}},cb=new function(){var a=this,c,g,l,e,p,n,t,r;a.init=function(){b("#mck-sidebox");
g=b("#mck-msg-preview");p=b("#mck-group-info-tab");b("#mck-sidebox-launcher");c=b("#mck-message-cell .mck-message-inner");l=b("#mck-msg-preview .mck-preview-icon");e=b("#mck-msg-preview .mck-preview-cont-name");t=b("#mck-msg-preview .mck-preview-msg-content");r=b("#mck-msg-preview .mck-preview-file-content")};a.notifyUser=function(b){if(7!==b.type){var c=b.groupId?mckGroupUtils.getGroup(""+b.groupId):d.fetchContact(""+b.to.split(",")[0]),e=!1;b.groupId&&(e=!0);Y.loadUserProfile(b.to);var e=d.getTabDisplayName(c.contactId,
e),h=bc;a.showNewMessageNotification(b,c,e);if(Rb&&!mb){var g=dc;b=d.getTextForMessagePreview(b,c);"function"!==typeof La||c.isGroup||(c=La(c.contactId))&&"undefined"!==typeof c&&(g=c);mckNotificationUtils.sendDesktopNotification(e,g,b,h)}}};a.showNewMessageNotification=function(a,b,n){if(Sb&&102!==a.contentType){var u=c.data("mck-id"),w=c.data("isgroup");if(u===b.contactId&&w===b.isGroup&&!p.hasClass("vis"))if(a.conversationId&&(wa||Ia)){if(u=c.data("mck-conversationid"),u="undefined"!==typeof u&&
""!==u?u.toString():"",u===a.conversationId.toString())return}else return;g.data("isgroup",b.isGroup);g.data("mck-conversationid",a.conversationId?a.conversationId:"");u=d.getContactImageLink(b,n);a.message?(w=d.getMessageTextForContactPreview(a,b,50),t.html(""),"object"===typeof w?t.append(w):t.html(w),t.removeClass("n-vis").addClass("vis")):t.html("");a.fileMetaKey?(r.html(d.getFileIcon(a)),r.removeClass("n-vis").addClass("vis"),""===t.html()&&t.removeClass("vis").addClass("n-vis")):(r.html(""),
r.removeClass("vis").addClass("n-vis"));e.html(n);l.html(u);g.data("mck-id",b.contactId);g.show();setTimeout(function(){g.fadeOut(3E3)},1E4)}};a.unsubscribeToServiceWorker=function(){n&&navigator.serviceWorker.ready.then(function(a){n.unsubscribe().then(function(a){n=null;console.log("Unsubscribed to notification successfully")})})};a.sendSubscriptionIdToServer=function(){if(n){var a=n.endpoint.split("/").slice(-1)[0];a&&mckUtils.ajax({url:MCK_BASE_URL+"/rest/ws/plugin/update/sw/id",type:"post",data:"registrationId\x3d"+
a,success:function(a){},error:function(a,b,c){401===a.status&&(sessionStorage.clear(),console.log("Please reload page."))}})}};a.subscribeToServiceWorker=function(){Tb&&"serviceWorker"in navigator&&(navigator.serviceWorker.register("./service-worker.js",{scope:"./"}),navigator.serviceWorker.ready.then(function(b){b.pushManager.subscribe({userVisibleOnly:!0}).then(function(b){console.log("The reg ID is:: ",b.endpoint.split("/").slice(-1));n=b;a.sendSubscriptionIdToServer()})}))}},Fa=b(".chat-launcher-icon"),
ea=new function(){var a=this;a.token=null;a.Identity=null;a.outgoingCallServices=null;a.incomingCallServices=null;var c=b(".mck-videocall-btn"),g=b(".applozic-vid-container"),l=b("#mck-sidebox"),e=b("#mck-video-call-indicator");a.hideVideoBox=function(){g.addClass("n-vis").removeClass("vis");l.addClass("vis").removeClass("n-vis");e.addClass("n-vis").removeClass("vis")};a.init=function(){ta.loop=!0;a.token=null!==A.getAppHeaders()?A.getAppHeaders().videoToken:void 0;a.ringToneForHost=za.loadRingTone(MCK_BASE_URL+
"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",ta);b("#mck-btn-video-call").on("click",function(c){if(a.token){c=w+(new Date).getTime().toString()+Math.random().toString(36).slice(2);var e=u.sendVideoCallMessage(c,"CALL_DIALED",102,!1),h=d.fetchContact(e.to),e=d.getTabDisplayName(h.contactId,!1),h=d.getContactImageLink(h,e),g=new Date;a.outgoingCallServices=new MckCallingService(w,ea.token,c,e,!0,g,u,h,!1,a.ringToneForHost);a.outgoingCallServices.startVideoCall();b("#mck-btn-video-call").data("isCallHost",
!0);b("#mck-btn-video-call").data("callStartTime",g)}else alert("missing token... please refresh page..")});b("#mck-vid-receive-btn").on("click",function(a){console.log("call received");$("#mck-video-call-indicator").addClass("n-vis").removeClass("vis");c.removeClass("vis").addClass("n-vis");a=b("#mck-video-call-indicator").data("call-id");var d=b("#mck-video-call-indicator").data("isAudioCall");b("#mck-video-call-indicator").data("callReceived",!0);b("#mck-video-call-indicator").addClass("n-vis");
ea.callReceived(a,d)});b("#mck-vid-reject-btn").on("click",function(a){console.log("call rejected");a=b("#mck-video-call-indicator").data("call-id");var c=b("#mck-video-call-indicator").data("isAudioCall");ea.callRejected(a,c);b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis")})};a.InitilizeVideoClient=function(c,d){a.Identity=c;b.ajax({url:MCK_BASE_URL+"/twilio/token",type:"post",contentType:"application/x-www-form-urlencoded",data:{identity:c,device:d},success:function(b){if(null!=
b&&""!=b){a.token=b.token;var c=A.getAppHeaders();c.videoToken=b.token;A.setAppHeaders(c)}},error:function(a){console.log("error while getting token"+a)}})};a.callReceived=function(b,c){console.log("_this.callReceived");pa&&pa.stop();u.sendVideoCallMessage(b,"CALL_ANSWERED",102,c);a.incomingCallServices=new MckCallingService(a.Identity,a.token,b,null,!1,null,u,null,c);a.incomingCallServices.startVideoCall()};a.callRejected=function(a,b){pa&&pa.stop();u.sendVideoCallMessage(a,"CALL_REJECTED",102,b)}},
bc=null,ta={},za,pa=null,ac=c.isAnonymousChat;g.MCK_OL_MAP=[];l.events={onConnectFailed:function(){},onConnect:function(){},onMessageDelivered:function(){},onMessageRead:function(){},onMessageDeleted:function(){},onConversationDeleted:function(){},onUserConnect:function(){},onUserDisconnect:function(){},onConversationReadFromOtherSource:function(){},onConversationRead:function(){},onMessageReceived:function(){},onMessageSentUpdate:function(){},onMessageSent:function(){},onUserBlocked:function(){},
onUserUnblocked:function(){},onUserActivated:function(){},onUserDeactivated:function(){}};var O=new function(a){var c=this,l=a.events,p=null,e=null,r="",n=null,L=[],G,v,y="",N=b("#mck-sidebox"),F=b("#mck-tab-title"),K=b(".mck-typing-box"),H=b("#mck-tab-status");b("#mck-offline-message-box");var O=b("#mck-typing-label"),D=b("#mck-message-cell .mck-message-inner");c.init=function(){if("undefined"!==typeof Ha){var a=mckUtils.startsWith(Ha,"https")?"15675":"15674";"function"===typeof g.SockJS&&(y||(y=
new SockJS(Ha+":"+a+"/stomp")),e=g.Stomp.over(y),e.heartbeat.outgoing=0,e.heartbeat.incoming=0,e.onclose=function(){c.disconnect()},e.connect("guest","guest",c.onConnect,c.onError,"/"),g.addEventListener("beforeunload",function(a){c.disconnect()}))}};c.checkConnected=function(a){e.connected?(G&&clearInterval(G),v&&clearInterval(v),G=setInterval(function(){c.connectToSocket(a)},6E5),v=setInterval(function(){c.sendStatus(1)},12E5)):c.connectToSocket(a)};c.connectToSocket=function(a){if(!e.connected){if(a&&
"block"===N.css("display"))if(a=D.data("mck-id")){var b=D.data("isgroup"),g=D.data("mck-conversationid"),l=D.data("mck-topicid");A.clearMckMessageArray();d.loadTab({tabId:a,isGroup:b,conversationId:g,topicId:l})}else A.clearMckMessageArray(),d.loadTab({tabId:"",isGroup:!1});c.init()}};c.stopConnectedCheck=function(){G&&clearInterval(G);v&&clearInterval(v);v=G="";c.disconnect()};c.disconnect=function(){e&&e.connected&&(c.sendStatus(0),e.disconnect())};c.unsubscibeToTypingChannel=function(){e&&e.connected&&
n&&(1===qa&&c.sendTypingStatus(0,r),n.unsubscribe());n=null};c.unsubscibeToNotification=function(){e&&e.connected&&p&&p.unsubscribe();p=null};c.subscibeToTypingChannel=function(a,b){var d=b?a:w;e&&e.connected?n=e.subscribe("/topic/typing-"+Q+"-"+d,c.onTypingStatus):c.reconnect()};c.subscribeToOpenGroup=function(a){if(e&&e.connected){var b=e.subscribe("/topic/group-"+Q+"-"+a.contactId,c.onOpenGroupMessage);L.push(b.id);ob[a.contactId]=b.id}else c.reconnect()};c.sendTypingStatus=function(a,b){if(e&&
e.connected){1===a&&1===qa&&e.send("/topic/typing-"+Q+"-"+r,{"content-type":"text/plain"},Q+","+w+","+a);if(b){if(b===r&&a===qa&&1===a)return;r=b;e.send("/topic/typing-"+Q+"-"+b,{"content-type":"text/plain"},Q+","+w+","+a);setTimeout(function(){qa=0},6E4)}else 0===a&&e.send("/topic/typing-"+Q+"-"+r,{"content-type":"text/plain"},Q+","+w+","+a);qa=a}};c.onTypingStatus=function(a){if(null!=n&&n.id===a.headers.subscription){var b=a.body,c=b.split(",")[1],b=Number(b.split(",")[2]);a=a.headers.destination.substring(a.headers.destination.lastIndexOf("-")+
1,a.headers.destination.length);var e=D.data("mck-id"),h=D.data("isgroup"),g=mckGroupUtils.getGroup(e);if(!ha[c]&&!Ca[c])if(1===b){if(!(w===c&&h||e!==c&&e!==a)){if(h=D.data("isgroup")){if(c!==w){if(t.authenticateGroupUser(g)||6===g.type&&!da.disableChatForNonGroupMember)F.addClass("mck-tab-title-w-typing"),H.removeClass("vis").addClass("n-vis"),c=d.getTabDisplayName(c,!1),c=c.split(" ")[0],O.html(c+" "+MCK_LABELS["is.typing"]);7===g.type&&(F.addClass("mck-tab-title-w-typing"),O.html(MCK_LABELS["is.typing"]),
H.html(""))}}else F.addClass("mck-tab-title-w-typing"),H.removeClass("vis").addClass("n-vis"),O.html(MCK_LABELS.typing);K.removeClass("n-vis").addClass("vis");setTimeout(function(){F.removeClass("mck-tab-title-w-typing");K.removeClass("vis").addClass("n-vis");F.hasClass("undefined"===typeof g||7!=g.type)&&H.removeClass("n-vis").addClass("vis");O.html(MCK_LABELS.typing)},6E4)}}else F.removeClass("mck-tab-title-w-typing"),K.removeClass("vis").addClass("n-vis"),!F.hasClass("mck-tab-title-w-status")||
"undefined"!==typeof g&&7==g.type||H.removeClass("n-vis").addClass("vis"),O.html(MCK_LABELS.typing)}};c.reconnect=function(){c.unsubscibeToTypingChannel();c.unsubscibeToNotification();c.disconnect();c.init()};c.onError=function(a){g.console.log("Error in channel notification. "+a);l.onConnectFailed()};c.sendStatus=function(a){e&&e.connected&&e.send("/topic/status-v2",{"content-type":"text/plain"},ba+","+ga+","+a)};c.onConnect=function(){e.connected?(p&&c.unsubscibeToNotification(),p=e.subscribe("/topic/"+
ba,c.onMessage),c.sendStatus(1),c.checkConnected(!0)):setTimeout(function(){p=e.subscribe("/topic/"+ba,c.onMessage);c.sendStatus(1);c.checkConnected(!0)},5E3);l.onConnect()};c.onOpenGroupMessage=function(a){if(-1!==L.indexOf(a.headers.subscription)){var c=b.parseJSON(a.body),e=c.type;a=c.message;if("APPLOZIC_03"===e)A.updateLatestMessage(a),0!==a.type&&4!==a.type&&(b("."+a.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),d.addTooltip(a.key)),l.onMessageSentUpdate({messageKey:a.key});
else if("APPLOZIC_01"===e||"APPLOZIC_02"===e||"MESSAGE_RECEIVED"===e){A.updateLatestMessage(a);var h=a.groupId?mckGroupUtils.getGroup(a.groupId):d.getContact(a.to);b("#mck-sidebox-content");D.data("mck-id");if("APPLOZIC_01"===e||"MESSAGE_RECEIVED"===e){var g=d.getMessageFeed(a);l.onMessageReceived({message:g})}else"APPLOZIC_02"===e&&(g=d.getMessageFeed(a),l.onMessageSent({message:g}));a.conversationId&&(g=M[a.conversationId],!wa&&!Ia||"object"===typeof g&&"object"===typeof J[g.topicId]||u.getTopicId({conversationId:a.conversationId,
messageType:e,message:a,notifyUser:c.notifyUser,async:!1,populate:!1}));"undefined"===typeof h?(c={message:a,messageType:e,notifyUser:c.notifyUser},a.groupId?t.getGroupFeedFromMessage(c):(e=[],e.push(a.to),Y.getUsersDetail(e,c))):d.populateMessage(e,a,c.notifyUser)}}};c.onMessage=function(a){if(null!=p&&p.id===a.headers.subscription){a=b.parseJSON(a.body);var c=a.type;if("APPLOZIC_04"===c||"MESSAGE_DELIVERED"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").addClass("mck-icon-delivered"),
d.addTooltip(a.message.split(",")[0]),l.onMessageDelivered({messageKey:a.message.split(",")[0]});else if("APPLOZIC_08"===c||"MT_MESSAGE_DELIVERED_READ"===c)b("."+a.message.split(",")[0]+" .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),d.addTooltip(a.message.split(",")[0]),l.onMessageRead({messageKey:a.message.split(",")[0]});else if("APPLOZIC_05"===c){var e=a.message.split(",")[0],h=a.message.split(",")[1],
n="1"===a.message.split(",")[2]?!0:!1;d.removedDeletedMessage(e,h,n);a={messageKey:a.message.split(",")[0]};n?a.groupId=h:a.userKey=h;console.log(a);l.onMessageDeleted(a)}else if("APPLOZIC_27"===c)e=a.message.split(",")[0],a=a.message.split(",")[1],"undefined"!==typeof e&&(d.removeConversationThread(e,!1),d.updateUnreadCount("user_"+e,0,!0),h={userId:e},a&&(h.topicId=a),l.onConversationDeleted(h));else if("APPLOZIC_11"===c){e=a.message;n=d.fetchContact(e);h=D.data("mck-id");if(!ha[e]&&!Ca[e]){if(h!==
n.contactId||D.data("isgroup")){var r=mckContactUtils.formatContactId(e);b("#li-user-"+r+" .mck-ol-status").removeClass("n-vis").addClass("vis")}else b("#mck-tab-status").html(MCK_LABELS.online),bb&&d.hideOfflineMessage();b(".mck-user-ol-status."+r).removeClass("n-vis").addClass("vis");b(".mck-user-ol-status."+r).next().html("("+MCK_LABELS.online+")");g.MCK_OL_MAP[e]=!0;X.updateUserStatus({userId:a.message,status:1})}l.onUserConnect({userId:a.message})}else if("APPLOZIC_12"===c)e=a.message.split(",")[0],
a=a.message.split(",")[1],n=d.fetchContact(e),g.MCK_OL_MAP[e]=!1,a&&(T[e]=a),ha[e]||Ca[e]||(h=D.data("mck-id"),h!==n.contactId||D.data("isgroup")||(b("#mck-tab-status").html(mckDateUtils.getLastSeenAtStatus(a)),bb&&Ya.manageOfflineMessageTime(h)),b(".mck-user-ol-status."+n.htmlId).removeClass("vis").addClass("n-vis"),b(".mck-user-ol-status."+n.htmlId).next().html("(Offline)"),b("#li-user-"+r+" .mck-ol-status").removeClass("vis").addClass("n-vis"),X.updateUserStatus({userId:e,status:0,lastSeenAtTime:a})),
l.onUserDisconnect({userId:e,lastSeenAtTime:a});else if("APPLOZIC_29"===c){e=a.message.split(",")[0];a=a.message.split(",")[1];n=d.fetchContact(e);d.updateUnreadCount("user_"+n.contactId,0,!0);h=D.data("mck-id");if("undefined"===typeof h||""===h)b("#li-user-"+n.htmlId+" .mck-unread-count-text").html(d.getUnreadCount("user_"+n.contactId)),b("#li-user-"+n.htmlId+" .mck-unread-count-box").removeClass("vis").addClass("n-vis");h={userId:e};a&&(h.topicId=a);l.onConversationReadFromOtherSource(h)}else if("APPLOZIC_28"===
c)e=a.message.split(",")[0],a=a.message.split(",")[1],h=D.data("mck-id"),h===e&&(b(".mck-msg-right .mck-message-status").removeClass("mck-icon-time").removeClass("mck-icon-sent").removeClass("mck-icon-delivered").addClass("mck-icon-read"),b(".mck-msg-right .mck-icon-delivered").attr("title","delivered and read"),n=d.getContact(e),"undefined"===typeof n&&(h=[],h.push(e),Y.getUsersDetail(h,{}))),h={userId:e},a&&(h.topicId=a),l.onConversationRead(h);else if("APPLOZIC_16"===c)c=a.message.split(":")[0],
e=a.message.split(":")[1],n=d.fetchContact(e),h=D.data("mck-id"),h===n.contactId?c===Wb[0]?(ha[n.contactId]=!0,X.toggleBlockUser(h,!0)):(Ca[n.contactId]=!0,F.removeClass("mck-tab-title-w-status"),H.removeClass("vis").addClass("n-vis"),K.removeClass("vis").addClass("n-vis")):b("#li-user-"+n.htmlId+" .mck-ol-status").removeClass("vis").addClass("n-vis"),l.onUserBlocked({status:c,userId:e});else if("APPLOZIC_17"===c){c=a.message.split(":")[0];e=a.message.split(":")[1];n=d.fetchContact(e);h=D.data("mck-id");
if(h===n.contactId)if(c===Wb[2])ha[n.contactId]=!1,X.toggleBlockUser(h,!1);else{if(g.MCK_OL_MAP[h]||T[h])Ca[n.contactId]=!1,ha[h]||(g.MCK_OL_MAP[h]?H.html(MCK_LABELS.online):T[h]&&H.html(mckDateUtils.getLastSeenAtStatus(T[h])),F.addClass("mck-tab-title-w-status"),H.removeClass("n-vis").addClass("vis"))}else g.MCK_OL_MAP[h]&&b("#li-user-"+n.htmlId+" .mck-ol-status").removeClass("n-vis").addClass("vis");l.onUserUnblocked({status:c,userId:e})}else if("APPLOZIC_18"===c)ab=!1,l.onUserActivated();else if("APPLOZIC_19"===
c)ab=!0,l.onUserDeactivated();else if(e=a.message,"APPLOZIC_03"===c)A.updateLatestMessage(e),0!==e.type&&4!==e.type&&(b("."+e.key+" .mck-message-status").removeClass("mck-icon-time").addClass("mck-icon-sent"),d.addTooltip(e.key)),l.onMessageSentUpdate({messageKey:e.key});else if("APPLOZIC_01"===c||"APPLOZIC_02"===c||"MESSAGE_RECEIVED"===c)A.updateLatestMessage(e),n=e.groupId?mckGroupUtils.getGroup(e.groupId):d.getContact(e.to),b("#mck-sidebox-content"),h=D.data("mck-id"),"APPLOZIC_01"===c||"MESSAGE_RECEIVED"===
c?(h=d.getMessageFeed(e),l.onMessageReceived({message:h})):"APPLOZIC_02"===c&&(h=d.getMessageFeed(e),l.onMessageSent({message:h})),e.conversationId&&(h=M[e.conversationId],!wa&&!Ia||"object"===typeof h&&"object"===typeof J[h.topicId]||u.getTopicId({conversationId:e.conversationId,messageType:c,message:e,notifyUser:a.notifyUser,async:!1,populate:!1})),"undefined"===typeof n?(a={message:e,messageType:c,notifyUser:a.notifyUser},e.groupId?t.getGroupFeedFromMessage(a):(h=[],h.push(e.to),Y.getUsersDetail(h,
a))):(102==e.contentType&&Ka&&(a.notifyUser=!1,4==e.type&&"CALL_DIALED"==e.metadata.MSG_TYPE?(n=d.fetchContact(e.to),h=d.getTabDisplayName(n.contactId,!1),n=d.getContactImageLink(n,h),b("#mck-video-call-indicator").data("call-id",e.metadata.CALL_ID),b("#mck-video-call-indicator").data("isAudioCall",e.metadata.CALL_AUDIO_ONLY),b("#mck-video-call-indicator-txt").html(h+" calling..."),b("#mck-video-call-icon").html(n),b("#mck-video-call-indicator").removeClass("n-vis").addClass("vis"),pa.play(),setTimeout(function(){b("#mck-video-call-indicator").data("callReceived")||
(console.log("call is not answered"),pa.stop(),b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"))},6E4)):4==e.type&&"CALL_REJECTED"==e.metadata.MSG_TYPE&&b("#mck-btn-video-call").data("isCallHost")&&(u.sendVideoCallMessage(e.metadata.CALL_ID,"CALL_REJECTED",103,!1),ea.ringToneForHost.stop(),ea.outgoingCallServices.twilioService.leaveRoomIfJoined(),ea.hideVideoBox(),ea.outgoingCallServices&&(ea.outgoingCallServices.rejectedByReceiver=!0))),103==e.contentType?4==e.type&&"CALL_MISSED"==
e.metadata.MSG_TYPE&&(b("#mck-video-call-indicator").addClass("n-vis").removeClass("vis"),pa&&pa.stop()):d.populateMessage(c,e,a.notifyUser))}}}(l);l.getOptions=function(){return c};l.init=function(){ta.loop=!1;za=new RingToneService;bc=za.loadRingTone(ec,ta);u.init();oa.init();Ya.initializeApp(c,!1);cb.init();Cb.init();d.initEmojis();Ka&&(ta.loop=!0,za=new RingToneService,pa=za.loadRingTone(MCK_BASE_URL+"/resources/sidebox/audio/applozic_video_call_ring_tone.mp3",ta),ea.init())};l.reInit=function(a){"object"===
b.type(a)&&(a=b.extend(!0,{},Gb,a),b.fn.applozic("reset",a),a.userId&&a.appId&&""!==b.trim(a.userId)&&""!==b.trim(a.appId)?(Ya.initializeApp(a,!0),c=a):g.console("Oops! looks like incorrect application id or user Id."))};l.loadTabView=function(a){"undefined"===typeof a.isGroup&&(a.isGroup=!1);d.loadTab(a);b("#mck-search").val("")};l.loadTab=function(a){d.loadTab({tabId:a,isGroup:!1});b("#mck-search").val("")};l.loadChat=function(a){if(!("undefined"!==typeof a.userId&&""!==a.userId||"undefined"!==
typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId))return"UserId or groupId or clientGroupId required";var c={tabId:a.userId,isGroup:!1},c={};a.userId&&(c.tabId=userId,c.isGroup=!1);a.displayName&&(c.userName=a.displayName);a.convId&&(c.conversationId=a.convId);if(a.groupId||a.clientGroupId)if(c.isGroup=!0,a.clientGroupId){c.clientGroupId=a.clientGroupId;var g=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);if("object"===typeof g)c.tabId=g.contactId;
else{mckGroupService.getGroupFeed({clientGroupId:c.clientGroupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});b("#mck-search").val("");return}}else if(g=mckGroupUtils.getGroup(a.groupId),"object"===typeof g)c.tabId=a.groupId;else{mckGroupService.getGroupFeed({groupId:a.groupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab});b("#mck-search").val("");return}d.loadTab(c);b("#mck-search").val("")};l.uploadFile=function(a){oa.uploadFile(a)};l.audioAttach=function(a){oa.audioRecoder(a)};l.loadGroupTab=
function(a){if("undefined"===typeof a||""===a)return"GroupId required";"object"===typeof mckGroupUtils.getGroup(a)?(d.loadTab({tabId:a,isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({groupId:a,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};l.loadGroupTabByClientGroupId=function(a){if("undefined"===typeof a.clientGroupId||""===a.clientGroupId)return"Client Group Id Required";var c=mckGroupUtils.getGroupByClientGroupId(a.clientGroupId);"object"===typeof c?(d.loadTab({tabId:c.contactId,
isGroup:!0}),b("#mck-search").val("")):mckGroupService.getGroupFeed({clientGroupId:a.clientGroupId,apzCallback:t.onGroupFeed,callback:t.loadGroupTab})};l.loadConvTab=function(a){"object"===typeof a&&a.userId&&a.convId&&d.loadTab({tabId:a.userId,conversationId:a.convId,isGroup:!1})};l.loadTabWithTopic=function(a){if("object"===typeof a&&a.userId&&a.topicId){var b={tabId:a.userId,topicId:a.topicId};a.userName&&(b.userName=a.userName);b.topicStatus=a.topicStatus?-1===V.indexOf(a.topicStatus)?V[0]:a.topicStatus.toString():
V[0];if("function"===typeof ua){var c=ua(a.topicId);"object"===typeof c&&"undefined"!==c.title&&(J[a.topicId]=c)}a.message?(b.messagePxy={type:5,contentType:0,message:message},b.isMessage=!0):b.isMessage=!1;a.supportId?(b.isGroup=!0,b.supportId=supportId):b.isGroup=!1;u.getConversationId(b)}else{if(!a.userId)return"UserId required";if(!a.topicId)return"TopicId required"}};l.loadContacts=function(a){d.loadContacts(a)};l.setOffline=function(){"undefined"!==typeof O&&O.sendStatus(0)};l.reset=function(a){g.sessionStorage.clear();
p=ba="";F=[];MCK_GROUP_MAP=[];lb=!0;Aa=[];ga="";nb=a.mode;ha=[];Ca=[];Ba=!1;ra=90;Q=a.appId;T=[];M=[];J=[];MCK_CLIENT_GROUP_MAP=[];mb=!0;MCK_LABELS=a.labels;K=0;MCK_BASE_URL=a.baseUrl;H={};Ma=[];Wa=a.launcher;ob=[];Hb=a.userName;fb=a.visitor;ia=[];Na=[];Ja={};G=a.fileBaseUrl;Xa=a.locShare;Ka=c.video;N=a.onInit;rb=a.onTopicDetails;ka=[];Ea=[];sb=a.onClose;ja=a.accessToken;tb=a.displayText;Ta=a.readConversation;Z=a.maxGroupSize;W=[];ub=a.onTabClicked;Ib=a.contactNumber;vb=a.appModuleName;ua=a.getTopicDetail;
va=a.maxAttachmentSize;wb=a.validateMessage;Ua=a.contactDisplayName;Oa=[];Da=a.finalPriceResponse;La=a.contactDisplayImage;xb=a.priceWidget;da=c.openGroupSettings;aa=a.offlineMessageDetail;yb=a.getConversationDetail;gb=a.authenticationTypeId;w=fb?"guest":b.trim(a.userId);Kb=Xa?a.googleApiKey:"NO_ACCESS";hb="boolean"===typeof a.olStatus?a.olStatus:!1;Ia="boolean"===typeof a.topicBox?a.topicBox:!1;bb="boolean"===typeof a.showOfflineMessage?a.showOfflineMessage:!1;wa="boolean"===typeof a.topicHeader?
a.topicHeader:!1;Sb="boolean"===typeof a.notification?a.notification:!0;Tb="boolean"===typeof a.swNotification?a.swNotification:!1;Qb=a.supportId?'data-mck-id\x3d"'+a.supportId+'"':"";Mb="boolean"===typeof a.hideGroupSubtitle?a.hideGroupSubtitle:!1;Nb="undefined"===typeof a.defaultMessageMetaData?{}:a.defaultMessageMetaData;zb="boolean"===typeof a.groupUserCount?a.groupUserCount:!1;Rb="boolean"===typeof a.desktopNotification?a.desktopNotification:!1;Ab="boolean"===typeof a.loadOwnContacts?a.loadOwnContacts:
!1;Lb="boolean"===typeof a.messageBubbleAvator?a.messageBubbleAvator:!1;Pb="boolean"===typeof c.resetUserStatus?c.resetUserStatus:!1;ib="boolean"===typeof a.launchOnNewMessage?a.launchOnNewMessage:!1;Ub="boolean"===typeof a.autoTypeSearchEnabled?a.autoTypeSearchEnabled:!0;Ob="boolean"===typeof a.checkUserBusyWithStatus?a.checkUserBusyWithStatus:!1;Bb="boolean"===typeof a.launchOnUnreadMessage?a.launchOnUnreadMessage:!1;ac=c.isAnonymousChat};l.logout=function(){"undefined"!==typeof O&&(O.disconnect(),
A.clearMckMessageArray(),b.fn.applozic("reset",c),b("#mck-sidebox").hide(),b("#mck-sidebox-launcher").hide());lb=!1};l.setOnline=function(){"undefined"!==typeof O&&O.sendStatus(1)};l.getUserStatus=function(a){"function"===typeof a.callback&&("undefined"!==typeof a.userIds?Y.getUsersDetail(a.userIds,a):Y.getUserStatus(a))};l.getGroupList=function(a){return"function"===typeof a.callback?(a.apzCallback=t.loadGroups,mckGroupService.loadGroups(a),"success"):"Callback Function Required"};l.leaveGroup=function(a){if("object"!==
typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback){if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)return a.apzCallback=t.onGroupLeft,mckGroupService.leaveGroup(a),"success";a.callback({status:"error",errorMessage:"GroupId or Client GroupId Required"})}else return"Callback Function Required"};l.addGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===
typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else if("undefined"!==typeof a.role&&-1===pb.indexOf(a.role))a.callback({status:"error",errorMessage:"Incorrect member role"});else return Y.loadUserProfile(a.userId),a.apzCallback=t.onAddedGroupMember,mckGroupService.addGroupMember(a),"success";else a.callback({status:"error",
errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.removeGroupMember=function(a){if("object"!==typeof a)return"Unsupported Format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if("undefined"===typeof a.userId||""===a.userId)a.callback({status:"error",errorMessage:"UserId required"});else return a.apzCallback=t.onRemovedGroupMember,mckGroupService.removeGroupMember(a),
"success";else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.updateGroupInfo=function(a){if("object"!==typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.groupId&&""!==a.groupId||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId){if("undefined"!==typeof a.name&&""!==a.name||"undefined"!==typeof a.imageUrl&&""!==a.imageUrl||a.users&&0!==a.users.length){if(a.users&&
0<a.users.length){var c=[];b.each(a.users,function(a,b){b.userId&&"undefined"!==typeof b.role&&-1!==pb.indexOf(b.role)&&c.push(b)});if(0===c.length){a.callback({status:"error",errorMessage:"Incorrect users detail"});return}}c=[];b(".mck-group-change-role-box.vis").each(function(a,d){var e=b(this),g=parseInt(e.find("select").val()),l=e.parents(".mck-li-group-member").data("role");g!==l&&(e={userId:e.parents(".mck-li-group-member").data("mck-id"),role:g},c.push(e))});a.apzCallback=t.onUpdateGroupInfo;
mckGroupService.updateGroupInfo(a);return"success"}a.callback({status:"error",errorMessage:"Group properties required"})}else a.callback({status:"error",errorMessage:"GroupId or clientGroupId required"});else return"Callback function required"};l.getMessages=function(a){"function"===typeof a.callback&&u.getMessages(a)};l.getMessageList=function(a){return"undefined"!==typeof a&&"function"===typeof a.callback?(u.getMessageList(a),"success"):"Callback function required"};l.getMessageListByTopicId=function(a){if("object"!==
typeof a)return"Unsupported format. Please check format";if("function"===typeof a.callback)if("undefined"!==typeof a.id&&""!==a.id||"undefined"!==typeof a.clientGroupId&&""!==a.clientGroupId)if(a.id&&"boolean"!==typeof a.isGroup)a.callback({status:"error",errorMessage:"IsGroup parameter required"});else{if(a.topicId){a.id&&(a.tabId=a.id);a.topicStatus=V[0];var b=ia[a.topicId];b&&"object"===typeof M[b]?(a.conversationId=b,u.getMessageList(a)):(a.isExtMessageList=!0,a.pageSize=1,u.fetchConversationByTopicId(a));
return"success"}a.callback("TopicId required")}else a.callback({status:"error",errorMessage:"Id or clientGroupId required"});else return"Callback function required."};l.sendMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},cc,a);var c=a.message;if(!a.to)return"To field required";if("undefined"===typeof c||""===c)return"Message field required";if(12<a.type)return"Invalid message type";c=b.trim(c);a={to:b.trim(a.to),type:a.messageType,contentType:a.type,message:c};u.sendMessage(a);return"success"}return"Unsupported format. Please check format"};
l.sendGroupMessage=function(a){if("object"===typeof a){a=b.extend(!0,{},cc,a);var c=a.message;if(!a.groupId&&!a.clientGroupId)return"groupId or clientGroupId required";if("undefined"===typeof c||""===c)return"message field required";if(12<a.type)return"invalid message type";c=b.trim(c);c={type:a.messageType,contentType:a.type,message:c};if(a.groupId)c.groupId=b.trim(a.groupId);else if(a.clientGroupId){if("undefined"===typeof mckGroupUtils.getGroupByClientGroupId(a.clientGroupId))return"group not found";
c.clientGroupId=b.trim(a.clientGroupId)}u.sendMessage(c);return"success"}return"Unsupported format. Please check format"};l.addWelcomeMessage=function(a){if("object"===typeof a){if("undefined"===typeof a.sender||""===a.sender)return"Sender Field Required";if("undefined"===typeof a.messageContent||""===a.messageContent)return"Message Content Required";u.sendWelcomeMessage(a)}else return"Unsupported format. Please check format"};l.createGroup=function(a){if("object"===typeof a)if("function"===typeof a.callback){var b=
a.users;if("undefined"===typeof b||1>b.length)a.callback({status:"error",errorMessage:"Users list required"});else if(b.length>Z)a.callback({status:"error",errorMessage:"Users limit exceeds "+Z+". Max number of users allowed is "+Z+"."});else if(a.groupName)if("undefined"===typeof a.type||""===a.type)a.callback({status:"error",errorMessage:"Group type required"});else if(-1===qb.indexOf(a.type))a.callback({status:"error",errorMessage:"Invalid group type"});else return u.getGroup(a),"success";else a.callback({status:"error",
errorMessage:"Group name required"})}else return"Callback function required";else return"Unsupported Format. Please check format"};l.initGroupTab=function(a){if("object"===typeof a){var b=a.users;if("undefined"===typeof b||1>b.length)return"Users List Required";if(b.length>Z)return"Users limit exceeds "+Z+". Max number of users allowed is "+Z+".";if(!a.groupName)return"Group name required";if("undefined"===typeof a.type)return"Group type required";if(-1===qb.indexOf(a.type))return"Invalid group type";
u.getGroup(a);return"success"}return"Unsupported format. Please check format"};l.getTotalUnreadCount=function(){return K};l.subscribeToEvents=function(a){"object"===typeof a&&("function"===typeof a.onConnectFailed&&(l.events.onConnectFailed=a.onConnectFailed),"function"===typeof a.onConnect&&(l.events.onConnect=a.onConnect),"function"===typeof a.onMessageDelivered&&(l.events.onMessageDelivered=a.onMessageDelivered),"function"===typeof a.onMessageRead&&(l.events.onMessageRead=a.onMessageRead),"function"===
typeof a.onMessageDeleted&&(l.events.onMessageDeleted=a.onMessageDeleted),"function"===typeof a.onConversationDeleted&&(l.events.onConversationDeleted=a.onConversationDeleted),"function"===typeof a.onUserConnect&&(l.events.onUserConnect=a.onUserConnect),"function"===typeof a.onUserDisconnect&&(l.events.onUserDisconnect=a.onUserDisconnect),"function"===typeof a.onConversationReadFromOtherSource&&(l.events.onConversationReadFromOtherSource=a.onConversationReadFromOtherSource),"function"===typeof a.onConversationRead&&
(l.events.onConversationRead=a.onConversationRead),"function"===typeof a.onMessageReceived&&(l.events.onMessageReceived=a.onMessageReceived),"function"===typeof a.onMessageSentUpdate&&(l.events.onMessageSentUpdate=a.onMessageSentUpdate),"function"===typeof a.onMessageSent&&(l.events.onMessageSent=a.onMessageSent),"function"===typeof a.onUserBlocked&&(l.events.onUserBlocked=a.onUserBlocked),"function"===typeof a.onUserUnblocked&&(l.events.onUserUnblocked=a.onUserUnblocked),"function"===typeof a.onUserActivated&&
(l.events.onUserActivated=a.onUserActivated),"function"===typeof a.onUserDeactivated&&(l.events.onUserDeactivated=a.onUserDeactivated))};l.getConversation=function(a){u.getTopicId({conversationId:a.conversationId})}}g.applozic||(g.applozic=g.applozic?g.applozic:{},b.extend(!0,g.applozic,{applozic:{PRODUCT_ID:"applozic-chat"}}));var Gb={baseUrl:"https://apps.applozic.com",fileBaseUrl:"https://applozic.appspot.com",notificationIconLink:"",notificationSoundLink:"",mapStaticAPIkey:"AIzaSyCWRScTDtbt8tlXDr6hiceCsU83aS2UuZw",
launcher:"applozic-launcher",userId:null,appId:null,userName:null,contactNumber:null,email:null,supportId:null,mode:"standard",visitor:!1,olStatus:!1,groupUserCount:!1,desktopNotification:!1,locShare:!1,maxAttachmentSize:25,notification:!0,launchOnUnreadMessage:!1,loadOwnContacts:!1,maxGroupSize:100,authenticationTypeId:0,isAnonymousChat:!0,labels:{"conversations.title":"Conversations","start.new":"Start New","search.contacts":"Contacts","search.groups":"Groups","empty.groups":"No groups yet!","empty.contacts":"No contacts yet!",
"empty.messages":"No messages yet!","no.more.messages":"No more messages!","empty.conversations":"No conversations yet!","no.more.conversations":"No more conversations!","search.placeholder":"Search...","location.placeholder":"Enter a location","create.group.title":"Create Group","members.title":"Members","add.members.title":"Add Member","remove.member":"Remove Member","change.role":"Change Role","group.info.update":"Update","group.info.updating":"Updating...","add.group.icon":"Add Group Icon","group.deleted":"Group has been deleted",
"change.group.icon":"Change Group Icon","group.title":"Group Title","group.type":"Group Type","group.create.submit":"Creating Group...",blocked:"You have blocked this user","group.chat.disabled":"You are no longer part of this group!","block.user.alert":"Are you sure you want to block this user?","unblock.user.alert":"Are you sure you want to unblock this user?","exit.group.alert":"Are you sure you want to exit this group?","remove.member.alert":"Are you sure you want to remove this member?","clear.messages.alert":"Are you sure you want to delete all the conversation?",
typing:"typing...","is.typing":"is typing...",online:"Online","clear.messages":"Clear Messages","delete":"Delete",reply:"Reply",forward:"Forward",copy:"Copy","block.user":"Block User","unblock.user":"Unblock User","group.info.title":"Group Info","exit.group":"Exit Group","location.share.title":"Location Sharing","my.location":"My Location",send:"Send","send.message":"Send Message",smiley:"Smiley",close:"Close",edit:"Edit",save:"Save","file.attachment":"Files \x26 Photos","file.attach.title":"Attach File",
"last.seen":"Last seen","last.seen.on":"Last seen on",ago:"ago","group.metadata":{CREATE_GROUP_MESSAGE:":adminName created group :groupName",REMOVE_MEMBER_MESSAGE:":adminName removed :userName",ADD_MEMBER_MESSAGE:":adminName added :userName",JOIN_MEMBER_MESSAGE:":userName joined",GROUP_NAME_CHANGE_MESSAGE:"Group name changed to :groupName",GROUP_ICON_CHANGE_MESSAGE:"Group icon changed",GROUP_LEFT_MESSAGE:":userName left",DELETED_GROUP_MESSAGE:":adminName deleted group",GROUP_USER_ROLE_UPDATED_MESSAGE:":userName is :role now",
GROUP_META_DATA_UPDATED_MESSAGE:"",ALERT:"",HIDE:""}},openGroupSettings:{deleteChatAccess:0,allowInfoAccessGroupMembers:!0,disableChatForNonGroupMember:!1,defaultChatDisabledMessage:"Chat Disabled!"}},cc={messageType:5,type:0};b.fn.applozic=function(c,g){var r=b("#mck-sidebox");"object"===b.type(c)&&(c=b.extend(!0,{},Gb,c));var p=void 0;if("undefined"!==typeof r.data("applozic_instance"))if(p=r.data("applozic_instance"),"string"===b.type(c))switch(c){case "reInitialize":return p.reInit(g);case "loadConvTab":p.loadConvTab(g);
break;case "loadTab":p.loadTab(g);break;case "uploadFile":p.uploadFile(g);break;case "loadTabView":p.loadTabView(g);break;case "loadChat":p.loadChat(g);break;case "loadContextualTab":return p.loadTabWithTopic(g);case "audioAttach":p.audioAttach(g);break;case "addWelcomeMessage":p.addWelcomeMessage(g);break;case "loadContacts":p.loadContacts(g);break;case "sendMessage":return p.sendMessage(g);case "sendGroupMessage":return p.sendGroupMessage(g);case "createGroup":return p.createGroup(g);case "loadBroadcastTab":return g.groupName=
g.groupName?g.groupName:"Broadcast",g.type=5,p.initGroupTab(g);case "initBroadcastTab":return g.groupName=g.groupName?g.groupName:"Broadcast",g.type=5,p.initGroupTab(g);case "initGroupTab":return p.initGroupTab(g);case "loadGroupTab":return p.loadGroupTab(g);case "loadGroupTabByClientGroupId":return p.loadGroupTabByClientGroupId(g);case "setOffline":return p.setOffline(),"success";case "setOnline":return p.setOffline(),"success";case "logout":return p.logout(),"success";case "reset":p.reset(g);break;
case "getUserDetail":return p.getUserStatus(g),"success";case "getGroupList":return p.getGroupList(g),"success";case "leaveGroup":return p.leaveGroup(g);case "addGroupMember":return p.addGroupMember(g);case "removeGroupMember":return p.removeGroupMember(g);case "updateGroupInfo":return p.updateGroupInfo(g);case "getMessages":p.getMessages(g);break;case "messageList":return p.getMessageList(g);case "getMessageListByTopicId":return p.getMessageListByTopicId(g);case "getTotalUnreadCount":return p.getTotalUnreadCount();
case "subscribeToEvents":return p.subscribeToEvents(g);case "getConversation":return p.getConversation(g)}else"object"===b.type(c)&&p.reInit(c);else"object"===b.type(c)&&(c.userId&&c.appId&&""!==b.trim(c.userId)&&""!==b.trim(c.appId)?"undefined"!==typeof r.data("applozic_instance")?(p=r.data("applozic_instance"),p.reInit(c)):(jQuery="undefined"!==typeof c.ojq?$=c.ojq:$=b,"function"===typeof c.obsm?($.fn.modal=c.obsm,jQuery.fn.modal=c.obsm):"function"===typeof b.fn.modal?(p=b.fn.modal.noConflict(),
$.fn.modal=p,jQuery.fn.modal=p):"function"===typeof $.fn.modal&&(p=$.fn.modal.noConflict(),$.fn.modal=p,jQuery.fn.modal=p),"function"===typeof c.omckm?b.fn.mckModal=c.omckm:"function"===typeof b.fn.mckModal?b.fn.mckModal=b.fn.mckModal.noConflict():"function"===typeof $.fn.mckModal&&(b.fn.mckModal=$.fn.mckModal.noConflict()),"function"===typeof $.fn.linkify?(b.fn.linkify=$.fn.linkify,jQuery.fn.linkify=$.fn.linkify):"function"===typeof b.fn.linkify&&($.fn.linkify=b.fn.linkify,jQuery.fn.linkify=b.fn.linkify),
"function"===typeof $.fn.emojiarea?b.fn.emojiarea=$.fn.emojiarea:"function"===typeof b.fn.emojiarea&&($.fn.emojiarea=b.fn.emojiarea,jQuery.fn.emojiarea=b.fn.emojiarea),"function"===typeof $.fn.locationpicker?b.fn.locationpicker=$.fn.locationpicker:"function"===typeof b.fn.locationpicker&&($.fn.locationpicker=b.fn.locationpicker,jQuery.fn.locationpicker=b.fn.locationpicker),p=new kb(c),r.data("applozic_instance",p),p.init()):alert("Oops! looks like incorrect application id or user Id."))};b.fn.applozic.defaults=
Gb})($applozic,window,document);